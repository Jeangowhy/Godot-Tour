# Contents

[TOC]

## ğŸŸ¡ Godot Docs å®˜æ–¹æ–‡æ¡£é˜…è¯»æŒ‡å—
- [åŠ¨ç”»å¸ˆæ•‘ç”Ÿæ‰‹å†Œ - åŠ¨ç”»åäºŒåŸåˆ™](https://www.bilibili.com/video/BV1x54y1e7J9)
- [GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ - é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/)
- [GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“ - é—«ä»¤çª](https://www.bilibili.com/video/BV1YK4y1T7yY/)
- [GAMES202-é«˜è´¨é‡å®æ—¶æ¸²æŸ“è¯¾ç¨‹ä¸»é¡µ](https://sites.cs.ucsb.edu/~lingqi/teaching/games202.html/)
- [GAMES102-å‡ ä½•å»ºæ¨¡ä¸å¤„ç†åŸºç¡€ - åˆ˜åˆ©åˆš](https://www.bilibili.com/video/BV1NA411E7Yr/)
- [GAMES103-åŸºäºç‰©ç†çš„è®¡ç®—æœºåŠ¨ç”»å…¥é—¨ - ç‹åæ°‘](https://www.bilibili.com/video/BV12Q4y1S73g/)
- [GAMES105-è®¡ç®—æœºè§’è‰²åŠ¨ç”»åŸºç¡€ - åˆ˜åˆ©æ–Œ](https://www.bilibili.com/video/BV1GG4y1p7fF/)
- [GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ - ç‹å¸Œ](https://www.bilibili.com/video/BV1J3411n7WT/)
- [GAMES201-é«˜çº§ç‰©ç†å¼•æ“å®æˆ˜æŒ‡å— - èƒ¡æ¸Šé¸£](https://www.bilibili.com/video/BV1ZK411H7Hc)
- [CSD 15-462 Computer Graphics - Carnegie Mellon University](https://www.cs.cmu.edu/afs/cs/academic/class/15462-f11/www/)
- [CMU - 15-462/662 Computer Graphics - Keenan Crane](https://www.bilibili.com/video/BV1QZ4y1K7ga/)
- [é¾šå¤§çš„ä¸Šå¸è§†è§’çœ‹GPUæ•™ç¨‹](https://www.bilibili.com/video/BV1P44y1V7bu/)
- [The Book of Shaders by Patricio Gonzalez Vivo & Jen Lowe](https://thebookofshaders.com/?lan=ch)
- [Godot Download](https://godotengine.org/download/windows)
- [Godot Demo Projects](https://godotengine.github.io/godot-demo-projects)
- [Godot Demo Projects](https://github.com/godotengine/godot-demo-projects)
- [Godot 3 Recipes](https://kidscancode.org/godot_recipes/3.x/)

Digital Content Creation (DCC) æ•°å­—å†…å®¹åˆ›ä½œå·¥å…·æ˜¯æœ€ç°ä»£ä»£çš„ç”Ÿäº§åŠ›å·¥å…·ï¼ŒåŒ…æ‹¬ä½†ä¸ä»…é™äº 2D/3Dã€
éŸ³é¢‘/è§†é¢‘å‰ªè¾‘åˆæˆã€åŠ¨æ€/äº’åŠ¨å†…å®¹åˆ›ä½œã€å›¾åƒç¼–è¾‘ç­‰ç­‰ã€‚

ä¾‹å¦‚ï¼Œç”¨äºè§†é¢‘æ¸¸æˆåˆ¶ä½œçš„ UE5ã€U3Dï¼Œå®Œå…¨å…è´¹å¼€æºçš„ Godotï¼Œå»ºæ¨¡ä¸åŠ¨ç”»å·¥å…· Blender ç­‰ç­‰ã€‚2D åŠ¨ç”»åˆ¶ä½œ
å·¥ä½œå¦‚ Spineã€OpenToonz ç­‰ç­‰ã€‚ç¨‹åºåŒ–è´´å›¾ SubstanceDesignerï¼Œæ•°å­—åŒ–å¸ƒæ–™ Style3D (å›½äº§ä¹‹å…‰)ã€
VStitcherã€MarvelousDesignerï¼Œé›•åˆ»å»ºæ¨¡å·¥å…· ZBrushï¼Œç”µå½±ç‰¹æ•ˆé­”æœ¯å¸ˆ Houdiniï¼Œå·¥ä¸šè®¾è®¡å’Œå»ºç­‘è®¾è®¡
Rhinoï¼Œä»¥åŠä¼ ç»Ÿçš„æ”¶è´¹ 3D å·¥å…·ï¼Œå¦‚ 3Dmaxã€Maya ç­‰ç­‰ã€‚

Godot ä½œä¸ºä¸€ä¸ªæ–°ç§€ï¼Œå®Œå…¨å¼€æºï¼Œå¹¶ä¸”å­¦æ˜“æ˜“ç”¨ï¼Œå¹¶ä¸”å…·æœ‰é€‚é‡çš„æºä»£ç ï¼Œä¸ä¼šåƒ UE5 é‚£æ ·å®å¤§éš¾ä»¥åˆ†è§£ã€‚

è¦é˜…è¯»å¥½ Godot å®˜æ–¹æ–‡æ¡£ï¼Œéœ€è¦æŒæ¡æ–‡æ¡£çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¹¶ä¸”æœ€å¥½æœ‰è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ï¼ŒæŒæ¡ Python è„šæœ¬è¯­è¨€
å¯ä»¥å¿«é€ŸæŒæ¡ GDScript è„šæœ¬ã€‚

![Overview of the interface](https://docs.godotengine.org/en/latest/_images/editor-vocabulary-overview.png)

Godot é™¤äº†è‡ªå¸¦çš„ GDScript è„šæœ¬å¤–ï¼Œé€šè¿‡æ¨¡å—æ‰©å±•æ”¯æŒäº†å¤šç§è¯­è¨€å¼€å‘ï¼ŒC# æ”¯æŒéœ€è¦ä¸‹è½½é›†æˆ Mono çš„ç‰ˆæœ¬ï¼Œ
æ¨èä½¿ç”¨è‡ªå¸¦çš„ GDScript è„šæœ¬å¼€å‘ï¼Œå®ƒç›¸å½“ä¸€ä¸ªæ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œçš„ Pythonï¼Œæ”¯æŒå…­ç§ match åˆ†æ”¯åŒ¹é…æ¨¡å¼ã€‚

- Constant pattern
- Variable pattern
- Wildcard pattern
- Binding pattern
- Array pattern
- Dictionary pattern
- Multiple patterns

è®¡ç®—æœºå›¾å½¢é¢†åŸŸä¸€ä¸ªè¾ƒéš¾çš„é¢†åŸŸæ˜¯ç°ä»£ GPU ç¼–ç¨‹ï¼Œå³ç€è‰²å™¨ç¨‹åºå¼€å‘ï¼Œå…¥é—¨ä½“éªŒå®¹æ˜“ï¼Œæƒ³è¦å¥½æ•ˆæœéš¾ã€‚ä¸€ä¸ªæ¯”è¾ƒ
å¥½çš„å…¥é—¨æ•™ææ˜¯ The Book of Shadersï¼Œå°½ç®¡è¿™æ˜¯ä¸€ä¸ªçƒ‚å°¾å·¥ç¨‹ã€‚Godot 3.x ä½¿ç”¨ OpenGL GLES 2/3ï¼Œ
æœªæ¥ Godot 4.x ä¼šä½¿ç”¨ Vulkanã€‚

å¦å¤–ï¼Œæå‡åŠ¨ç”»è‰ºæœ¯æ°´å¹³ï¼Œå­¦ä¹ ä¸€äº›åŠ¨ç”»åŸç†å¾ˆæœ‰å¿…è¦ï¼Œå·¥å…·æœ‰ Spineã€Blenderã€SketchBookã€Kritaã€SAI
ç­‰ç­‰ã€‚æœ€é‡è¦çš„æ˜¯æå‡ç¾å­¦æ°´å¹³ï¼Œä¸€ä¸ªä½œå“å¥½ä¸åï¼Œä¸‹é™ç”±å·¥å…·å†³å®šï¼Œä¸Šé™ç”±åˆ¶ä½œäººå†³å®šï¼

Godot å®˜æ–¹ç¤ºèŒƒé¡¹ç›®å¾ˆèµï¼Œæä¾›äº†è®¸å¤šåŸºç¡€åŠŸèƒ½çš„æ¼”ç¤ºï¼ŒGodot 3.x/4.x ç‰ˆæœ¬åˆ†ä½¿ç”¨ master æˆ– 4.0-dev åˆ†æ”¯ï¼š

> git clone -b master -b 3.5 --depth=1 git@github.com:godotengine/godot.git
>
> git clone -b master -b 4.0-dev --depth=1 git@github.com:godotengine/godot-demo-projects.git
>
> git clone --depth=1 git@github.com:godotengine/godot-docs.git
> git clone -b master -b stable -b 3.5 -b 3.6 --depth=1 git@github.com:godotengine/godot-docs docs

Godot æºä»£ç ä»“åº“åŒ…å«äº†ç±»å‹ API æ–‡æ¡£ï¼Œä½¿ç”¨ xml æ ¼å¼ä¿å­˜ï¼Œå¯ä»¥åœ¨ doc æ–‡ä»¶æ‰§è¡Œ make rst æˆ–è€…
make markdown è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚

å…‹éš†å‘½ä»¤ git clone ä¸æ”¯æŒé€šè¿‡ -b æŒ‡å®šå¤šä¸ªåˆ†æ”¯ï¼Œåªæœ‰æœ€åæŒ‡å®šçš„åˆ†æ”¯æ‰æœ‰æ•ˆã€‚


ä¸ºäº†æ–¹ä¾¿åœ¨æ–‡æ¡£ä¹‹é—´å¿«é€Ÿè·³è½¬ï¼Œæ¨èåœ¨ Sublime Text ç¯å¢ƒä¸‹é˜…è¯»æ–‡æ¡£ï¼Œåªéœ€è¦å®‰è£… run-snippet æ’ä»¶ï¼Œ
ä½¿ç”¨ F9 å¿«æ·é”®è·³è½¬åˆ°å…‰æ ‡ä¸‹çš„æ–‡ä»¶æˆ–é“¾æ¥ã€‚

å¿«é€Ÿå®‰è£… RunSnippet æ’ä»¶ï¼š

- Ctrl+Shift+P æ‰“å¼€ Sublime Text å‘½ä»¤è°ƒæ¿ï¼›
- æ‰§è¡Œ Add Repository æ·»åŠ æœ¬æ’ä»¶ä»£ç ä»“åº“åœ°å€: https://github.com/jimboyeah/run-snippet
- ç„¶åæ‰§è¡Œ Install Package å¹¶è¾“å…¥ RunSnippt è¿›è¡Œç¡®è®¤å®‰è£…ï¼›

æ‰‹åŠ¨æ·»åŠ  Repositoryï¼Œæ‰§è¡Œèœå•ï¼š Perferences ğŸ¡’ Package Settings ğŸ¡’ Package Control ğŸ¡’ Settings

    "repositories":
    [
        "https://github.com/jimboyeah/run-snippet",
    ],

å¯ä»¥åœ¨ Packages ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… RunSnippet æ’ä»¶ï¼š

    git clone git@github.com/jimboyeah/run-snippet.git

æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤å¯ç”¨åˆ†ç»„è·³è½¬ï¼Œå¦‚æœ Sublime Text æ²¡æœ‰è®¾ç½®åˆ†ç»„ï¼Œåˆ™åœ¨å½“å‰ View å¼¹å‡ºæ–‡ä»¶è·³è½¬çª—å£ï¼Œ
è¿™ç§è¡Œä¸ºæœ‰ç‚¹æ‰“æ–­æ€è·¯ã€‚æ›´åˆç†çš„åšæ³•æ˜¯ GUI è®¾ç½® 2 ä¸ª Groupï¼Œå¹¶ä¸”åœ¨å¦ä¸€ä¸ª Group å¼¹å‡ºæ–‡ä»¶ Panelã€‚
Load settings from /Packages/Users/RunSnippet.sublime-settings

```json
    {
        "jump_between_group": true,
    }
```

Godot æ–‡æ¡£æ˜¯éå¸¸äººæ€§åŒ–çš„ï¼Œä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š

Godot IDE ç¼–è¾‘å™¨æœ¬èº«é›†æˆäº†åœ¨çº¿æ‰‹å†Œï¼ŒæŒ‰ F1 æˆ–ç›´æ¥åœ¨ä»£ç ä¸­æŒ‰ä¸‹ Ctrl å•å‡»å…³é”®å­—å³è·³è½¬åˆ°ç›¸å…³æ‰‹å†Œæ–‡æ¡£ã€‚
ä¿¡æ¯éå¸¸è¯¦ç»†ï¼ŒåŒ…æ‹¬ç±»å¯¹è±¡çš„ç»§æ‰¿å…³ç³»ã€æˆå‘˜ã€æ–¹æ³•ä¿¡æ¯ç­‰ç­‰ã€‚ä¾‹å¦‚å…¨å±€ç©ºé—´ @GDScript å’Œ @GlobalScope 
åŒ…å«æ‰€æœ‰è„šæœ¬ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å‡½æ•°ç­‰ï¼Œè¶…é“¾æ¥è·³è½¬éå¸¸æ–¹ä¾¿ã€‚

å…¶æ¬¡ Online Docs æ–‡æ¡£æ˜¯å®Œæ•´çš„åœ¨çº¿æ–‡æ¡£ï¼Œæ˜¯å®Œæ•´çš„æ–‡æ¡£ï¼Œæ–°æ‰‹å»ºè®®ä»å¼€å¤´ä¸¤éƒ¨åˆ†å†…å®¹å¼€å§‹ï¼š

- General åŸºæœ¬æ¦‚å¿µåŠä»‹ç»ï¼Œå­¦ä¹ ä¸€ä¸ªæ¸¸æˆå¼•æ“æœ€å¥½è¦æœ‰æ•°å­¦ã€å›¾å½¢å­¦ã€ç€è‰²å™¨ç¼–ç¨‹ç­‰åŸºç¡€ã€‚
- Getting started å…¥é—¨å¼•å¯¼ï¼Œé€šè¿‡ç®€å•çš„æ•™ç¨‹è®²è§£åŸºç¡€çš„æ¦‚å¿µã€‚
- Tutorials å„ä¸ªç³»ç»ŸåŠŸèƒ½çš„æ•™ç¨‹ï¼Œè¯¦ç»†ä»‹ç» Godot çš„ç»„æˆã€‚
- Development å¼•æ“å¼€å‘æ–‡æ¡£ï¼Œè¿™éƒ¨åˆ†å¯ä»¥å­¦ä¹  Godot åº”ç”¨æ¶æ„ç»„æˆï¼Œåœºæ™¯æ–‡ä»¶ä»¥åŠ GDScript grammar è„šæœ¬è¯­æ³•å£°æ˜è§„èŒƒã€‚
- Community ç¤¾åŒºèµ„è®¯ä»‹ç»ã€‚
- Class reference ç±»å¯¹è±¡ API æ‰‹å†Œã€‚

è¿ªå£«å°¼çš„ 12 é¡¹åŠ¨ç”»åŸºæœ¬åŸåˆ™æ˜¯è¿ªå£«å°¼åŠ¨ç”»åˆ¶ä½œäºº Ollie Johnston å’Œ Frank Tomas åœ¨ 1981 å¹´å‡ºç‰ˆçš„
 The Illusion of Life: Disney Animation ä¹¦ä¸­ä»‹ç»çš„åŸåˆ™ã€‚

- Squash and Stretch é€šè¿‡æŒ¤å‹å’Œæ‹‰ä¼¸ç”ŸåŠ¨åœ°è¡¨è¾¾ä½“ç§¯æ„Ÿçš„å˜åŒ–ï¼›
- Anticipation é¢„å¤‡åŠ¨ä½œä¸ºè§‚ä¼—å¿ƒç†é¢„æœŸå‡†å¤‡ä¸€ä¸ªé€‚åº”æ€§æç¤ºï¼›
- Staging èˆå°å¸ƒå±€åœ¨ç”»é¢æ„å›¾ä¸Šç²¾å¿ƒå®‰æ’å¥½ä¸»æ¬¡å…ƒç´ ï¼›
- Straight Ahead Action and Pose to Pose ä½¿ç”¨å…³é”®å¸§æ¥è®¾ç½®åŠ¨ç”»å§¿æ€å¹¶ä¿æŒåŠ¨ä½œè¿è´¯ï¼›
- Follow Through and Overlapping Action ä¸ºå—åŠ›æ‹–æ‹½ã€æƒ¯æ€§å…ƒç´ æä¾›åŠ¨ç”»æ•ˆæœï¼›
- Slow In and Slow Out ç¼“å…¥ç¼“å‡ºï¼ˆEase In/Outï¼‰ï¼ŒçœŸå®ä¸–ç•Œçš„åŠ¨ç”»æ˜¯ç´¯ç§¯çš„è€Œéçªå˜çš„ï¼›
- Arcs å¼§çº¿è¿åŠ¨ï¼Œè¿™æ˜¯æ™®éå­˜çœŸå®ä¸–ç•Œä¸­çš„è¿åŠ¨ï¼Œå¦‚æ‰‹è‡‚çš„æ‘†åŠ¨ï¼Œèº«ä½“çš„å¼¯æ›²ç­‰ç­‰ï¼›
- Secondary Action æ¬¡è¦åŠ¨ä½œæ˜¯ä¸°å¯ŒåŠ¨ç”»å†…å®¹çš„é‡è¦æ‰‹æ®µï¼Œä¾‹å¦‚äººç‰©æ¬è¿é‡ç‰©å‰å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‘©æ“¦æ‰‹æŒçš„åŠ¨ä½œï¼›
- Timing and Weight æ—¶é—´èŠ‚å¥å’Œé‡é‡æ„Ÿï¼Œæ—¶é—´è¶ŠçŸ­æˆ–å¸§æ•°è¶Šå°‘è¡¨ç¤ºåŠ¨ä½œè¶Šå¿«ï¼›
- Exaggeration å¤¸å¼ åœ°è¡¨ç°æƒ…ç»ªæ°”æ°›ï¼›
- Solid Drawing ç«‹ä½“é€ å‹ï¼Œç¬¦åˆé€è§†çš„ç”»é¢æ‰æ›´çœŸå®ï¼›
- Appeale å¸å¼•åŠ›ï¼Œè®©ç”»é¢æ›´è®¨å–œã€æ¯”ä¾‹æ›´çªå‡ºï¼Œä½¿ç”¨ç”»é¢ç®€æ´è€Œçªå‡ºé‡ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯åŠ¨ç”»ä¸æ’ç”»çš„åŒºåˆ«ï¼›



## ğŸŸ¡ Godot Architecture æ„æ¶ä»‹ç»
- [Introduction to Godot development](https://docs.godotengine.org/en/stable/development/cpp/introduction_to_godot_development.html)
- [Optimization using Servers](https://docs.godotengine.org/en/3.3/tutorials/optimization/using_servers.html)
- [Inheritance class tree](https://docs.godotengine.org/en/stable/development/cpp/inheritance_class_tree.html)
- [Overview of Godot's key concepts](https://docs.godotengine.org/en/stable/getting_started/introduction/key_concepts_overview.html)
- [Nodes and Scenes](https://docs.godotengine.org/en/stable/getting_started/step_by_step/nodes_and_scenes.html)
- [Using SceneTree](https://docs.godotengine.org/en/3.5/tutorials/scripting/scene_tree.html)
- [Using Viewports](https://docs.godotengine.org/en/3.5/tutorials/rendering/viewports.html)
- [Canvas layers](https://docs.godotengine.org/en/3.5/tutorials/2d/canvas_layers.html)
- [User Interface(UI)](https://docs.godotengine.org/en/3.5/tutorials/ui/index.html)
- [What were the motivations behind creating GDScript?](https://docs.godotengine.org/en/latest/about/faq.html#doc-faq-what-is-gdscript)
- [WebGL å¯è§†åŒ–ç›¸æœº](https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-visualizing-the-camera.html)
- [ã€Šè¿·å¤±å²›2ã€‹æ¸¸æˆæ¡†æ¶å¼€å‘01:å®ç°åœºæ™¯è½¬æ¢ï½œGodotæ•™ç¨‹](https://www.bilibili.com/video/BV1jr4y1V7xJ/)
- [Scene Transitions By: Henrique Campos](https://www.gdquest.com/tutorial/godot/2d/scene-transition-rect/)

Godot æ¶æ„æ˜¯æ¨¡å—åŒ–çš„ï¼Œé€šè¿‡æ‰©å±•æ¨¡å—å¯ä»¥å®ç°å„ç§åŠŸèƒ½ï¼Œè€Œå„ç§ç¼–ç¨‹è¯­è¨€åˆ™æ˜¯é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªæ¨¡å—å®ç°çš„ã€‚
Godot æœ¬èº«æ˜¯ C++ å¼€å‘çš„ï¼Œå¯ä»¥å®ç°å„ç§æ¨¡å—ä»¥æ‰©å±• Godot åŠŸèƒ½ï¼Œæ¨¡å—æºä»£ç ä½äº modules å­ç›®å½•ï¼š

- GDScript æ¨¡å—å¼•å…¥äº† GDScript è„šæœ¬ç¼–ç¨‹ï¼›
- Mono æ¨¡å—å¼•å…¥ C# è¯­è¨€ï¼›
- GDNative æ¨¡å—å¼•å…¥åŸç”Ÿè¯­è¨€ï¼Œå¦‚é€šè¿‡ GDNative C++ Binding ä½¿ç”¨ C++ è¯­è¨€ï¼›

å…¥é—¨å…ˆé˜…è¯» Introduction to Godot developmentï¼Œ- Architecture diagram äº†è§£å·¥ç¨‹æ¶æ„ï¼Œææ¸…æ¥š
**SceneTree** -> Nodes -> CanvasItem(Node2D, Control) and Spatial (3D Nodes) åŸºæœ¬å…³ç³»ã€‚
Godot IDE ç¼–è¾‘å™¨æœ¬èº«å°±æ˜¯å’Œæ¸¸æˆå·¥ç¨‹ä¸€æ ·çš„åº”ç”¨ï¼Œæ¯ä¸ªæ¸¸æˆå¯ä»¥çœ‹ä½œä¸€ä¸ªåœºæ™¯æ ‘ï¼Œå®ƒçš„èŠ‚ç‚¹æ˜¯åœºæ™¯ï¼Œè€Œåœºæ™¯åˆ
åŒ…å«ä¸€ç»„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå¯ä»¥ç»‘å®šè„šæœ¬è¿›è¡Œç¼–ç¨‹çš„å¯¹è±¡ã€‚

![Architecture diagram](https://docs.godotengine.org/en/stable/_images/architecture_diagram.jpg)

Godot æœ¬èº«æ”¯æŒå¤šå¹³å°ï¼Œé€šè¿‡æºä»£ç  platform ç›®å½•ä¸‹å¯¹åº”å„å¹³å°çš„å®ç°ï¼Œdetect.py è„šæœ¬åˆ™ç”¨äºæ£€æµ‹å½“å‰
æ”¯æŒçš„å¹³å°ï¼Œä¸»ç¨‹åºå…¥å£åˆ™æ˜¯åœ¨ main ç›®å½•ä¸‹ï¼Œå…¥å£æ–¹æ³•æ˜¯ **Main::start()**ã€‚SceneTree ç±»å‹å°±æ˜¯ä¸€ä¸ª
MainLoop å­ç±»å‹ï¼Œä»£è¡¨äº†æ¸¸æˆä¸­çš„ä¸»å¾ªç¯ï¼Œå®ƒä¼šåœ¨ç¨‹åºå…¥å£ä¸­æ‰§è¡Œã€‚

- OS_Unix    <- OS
- OS_UWP     <- OS
- OS_Windows <- OS
- OS_X11     <- OS_Unix
- OS_OSX     <- OS_Unix
- OSIPhone   <- OS_Unix
- OS_Android <- OS_Unix
- OS_JavaScript <- OS_Unix

ä¸åŒå¹³å°çš„å…¥å£ä¼šåŒ…è£… OS ç±»ï¼Œä¾‹å¦‚ OS_Windowsï¼Œä½†æ˜¯ Web å¹³å°ç‰¹æ®Šä¸€ç‚¹ï¼Œå› ä¸ºå®ƒè¿è¡Œåœ¨æµè§ˆå™¨ä¸Šã€‚å› ä¸º
å¤§å¤šæ•°ç³»ç»Ÿéƒ½æ˜¯ç±» Unix æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥é™¤äº† Windows å¹³å°ï¼Œå‡ ä¹éƒ½åŒ…è£…ä¸ºä¸€ä¸ª OS_Unix ç±»å‹ã€‚æ“ä½œç³»ç»Ÿ
ä¸çª—å£çš„äº¤äº’æ¶ˆæ¯å…¨éƒ¨é€šè¿‡ Notification æœºåˆ¶è½¬è¾¾åœºæ™¯æ ‘ã€‚Godot IDE æœ¬èº«å°±æ˜¯ä¸€ä¸ª EditorNode èŠ‚ç‚¹ï¼Œ
å®ƒä¹Ÿæ˜¯åŸºäº Godot å¼•æ“å¼€å‘çš„ä¸€ä¸ªæ¸¸æˆï¼Œåªä¸è¿‡è¿™ä¸ªæ¸¸æˆæ˜¯ç”¨æ¥å¼€å‘å…¶å®ƒæ¸¸æˆçš„ã€‚

ä»¥ä¸‹æ˜¯å…¥å£ä»£ç çš„æµç¨‹æ‘˜è¦ï¼Œæ¼”ç¤ºäº† UWP å¹³å°ä¸‹çš„å…¥å£è¿è¡ŒåŸºæœ¬æµç¨‹ã€‚Android å¹³å°çª—å£æ¶ˆæ¯ä¼ é€’æ–¹å¼å·®åˆ«
è¾ƒå¤§ï¼ŒMainLoop çš„æ–¹æ³•åŒ…è£…åˆ°äº†ä¸åŒçš„å‡½æ•°å†…ï¼š

```cpp
bool Main::start() {

    MainLoop *main_loop = nullptr;
    if (editor) {
        main_loop = memnew(SceneTree);
    };

    SceneTree *sml = Object::cast_to<SceneTree>(main_loop);

    if (!project_manager && !editor) { // game
        // ...
    }

    if (editor) {
        EditorNode *editor_node = nullptr;
        editor_node = memnew(EditorNode);
        sml->get_root()->add_child(editor_node);
    }

    OS::get_singleton()->set_main_loop(main_loop);
}

void OS_UWP::run() {
    if (!main_loop)
        return;

    main_loop->init();

    uint64_t last_ticks = get_ticks_usec();

    int frames = 0;
    uint64_t frame = 0;

    while (!force_quit) {
        CoreWindow::GetForCurrentThread()->Dispatcher->ProcessEvents(CoreProcessEventsOption::ProcessAllIfPresent);
        if (managed_object->alert_close_handle)
            continue;
        process_events();      // get rid of pending events
        if (Main::iteration()) // -> VisualServer tick()
            break;
    };

    main_loop->finish();
}
```

æ•´ä¸ªå¼•æ“çš„æ¶ˆæ¯å¤„ç†å¾ªç¯ç»“æ„å°±æ˜¯ while å¾ªç¯ï¼ŒMain::iteration() å‡½æ•°å°±æ˜¯æ¸¸æˆå¾ªç¯ä¸­è¦å¤„ç†çš„å·¥ä½œï¼Œ
åœ¨è¿™é‡Œä¼šå‘é€å„ç§é€šçŸ¥ï¼Œè®©èŠ‚ç‚¹æœ‰å¤„ç†çš„æœºä¼šã€‚åœ¨å…¥å£æ–¹æ³•ä¸­ï¼Œä¼šåˆ¤æ–­å½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼Œæ ¹æ®æ˜¯å¦åœ¨ç¼–è¾‘å™¨çŠ¶æ€
æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚

æ¸¸æˆå¾ªç¯ä¸­ï¼Œå¼•æ“ä¼šæŒ‰ FPS é¢‘ç‡æ‰§è¡Œäº‹ä»¶å¤„ç†å›è°ƒå‡½æ•°ï¼Œå½“æ¸¸æˆè¿›å…¥ç©ºé—²çŠ¶æ€æ—¶ï¼Œå¯ä»¥ä¸»åŠ¨å…³é—­äº‹ä»¶å¤„ç†å›è°ƒï¼Œ
ä»¥é™ä½ç©ºé—²æ—¶çš„ CPU æ¶ˆè€—ï¼š

```py
void _physics_process(delta: float) virtual
void _process(delta: float) virtual

void set_physics_process(enable: bool)
void set_process(enable: bool)

var fps = ProjectSettings.get_setting("physics/common/physics_ticks_per_second", 60)
Engine.set_physics_ticks_per_second(fps/3)

get_tree().paused = true
```

ä½ å¯ä»¥ä½¿ç”¨ä¸¤ç§ç±»å‹çš„å¤„ç†ï¼š

å…¶ä¸­ï¼Œ`_process()` è¿™ä¸ªäº‹ä»¶å¤„ç†å›è°ƒå‡½æ•°åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œä¹Ÿç§°ä¸º `_idle()` å³ç©ºé—²äº‹ä»¶å¤„ç†ã€‚ç›¸å¯¹çš„ï¼Œ
ç‰©ç†äº‹ä»¶çš„å¤„ç†æ›´ä¼˜å…ˆï¼Œå› ä¸ºæœ‰æ›´é«˜çš„å®æ—¶æ€§éœ€æ±‚ã€‚ä»»ä½•ä¸ç‰©ç†å¼•æ“ç›¸å…³çš„ï¼Œæ¯”å¦‚ç§»åŠ¨å¯èƒ½ä¸ç¯å¢ƒç›¸ç¢°æ’çš„å®ä½“ï¼Œ
éƒ½åº”ä½¿ç”¨ `_physics_process()`ã€‚

- Idle processing ç©ºé—²å¤„ç†å¯ä»¥ç”¨æ¥æ‰§è¡Œæ¯å¸§æ›´æ–°èŠ‚ç‚¹çš„ä»£ç ï¼Œæ‰§è¡Œé¢‘ç‡ä¼šå°½å¯èƒ½åœ°å¿«ã€‚
- Physics processing ç‰©ç†å¤„ç†çš„é¢‘ç‡æ˜¯å›ºå®šçš„ï¼Œå’Œæ¸¸æˆçš„å®é™…å¸§ç‡æ— å…³ï¼Œå¯ä»¥è®©ç‰©ç†å¹³æ»‘æ‰§è¡Œã€‚

åœ¨ä¸€äº›æ¸¸æˆä¸­ï¼Œå¯ä»¥å¤§å¤§é™ä½ç‰©ç†å¤„ç†å‘¨æœŸç‡ï¼Œæ¯”å¦‚è¯´ï¼Œå°†ç‰©ç†æ–° 60FPS æ”¹å˜ä¸º 30 æ¬¡ç”šè‡³ 20 æ¬¡ï¼Œå°±å¤§å¤§
é™ä½ CPU çš„è´Ÿè½½ã€‚

Godot ä¸­çš„èŠ‚ç‚¹éƒ½æœ‰â€œPause Modeâ€è®¾ç½®ï¼Œæš‚åœæ¨¡å¼å®šä¹‰å®ƒä»¬åº”è¯¥åœ¨ä½•æ—¶è¿›è¡Œå¤„ç†ã€‚è¦å°†æ¸¸æˆæš‚åœï¼Œå¿…é¡»è®¾ç½®
æš‚åœçŠ¶æ€ã€‚å°† SceneTree.paused å±æ€§èµ‹å€¼ä¸º true å³å¯ã€‚

è®¾ç½®æš‚åœåä¼šå¯¼è‡´ä¸¤ä»¶äº‹ï¼šé¦–å…ˆï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„ 2D å’Œ 3D ç‰©ç†ç³»ç»Ÿéƒ½ä¼šåœæ­¢ã€‚å…¶æ¬¡ï¼Œæ ¹æ®å¤„ç†æ¨¡å¼ä¸åŒï¼ŒæŸäº›
èŠ‚ç‚¹çš„è¡Œä¸ºä¼šåœæ­¢æˆ–è€…å¼€å§‹ã€‚ç‰©ç†ç³»ç»Ÿå¯ä»¥é€šè¿‡ set_active æ–¹æ³•æ¿€æ´»ã€‚

- Inheritï¼šå¤„ç†ä¸å¦å–å†³äºçˆ¶ã€ç¥–çˆ¶ç­‰ç­‰èŠ‚ç‚¹ä¸­ç¬¬ä¸€ä¸ªé**ç»§æ‰¿**çŠ¶æ€çš„èŠ‚ç‚¹ã€‚
- Stopï¼šæ— æ¡ä»¶åœæ­¢èŠ‚ç‚¹ï¼Œæš‚åœæ—¶è¯¥èŠ‚ç‚¹ä¸ä¼šè¿›è¡Œå¤„ç†ã€‚
- Processï¼šæ— æ¡ä»¶å¤„ç†èŠ‚ç‚¹ï¼Œæ— è®ºæš‚åœä¸å¦ï¼Œè¯¥èŠ‚ç‚¹éƒ½ä¼šè¿›è¡Œå¤„ç†ã€‚
- Pausableï¼šåªåœ¨éæš‚åœæ¨¡å¼ä¸‹å¤„ç†ï¼Œä¸ When Paused ç›¸åï¼Œè¿™ä¸¤ç§æ˜¯ Godot 4.x æ–°å¢æ¨¡å¼ã€‚
- When Pausedï¼šåªåœ¨ SceneTree æš‚åœæ¨¡å¼ä¸‹å¤„ç†ï¼Œå’Œ Pausable ç›¸åã€‚

èŠ‚ç‚¹åœæ­¢å¤„ç†æ—¶ä¼šå‘ç”Ÿä¸å°‘äº‹æƒ…ï¼Œ`_process`ã€`_physics_process`ã€`_input`ã€`_input_event` ç­‰
å‡½æ•°éƒ½ä¸ä¼šå†è¢«è°ƒç”¨ã€‚ä½†ä¿¡å·æ­£å¸¸å·¥ä½œï¼Œæ‰€è¿æ¥çš„å‡½æ•°ä¹Ÿæ­£å¸¸æ‰§è¡Œï¼Œå³ä¾¿è„šæœ¬é™„åŠ åœ¨â€œStopâ€æš‚åœæ¨¡å¼çš„èŠ‚ç‚¹ä¸Šã€‚
åŠ¨ç”»èŠ‚ç‚¹ä¼šæš‚åœå®ƒä»¬çš„å½“å‰åŠ¨ç”»ï¼ŒéŸ³é¢‘èŠ‚ç‚¹ä¼šæš‚åœå®ƒä»¬çš„å½“å‰éŸ³é¢‘æµï¼Œç²’å­ä¹Ÿä¼šæš‚åœã€‚æ¸¸æˆä¸å†æš‚åœæ—¶ï¼Œå®ƒä»¬éƒ½ä¼š
è‡ªåŠ¨ç»§ç»­è¿è¡Œã€‚


Godot ç¼–ç¨‹ä½“ç³»çš„ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­ï¼Œæ‰€æœ‰å¯¹è±¡çš„çˆ¶ç±»æ˜¯ **Object**ï¼Œç„¶åæ´¾ç”Ÿå‡ºå„ç§åŠŸèƒ½çš„ç±»å¯¹è±¡ï¼Œä¸»è¦æ˜¯
å¼•ç”¨ç±»å’ŒèŠ‚ç‚¹ç±»ä¸¤å¤§å—ï¼š

    â— Object
      +-- â— References
      |   +-- â— Resources
      +-- â— Node
      |   +-- â— CanvasItem
      |   |   +-- â— Control
      |   |   +-- â— Node2D
      |   +-- â— Spatial

Object æä¾›äº†æœ€åŸºæœ¬çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬è§‚å¯Ÿè€…ç¼–ç¨‹æ¨¡å¼ Signal å’Œ Notifications ä¸¤ç§æœºåˆ¶çš„å®ç°ã€‚
ä¿¡å· **Signal** åœ¨ Godot ä¸­å¤§é‡ä½¿ç”¨ï¼Œè¿™æ˜¯è§‚å¯Ÿè€…ç¼–ç¨‹æ¨¡å¼çš„ä¸€ç§å®ç°ï¼Œå¯ä»¥å®ç°å¤æ‚é€»è¾‘çš„è§£è€¦ã€‚

ç›¸å¯¹äº Objectã€Referencesã€Resources ç­‰ç±»å‹ï¼ŒNode æ˜¯ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„å¯¹è±¡ï¼Œå› æ­¤å®ƒä¹Ÿæ›´æ¶ˆè€— CPUï¼Œ
æ‰€ä»¥ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•å¯¹è±¡å®ç°çš„åŠŸèƒ½ï¼Œå°±å°½é‡é¿å…ä½¿ç”¨ Node ç±»å‹å¯¹è±¡æ¥å®ç°ã€‚

åœºæ™¯æ ‘ä¸­å¯ä»¥æ·»åŠ çš„æ‰€æœ‰èŠ‚ç‚¹ç±»å‹ç»Ÿä¸€åœ¨æºä»£ç  scene ç›®å½•ä¸‹ï¼š

- /scene/main ä¸»è¦èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ SceneTreeã€CanvasLayerã€ViewPortã€Nodeã€Timerã€HTTPRequestï¼›
- /scene/gui æ§ä»¶ç±»å‹ï¼ŒåŒ…æ‹¬ Control åŠå­ç±»çš„å®ç°ï¼Œå¦‚æ–‡ä»¶å¯¹è¯æ¡† FileDialog ç­‰ï¼›
- /scene/2d  äºŒç»´èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ Node2D åŠå­ç±»çš„å®ç°ï¼›
- /scene/3d  ä¸‰ç»´èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ Spatial åŠå­ç±»çš„å®ç°ï¼›
- /scene/animation  åŠ¨ç”»èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬AnimationPlayerã€AnimationTree ç­‰ç­‰ï¼›
- /scene/audio  éŸ³é¢‘æ’­æ”¾èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ AudioStreamPlayerï¼›
- /scene/resource èµ„æºèŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ Animationã€AudioStreamPlaybackSample ç­‰ç­‰ï¼›

å’Œ UnrealEngine è¿™æ ·çš„å¤§å‹å¼•æ“ä¸åŒï¼ŒGodot å¼•æ“æ²¡æœ‰å°†äºŒç»´å›¾å½¢ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—åŒ…è£…ï¼Œè€Œæ˜¯åœ¨æ›´åº•å±‚
æ¶æ„äº†ä¸€ä¸ªæœåŠ¡ç³»ç»Ÿï¼Œä»¥ä¸åŒçš„æœåŠ¡å™¨ä¸ºéŸ³é¢‘ã€å›¾å½¢ã€ç‰©ç†åŠç©ºé—´ä½ç½®ç›¸ç»“åˆçš„éŸ³é¢‘ç­‰æä¾›ç›¸åº”çš„æ¸²æŸ“æœåŠ¡ã€‚æœ€åï¼Œ
éŸ³é¢‘åˆæˆæ•°æ®å°†é€å¾€ç³»ç»Ÿçš„éŸ³é¢‘é©±åŠ¨å™¨ï¼Œè§†é¢‘åˆ™äº¤ç”± OpenGL æˆ– Vulkan æ¥å£è¿›è¡Œæ¸²æŸ“ã€‚

- VisualServer (RenderingServer) å¯è§†æ¸²æŸ“æœåŠ¡ï¼›
- Physics2DServer äºŒç»´ç‰©ç†å¼•æ“æœåŠ¡ï¼›
- PhysicsServer ä¸‰ç»´ç‰©ç†å¼•æ“æœåŠ¡ï¼›
- SpatialSound2DServer äºŒç»´ç©ºé—´çš„éŸ³é¢‘æœåŠ¡ï¼›
- SpatialSoundServer ä¸‰ç»´ç©ºé—´çš„éŸ³é¢‘æœåŠ¡ï¼›
- AudioServer æ‰€æœ‰éŸ³é¢‘æœåŠ¡çš„æœ€ç»ˆäºåˆæˆå™¨ï¼›

èŠ‚ç‚¹ç±»å‹æœ¬èº«ä¸åŒ…å«ç»˜å›¾é€»è¾‘ï¼Œåªæ˜¯å­˜å‚¨æ•°æ®ã€åŠŸèƒ½é€»è¾‘ä»¥åŠç”¨æˆ·äº¤å®ç°ç­‰ç­‰ã€‚å› ä¸ºèŠ‚ç‚¹ç±»å‹ä¼—å¤šï¼Œä»éŸ³é¢‘åˆ°å›¾å½¢ï¼Œ
ä»ç½‘ç»œåˆ° AI ç®—æ³•ç›¸å…³éƒ½æœ‰ï¼Œä¹Ÿå°±ä¸å¯èƒ½ç›´æ¥åœ¨èŠ‚ç‚¹ç±»å‹ä¸­ç¼–å†™ç»˜å›¾ç­‰å…·ä½“è¡Œä¸ºçš„å®ç°ä»£ç ï¼Œè¿™äº›å¤æ‚çš„ç»†èŠ‚å°†
äº¤ç”±å„ç§æœåŠ¡å™¨ç±»å‹å®ç°ã€‚

2D åœºæ™¯ä¸­ï¼Œéœ€è¦ä¸€ä¸ªç”»å¸ƒæ¥ç»˜åˆ¶æ‰€æœ‰çš„è§†è§‰å…ƒç´ ã€‚è€Œåœ¨ 3D ä¸­ï¼Œæ‰€æœ‰å¯è§å¯¹è±¡éƒ½éœ€è¦ä¸€ä¸ª scenarioï¼Œå®ƒä»£è¡¨
å¯è§†çš„ä¸‰ç»´ä¸–ç•Œï¼Œé€šè¿‡ Spatial **get_world()** æ–¹æ³•è®¿é—®ã€‚æ‰€æœ‰è§†è§‰å…ƒç´ éƒ½ä¼šç»˜åˆ¶åˆ° Viewport ä¸Šï¼Œ
å¯ä»¥å°†å…¶é™„åŠ åˆ°åœºæ™¯æ ‘ä¸Šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ¸²æŸ“å¼•æ“ **viewport_create()** æ–¹æ³•å®ä¾‹åŒ–ä¸€ä¸ª Viewport å¯¹è±¡ã€‚
ä½¿ç”¨è‡ªå®šä¹‰åœºæ™¯æˆ–è€…ç”»å¸ƒæ—¶ï¼Œé€šè¿‡ **viewport_set_scenario()**ã€**viewport_attach_canvas()** 
æ–¹æ³•å°†å®ƒä»¬é™„åŠ åˆ°è§†å£ä¸­ï¼Œ**scenario_create()** åˆ›å»ºåœºæ™¯ã€‚

æ‰€æœ‰ä¸‰ç»´å¯¹è±¡éƒ½ç”±ç›¸å…³èµ„æºå’Œå®ä¾‹ç»„æˆï¼Œå¯ä»¥æ˜¯ç½‘æ ¼ã€ç²’å­ç³»ç»Ÿã€ç¯å…‰æˆ–ä»»ä½•å…¶ä»– 3D å¯¹è±¡ã€‚æ‰€ä»¥ï¼ŒVisualServer 
å®è´¨ä¸Šå°±æ˜¯å®æ—¶çš„æ¸¸æˆæ¸²æŸ“å¼•æ“ï¼Œæœ€æ–°ç‰ˆæœ¬ Godot 4.x ä¸­ï¼Œåå­—ä¹Ÿæ”¹ä¸ºäº† **RenderingServer**ã€‚ä¸ºäº†æ¸²æŸ“ 
3D èµ„æºï¼Œå¿…é¡»è°ƒç”¨æ¸²æŸ“å¼•æ“æ–¹æ³• **instance_set_base()** å°†èµ„æºé™„åŠ åˆ°æ¸²æŸ“å¼•æ“å®ä¾‹ä¸Šï¼Œè¿˜å¿…é¡»é™„åŠ åœºæ™¯ã€‚


```py
    # Create a visual instance (for 3D).
    var instance = VisualServer.instance_create()
    # Set the scenario from the world, this ensures it
    # appears with the same objects as the scene.
    var scenario = get_world().scenario
    VisualServer.instance_set_scenario(instance, scenario)
    # Add a mesh to it.
    # Remember, keep the reference.
    mesh = load("res://mymesh.obj")
    VisualServer.instance_set_base(instance, mesh)
    # Move the mesh around.
    var xform = Transform(Basis(), Vector3(20, 100, 0))
    VisualServer.instance_set_transform(instance, xform)
```

å¼•æ“å†…éƒ¨ï¼Œæ‰€æœ‰èµ„æºéƒ½æœ‰ä¸€ä¸ª Resource ID (RID)ï¼Œæ˜¯æœåŠ¡å™¨å†…éƒ¨ä¸ºäº†ç®¡ç†èµ„æºå†…å­˜åˆ†é…å®ç°çš„å¥æŸ„ã€‚æœåŠ¡å™¨
å†…éƒ¨å‡ ä¹æ¯ä¸ªåŠŸèƒ½éƒ½éœ€è¦ RID æ¥è®¿é—®å®é™…èµ„æºã€‚å¤§å¤šæ•° Godot èŠ‚ç‚¹å’Œèµ„æºç±»å‹éƒ½åŒ…å«æ¥è‡ªæœåŠ¡å™¨å†…éƒ¨çš„ RIDï¼Œ
å®ƒä»¬å¯ä»¥é€šè¿‡ä¸åŒçš„å‡½æ•°è·å¾—ã€‚äº‹å®ä¸Šï¼Œç»§æ‰¿ Resource çš„ä»»ä½•ç±»å‹éƒ½å¯ä»¥è½¬å‹ä¸º RIDã€‚ä½†å¹¶éæ‰€æœ‰èµ„æºéƒ½åŒ…å«
RIDï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè½¬å‹å¾—åˆ°çš„ç»“æœä¸ºç©ºã€‚

- CanvasItem.get_canvas_item()
- CanvasLayer.get_canvas()
- Viewport.get_viewport_rid()


å®˜æ–¹æä¾›äº†ä¸€ä¸ª Control Gallery ç¤ºèŒƒå·¥ç¨‹ï¼Œç”¨äºæ¼”ç¤ºå„ç§æ§ä»¶ã€å¸ƒå±€å®¹å™¨çš„ä½¿ç”¨ï¼Œ2D æ§ä»¶æ”¯æŒä¸»é¢˜è®¾ç½®ï¼Œ
å®šåˆ¶æ§ä»¶å¤–è§‚éå¸¸æ–¹ä¾¿ã€‚2D å¯¹è±¡ä½¿ç”¨ Anchors æ¨¡å‹è¿›è¡Œå›¾å½¢çš„æ¯”ä¾‹ã€å¤šåˆ†è¾¨ç‡å¤„ç†ï¼š

![Size and Anchors](https://docs.godotengine.org/en/3.5/_images/anchors.png)

Godot IDE ä¸­çš„æ¯ä¸ªåœºæ™¯å°±æ˜¯ä¸€ä¸ª Node å¯¹è±¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥é™„åŠ è„šï¼Œä»¥å®ç°ç¨‹åºåŒ–æ“æ§ã€‚æ¯ä¸ªæ¸¸æˆç»“æ„å’Œ
Godot IDE æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä¸€ä¸ªåœºæ™¯æ ‘ï¼Œæ¯ä¸ªç¨‹åºä¸­å¯ä»¥æœ‰å¤šä¸ªåœºæ™¯ï¼Œä½†æ˜¯å½“å‰åœºæ™¯æ ‘ä¸­åŠ è½½çš„æ´»åŠ¨åœºæ™¯åªæœ‰
`root` èŠ‚ç‚¹åŠ è½½çš„è¿™ä¸ª SceneTreeï¼Œè¿™ä¸ªæ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ª Viewportï¼Œå¹¶ä¸”å§‹ç»ˆæ˜¯åŠ è½½çš„èŠ‚ç‚¹ï¼Œä¸å¯ä»¥å¸ä¸‹ã€‚

![Scene tree](https://docs.godotengine.org/en/3.5/_images/activescene.png)

åœ¨è¿è¡Œä¹‹å‰ï¼Œå¯ä»¥è®¾ç½®å·¥ç¨‹ï¼ŒæŒ‡å®šä¸€ä¸ªä¸»åœºæ™¯ï¼š

    Project -> Project Settings -> Application -> Run -> Main Scene

åœºæ™¯ä¸­ Viewports å°±ç›¸å½“äºä¸€ä¸ªå±å¹•ï¼Œæ¸¸æˆä¸–ç•Œçš„å†…å®¹ä¼šæŠ•å°„åˆ°è¿™é‡Œå½¢æˆå›¾åƒã€‚åœºæ™¯æ ‘é¡¶ç‚¹å°±æ˜¯ä¸€ä¸ª Viewportï¼Œ
åœ¨ Godot IDE è¿è¡Œè°ƒè¯•æ—¶ï¼Œç‚¹å¼€ Scene é¢æ¿ä¸­çš„ Remote æ ç›®å³å¯ä»¥æŸ¥çœ‹è¿è¡Œä¸­çš„é¡¶å±‚èŠ‚ç‚¹ï¼Œåº”ç”¨è¿è¡Œæ—¶ï¼Œ
å®ƒæ€»æ˜¯å¤„äºåŠ è½½çŠ¶æ€ï¼Œè€Œä¸”ä¸å¯ä»¥æ‰‹åŠ¨æ¸…é™¤ã€‚

åœ¨ 3D åœºæ™¯ä¸­ï¼Œç”¨ä¸€ä¸ª Viewport èŠ‚ç‚¹è£…è½½ 2D èŠ‚ç‚¹ï¼Œç„¶åå°† Viewport çš„çº¹ç†å›¾åƒä½œä¸º 3D åœºæ™¯å¯¹è±¡çš„
æè´¨è´´å›¾ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ç§å¸¸ç”¨çš„ 3D è¡¨ç° 2D å†…å®¹çš„æ‰‹æ®µã€‚æ³¨æ„ï¼ŒViewport çš„å°ºå¯¸è¦è¶³å¤Ÿå®¹çº³ 2D å†…å®¹ï¼Œå¦‚æœ
2D èŠ‚ç‚¹ä½ç½®è¶…å‡º Viewport çš„å°ºå¯¸ï¼Œåˆ™å†…å®¹ä¼šè¢«è£å‰ªæ‰ã€‚å¦å¤–ï¼Œå¦‚æœå†…å®¹å‡ºç°ä¸Šä¸‹é¢ å€’ï¼Œå¯ä»¥è®¾ç½® Reander
Target - V Flip è¿›è¡Œä¸€æ¬¡ç«–ç›´æ–¹å‘çš„åè½¬å³å¯ä»¥è§£å†³ã€‚

Viewport å¯ä»¥è®¾ç½®èƒŒæ™¯é€æ˜ï¼Œèµ‹å€¼ç»™ SpatialMaterial æè´¨çš„ Albedo ä½œä¸ºè¡¨é¢åå°„è‰²ï¼Œéœ€è¦å¯ç”¨æè´¨
çš„é€æ˜åŠŸèƒ½ï¼ŒFlags -> Transparentï¼Œå¦åˆ™å¸¦ Alpha é€šé“çš„è´´å›¾ä¼šå‡ºç°é»‘è‰²å—ã€‚è®¾ç½® 

Viewport å¯ä»¥è£…å…¥ ViewportContainer è¿™ä¸ªç‰¹æ®Šå®¹å™¨ï¼Œä¸”åªåŒ…å«ä¸€ä¸ª Viewport å­èŠ‚ç‚¹ï¼Œç”¨æ¥æ˜¾ç¤ºå›¾åƒï¼Œ
æ–¹ä¾¿åœ¨ç¼–è¾‘å™¨ä¸­è§‚å¯Ÿå›¾åƒè¾“å‡ºæ•ˆæœï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥æ˜¾ç¤ºå¤šä¸ªè§†å›¾å›¾åƒè¾“å‡ºã€‚


åœ¨è®¡ç®—æœºæ¨¡æ‹Ÿçš„ä¸–ç•Œä¸­ï¼Œéœ€è¦è™šæ„ä¸€å°ç”¨äºæˆåƒçš„ç›¸æœºï¼Œç›®çš„æ˜¯æ¨¡æ‹Ÿäººçš„çœ¼çœ¼æ‰€çœ‹åˆ°çš„ä¸–ç•Œã€‚è§†ç•Œä¸­çš„å…‰çº¿å…¥å°„
åˆ°è§†ç½‘è†œå½¢æˆå›¾åƒï¼Œåœ¨æ¨¡æ‹Ÿä¸–ç•Œä¸­çš„æˆåƒç”¨ Viewport è¿™ä¸ªæ¦‚å¿µè¡¨ç¤ºï¼Œå…‰çº¿ä»è¿œå¤„é€è¿‡è§†å£ï¼Œåˆ°è¾¾ç›¸æœºçš„ä½ç½®ï¼Œ
å°±æ˜¯ä¸€ä¸ªåæ ‡ç‚¹ï¼Œè€Œå…‰çº¿ä¸è§†å£å¹³é¢ç›¸äº¤çš„ç‚¹å°±å¯¹åº”ä¸€ä¸ªåƒç´ ã€‚é€šè¿‡è°ƒæ•´ç›¸æœºçš„å‚æ•°ï¼Œä¾‹å¦‚æ”¹å˜è§†åŸŸ FOV å°±å¯ä»¥
æ”¹å˜æˆåƒç»“æœã€‚è€Œè§†å£åˆå¯ä»¥å†è¿›è¡Œå‡ ä½•å˜æ¢ï¼Œä»¥æ§åˆ¶å›¾åƒçš„æ¸²æŸ“ã€‚

![From "Ray tracing" on Wikipedia](https://jamie-wong.com/images/16-07-11/raytrace.png)

æè´¨è®¾ç½®å¯ä»¥ä½¿ç”¨ **SpatialMaterial**ï¼Œé€‚å½“è°ƒæ•´è´´å›¾ UV1 åæ ‡ç»½æ”¾ã€åç§»ï¼Œä½¿ç”¨çº¹ç†é€‚åˆäºæ¨¡å‹è¡¨é¢ã€‚
Godot æ”¯æŒæ¯ä¸ªæè´¨ä½¿ç”¨ä¸¤ä¸ª UV é€šé“ï¼Œæ¬¡çº§çš„ UV2 é€šå¸¸ç”¨äºç¯å¢ƒå…‰é®æŒ¡æˆ–å‘å°„ï¼ˆçƒ˜ç„™å…‰ï¼‰ã€‚è®¾ç½® Triplanar
å¯ç”¨ Triplanar Mappingï¼Œåœ¨ä½¿ç”¨é‡å¤çº¹ç†æ—¶éå¸¸æœ‰ç”¨ã€‚

åœ¨ 2D åœºæ™¯ä¸­ä½¿ç”¨ 3D åœºæ™¯ä¹Ÿæ˜¯ç±»ä¼¼çš„æ€è·¯ï¼Œåªè¿‡ä¸åè¿‡æ¥ï¼Œå°† Viewport ä¸­çš„çº¹ç†å›¾åƒè®¾ç½®åˆ° 2D èŠ‚ç‚¹çš„
çº¹ç†å±æ€§ä¸Šï¼Œå¦‚ Sprite æˆ– TextureRect ç­‰èŠ‚ç‚¹éƒ½å¯ä»¥æŒ‡å®š ViewportTexture ä»¥ä½¿ç”¨ 3D åœºæ™¯äº§ç”Ÿçš„
çº¹ç†å›¾åƒã€‚æ³¨æ„ï¼Œè¦å¾—åˆ° 3D åœºæ™¯çš„å›¾åƒï¼Œå¿…éœ€è®¾ç½® Cameraï¼Œå› ä¸ºéœ€è¦ç¡®å®ä¸–ç•Œç©ºé—´çš„æŠ•å½±å…³ç³»æ‰èƒ½å¾—åˆ°ç›¸åº”
çš„å¹³é¢å›¾åƒï¼Œè¿™ä¸€ç‚¹å’Œ 2D æœ‰äº›å·®åˆ«ã€‚ä¸º 3D èŠ‚ç‚¹æè´¨æŒ‡å®šçº¹ç†è´´å›¾æ—¶ï¼Œå¦‚æ¼«åå°„çº¹ç† Albedo Textureï¼Œ
éœ€è¦å¼€å¯ resource_local_to_scene é€‰é¡¹ï¼Œå¯¹åº”æè´¨é¢æ¿çš„ Resource -> Local To Scene é€‰é¡¹ã€‚

å¯ä»¥å‚è€ƒå®˜æ–¹ç¤ºèŒƒé¡¹ç›®ï¼ŒDynamic Split Screen Demo æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Viewports åœ¨åŒä¸€ä¸ªæ˜¾ç¤ºå™¨ä¸­
æ˜¾ç¤ºä¸¤ä¸ªç©å®¶çš„ç‹¬ç«‹æ‘„åƒæœºè§†å£ï¼Œä½¿ç”¨äº†ç€è‰²å™¨ç¨‹åºï¼Œæœ‰ä¸€å®šçš„å¤æ‚åº¦ã€‚


å½“ä¸€ä¸ªèŠ‚ç‚¹è¿æ¥åˆ° Root Viewportï¼Œå®ƒå°±æˆä¸ºåœºæ™¯æ ‘ä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œæœ€åèŠ‚ç‚¹è¢«ç§»é™¤ï¼Œè¿‡ç¨‹ä¼šè§¦å‘ç³»åˆ—å›è°ƒæ–¹æ³•ï¼š

```py
_enter_tree() 
_ready() 
_process(delta) 
_exit_tree()
```

èŠ‚ç‚¹æ ‘æ‰€æœ‰èŠ‚ç‚¹ä¼šæŒ‰ä½ç½®å…ˆåã€ç”±è¡¨å±‚åˆ°å†…å±‚ä¾æ¬¡æ‰§è¡Œ enter_tree æ–¹æ³•ï¼Œè€Œ ready å’Œ exit_tree æ–¹æ³•ï¼Œ
åˆ™ä¸åŒï¼Œä¼šå…ˆç”±å†…å±‚åˆ°å¤–å±‚çš„é¡ºåºæ‰§è¡Œï¼Œçˆ¶çº§èŠ‚ç‚¹éœ€è¦ç­‰å¾…å†…å±‚èŠ‚ç‚¹å·¥ä½œå®Œæˆæ‰èƒ½æ‰§è¡Œ ready ç­‰åŠ¨ä½œã€‚
èŠ‚ç‚¹ä»éæ´»è·ƒçŠ¶æ€è½¬å˜ä¸ºæ´»è·ƒçŠ¶æ€ï¼Œæ­¤æ—¶æ‰ä¼šå¤„ç†æ‰€æœ‰ç¨‹åºé€»è¾‘ï¼ŒåŒ…æ‹¬ç”¨æˆ·è¾“å…¥ã€ä¿¡å·ã€æ¶ˆæ¯å¤„ç†ï¼Œæ’­æ”¾å£°éŸ³ç­‰ã€‚

èŠ‚ç‚¹æä¾›äº†ä¸€ä¸ª request_ready() æ–¹æ³•ç”¨äºè¯·æ±‚å†æ¬¡æ‰§è¡Œ `_ready()` å›è°ƒï¼Œç”±äºåœºæ™¯æ ‘ä¸­æ˜¯ååºéå†æ¥
æ‰§è¡Œè¿™ä¸ªå›è°ƒçš„ï¼Œå½“éœ€è¦åœ¨é¡¶çº§èŠ‚ç‚¹æ‰§è¡Œå®Œåå†ç´§æ¥è¿›è¡Œå…¶å®ƒä»»åŠ¡ï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ©ç”¨ ready ä¿¡å·å’Œ yield æ–¹æ³•ï¼Œ
é€šè¿‡ yield(root, "ready")ï¼Œå¯ä»¥ç­‰å¾…é¡¶çº§èŠ‚ç‚¹å®Œæˆåå†æ‰§è¡Œ yield åç»­çš„ä»£ç ã€‚


å®Œæˆåˆå§‹åŒ–åå°±ä¼šè¿›å…¥å¾ªç¯å¤„ç†ï¼ŒGodot æ¯å¸§æ‰€èŠ±é”€çš„è®¡ç®—æ—¶é—´ä¼šé€šè¿‡ delta å€¼ä¼ é€’åˆ°å›è°ƒå‡½æ•°ä¸­ã€‚å½“è®¡ç®—
é‡å¤§æ—¶ï¼Œdelta å€¼å¯èƒ½ä¼šå¢åŠ ï¼Œè¿™æ„å‘³ç€ FPS ä¼šä¸‹é™ã€‚ä½†æ˜¯ï¼Œphysics process å›è°ƒä¸­æ¥æ”¶åˆ°çš„ delta
å€¼æ˜¯ä¸€ä¸ªæ’å®šå€¼ï¼Œå› ä¸ºç‰©ç†å¼•æ“éœ€è¦ä¸€ä¸ªç²¾ç¡®çš„æ—¶é—´ä»¥è¿›è¡Œæ¨¡æ‹Ÿä¸–ç•Œä¸­çš„ç‰©ç†è®¡ç®—ã€‚

é€šå¸¸è®¡ç®—å±æ€§å€¼éœ€è¦ä¸ delta ç›¸ä¹˜ï¼Œä½¿ç”¨å…¶ä¸æ—¶é—´å…³è”ï¼Œè€Œä¸æ˜¯ä¾èµ– FPS çš„å˜åŒ–ã€‚

ä½¿ç”¨ loadã€preload æ–¹æ³•åŠ è½½åœºæ™¯æ–‡ä»¶å¾—åˆ° **PackedScene**ï¼Œä¼ é€’ç»™ change_scene_to() æ–¹æ³•å°±
å¯ä»¥åˆ‡æ¢åœºæ™¯ï¼ŒåŸåœºæ™¯å†…å®¹å°±ä¼šå¸è½½æ‰ã€‚ä½¿ç”¨ change_scene() æ–¹æ³•åˆ‡æ¢åœºæ™¯ç›´æ¥ä½¿ç”¨ res:// æŒ‡å®šåœºæ™¯æ–‡ä»¶ã€‚

```py
# Methods
Error change_scene(path: String)

Error change_scene_to(packed_scene: PackedScene)

# Properties
Viewport root 
         get_root() getter

    Node current_scene
         set_current_scene(value) setter
         get_current_scene() getter
```

åœºæ™¯å¯ä»¥ä½¿ç”¨ change æ–¹æ³•è¿›è¡Œåˆ‡æ¢ï¼Œè¿™ä¼šè§¦å‘åŸåœºæ™¯æ‰€æœ‰èŠ‚ç‚¹å¸è½½åŠ¨ä½œï¼Œä¹Ÿå¯ä»¥å°†åœºæ™¯ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹å®ä¾‹ï¼Œ
å†é™„åŠ åˆ°å½“å‰æ´»åŠ¨çš„åœºæ™¯æ ‘ä¸­ï¼Œè¿™ä¸ä¼šè§¦å‘èŠ‚ç‚¹å¸è½½è¡Œä¸ºã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µæ¼”ç¤ºäº†èŠ‚ç‚¹ä¸èŠ‚ç‚¹æ ‘è¿æ¥çš„äº‹ä»¶æµç¨‹ï¼Œ
ä»¥åŠé€šè¿‡ load() æ–¹æ³•åŠ è½½åœºæ™¯ï¼Œå¹¶ä½œä¸ºèŠ‚ç‚¹åŠ è½½å®ƒï¼š

```py
extends CanvasItem

onready var list = $"/root/Node2D/ItemList"

func _enter_tree():
    print(self.name, " _enter_tree")
    if list != null:
        list.add_item(self.name + " _enter_tree")

func _ready():
    print(self.name, " _ready")
    list.add_item(self.name + " _ready")

func _exit_tree():
    print(self.name, " _exit_tree")
    list.add_item(self.name + " _exit_tree")

func _on_Button_pressed():
    print(self.name, " pressed")
    list.add_item(self.name + " pressed")
    
    scene_change()
    #self.queue_free()

func scene_change():
    # change sence
    var cover = load("res://L1 Scene Tree/cover.tscn")
    #get_tree().change_scene_to(cover)
    #get_tree().change_scene("res://L1 Scene Tree/cover.tscn")
    
    # sence as node
    var acover: Node2D = cover.instance()
    print("button: ",self)
    var child = acover.get_child(0) as Control
    #acover.position = get_local_mouse_position() 
    acover.position = get_global_mouse_position()  - child.rect_size / 2
    get_node("/root").add_child(acover)
    list.add_item("Load a scene as a node")
    
    var tween:SceneTreeTween = create_tween().set_trans(Tween.TRANS_ELASTIC)
    tween.tween_property(acover, "modulate", Color.red, 2)
    tween.tween_callback(acover, "queue_free")
```

æ‰€æœ‰ **Control** å­ç±»è€…éƒ½å…·æœ‰ mouse_filter å±æ€§ï¼Œå°†å…¶è®¾ç½®ä¸º MOUSE_FILTER_STOP å°±å¯ä»¥é˜»æŒ¡
é¼ æ ‡äº‹ä»¶ç©¿é€åˆ°åé¢çš„å¯¹è±¡ä¸Šï¼Œç”¨æ¥é¿å…åœ¨æŸäº›æƒ…å½¢ä¸‹ä¸ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚é…åˆ **SceneTreeTween** å¯ä»¥
åˆ›å»ºè½¬åœºåŠ¨ç”»æ•ˆæœã€‚


åœ¨èŠ‚ç‚¹çš„è„šæœ¬ä¸­ï¼Œä½¿ç”¨ get_tree() æ–¹æ³•è·å–åœºæ™¯æ ‘å¼•ç”¨ï¼Œè¦è·å–å…¶å®ƒèŠ‚ç‚¹å¼•ç”¨åˆ™ä½¿ç”¨ get_node() æ–¹æ³•ã€‚
è¿™ä¸ªæ–¹æ³•å¯ä»¥ç®€å†™ä¸º $ï¼Œå¦‚ $"/root"ï¼Œåˆå¦‚ $SomeNode ç­‰ä»·äº get_node("SomeNode")ã€‚è¿˜æœ‰ä¸€ä¸ª
æ›´æ–¹ä¾¿çš„æ–¹æ³•åˆ›å»ºèŠ‚ç‚¹å¼•ç”¨ï¼Œåªéœ€è¦åœ¨ Scene èŠ‚ç‚¹åˆ—è¡¨ä¸­æ‹–åŠ¨èŠ‚ç‚¹åˆ°è„šæœ¬ä¸­å³å¯è‡ªåŠ¨ç”Ÿæˆå¼•ç”¨ï¼ŒæŒ‰ Ctrl æ‹–æ”¾
æ—¶è¿˜å¯ä»¥ç”Ÿæˆ onready å¼•ç”¨ï¼š

```py
SceneTree get_tree() const
Node get_node(path: NodePath) const
```

å‚æ•°ä¸­çš„ **NodePath** æ˜¯ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œæ ¹èŠ‚ç‚¹ /root å§‹ç»ˆæ˜¯åŒä¸€ä¸ªé¡¶çº§çš„ Viewportã€‚
å¯ä»¥ä½¿ç”¨ç‚¹æˆ–ä¸¤ç‚¹è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä½ç½®å’Œçˆ¶çº§ä½ç½®ï¼Œé™¤äº†ä½¿ç”¨ / å¼€å¤´è¡¨ç¤ºç»å¯¹è·¯å¾„ï¼Œå…¶å®ƒè·¯å¾„éƒ½ç›¸å¯¹å½“å‰èŠ‚ç‚¹ï¼š

```py
get_node(".")
get_node("..")
get_node("Backpack/Dagger")
get_node("../Swamp/Alligator")
get_node("/root/MyGame")
```

è™½ç„¶å½“å‰æ´»åŠ¨åœºæ™¯æ ‘åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ Godot çš„è‡ªåŠ¨åŠ è½½åŠŸèƒ½ï¼Œå·¥ç¨‹é…ç½® AutoLoad æ ç›®ä¸­è®¾ç½®ï¼Œ
å¯ä»¥å®ç°å°†å…¶å®ƒåœºæ™¯ã€æˆ–è€…è„šæœ¬åŠ è½½åˆ°å…¨å±€ç©ºé—´è¿è¡Œï¼Œä¾‹å¦‚èƒŒæ™¯éŸ³ä¹éœ€è¦é¿å…è½¬åœºä¸­æ–­ï¼Œå¯ä»¥åœ¨è‡ªåŠ¨åŠ è½½åœºæ™¯ä¸­
æ’­æ”¾ BGM å³å¯ä»¥è§£å†³ã€‚


å¯ä»¥æ¿€æ´» Scene Unique Nodes æ¨¡å¼ï¼Œåœ¨èŠ‚ç‚¹å³é”®èœå•ä¸­ï¼Œè¿™æ ·å°±åœ¨åŸèŠ‚ç‚¹åå‰ç¼€ % å·ä½œä¸ºå”¯ä¸€åç§°æ¥è®¿é—®å®ƒã€‚
ä½¿ç”¨æ‹–åŠ¨çš„æ–¹å¼ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†èŠ‚ç‚¹ä»åœºæ™¯æ ‘ä¸­æ‹–æ”¾åˆ°è„šæœ¬ä¸­ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆå¼•ç”¨ï¼ŒæŒ‰ä¸‹ Ctrl ç”Ÿæˆå¼•ç”¨ç±»ä¼¼å¦‚ä¸‹ï¼š

    onready var label = $"%Label"

Godot å·¥ç¨‹ä¸­çš„è„šæœ¬æ–‡ä»¶æˆ–è€…åœºæ™¯æ–‡ä»¶éƒ½æ˜¯ä¸€ç§èµ„æºç±»å‹ Resourceï¼Œä½¿ç”¨ load æˆ– preload æ–¹æ³•åŠ è½½ï¼Œ
æ ¹æ®ä¸åŒçš„æ–‡ä»¶è¿”å›çš„å„ç§å­ç±»å‹ï¼Œå°±åœºæ™¯èµ„æºå’Œè„šæœ¬è€Œè¨€ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ PackedScene å’Œ GDScript ç±»å‹ã€‚
å¹¶ä¸”ï¼Œèµ„æºç±»å‹ä¸åŒï¼Œå®ä¾‹åŒ–æ–¹æ³•ä¹Ÿä¸åŒã€‚

å¯¹äºåœºæ™¯ï¼Œä½¿ç”¨ instance() æ–¹æ³•å®ä¾‹åŒ–ï¼Œè¿”å›çš„ç±»å‹å°±æ˜¯ Nodeï¼Œæ‰“å°æ—¶ä¼šå°†åœºæ™¯æ ¹èŠ‚ç‚¹çš„åç§°å’Œçˆ¶ç±»å‹ä¿¡æ¯ï¼Œ
å¦‚ RootNode:[Node2D:724501] è¿™æ ·çš„æ ¼å¼ã€‚è€Œè„šæœ¬èµ„æºçš„å®ä¾‹åŒ–å°±æ˜¯ä½¿ç”¨è„šæœ¬ä¸­é€šç”¨çš„ new() æ–¹æ³•ï¼Œè¿”å›
çš„ç±»å‹å°±æ˜¯ extends ç»§æ‰¿çš„ç±»å‹ï¼Œå› ä¸ºä¸åƒåœºæ™¯é‚£æ ·æœ‰èŠ‚ç‚¹æ ‘ï¼Œæ‰€ä»¥æ‰“å°è„šæœ¬ç±»å‹ä¿¡æ¯ä¸­åªæ˜¾ç¤ºäº†çˆ¶ç±»ä¿¡æ¯ã€‚
å¦‚æœæŒ‡å®šäº† class_nameï¼Œè¿™ä¸ªè„šæœ¬çš„ç±»å‹å°±æ˜¯å‘½åçš„ç±»å‹ï¼Œä¼šåœ¨ç±»å‹åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚

åŸºç±»æ–¹æ³• Object get_class() ç”¨æ¥è·å–å¯¹è±¡çš„ç±»å‹ï¼Œè¿™ä¸ªæ–¹æ³•ä¸è€ƒè™‘è„šæœ¬ä¸­é€šè¿‡ class_name å®šä¹‰çš„ç±»å‹ï¼Œ
è€Œæ˜¯è·å–å¼•æ“ C++ å†…éƒ¨å®šä¹‰çš„ç±»å‹ï¼Œç±»ä¼¼åœ°ï¼Œis_class() æ–¹æ³•åˆ¤æ–­çš„ä¹Ÿæ˜¯å†…éƒ¨ç±»å‹ã€‚å†…éƒ¨ç±»ç±»å‹ä¿¡æ¯è®°å½•åœ¨
**ClassDB** è¿™ä¸ªä¿¡æ¯ç±»ä¸­ï¼Œé€šè¿‡ **get_class_list()** æ–¹æ³•å¯ä»¥æŸ¥è¯¢å¼•æ“ç°æœ‰çš„ç±»å‹åˆ—è¡¨ã€‚

æœ‰è¶£çš„æ˜¯ Godot åŸºäºèŠ‚ç‚¹åŒ–çš„ç¼–ç¨‹æ€ç»´ä¸­ï¼ŒèŠ‚ç‚¹åªæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œè€Œå°†è„šæœ¬ç»‘å®šåˆ°èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå°±ä½¿å¾—èŠ‚ç‚¹
æ‹¥æœ‰äº†äº¤äº’çš„èƒ½åŠ›ã€‚è„šæœ¬é™„åŠ åˆ°èŠ‚ç‚¹åï¼Œæ­¤æ—¶ **self** å…³é”®å­—æ—¢å¼•ç”¨äº†ç±»å®ä¾‹ï¼Œåˆå¼•ç”¨åœºæ™¯æ ‘ä¸­çš„èŠ‚ç‚¹ã€‚åšç±»å‹
åˆ¤æ–­æ—¶ï¼Œå¦‚ is å…³é”®å­—ï¼Œåˆ¤æ–­çš„æ˜¯å¼•æ“ C++ å†…éƒ¨å®ç°çš„ç±»å‹ï¼Œæˆ–è€…è„šæœ¬å®šä¹‰ç±»å‹ã€‚å°½ç®¡åœºæ™¯ä¹Ÿå¯ä»¥ç»§æ‰¿å…¶å®ƒåœºæ™¯ï¼Œ
ä½†æ˜¯è¿™ä»…ä»…æ˜¯å¤ç”¨èŠ‚ç‚¹æ ‘ç»“æ„çš„ä¸€ç§æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ç¼–ç¨‹è¯­è¨€çš„ç±»å‹ç³»ç»Ÿçš„ç»§æ‰¿ã€‚

GDScript è„šæœ¬ä½¿ç”¨å•ç»§æ‰¿ï¼Œæ¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç±»å‹å®šä¹‰ï¼Œå½“ç„¶å¯ä»¥å®šä¹‰å†…éƒ¨ç±»ç±»ã€‚è¿™ç§ç»“åˆäº†èŠ‚ç‚¹çš„ 
Object-Oriented Programming (OOP) ç¼–ç¨‹è¯­è¨€çœŸçš„å¾ˆç‰¹åˆ«ï¼Œçœç•¥äº†å¤æ‚ OOP è§„åˆ™ï¼Œæ²¡æœ‰äº† C++ ä¸­çš„
Privateã€Protectedã€Public è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œè¯­æ³•ç»“æ„ä½¿ç”¨ Python é£æ ¼ï¼Œè„šæœ¬ä¸­å®šä¹‰çš„å˜é‡å°±æ˜¯ç±»æˆå‘˜ï¼Œ
å…·ä½“è®¿é—®è§„åˆ™ç”±å¼€å‘è€…è‡ªè¡ŒæŠŠæ¡ï¼Œé€šè¿‡ setget å¯ä»¥æ§åˆ¶æˆå‘˜çš„è¯»å†™é€»è¾‘ã€‚ä½¿ç”¨è„šæœ¬èƒ½å¿«é€Ÿè¿­ä»£å¼€å‘äº§å“ï¼Œåªåœ¨
é‡åˆ°æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œæ‰è€ƒè™‘å°†è„šæœ¬è¿ç§»ä¸º C/C++ ç­‰é«˜æ•ˆçš„è¯­è¨€å®ç°ï¼š

```py
tool

# BasicScene defined in L0 Basic Guide/entry.gd
extends BasicScene

# (optional) class definition with a custom icon
class_name SceneL8, "res://icon.png"

const tscn = preload("res://L0 Basic Guide/entry.tscn") # class PackedScene
const gd   = preload("res://L0 Basic Guide/entry.gd")   # class GDScript

func _ready():
    
    print("basic scene ", tscn, tscn.instance())
    print("basic script ", gd, gd.new())

    var scene = get_tree().current_scene
    print(self, " current_scene ", scene, " is instacne of gd? ", self is gd)

    print("note ", Something.new().note)
    print("NOTE ", Something.NOTE)
    print("enum ", Something.UNIT_ALLY, Something.Named.ANOTHER_THING)

# Inner class

class Something:
    # Member variables
    var note = "This is InnerClass."

    # Constants
    const NOTE = "This is a constant."

    # Enums
    enum { UNIT_NEUTRAL, UNIT_ENEMY, UNIT_ALLY}
    enum Named {THING_1, THING_2, ANOTHER_THING = -1}
```



## ğŸŸ¡ Project Settings é¡¹ç›®é…ç½®
- [Multiple resolutions](https://docs.godotengine.org/en/3.5/tutorials/rendering/multiple_resolutions.html)
- [Setting up the project](https://docs.godotengine.org/en/3.5/getting_started/first_2d_game/01.project_setup.html)

Godot é¡¹ç›®è®¾ç½®ä¸­ display/window/stretch/mode æ‹‰ä¼¸æ¨¡å¼ä¼šå½±å“ç”»é¢çš„å‘ˆç°ï¼š

å¦‚æœè®¾ç½® Stretch Mode = Viewport æ„å‘³ç€å°†æ ¹è§†å£çš„å¤§å°ç²¾ç¡®è®¾ç½®ä¸ºâ€œé¡¹ç›®è®¾ç½® Display é…ç½®ä¸­æŒ‡å®š
çš„åŸºæœ¬å¤§å°ã€‚è°ƒæ•´çª—å£å¤§å°æ—¶ï¼Œä¼šç¼©æ”¾æ­¤è§†å£ä»¥é€‚åˆå±å¹•ï¼Œé™¤éè®¾ç½®äº†ä¿ç•™å®½é«˜æ¯”ä¸º Stretch Aspect = keepã€‚
ä½¿ç”¨åƒç´ ç²¾åº¦æ¸¸æˆæ—¶ï¼Œæˆ–è€…ä¸ºäº†æ¸²æŸ“åˆ°è¾ƒä½çš„åˆ†è¾¨ç‡ä»¥æé«˜æ€§èƒ½ï¼Œæ­¤æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚è®¾ç½® 2D ä¼¸å±•æ¨¡å¼ï¼Œåˆ™å¯ä»¥ä¿æŒ
å›¾åƒåœ¨ä¸åŒæ˜¾ç¤ºå±å¹•ä¸‹å¸ƒå±€ç¼©æ”¾çš„ä¸€è‡´æ€§ã€‚

![Stretch Mode](https://docs.godotengine.org/en/3.5/_images/stretch.png)


åœ¨é«˜åˆ†å±è®¾å¤‡ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿä¼šè®¤ä¸º Godot é¡¹ç›®æ˜¯ DPI æ— å…³çš„ã€‚å› ä¸ºæ“ä½œç³»ç»Ÿçš„ DPI å›é€€ç¼©æ”¾
æ¯”åº”ç”¨ç¨‹åºå†…åšç¼©æ”¾è¦å¿«å¾ˆå¤šï¼Œå³ä¾¿ä½¿ç”¨ viewport æ‹‰ä¼¸æ¨¡å¼ï¼Œæ‰€ä»¥è¿™æ ·åšå¯ä»¥æé«˜åœ¨ä½ç«¯ç³»ç»Ÿä¸Šçš„æ€§èƒ½ã€‚

ä¸è¿‡æ“ä½œç³»ç»Ÿçš„ DPI å›é€€ç¼©æ”¾åŠŸèƒ½åœ¨å…¨å±æ¨¡å¼ä¸‹å¹¶ä¸å¥½ç”¨ã€‚å¦‚æœä½ æƒ³åœ¨ hiDPI æ˜¾ç¤ºå™¨ä¸‹å¾—åˆ°æ¸…æ™°çš„ç”»é¢ï¼Œåˆ
æˆ–è€…æƒ³è¦æ”¯æŒå…¨å±ï¼Œé‚£ä¹ˆæ¨èå¯ç”¨é¡¹ç›®è®¾ç½®ä¸­çš„ Display > Window > Dpi > Allow Hidpi ä»¥è·å¾—é«˜æ¸…
ç”»é¢ã€‚å¦åˆ™ï¼Œå¯èƒ½åœ¨é«˜åˆ†å±å¹•ä¸Šçœ‹åˆ°åƒç´ åŒ–çš„ç”»é¢ï¼Œè¿™æ˜¯å› ä¸ºåƒç´ éƒ½æŒ‰ DPI æ¯”ä¾‹ç¼©æ”¾äº†ã€‚

Godot 4.x ä¸­éœ€è¦å¯ç”¨ Advanced Settings æ‰å¯ä»¥è®¾ç½® hiDPI é€‰é¡¹ã€‚

æ³¨æ„ï¼ŒAllow Hidpi é€‰é¡¹ä»…åœ¨ Windows å’Œ macOS ä¸Šæœ‰æ•ˆï¼Œå…¶å®ƒå¹³å°ä¼šå¿½ç•¥è¿™ä¸ªé€‰é¡¹ã€‚

Godot IDE æœ¬èº«æ˜¯æ‰“å¼€è¿™ä¸ªé€‰é¡¹çš„ï¼Œä¸ DPI ç›¸å…³çš„ï¼Œå¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®ç¼©æ”¾æ¯”ä¾‹ï¼Œé«˜åˆ†å±é»˜è®¤ä¸º 200%ã€‚
åœ¨ç¼–è¾‘å™¨ä¸­è¿è¡Œé¡¹ç›®æ—¶ï¼Œåªæœ‰åœ¨é¡¹ç›®è®¾ç½®é‡Œå¯ç”¨ Allow Hidpi æ‰ä¼šè®©é¡¹ç›®ä¸ DPI ç›¸å…³ã€‚

Godot å°šæœªæ”¯æŒæ‰‹åŠ¨è®¾ç½® 2D ç¼©æ”¾æ¯”ä¾‹ï¼Œæ‰€ä»¥æ— æ³•åœ¨éæ¸¸æˆåº”ç”¨ä¸­æ”¯æŒ hiDPIã€‚å› æ­¤ï¼Œæ¨èä¸ºéæ¸¸æˆåº”ç”¨ç¦ç”¨
Allow Hidpi é€‰é¡¹ï¼Œæ“ä½œç³»ç»Ÿä¼šå›é€€åˆ°ä½ DPIã€‚

é«˜åˆ†å±ç³»ç»Ÿä¸­ï¼Œè¿˜å¯èƒ½å‡ºç°è°ƒè¯•æ¸¸æˆæ—¶ï¼Œåœ¨æ²¡æœ‰å¯ç”¨ hiDPI æ—¶ï¼Œçª—å£ä½ç½®è¶…å‡ºå³ä¸‹è§’çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µå¯ä»¥é€šè¿‡
ä¿®æ”¹ç¼–è¾‘å™¨é…ç½® run/window_placement æ”¹å˜çª—å£ä½ç½®ï¼Œé»˜è®¤æ˜¯å±…ä¸­ï¼Œæ˜¯å¯ç”¨é«˜åˆ†å±æ”¯æŒå°±æ²¡æœ‰é—®é¢˜ã€‚


è™½ç„¶å½“å‰æ´»åŠ¨åœºæ™¯æ ‘åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨ Godot çš„è‡ªåŠ¨åŠ è½½åŠŸèƒ½ï¼Œå·¥ç¨‹é…ç½® AutoLoad æ ç›®ä¸­è®¾ç½®ï¼Œ
å¯ä»¥å®ç°å°†å…¶å®ƒåœºæ™¯ã€æˆ–è€…è„šæœ¬åŠ è½½åˆ°å…¨å±€ç©ºé—´è¿è¡Œï¼Œä¾‹å¦‚èƒŒæ™¯éŸ³ä¹éœ€è¦é¿å…è½¬åœºä¸­æ–­ï¼Œå¯ä»¥åœ¨è‡ªåŠ¨åŠ è½½åœºæ™¯ä¸­
æ’­æ”¾ BGM å³å¯ä»¥è§£å†³ã€‚

Godot å…¨å±€ç©ºé—´ @GDScript å’Œ @GlobalScope åŒ…å«æ‰€æœ‰è„šæœ¬ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å‡½æ•°ï¼Œç”¨æˆ·è¦å‘å…¨å±€ç©ºé—´
æ·»åŠ å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨å·¥ç¨‹è®¾ç½®è‡ªåŠ¨åŠ è½½ï¼ŒSingletons (AutoLoad)ï¼Œè‡ªåŠ¨åŠ è½½å¾—åˆ°ä½äºå…¨å±€ç©ºé—´çš„å•æ€å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œå°†ä»¥ä¸‹è„šæœ¬ä¿å­˜åˆ° Global.gdï¼Œå¹¶è®¾ç½®å·¥ç¨‹çš„ AutoLoad åŠ è½½å®ƒï¼Œå³å¯ä»¥å®ç°è‡ªåŠ¨å‰§ä¸­çª—å£ã€‚è¿è¡Œç¨‹åº
æ—¶ï¼Œå¼•æ“å°†åŠ è½½å¹¶é™„ç€ GlobalNS åˆ°åœºæ™¯æ ‘ä¸Šï¼Œåˆå§‹åŒ–æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼š

```py
extends Node

class_name GlobalNS

func _init():
    print("Global.gd _init")
    # Center window on screen
    var screen_size = OS.get_screen_size(OS.get_current_screen())
    var window_size = OS.get_window_size()
    var centered_pos = (screen_size - window_size) / 2
    OS.set_window_position(centered_pos)
```

VSync å‚ç›´åŒæ­¥ä¿¡å·ï¼Œåˆç§°åœºåŒæ­¥ï¼Œæ˜¾ç¤ºå™¨å®Œæ•´æ˜¾ç¤ºä¸€ä¸ªç”»é¢æ—¶äº§ç”Ÿçš„ä¸€ä¸ªåŒæ­¥ä¿¡å·ï¼Œå¯ç”¨äºå’Œ GPU åä½œç”¨é€”ã€‚
åœ¨æ—§å¼çš„ Cathode Ray Tube (CRT) é˜´æå°„çº¿æ˜¾åƒç®¡å¼æ˜¾ç¤ºä¸­ï¼Œä¸€å¹…ç”»é¢çš„æ˜¾ç¤ºéœ€è¦ç”µå­æªä»å·¦åˆ°å³ï¼Œä»ä¸Š
åˆ°ä¸‹ï¼Œå®Œæ•´åœ°æ‰«æä¸€éæ˜¾ç¤ºå±æ‰ç®—å®Œæˆï¼Œç”µå­æªç”±é«˜å‹ç”µé©±åŠ¨å‘å°„ç”µå­æŸå‡»æ‰“å±å¹•ä¸Šçš„è§å…‰ç‚¹æ˜¾ç¤ºç›¸åº”çš„å›¾åƒã€‚

æ¸¸æˆä¸­æ‰“å¼€å‚ç›´åŒæ­¥å¯ä»¥ä½¿å¾—ç”»é¢å¹³æ»‘ã€ç¨³å®šï¼Œå› ä¸ºæ¸¸æˆç”»é¢çš„æ¸²æŸ“éœ€è¦ç­‰å¾…æ˜¾ç¤ºå™¨çš„åŒæ­¥ä¿¡å·ã€‚è€Œå…³é—­å‚ç›´åŒæ­¥ï¼Œ
åˆ™å¯ä»¥æ˜æ˜¾æé«˜å¸§æ•°ï¼Œåœ¨é«˜ç«¯è®¾å¤‡ä¸Šå¯ä»¥è·å¾—æ›´å¿«çš„é€Ÿåº¦ï¼Œä½†æ˜¯è¿™å¯èƒ½å¸¦æ¥å›¾åƒä¸ç¨³å®šçš„é—®é¢˜ã€‚ä¸€èˆ¬å›¾å½¢å¼•æ“ä¼š
ä½¿ç”¨åŒç¼“å†²åŒºæŠ€æœ¯ Double bufferingï¼Œå³ä¸€ä¸ªç¼“å†²åŒºè¿æ¥åˆ°æ˜¾ç¤ºä½œä¸ºå½“å‰æ˜¾ç¤ºå›¾åƒçš„æ•°æ®æºï¼Œå¦ä¸€ä¸ªç¼“å†²åŒº
åˆ™ä½œä¸ºä¸‹ä¸€å¸§å›¾åƒçš„æ¸²æŸ“è¾“å‡ºç¼“å†²åŒºã€‚åœ¨å…³é—­ Vsync çš„æƒ…å†µä¸‹ï¼Œé«˜ç«¯è®¾å¤‡å¯èƒ½æ¸²æŸ“å¥½äº†ç”»é¢ï¼Œä½†æ˜¾ç¤ºå™¨è¿˜ç¤ºæ¥å¾—
åŠè°ƒç”¨ï¼Œåˆå¼€å‘ä¸‹ä¸€å¸§å›¾åƒçš„æ¸²æŸ“äº†ã€‚è€Œä¸‹ä¸€å¸§å›¾é¢åˆä¸ä¸€å®šå®Œæ•´ï¼Œè¿™å°±å¯¼è‡´ç”»é¢æœ‰æ–­è£‚çš„ç°è±¡ã€‚

FPS ä½äºæ¸¸æˆè®¾è®¡æ—¶ï¼Œå¯èƒ½ä¼šæœ‰è¾“å…¥å»¶è¿Ÿå’Œå¡é¡¿ã€‚åœ¨éœ€è¦å¿«é€Ÿååº”å’Œå¤æ‚è¾“å…¥çš„æ¸¸æˆä¸­ï¼Œè¾“å…¥å»¶è¿Ÿå°¤å…¶ä»¤äººæ¼ç«ã€‚

ä¸ºäº†æé«˜è®¾å¤‡æ€§èƒ½å‚å®¶ä¹Ÿåœ¨ç¡¬ä»¶ä¸Šä¸æ–­æ”¹è‰¯ VSync æŠ€æœ¯ï¼š

- Adaptive VSync ç”± Nvidia å‘èµ·ï¼Œä¼šæ ¹æ®ç›‘è§†åˆ°çš„ FPS å¸§ç‡æ¥å†³å®šæ˜¯å¦å¯ç”¨ VSyncã€‚
- Fast Sync ç”± Nvidia å‘èµ·çš„æ›´é«˜çº§çš„è‡ªé€‚åº”å‚ç›´åŒæ­¥å½¢å¼ï¼Œåœ¨å¿…è¦æ—¶å¯ç”¨ VSyncï¼Œå¹¶æ·»åŠ è‡ªåŠ¨ä¸‰é‡ç¼“å†²ã€‚
- Enhanced Sync ç”± AMD å‘èµ·ï¼Œä¼šåœ¨å¸§ç‡ä½äºæ˜¾ç¤ºåˆ·æ–°ç‡æ—¶ç¦ç”¨ VSyncã€‚

å¦å¤–ï¼Œè¿˜æœ‰ Nvidia çš„ G-Sync å’Œ AMD çš„ FreeSyncï¼Œè¿™ä¸¤ç§ GPU æŠ€æœ¯éƒ½å¯ä»¥å°†åˆ·æ–°ç‡å’Œæ•°æ®ä¸ GPU 
çš„å¸§é€Ÿç‡åŒæ­¥ã€‚è¿™äº›å…¬å¸å¸Œæœ›è§£å†³ VSync çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å›¾åƒç²¾åº¦å’Œå‡åŒ€æ€§ï¼Œä»¥åŠæ’•è£‚ã€‚ä½†å®ƒä»¬è¦æ±‚  GTX 1050
ä»¥åŠ AMD Radeon RX 200 çº§åˆ«ä»¥ä¸Šçš„æ˜¾å¡ã€‚




## ğŸŸ¡ Carbon Language
- [Carbon programming language](https://github.com/carbon-language/carbon-lang)
- [Compiler Explorer](https://carbon.compiler-explorer.com)
- [Bazel - Build and test tool](https://github.com/bazelbuild/bazel)
- [The LLVM Project](https://github.com/llvm/llvm-project)
- [Bazel vs. CMake](https://yearn.xyz/posts/tools/bazelcmake/)

Google æ–°æ¨å‡º Carbon è¯­è¨€ï¼Œé—»è¦æˆä¸º C++ çš„æ¥ç­äººï¼ŒåŸºäº LLVM ç°ä»£ç¼–è¯‘å™¨æ¡†æ¶å¼€å‘ã€‚è¿™ä¹ˆåˆ©å®³ï¼Œé‚£ä¹ˆ
å°±æ¥å­¦ä¸€ä¸‹è¿™ç§è¯­è¨€ä½¿ç”¨çš„é»˜è®¤æ„å»ºå·¥å…·ï¼ŒBazelï¼Œè¿™æ˜¯å¤§å‹é¡¹ç›®çš„æ„å»ºå·¥å…·ï¼Œå¿«é€Ÿã€é«˜æ•ˆï¼Œåªç¼–è¯‘éœ€è¦æ„å»ºçš„
æ–‡ä»¶ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè‡ªåŠ¨ä¸‹è½½ä¾èµ–å·¥å…·ã€‚å¯æ ¹æ®é¡¹ç›®éœ€è¦ä¼¸ç¼©ã€æ‰©å±•ã€‚

C++ å¼•å…¥å¤–éƒ¨ä¾èµ–çš„æ–¹å¼å¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼šäºŒè¿›åˆ¶ä¾èµ–ï¼Œæˆ–æºç ä¾èµ–ã€‚å‰è€…æœ‰ ABI å…¼å®¹é—®é¢˜ï¼Œä¸æ”¯æŒæ›´æ¢å¹³å°
æˆ–ç³»ç»Ÿï¼Œæ‰€æœ‰çš„äºŒè¿›åˆ¶æ–‡ä»¶éƒ½éœ€è¦ä¸ºä¸åŒå¹³å°é‡æ–°ç¼–è¯‘ï¼›åè€…çš„ç¼ºç‚¹æ˜¯ï¼Œç¬¬ä¸€æ¬¡æ„å»ºçš„æ—¶å€™éœ€è¦ç¼–è¯‘æ‰€æœ‰ä»£ç ï¼Œ
æ¯”è¾ƒè€—æ—¶ã€‚Google æ¨å´‡ç¬¬äºŒç§ä¾èµ–æ–¹å¼ï¼Œæ‰€ä»¥æ‰ä¼šé‚£ä¹ˆåœ¨ä¹ Bazel çš„ç¼–è¯‘é€Ÿåº¦ã€‚

    A rule is a function, and a target is a function call

Bazel è§„åˆ™ï¼ˆRuleï¼‰å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒBUILD è„šæœ¬æ–‡ä»¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™æ˜¯ Python è„šæœ¬çš„ç®€åŒ–ç‰ˆã€‚å†…ç½®
è§„åˆ™æœ‰ genruleã€cc_binaryã€cc_libraryã€java_binaryã€py_library ç­‰ç­‰ï¼ŒTarget å°±æ˜¯è°ƒç”¨è§„åˆ™ï¼Œ
å¹¶ä¸”ç›¸åº”äº§ç”Ÿè¾“å‡ºã€‚

è§„åˆ™ rule ä¹Ÿæ˜¯å‡½æ•°ï¼Œæ‹¥æœ‰å‡½æ•°çš„å¤§éƒ¨åˆ†ç‰¹æ€§ï¼Œä½†ç›¸æ¯”å‡½æ•°ï¼Œå—åˆ°äº†æ›´å¤šçš„çº¦æŸã€‚æ¯”å¦‚ load æ˜¯å‡½æ•°ä½†ä¸æ˜¯è§„åˆ™ï¼Œ
load ç”¨äºä»å…¶ä»–æ–‡ä»¶è½½å…¥è§„åˆ™ï¼Œload ä¸èƒ½ç”¨äºè§„åˆ™ä¸­ã€‚åˆå¦‚ glob æ˜¯å‡½æ•°ï¼Œç”¨äºæŸ¥æ‰¾ä¸è·¯å¾„è§„åˆ™åŒ¹é…çš„æ–‡ä»¶ã€‚

[Action Graph](https://u98yad7iy.oss-cn-shanghai.aliyuncs.com/imgsbed/2021/11/05/10-27-23-bazel_out-177ed5b6632.jpg)

Bazel çš„æ‰§è¡Œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š

- **Loading**ï¼ŒåŠ è½½ Bazel è„šæœ¬æ–‡ä»¶ï¼ŒWORKSPACEã€BUILDã€bzl æ–‡ä»¶ï¼›
- **Analysis**ï¼Œè§£ææ‰€æœ‰è„šæœ¬å¹¶ç”Ÿæˆ Action Graphã€‚è§£æè¿‡ç¨‹åŒ…å«å¤–éƒ¨èµ„æºä¸‹è½½ï¼Œæœ¬åœ°èµ„æºå‡†å¤‡ç­‰ï¼›
- **Execution**ï¼Œæ‰§è¡Œ Action Graph ä»¥ç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼›

å·¥ä½œç©ºé—´è„šæœ¬æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥åªæœ‰ä¸€è¡Œå†…å®¹ï¼Œç”šè‡³ä¸å†™ä»»ä½•ä¸œè¥¿ï¼š

    workspace(name = "myproject")

åŠ¨ä½œï¼ˆactionï¼‰æ˜¯ Bazel ä¸­æœ€å°çš„æ‰§è¡Œå•å…ƒï¼Œä¸€èˆ¬ç”¨äºå°†è¾“å…¥æ–‡ä»¶è½¬æ¢ä¸ºåˆé€‚çš„è¾“å‡ºæ–‡ä»¶ï¼Œæ¯”å¦‚å°† C/CPP
æ–‡ä»¶è½¬æ¢ä¸º .o æˆ– .a æ–‡ä»¶ã€‚åŠ¨ä½œå¯ä»¥æ²¡æœ‰è¾“å…¥æ–‡ä»¶ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ã€‚BUILD è„šæœ¬ä¸­ä¸€ä¸ª target
å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªåŠ¨ä½œï¼ŒBazel ä¼šè‡ªåŠ¨å°† target è§£æä¸ºåŠ¨ä½œå¹¶åœ¨æ‰§è¡Œé˜¶æ®µæ‰§è¡Œã€‚

Action Graph æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±åŠ¨ä½œç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¼šè¢«é›†ä¸­ç¼“å­˜ã€‚å†æ¬¡ç¼–è¯‘æ—¶ï¼Œåªæœ‰ä¾èµ–æ–‡ä»¶è¢«ä¿®æ”¹çš„ç›®æ ‡
æ‰ä¼šè¢«æ›´æ–°ï¼Œè¿™ä¸€ç‚¹å’Œ CMake ä¸€è‡´ã€‚Bazel å¯ä»¥è®¾ç½®è¿œç¨‹ç¼“å­˜ä¸åˆ†å¸ƒå¼ç¼–è¯‘ç¯å¢ƒã€‚

Bazel ç¼–è¯‘ç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶ä¸€èˆ¬ä¿å­˜åœ¨é¡¹ç›®ç›®å½•ä¸‹ä»¥ bazel-* ä¸ºåç§°çš„ç›®å½•ä¸‹ï¼Œæ‰€ä»¥å°½é‡ä¸è¦åœ¨é¡¹ç›®ä¸­åˆ›å»º
ç±»ä¼¼åç§°çš„æ–‡ä»¶å¤¹ï¼Œé¿å…å’Œç¼“å­˜æ–‡ä»¶å¤¹å†²çªã€‚


Bazel å®˜æ–¹ä»£ç ä»“åº“åŒ…å«äº†æ–‡æ¡£å’Œç¤ºèŒƒç”¨ä¾‹ï¼Œæ•´ä¸ªå·¥ç¨‹åŒ…å«å¤šä¸ª BUILD è„šæœ¬ï¼Œé¡¹ç›®å·¥ä½œç›®å½•é¡¶å±‚å‘å­ç›®å½•æ·±å…¥ï¼Œ
ä¾‹å¦‚ example/cpp ç›®å½•åŒ…å«çš„ C++ æ¼”ç¤ºæ¡ˆä¾‹ã€‚è¿™äº›è„šæœ¬å°±æ˜¯ Python è„šæœ¬çš„ç®€åŒ–ç‰ˆï¼š

```py
cc_library(
    name = "hello-lib",
    srcs = ["hello-lib.cc"],
    hdrs = ["hello-lib.h"],
)

cc_binary(
    name = "hello-world",
    srcs = ["hello-world.cc"],
    deps = [":hello-lib"],
)

cc_test(
    name = "hello-success_test",
    srcs = ["hello-world.cc"],
    deps = [":hello-lib"],
)

cc_test(
    name = "hello-fail_test",
    srcs = ["hello-fail.cc"],
    deps = [":hello-lib"],
)

filegroup(
    name = "srcs",
    srcs = glob(["**"]),
    visibility = ["//examples:__pkg__"],
)
```

Bazel ç§°å·¥ç¨‹ä¸­çš„å­ç›®å½•ä¸º packageï¼Œä¾‹å¦‚ example ç›®å½•ä¸‹çš„ BUILD è„šæœ¬å®šä¹‰å…¶ä¸º publicï¼š

```py
package(default_visibility = ["//visibility:public"])

filegroup(
    name = "srcs",
    srcs = glob(["**"]) + [
        "//examples/android/java/bazel:srcs",
        "//examples/cpp:srcs",
        "//examples/gen:srcs",
        "//examples/java-native:srcs",
        "//examples/java-starlark:srcs",
        "//examples/py:srcs",
        "//examples/py_native:srcs",
        "//examples/shell:srcs",
        "//examples/windows/dll:srcs",
    ],
)
```

å¯ä»¥ä½¿ç”¨ query æŸ¥è¯¢å·¥ç¨‹å­ç›®å½•ä¸‹çš„æ„å»ºé…ç½®ä¿¡æ¯ã€‚ç„¶åï¼Œæ‰§è¡Œ build æˆ– test è¿›è¡Œæ„å»ºæˆ–æµ‹è¯•ã€‚æŒ‡å®šæ„å»º
ç›®æ ‡ï¼ŒæŒ‡å®š target æ˜¯ **BUILD** é…ç½®çš„å„ç§åº“ã€ç¨‹åºç›®æ ‡çš„ name å±æ€§å†…å®¹ã€‚å¯ä»¥åŒ…å«å®Œæ•´çš„é¡¹ç›®ç›®å½•è·¯å¾„ï¼Œ
ä»¥æ–œæ å¼€å¤´ï¼Œè·¯å¾„åè·Ÿå†’å·æ¥ target åç§°ã€‚å¦‚æœåœ¨ target çš„æ‰€åœ¨ç›®å½•ï¼Œä¹Ÿå¯ä»¥çœç•¥è·¯å¾„ä¿¡æ¯ï¼š

```sh
> git clone --depth=1 git@github.com:bazelbuild/bazel.git
Cloning into 'bazelbuild'...
> cd bazelbuild
> bazel query //:*
> bazel query //examples/cpp:*
//examples/cpp:BUILD
//examples/cpp:README.md
//examples/cpp:hello-lib
//examples/cpp:hello-lib.cc
//examples/cpp:hello-lib.h
//examples/cpp:hello-success_test
//examples/cpp:hello-world
# ...
Loading: 0 packages loaded

> cd bazelbuild\examples\cpp
> bazel test hello-success_test
> bazel build //examples/cpp:hello-world
> bazel build hello-world
INFO: Analyzed target //examples/cpp:hello-world (0 packages loaded, 0 targets configured).
INFO: Found 1 target...
Target //examples/cpp:hello-world up-to-date:
  bazel-bin/examples/cpp/hello-world.exe
INFO: Elapsed time: 0.194s, Critical Path: 0.01s
```

Carbon è¯­è¨€å½“å‰çš„å®ç°ç§°ä¸º Explorerï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä½œä¸ºè¯­è¨€çš„æ˜ç¡®è§„èŒƒï¼Œå®˜æ–¹æä¾›åœ¨çº¿ä½“éªŒç½‘ç«™ï¼Œå®ƒæ˜¯
åŸºäº LLVM ç°ä»£ç¼–è¯‘å™¨æ¡†æ¶å¼€å‘çš„ä¸€ä¸ªå‰ç«¯ç¼–è¯‘å™¨ã€‚

ä½œä¸ºè¯¥ç›®æ ‡çš„ä¸€ä¸ªæ‰©å±•ï¼ŒExplorer è¿˜å¯ä»¥ç”¨ä½œåŸå‹è®¾è®¡å’ŒéªŒè¯è¯­è¨€æ›´æ”¹çš„å¹³å°ã€‚å› æ­¤ï¼Œå®ƒä¼˜å…ˆäºå±•ç¤ºç›´æ¥å¯è¯»
çš„ä»£ç ï¼Œå…¶æ¬¡æ˜¯æ€§èƒ½ã€è¯Šæ–­è´¨é‡å’Œå…¶ä»–å¸¸è§„å®ç°ã€‚æ¢è¨€ä¹‹ï¼Œå®ƒçš„ç›®æ ‡å—ä¼—æ˜¯ä»äº‹ Carbon è®¾è®¡çš„äººï¼Œè€Œä¸æ˜¯ä»»ä½•
Carbon ç¼–ç¨‹ç»ˆç«¯ç”¨æˆ·ã€‚

æŒ‰ä»¥ä¸‹æ“ä½œä»æºä»£ç ç¼–è¯‘ï¼š

```shell
# Install bazelisk using Homebrew.
# On macOS: 
$ brew install bazelisk
# On Windows: 
$ choco install bazelisk

# Install Clang/LLVM using Homebrew.
# Many Clang/LLVM releases aren't built with options we rely on.
$ brew install llvm
$ export PATH="$(brew --prefix llvm)/bin:${PATH}"

# Download Carbon's code.
$ git clone https://github.com/carbon-language/carbon-lang
$ cd carbon-lang

# Build and run the explorer.
$ bazel run //explorer -- ./explorer/testdata/print/format_only.carbon
```

æœ€åç¼–è¯‘æ—¶é€šè¿‡äº†ï¼Œä¹Ÿç”Ÿæˆäº† explorerï¼Œä½†æ˜¯æ‰§è¡Œæ—¶ï¼Œæœªèƒ½é€šè¿‡ Sanizer å†…å­˜å®‰å…¨æ£€æŸ¥ï¼š

```sh
$ bazel run //explorer
INFO: Invocation ID: 694957b9-95bf-4177-91c9-ca53e9e3ea23
INFO: Analyzed target //explorer:explorer (0 packages loaded, 0 targets configured).
INFO: Found 1 target...
Target //explorer:explorer up-to-date:
  bazel-bin/explorer/explorer
INFO: Elapsed time: 0.400s, Critical Path: 0.01s
INFO: 1 process: 1 internal.
INFO: Build completed successfully, 1 total action
INFO: Running command line: bazel-bin/explorer/explorer
==2609==ERROR: AddressSanitizer failed to allocate 0x0 (0) bytes of SetAlternateSignalStack (error code: 22)
# https://github.com/carbon-language/carbon-lang/issues/2236

> clang --version
Homebrew clang version 15.0.7
Target: x86_64-unknown-linux-gnu
Thread model: posix
InstalledDir: /home/jeango/homebrew/bin

> g++ --version
g++ (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0

> g++-12 --version
g++-12 (Homebrew GCC 12.2.0) 12.2.0

> lli --version
Homebrew LLVM version 15.0.7
  Optimized build.
  Default target: x86_64-unknown-linux-gnu
  Host CPU: skylake
> lld --version
lld is a generic driver.
Invoke ld.lld (Unix), ld64.lld (macOS), lld-link (Windows), wasm-ld (WebAssembly) instead
> ld.lld --version
Homebrew LLD 15.0.7 (compatible with GNU linkers)
```



Bazel æœ‰ç‚¹è‡ªä½œèªæ˜çš„æ“ä½œï¼Œæ¯æ¬¡è¿è¡Œæ€»æ˜¯æŸ¥è¯¢æ›´æ–°ç‰ˆæœ¬ï¼Œä½“éªŒå®éš¾å¿ƒè¨€è¯´ï¼Œå¯ä»¥æŒ‡å®šç‰ˆæœ¬ç¦æ­¢è‡ªåŠ¨æ›´æ–°ã€‚

    echo "USE_BAZEL_VERSION=4.1.0" >> ~/.bazeliskrc

    export HOMEBREW_NO_AUTO_UPDATE=true

Homebrew å¯ä»¥ä½¿ç”¨ brew update --verbose æŸ¥çœ‹å¡åœ¨é‚£é‡Œï¼Œå¯èƒ½è·Ÿè½¯ä»¶æºæœ‰å…³ï¼Œbrew --repo å¯ä»¥
æŸ¥è¯¢åˆ°æœ¬åœ°ä»“åº“çš„ç›®å½•ã€‚

Homebrew æ˜¯ç»Ÿä¸€ç®¡ç† macOS ä¸­åº”ç”¨çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ï¼Œè€Œä¸”å¤§é‡ä¼˜ç§€çš„åº”ç”¨éƒ½å¯ä»¥åœ¨ Homebrew ä¸­æ‰¾åˆ°ã€‚
å¦‚æœè¯´ Mac App Store æ˜¯ä¸€å®¶å¤§è¶…å¸‚ï¼ŒHomebrew å°±æ˜¯ä¸€é—´å®¶é…¿å•¤é…’ç²¾å“å°é“ºâ€”â€”å¦‚å®ƒåå­—æ‰€ä»£è¡¨çš„é‚£æ ·ã€‚

Explorer é¡¹ç›®çš„æ„å»ºè„šæœ¬ä¸­åŒ…å« "@llvm-project//llvm:Support" é…ç½®ï¼Œéœ€è¦ä½¿ç”¨ LLVM ç¼–è¯‘å·¥å…·ã€‚
æœ¬åœ°å·²ç»å®‰è£… LLVM ç¼–è¯‘å™¨çš„æƒ…å†µä¸‹ï¼ŒBazel è¿˜ä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸‹è½½å’Œé…ç½® llvm-projectã€‚è¿™å¯èƒ½ç”±äºç½‘ç»œ
ä¸ç•…é€šè€Œä¸èƒ½ä¸‹è½½åˆ°ä¾èµ–å·¥å…·ï¼Œä»è€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚éœ€è¦æ‰‹åŠ¨è§£å†³ï¼Œå®‰è£… LLVM Project åˆ°æç¤ºçš„ç›®å½•ä¸‹ï¼š

```sh
INFO: Invocation ID: 49f54d0b-6efd-4a80-8d84-3d523d3bc34b
Analyzing: target //explorer:explorer (0 packages loaded, 0 targets configured)
    Fetching repository @llvm-project; starting 9s
    INFO: Repository llvm-project instantiated at:
      C:/carbon/WORKSPACE:132:15: in <toplevel>
    Repository rule llvm_configure defined at:
      C:/_bazel/llvm-raw/utils/bazel/configure.bzl:84:33: in <toplevel>
    ERROR: An error occurred during the fetch of repository 'llvm-project':
```

llvm-raw ç›®å½•ä¸‹å­˜æ”¾çš„æ˜¯ä¸‹è½½å¥½çš„ llvm-project ä»“åº“åŸå§‹æ–‡ä»¶ï¼Œä½¿ç”¨å®ƒæ—¶ä¼šå¤åˆ¶åˆ°éœ€è¦çš„ä½ç½®ä½¿ç”¨ã€‚
è·å– LLVM å·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œä¼šä½¿ç”¨åˆ° llvm-project-overlay åˆ›å»ºç›®å½•é“¾æ¥ï¼Œå°†åŸå§‹æ–‡ä»¶é“¾æ¥åˆ°å·¥ä½œç›®å½•ã€‚
ç›®å‰ç¨³å®šç‰ˆ Bazel 6.0.0ï¼Œå¦‚æœä½¿ç”¨ Nightly ç‰ˆæœ¬ï¼Œå¯èƒ½å¯¼è‡´ä»¥ä¸Šé”™è¯¯ã€‚

å¯ä»¥å°è¯•æ·±åº¦æ¸…ç†ç¼“å­˜æ–‡ä»¶ï¼š

    bazel clean --expunge

è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºï¼Œåœ¨ llvm-project-overlay é“¾æ¥ç›®å½•æ—¶é‡åˆ°æœ‰ç›®å½•å†²çªï¼Œå¯ä»¥æ˜¯ Windows å¹³å°ä¸‹
å…¼å®¹é—®é¢˜æ²¡å¤„ç†å¥½ï¼Œå¯¹ llvm-raw/utils/bazel/overlay_directories.py åšä¸€ä¸‹å°æ‰‹æœ¯ï¼Œæ·»åŠ ç›®å½•
å­˜åœ¨ä¸å¦çš„æ¡ä»¶åˆ¤æ–­ï¼Œé¿å…å¯¹å·²ç»å­˜åœ¨çš„ç›®å½•åšé“¾æ¥ï¼š

```py,ignore
    # ERROR: C:/carbon/explorer/BUILD:33:10: //explorer:explorer depends on 
    # @llvm-project//llvm:Support in repository @llvm-project which failed to fetch. 
    # no such package '@llvm-project//llvm': Failed to execute overlay script: 
    # 'C:/MinGW/bin/python3.exe C:/_bazel/llvm-raw/utils/bazel/overlay_directories.py
    #  --src C:/_bazel_ocean/llvm-raw
    #  --overlay C:/_bazel_ocean/llvm-raw/utils/bazel/llvm-project-overlay
    #  --target .'
    def _symlink_abs(from_path, to_path):
      if not os.path.exists(to_path):
        print("to_path %s not exits" % to_path)
        os.symlink(os.path.abspath(from_path), os.path.abspath(to_path))

    def main(args):
        # ...
        if rel_root != "." and not io.path.exists(rel_root):
          os.mkdir(os.path.join(args.target, rel_root))
```

ä½†è¿˜æ˜¯ä¸è¡Œï¼Œç›®å‰ Windows ç³»ç»Ÿä¸Šä½“éªŒ Carbon åªèƒ½è¿›å…¥ WSL ç³»ç»Ÿã€‚

- [Building on Windows](https://github.com/carbon-language/carbon-lang/issues/298)
- [Carbon on Windows WSL](https://cristianopizzamiglio.com/2022/08/14/carbon-wsl.html)
- [C++ Standard Libraries](https://docs.brew.sh/C++-Standard-Libraries)
- [So I tried Carbon... Aryan Garg](https://aryan401.hashnode.dev/carbon)

```sh
    # Install Homebrew https://brew.sh
    # it is a free and open-source software package management system that 
    # simplifies the installation of software on Appleâ€™s operating system, 
    # macOS and Linux.
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    # or:
    mkdir homebrew && curl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew
    # or:
    git clone https://github.com/Homebrew/brew homebrew
    eval "$(homebrew/bin/brew shellenv)"
    brew update --force --quiet
    chmod -R go-w "$(brew --prefix)/share/zsh"

    # Then, add Homebrew to your PATH variable by entering the two commands below 
    # (change username in the first command):
    echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> /home/username/.profile
    /home/linuxbrew/.linuxbrew/bin/brew shellenv >> .profile
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
    eval "$(more .profile)"

    # Install build tools:
    # sudo apt-get install build-essential clang
    brew install gcc llvm
    sudo apt install zlib1g-dev
    export PATH="$(brew --prefix llvm)/bin:${PATH}"
```

æ³¨æ„å®‰è£…åŸºç¡€ç¼–è¯‘å·¥å…·å¥—ä»¶æˆ– clang ç¼–è¯‘å™¨ï¼ŒBrew éœ€è¦ç”¨å®ƒæ¥ç¼–è¯‘ glibc ç­‰åŸºç¡€åº“ï¼š

```sh
    ==> Fetching glibc
    Warning: Building glibc from source as the bottle needs:
    - HOMEBREW_CELLAR: /home/linuxbrew/.linuxbrew/Cellar (yours is /home/jeango/homebrew/Cellar)
    - HOMEBREW_PREFIX: /home/linuxbrew/.linuxbrew (yours is /home/jeango/homebrew)

    Error: The following formulae cannot be installed from bottles and must be
    built from source.
      glibc and xz
    Install Clang or run `brew install gcc`.

    # carbon\bazel\cc_toolchains\clang_cc_toolchain_config.bzl
    error: unknown target CPU 'x86-64-v2'
    clang++: error: invalid linker name in argument '-fuse-ld=lld'
    ld.lld: error: unable to find library -lc++
    ld.lld: error: unable to find library -l:libunwind.a
```

GCC 10.9 å¼€å§‹åŸºç¡€è¿è¡Œåº“å‘½åä¸º libc++ï¼Œæ—©æœŸçš„ç‰ˆæœ¬åˆ™é»˜è®¤ä¸º libstdcï¼Œå¯ä»¥æŒ‰éœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ã€‚

    brew install gcc@7
    brew install --cc=gcc-7 <formula>

æ€»ä¹‹ï¼Œå®‰è£…è¿‡ç¨‹éå¸¸ä¸é¡ºåˆ©ï¼Œè¿˜æ˜¯å®˜æ–¹è¯´çš„é‚£æ ·ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨ Rustï¼Œé‚£å°±ä¸å¿…è€ƒè™‘ Carbonï¼
è¿™ä¸ªé¡¹ç›®ç”±è°·æ­Œå†…éƒ¨ C++ å’Œå¼€å‘å·¥å…·ç»„å¼€å¯ï¼Œå› ä¸º C++ æ ‡å‡†å§”å‘˜ä¼šæ— æ³•åœ¨ C++ ABI ä¸Šè¾¾æˆå…±è¯†ã€‚
ç›®æ ‡æ˜¯ä¸ç”¨é‡å†™è°·æ­Œå†…éƒ¨å·¨å¤§çš„ C++ ä»£ç ï¼ŒåŒæ—¶é€æ­¥æé«˜å®‰å…¨å’Œæ‰§è¡Œæ•ˆç‡ã€‚èµ„æºä¸Šï¼Œæœ€å¤šæ˜¯ä¸»ç®¡çº§çš„æ”¯æŒã€‚
å¤§å…¬å¸é‡Œä¸€ä¸ªå°ç»„æ”¾å‡ºä¸€ä¸ªå¤©é©¬è¡Œç©ºçš„å¼€æºé¡¹ç›®å¾ˆå¸¸è§ï¼ŒGoogle å¼€æºç©å…· demo ä¹Ÿæ˜¯è€ä¼ ç»Ÿã€‚

æ¼”åŒ–è®ºæœ‰ä¸ªâ€œç”Ÿæ€ä½â€çš„æ¦‚å¿µï¼Œå³åœ¨ä¸€ä¸ªç¨³å®šçš„ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªç”Ÿæ€ä½ä¸€æ—¦è¢«å…ˆæ¥è€…æŠ¢å ï¼Œé‚£åæ¥è€…æ˜¯æ²¡æœ‰æœºä¼šçš„ï¼Œ
è¿™ä¸ªå…ˆæ¥è€…å°±ä¼šä¸€ç›´å ç€è¿™ä¸ªç”Ÿæ€ä½ï¼Œç›´åˆ°ç¯å¢ƒå‘ç”Ÿå˜åŒ–ã€‚è€Œè½¯ä»¶å·¥ä¸šä¸­çš„ C++ å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ªåœ°ä½ã€‚

è‡ªæ“ä½œç³»ç»Ÿè¯ç”Ÿä»¥æ¥ï¼Œç¼–å†™å†…å­˜å®‰å…¨çš„ä»£ç ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒå›°éš¾çš„é—®é¢˜ï¼Œå¦ä¸€ä¸ªé—®é¢˜åˆ™æ˜¯ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚
2004 å¹´ä»¥æ¥ï¼Œå¾®è½¯å®‰å…¨å“åº”ä¸­å¿ƒï¼ˆMSRCï¼‰å·²å¯¹æ‰€æœ‰æŠ¥å‘Šè¿‡çš„å¾®è½¯å®‰å…¨æ¼æ´è¿›è¡Œäº†åˆ†ç±»ï¼Œæ®ç»Ÿè®¡æ•°æ®ï¼Œ
æ‰€æœ‰å¾®è½¯å¹´åº¦è¡¥ä¸ä¸­çº¦æœ‰ 70% æ˜¯é’ˆå¯¹å†…å­˜å®‰å…¨æ¼æ´çš„ä¿®å¤ç¨‹åºã€‚

- https://github.com/google/sanitizers
- https://gcc.gnu.org/onlinedocs/gcc-11.3.0/gcc/Option-Index.html
- https://developers.redhat.com/blog/2021/05/05/memory-error-checking-in-c-and-c-comparing-sanitizers-and-valgrind
- [Definitions and One Definition Rule (ODR)](https://en.cppreference.com/w/cpp/language/definition)
- [Constraints and concepts (since C++20)](https://en.cppreference.com/w/cpp/language/constraints)
- [C++ compiler support](https://en.cppreference.com/w/cpp/compiler_support)

Sanitizers æ˜¯è°·æ­Œå‘èµ·çš„å¼€æºå†…å­˜å®‰å…¨æ£€æŸ¥å·¥å…·ï¼Œé¡¹ç›®æœ¬æ˜¯ LLVM é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼ŒGNU GCC ç¼–è¯‘å™¨ä¹Ÿé›†æˆäº†ã€‚
GCC 4.8 ç‰ˆæœ¬å¼€å§‹æ”¯æŒåœ°å€ã€çº¿ç¨‹ Sanitizerï¼ŒGCC 4.9 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Leak Sanitizer å’Œ UB Sanitizerï¼Œ
è¿™äº›éƒ½æ˜¯æŸ¥æ‰¾éšè— Bug çš„åˆ©å™¨ã€‚é€šè¿‡ç¼–è¯‘å™¨å‚æ•°å¯ç”¨ï¼Œå¦‚ -fsanitize=address ä½¿ç”¨åœ°å€æ£€æŸ¥å™¨ã€‚

- AddressSanitizer æ£€æŸ¥åœ°å€ç›¸å…³é—®é¢˜ï¼ŒåŒ…æ‹¬é‡Šæ”¾åä½¿ç”¨ã€é‡å¤é‡Šæ”¾ã€å †æº¢å‡ºã€æ ˆæº¢å‡ºç­‰ç­‰é—®é¢˜ã€‚
- LeakSanitizer æ£€æŸ¥å†…å­˜æ³„æ¼é—®é¢˜ã€‚
- ThreadSanitizer æ£€æŸ¥çº¿ç¨‹æ•°æ®ç«äº‰å’Œæ­»é”é—®é¢˜ã€‚
- MemorySanitizer æ£€æŸ¥ä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜é—®é¢˜ã€‚
- Undefied Behavior Sanitizer æœªå®šä¹‰è¡Œä¸ºé—®é¢˜ã€‚

Address Sanitize æ”¯æŒåŠŸèƒ½ï¼š

01. Use after free (dangling pointer dereference)  ä½¿ç”¨æ‚¬æµ®æŒ‡é’ˆ
02. Heap buffer overflow    å †ç¼“å†²åŒºæº¢å‡º
03. Stack buffer overflow   æ ˆç¼“å†²åŒºæº¢å‡º
04. Global buffer overflow  å…¨å±€ç¼“å†²åŒºæº¢å‡º
05. Use after return        é€šè¿‡è¿”å›å€¼è®¿é—®å±€éƒ¨å˜é‡çš„å†…å­˜
06. Use after scope         è®¿é—®å·²ç»é‡Šæ”¾çš„å±€éƒ¨å˜é‡çš„å†…å­˜
07. Initialization order bugs   ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜
08. Memory leaks            å†…å­˜æ³„æ¼

C++20 æ˜¯æœ‰å²ä»¥æ¥æœ€å¤§çš„ C++ ç‰ˆæœ¬æ›´æ–°ï¼Œä½†æ˜¯ä¸çŸ¥ä»€ä¹ˆåŸå› å®ƒåˆæ²¡æœ‰å®Œå…¨å®Œå·¥ï¼Œæ˜¯ç–«æƒ…ç‰ˆå®Œæˆäº†åç»­çš„å·¥ä½œï¼Œ
C++23 â€œPandemic Editionâ€ is completeã€‚è¦ä½¿ç”¨æœ€æ–°çš„åŠŸèƒ½ï¼Œéœ€è¦ GCC æˆ– CLang 13 è¿™æ ·çš„ç‰ˆæœ¬ã€‚

C++20 å¼•å…¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼ŒçœŸçš„æ˜¯æ¦‚å¿µï¼Œå®ƒçš„åå­—å°±å« `concept`ï¼Œå…¶å®æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå’Œ Java è¯­è¨€çš„
æ³›å‹çº¦æŸç­‰ä»·ã€‚æœ¬è´¨æ¨¡æ¿å‚æ•°çº¦æŸæ¡ä»¶ï¼Œæ˜¯ä¸€ä¸ª bool å€¼æ¡ä»¶ã€‚

    template < template-parameter-list >
    concept  concept-name = constraint-expression;

å…¶ä¸­ï¼Œconstraint-expression æ˜¯ä¸€ä¸ªå¯ä»¥è¢« eval ä¸º bool çš„è¡¨è¾¾å¼æˆ–è€…ç¼–è¯‘æœŸå‡½æ•°ã€‚ä½¿ç”¨å®šä¹‰å¥½çš„
concept æ—¶ï¼Œconstraint-expression ä¼šæ ¹æ®ä¸Šé¢ template-parameter-list ä¼ å…¥çš„ç±»å‹ï¼Œ
æ‰§è¡Œç¼–è¯‘æœŸè®¡ç®—ï¼Œåˆ¤æ–­ä½¿ç”¨è¯¥ concept çš„æ¨¡æ¿å®šä¹‰æ˜¯å¦æ»¡è¶³ã€‚å¦‚æœä¸æ»¡è¶³ï¼Œåˆ™ç¼–è¯‘æœŸä¼šç»™å®šä¸€ä¸ªå…·æœ‰æ˜ç¡®è¯­ä¹‰
çš„é”™è¯¯ï¼Œå³è¿™ä¸ª concept æ²¡æœ‰åŒ¹é…æˆåŠŸã€‚ æ³¨æ„åˆ°ï¼Œä¸Šè¿°åŒ¹é…çš„è¡Œä¸ºéƒ½æ˜¯åœ¨ç¼–è¯‘æœŸå®Œæˆçš„ï¼Œå› æ­¤ concept
æ˜¯ zero-cost è¡¨è¾¾å¼ã€‚

Multiple declarations, Only one definitionã€‚

å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œä»»ä½•ä¸€ä¸ªç¿»è¯‘å•å…ƒä¸­ï¼Œåªå…è®¸å¯¹ä»»ä½•å˜é‡ã€å‡½æ•°ã€ç±»ç±»å‹ã€æšä¸¾ç±»å‹ã€`concept` æˆ–æ¨¡æ¿è¿›è¡Œ
ä¸€ä¸ªå®šä¹‰ã€‚å…¶ä¸­ä¸€äº›å¯èƒ½æœ‰å¤šä¸ªå£°æ˜ï¼Œä½†æ˜¯å®šä¹‰åªå…è®¸ä¸€ä¸ªï¼Œè¿™å°±æ˜¯ ODR å•ä¸€å®šä¹‰è§„åˆ™ã€‚

åœ¨æ•´ä¸ªç¨‹åºä¸­ï¼ŒåŒ…æ‹¬æ ‡å‡†åº“å’Œç”¨æˆ·å®šä¹‰åº“ï¼ŒODR è§„åˆ™ä½¿ç”¨çš„ non-inline å‡½æ•°æˆ–å˜é‡åªéœ€è¦å‡ºç°ä¸€ä¸ªå®šä¹‰ã€‚
ç¼–è¯‘å™¨ä¸éœ€è¦è¯Šæ–­è¿™ç§è¿åï¼Œä½†è¿åå®ƒçš„ç¨‹åºçš„è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œå³ ODR Violationã€‚

éµå¾ª ODR æ˜¯æ„å»ºè‰¯å¥½ C++ ç¨‹åºçš„åŸºç¡€ã€‚ç¼–å†™ C++ ç¨‹åºæ—¶ï¼Œä»£ç å†™åœ¨æ–‡ä»¶ä¸­ï¼Œç„¶è€Œå¯¹äº ODR åŸåˆ™æ¥è¯´ï¼Œ
æ–‡ä»¶ä¹‹é—´çš„è¾¹ç•Œå¹¶ä¸å¾ˆé‡è¦ï¼ŒçœŸæ­£é‡è¦çš„æ˜¯ç¼–è¯‘å•å…ƒï¼ŒTranslation Unitsã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªç¼–è¯‘å•å…ƒ
æ˜¯å¯¹ç¨‹åºå‘˜æäº¤ç»™ç¼–è¯‘å™¨çš„æ–‡ä»¶æ‰§è¡Œé¢„å¤„ç†åçš„ç»“æœï¼Œå³ä¸€ä¸ªæºæ–‡ä»¶ç»è¿‡é¢„å¤„ç†åï¼Œäº§ç”Ÿä¸€ä¸ªç›®æ ‡æ–‡ä»¶ã€‚
å‚è€ƒ C++ template:the complete guideã€‚

é¢„å¤„ç†å™¨æŒ‰ç…§æ¡ä»¶ç¼–è¯‘å‘½ä»¤ï¼Œ#ifï¼Œ#ifdef ç­‰ç­‰ï¼Œå»é™¤æ‰æœªè¢«é€‰ä¸­çš„ä»£ç å—ï¼Œå»é™¤æ³¨é‡Šï¼Œé€’å½’åœ°æ’å…¥
"#include" æŒ‡ä»¤æ‰€å¼•ç”¨çš„æ–‡ä»¶ï¼Œå¹¶å°†å®å±•å¼€ã€‚


Valgrind å¯ä»¥æ£€æµ‹éå¸¸å¤šçš„å†…å­˜é”™è¯¯ï¼Œä½†ç›¸å¯¹äº Sanitizerï¼Œå¯¹ç¨‹åºæ€§èƒ½å½±å“æ›´å¤§ã€‚

ä»¥ä¸‹æµ‹è¯•ç¨‹åºä¸€èˆ¬ç¼–è¯‘é€šè¿‡å¹¶æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä½¿ç”¨å†…å­˜æ£€æŸ¥å·¥å…·åï¼Œå°±å¯ä»¥å‘ç°æ½œåœ¨çš„è¶Šç•Œé—®é¢˜ï¼š

```C++
$ cat >overrun.c <<'EOF'
#include <stdlib.h>
int main() {
  char *p = malloc(16);
  p[24] = 1; // buffer overrun, p has only 16 bytes
  free(p);   // free(): invalid pointer
  return 0;
}
EOF
$ clang -o overrun overrun.c -Wall -g -fsanitize=address
$ valgrind ./overrun
```


## ğŸŸ¡ MT Downloader
- [Requests: HTTP for Humans](https://requests.readthedocs.io/en/latest/)

ä¸€ä¸ª Python å®ç°çš„å¤šçº¿ç¨‹ä¸‹è½½å™¨ï¼Œå°†é“¾æ¥åœ°å€å¤åˆ¶åˆ°ç²˜è´´æ¿ä¸Šï¼Œæ‰§è¡Œå®ƒå°±ä¼šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶å¹¶ä¿å­˜åˆ°å½“å‰ç›®å½•ã€‚
éœ€è¦å®‰è£… clipboard æ¨¡å—ï¼Œä½¿ç”¨ pip install clipboard å‘½ä»¤å®‰è£…ã€‚

å°½ç®¡ Python æœ‰ä¸€ä¸ªå…¨å±€é”ï¼Œä¸èƒ½å¹¶è¡Œå¤šçº¿ç¨‹è¿è¡Œï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹çš„ç¨‹åºä¹Ÿæœ‰å„ç§é—®é¢˜éœ€è¦æ³¨æ„çš„ï¼Œæ¯”å¦‚ï¼Œ
print å‡½æ•°æ‰“å°ä¿¡æ¯åˆ°æ§åˆ¶å°ä¸Šï¼Œå°½ç®¡è¿™ä¸ªå‡½æ•°æœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¯èƒ½å› ä¸ºçº¿ç¨‹åˆ‡æ¢å¯¼è‡´ç¼“å†²åŒºè¢«ç ´å
è€Œè¾“å‡ºä¸€äº›å¥‡æ€ªçš„å­—ç¬¦ï¼ŒåŒ…æ‹¬ NULL å­—ç¬¦ï¼Œåº”è¯¥åœ¨æ‰“å°æ“ä½œåæ‰§è¡Œ flush æ¸…ç©ºç¼“å†²åŒºï¼Œä»¥å…è¾“å‡ºå†…å®¹è¢«ç ´åã€‚

```py,ignore
import os
import clipboard
import requests
import threading
import concurrent.futures
import sys
import re
import pathlib

thread_local = threading.local()

def pagelist(items):
    for line in items:
        if not line:
            continue
        p = line.split()[-1].replace("P","")
        page = int(int(p) / 3) + 1
        url = line.split()[0]
        print(url)
        for no in range(page):
            print(url.replace(".html", "_%s.html" % no))

def checkfile(items):
    for item in items:
        file = item.split("/")[-1]
        if not item or os.path.exists(file):
            continue
        print(item)

def checkalbum(items):
    albumsum = 0
    error = 0
    for item in items:
        if not item:
            continue
        p = int(item.split()[-1].replace("P", ""))
        id = item.split('/')[-1].split('.')[0]
        match = pathlib.Path().cwd().glob("%s*" % id)
        count = len(sorted(match))
        state = "===Done!" if p == count else "---Miss!"
        print(state, item, " <== ", count)
        albumsum += p
        error += p - count
    print("Album: %d/%d,  error: %d " %((albumsum-error), albumsum, error))

def default_filter(content, url):
    root = "/".join(url.split("/")[:3])
    lines = content.decode().split('\r\n')
    contents = ""
    for line in lines:
        if len(contents)>0 and re.search(r"</?div", line) :
            break
        elif line.startswith('<p align="center">') or line.startswith('<div class="content"><p') or contents:
            contents += line
    match = re.findall(r'https?://[^" ]+', contents.replace('src="/', 'src="%s/' % root))
    for m in match:
        print("%s#/%s" %(m, url.split('/')[-1].replace("html","jpg")))
    sys.stdout.flush()
    return None #s.encode()


def argument(name):
    if "filter" in sys.argv:
        return ""
    for a in sys.argv[1:]:
        if a.startswith("%s=" % name):
            return a.replace("%s=" % name, "")
    return None

def content_filter(content, url):
    filter = argument("filter")
    if None == filter:
        return content
    elif "" == filter:
        return default_filter(content, url)
    else:
        lines = content.decode().split('\n')
        for line in lines:
            if line.find(f"{filter}") > -1:
                print(line) 
        return None

def get_session():
    if not hasattr(thread_local, "session"):
        thread_local.session = requests.Session()
    return thread_local.session


def download(url):
    session = get_session()
    headers = {
        'Accept-Encoding': 'gzip, deflate',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36'
    }
    try:
        res = session.get(url, headers=headers)
        if not res.ok or res.text.find("é¡µé¢å‡ºé”™")>-1:
            return print(url, " status", res.status_code, res.reason)
        save(url.split('/')[-1], res.content, url)
    except Exception as ex:
        print("%s %s" %(url, type(ex))) # class.__class__

def save(name, content, url):
    content = content_filter(content, url)
    if type(content) is not bytes:
        return None
    fd = os.open(name, os.O_BINARY|os.O_RDWR|os.O_CREAT)
    ret = os.write(fd, content)
    os.close(fd)
    print(['# save to: ', name, ret, content[:9]])
    # fd = open(name, "wb")
    # ret = fd.write(content)
    # fd.flush()
    # fd.close()

def download_all(urls):
    with concurrent.futures.ThreadPoolExecutor(max_workers=20) as executor:
        executor.map(download, urls)


if __name__ == "__main__":
    txt = clipboard.paste()
    items = txt.split('\r\n')
    if "checkfile" in sys.argv:
        checkfile(items)
    elif "pagelist" in sys.argv:
        pagelist(items)
    elif "checkalbum" in sys.argv:
        checkalbum(items)
    else:
        download_all(items)
```

## ğŸŸ¡ sango2 ä¸‰å›½ç¾¤è‹±ä¼ 2å…µç§ä¸é˜µæ³•ç›¸å…‹è§„åˆ™è®¾è®¡

ä¸‰å›½ç¾¤è‹±ä¼ 2å…µç§ç›¸å…‹è¡¨ï¼š

- ä»¥æœ´åˆ€ã€æ­¦æ–—ã€è—¤ç”²ä¸ºä»£è¡¨çš„çŸ­å…µå™¨;
- ä»¥é•¿æªã€å¤§åˆ€ã€é“é”¤ä¸ºä»£è¡¨çš„é•¿å…µå™¨;
- ä»¥å¼“ç®­ã€å¼©å…µã€é£åˆ€ä¸ºä»£è¡¨çš„è¿œç¨‹å…µç§ã€‚

é»„å·¾å…µã€æœ´åˆ€å…µä½œä¸ºæœ€å¸¸è§çš„ä¸¤ä¸ªå…µç§ï¼Œå®ƒä»¬å…‹åˆ¶çš„å…µç§ç›¸å¯¹å°‘ï¼Œå‰è€…å…‹åˆ¶è›®æ—ã€å¥³å…µã€é£åˆ€ï¼Œåè€…åœ¨è¿™äº›ä¹‹ä¸Šè¿˜å…‹åˆ¶å¼“ç®­ã€æ­¦æ–—ã€é»„å·¾ã€‚

ç›¸å…‹é¡ºå£æºœï¼š

    è¿œå…‹é•¿ï¼Œé•¿å…‹çŸ­ï¼ŒçŸ­å…µå¾ªç¯åˆå…‹è¿œã€‚
    å¤§åˆ€ç ´çŸ­å¾ˆèƒ½å¹²ï¼Œé£åˆ€çˆ†çš„é“¾é”¤æƒ¨ã€‚
    å¼©å…µå…¨èƒ½å¾ˆèƒ½å¹²ï¼Œé£å¼“è—¤ç”²å¹²å°±å®Œã€‚
    æ­¦æ–—ä¸æƒ§ç®­é£é”¤ï¼Œé»„å·¾åªå…‹å¥³é£è›®ã€‚
    è—¤ç”²ä¸ç•ç®­é£æœ´ï¼Œæœ´è›®é»„å¥³å€’éœ‰è›‹ã€‚

é•¿å…‹çŸ­ã€çŸ­å…‹è¿œï¼Œè¿œå…‹é•¿ï¼Œå…·ä½“å¦‚ä¸‹ï¼Œæœ€å€’éœ‰çš„ä¸‰å¤§å…µç§æ˜¯è›®æ—ã€é»„å·¾ã€å¥³å…µï¼š

        | æœ´åˆ€ é•¿æª å¤§åˆ€ å¼“ç®­ é“¾é”¤ é£åˆ€ æ­¦æ–— è›®æ— é“é”¤ è—¤ç”² é»„å·¾ å¼©å…µ å¥³å…µ | æ€»å’Œ
    ----|--------------------------------------------------------|----
    æœ´åˆ€ |   0 -42 -58  44  -47  47  21  14  -51 -31  22  -8   10 | -79
    é•¿æª |  42   0 -12 -58  -23 -53  60  49   27  66  44  -52  39 |  129
    å¤§åˆ€ |  58  12   0 -66   22 -64  63  53  -14  68  68  -18 -43 |  139
    å¼“ç®­ | -44  58  66   0   54   8 -56 -36   47 -54  28   32 -29 |   74
    é“¾é”¤ |  47  23 -22 -54    0 -48 -26  36   13  65  37  -45  32 |   58
    é£åˆ€ | -47  53  64 -8    48   0 -55 -39   39 -67 -24   56 -32 | -12
    æ­¦æ–— | -21 -60 -63  56   26  55   0   8   42  16  33  -18   6 |   80
    è›®æ— | -14 -49 -53  36  -36  39 -8    0  -41  17 -62  -10  30 | -151
    é“é”¤ |  51 -27  14 -47  -13 -39 -42  41    0  64  41  -28  36 |   51
    è—¤ç”² |  31 -66 -68  54  -65  67 -16 -17  -64   0  21    8  26 | -89 
    é»„å·¾ | -22 -44 -68 -28  -37  24 -33  62  -41 -21   0  -24  56 | -176
    å¼©å…µ |   8  52  18 -32   45 -56  18  10   28 -8   24    0  12 |  119
    å¥³å…µ | -10 -39  43  29  -32  32 -6  -30  -36 -26 -56  -12   0 | -143


é˜µå‹ç›¸å…‹è¡¨ï¼š

- ä»¥æ–¹å½¢ã€å›­å½¢ã€é±¼ä¸½å½¢ä¸ºä»£è¡¨çš„å¹³å¤´é˜µï¼Œå¼ºåº¦ä¾æ¬¡å‡å¼±ï¼Œå¹¶ä¸”é±¼ä¸½æœ‰å€’å…‹æ–¹å½¢ä¹‹åŠ¿ï¼›
- ä»¥é’©å½¢ã€é›å½¢ã€ä¸ºä»£è¡¨çš„å‡¹å¤´é˜µï¼Œå¼ºåº¦ä¾æ¬¡å‡å¼±ï¼›
- ä»¥å†²é”‹å½¢ã€é”¥å½¢ã€ç®­çŸ¢å½¢ä¸ºä»£è¡¨çš„å°–å¤´é˜µï¼Œå¼ºåº¦ä¾æ¬¡å‡å¼±ï¼›

ç„è¥„å½¢åƒåå­—æ˜Ÿï¼Œæ—¢æœ‰å¹³å¤´å±æ€§ï¼Œåˆæœ‰å‡¹å¤´å±æ€§ï¼Œå…‹åˆ¶å°–å¤´é˜µï¼Œå†²é”‹å½¢ï¼Œè¿˜æœ‰ç®­çŸ¢å½¢ï¼ŒåŒæ—¶åˆè¢«åœ†å½¢ã€æ–¹å½¢å…‹åˆ¶ã€‚

ã€Šå·¦ä¼ Â·æ¡“å…¬äº”å¹´ã€‹ æ™‹ æœé¢„ï¼šâ€œã€Šå¸é©¬æ³•ã€‹ï¼šâ€˜è½¦æˆ˜äºŒåäº”ä¹˜ä¸ºåã€‚â€™ä»¥è½¦å±…å‰ï¼Œä»¥ä¼æ¬¡ä¹‹ï¼Œæ‰¿åä¹‹éš™è€Œå¼¥ç¼é˜™æ¼ä¹Ÿã€‚äº”äººä¸ºä¼ã€‚æ­¤ç›–é±¼ä¸½é™ˆæ³•ã€‚â€

å¹³å…‹å‡¹ã€å‡¹å…‹å°–ã€å°–å…‹å¹³ã€‚è´Ÿå€¼è¡¨ç¤ºåœ¨è¡¨æ ¼ç«–å‘çš„é˜µæ³•è¢«æ¨ªå‘æ‰€ç¤ºçš„é˜µæ³•å…‹åˆ¶ï¼Œè´Ÿæ•°ç»å¯¹å€¼è¶Šå¤§å…‹åˆ¶è¶Šå¼ºï¼š

          æ–¹å½¢ åœ†å½¢ é”¥å½¢ é›å½¢ ç„è¥„ é±¼ä¸½ é’©å½¢ å†²é”‹ ç®­çŸ¢
    ----|--------------------------------------
    æ–¹å½¢ |   0
    åœ†å½¢ | -7     0
    é”¥å½¢ |  18   12   0
    é›å½¢ | -19  -22  19   0
    ç„è¥„ | -13  -21  11  5    0
    é±¼ä¸½ |  6   -6  -25  11  18   0
    é’©å½¢ | -23  -12  25 -3   6  -23   0
    å†²é”‹ |  23   24  7  -15 -24  10 -14   0
    ç®­çŸ¢ |  15   18 -6  -20 -19  17 -15  12   0
    ----|--------------------------------------
    æ€»å’Œ |  0    0   1   0   -1   0   1   1   -2


## ğŸŸ¡ GDNative/GDExtension æ‰©å±•å¼€å‘
- [Godot Engine Download](https://downloads.tuxfamily.org/godotengine/)
- [Godot API Headers](https://github.com/godotengine/godot-headers)
- [godot-cpp](https://github.com/godotengine/godot-cpp)
- [GDNative demos](https://github.com/godotengine/gdnative-demos) 
- [GDNative C++](https://docs.godotengine.org/en/latest/tutorials/scripting/gdnative/index.html)
- [Custom modules in C++](https://docs.godotengine.org/en/stable/development/cpp/custom_modules_in_cpp.html)
- [Godot Compiling](https://docs.godotengine.org/en/stable/development/compiling/index.html)
- [Godot Engine â€“ Multi-platform 2D and 3D game engine](https://github.com/godotengine/godot/releases)
- [Godot Rust bindings - GDNative and GDExtension APIs](https://godot-rust.github.io/)
- [Platform Support](https://doc.rust-lang.org/nightly/rustc/platform-support.html)
- [The godot-rust Book](https://godot-rust.github.io/book/gdextension/)
- [Introducing GDNative's successor, GDExtension](https://godotengine.org/article/introducing-gd-extensions)

é¿å…é‡æ–°ç¼–è¯‘ Godot æºä»£ç è¿›è¡ŒåŠŸèƒ½æ‰©å±•çš„æ–¹æ³•æœ‰ GDNative å’Œ GDExtensionï¼Œåˆ†åˆ«åœ¨ Godot 3.x å’Œ 4.x ä¸­ä½¿ç”¨ã€‚

é€šå¸¸ï¼Œåœ¨äº§å“éœ€è¦å¿«é€Ÿè¿­ä»£å‰æœŸå¼€å‘é˜¶æ®µï¼ŒGDScript ä¸»è¦çš„å¼€å‘è¯­è¨€å·¥å…·ï¼Œåªæœ‰åœ¨éœ€è¦å¤„ç†æ€§èƒ½ç“¶é¢ˆé—®é¢˜æ—¶ï¼Œ
æˆ–è€…æœ‰æ½œåœ¨æ€§èƒ½ç“¶é¢ˆçš„åŠŸèƒ½éœ€è¦å¤„ç†ï¼Œæ‰ä¼šè€ƒè™‘ä½¿ç”¨ C/C++ æˆ–è€… Rust ç­‰è¯­è¨€è¿›è¡Œé™æ€ç¼–è¯‘ï¼Œä»¥è·å¾—é«˜æ€§èƒ½
æ¨¡å—ï¼Œè¿™å½“ç„¶æ˜¯ä»¥è½¯ä»¶ç»“æ„å¤æ‚æ€§ä¸ºä»£ä»·çš„ã€‚

Godot æœ¬èº«æ˜¯ C++ å¼€å‘çš„ï¼Œä½¿ç”¨ C++ å¯ä»¥å®ç°å„ç§æ¨¡å—ä»¥æ‰©å±• Godot åŠŸèƒ½ã€‚é€šè¿‡ç°æœ‰çš„ GDNative C Binding 
æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ C/C++ æ¥å¼€å‘ Godot åº”ç”¨ã€‚æºä»£ç å¼€å‘éœ€è¦ä½¿ç”¨ Pythonï¼Œç¼–è¯‘å·¥å…·ä½¿ç”¨ SConsï¼Œæ”¯æŒ C++14 è§„èŒƒï¼Œ
å¯ä»¥ä½¿ç”¨ `clang`, `gcc` ç­‰å…¼å®¹çš„ç¼–è¯‘å™¨ã€‚

GDNative æ˜¯ Godot ç”¨äºå’ŒåŸç”Ÿå…±äº«åº“äº¤äº’çš„æ‰©å±•æ¨¡å—ï¼Œå’Œç›´æ¥ç¼–å†™ Godot C++ æ¨¡å—ä¸åŒï¼Œé€šè¿‡ Godot
å·²ç»é›†æˆçš„ GDNative æ‰©å±•æ¨¡å—è¿›è¡Œæ‰©å±•å¼€å‘ï¼Œåªéœ€è¦æä¾›åŠ¨æ€è¿æ¥åº“å³å¯ä»¥è°ƒç”¨ã€‚æ‰€ä»¥åŸºäº GDNative å¼€å‘
Godot æ‰©å±•ä¸éœ€è¦é‡æ–°ç¼–è¯‘æºä»£ç ï¼Œå¼€å‘æ’ä»¶æ›´æ–¹ä¾¿ã€‚

è€Œä¸º Godot ç›´æ¥ç¼–å†™ C++ æ‰©å±•æ¨¡å—åˆ™ä¸åŒï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ Godot æºä»£ç ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGDNative è¦æ±‚ä¸¥æ ¼çš„ç‰ˆæœ¬å…¼å®¹ï¼Œä¾‹å¦‚ Godot 3.4.x GDNative å°±ä¸å…¼å®¹ 3.3.x æˆ– 3.5.x ç‰ˆæœ¬ã€‚
æ‰€ä»¥åœ¨é¡¹ç›®åˆ›å»ºæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ­£ç¡®çš„ Godot API Headers ç‰ˆæœ¬ï¼ŒGDNative demos æ¼”ç¤ºé¡¹ç›®æœ€å¥½ä¹Ÿé€‰æ‹©å…¼å®¹ç‰ˆæœ¬ã€‚

ä½¿ç”¨ git å…‹éš†ä»“åº“æ—¶å¯ä»¥æŒ‡å®šåˆ†æ”¯ç‰ˆæœ¬ï¼Œæ³¨æ„ godot-cpp ä¾èµ– godot-headers ä»“åº“ï¼Œå¹¶ä½œä¸ºå­æ¨¡å—ï¼Œåœ¨åˆå§‹åŒ–
é¡¹ç›®æ—¶ï¼Œéœ€è¦é€’å½’è·å–å­æ¨¡å—ï¼š

```sh
mkdir gdnative_cpp_example
cd gdnative_cpp_example
git init
git submodule add -b 3.x https://github.com/godotengine/godot-cpp
cd godot-cpp
git submodule update --init --recursive
# just download the repositories or clone them into your project folder,
# git clone --recursive -b 3.x https://github.com/godotengine/godot-cpp
```

ä¸‹è½½ GDNative C Bindings åï¼Œéœ€è¦ä¸º Python ç¯å¢ƒå®‰è£… SCons æ¨¡å—ï¼Œç„¶åå†ç¼–è¯‘ç»‘å®šæ¨¡å—ï¼Œå†
ç¼–è¯‘åŸºäº GDNative çš„å…±äº«åº“ä¾› Godot å·¥ç¨‹ä½¿ç”¨ï¼š

```sh
pip install SCons
# scons platform=PLATFORM
# Building the C++ bindings
cd godot-cpp
scons platform=windows generate_bindings=yes -j4
# Building the GDNative library project
cd ..
scons platform=windows target=release -j4
```

SCons æ”¯æŒå¤šå¹³å°ç¼–è¯‘ï¼ŒPLATFORM å¯ä»¥æŒ‡å®š `windows`, `linux`, `osx`ï¼Œç¼–è¯‘ godot-cpp ç”Ÿæˆæ–‡ä»¶
ä¿å­˜åœ¨ bin å’Œ gen ç›®å½•ä¸‹ï¼Œå…±äº«åº“å¯ä»¥ä¾› GDNative demos ç¤ºèŒƒé¡¹ç›®ä½¿ç”¨ï¼Œå…¶é…ç½®è„šæœ¬ SConstruct æ–‡ä»¶
å·²ç»è®¾ç½®å¥½ç›¸å…³ç›®å½•è·¯å¾„ã€‚å…ˆç¼–è¯‘ godot-cppï¼Œå†ç¼–è¯‘é¡¹ç›®ä½¿ç”¨çš„å…±äº«ï¼Œåº“æ–‡ä»¶ç”Ÿæˆåä¿å­˜äº `project/gdnative`ã€‚

```py
#!python
import os

opts = Variables([], ARGUMENTS)

# Define the relative path to the Godot headers.
godot_headers_path = "godot-cpp/godot-headers"
godot_bindings_path = "godot-cpp"

# Gets the standard flags CC, CCX, etc.
env = DefaultEnvironment()

# Define our options. Use future-proofed names for platforms.
platform_array = ["", "windows", "linuxbsd", "macos", "x11", "linux", "osx"]
opts.Add(EnumVariable("target", "Compilation target", "debug", ["d", "debug", "r", "release"]))
opts.Add(EnumVariable("platform", "Compilation platform", "", platform_array))
opts.Add(EnumVariable("p", "Alias for 'platform'", "", platform_array))
opts.Add(BoolVariable("use_llvm", "Use the LLVM / Clang compiler", "no"))
opts.Add(PathVariable("target_path", "The path where the lib is installed.", "project/gdnative/"))
opts.Add(PathVariable("target_name", "The library name.", "libdodgethecreeps", PathVariable.PathAccept))


# ellipsis ...

env.Append(
    CPPPATH=[
        godot_headers_path,
        godot_bindings_path + "/include",
        godot_bindings_path + "/include/gen/",
        godot_bindings_path + "/include/core/",
    ]
)

env.Append(
    LIBS=[
        env.File(os.path.join("godot-cpp/bin", "libgodot-cpp.%s.%s.64%s" % (platform, env["target"], env["LIBSUFFIX"])))
    ]
)

env.Append(LIBPATH=[godot_bindings_path + "/bin/"])
# ellipsis ...
```

ClassDB æ˜¯æ‰©å±•ç±»å‹æ•°æ®åº“ç®¡ç†ç±»å‹ï¼Œæä¾›äº†å„ç§ç»‘å®šæ–¹æ³•ï¼Œç”¨äºå‘ GDScript æä¾›æ–¹æ³•ç»‘å®šã€‚ä»¥ä¸‹ä»£ç ç‰‡æ®µ
æ‘˜è‡ª Godot-CPP ä¸­çš„ç¤ºèŒƒå·¥ç¨‹ï¼š

```cpp,ignore
    // Methods.
    ClassDB::bind_method(D_METHOD("simple_func"), &Example::simple_func);
    ClassDB::bind_method(D_METHOD("simple_const_func"), &Example::simple_const_func);
    ClassDB::bind_method(D_METHOD("return_something"), &Example::return_something);
    ClassDB::bind_method(D_METHOD("return_something_const"), &Example::return_something_const);
    ClassDB::bind_method(D_METHOD("return_empty_ref"), &Example::return_empty_ref);
    ClassDB::bind_method(D_METHOD("return_extended_ref"), &Example::return_extended_ref);
    ClassDB::bind_method(D_METHOD("extended_ref_checks", "ref"), &Example::extended_ref_checks);

    ClassDB::bind_method(D_METHOD("test_array"), &Example::test_array);
    ClassDB::bind_method(D_METHOD("test_tarray_arg", "array"), &Example::test_tarray_arg);
    ClassDB::bind_method(D_METHOD("test_tarray"), &Example::test_tarray);
    ClassDB::bind_method(D_METHOD("test_dictionary"), &Example::test_dictionary);
    ClassDB::bind_method(D_METHOD("test_node_argument"), &Example::test_node_argument);

    ClassDB::bind_method(D_METHOD("def_args", "a", "b"), &Example::def_args, DEFVAL(100), DEFVAL(200));

    ClassDB::bind_static_method("Example", D_METHOD("test_static", "a", "b"), &Example::test_static);
    ClassDB::bind_static_method("Example", D_METHOD("test_static2"), &Example::test_static2);

    {
        MethodInfo mi;
        mi.arguments.push_back(PropertyInfo(Variant::STRING, "some_argument"));
        mi.name = "varargs_func";
        ClassDB::bind_vararg_method(METHOD_FLAGS_DEFAULT, "varargs_func", &Example::varargs_func, mi);
    }

    {
        MethodInfo mi;
        mi.arguments.push_back(PropertyInfo(Variant::STRING, "some_argument"));
        mi.name = "varargs_func_nv";
        ClassDB::bind_vararg_method(METHOD_FLAGS_DEFAULT, "varargs_func_nv", &Example::varargs_func_nv, mi);
    }

    {
        MethodInfo mi;
        mi.arguments.push_back(PropertyInfo(Variant::STRING, "some_argument"));
        mi.name = "varargs_func_void";
        ClassDB::bind_vararg_method(METHOD_FLAGS_DEFAULT, "varargs_func_void", &Example::varargs_func_void, mi);
    }

    // Properties.
    ADD_GROUP("Test group", "group_");
    ADD_SUBGROUP("Test subgroup", "group_subgroup_");

    ClassDB::bind_method(D_METHOD("get_custom_position"), &Example::get_custom_position);
    ClassDB::bind_method(D_METHOD("get_v4"), &Example::get_v4);
    ClassDB::bind_method(D_METHOD("set_custom_position", "position"), &Example::set_custom_position);
    ADD_PROPERTY(PropertyInfo(Variant::VECTOR2, "group_subgroup_custom_position"), "set_custom_position", "get_custom_position");

    // Signals.
    ADD_SIGNAL(MethodInfo("custom_signal", PropertyInfo(Variant::STRING, "name"), PropertyInfo(Variant::INT, "value")));
    ClassDB::bind_method(D_METHOD("emit_custom_signal", "name", "value"), &Example::emit_custom_signal);

    // Constants.
    BIND_ENUM_CONSTANT(FIRST);
    BIND_ENUM_CONSTANT(ANSWER_TO_EVERYTHING);

    BIND_CONSTANT(CONSTANT_WITHOUT_ENUM);
```

Godot 4.x å¼•å…¥ GDExtension ä½œä¸º GDNative çš„æ›¿ä»£æ¨¡å—ï¼Œæˆ–è€…è¯´æ˜¯ GDNative åº”ç”¨å±‚çš„é‡æ„ç‰ˆæœ¬ï¼Œ
æ‰©å±•çš„ç›®æ ‡è¿˜ä¸ºäº†å‡è½»ç»™ Godot å¼•æ“å¼€å‘æ’ä»¶çš„éš¾åº¦ã€‚GDExtension æ˜¯ C++ APIï¼Œæä¾›æ–¹æ³•æ³¨å†ŒåŠ¨æ€åº“ä¸­çš„ç±»ã€‚
æ³¨å†Œåçš„ç±»ï¼Œå°±å¯ä»¥ä¾› Godot å¼•æ“ä½¿ç”¨ï¼Œå› ä¸ºæ˜¯å¹³å°ç¼–è¯‘çš„å…±äº«åº“ï¼Œæ‰€ä»¥èƒ½æ›´å¥½åœ°é›†æˆåˆ°å¼•æ“å†…ã€‚é…åˆç°æœ‰çš„
godot-cpp åº“ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ C++ å¼€å‘é™æ€ç¼–è¯‘çš„æ¨¡å—ã€‚

ä¸ C++ æ‰©å±•ä¸­ç›´æ¥ä½¿ç”¨ Godot å¼•æ“æºä»£ç çš„å¤´æ–‡ä»¶ä¸åŒï¼ŒRust ç»‘å®šéœ€è¦ä½¿ç”¨å®ƒå¼ºå¤§çš„å®ç¼–ç¨‹èƒ½åŠ›ï¼Œä»¥ç”Ÿæˆ
Godot å¼•æ“çš„ API ç»‘å®šä»£ç ï¼ŒGodot å‘½ä»¤è¡Œæä¾› dump-extension-api é€‰é¡¹å¯¼å‡ºå½“å‰ç‰ˆæœ¬çš„ GDNative
ç±»å‹ä¿¡æ¯åˆ° JSON æ–‡ä»¶ï¼ŒGodot Rust ç»‘å®šæ¨¡å—ä¼šåˆ†æ JSON æ–‡ä»¶å¹¶ç”Ÿæˆç›¸åº”çš„ç»‘å®šä»£ç ã€‚

ä½¿ç”¨ Rust ç¼–å†™å¥½çš„æ‰©å±•æ—¶ï¼Œå…ˆä¸º Godot å·¥ç¨‹å‡†å¤‡å¥½ GDExtension é…ç½®æ–‡ä»¶ example.gdextensionï¼š

```sh
[configuration]

entry_symbol = "example_library_init"

[libraries]

macos.debug = "res://bin/libgdexample.macos.template_debug.framework"
macos.release = "res://bin/libgdexample.macos.template_release.framework"
windows.debug.x86_64 = "res://bin/libgdexample.windows.template_debug.x86_64.dll"
windows.release.x86_64 = "res://bin/libgdexample.windows.template_release.x86_64.dll"
...
```

ç„¶ååœ¨ godot å·¥ç¨‹æ–‡ä»¶ä¸­æ·»åŠ  GDExtension é…ç½®ï¼š

```sh
[native_extensions]

paths=["res://example.gdextension"]
```

é…ç½®æ–‡ä»¶ä¸­çš„å…¥å£éœ€è¦å¯¹åº” C++ ä»£ç ä¸­çš„ GDE_EXPORT å¯¼å‡ºå‡½æ•°ï¼š

```cpp
extern "C" {
// Initialization.
GDExtensionBool GDE_EXPORT example_library_init(const GDExtensionInterface *p_interface, GDExtensionClassLibraryPtr p_library, GDExtensionInitialization *r_initialization) {
    godot::GDExtensionBinding::InitObject init_obj(p_interface, p_library, r_initialization);

    init_obj.register_initializer(initialize_example_module);
    init_obj.register_terminator(uninitialize_example_module);
    init_obj.set_minimum_library_initialization_level(MODULE_INITIALIZATION_LEVEL_SCENE);

    return init_obj.init();
}
}
```


ç›®å‰ï¼Œä½¿ç”¨ Rust è¯­è¨€ç¼–å†™ GDExtension æ‰©å±•è¿˜ä¸ç¨³å®šï¼Œç¼–è¯‘åçš„æ‰©å±•åº“å¯èƒ½ä¸å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼š

    git clone --depth=1 git@github.com:godot-rust/book
    git clone --depth=1 git@github.com:godot-rust/gdnative
    git clone --depth=1 git@github.com:godot-rust/gdextension

ç¼–ç¨‹æ€æƒ³ Rust vs. C++ï¼šå‰è€…åªæœ‰èƒ½è¢«è¯æ˜æ˜¯æ­£ç¡®ä»£ç çš„æ‰è¢«å…è®¸ï¼Œåè€…åˆ™æ˜¯å…è®¸ä»»ä½•ä¸èƒ½è¯æ˜æ˜¯é”™è¯¯çš„ä»£ç ã€‚

Rust ç¼–è¯‘è„šæœ¬ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µæ·»åŠ  C++ å¤´æ–‡ä»¶çš„ç›®å½•ï¼Œå› ä¸º godot-rust ç»‘å®šä¾èµ– godot-headersï¼Œ
è¿™äº› C/C++ å¤´æ–‡ä»¶éœ€è¦é€šè¿‡ Rust FFI æ¥å£ç»‘å®šï¼ŒRust ä¸­å¸¸ç”¨çš„ API ç»‘å®šå·¥å…·æœ‰ä»¥ä¸‹è¿™äº›ï¼š

- `bindgen` automatically generates Rust FFI bindings to C (and some C++) libraries.
- `cbindgen` creates C/C++11 headers for Rust libraries which expose a public C API.
- `cpp` rust-cpp - Embed C++ code directly in Rust.

å…¶ä¸­ï¼Œgdnative-sys è¿™ä¸ªæ¨¡å—ä¼šåŒ…è£… godot-headersï¼Œå®ƒä¼šä¾èµ–ä¸€éƒ¨åˆ†å¹³å°ç›¸å…³çš„å¤´æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹
buider.rs ç¼–è¯‘è„šæœ¬ï¼Œæ·»åŠ  clang_arg æŒ‡å®šç¼–è¯‘å™¨å‚æ•° -I æ¥æŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„ï¼Œä½†ä¸æ¨èç›´æ¥ä¿®æ”¹ã€‚

Godot 4.x ä¸­çš„ GDExtension ä»£ç ç»“æ„æœ‰æ”¹å˜ï¼Œå¹¶ä¸”ç›®å‰è¿˜æœªå‘å¸ƒç¨³å®šç‰ˆæœ¬ã€‚å¹¶ä¸” godot-ffi æ¨¡å—ä¼šè°ƒç”¨
godot4 å¯æ‰§è¡Œç¨‹åºç”¨äºç”Ÿæˆ API JSON ä¿¡æ¯æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é…ç½® `GODOT4_BIN` ç¯å¢ƒå˜é‡æŒ‡å‘å¯æ‰§è¡Œç¨‹åºï¼š

```sh
    # powershell
    [System.Environment]::SetEnvironmentVariable("GODOT4_BIN", "C:\games\Godot_v4.0-beta10_win64.exe")
```

äº¤å‰ç¼–è¯‘æ¶‰åŠé—®é¢˜å¾ˆå¤šï¼Œé€šå¸¸æ ¹æ®å½“å‰å¹³å°çš„æ¶æ„æ¥ç¼–è¯‘æ˜¯å®¹æ˜“é€šè¿‡çš„ï¼Œå¯ä»¥ä½¿ç”¨ rustup æŸ¥è¯¢å½“å‰çš„å¹³å°æ„æ¶
åŠå·¥å…·é“¾ã€‚å³ä½¿åœ¨äº¤å‰ç¼–è¯‘æ—¶ï¼Œbindgen ä¹Ÿéœ€è¦è®¿é—®å¹³å°æ ‡å¤´ä»¥äº†è§£å¹³å°çš„ç±»å‹å®šä¹‰ä¹ˆã€‚gdnative syscrate
å°è¯•æ ¹æ®å¹³å°æ£€æµ‹å¤´æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿè®¸å¯ä»¥é€šè¿‡ C_INCLUDE_PATH ç¯å¢ƒå˜é‡æä¾›è‡ªå®šä¹‰è·¯å¾„ã€‚

```sh
> rustup toolchain install stable
> rustup toolchain install stable-x86_64-pc-windows-gnu
> rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
stable-x86_64-pc-windows-gnu
> rustc --print target-list
...
x86_64-pc-windows-gnu
x86_64-pc-windows-gnullvm
x86_64-pc-windows-msvc
...
> cargo build --target=x86_64-pc-windows-msvc
```

```rust
let mut builder = bindgen::Builder::default()
    .header("godot_headers/gdnative_api_struct.gen.h")
    .allowlist_type("godot.*")
    .allowlist_function("godot.*")
    .allowlist_var("godot.*")
    .allowlist_type("GDNATIVE.*")
    .derive_default(true)
    .ignore_functions()
    .size_t_is_usize(true)
    .ctypes_prefix("libc")
    // .clang_arg("-IC:/mingw/include")
    .clang_arg("-IC:\\Program Files (x86)\\Windows Kits\\10\\Include\\10.0.18362.0\\ucrt")
    .clang_arg("-IC:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Community\\VC\\Tools\\MSVC\\14.26.28801\\include")
    .clang_arg(format!("-I{}/godot_headers", manifest_dir));
```

é”™è¯¯çš„äº¤å‰ç¼–è¯‘é…ç½®ï¼Œå¯ä»¥ä¼šå¯¼è‡´ç±»å‹ä¸åŒ¹é…ç­‰é—®é¢˜ï¼š

    error[E0308]: mismatched types - types differ in mutability

Clang è‡ªèº«æ²¡æœ‰é…å¤‡è‡ªå·±å®Œæ•´çš„å·¥å…·é“¾ï¼Œå®ƒé€šå¸¸ä½¿ç”¨æœ¬åœ°å¹³å°ä½¿ç”¨çš„æ ‡å‡†çš„ C/C++ åº“å’Œå¤´æ–‡ä»¶ã€‚Windows å¹³å°ä¸Š
ï¼ŒVisual C++ å’Œ Mingw æ˜¯ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å·¥å…·é“¾ï¼Œåº”è¯¥æŒ‡å®šåˆé€‚çš„ target å‚æ•°:

    clang --target=i686-pc-vs2013
    clang --target=i686-pc-mingw32
    clang --target=x86_64-pc-mingw32

Rust ä¸­ä½¿ç”¨ `cpp` crate å®šä¹‰çš„ `cpp!` å®æ¥åµŒå…¥ C++ ä»£ç ï¼Œå®ƒé€šè¿‡è·å–æ‰€æœ‰çš„å†…è” C++ ä»£ç å¹¶å°†
å…¶å†™å…¥ä¸€ä¸ªå•ç‹¬çš„ cpp æ–‡ä»¶æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥æ–‡ä»¶å°†è¢«ç¼–è¯‘ä¸º Rust crate çš„æœ€ç»ˆç›®æ ‡ä»£ç ã€‚

å½“å°† Rust åº“ç»‘å®šåˆ° C/C++ æ—¶ï¼Œæ ¸å¿ƒé€»è¾‘å±‚å’Œ FFI å±‚ä¹‹é—´åº”è¯¥å­˜åœ¨æ˜æ˜¾çš„åˆ†ç¦»ã€‚åœ¨åšå¥½çš„æƒ…å†µä¸‹ï¼ŒFFI ä»£ç 
åº”è¯¥åœ¨å•ç‹¬çš„ crateï¼Œå› æ­¤è®¾è®¡ Rust API ä¸ä¼šå—åˆ° FFI çš„å¤ªå¤šå½±å“ï¼Œå¹¶ä¸”é€‰æ‹©å¯å˜æ€§ä¿®é¥°ç¬¦å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

Rust ç¼–è¯‘ç”Ÿæˆçš„åº“æ–‡ä»¶ç±»å‹æœ‰ä»¥ä¸‹è¿™äº›ï¼š

- **lib** â€” Generates a library kind preferred by the compiler, currently defaults to rlib.
- **rlib** â€” A Rust static library.
- **staticlib** â€” A native static library.
- **dylib** â€” A Rust dynamic library.
- **cdylib** â€” A native dynamic library.
- **bin** â€” A runnable executable program.
- **proc-macro** â€” Generates a format suitable for a procedural macro library that may be loaded by the compiler.

GDExtension æ‰©å±•å…¥å£å‡½æ•°åŸå‹å®šä¹‰åœ¨ gdextension\godot-codegen\input\gdnative_interface.h

```cpp
/* Define a C function prototype that implements the function below and expose it to dlopen() (or similar).
 * This is the entry point of the GDExtension library and will be called on initialization.
 * It can be used to set up different init levels, which are called during various stages of initialization/shutdown.
 * The function name must be a unique one specified in the .gdextension config file.
 */
typedef GDNativeBool (*GDNativeInitializationFunction)(const GDNativeInterface *p_interface, const GDNativeExtensionClassLibraryPtr p_library, GDNativeInitialization *r_initialization);
```

ä½¿ç”¨ #[gdextension] è¿‡ç¨‹å®å®šä¹‰å…¥å£å‡½æ•°ï¼Œé»˜è®¤å…¥å£å‡½æ•°åä¸º `gdextension_rust_init`ï¼š

```rust
/// Defines the global entry point for the GDExtension library.
///
/// Typical usage:
/// ```
/// use godot::init::{gdextension, ExtensionLibrary};
///
/// // This is just a type tag without any functionality
/// struct MyExtension;
///
/// #[gdextension]
/// unsafe impl ExtensionLibrary for MyExtension {}
/// ```
///
/// # Safety
/// By using godot-rust, you opt-in to the library's safety requirements (to be described in detail).
/// The library cannot enforce any guarantees outside Rust code, which means users need to adhere to certain rules for a safe usage.
#[proc_macro_attribute]
pub fn gdextension(meta: TokenStream, input: TokenStream) -> TokenStream {
    translate_meta(meta, input, gdextension::transform)
}
```

å‚è€ƒ GDExtension æ‰©å±•é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œå‚è€ƒæ–‡ä»¶å some.gdextensionï¼š

```sh
    [configuration]
    entry_symbol = "gdextension_rust_init"

    [libraries]
    linux.64 = "res://../../../target/debug/libsome.so"
    macos.64 = "res://../../../target/debug/libsome.dylib"
    windows.64 = "res://../../../target/debug/some.dll"
```

## ğŸŸ¡ GDExtension æ‰©å±•æœºåˆ¶
- [Introducing GDNative's successor, GDExtension](https://godotengine.org/article/introducing-gd-extensions/)
- [GDNative is here!](https://godotengine.org/article/dlscript-here/)
- [A look at the GDNative architecture](https://godotengine.org/article/look-gdnative-architecture/)
- [GLES2 and GDNative, progress report #7](https://godotengine.org/article/gles2-and-gdnative-progress-report-7/)
- [GLES2 and GDNative, progress report #6](https://godotengine.org/article/gles2-and-gdnative-progress-report-6/)
- [GLES2 and GDNative, progress report #5](https://godotengine.org/article/gles2-and-gdnative-progress-report-5/)
- [GLES2 and GDNative, progress report #4](https://godotengine.org/article/gles2-and-gdnative-progress-report-4/)
- [Waht is GDNative](https://docs.godotengine.org/en/stable/tutorials/scripting/gdnative/what_is_gdnative.html)
- [What is GDExtension?](https://docs.godotengine.org/en/latest/tutorials/scripting/gdextension/what_is_gdextension.html)
- [GDNative C Example](https://docs.godotengine.org/en/3.1/tutorials/plugins/gdnative/gdnative-c-example.html)
- [GDNative C++ Example](https://docs.godotengine.org/en/3.1/tutorials/plugins/gdnative/gdnative-cpp-example.html)
- [Function like Macros](https://gcc.gnu.org/onlinedocs/cpp/Function-like-Macros.html)
- [Common Engine Methods & Macros](https://docs.godotengine.org/en/stable/development/cpp/common_engine_methods_and_macros.html)
- [Mono .NET framework](https://www.mono-project.com/download/stable/)
- [Mono Basics](https://www.mono-project.com/docs/getting-started/mono-basics/)
- [Compiling with Mono](https://docs.godotengine.org/en/latest/contributing/development/compiling/compiling_with_mono.html)
- [Compiling for Windows](https://docs.godotengine.org/en/latest/contributing/development/compiling/compiling_for_windows.html)
- [Best practices for engine contributors](https://docs.godotengine.org/en/latest/contributing/development/best_practices_for_engine_contributors.html)
- [Engine core and modules](https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/index.html)
- [Custom modules in C++](https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/custom_modules_in_cpp.html)
- godot-3.5.1-stable\modules\gdnative\gdnative.h
- godot\core\extension\gdextension_interface.h

Godot Engine development - Best practices for engine contributors

#1: The problem always comes first
#2: To solve the problem, it has to exist in the first place
#3: The problem has to be complex or frequent
#4: The solution must be discussed with others
#5: To each problem, its own solution
#6: Cater to common use cases, leave the door open for the rare ones
#7: Prefer local solutions
#8: Don't use complex canned solutions for simple problems

![breaks down problem](https://docs.godotengine.org/en/latest/_images/best_practices6.png)

GDNative æ˜¯æ—§ç‰ˆæœ¬ Godot æ‰©å±•æ–¹æ¡ˆï¼Œä½¿ç”¨åŸå§‹ C API æ¯”è¾ƒç¹æ‚ï¼Œå¯¹ç§»æ¤å¾ˆä¸å‹å¥½ã€‚Godot 4 ä½¿ç”¨å…¨æ–°çš„
GDExtensionï¼Œè¿™ä¸ªæ–°çš„æ‰©å±•æœºåˆ¶ API æ›´è½»é‡åŒ–ï¼ä»»ä½•å¯ä»¥ç¼–è¯‘ä¸ºåŠ¨æ€åº“çš„è¯­è¨€ä¸­ï¼Œéƒ½å¯ä»¥è½»æ˜“åœ°ç¼–å†™ä¸
Godot 4 äº¤äº’çš„èƒ¶æ°´å±‚ã€‚å¹¶ä¸”ï¼ŒåŸºäº GDExtension å¼€å‘çš„æ‰©å±•ç±»å‹ä¸ Godot å†…ç½®ç±»å‹æ²¡æœ‰åŒºåˆ«ã€‚

æ€»çš„æ¥è¯´ï¼Œæœ‰å¤šç§åŸºæœ¬æ–¹æ³•æ¥æ‰©å±• Godotï¼Œå‰ä¸¤ç§éœ€è¦é‡æ–°ç¼–è¯‘å¼•æ“ï¼Œåé¢ä¸¤ç§åªéœ€è¦ç¼–è¯‘æ‰©å±•éƒ¨åˆ†ã€‚è€Œæœ€å
ä¸€ç§å¯ä»¥è¯´æœ€æ–¹ä¾¿ï¼Œæ²¡æœ‰ç¼–è¯‘è¿‡ç¨‹ï¼Œå¯ä»¥ç¼–å†™ Godot ç¼–è¾‘å™¨å·¥å…·è„šæœ¬ã€‚è„šæœ¬ç”¨ `tool` æˆ– `@tool` å¼€å¤´ï¼Œ
è¿™æ ·çš„è„šæœ¬å°±ä¼šåœ¨ç¼–è¾‘å™¨è¿è¡Œï¼Œè€Œä¸å¿…ç­‰åˆ°æ¸¸æˆè¿è¡Œæ—¶ã€‚å¦å¤–è¿˜å¯ä»¥ç¼–å†™ç¼–è¾‘å™¨æ’ä»¶ï¼Œå®Œå–„ç°æœ‰ Godot åŠŸèƒ½ï¼š

- Godot source development
- C++ Modules (like /modules/gdnative, /modules/gdscript )
- GDNative Extension (Godot 3.x)
- GDExtension (Godot 4.x)
- GDScript (all versions, tool script, editor plugins)

å¯ä»¥è¯´å¼€å‘è‡ªå®šä¹‰ C++ æ¨¡å—æ˜¯æœ€ç›´è§‚çš„ï¼Œå°±åƒ Godot å¼€å‘è€…ä¸€æ ·ï¼Œåœ¨ modules ç›®å½•ä¸‹ç»™ Godot æ·»åŠ å„
ç§æ¨¡å—ã€‚è¿™ç§æ–¹æ³•éœ€è¦é‡æ–°ç¼–è¯‘ Godot æºä»£ç ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸èŠ±æ—¶é—´çš„è¿‡ç¨‹ã€‚å¦‚æœè¿˜è¦æ”¯æŒ C# è¯­è¨€ï¼Œåˆ™è¿˜éœ€è¦
é…ç½® Mono SDKã€‚

æ— è®ºå¦‚ä½•æ‰©å±• Godotï¼Œæœ‰ä¸€ä¸ªç±»æ˜¯å§‹ç»ˆç¦»ä¸å¼€çš„ï¼š`ClassDB` ç±»å‹ä¿¡æ¯åº“ã€‚Godot æ‰€æœ‰å†…ç½®ç±»å‹éƒ½æ³¨å†Œåœ¨è¿™é‡Œã€‚

å¼€å‘ GDExtension æ‰©å±•ï¼Œç³»ç»Ÿç¯å¢ƒè¦æ±‚ï¼š

01. a Godot 4.x executable,
02. a C++ compiler,
03. SCons as a build tool,
04. a copy of the godot-cpp repository

è€Œä½¿ç”¨ GDNaive æˆ– GDExtension æ‰©å±•æ¨¡å—è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œåˆ™å…å»é‡æ–°ç¼–è¯‘å¼•æ“æºä»£ç ï¼Œä½¿ç”¨åŠ¨æ€é“¾æ¥åº“ã€‚
æœ‰ä¸‰ä¸ªåœ°æ–¹å¯ä»¥è·å–åˆ°æ‰©å±• Godot çš„å¤´æ–‡ä»¶èµ„æºï¼š

- [Godot Source](https://github.com/godotengine/godot)
- [GDExtension header and API](https://github.com/godotengine/godot-cpp)
- [GDNative Extensions API headers](https://github.com/godotengine/godot-headers)

å¼•å…¥ GDNative çš„ç›®çš„ä¸»è¦æœ‰ä¸¤ä¸ªï¼Œè§£å†³æ€§èƒ½ç“¶é¢ˆä¸æ¥å…¥ç¬¬ä¸‰æ–¹ä»£ç ï¼š

- performance critical code.
- binding third party code to Godot.

Godot æœ¬èº«ä½¿ç”¨ GDNative å®ç°å„ç§åŠŸèƒ½ï¼Œå…¶ä¸­å°±æœ‰ NativeScriptï¼Œæºä»£ç ä½äº modules/gdnative
ç›®å½•ä¸‹ã€‚

- godot-3.5.1-stable\modules\gdnative\gdnative.h
- godot-3.5.1-stable\modules\gdnative\nativescript\nativescript.h

æ‰€è°“ NativeScriptï¼Œå°±æ˜¯å°† C/C++ ç¼–è¯‘å¾—åˆ°çš„åŠ¨æ€è¿æ¥åº“æŒ‰ GDNative è§„åˆ™ä¾› Godot è°ƒç”¨ï¼Œä½†æ˜¯åˆ
åƒç”¨ GDScript è„šæœ¬ä¸€æ ·æ–¹ä¾¿åœ°ä½¿ç”¨å„ç§èŠ‚ç‚¹è¿›è¡Œå¼€å‘ã€‚ä½¿ç”¨ `GDNativeLibrary` (.gdnlib) èµ„æºåŠ è½½
åŠ¨æ€è¿æ¥åº“ï¼Œå…¶å®ƒå®ƒå°±æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè®°å½•ä¸åŒå¹³å°ä¸‹ä½¿ç”¨çš„åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ã€‚ä½¿ç”¨ `NativeScript` (.gdns)
èµ„æºå‘Šè¯‰ Godot åŠ¨æ€é“¾æ¥åº“ä¸­çš„ç±»å‹ä¿¡æ¯ã€‚

```py
extends Control

# load the Simple library
onready var data = preload("res://bin/simple.gdns").new()

func _on_Button_pressed():
    $Label.text = "Data = " + data.get_mock_data()
```

GDNativeLibrary åŠ¨æ€åº“é…ç½®èµ„æºæ–‡æœ¬æ–‡ä»¶å†…å®¹å‚è€ƒï¼š

```sh
    [general]

    singleton=false
    load_once=true
    symbol_prefix="godot_"
    reloadable=true

    [entry]

    OSX.64="res://bin/libsimple.dylib"
    OSX.32="res://bin/libsimple.dylib"
    Windows.64="res://bin/libsimple.dll"
    X11.64="res://bin/libsimple.so"

    [dependencies]

    OSX.64=[  ]
    OSX.32=[  ]
    Windows.64=[  ]
    X11.64=[  ]
```

åŠ¨æ€åº“çš„å…¥å£å‡½æ•°åŠåˆå§‹åŒ–ã€ç»“æŸç­‰å‡½æ•°åç§°å®šä¹‰åœ¨ gdnative.cpp æ–‡ä»¶ä¸­ï¼š

```C++
    static const String init_symbol = "gdnative_init";
    static const String terminate_symbol = "gdnative_terminate";
    static const String default_symbol_prefix = "godot_";
```


å¼€å‘ Godot æ‰©å±•çš„æ ‡é…æ˜¯å®˜æ–¹æä¾›çš„ godot-cppï¼Œè¿™æ˜¯å®˜æ–¹ C++ æ‰©å±•é›†æˆåº“ã€‚æ³¨æ„ï¼Œgodot-cpp ä»“åº“
åœ¨ä¸åŒåˆ†æ”¯ä¸Šç®¡ç†ä¸åŒç‰ˆæœ¬çš„æ‰©å±•æ–¹æ¡ˆï¼š

- **master** åˆ†æ”¯å¯¹åº” Godot 4.0 (GDExtension)
- **3.5** è¿™äº›æŒ‡å®šç‰ˆæœ¬å·çš„åˆ†æ”¯å¯¹åº” Godot 3.x (GDNative)

```sh
> git clone git@github.com:godotengine/godot-cpp
Cloning into 'godot-cpp'...
remote: Enumerating objects: 7557, done.
remote: Counting objects: 100% (1364/1364), done.
remote: Compressing objects: 100% (280/280), done.
remote: Total 7557 (delta 1165), reused 1143 (delta 1076), pack-reused 6193
Receiving objects: 100% (7557/7557), 7.25 MiB | 566.00 KiB/s, done.
Resolving deltas: 100% (4824/4824), done.
> git branch -a
* master
  remotes/origin/3.0
  remotes/origin/3.1
  remotes/origin/3.2
  remotes/origin/3.3
  remotes/origin/3.4
  remotes/origin/3.5
  remotes/origin/3.x
  remotes/origin/HEAD -> origin/master
  remotes/origin/master
  remotes/origin/nativescript-1.0
  remotes/origin/nativescript-1.1
```

GDNative å’Œ GDExtension éƒ½æ˜¯å¯ä»¥é¿å…é‡æ–°ç¼–è¯‘ Godot æºä»£ç è€Œè¿›è¡ŒåŠŸèƒ½æ‰©å±•çš„æ–¹æ³•ï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äº
Godot 3.x å’Œ Godot 4.xã€‚å‰è€…ä½¿ç”¨ C APIï¼Œç¨æ˜¾ç¹æ‚ï¼Œä¸ Godot æœ¬èº«ä½¿ç”¨çš„ C++ å¼€å‘çš„æ–¹å¼æœ‰ç‚¹ä¸
ä¸€è‡´ã€‚è€Œæ–°ç‰ˆæœ¬çš„ GDExtension åˆ™æ”¹ç”¨ C++ ç»‘å®šï¼Œä¸ Godot æºä»£ç ä½¿ç”¨çš„ C++ æ›´åè°ƒã€‚

å¦‚æœç°æœ‰çš„å¤´æ–‡ä»¶ä¸ API json æ–‡ä»¶æ²¡æ›´æ–°ä¸ºæ‰€ä½¿ç”¨çš„ Godot ç‰ˆæœ¬ï¼Œå¯ä»¥ç¼–è¯‘ç›¸åº”ç‰ˆæœ¬çš„ Godotï¼Œå¹¶æ‰§è¡Œ
ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ **extension_api.json** æ–‡ä»¶ï¼Œå¹¶å–å¾—ç›¸åº”çš„ gdextension_interface.h å¤´æ–‡ä»¶ï¼š

    godot --dump-extension-api --dump-gdextension-interface


Function-like Macros åƒå‡½æ•°ä¸€æ ·ï¼Œä½†æ˜¯å…¶æ ¼å¼æ›´ä¸¥æ ¼ï¼Œå®ååé¢å¤šä¸€ä¸ªç©ºæ ¼éƒ½ä¸ä¸€æ ·ã€‚å®ç¼–ç¨‹å¸¸å¸¸è¢«çœ‹ä½œ
æ˜¯ä¸€ç§é«˜çº§åˆ«çš„ç¼–ç¨‹æŠ€æœ¯ï¼Œè®¸å¤šå¤§å‹å·¥ç¨‹éƒ½æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œä½†åŒæ—¶æƒ³ç”¨å¥½å®ƒçœŸçš„ä¸å®¹æ˜“ã€‚

ä»¥ä¸‹æ˜¯å®å‡½æ•°çš„å‡ ç§ç¤ºèŒƒï¼ŒåŠå…¶å¯¹åº”çš„å±•å¼€å†…å®¹ï¼š

```C++,ignore
#define lang_init()  c_init()
// lang_init()
//      â†’ c_init()

#define lang_init ()    c_init()
// lang_init()
//      â†’ () c_init()()

extern void foo(void);
#define foo() /* optimized inline version */
// â€¦
//   foo();
//   funcptr = foo;
```

æ³¨æ„æœ€åä¸€ç§ï¼Œåªå®šä¹‰äº†å®åè€Œæ²¡æœ‰å®ä½“ï¼Œå½“æœ‰ä¸€ä¸ªåŒåå‡½æ•°ï¼Œå¹¶ä¸”æœ‰æ—¶å¸Œæœ›ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚
ä½¿ç”¨å®å‡½æ•°åªæœ‰åœ¨å…¶åç§°åé¢å‡ºç°ä¸€å¯¹æ‹¬å·æ—¶æ‰ä¼šå±•å¼€ï¼Œå¦‚æœåªå†™åç§°ï¼Œå®ƒå°†è¢«ä¿ç•™ã€‚åœ¨è¿™é‡Œï¼Œfoo() å°†è°ƒç”¨å®ï¼Œ
å±•å¼€å†…å®¹ä¸ºç©ºã€‚ä½†å‡½æ•°æŒ‡é’ˆå°†è·å¾—å®é™…å‡½æ•°çš„åœ°å€ï¼Œå¦‚æœè¦æ‰©å±•å®ï¼Œåˆ™ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚

ä½¿ç”¨ GCC ç¼–è¯‘å™¨çš„ -E é€‰é¡¹å¯ä»¥å¯¹å®å®šä¹‰çš„å†…å®¹è¿›è¡Œæ‰©å±•ï¼Œå³åªåšé¢„å¤„ç†ï¼Œè€Œä¸ç¼–è¯‘ã€é“¾æ¥ç¨‹åºï¼š

```sh
    g++ -IC:\godot -IC:\godot\platform\windows -E .\demo.cpp >> out.h
    g++ -IC:\godot -IC:\godot\platform\windows -E .\demo.cpp 2>&1 >> out.h
```

å®å®šä¹‰ä¸­æœ‰ä¸‰ä¸ªç‰¹åˆ«æœ‰ç”¨çš„ç‰¹æ®Šæ‰©å±•ç¬¦å·ï¼š`#`ï¼Œ`##`ï¼Œ`#@`

- `x##y` è¡¨ç¤º x æ‹¼æ¥ yï¼Œæ•°å€¼æˆ–å­—ç¬¦ä¸²ï¼›
- `#@x` ç»™ x åŠ ä¸Šå•å¼•å·ï¼Œç»“æœè¿”å›æ˜¯ä¸€ä¸ª const charã€‚ä¸¾ä¾‹è¯´ï¼š
- `#x` åŸæ„æ˜¯ç»™ x åŠ åŒå¼•å·å˜æˆå­—ç¬¦ä¸²ï¼š

æ³¨æ„ï¼Œå®å®šä¹‰å¯ä»¥åµŒå¥—å®è°ƒç”¨ï¼Œä½†æ˜¯ä½¿ç”¨'#'æˆ–'##'æ‰©å±•åï¼Œå®å†…å®¹å³ä½¿æ˜¯ä¸€ä¸ªå®åï¼Œä¹Ÿä¸ä¼šå†è¿›è¡Œå®è°ƒç”¨ã€‚

ANSI æ ‡å‡†è¿˜è¯´æ˜äº†äº”ä¸ªé¢„å®šä¹‰çš„å®åï¼Œå®ƒä»¬åˆ†åˆ«å¯ä»¥è·å–æºä»£ç æ–‡ä»¶åã€å½“å‰è¡Œå·ï¼Œæ—¥æœŸæ—¶é—´ç­‰ç­‰ï¼š 

```c,ignore
    __LINE__ /* %d */
    __FILE__ /* %s */
    __DATE__ /* %s */
    __TIME__ /* %s */
    __FUNCTION__  or __func__
```


Godot 4.0 RC 1 ç‰ˆæœ¬ä»£ç ä¸­ä½¿ç”¨äº†æ›´ä¸°å¯Œçš„å®ç¼–ç¨‹ï¼Œå¯ä»¥å‡å°‘ä»£ç é‡ï¼Œä½†ä¸€å®šç¨‹åºåº¦ä¸Šç»™ä»£ç é˜…è¯»å¢åŠ éš¾åº¦ï¼š

```C++,ignore
    // godot\core\object\object.h:344
    // _gdvirtual__poll_call<false>(__VA_ARGS__)
    #define GDVIRTUAL_CALL(m_name, ...) _gdvirtual_##m_name##_call<false>(__VA_ARGS__)
    #define GDVIRTUAL_CALL_PTR(m_obj, m_name, ...) m_obj->_gdvirtual_##m_name##_call<false>(__VA_ARGS__)

    #ifdef DEBUG_METHODS_ENABLED
    #define GDVIRTUAL_BIND(m_name, ...) ::ClassDB::add_virtual_method(get_class_static(), _gdvirtual_##m_name##_get_method_info(), true, sarray(__VA_ARGS__));
    #else
    #define GDVIRTUAL_BIND(m_name, ...)
    #endif

    // godot\scene\main\multiplayer_api.h:84
    class MultiplayerAPIExtension : public MultiplayerAPI {
        GDCLASS(MultiplayerAPIExtension, MultiplayerAPI);
        // ...
        // Extensions
        GDVIRTUAL0R(Error, _poll);
        GDVIRTUAL1(_set_multiplayer_peer, Ref<MultiplayerPeer>);
        GDVIRTUAL0R(Ref<MultiplayerPeer>, _get_multiplayer_peer);
        GDVIRTUAL0RC(int, _get_unique_id);
        GDVIRTUAL0RC(PackedInt32Array, _get_peer_ids);
        GDVIRTUAL4R(Error, _rpc, int, Object *, StringName, Array);
        GDVIRTUAL0RC(int, _get_remote_sender_id);
        GDVIRTUAL2R(Error, _object_configuration_add, Object *, Variant);
        GDVIRTUAL2R(Error, _object_configuration_remove, Object *, Variant);
    };

    // godot\scene\main\multiplayer_api.cpp:84
    Error MultiplayerAPIExtension::poll() {
        Error err = OK;
        GDVIRTUAL_CALL(_poll, err);
        return err;
    }

    void MultiplayerAPIExtension::_bind_methods() {
        GDVIRTUAL_BIND(_poll);
        GDVIRTUAL_BIND(_set_multiplayer_peer, "multiplayer_peer");
        GDVIRTUAL_BIND(_get_multiplayer_peer);
        GDVIRTUAL_BIND(_get_unique_id);
        GDVIRTUAL_BIND(_get_peer_ids);
        GDVIRTUAL_BIND(_rpc, "peer", "object", "method", "args");
        GDVIRTUAL_BIND(_get_remote_sender_id);
        GDVIRTUAL_BIND(_object_configuration_add, "object", "configuration");
        GDVIRTUAL_BIND(_object_configuration_remove, "object", "configuration");
    }

    // godot\core\extension\gdextension_interface.h
    typedef void (*GDExtensionClassCallVirtual)(GDExtensionClassInstancePtr p_instance, const GDExtensionConstTypePtr *p_args, GDExtensionTypePtr r_ret);
    typedef GDExtensionClassCallVirtual (*GDExtensionClassGetVirtual)(void *p_userdata, GDExtensionConstStringNamePtr p_name);
```

å‰é¢çš„ `GDVIRTUAL_CALL(_poll, err)` å°±æ˜¯è°ƒç”¨ç”Ÿæˆçš„ `_gdvirtual__poll_call()` è¿™ä¸ªå‡½æ•°ã€‚
è¿™ä¸ªå‡½æ•°æ˜¯é€šè¿‡ Python è„šæœ¬ç”Ÿæˆçš„ï¼Œç›´æ¥åœ¨æºä»£ç ä¸­æœç´¢ä¸åˆ°ã€‚

æºä»£ç ä¸­æœ‰ä¸€ä¸ª make_virtuals.py è„šæœ¬ï¼Œæ‰§è¡Œ scons æ„å»ºå·¥å…·æ—¶ï¼Œä¼šç”Ÿæˆ gdvirtual.gen.inc ä»£ç 
æ–‡ä»¶ï¼ŒåŒ…å«æœ‰ä¸€ç³»åˆ—çš„å®å‡½æ•°ã€‚åç§°æŒ‰ `GDVIRTUAL$VER` æ¨¡æ¿æ ¼å¼ï¼Œåç¼€æ ‡è®°æœ‰ R (return)ï¼ŒC (const)ã€‚
åˆ†åˆ«è¡¨ç¤ºç”Ÿæˆçš„ä»£ç ä¸­çš„è¿”å›ç±»å‹ï¼Œåå‡½æ•°ç­¾åä¸­çš„ const å£°æ˜ã€‚å…± 52 ä¸ªï¼Œ13 ä¸ªç‰ˆæœ¬ï¼Œæ¯ç‰ˆæœ¬ 4 ä¸ªåç¼€ç»„åˆã€‚
è¿™äº›ç”Ÿæˆä»£ç ä¸ GDExtension æ‰©å±•æ¨¡å—ç›¸å…³ï¼Œ**GDExtensionClassCallVirtual** æ˜¯æ‰©å±•ä¸­è™šå‡½æ•°æŒ‡é’ˆã€‚

MultiplayerAPI å¤´æ–‡ä»¶ä¸­ä¼šä½¿ç”¨ Python è„šæœ¬ç”Ÿæˆçš„ GDVIRTUAL0Cã€ GDVIRTUAL0RC ç­‰ç­‰è¿™äº›å®å‡½æ•°
æ¥ç”Ÿæˆç±»å£°æ˜ï¼Œä»¥åŠé»˜è®¤çš„æ–¹æ³•å®ç°ã€‚`GDVIRTUAL_CALL` å®å°±æ˜¯è°ƒç”¨è¿™äº›å®å‡½æ•°ç”Ÿæˆçš„é»˜è®¤æ–¹æ³•å®ç°ã€‚

ä»¥ä¸‹å°±æ‘˜å–å…¶ä¸­ä¸€ä¸ªå®å®šä¹‰ï¼Œå±•ç¤ºå…¶å±•å¼€åä¼šäº§ç”Ÿçš„å…¨å±€ç¬¦å·ï¼Œåç¼€ RC å·®åˆ«åœ¨äºç”Ÿæˆå‡½æ•°çš„å‚æ•°ã€å˜é‡ç±»å‹ï¼Œ
å’Œå‡½æ•°ç­¾åä¸­çš„ const ç¬¦å·ï¼Œç‰ˆæœ¬å· `$VER` å¯¹åº”çš„æ•°å€¼ä¸ºå®å‡½æ•°å¯æ¥æ”¶çš„ç±»å‹å‚æ•°ä¸ªæ•°ï¼Œæœ€é«˜ç‰ˆæœ¬å·ä¸º
12ï¼Œå¯¹åº”ç±»å‹å‚æ•°æœ€å¤šæœ‰ 12 ä¸ªã€‚å¦å¤–ï¼ŒåŠ ä¸Š m_ret å’Œ m_name ä¸¤ä¸ªå‚æ•°ï¼Œæœ€å¤šæœ‰ 14 ä¸ªå®å‚æ•°ï¼Œå¯¹åº”çš„
è™šå‡½æ•°ç”Ÿæˆå®å°±æ˜¯ `GDVIRTUAL12R` å’Œ `GDVIRTUAL12RC`ã€‚

```C++,ignore
    #define GDVIRTUAL0RC(m_ret,  m_name ) \
    StringName _gdvirtual_##m_name##_sn = #m_name;\
    mutable bool _gdvirtual_##m_name##_initialized = false;\
    mutable GDExtensionClassCallVirtual _gdvirtual_##m_name = nullptr;\
    template<bool required>\
    _FORCE_INLINE_ bool _gdvirtual_##m_name##_call( m_ret& r_ret) const { /* ... */ }\
    _FORCE_INLINE_ bool  _gdvirtual_##m_name##_overridden() const { /* ... */ }\
    _FORCE_INLINE_ static MethodInfo _gdvirtual_##m_name##_get_method_info() { /* ... */ }\


    #define GDVIRTUAL0C( m_name ) \
    _FORCE_INLINE_ bool _gdvirtual_##m_name##_call() const //...


    #define GDVIRTUAL0RC(m_ret,  m_name ) \
    _FORCE_INLINE_ bool _gdvirtual_##m_name##_call( m_ret& r_ret) const //...


    #define GDVIRTUAL3( m_name , m_type1, m_type2, m_type3) \
    _FORCE_INLINE_ bool _gdvirtual_##m_name##_call(m_type1 arg1, m_type2 arg2, m_type3 arg3) //...
```

è¦ç”¨å®ƒä»¬ç”Ÿæˆè™šå‡½æ•°é»˜è®¤å®ç°ï¼Œå°±å°†è¦ç”Ÿæˆçš„ç›®æ ‡å‡½æ•°çš„å‚æ•°ç±»å‹ä¾æ¬¡ä¼ å…¥å®å‡½æ•°ä¸­ã€‚ä¾‹å¦‚ï¼Œä»¥ `_rpc` è¿™ä¸ª
è™šæ‹Ÿå‡½æ•°ä¸ºä¾‹ï¼Œä¸ºå®ƒç”Ÿæˆé»˜è®¤çš„å‡½æ•°å®ç°ï¼š

    GDVIRTUAL4R(Error, _rpc, int, Object *, StringName, Array);

æ ¹æ®è™šå‡½æ•°ç”Ÿæˆå®çš„åç§°è§„åˆ™ï¼Œ4R ä»£è¡¨æœ‰è¿”å›ç±»å‹ï¼Œå‡½æ•° 4 ä¸ªå‚æ•°ç±»å‹ä¸º int, Object * , StringName, Arrayã€‚


ä»¥ä¸Š MultiplayerAPIExtension ç»‘å®šçš„è™šå‡½æ•°å’Œæ–‡æ¡£æ˜¾ç¤ºçš„å¯¹åº”å…³ç³»ï¼š

```py
 MultiplayerPeer _get_multiplayer_peer() virtual
PackedInt32Array _get_peer_ids() virtual const
             int _get_remote_sender_id() virtual const
             int _get_unique_id() virtual const
           Error _object_configuration_add(object: Object, configuration: Variant) virtual
           Error _object_configuration_remove(object: Object, configuration: Variant) virtual
           Error _poll() virtual
           Error _rpc(peer: int, object: Object, method: StringName, args: Array) virtual
            void _set_multiplayer_peer(multiplayer_peer: MultiplayerPeer) virtual
```

è¿™äº›æ–¹æ³•åœ¨çˆ¶ç±» MultiplayerAPI ä¸­å…¨éƒ½æ˜¯å®šä¹‰ä¸ºçº¯è™šå‡½æ•°ï¼š

```C++,ignore
    // godot\scene\main\multiplayer_api.h:37
    class MultiplayerAPI : public RefCounted {
        GDCLASS(MultiplayerAPI, RefCounted);
        // ...
        virtual Error poll() = 0;
        virtual void set_multiplayer_peer(const Ref<MultiplayerPeer> &p_peer) = 0;
        virtual Ref<MultiplayerPeer> get_multiplayer_peer() = 0;
        virtual int get_unique_id() = 0;
        virtual Vector<int> get_peer_ids() = 0;

        virtual Error rpcp(Object *p_obj, int p_peer_id, const StringName &p_method, const Variant **p_arg, int p_argcount) = 0;
        virtual int get_remote_sender_id() = 0;

        virtual Error object_configuration_add(Object *p_object, Variant p_config) = 0;
        virtual Error object_configuration_remove(Object *p_object, Variant p_config) = 0;
    };
```


## ğŸŸ¡ Godot with CSharp
- http://www.mono-project.com/docs/about-mono/compatibility
- https://docs.godotengine.org/en/3.5/tutorials/scripting/c_sharp/c_sharp_features.html
- https://docs.godotengine.org/en/3.5/tutorials/scripting/c_sharp/c_sharp_differences.html
- https://docs.godotengine.org/en/stable/tutorials/scripting/cross_language_scripting.html
- https://docs.godotengine.org/en/stable/tutorials/scripting/creating_script_templates.html
- https://docs.godotengine.org/en/stable/development/compiling/compiling_with_mono.html
- https://docs.godotengine.org/en/latest/contributing/development/compiling/compiling_with_mono.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/index.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/c_sharp_basics.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/c_sharp_exports.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/c_sharp_differences.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/c_sharp_signals.html
- https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/object_class.html#doc-binding-properties-using-set-get-property-list
- [Bunnymark](https://github.com/cart/godot3-bunnymark)
- [Godot.NET.Sdk](https://www.nuget.org/packages/Godot.NET.Sdk/#versions-body-tab)
- [Mono SDK](https://www.mono-project.com/download/stable/#download-lin)
- [.NET SDK](https://dotnet.microsoft.com/download)
- [C# support on Android](https://godotengine.org/article/csharp-android-support/)
- [Godot 3.5.1 Mono](https://downloads.tuxfamily.org/godotengine/3.5.1/mono/)
- [What's new in C# for Godot 4.0](https://godotengine.org/article/whats-new-in-csharp-for-godot-4-0/)
- [CustomType for Godot 3.x](https://github.com/Jeangowhy/Godot-Tour/tree/main/mono-3x/addons/CustomType)
- [CustomType for Godot 4.x](https://github.com/Jeangowhy/Godot-Tour/tree/4.x/mono-4x/addons/CustomType)
- godot-docs\tutorials\scripting\c_sharp\c_sharp_basics.rst

Godot æœ‰ä¸¤å¥—è¯­è¨€æ”¯æŒæ„å»ºï¼š

- é»˜è®¤çš„æ”¯æŒ GDScriptï¼ŒGDExtension
- å¦ä¸€å¥—åˆ™é›†æˆäº† .NET 6 æ”¯æŒ C#, GDScript, GDExtensionã€‚

è¦ä½¿ç”¨ C# è¯­è¨€è¿›è¡Œ Godot é¡¹ç›®å¼€å‘ï¼Œç³»ç»Ÿä¸Šéœ€è¦å®‰è£… .NET SDK 6.0 æˆ– 7.0ï¼Œ.NET 7.0 çš„æ”¯æŒè¿˜ä¸å®Œå–„ã€‚
ç›¸æ¯” GDScript è„šæœ¬ï¼ŒC# æ˜¯ä¸€ä¸ªç¼–è¯‘å‹çš„é«˜çº§è¯­è¨€ï¼ŒGodot é€šè¿‡å¼€æºçš„ Mono 6.x æ¡†æ¶æ”¯æŒ C# 8.0 è¯­è¨€ç‰ˆæœ¬ã€‚
ä¸ä½œç”¨å¿«é€ŸåŸå‹å¼€å‘ä½¿ç”¨ GDScript è„šæœ¬ä¸åŒï¼Œæ¯æ¬¡æ‰§è¡Œä¹‹å‰éƒ½éœ€è¦è¿›è¡Œç¼–è¯‘ï¼Œä»¥ç”Ÿæˆæœ€æ–°çš„ C# ç¨‹åºé›†ã€‚ä½†æ˜¯ï¼Œ
ä½œä¸ºé¢„ç¼–è¯‘è¯­è¨€ï¼Œå®ƒçš„è¿è¡Œæ•ˆç‡è™½ç„¶ä¸èƒ½å’Œ C++ çœ‹é½ï¼Œä½†æ¯” GDSCript æœ‰éå¸¸å¤§çš„æ•ˆç‡æå‡ï¼Œç®€å•æƒ…å†µæœ‰ 4x æå‡ã€‚
å¹¶ä¸”ï¼Œåœ¨ä½¿ç”¨çš„ä¾¿åˆ©ç¨‹åºä¸Šï¼Œè¦æ¯” C++ å¥½ï¼Œæ‰€ä»¥åœ¨ä¸æ˜¯æé™æ€§èƒ½éœ€è¦æƒ…å†µä¸‹ï¼ŒC# æ˜¯å€¼å¾—ä¸€è¯•çš„æ–¹æ¡ˆã€‚

æ€ä¹ˆé€‰å¼€å‘è¯­è¨€ï¼Œå°±æ˜¯æƒè¡¡å¼€å‘æ•ˆç‡ä¸ç¨‹åºè¿è¡Œæ€§èƒ½ï¼š

- é€‰æ‹© GDScript å¯ä»¥å¿«é€Ÿåœ°åšåŸå‹è¿­ä»£ï¼›
- é€‰æ‹© C# ä¸€æ–¹é¢æå‡äº†æ€§èƒ½ï¼Œå¦å¤–å®ƒæ¯” C++/Rust æ›´å®¹æ˜“ä¸Šæ‰‹ï¼ŒåŒæ—¶ç¼–è¯‘é€Ÿåº¦ä¹Ÿä¸å¤ªæ…¢ï¼›
- æœ€åï¼Œæè‡´æ€§èƒ½è¦æ±‚ï¼Œé‚£ä¹ˆå°±é€‰æ‹© C++/Rust æŠ˜è…¾å»å§ï¼

å‚è€ƒ Bunnymark V2 æµ‹è¯•æ•°æ®ï¼Œæ•°å€¼è¶Šå¤§è¶Šå¥½ï¼Œæµ‹è¯• Sprite ç»˜åˆ¶å¹¶ä½¿ç”¨ GetChildren() è¿­ä»£ï¼š

| Language             | Bunnies Rendered |
|----------------------|------------------|
| ECMAScript/Javascript| 4660             |
| GDScript (Release)   | 18560            |
| C#/Mono              | 27555            |
| GDNative (D)         | 28020            |
| GDNative (Nim)       | 29920            |
| GDNative (C++)       | 37480            |

æµ‹è¯•å¹³å°ä¿¡æ¯ï¼š

    ### Hardware:

    * CPU: Intel i7 7700k 4.2GHz
    * GPU: Nvidia GeForce GTX 1070
    * RAM: 16GB DDR4

    ### Build Info:

    * OS: Arch Linux
    * Official Godot 3.1 release

Godot 4 RC6 ä¸´æ—¶å°† Mono æ”¹ä¸ºé›†æˆ .NET 6ã€‚


### ğŸŸ ğŸ”µ VScode Settings
- [Visual Studio Code](https://code.visualstudio.com/)
- [Using GCC with MinGW](https://code.visualstudio.com/docs/cpp/config-mingw)
- [Debug C++ in Visual Studio Code](https://code.visualstudio.com/docs/cpp/cpp-debug)
- [Configure C/C++ debugging](https://code.visualstudio.com/docs/cpp/launch-json-reference)
- [launch.json - VS Code Debugers Launch](https://code.visualstudio.com/docs/editor/debugging)
- [tasks.json - Integrate with External Tools via Tasks](https://code.visualstudio.com/docs/editor/tasks)

Godot 3.2.3 å¼€å§‹ï¼Œä¸éœ€å®‰è£… Mono SDKï¼Œé™¤ééœ€è¦ä»æºä»£ç æ„å»º Godotï¼Œä½†æ˜¯ .NET SDK è¿˜æ˜¯è¦å®‰è£…ã€‚
æ³¨æ„ï¼Œä½¿ç”¨çš„ Godot è¦ä¸ SDK çš„ç‰ˆæœ¬æ¯”ç‰¹ä½ä¸€è‡´ï¼Œå»ºè®®ä½¿ç”¨ 64-bit çš„ç‰ˆæœ¬ã€‚ç”±äº Godot åªæä¾›äº† C#
çš„æœ€å°æ”¯æŒï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–éƒ¨ç¼–è¾‘å™¨ï¼Œå¦‚ Visual Studio Codeï¼Œä»¥æä¾›æ›´å®Œå–„çš„è‡ªåŠ¨å®Œæˆã€è°ƒè¯•ç­‰åŠŸèƒ½ã€‚
Godot ç›®å‰æ”¯æŒä»¥ä¸‹ä½œç”¨å¤–éƒ¨ç¼–è¾‘å™¨ï¼Œå¯ä»¥é€šè¿‡ Editor â†’ Editor Settings â†’ Mono â†’ Editor ä¿®æ”¹ï¼š

- Visual Studio 2019
- Visual Studio Code
- MonoDevelop
- Visual Studio for Mac
- JetBrains Rider

ä»¥ VSCode é…ç½®ä¸ºä¾‹ï¼Œæœ€æ–°çš„ Godot 4 ä¸éœ€è¦é…ç½® Buildsï¼š

- Set **Mono** -> **Editor** -> **External Editor** to **Visual Studio Code**.
- Set **Mono** -> **Builds** -> **Build Tool** to **dotnet CLI**.

å¹¶ä¸”åœ¨ Visual Studio Code ä¸­å®‰è£…ä»¥ä¸‹æ‰©å±•ï¼š

- [C#](https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.csharp)
- [Mono Debug](https://marketplace.visualstudio.com/items?itemName=ms-vscode.mono-debug)
- [C# Tools for Godot](https://marketplace.visualstudio.com/items?itemName=neikeq.godot-csharp-vscode)
- [C/C++ for Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools)

C# Tools for Godot æ‰©å±•æ”¯æŒ Godot 3.2.2 ä»¥ä¸Šç‰ˆæœ¬ï¼Œå¯ä»¥æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- Debugging.
- Launch a game directly in the Godot editor from VSCode.
- Additional code completion for Node paths, Input actions, Resource paths, Scene paths and Signal names.

å¦‚æœä½¿ç”¨ Linux æ“ä½œç³»ç»Ÿï¼Œéœ€è¦å®‰è£… Mono SDK ä»¥æ”¯æŒ Godot çš„ C# å·¥å…·æ’ä»¶ã€‚

é…ç½® VSCdoe ä»¥å®ç° Godot å·¥ç¨‹çš„è¿è¡Œï¼š

- æŒ‰èœå•æ‰§è¡Œ Run â†’ **Add Configuration...**  â†’ **C# Godot**
- ç¼–è¾‘é…ç½®æ–‡ä»¶ ``tasks.json`` å’Œ ``launch.json``ï¼Œä½¿ç”¨ executable å’Œ Command æŒ‡å‘æ­£ç¡®çš„ Godot å¯æ‰§è¡Œæ–‡ä»¶ã€‚

å®Œæˆä»¥ä¸Šé…ç½®åï¼Œå°±å¯ä»¥ç›´æ¥åœ¨ VScode ä¸­è¿è¡Œ Godot é¡¹ç›®ï¼š

- ä½¿ç”¨å‘½ä»¤è°ƒæ¿ï¼ŒCtrl-Shift-P æ‰“å¼€é¢æ¿å¹¶è¾“å…¥ C# Godot æŸ¥è¯¢ç›¸å…³å‘½ä»¤ï¼›
- åœ¨çŠ¶æ€æ ä¸­ï¼Œç‚¹å‡» Godot Project å­—æ ·å¤„é€‰æ‹©å·¥ç¨‹ç›®å½•ï¼›
- åœ¨çŠ¶æ€æ ä¸­ï¼Œç‚¹å‡» Play in Editor (mono) å­—æ ·å¤„è¿ Godot å·¥ç¨‹ï¼›
- ç›´æ¥æ‰“å¼€ Run and Debug ä¾§æ é¢æ¿é€‰æ‹© ``launch.json`` é…ç½®çš„è°ƒè¯•çš„æ–¹å¼ï¼š
    - Play in Editor ç›´æ¥é€šè¿‡ç¼–è¾‘å™¨ä¸­è¿è¡Œï¼›
    - Launch æ‰§è¡Œ `Godot.exe --path ${workspaceRoot}`
    - Launch (Select Scene) é€‰æ‹©åœºæ™¯æ‰§è¡Œ `Godot.exe --path ${workspaceRoot} ${command:SelectLaunchScene}`
    - Attach é™„ç€åˆ°æœ¬åœ°è°ƒè¯•è¿›ç¨‹ï¼›

å¦‚æœå·¥ç¨‹ä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œè€Œ VScode åˆçœ‹ä¸åˆ°é”™è¯¯ä¿¡æ¯ï¼Œå°±å¯ä»¥åˆ° Godot çš„ MSBuild é¢æ¿æŸ¥è¯¢ç¼–è¯‘æ—¥å¿—ä¿¡æ¯ï¼Œ
ä¾‹å¦‚ï¼Œå½“å‰ç³»ç»Ÿæ›¾ç»åˆ é™¤è¿‡ Xamarin çš„ NuGet æ¨¡å—ç›®å½•ï¼Œå¯¼è‡´ Godot ç¼–è¯‘æ—¶å‡ºç°é—®é¢˜ï¼Œåªéœ€è¦æ¢å¤ç›®å½•å³å¯ï¼š

    SDK è§£æç¨‹åºå¤±è´¥: 
    "å°è¯•è§£æ SDK "Godot.NET.Sdk/4.0.0-beta.16" æ—¶ï¼ŒSDK è§£æç¨‹åº "NuGetSdkResolver" å¤±è´¥ã€‚
    å¼‚å¸¸: "NuGet.Packaging.Core.PackagingException: æ— æ³•æ‰¾åˆ°å›é€€åŒ…æ–‡ä»¶å¤¹â€œC:\Microsoft\Xamarin\NuGet\â€ã€‚

NuGet æ˜¯ä¾èµ–ç®¡ç†å·¥å…·ï¼ŒåŒ…å«ä¸ºå¼€æ”¾æºä»£ç  .NET åº“è€Œåˆ›å»ºçš„ NuGet.org åŒ…ç®¡ç†å¹³å°ï¼Œä¸Šé¢å…¬å¼€å‘å¸ƒäº†
æ‰€æœ‰åŒ…çš„æ¨èå…ƒæ•°æ®ã€‚NuGet åŒ… `*.nupkg` æ˜¯ä¸€ä¸ª zip æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å« .NET ç¨‹åºé›†å’Œå…³è”çš„å…ƒæ•°æ®ã€‚

NuGet æ˜¯ .NET ç”Ÿæ€ç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä¸”æ˜¯å¼€å‘äººå‘˜ç”¨æ¥å‘ç°å¹¶è·å– .NET å¼€æ”¾æºä»£ç åº“çš„ä¸»è¦æ–¹æ³•ã€‚
NuGet.orgï¼ˆç”±æ‰˜ç®¡ NuGet åŒ…çš„ Microsoft æä¾›çš„å…è´¹æœåŠ¡ï¼‰æ˜¯å…¬å…± NuGet åŒ…çš„ä¸»è¦ä¸»æœºï¼Œä½†å¯ä»¥
å‘å¸ƒåˆ°è‡ªå®šä¹‰ NuGet æœåŠ¡ï¼Œå¦‚ MyGet å’Œ Azure Artifactsã€‚

åˆ›å»º NuGet åŒ…æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼ã€‚ è¾ƒæ–°çš„æ¨èæ–¹å¼æ˜¯ä» SDK æ ·å¼é¡¹ç›®ï¼Œå…¶å†…å®¹ä»¥ `<Project Sdk="Microsoft.NET.Sdk">` 
å¼€å¤´çš„é¡¹ç›®æ–‡ä»¶åˆ›å»ºåŒ…ã€‚ ç¨‹åºé›†å’Œç›®æ ‡ä¼šè‡ªåŠ¨æ·»åŠ åˆ°åŒ…ï¼Œå‰©ä½™å…ƒæ•°æ®ä¼šæ·»åŠ åˆ° MSBuild æ–‡ä»¶ï¼Œå¦‚åŒ…åç§°å’Œç‰ˆæœ¬å·ã€‚
ä½¿ç”¨ `dotnet pack` å‘½ä»¤ç¼–è¯‘ä¼šè¾“å‡º `*.nupkg` æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç¨‹åºé›†ã€‚

æœ¬åœ°ä¸‹è½½å®‰è£…çš„ç¼“å†²ç›®å½•å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥è¯¢åŠæ¸…ç†ï¼š

    nuget locals all -list
    nuget locals all -clear

é…ç½®æ–‡ä»¶ ``tasks.json`` é»˜è®¤åªæä¾›äº†ä¸€ä¸ªæ„å»ºä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡èœå• Terminal â†’ Run Build Task... æ‰§è¡Œï¼š 

```json
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "build",
      "command": "Godot_v4.0-stable_win64.exe", //"<insert-godot-executable-path-here>",
      "type": "process",
      "args": [
        "--build-solutions",
        "--path",
        "${workspaceRoot}",
        "--no-window",
        "-q"
      ],
      "problemMatcher": "$msCompile"
    }
  ]
}
```

å¦‚æœæ·»åŠ è¿è¡Œé…ç½®æ—¶ï¼Œæ²¡æœ‰æä¾› **C# Godot** é…ç½®ï¼Œè¯·æ£€æŸ¥ä»¥ä¸Šä¸‰ä¸ªæ‰©å±•æ˜¯å¦å®Œæˆå®‰è£…ï¼Œå¹¶ä¸”å¤„äºå¯ç”¨çŠ¶æ€ã€‚
é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå°±å¯ä»¥åœ¨ Godot ç»™èŠ‚ç‚¹é™„åŠ è„šæœ¬æ—¶ï¼Œåœ¨ Attach Script å¯¹è¯æ¡†ä¸­é€‰æ‹© C# è¯­è¨€ã€‚


è°ƒè¯•å™¨é…ç½®ï¼Œ`launch.json` è®¾ç½®å¦‚ä½•å¯åŠ¨è°ƒè¯•ç¨‹åºï¼Œé…ç½®å®ä½“ä¸­å¿…è¦çš„å‚æ•°æœ‰ä»¥ä¸‹ 3 ä¸ª:

01. **type** - è®¾ç½®è°ƒè¯•å™¨ç±»å‹ï¼Œæ ¹æ®å·²å®‰è£…çš„è°ƒè¯•å™¨è®¾ç½®ï¼Œå¦‚ï¼š
    - **node** VSCode å†…ç½®çš„ Node debugger
    - **python** Python debugger
    - **cppdbg** GDB or LLDB debugger
    - **cppvsdbg** Visual Studio Windows debugger
02. **request** - è°ƒè¯•æ‰§è¡Œç±»å‹ï¼Œç›®å‰åªæ”¯æŒ launch å’Œ attach ä¸¤ç§ã€‚
03. **name** - è°ƒè¯•èœå•ä¸­æ˜¾ç¤ºæ ‡é¢˜ã€‚

æ ¹æ®è¢«è°ƒè¯•ç¨‹åºä½¿ç”¨çš„ç¼–è¯‘å™¨ä¸åŒï¼Œåœ¨ä¸åŒç³»ç»Ÿä¸Šå¯ä»¥ä½¿ç”¨çš„è°ƒè¯•å™¨å¦‚ä¸‹ï¼š

1. Linux: GDB
2. macOS: LLDB or GDB
3. Windows: the Visual Studio Windows Debugger or GDB (using Cygwin or MinGW)

è°ƒè¯• Cygwin æˆ– MinGW ç¼–è¯‘çš„ç¨‹åºæ—¶ï¼Œå¯ä»¥è®¾ç½® Machine Interface ("MI") è°ƒè¯•å¼•æ“ï¼Œè¿™æ˜¯æ ¹æ®
Core Interfaces å®ç°çš„è°ƒè¯•å™¨æ¥å£ï¼Œè®¾ç½® **MIMode** å±æ€§ä¸º gdb æˆ– lldbã€‚
åœ¨ **miDebuggerPath** æŒ‡å®šè°ƒè¯•å™¨è·¯å¾„ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸­æ–­éš¾ï¼Œä¸èƒ½åœ¨ç¨‹åºè¿è¡Œæ—¶ä¸­æ–­ã€‚å¦å¤–ï¼Œè¦ä½¿ç”¨
GDBSever è¿›è¡Œè¿œç¨‹è°ƒè¯•ï¼Œéœ€è¦åœ¨ **miDebuggerServerAddress** æŒ‡å®šæœåŠ¡å™¨åœ°å€ã€‚

ä½¿ç”¨ cppvsdbg è°ƒè¯• GCC ç¼–è¯‘å™¨ç”Ÿæˆçš„ç¨‹åºï¼Œå¯èƒ½ä¼šé‡åˆ°ç¨‹åºä¸­æ–­è®¾ç½®æ— æ•ˆï¼Œæˆ–è€…å¯ä»¥ä¸­æ–­ï¼Œä½†æ˜¯ç¨‹åº
è¿è¡Œæ—¶æ— æºä»£ç å…³è”ã€‚cppvsdbg å’Œ Clang æ­é…ä½¿ç”¨å´éå¸¸å¥½ã€‚

åœ¨ DEBUG CONSOLE çª—å£ä¸­æ˜¯å¯ä»¥çœ‹åˆ° gdb è¿è¡Œæ˜¯æ­£å¸¸çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ list æŒ‡ä»¤æŸ¥è¯¢åˆ°å…³è”æºä»£ç ã€‚
ä¸€ä¸ªä¸´æ—¶è§£å†³æ–¹æ³•ï¼ˆå˜é€šï¼‰å°±æ˜¯æ‰‹åŠ¨å°†ä»£ç å¤åˆ¶åˆ°ï¼š

    Thread 1 "const" hit Breakpoint 1, main () at c:\demo\const.cpp:22
    22      float c = 3.14;

ä½¿ç”¨ cppvsdbg ç­‰è°ƒè¯•å™¨æ—¶ï¼Œå¯ä»¥åœ¨ **console** è®¾ç½®è¦ä½¿ç”¨çš„ç»ˆç«¯ç±»å‹ï¼š

- `integratedTerminal`ï¼šVS Code çš„é›†æˆç»ˆç«¯
- `internalConsole`ï¼šå†…éƒ¨æ§åˆ¶å°
- `externalTerminal`ï¼šå¤–éƒ¨çš„ç³»ç»Ÿç»ˆç«¯
- `newExternalWindow`ï¼šæ–°åˆ›å»ºçš„ç³»ç»Ÿç»ˆç«¯ï¼Œå¯¹äº GUI ç¨‹åºå°±ä¼šå¿½ç•¥æ§åˆ¶å° I/Oã€‚

ä¸€èˆ¬ä½¿ç”¨ VSCode é›†æˆæ§åˆ¶å°ï¼ŒintegratedTerminal æ¯”å…¶å®ƒä¸¤ä¸ªå¥½åœ¨ï¼šä¸ä¼šå¼¹å‡ºå¤–éƒ¨çª—å£ï¼Œä¸ä¼šå› ä¸º
å†…éƒ¨çª—å£è¿è¡Œç»“æŸè€Œçœ‹ä¸åˆ°æ§åˆ¶å°è¾“å‡ºï¼Œé›†æˆæ§åˆ¶å°ä¼šè®°å½•æ‰€æœ‰æ‰“å°ä¿¡æ¯ã€‚

åŠ è½½è°ƒè¯•ç¨‹åºæ—¶çš„å…¶å®ƒå¯ç”¨é€‰é¡¹ï¼š

01. **presentation** - æ§åˆ¶é…ç½®å®ä½“å¦‚ä½•åœ¨å‘½ä»¤é¢æ¿ä¸­åˆ†ç»„ã€æ’åºï¼Œæ˜¾ç¤ºæˆ–éšè— (group, order, hidden)ã€‚
02. **preLaunchTask** - è°ƒè¯•å‰æ‰§è¡Œ tasks.json çš„ä»»åŠ¡ï¼Œé»˜è®¤ä»»åŠ¡æ˜¯ ${defaultBuildTask}ã€‚
03. **postDebugTask** - è°ƒè¯•ä¼šè¯ç»“æŸåæ‰§è¡Œ tasks.json çš„ä»»åŠ¡ï¼Œæ³¨æ„è¦å’Œä»»åŠ¡æ ‡ç­¾ **label** ä¸€è‡´ã€‚
04. **internalConsoleOptions** - è°ƒè¯•å™¨æ§åˆ¶å°é¢æ¿çš„æ˜¾ç¤ºçŠ¶æ€è®¾ç½®ï¼Œé»˜è®¤ä¼šåœ¨è°ƒè¯•æ—¶è‡ªåŠ¨åˆ‡æ¢æ˜¾ç¤ºã€‚
05. **debugServer** - æ­¤å‚æ•°ç»™æ‰©å±•å¼€å‘è€…ä½¿ç”¨ï¼Œä»¥å…è®¸è¿æ¥åˆ°æŒ‡å®šç«¯å£è€Œä¸æ˜¯å¯åŠ¨è°ƒè¯•é€‚é…å™¨ã€‚
06. **serverReadyAction** - è°ƒè¯• Web æœåŠ¡å™¨æ—¶è®¾ç½®ä»¥è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŒ‡å®šçš„ URLã€‚

è°ƒè¯•å™¨å¯åŠ¨ä¸¤ç§æ–¹å¼ä¸­ï¼Œlaunch è¡¨ç¤ºç›´æ¥å’Œåº”ç”¨ä¸€èµ·å¯åŠ¨ï¼Œattach è¡¨ç¤ºå°†è°ƒè¯•å™¨é™„åŠ åˆ°å·²ç»å¯åŠ¨çš„è¿›ç¨‹ä¸Šã€‚
è®¾ç½®å¥½è°ƒè¯•å™¨ï¼Œè¿˜å¯ä»¥é€šè¿‡ preLaunchTask å’Œ postDebugTask è¿™æ ·çš„é…ç½®å»è°ƒç”¨ Tasks é…ç½®ä¸­ä»»åŠ¡ã€‚
ä»»åŠ¡å°±æ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œå¦‚ç¼–è¯‘ç¨‹åºï¼Œæˆ–è€…æ¸…ç†ç¼“å­˜æ–‡ä»¶ç­‰ç­‰ï¼Œéƒ½å¯ä»¥é…ç½®ä¸ºä¸€ä¸ª Taskã€‚

è°ƒè¯•æ§åˆ¶æ§åˆ¶å°ä¼šè‡ªåŠ¨éšè—ï¼Œé‡æ–°æ‰“å¼€éœ€è¦ä½¿ç”¨ Debug: Select Debug Console å‘½ä»¤ã€‚

è°ƒè¯•å™¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œå’Œè‡ªå·±ç”¨ C++ ç¼–å†™çš„ç¨‹åºæ²¡æœ‰ä¸åŒï¼Œå·®å¼‚åªæ˜¯åœ¨åŠŸèƒ½ä¸Šï¼Œå³è°ƒè¯•å™¨å…·æœ‰è°ƒè¯•
å…¶å®ƒç¨‹åºçš„åŠŸèƒ½ï¼Œè°ƒè¯•å™¨éœ€è¦å»è¿è¡Œè¢«è°ƒè¯•çš„ç¨‹åºä»¥è·å¾—ç¨‹åºæ§åˆ¶æµä¸»åŠ¨æƒã€‚

åœ¨è°ƒè¯• Web æœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ serverReadyAction å‚æ•°æŒ‡å®šä¸€ä¸ªè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨çš„æ–¹å¼ï¼Œæ¯”å¦‚ä»¥ä¸‹
é…ç½®ï¼Œå°±ä¼šåœ¨å¤–éƒ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŒ‡å®šçš„ URL åœ°å€ã€‚è¿™ä¸ªåŠ¨ä½œéœ€è¦åœ¨ç¨‹åºä¸­è¾“å‡ºå¯ä»¥æŒ‰ pattern æ ¼å¼åŒ¹é…
çš„å†…å®¹åˆ°è°ƒè¯•å™¨æ§åˆ¶å°ï¼Œç¼–è¾‘å™¨åŒ¹é…åˆ°æ§åˆ¶å°å†…å®¹åå†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åŒ¹é…åˆ°çš„åœ°å€ã€‚uriFormat åˆ™æ˜¯æŒ‡ç¤º
å¦‚æœæ„é€ å‡ºç›¸åº”çš„ URL åœ°å€ï¼š

```json
    // tasks.jsonconfiguration
    {
      "label": "build demo web server",
      "type": "shell",
      "command": "go build demo.go",
      "problemMatcher": [
        "$go"
      ]
    }

    // luanch.json configuration
    {
      "type": "cppvsdbg",
      "request": "launch",
      "name": "Launch Web Server",
      "cwd": "${workspaceFolder}",
      "preLaunchTask": "build demo web server",
      "program": "${workspaceFolder}/demo.exe",
      "internalConsoleOptions": "neverOpen",
      "serverReadyAction":{
        // "name": "Web Server Launched",
        "action": "openExternally", // "debugWithChrome", "startDebugging",
        "pattern": "listening on port ([0-9]+)",
        "uriFormat": "http://localhost:%s",
        "killOnServerStop": false
      }
    },
```

ä»¥ä¸‹æ˜¯é…å¥—æ¼”ç¤ºç”¨çš„ Go è¯­è¨€ç¨‹åºï¼š

```golang
    package main

    import (
        "net/http"
        "fmt"
        "log"
        "os"
    )

    func main () {
        http.HandleFunc("/", func(writer http.ResponseWriter, request *http.Request) {
            fmt.Fprint(writer, "Hello World")
        })
        http.HandleFunc("/bye", func(writer http.ResponseWriter, request *http.Request) {
            defer writer.(http.Flusher).Flush()
            fmt.Fprint(writer, "See you then")
            os.Exit(0)
        })
        println("Now listening on: https://localhost:8080")
        log.Fatal(http.ListenAndServe(":8080", nil))
    }
```

æ ¹æ®ä¸åŒè°ƒè¯•å™¨éœ€è¦è®¾ç½®å…¶å®ƒä¸åŒçš„å‚æ•°ï¼Œä¸€èˆ¬å¯ä»¥è®¾ç½®è¦è°ƒè¯•çš„ç¨‹åºæˆ–è„šæœ¬ï¼Œå‚æ•°å‚è€ƒå¦‚ä¸‹ï¼š

- **program** - è¢«è°ƒè¯•çš„ç¨‹åºæˆ–æ–‡ä»¶è·¯å¾„ã€‚
- **args** - ä¼ å…¥è¢«è°ƒè¯•ç¨‹åºçš„å‚æ•°ã€‚
- **env** - ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œå¯ä»¥ä½¿ç”¨ null æ¥ "undefine" ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚
- **envFile** - æŒ‡å®šä¸€ä¸ª dotenv ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ã€‚
- **cwd** - è®¾ç½®ç¨‹åºè¿è¡Œæ—¶çš„å·¥ä½œç›®å½•è·¯å¾„ï¼Œä»¥æ–¹ä¾¿å®šä¹‰å¯èƒ½ä½¿ç”¨åˆ°çš„ä¾èµ–ã€‚
- **port** - è®¾ç½®è°ƒè¯•å™¨è¦é™„ç€çš„ç«¯å£ã€‚
- **stopOnEntry** - è®¾ç½®æ˜¯å¦åœ¨å…¥å£å¤„ä¸­æ–­ç¨‹åºçš„æ‰§è¡Œï¼Œfalse or trueã€‚

å¦å¤–ï¼ŒVSCode ä½œä¸ºä¸€ä¸ªè·¨å¹³å°å¼€å‘å·¥å…·ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„å¹³å°åœ¨é…ç½®å®ä½“ä¸­ä½¿ç”¨ä»¥ä¸‹é…ç½®é¡¹ç›®ï¼š

1. **window**ï¼šä¸º Window å¹³å°å•ç‹¬é…ç½®çš„é¡¹ç›®ï¼›
2. **linux**ï¼šä¸º Linux å¹³å°å•ç‹¬é…ç½®çš„é¡¹ç›®ï¼›
3. **osx**ï¼šä¸º Mac OS å¹³å°å•ç‹¬é…ç½®çš„é¡¹ç›®ï¼›


ä»¥ä¸‹æ˜¯ tasks.json é…ç½®å®ä½“ä½¿ç”¨çš„å‚æ•°ï¼š

01. **label**: ä»»åŠ¡æ ‡ç­¾ï¼Œä¼šæ˜¾ç¤ºåœ¨å‘½ä»¤é¢æ¿ä¸Šã€‚
02. **type**: ä»»åŠ¡ç±»å‹ï¼Œå¦‚ shell æˆ–è€… processï¼Œå‰è€…æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·ï¼Œåè€…æ‰§è¡Œä¸€ä¸ªç¨‹åºã€‚
03. **command**: ä»»åŠ¡å®é™…æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœæŒ‰ shell æ–¹å¼ï¼Œå°±æ˜¯æ‰§è¡Œ cmd.exe /d /c "command"ã€‚
04. **windows**: Any Windows specific properties. Will be used instead of the default properties when the command is executed on the Windows operating system.
05. **group**: ä»»åŠ¡åˆ†ç»„å½’ç±»ï¼Œæ¯”å¦‚ "kind": "build" æˆ– â€test" ç­‰ç­‰ï¼Œè®¾ç½®é»˜è®¤ä»»åŠ¡ "isDefault": trueã€‚
06. **presentation**: Defines how the task output is handled in the user interface. In this example, the Integrated Terminal showing the output is always revealed and a new terminal is created on every task run.
07. **options**: Override the defaults for cwd (current working directory), env (environment variables), or shell (default shell). Options can be set per task but also globally or per platform. Environment variables configured here can only be referenced from within your task script or process and will not be resolved if they are part of your args, command, or other task attributes.
08. **runOptions**: Defines when and how a task is run.
09. **problemMatcher**: ä»»åŠ¡è¾“å‡ºå†…å®¹çš„å¤„ç†æ–¹å¼ï¼Œä¸ä»£ç å…³è”èµ·æ¥ï¼Œå¦‚ $gccï¼Œ$goï¼Œ$tsc ç­‰ç­‰ã€‚

é…ç½®æ–‡ä»¶ä¸­å¸¸ç”¨çš„å˜é‡ï¼š

01. `${workspaceFolder}`ï¼šåœ¨ VS Code ä¸­æ‰“å¼€çš„é¡¹ç›®æ–‡ä»¶å¤¹è·¯å¾„
02. `${file}`ï¼šå½“å‰å¼€æ‰“å¼€ï¼ˆæ¿€æ´»ï¼‰çš„æ–‡ä»¶
03. `${relativeFile}`ï¼šæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äº ${workspaceFolder} 
04. `${fileBasename}`ï¼šå½“å‰æ‰“å¼€æ–‡ä»¶çš„åç§°
05. `${fileBasenameNoExtension}`ï¼šå½“å‰æ‰“å¼€æ–‡ä»¶çš„åç§°ï¼Œä¸å¸¦æ‰©å±•å
06. `${fileExtname}`ï¼šå½“å‰æ‰“å¼€æ–‡ä»¶çš„æ‰©å±•å
07. `${fileDirname}`ï¼šå½“å‰æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶å¤¹åç§°
08. `${workspaceFolderBasename}` - é¡¹ç›®æ‰€åœ¨çš„ç›®å½•åç§°
09. `${fileWorkspaceFolder}` - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„å·¥ä½œåŒºæ–‡ä»¶å¤¹
10. `${relativeFileDirname}` - å½“å‰æ‰“å¼€çš„æ–‡ä»¶çš„ç›®å½•åï¼Œç›¸å¯¹äº workspaceFolder
11. `${cwd}` - ä»»åŠ¡è¿è¡Œå™¨å¯åŠ¨æ—¶çš„å½“å‰å·¥ä½œç›®å½•
12. `${lineNumber}` - å½“å‰é€‰ä¸­çš„è¡Œå·åœ¨æ´»åŠ¨æ–‡ä»¶ä¸­
13. `${selectedText}` - æ´»åŠ¨æ–‡ä»¶ä¸­å½“å‰é€‰å®šçš„æ–‡æœ¬
14. `${execPath}` - è¿è¡ŒVS Codeå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„
15. `${defaultBuildTask}` - é»˜è®¤æ„å»ºä»»åŠ¡çš„åç§°
17. `${pathSeparator}` - ç›®å½•åˆ†éš”ç¬¦å·ï¼Œåœ¨ macOS æˆ– Linux ç³»ç»Ÿä¸º /ï¼ŒWindows ä¸Šä¸º \


ä»¥ä¸‹æ˜¯ VSCode C++ é¡¹ç›®çš„é…ç½®å‚è€ƒï¼Œä½¿ç”¨ Clang + cppvsdbg å’Œ GCC + cppdbg ä¸¤ç§æ­é…ï¼š

```json
    // tasks.jsonconfiguration
    {
      "label": "C++20: g++ build active file",
      "type": "shell",
      "command": "C:\\mingw-w64\\x86_64-12.2.0-release-win32-seh-ucrt-rt_v10-rev2\\bin\\g++.exe",
      "args": [
        "g++", "-std=c++20",
        "-g",  "${file}",
        "-o",  "${workspaceFolder}\\bin\\${fileBasenameNoExtension}.exe",
      ],
      "linux": {
        "command": "g++-12"
      },
      "options": {
        "cwd": "${fileDirname}"
      },
      "problemMatcher": [ "$gcc" ],
      "group": {
        "kind": "build",
        "isDefault": false
      }
    },
    {
      "label": "C++20: clang++ build active file",
      "type": "shell",
      "command": "clang++",
      "args": [
        "-std=c++20",
        // "-stdlib=libc++",
        "-fdiagnostics-color=always",
        "-g", "${file}",
        "-o", "${workspaceFolder}\\bin\\${fileBasenameNoExtension}.exe",
      ],
      "problemMatcher": [ "$gcc" ],
      "group": "build"
    },


    // luanch.json configuration
    {
      "name": "Launch VSDBG (Clang++)",
      "type": "cppvsdbg",
      "request": "launch",
      "program": "${workspaceFolder}/bin/${fileBasenameNoExtension}.exe",
      "args": [],
      // "stopAtEntry": true,
      "console": "integratedTerminal",
      "cwd": "${workspaceFolder}",
      "environment": [],
      "preLaunchTask": "C++20: clang++ build active file",
    },
    {
      "name": "Launch GDB (g++)",
      "type": "cppdbg",
      "request": "launch",
      "program": "${workspaceFolder}/bin/${fileBasenameNoExtension}.exe",
      "args": [],
      "cwd": "${workspaceFolder}",
      "environment": [],
      "preLaunchTask": "C++20: g++ build active file",
      "MIMode": "gdb",
      "miDebuggerPath": "gdb.exe",
      // "miDebuggerServerAddress": "serveraddress:port",
      "setupCommands": [
        {
          "description": "Enable pretty-printing for gdb",
          "text": "-enable-pretty-printing",
          "ignoreFailures": true
        }
      ]
    },
```

### ğŸŸ ğŸ”µ GDScript vs. CSharp

Node èŠ‚ç‚¹ç±»æ‰©å±•ä»£ç ç¤ºä¾‹ï¼š

```C#,ignore
    using Godot;
    using System;

    public class MyNode2D : Node
    {
        // Member variables here, example:
        private int a = 2;
        private string b = "textvar";

        public override void _Ready()
        {
            // Called every time the node is added to the scene.
            // Initialization here.
            GD.Print("Hello from C# to Godot :)", Time.GetTicksMsec());
        }

        public override void _Process(float delta)
        {
            // Called every frame. Delta is time since the last frame.
            // Update game logic here.
        }
    }
```

ä½¿ç”¨ C# ä¸ GDScript çš„ä¸€äº›å·®å¼‚ï¼š

- C# ä½¿ç”¨ ``PascalCase`` ä»£ç é£æ ¼ï¼ŒGDSCript/C++ ä½¿ç”¨ ``snake_case`` é£æ ¼ï¼Œ`AddChild()` vs. `add_child()`ã€‚
- C# ç±»åè¦æ±‚ä»£ç æ–‡ä»¶åä¸€è‡´ï¼Œå¦ç”±ä¼šæç¤º *"Cannot find class XXX for script res://XXX.cs"*
- C# ä¸­ä½¿ç”¨ Godot å‘½ä»¤ç©ºé—´ä¸‹çš„ GD ç®¡ç† @GDscript å’Œ @GlobbalScope å…¨å±€å‡½æ•°ç¬¦å·ã€‚
- C# å¯¼å‡ºç¬¦å·ç”Ÿæ•ˆä¹‹å‰ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘ç¨‹åºé›†ï¼Œé€šè¿‡ Godot ç•Œé¢å³ä¸Šè§’çš„ Build æŒ‰é’®æ„å»ºå·¥ç¨‹ã€‚
- C# è¯­å¥ä½¿ç”¨åˆ†å·ä½œä¸ºç»“æŸç¬¦å·ï¼Œè€Œ GDScript ä¸éœ€è¦ã€‚
- C# ä¸­ä»¥ `Godot.Object` ä½œä¸ºæ‰€æœ‰ç±»å‹çš„åŸºç±»ï¼Œæ–°ç‰ˆæœ¬æ›´åä¸º `Godot.GodotObject`ã€‚
- C# ä½¿ç”¨ `this` å¼•ç”¨å½“å‰ç±»å®ä¾‹ï¼ŒGDScript ä½¿ç”¨ `self` å¼•ç”¨å½“å‰ç±»å®ä¾‹ã€‚
- C# ä½¿ç”¨ `base` å¼•ç”¨çˆ¶ç±»å®ä¾‹æˆ–æ„é€ å™¨ï¼ŒGDScript ä½¿ç”¨ `super(args)` å¼•ç”¨çˆ¶ç±»æ„é€ ã€‚

åœ¨ C# ä¸­ï¼Œä¹Ÿä¸èƒ½åƒ GDScript é‚£æ ·ï¼Œç›´æ¥æ‹–åŠ¨èŠ‚ç‚¹åˆ°è„šæœ¬ä¸­åˆ›å»ºå¼•ç”¨ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ onreadyï¼Œè€Œéœ€è¦åœ¨
Ready è¿™ç±»äº‹ä»¶ä¸­ï¼Œä½¿ç”¨ FindNode æˆ–è€… GetNode è·å–èŠ‚ç‚¹å¼•ç”¨ï¼š

```C#
    //Button n = FindNode("Button") as Button; // FindNode -> FindChild (Godot 4)
    Button n = (Button) GetNode("Button");
    if (n != null) {
        // n.Connect(nameof(Button.Pressed), this, "handle_button_click");
        n.Connect("pressed", this, "handle_button_click");
        GD.Print($"button: {n.Text}");
    }
```

ä½¿ç”¨ C# è¿›è¡Œ Godot é¡¹ç›®å¼€å‘ï¼Œè¿˜éœ€è¦è§£å†³ä»¥ä¸‹è¿™äº›åŸºæœ¬é—®é¢˜ï¼š

- ä¸åŒè¯­è¨€ä¹‹é—´çš„ç›¸äº’è°ƒç”¨é—®é¢˜ï¼›
- Godot ä¿¡å·ç³»ç»Ÿçš„ä½¿ç”¨æ–¹å¼çš„å·®å¼‚ï¼›
- C# ä¸ GDScript API ä¹‹é—´çš„å·®å¼‚ï¼›
- Godot ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å¤„ç†ç­‰ç­‰ï¼›


Godot è€ƒè™‘åˆ°äº†ä¸åŒè¯­è¨€ä¹‹é—´ç›¸äº’è°ƒç”¨ï¼ŒC# è°ƒç”¨ GDScript API æˆ–è€…å±æ€§è¯»å†™ä½¿ç”¨ GodotObject æä¾›çš„æ–¹æ³•ï¼š

```C#,ignore
    //
    // æ‘˜è¦:
    //     Calls the method on the object and returns the result. This method supports a
    //     variable number of arguments, so parameters are passed as a comma separated list.
    //     Example:
    //     call("set", "position", Vector2(42.0, 0.0))
    [GodotMethodAttribute("call")]
    public object Call(string method, params object[] args);
    //
    // æ‘˜è¦:
    //     Calls the method on the object during idle time. This method supports a variable
    //     number of arguments, so parameters are passed as a comma separated list. Example:
    //     call_deferred("set", "position", Vector2(42.0, 0.0))
    [GodotMethodAttribute("call_deferred")]
    public void CallDeferred(string method, params object[] args);
    //
    // æ‘˜è¦:
    //     Calls the method on the object and returns the result. Contrarily to Godot.Object.Call(System.String,System.Object[]),
    //     this method does not support a variable number of arguments but expects all parameters
    //     to be via a single Godot.Collections.Array.
    //     callv("set", [ "position", Vector2(42.0, 0.0) ])
    [GodotMethodAttribute("callv")]
    public object Callv(string method, Collections.Array argArray);

    //
    // æ‘˜è¦:
    //     Assigns a new value to the given property. If the property does not exist or
    //     the given value's type doesn't match, nothing will happen.
    [GodotMethodAttribute("set")]
    public void Set(string property, object value);
    //
    // æ‘˜è¦:
    //     Returns the Variant value of the given property. If the property doesn't exist,
    //     this will return null.
    [GodotMethodAttribute("get")]
    public object Get(string property);
```

è€Œåœ¨ GDscript è®¿é—® C# API åˆ™æ˜¯ç›´æ¥è°ƒç”¨ï¼Œå°±åƒä½¿ç”¨å…¶å®ƒ GDScript å¯¹è±¡ä¸€æ ·ï¼Œå®ä¾‹åŒ–æ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š

```py
    # Instantiating C# nodes from GDScript
    var my_csharp_script = load("res://path_to_cs_file.cs")  # CSharpScript
    var my_csharp_node = my_csharp_script.new()
    print(my_csharp_node.some_property)
```

```C#
    // Instantiating GDScript nodes from C#
    GDScript MyGDScript = (GDScript) GD.Load("res://path_to_gd_file.gd");
    Object myGDScriptNode = (Godot.Object) MyGDScript.New();
    myGDScriptNode.Call("some_method", new int[] { 1, 2, 3 }); // some_method(1, 2, 3)
    myGDScriptNode.Call("some_method", (object)new int[] { 1, 2, 3 }); // some_method([1, 2, 3])
```

æ³¨æ„ï¼Œå®ä¾‹åŒ–å¾—åˆ°çš„ç±»å‹ä»¥ Godot å†…ç½®ç±»å‹ä¸ºå‡†ï¼Œè€Œä¸æ˜¯æŒ‰ C# æˆ– GDScript ä¸­å£°æ˜çš„ç±»å‹ä½œä¸ºåˆ¤æ–­æ ‡å‡†ã€‚
æ¯”å¦‚ï¼Œåé¢çš„ MyNode2D åœ¨ä½¿ç”¨ GDScript `is` å…³é”®å­—åšç±»å‹åˆ¤æ–­æ—¶ï¼Œéœ€è¦ä½¿ç”¨å†…ç½®ç±»å‹ Node ä½œä¸ºå‚è€ƒã€‚
C# è°ƒç”¨ GDScript API æ—¶æ³¨æ„ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆå°±éœ€è¦æ˜¾å¼è½¬æ¢ä¸º `object` ç±»å‹ã€‚å¦åˆ™ï¼Œ
æ•°ç»„å…ƒç´ å°±ä¼šè¢«å½“ä½œä¸€ä¸ªå‚æ•°ä½¿ç”¨ï¼Œå¹¶å¯èƒ½å¯¼è‡´å‡½æ•°ç­¾åä¸åŒ¹é…ã€‚


ç¼–å†™ C# ç±»ä»£ç æ—¶æ³¨æ„ï¼Œç±»åä¸ ``.cs`` ä»£ç æ–‡ä»¶åä¸€è‡´ï¼Œå¦åˆ™æç¤ºé”™è¯¯ï¼š

    Invalid call. Nonexistent function `new` in base.

æ¯”å¦‚ï¼ŒMyCoolNode.cs æ–‡ä»¶å°±åº”è¯¥å®šä¹‰ MyCoolNode ç±»å‹ã€‚å¹¶ä¸”éœ€è¦ç»§æ‰¿è‡ª ``Godot.Object`` æˆ–å…¶å®ƒ
å­ç±»ã€‚æœ€åï¼ŒC# å·¥ç¨‹æ–‡ä»¶ ``.csproj``ä¸­è¦æ­£ç¡®å¼•ç”¨``.cs`` æ–‡ä»¶ï¼Œè¿™æ ·æ‰ä¼šç”Ÿæ•ˆã€‚



Godot 4.x Mono ä¿¡å·æœºåˆ¶åœ¨ C# ä½¿ç”¨å§”æ‰˜æœºåˆ¶å®ç°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„ += å’Œ -= è¿ç®—ç¬¦ç›‘å¬ã€æˆ–è€…
å–æ¶ˆç›‘å¬ã€‚å¦å¤–ï¼ŒConnect æ–¹æ³•ä¹Ÿæœ‰æ›´æ–°ï¼Œä½¿ç”¨ Callable å¯¹è±¡åŒ…è£…å›è°ƒå‡½æ•°åŠå›è°ƒå‚æ•°ã€‚å¦å¤–ï¼Œé€šè¿‡èŠ‚ç‚¹çš„
åµŒå¥—ç±» SignalName å¯ä»¥è®¿é—®ä¿¡å·åç§°ï¼Œå®ƒç»§æ‰¿è‡ª GodotObject.SignalNameã€‚æ¸…ç†èŠ‚ç‚¹æ—¶ï¼ŒGodot ä¼š
è´Ÿè´£æ‰€æœ‰ä¿¡å·ç›‘å¬äº‹ä»¶çš„æ¸…ç†ï¼š

```C#
    Timer myTimer = GetNode<Timer>("Timer");
    myTimer.Timeout += () => GD.Print("Timeout!");
    // public Error Connect(StringName signal, Callable callable, uint flags = 0);

    await ToSignal(GetTree(), SceneTree.SignalName.ProcessFrame);
```

ä»¥ä¸‹æ˜¯ Callable ç±»å‚è€ƒæ–‡æ¡£ä¸­å±•ç¤ºçš„ç”¨æ³•ï¼Œä½¿ç”¨äº†åµŒå¥—ç±» MethodName æˆ–è€… nameof è·å–æ–¹æ³•åç§°ã€‚ä½†æ˜¯
åœ¨é»˜è®¤å‚æ•°ç»‘å®šæ“ä½œä¸Šæœ‰å·®åˆ«ï¼ŒGDScript ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨ Callable å¯¹è±¡çš„ bind() æ–¹æ³•ç»‘å®šé»˜è®¤å‚æ•°ã€‚
è€Œç›®å‰åœ¨ C# ä¸­ç»™ä¿¡å·ç»‘å®šé»˜è®¤å‚æ•°åˆ™éœ€è¦ä½¿ç”¨ lambdas æ¥æ„é€ å‡ºä¸€ä¸ªåŒ…å«é»˜è®¤å‚æ•°çš„ Callable å¯¹è±¡ã€‚
å¦‚æœæ–¹æ³•æ²¡æœ‰å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰è¿”å›å€¼ï¼Œå¯ä»¥åŒ…è£…æˆ Actionï¼Œç”± Callable.From() å†åŒ…è£…æˆå¯è°ƒç”¨å¯¹è±¡ã€‚

```C#,ignore
    // Default parameter values are not supported.
    public void PrintArgs(Variant arg1, Variant arg2, Variant arg3 = default)
    {
        GD.PrintS(arg1, arg2, arg3);
    }

    public void Test()
    {
        Callable callback = Callable.From(() => GD.Print("Hello World"));

        // Invalid calls fail silently.
        Callable callable = new Callable(this, MethodName.PrintArgs);
        callable.Call("hello", "world"); // Default parameter values are not supported, should have 3 arguments.
        callable.Call(Vector2.Up, 42, callable); // Prints "(0, -1) 42 Node(Node.cs)::PrintArgs".
        callable.Call("invalid"); // Invalid call, should have 3 arguments.
    }
```

Godot 4.x Mono æ‰€æœ‰ä¿¡å·å®šä¹‰åç§°ä½¿ç”¨ EventHandler ç»“å°¾ï¼Œå®šä¹‰å¥½ä¿¡å·åï¼Œå®Œæˆåï¼ŒGodot åœ¨å¹•å
è‡ªåŠ¨ä½¿ç”¨ C# `event` å…³é”®å­—åˆ›å»ºç›¸åº”çš„äº‹ä»¶ã€‚ç„¶åï¼Œå¯ä»¥åƒå…¶ä»– Godot ä¿¡å·ä¸€æ ·ä½¿ç”¨è‡ªå®šä¹‰ä¿¡å·äº‹ä»¶ã€‚
æ³¨æ„ï¼Œç±»å‹å®šä¹‰ä½¿ç”¨çš„ partial classï¼Œå³è¡¨ç¤ºç±»å®šä¹‰ä»£ç æ˜¯åˆ†å¼€æ–‡ä»¶å­˜æ”¾çš„ï¼Œè¿˜å¯ä»¥åŒ…å«åœ¨å…¶å®ƒä»£ç æ–‡ä»¶ã€‚
é™¤äº†ç›´æ¥ä½¿ç”¨å§”æ‰˜æ–¹å¼å®šä¹‰ä¿¡å·ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ AddUserSignal() æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰ä¿¡å·ã€‚


Godot 3.x Mono è‡ªå®šä¹‰ä¿¡å·çš„ä½¿ç”¨æœ‰äº›å·®åˆ«ï¼Œè·å–ä¿¡å·åç§°ä½¿ç”¨ nameof(MySignal) è¯­æ³•ï¼Œå¹¶ä¸”ä¿¡å·
è¿æ¥ä¾ç„¶æ˜¯ä½¿ç”¨èŠ‚ç‚¹çš„ Connect æ–¹æ³•è¿›è¡Œã€‚ä¿¡å·åç§°çš„è·å–è¿™ç§æ“ä½œä¸€è‡´æ€§ä¸å¤Ÿå¥½ï¼Œä¾‹å¦‚ï¼Œè·å–æŒ‰é’®èŠ‚ç‚¹çš„
ä¿¡å·å°±ä¸èƒ½ä½¿ç”¨ nameof(Button.Pressed) è¿™æ ·çš„è¡¨è¾¾ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ "pressed" å­—ç¬¦ä¸²å­—é¢é‡ã€‚

æ€»ç»“èµ·æ¥ï¼ŒC# ä¸­æœ‰ä¸‰ç§è·å–æˆ–ä½¿ç”¨ä¿¡å·åç§°çš„æ–¹å¼ï¼ŒGodot 3.x åªæ”¯æŒå‰ä¸¤ç§ï¼š

- `EmitSignal("MySignal");` ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡
- `EmitSignal(nameof(MySignal));` ä½¿ç”¨ nameof å…³é”®å­—
- `EmitSignal(SignalName.MySignal);` ä½¿ç”¨å†…åµŒç±» SignalName


```C#,ignore
    //     Represents the method that handles the Godot.EditorPlugin.SceneChanged event
    //     of a Godot.EditorPlugin class.
    //public delegate void SceneChangedEventHandler(Node sceneRoot);
    //public event SceneChangedEventHandler SceneChanged;

    public partial class MyNode2D : Node2D
    {
        // Declaring a signal in Godot 3.x with C# is done with the [Signal] attribute on a delegate.
        [Signal]
        delegate void MySignal();

        [Signal]
        delegate void MySignalWithArguments(string foo, int bar);

        public override void _Ready() 
        {
            MyMethodEmittingSignals();
        }

        // Emitting signals is done with the EmitSignal method.
        public void MyMethodEmittingSignals()
        {
            //AddUserSignal("MyOtherSignal");
            EmitSignal(nameof(MySignal));
            EmitSignal("MySignalWithArguments", "hello there", 28);
        }
    }

    public partial class AnotherNode : Node2D
    {
        MyNode instance;

        public override void _Ready()
        {
            instance = GetNode("MyNode")
        }
        // These signals can then be connected either in the editor or from code with Connect.
        public void MyCallback()
        {
            GD.Print("My callback!");
        }

        public void MyCallbackWithArguments(string foo, int bar)
        {
            GD.Print("My callback with: ", foo, " and ", bar, "!");
        }

        public void SomeFunction()
        {
            instance.Connect("MySignal", this, "MyCallback");
            instance.Connect("MySignal", this, "MyCallbackWithArguments", new Godot.Collections.Array{"Mono", 123});
            instance.Connect(nameof(MySignalWithArguments), this, "MyCallbackWithArguments");
        }
    }
```

ä½¿ç”¨è‡ªå®šä¹‰ä¿¡å·å¯èƒ½é‡åˆ°çš„é—®é¢˜æ˜¯ï¼šè°ƒç”¨ EmitSignal() æ—¶æŠ¥é”™ï¼Œè¡¨ç¤ºä¿¡å·ä¸å­˜åœ¨ï¼Œè€Œè°ƒç”¨ AddUserSignal()
æ‰‹åŠ¨æ·»åŠ ä¿¡å·æ—¶ï¼Œåˆè¡¨ç¤ºä¸èƒ½é‡å¤æ·»åŠ å·²ç»å®šä¹‰çš„ä¿¡å·ï¼Œè¿™å¯èƒ½æ˜¯å®šä¹‰ä¿¡å·çš„ä»£ç æ²¡æœ‰å†™åˆ°ç±»ä½“å†…éƒ¨ï¼š

    E 0:00:07.120   emit_signal: Can't emit non-existing signal "MySignal".
      <C++ Error>   Condition "!signal_is_valid && !script.is_null() && !Ref<Script>(script)->has_script_signal(p_name)" is true. Returned: ERR_UNAVAILABLE
      <C++ Source>  core/object.cpp:1177 @ emit_signal()
      <Stack Trace> :0 @ void Godot.NativeCalls.godot_icall_2_695(IntPtr , IntPtr , System.String , System.Object[] )()
                    Object.cs:365 @ void Godot.Object.EmitSignal(System.String , System.Object[] )()
                    Node_2D.cs:17 @ void Node_2D.MyMethodEmittingSignals()()

    E 0:00:03.798   add_user_signal: Trying to add already existing signal 'MySignal'.
      <C++ Error>   Condition "signal_map.has(p_signal.name)" is true.
      <C++ Source>  core/object.cpp:1121 @ add_user_signal()
      <Stack Trace> :0 @ void Godot.NativeCalls.godot_icall_2_694(IntPtr , IntPtr , System.String , IntPtr )()
                    Object.cs:337 @ void Godot.Object.AddUserSignal(System.String , Godot.Collections.Array )()
                    Node_2D.cs:18 @ void Node_2D.MyMethodEmittingSignals()()


ä¸€äº› GDScript é‡ä¸åˆ°çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š

```C#,ignore
public partial class MyNode2D : Node2D
{
    public override _Ready()
    {
        // Position.X = 100.0f;
        // CS1612: Cannot modify the return value of 'Node2D.Position' because
        // it is not a variable.
        var newPosition = Position;
        newPosition.X = 100.0f;
        Position = newPosition;

        // C# 10 is required:
        // Position = Position with { X = 100.0f };
    }
}
```

ä¸€ä¸ªç±»å‹ä¸­ç»“æ„ä½“ï¼ŒVector2ï¼Œåœ¨ C# ä¸­æ˜¯é€šè¿‡æ‹·è´è¿›è¡Œèµ‹å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è·å– Position å±æ€§æ—¶ï¼Œè·å–åˆ°
çš„æ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯¹è¿™ä¸ªå‰¯æœ¬èµ‹å€¼å¹¶ä¸ä¼šå½±å“åˆ°åŸæ¥å½’å±çš„èŠ‚ç‚¹ã€‚è§£å†³æ–¹æ³•ï¼šåˆ›å»ºä¸€ä¸ªå˜é‡å¼•ç”¨ Position å†è¿›è¡Œ
èµ‹å€¼æ“ä½œã€‚åœ¨ C# 10 ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥å¯¹ç»“æ„ä½“ä½¿ç”¨ with è¡¨è¾¾å¼æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚

é€šå¸¸ï¼Œä½¿ç”¨ C# ç¼–ç¨‹è€Œä¸æ˜¯ GDScriptï¼Œä¸€ä¸ªä¸»è¦çš„ç›®çš„å¯èƒ½æ˜¯ä¸ºäº†æå‡ç¨‹åºè¿è¡Œé€Ÿåº¦ï¼Œæ‰€ä»¥åº”è¯¥é¿å…ç¼–å†™æ— 
æ•ˆç‡çš„ä»£ç ï¼Œä»¥ä¸‹æ˜¯ä¸¤ç§èŠ‚ç‚¹çš„ç§»åŠ¨æ–¹å¼å¯¹æ¯”ï¼Œåè€…æ›´é«˜æ•ˆï¼š

```C#,ignore
using Godot;

public partial class YourCustomClass : Node3D
{
    private void ExpensiveReposition()
    {
        for (var i = 0; i < 10; i++)
        {
            // Position is read and set 10 times which incurs native interop.
            // Furthermore the object is repositioned 10 times in 3D space which
            // takes additional time.
            Position += new Vector3(i, i);
        }
    }

    private void Reposition()
    {
        // A variable is used to avoid native interop for Position on every loop.
        var newPosition = Position;
        for (var i = 0; i < 10; i++)
        {
            newPosition += new Vector3(i, i);
        }
        // Setting Position only once avoids native interop and repositioning in 3D space.
        Position = newPosition;
    }
}
```

ç»™ Godot C# API ä¼ é€’åŸå§‹çš„ byte[] æˆ–è€…å­—ç¬¦ä¸²ï¼Œéœ€è¦ marshalling æ“ä½œï¼Œè¿™ç›¸å¯¹ä¸å¤Ÿé«˜æ•ˆã€‚éšå¼è½¬æ¢
string ä¸º NodePath æˆ– StringName ä¼šäº§ç”ŸåŸç”Ÿäº’æ“ä½œå’Œ marshalling æˆæœ¬ï¼Œå› ä¸ºå­—ç¬¦ä¸²å¿…é¡»ç¼–ç»„å¹¶
ä¼ é€’ç»™ç›¸åº”çš„åŸç”Ÿæ„é€ å‡½æ•°ã€‚


### ğŸŸ ğŸ”µ Export in CSharp

ä»¥ä¸‹æ¼”ç¤ºåœ¨ Godot 4.x Mono ä¸­ä½¿ç”¨ C# [Export] æ ‡æ³¨å¯¼å‡ºç¬¦å·ï¼Œä»¥åŠä½¿ç”¨ [Signal] è‡ªå®šä¹‰ä¿¡å·ï¼š

```C#,ignore
using Godot;

[Signal]
public delegate void MySignalEventHandler();

[Signal]
public delegate void MySignalWithArgumentEventHandler(string myString);

public partial class MyNode : Node
{
    [Export]
    private NodePath _nodePath;

    [Export]
    private string _name = "default";

    [Export(PropertyHint.Range, "0,100000,1000,or_greater")]
    private int _income;

    [Export(PropertyHint.File, "*.png,*.jpg")]
    private string _icon;

    public void MyMethodEmittingSignals()
    {
        EmitSignal(SignalName.MySignal);
        EmitSignal(SignalName.MySignalWithArgument, "World");
    }
}
```

å…¶å®ƒå¯¼å‡ºæ ‡æ³¨ç”¨æ³•å‚è€ƒï¼Œé«˜çº§å¯¼å‡ºå‚è€ƒ get_property_list æ–¹æ³•çš„ä½¿ç”¨ï¼Œç›®å‰ Godot 3 ä¸æ”¯æŒå¯¼å‡ºåˆ†ç»„ï¼š

```C#,ignore
    [ExportGroup("My Properties")]
    [Export]
    private int Number = 3;

    [ExportSubgroup("Extra Properties")]
    [Export]
    private string Text = "";
    [Export]
    private bool Flag = false;

    [ExportCategory("Main Category")]
    [Export]
    private int Number = 3;
    [Export]
    private string Text = "";

    [ExportCategory("Extra Category")]
    [Export]
    private bool Flag = false;


    [Export]
    private Resource Resource;

    [Export]
    private AnimationNode Resource;

    [Export]
    private Color Col;

    [Export(PropertyHint.ColorNoAlpha)]
    private Color Col;


    [Export]
    private Vector3[] Vector3s = new Vector3[0];
    [Export]
    private String[] String = new String[0];


    [Export(PropertyHint.Layers2dPhysics)]
    private int Layers2dPhysics;
    [Export(PropertyHint.Layers2dRender)]
    private int Layers2dRender;
    [Export(PropertyHint.Layers3dPhysics)]
    private int layers3dPhysics;
    [Export(PropertyHint.Layers3dRender)]
    private int layers3dRender;


    // Set any of the given flags from the editor.
    [Export(PropertyHint.Flags, "Fire,Water,Earth,Wind")]
    private int SpellElements = 0;


    [Export(PropertyHint.ExpEasing)]
    private float TransitionSpeed;

    [Export(PropertyHint.Range, "0,20,")]
    private int Number;

    [Export(PropertyHint.Range, "-10,20,")]
    private int Number;

    [Export(PropertyHint.Range, "-10,20,0.2")]
    private float Number;

    [Export(PropertyHint.Range, "0,100,1,or_greater,or_lesser")]
    private int Number;

    [Export(PropertyHint.ExpRange, "100,1000,20")]
    private float Number;


    [Export(PropertyHint.File)]
    private string GameFile;

    [Export(PropertyHint.Dir)]
    private string GameDirectory;

    [Export(PropertyHint.File, "*.txt,")]
    private string GameFile;


    [Export]
    private NodePath MyNodePath;
    private Label MyNode;

    public override void _Ready()
    {
        MyNode = GetNode<Label>(MyNodePath);
    }

    // Editor will enumerate as 0, 1 and 2.
    [Export(PropertyHint.Enum, "Warrior,Magician,Thief")]
    private int CharacterClass;
    
    [Export(PropertyHint.Enum, "Rebecca,Mary,Leah")]
    private string CharacterName;

    private enum NamedEnum
    {
        Thing1,
        Thing2,
        AnotherThing = -1
    }
    [Export(PropertyHint.Enum)]
    private NamedEnum X;
```

### ğŸŸ ğŸ”µ Godot Plugin in CSharp
- https://github.com/m50/Godot-CSharp-Node-Exports
- [.NET project SDKs](https://learn.microsoft.com/en-us/dotnet/core/project-sdk/overview)
- [Attribute åŸºç±»](https://learn.microsoft.com/zh-cn/dotnet/api/system.attribute?view=net-7.0)
- [CompilerServices å‘½åç©ºé—´](https://learn.microsoft.com/zh-cn/dotnet/api/system.runtime.compilerservices)
- https://referencesource.microsoft.com/#mscorlib/system/runtime/compilerservices/datetimeconstantattribute.cs
- https://docs.godotengine.org/en/3.5/tutorials/plugins/editor/index.html
- https://godotengine.org/asset-library/

C# ä¸­æ²¡æœ‰ class_name è¿™æ ·çš„å…³é”®å­—ç”¨æ¥æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ï¼Œè¿™å¯ä»¥ä½¿ç”¨æ’ä»¶çš„ Custom typesã€‚é€šè¿‡èœå•
åˆ›å»ºæ’ä»¶ï¼šProject â†’ Project Settings â†’ Plugins â†’ Create new Pluginã€‚ä½¿ç”¨ C# åˆ›å»ºæ’ä»¶æ—¶ï¼Œ
æ³¨æ„è„šæœ¬åç§°å’Œç±»åè¦ä¸€è‡´ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨ AssetLib â†’ Plugins æ‰“å¼€æ’ä»¶ç®¡ç†é¢æ¿ï¼Œå¹¶ä¸”ä½¿ç”¨ AssetLib æä¾›çš„ Import æŒ‰é’®æ¥å®‰è£…
æ’ä»¶ã€‚å¼€å‘å¥½çš„æ’ä»¶åªéœ€è¦æ‰“åŒ…æˆ zip æ–‡ä»¶ï¼Œæ³¨æ„è¦å°† addons ç›®å½•å±‚çº§ä¸€å¹¶æ‰“åŒ…ï¼ŒImport æ‰§è¡Œå®‰è£…æ˜¯ç›´æ¥
è§£å‹æ–‡ä»¶åˆ°å·¥ç¨‹æ ¹ç›®å½•ã€‚

å¼€å‘å¥½çš„æ’ä»¶è¿˜å¯ä»¥ä¸Šä¼  Godot Asset Library åˆ†äº«ï¼Œåªéœ€è¦æ³¨å†Œä¸€ä¸ªè´¦æˆ·å³å¯ã€‚ä¸Šä¼ èµ„äº§æ—¶åªéœ€è¦ç™»è®°
ç›¸å…³çš„æ’ä»¶ä¿¡æ¯ï¼Œä¸‹è½½é“¾æ¥åœ°å€ï¼Œä½¿ç”¨ Github æ‰˜ç®¡å¾ˆå®¹æ˜“å¤„ç†ï¼Œå¡«å†™ç›¸åº”çš„ Commit ID å’Œé¢„è§ˆå›¾å³å¯ï¼Œ
ç„¶åç­‰å¾…å®¡æ ¸é€šè¿‡åå³å¯ä»¥åœ¨åˆ—è¡¨ä¸­æœç´¢åˆ°ï¼ŒFeed é¡µé¢å¯ä»¥æŸ¥çœ‹èµ„äº§çš„å®¡æ ¸çŠ¶æ€ã€‚


C# ä¸­å¯ä»¥è‡ªå®šä¹‰æ ‡æ³¨å®ç°ç±»ä¼¼ GDScript ä¸­çš„ classname æ³¨å†Œè‡ªå®šä¹‰ç±»å‹ï¼š

- **System.Attribute** è‡ªå®šä¹‰æ ‡æ³¨éœ€è¦ç»§æ‰¿çš„åŸºç±»ï¼›
- **System.AttributeUsage** è®¾ç½®è‡ªå®šä¹‰æ ‡æ³¨çš„ç”¨é€”ï¼Œä»¥åŠ AllowMultipleï¼ŒInherited ç­‰å±æ€§ï¼›
- **System.AttributeTargets** æä¾›æ ‡æ³¨ç”¨é€”çš„æšä¸¾ç±»å‹å®šä¹‰ï¼Œå¦‚ Class, Method, Property ç­‰ç­‰ç”¨é€”ï¼›
- [System.AttributeUsage(System.AttributeTargets.Class)] æŒ‡å®šè‡ªå®šä¹‰æ ‡æ³¨ä½œç”¨äºç±»å‹å®šä¹‰ï¼›
- [System.AttributeUsage(System.AttributeTargets.Method)] æŒ‡å®šè‡ªå®šä¹‰æ ‡æ³¨ä½œç”¨äºç±»å‹å®šä¹‰ï¼›

æ­¤å¤–ï¼ŒSystem.Runtime.CompilerServices å‘½åç©ºé—´ä¸‹æä¾›äº†ä¸€ç³»åˆ—ç¼–è¯‘è·å–ä¿¡æ¯çš„æ ‡æ³¨ï¼Œå¦‚ï¼š

- **CallerFilePathAttribute** è·å–åŒ…å«è°ƒç”¨æ–¹çš„æºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ è¿™æ˜¯ç¼–è¯‘æ—¶çš„æ–‡ä»¶è·¯å¾„ã€‚
- **CallerLineNumberAttribute** è·å–æºæ–‡ä»¶ä¸­è°ƒç”¨æ–¹æ³•çš„è¡Œå·ã€‚
- **CallerMemberNameAttribute** è·å–æ–¹æ³•è°ƒç”¨æ–¹çš„æ–¹æ³•æˆ–å±æ€§åç§°ã€‚
- **DateTimeConstantAttribute** ä¸ºå­—æ®µæˆ–å‚æ•°æ°¸ä¹…ä¿å­˜ä¸€ä¸ª 8 å­—èŠ‚çš„ DateTime å¸¸æ•°ã€‚

Caller å’Œ Callee åˆ†åˆ«è¡¨ç¤ºä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•çš„åŒæ–¹ï¼ŒCaller æ˜¯ä¸»åŠ¨è°ƒç”¨ï¼ŒCallee æ˜¯è¢«è°ƒç”¨æ–¹ã€‚
å‘ Godot æ³¨å†Œè‡ªå®šä¹‰ç±»å‹éœ€è¦ä½¿ç”¨å…¶è„šæœ¬ï¼Œéœ€è¦ä½¿ç”¨ [CallerFilePath] æ ‡æ³¨è·å–è„šæœ¬è·¯å¾„ï¼Œå¹¶é€šè¿‡èµ„æº
ç®¡ç†å™¨ ResourceLoader åŠ è½½å®ƒå¾—åˆ°è„šæœ¬å¯¹è±¡ã€‚åŠ è½½è„šæœ¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªèµ„æºç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼è¿›è¡Œè½¬æ¢ï¼š

```C#
    Script script = ResourceLoader.Load(target.ScriptPath) as Script;
    Script script = ResourceLoader.Load<Script>(target.ScriptPath);
    Script script = (Script) ResourceLoader.Load(target.ScriptPath);
```

æœ€æ–°çš„ Godot 4 beta 16 æä¾›äº†ä¸€ä¸ª GodotClassNameAttribute æ ‡æ³¨ï¼Œä½†å®ƒä¸æ˜¯ç”¨æ¥æ³¨å†Œè‡ªå®šä¹‰ç±»å‹ã€‚
å®ƒç”¨æ¥åœ¨ç”Ÿæˆçš„ C# ä»£ç ä¸­çš„ç±»åä¸ä¸€è‡´æ—¶æŒ‡å®šå¼•æ“ç±»åï¼Œä»¥å…è®¸å†…çœä»£ç æŸ¥æ‰¾ä¸ç±»å…³è”çš„åç§°ã€‚

C# å…ƒæ•°æ®ç¼–ç¨‹ä¸­ï¼Œä¸€ä¸ªæ–¹æ ¼å·å†…å¯ä»¥åŒ…å«å¤šä¸ªæ ‡æ³¨ï¼Œæ¯ä¸ªæ ‡æ³¨ä½¿ç”¨åœ†æ‹¬å·é€šè¿‡ = è¿ç®—ç¬¦å¯¹å…¶å±æ€§è¿›è¡Œèµ‹å€¼ã€‚
å¯¹æ ‡æ³¨å¥½çš„ä»£ç è¿›è¡Œå¤„ç†æ—¶ï¼Œä½¿ç”¨ç¨‹åºé›†å¯¹è±¡ Assembly æä¾›çš„åå°„æ–¹æ³•ï¼Œå¯¹å½“å‰è¿è¡Œä¸­çš„ç¨‹åºé›†è¿›è¡Œå¤„ç†ã€‚
é€šè¿‡å¤„ç†ç¨‹åºé›†ä¸­æ ‡æ³¨è¿‡çš„ç±»å‹ï¼Œä½¿ç”¨ AddCustomType() å°†è‡ªå®šä¹‰ç±»å‹æ³¨å†Œåˆ° Godot ç³»ç»Ÿå†…ï¼š

```C#
    using System.Reflection;

    var assembly = Assembly.GetExecutingAssembly();
    foreach (var t in assembly.GetTypes())
    {
        MyAttribute mytype = t.GetCustomAttribute<MyAttribute>();
        if (item == null) continue;
        ...
    }

    // in Godot 4.x
    Connect("resource_saved", new Callable(this, nameof(OnResourceSaved)));
    AddToolMenuItem("Reload C# Resources", new Callable(this, nameof(BuildTypes)));
    // in Godot 3.x
    Connect("resource_saved", this, "OnResourceSaved");
    AddToolMenuItem("Reload C# Resources", this, nameof(BuildTypes));
```

åœ¨ Godot è§¦å‘è‡ªå®šä¹‰èŠ‚ç‚¹æ³¨å†Œè¡Œä¸ºï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å·¥å…·èœå• AddToolMenuItem() æ¥è®©ç”¨æˆ·æ“ä½œï¼Œå®ƒä¼šå‘
Project â†’ Tools æ·»åŠ èœå•ï¼Œéœ€è¦åœ¨ç¦ç”¨æ’ä»¶é…åˆ RemoveToolMenuItem() åšèœå•æ¸…ç†ï¼Œé¿å…é‡å¤æ·»åŠ ã€‚
ä¹Ÿå¯ä»¥ä½¿ç”¨ EditorPlugin çš„ä¿¡å·æ¥è§¦å‘ï¼Œæ’ä»¶æä¾›çš„ä¿¡å·åŒ…å«åœºæ™¯å˜åŠ¨ã€èµ„æºä¿å­˜ã€å·¥ç¨‹é…ç½®å˜åŠ¨ç­‰ç­‰ã€‚ä¿å­˜
æ–‡ä»¶ï¼ŒåŒ…æ‹¬å„ç§èµ„æºæ–‡ä»¶ï¼Œå°±ä¼šè§¦å‘ **resource_saved** ä¿¡å·ã€‚

æ’ä»¶ä¸­çš„è‡ªå®šä¹‰æ ‡æ³¨éœ€è¦åœ¨ Godot å·¥ç¨‹ä¸­å…¶å®ƒä»£ç å¼•ç”¨ï¼ŒC# å·¥ç¨‹æ–‡ä»¶ ``.csproj`` è¦æ­£ç¡®å¼•ç”¨``.cs``ï¼Œ
å¹¶ä¸”éœ€è¦æ„å»ºå¥½ C# é¡¹ç›®ä½¿å…¶ç”Ÿæ•ˆã€‚å¦åˆ™ï¼Œå¯ç”¨æ’ä»¶æ—¶å°±ä¼šæç¤ºä¸èƒ½åŠ è½½æ’ä»¶è„šæœ¬ï¼Œå› ä¸º Godot ä¸èƒ½é€šè¿‡è„šæœ¬
æä¾›ç±»å‹åç§°æ‰¾åˆ°ç›¸åº”çš„ç¨‹åºé›†ä¸­å¯¹åº”çš„ç±»å‹ã€‚

```sh
<Project Sdk="Godot.NET.Sdk/4.0.0-beta.16">
  <PropertyGroup>
    <TargetFramework>net6.0</TargetFramework>
    <EnableDynamicLoading>true</EnableDynamicLoading>
    <EnableDefaultCompileItems>false</EnableDefaultCompileItems>
  </PropertyGroup>
  <ItemGroup>
    <Compile Include="addons/**/*.cs" Condition=" '$(Configuration)' == 'Debug' " />
    <Compile Include="src/*.cs" />
  </ItemGroup>
</Project>
```

ä¸€ä¸ªæœ€ç®€å•çš„æ’ä»¶å¯ä»¥åªåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒå‘å¼•æ“æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```py
    tool
    extends EditorPlugin

    func _enter_tree():
        # When this plugin node enters tree, add the custom type
        add_custom_type("Heart", "Node2D", preload("res://addons/custom_node/heart.gd"), preload("res://addons/custom_node/heart_icon.png"))
        # public void AddCustomType(string type, string @base, Script script, Texture2D icon);

    func _exit_tree():
        # When the plugin node exits the tree, remove the custom type
        remove_custom_type("Heart")
        # public void RemoveCustomType(string type);
```

```C#,ignore
    #if TOOLS
    using Godot;
    using System;

    [Tool]
    public partial class Plugin : EditorPlugin
    {
        public override void _EnterTree()
        {
            // Initialization of the plugin goes here.
        }

        public override void _ExitTree()
        {
            // Clean-up of the plugin goes here.
        }
    }
    #endif
```

ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬æ’ä»¶ï¼Œè¿æ¥åˆ° Root Viewport å³æˆä¸ºåœºæ™¯æ ‘ä¸­çš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œæœ€åèŠ‚ç‚¹è¢«ç§»é™¤ï¼Œä¾æ¬¡è§¦å‘å›è°ƒæ–¹æ³•ï¼š

```py
_enter_tree() 
_ready() 
_exit_tree()
```

èŠ‚ç‚¹æ ‘æ‰€æœ‰èŠ‚ç‚¹ä¼šæŒ‰ä½ç½®å…ˆåã€ç”±è¡¨å±‚åˆ°å†…å±‚ä¾æ¬¡æ‰§è¡Œ enter_tree æ–¹æ³•ï¼Œè€Œ ready å’Œ exit_tree æ–¹æ³•ï¼Œ
åˆ™ä¸åŒï¼Œä¼šå…ˆç”±å†…å±‚åˆ°å¤–å±‚çš„é¡ºåºæ‰§è¡Œï¼Œçˆ¶çº§èŠ‚ç‚¹éœ€è¦ç­‰å¾…å†…å±‚èŠ‚ç‚¹å·¥ä½œå®Œæˆæ‰èƒ½æ‰§è¡Œ ready ç­‰åŠ¨ä½œã€‚

å¯¹äºæ’ä»¶ï¼ŒProject â†’ Project Settings â†’ Plugins é¢æ¿ä¸­å¯ç”¨å®ƒï¼Œå³æ·»åŠ åˆ°åœºæ™¯æ ‘ä¸Šï¼Œç¦ç”¨æ—¶å³ç§»é™¤ã€‚
æ’ä»¶ä»£ç å¦‚æœæœ‰æ›´æ–°ï¼Œä¹Ÿéœ€è¦é€šè¿‡ç¦ç”¨å†é‡æ–°å¯ç”¨æ¥æ›´æ–°ï¼Œå¹¶é‡æ–°æ‰§è¡Œåˆå§‹åŒ–ã€‚Godot 4 beta 16 ä¸­ï¼Œåªè¦
é‡æ–°æ‰§è¡Œæ„å»ºï¼Œæ’ä»¶åŠŸèƒ½å³å¯ä»¥éšä¹‹æ›´æ–°ï¼Œä¸éœ€è¦é‡æ–°è®¾ç½®å·¥ç¨‹æ’ä»¶é…ç½®ï¼Œä½†åˆå§‹åŒ–åœ¨ä¸‹æ¬¡å¯ç”¨æ’ä»¶æ—¶æ‰§è¡Œã€‚

ä»¥ä¸‹æ˜¯ CustomTypes æ’ä»¶çš„å®ç°ï¼Œæœ‰ä¸¤ä¸ª C# ä»£ç æ–‡ä»¶ï¼Œä¸€ä¸ªæ ‡æ³¨å®šä¹‰ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸»è„šæœ¬ã€‚é€šè¿‡å·¥ç¨‹é…ç½®
å¯ç”¨æ’ä»¶ï¼šProject â†’ Project Settings... â†’ Plugins â†’ CustomTypes â†’ Enable/Disableã€‚

ç„¶åï¼Œæ’ä»¶ä¼šå‘ Project â†’ Tools å·¥å…·èœå•ä¸­æ³¨å†Œä¸¤ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«ç”¨äºæ›´æ–°è‡ªå®šä¹‰ç±»å‹çš„æ³¨å†Œå’Œæ¸…ç†ï¼š

- Project â†’ Tools â†’ C# Custom Types: Register
- Project â†’ Tools â†’ C# Custom Types: Clear

æ ‡æ³¨å®šä¹‰ä»£ç æ–‡ä»¶ ClassNameAttribute.cs å†…å®¹ï¼š

```C#,ignore
    using System;
    using System.Runtime.CompilerServices;

    namespace CustomTypes.Attributes
    {
      [AttributeUsage(AttributeTargets.Class, Inherited = false)]
      class ClassNameAttribute : Attribute
      {
        // [DateTimeConstantAttribute(1675150868847)]
        // public DateTime timestamp;
        public string Name = "";
        public string Icon = "";
        public string ScriptPath = "";

        public ClassNameAttribute([CallerFilePath] string scriptPath = "")
        {
          ScriptPath = scriptPath;
        }
      }
    }
```

Custom Types æ’ä»¶ä¸»è„šæœ¬æ–‡ä»¶ Plugin.csï¼Œåœ¨åˆ›å»ºæ’ä»¶æ—¶å°†å…¶å¡«å†™åˆ° Script Name å­—æ®µä¸­ï¼š

```C#,ignore
    #if TOOLS
    using Godot;
    using System;
    using System.Reflection;
    using System.Collections.Generic;
    using CustomTypes.Attributes;

    namespace CustomTypes
    {
        
    [Tool]
    /// <summary>
    /// Register custom types like GDScript class_name.
    /// to enable/disable CustomType plugin, use Project Setting:
    ///         Project â†’ Project Settings... â†’ Plugins â†’ CustomTypes â†’ Enable/Disable
    /// 
    /// to register/unregister, use Project menu :
    ///         Project â†’ Tools â†’ C# Custom Types: Register
    ///         Project â†’ Tools â†’ C# Custom Types: Clear
    /// </summary>
    ///
    /// example:
    ///
    /// ```csharp
    /// using CustomTypes.Attributes;
    /// using Godot;
    ///
    /// [ClassName(Icon="res://Path/To/Icon.png")]
    /// public class MyResource : Resource
    /// {
    ///     //...
    /// }
    /// 
    /// [ClassName(Name="MyCsharpNode2D", Icon="res://bullet.svg")]
    /// public partial class MyNode2D : Node2D
    /// {
    ///     // ...
    /// }
    /// ```
    public partial class Plugin : EditorPlugin
    {
        
        string toolname_add = "C# Custom Types: Register";
        string toolname_clear = "C# Custom Types: Clear";
        List<string> types = new List<string>();

        public void RegCustomTypes()
        {
            Assembly assembly = Assembly.GetExecutingAssembly();
            foreach (var item in assembly.GetTypes())
            {
                var target = item.GetCustomAttribute<ClassNameAttribute>();
                // GD.Print("target: ", item);
                
                if (target == null) continue;
                if (!item.IsSubclassOf(typeof(Godot.Resource)) && !item.IsSubclassOf(typeof(Godot.Node)))
                {
                    GD.Print($"CustomTypes can be Godot.Resource or Godot.Node, but not {item}!");
                    continue;
                }
                Script script = ResourceLoader.Load(target.ScriptPath) as Script;
                // Script script = (Script) ResourceLoader.Load(target.ScriptPath);
                // Script script = ResourceLoader.Load<Script>(target.ScriptPath);
                Texture2D icon = new Texture2D();
                if (target.Icon != "") {
                    icon = ResourceLoader.Load(target.Icon) as Texture2D;
                }
                string name = target.Name == ""? item.Name : target.Name;
                AddCustomType(name, item.BaseType.Name, script, icon);
                types.Add(name);

                GD.Print($"Add Custom Type: {name}:{item.BaseType.Name}");
            }
        }

        public override void _EnterTree()
        {
            // Initialization of the plugin goes here.
            SceneChanged += (Node sceneRoot) => GD.Print("SceneChanged: ", sceneRoot);
            SceneClosed += (string filepath) => GD.Print("SceneClosed: ", filepath);
            MainScreenChanged += (string screenName) => GD.Print("MainScreenChanged: ", screenName);
            ResourceSaved += (Resource resource) => GD.Print("ResourceSaved: ", resource);
            ProjectSettingsChanged += () => GD.Print("ProjectSettingsChanged");
            GD.Print("Signals tester registered.");
            AddToolMenuItem(toolname_add, new Callable(this, nameof(RegCustomTypes)));
            AddToolMenuItem(toolname_clear, new Callable(this, nameof(ClearCustomType)));
            RegCustomTypes();
        }

        public override void _Ready()
        {
            GD.Print("plugin ready: CustomTypes");
        }

        public override void _ExitTree()
        {
            RemoveToolMenuItem(toolname_add);
            RemoveToolMenuItem(toolname_clear);
            ClearCustomType();
        }

        void ClearCustomType()
        {
            foreach (var item in types)
            {
                RemoveCustomType(item);
                GD.Print($"RemoveCustomType: {item}");
            }
        }
    }
    }

    #endif
```

## ğŸŸ¡ Godot XR
- [Godot XR Tools - AR and VR helper library](https://godotengine.org/asset-library/asset/214)
- [Godot XR Tools](https://github.com/GodotVR/godot-xr-tools)
- [Godot XR Docs](https://godotvr.github.io/godot-xr-tools)
- [Godot XR Update](https://godotengine.org/article/godot-xr-progress-update-jan-2023/)
- [Godot XR Template](https://github.com/GodotVR/godot-xr-template)

Godot XR Tools - AR and VR helper library 3.2.0

These are support scenes for creating AR and VR applications in Godot.
Please note: Godot XR Tools v3 has breaking changes compared to v2!
They need to be used in combination with one of the AR or VR interfaces.
This plugin requires features added to Godot 3.5


## ğŸŸ¡ CLI & LSP å‘½ä»¤è¡Œå·¥å…·ä¸ä»£ç æç¤º
- https://docs.godotengine.org/en/stable/tutorials/editor/command_line_tutorial.html
- [GDScript support for Sublime Text](https://packagecontrol.io/packages/GDScript%20(Godot%20Engine)
- [LSP - Language Server Protocol for Sublime Text](https://packagecontrol.io/packages/LSP)
- [LSP Client - GDScript (Godot Engine)](https://lsp.sublimetext.io/language_servers/#gdscript-godot-engine)
- [Language Server Protocol Specification](https://microsoft.github.io/language-server-protocol/specification)
- [TypeScript Wiki - Writing a Language Service Plugin](https://github.com/Microsoft/TypeScript/wiki/Writing-a-Language-Service-Plugin)
- godot\3.5.1-stable\editor\editor_settings.cpp
- godot\3.5.1-stable\modules\gdscript\language_server\lsp.hpp
- godot\3.5.1-stable\modules\gdscript\language_server\gdscript_language_server.h
- godot\master\modules\gdscript\language_server\godot_lsp.h
- godot\master\modules\gdscript\language_server\gdscript_language_server.h
- godot\master\modules\gdscript\language_server\gdscript_language_protocol.h
- [Vulkan SDK Download](https://vulkan.lunarg.com/sdk/home)
- [COC - Make your Vim/Neovim as smart as VSCode](https://github.com/neoclide/coc.nvim)
- [COC Wiki - Language servers](https://github.com/neoclide/coc.nvim/wiki/Language-servers)

å‘½ä»¤è¡Œåˆ›å»ºè¿œç¨‹ git å·¥ç¨‹ï¼š

```sh
    $user="jimboyeah"
    $repo="godot-tour"
    git init
    curl -u "$user" https://api.github.com/user/repos -d "{`"$name`":`"$repo`"}"
    git remote add origin git@github.com:$user/$repo.git
    git add readme.md
    git commit -m "Welcome to Godot Tour!"
    git push origin master
```
<!-- 
github-recovery-codes.txt

    50ae9-a6438
    07419-b92e9
    f985e-157ee
    d9397-bea24
    8ec6c-fb375
    89d80-27bea
    9fc36-42790
    f60ec-c9f8f
    7144d-c127e
    6ddec-f4fc3
    3d0f5-a5e44
    c5224-3ddf2
    0156c-a5f3e
    f2a36-88cf1
    552af-80475
    cf28b-9621b
 -->

COC æ˜¯ä¸€ä¸ª NVim ä¸Šä½¿ç”¨çš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½æ’ä»¶ï¼Œå…¶æœ¬èº«å¹¶ä¸æä¾›å…·ä½“è¯­è¨€çš„è¡¥å…¨åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸€ä¸ªé€šè¿‡æ’ä»¶æœºåˆ¶å’Œ
LSP æœåŠ¡æä¾›è¡¥å…¨åŠŸèƒ½çš„å¹³å°ã€‚æ‰§è¡Œ `:CocInfo` å‘½ä»¤æŸ¥è¯¢å®‰è£…æ˜¯å¦æˆåŠŸï¼š

    ## versions

    vim version: NVIM v0.7.0
    node version: v14.0.0
    coc.nvim version: 0.0.82-b7375d5f 2023-01-30 05:09:03 +0800
    coc.nvim directory: C:\Users\OCEAN\.vim\plugged\coc.nvim
    term: vtpcon
    platform: win32

ä½¿ç”¨ `:h coc-config-languageserver` å‘½ä»¤æŸ¥è¯¢è¯­è¨€æœåŠ¡é…ç½®å¸®åŠ©æ–‡æ¡£ï¼š

```json
{
    "languageserver": {
        "godot": {
          "host": "127.0.0.1",
          "filetypes": ["gd", "gdscript", "gdscript3"],
          "port": 6008
        }
    }
}
```
æ‰§è¡Œ Vim å‘½ä»¤ `:CocConfig` è¿›å…¥é…ç½®é¡µé¢ï¼Œå¹¶ä¿å­˜é…ç½®ï¼Œå†æ‰§è¡Œ`:CocInstall coc-godot` å®‰è£…ã€‚

Vim å‰ªè´´å¤åˆ¶æ“ä½œéœ€è¦ä½¿ç”¨å…¶å¯„å­˜å™¨ï¼Œå‰ªè´´æé»˜è®¤ä¸º * å¯„å­˜ï¼Œæ“ä½œå¯„å­˜å™¨ä½¿ç”¨ â€ ç¬¦å·ï¼Œç²˜è´´å‘½ä»¤ä¸º Pï¼Œæ‰€ä»¥
æ•´ä¸ªç²˜è´´æ“ä½œçš„å‘½ä»¤å°±æ˜¯ `"*P`ï¼Œå¤åˆ¶å‘½ä»¤ä¸º `"*Y`ï¼ŒæŸ¥çœ‹å¯„å­˜å™¨å†…å®¹ä½¿ç”¨å‘½ä»¤ `:reg`ã€‚

å®‰è£…æ’ä»¶é›†å¸‚ `:CocInstall coc-marketplace` ç„¶åå†æ‰§è¡Œ `:CocList marketplace` å‘½ä»¤æŸ¥è¯¢
å¯ç”¨æ’ä»¶ï¼Œå¹¶é€‰æ‹©å®‰è£…æˆ–å¸è½½ï¼Œæ‰“å‹¾è¡¨ç¤ºå·²ç»å®‰è£…ã€‚åœ¨ extensions ç®¡ç†åˆ—è¡¨ä¸­ï¼Œæ˜Ÿå·è¡¨ç¤ºå¯ç”¨ã€‚

01. å®‰è£…å‘½ä»¤ `:CocInstall plugin_name`
02. ç§»é™¤å‘½ä»¤ `:CocUninstall plugin_name`
03. å·²è£…æ‰©å±• `:CocList extensions`
04. æ›´æ–°å‘½ä»¤ `:CocUpdate`
05. å·²å®‰è£…æœåŠ¡ `:CocList services`
06. æŸ¥è¯¢å¯ç”¨å‘½ä»¤ `:CocList commands`
07. å½“å‰æ£€æµ‹åˆ°çš„æ–‡ä»¶ç±»å‹ `:CocCommand document.echoFiletype`




LSP - Language Server Protocol æ˜¯ä¸€ç§ç”¨äºç»™ç¼–è¾‘å™¨æä¾›ä»£ç æç¤ºåŠŸèƒ½çš„åè®®ï¼ŒLSP åè®®å®šä¹‰çš„æ˜¯
ä»£ç ç¼–è¾‘å™¨ä¸æŒ‡å®šè¯­è¨€è¯­æ³•ã€å…³é”®å­—å’Œå„ç§å¯¹è±¡ç¬¦å·ä¹‹é—´çš„é€šä¿¡æ–‡æ¡£æ ¼å¼ï¼Œç¼–è¾‘åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°†å†…å®¹
å‘é€åˆ° LSP æœåŠ¡å™¨ã€‚è€Œå„ç§è¯­è¨€çš„å®˜æ–¹é€šå¸¸ä¼šå®ç°è‡ªå®¶çš„ LSP Clientï¼ŒLSP æœåŠ¡å™¨æ ¹æ®é…ç½®æ–‡ä»¶ç›¸è¯¢æŒ‡å®š
è¯­è¨€å¯¹åº”çš„ LSP Clientï¼Œå¹¶ä»å…¶è·å–ç¬¦åˆ LSP åè®®è§„èŒƒçš„æ•°æ®ï¼Œå¹¶åé¦ˆç»™ä»£ç ç¼–è¾‘å™¨ï¼Œé€šå¸¸ä»£ç ç¼–è¾‘å™¨ä¸­
ä¼šé€šè¿‡æ’ä»¶çš„å½¢å¼æä¾› LSP åŠŸèƒ½ã€‚æ¯”å¦‚ï¼ŒVSCode æˆ–è€… Sublime Text ç­‰è½¯ä»¶éƒ½æœ‰ç›¸åº”çš„ LSP æ’ä»¶ã€‚

LSP - Language Server Protocol æ˜¯ä¸€ç§ç¼–ç¨‹è¾…åŠ©å·¥å…·ï¼Œç®€å•åœ°è¯´ LSP åè®®æœ‰ä¸¤ä¸ªä¸»ä½“ï¼š

- Editor æŒ‰ç…§ LSP çš„æ¶ˆæ¯è§„èŒƒå‘ Language Server æ–¹å‘é€ç”¨æˆ·æ“ä½œã€å½“å‰ç¼–è¾‘ä»£ç çš„ç›¸å…³ä¿¡æ¯ï¼›
- Server æŒ‰ç…§ LSP åè®®æä¾›æŸ¥è¯¢æœåŠ¡ï¼Œå“åº”ç¼–è¾‘å™¨è¯·æ±‚ï¼Œå¹¶æ ¹æ®ç¨‹åºä¸Šä¸‹æ–‡ç»™å‡ºå»ºè®®ã€è¯­æ³•æ£€æŸ¥ã€è‡ªåŠ¨å®Œæˆç­‰ç­‰ã€‚

LSP çš„å¥½å¤„å°±æ˜¯ç»Ÿä¸€ï¼Œæ‰€ä»¥è¯­è¨€é€šè¿‡æœåŠ¡å™¨æä¾›æ™ºèƒ½æ“ä½œï¼Œé€šæ•°æ®é€šä¿¡ä½¿ç”¨ JSON RPC protocolï¼Œç”¨æ€§æé«˜ã€‚

é™¤äº†ä½¿ç”¨ LSP æœ¬åœ°ä»£ç æç¤ºæœåŠ¡ï¼Œå¦å¤–è¿˜æœ‰ Language Server Index Format (LSIF) è¯­è¨€æœåŠ¡å™¨ç´¢å¼•ï¼Œ
è¿™ç§æ•°æ®æ ¼å¼çš„ç›®æ ‡æ˜¯æ”¯æŒå¼€å‘å·¥å…·æˆ– Web UI ä¸­çš„ä¸°å¯Œä»£ç å¯¼èˆªï¼Œè€Œä¸éœ€è¦æºä»£ç çš„æœ¬åœ°å‰¯æœ¬ã€‚è¯¥æ ¼å¼åœ¨æœ¬è´¨ä¸Š
ç±»ä¼¼äºè¯­è¨€æœåŠ¡å™¨åè®®(LSP)ï¼Œå®ƒç®€åŒ–äº†å°†ä¸°å¯Œçš„ä»£ç ç¼–è¾‘åŠŸèƒ½é›†æˆåˆ°å¼€å‘å·¥å…·ä¸­çš„è¿‡ç¨‹ã€‚

LSP æä¾›äº†ä¸°å¯Œçš„ä»£ç åˆ›ä½œåŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨å®Œæˆã€ç±»å‹æ ¼å¼åŒ–å’Œä¸°å¯Œçš„ä»£ç å¯¼èˆªã€‚ä¸ºäº†æœ‰æ•ˆåœ°æä¾›è¿™äº›åŠŸèƒ½ï¼Œè¯­è¨€
æœåŠ¡å™¨è¦æ±‚æ‰€æœ‰æºä»£ç æ–‡ä»¶éƒ½åœ¨æœ¬åœ°ç£ç›˜ä¸Šå¯ç”¨ã€‚LSP è¯­è¨€æœåŠ¡å™¨è¿˜å¯ä»¥å°†éƒ¨åˆ†æˆ–å…¨éƒ¨æ–‡ä»¶è¯»å…¥å†…å­˜å¹¶è®¡ç®—æŠ½è±¡
è¯­æ³•æ ‘ä»¥æ”¯æŒè¿™äº›åŠŸèƒ½ã€‚LSIF çš„ç›®æ ‡æ˜¯å¢å¼º LSP åè®®ä»¥æ”¯æŒæ²¡æœ‰è¿™äº›è¦æ±‚çš„ä¸°å¯Œä»£ç å¯¼èˆªåŠŸèƒ½ã€‚LSIF ä¸ºè¯­è¨€
æœåŠ¡å™¨æˆ–å…¶ä»–ç¼–ç¨‹å·¥å…·å®šä¹‰äº†ä¸€ç§æ ‡å‡†æ ¼å¼ï¼Œä»¥å‘å¸ƒä»–ä»¬å…³äºä»£ç å·¥ä½œç©ºé—´çš„çŸ¥è¯†ã€‚æ­¤æŒä¹…åŒ–ä¿¡æ¯ç¨åå¯ç”¨äºå“åº”
å¯¹åŒä¸€å·¥ä½œåŒºçš„ LSP è¯·æ±‚ï¼Œè€Œæ— éœ€è¿è¡Œè¯­è¨€æœåŠ¡å™¨ã€‚

å½“å‰ LSIF è§„èŒƒç‰ˆæœ¬è¿˜æ”¯æŒï¼š

   1. Document symbols
   2. document links
   3. Go to Definition
   4. Go to Declaration
   5. Go to Type Definition
   6. Find All References
   7. Go to Implementation

LSP Specification 3.16 Major new feature are:

   1. Semantic Token support
   2. Call Hierarchy support
   3. Linked Editing support
   4. Moniker support
   5. Events for file operations (create, rename, delete)
   6. Change annotation support for text edits and file operations (create, rename, delete)


LSP 2.x Messages overview æ³¨æ„ç®­å¤´è¡¨ç¤ºæ¶ˆæ¯æµå‘ï¼Œå³ä¾§ä¸º Client â¡ï¸ Serverï¼Œå¸¦å›é’©è¡¨ç¤ºæœ‰å›å¤ï¼š

| Document                          | General                               |
| â¬…ï¸ textDocument/publishDiagnostics | ------------------------------------- |
| â¡ï¸ textDocument/didChange          | â†©ï¸ initialize                         |
| â¡ï¸ textDocument/didClose           | â†©ï¸ shutdown                           |
| â¡ï¸ textDocument/didOpen            | â¡ï¸ exit                               |
| â¡ï¸ textDocument/didSave            | â¡ï¸ $/cancelRequest                    |
| â†©ï¸ textDocument/completion         | ------------------------------------- |
| â†©ï¸ completionItem/resolve          | Window                                |
| â†©ï¸ textDocument/hover              | ------------------------------------- |
| â†©ï¸ textDocument/signatureHelp      | â¬…ï¸ window/showMessage                 |
| â†©ï¸ textDocument/references         | â†ªï¸ window/showMessageRequest          |
| â†©ï¸ textDocument/documentHighlight  | â¬…ï¸ window/logMessage                  |
| â†©ï¸ textDocument/documentSymbol     | â¬…ï¸ telemetry/event                    |
| â†©ï¸ textDocument/formatting         | ------------------------------------- |
| â†©ï¸ textDocument/rangeFormatting    | Workspace                             |
| â†©ï¸ textDocument/onTypeFormatting   | ------------------------------------- |
| â†©ï¸ textDocument/definition         | â¡ï¸ workspace/didChangeConfiguration   |
| â†©ï¸ textDocument/codeAction         | â¡ï¸ workspace/didChangeWatchedFiles    |
| â†©ï¸ textDocument/codeLens           | â†©ï¸ workspace/symbol                   |
| â†©ï¸ codeLens/resolve                |                                       |
| â†©ï¸ textDocument/documentLink       |                                       |
| â†©ï¸ documentLink/resolve            |                                       |
| â†©ï¸ textDocument/rename             |                                       |

åœ¨ VSCode æˆ– Sublime Text ä½¿ç”¨ LSP æ’ä»¶ã€‚å®‰è£…æ’ä»¶åï¼Œä½¿ç”¨ LSP: Troubleshoot Server
æ¥æ£€æµ‹ clangd ç­‰è¯­è¨€æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œå³å®‰è£…äº† Clangd å¹¶å¯ä»¥åœ¨è·¯å¾„ç¯å¢ƒå˜é‡ä¸­æœç´¢åˆ°å®ƒã€‚


Godot ä¹Ÿå®ç°äº† LSP Client æœåŠ¡ï¼Œæ–°æ—§ç‰ˆæœ¬é»˜è®¤æœåŠ¡ç«¯å£åˆ†åˆ«æ˜¯ 6005 å’Œ 6008ã€‚è¿™äº›é…ç½®éƒ½å¯ä»¥é€šè¿‡
EditorSettings è¿›è¡Œè®¾ç½®ï¼š

```C++,ignore
// Godot 3.5
GDScriptLanguageServer::GDScriptLanguageServer() {
    thread_running = false;
    started = false;
    use_thread = false;
    host = "127.0.0.1";
    port = 6008;

    _EDITOR_DEF("network/language_server/remote_host", host);
    _EDITOR_DEF("network/language_server/remote_port", port);
    _EDITOR_DEF("network/language_server/enable_smart_resolve", true);
    _EDITOR_DEF("network/language_server/show_native_symbols_in_editor", false);
    _EDITOR_DEF("network/language_server/use_thread", use_thread);
}

// Godot 4.x
class GDScriptLanguageServer : public EditorPlugin {
    GDCLASS(GDScriptLanguageServer, EditorPlugin);

    GDScriptLanguageProtocol protocol;

    Thread thread;
    bool thread_running = false;
    bool started = false;
    bool use_thread = false;
    String host = "127.0.0.1";
    int port = 6005;
    static void thread_main(void *p_userdata);

private:
    void _notification(int p_what);

public:
    GDScriptLanguageServer();
    void start();
    void stop();
};

void GDScriptLanguageServer::start() {
    host = String(_EDITOR_GET("network/language_server/remote_host"));
    port = (int)_EDITOR_GET("network/language_server/remote_port");
    use_thread = (bool)_EDITOR_GET("network/language_server/use_thread");
    if (protocol.start(port, IPAddress(host)) == OK) {
        EditorNode::get_log()->add_message("--- GDScript language server started ---", EditorLog::MSG_TYPE_EDITOR);
        if (use_thread) {
            thread_running = true;
            thread.start(GDScriptLanguageServer::thread_main, this);
        }
        set_process_internal(!use_thread);
        started = true;
    }
}

void GDScriptLanguageServer::stop() {
    if (use_thread) {
        ERR_FAIL_COND(!thread.is_started());
        thread_running = false;
        thread.wait_to_finish();
    }
    protocol.stop();
    started = false;
    EditorNode::get_log()->add_message("--- GDScript language server stopped ---", EditorLog::MSG_TYPE_EDITOR);
}

// godot\modules\gdscript\register_types.cpp     
static void _editor_init() {
    Ref<EditorExportGDScript> gd_export;
    gd_export.instantiate();
    EditorExport::get_singleton()->add_export_plugin(gd_export);

#ifdef TOOLS_ENABLED
    Ref<GDScriptSyntaxHighlighter> gdscript_syntax_highlighter;
    gdscript_syntax_highlighter.instantiate();
    ScriptEditor::get_singleton()->register_syntax_highlighter(gdscript_syntax_highlighter);
#endif

#ifndef GDSCRIPT_NO_LSP
    register_lsp_types();
    GDScriptLanguageServer *lsp_plugin = memnew(GDScriptLanguageServer);
    EditorNode::get_singleton()->add_editor_plugin(lsp_plugin);
    Engine::get_singleton()->add_singleton(Engine::Singleton("GDScriptLanguageProtocol", GDScriptLanguageProtocol::get_singleton()));
#endif // !GDSCRIPT_NO_LSP
}
```

é…ç½® Sublime Text ä»¥è¿è¡Œ GDScript è„šæœ¬ï¼š

- å…ˆåˆ›å»ºæ„å»ºé…ç½®ï¼Œæ‰§è¡Œèœå•ï¼š Tools -> Build System -> New Build System ...
- å°†ä»¥ä¸‹ JSON é…ç½®ç²˜è´´åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œå¹¶ä¿å­˜åˆ° Packages\User\Godot.sublime-build æ–‡ä»¶
- ç„¶åæ‰“å¼€ GDScript è„šæœ¬ï¼ŒæŒ‰ Ctrl+B æ‰§è¡Œæ„å»ºå‘½ä»¤

```json
{
    "shell_cmd":"%Godot% --help",
    "file_regex": "^(.*.gd):(\\d+):(\\d+):",
    "selector": "text.plain, source.gd, source.gdscript",
    "encoding": "gbk",
    "quiet": true,
    "working_dir": "${file_path:${project_path}}",
    "env": {
        "PATH":"c:/download/games",
        "Godot":"Godot_v3.5.1-stable_win64.exe",
        "Godot4":"Godot_v4.0-beta16_win64.exe",
    },
    "variants":
    [
        {"name": "3.5 Help",            "shell_cmd": "%Godot% --help", },
        {"name": "3.5 Check GDScript",  "shell_cmd": "%Godot% --no-window --check-only -s \"${file}\"", },
        {"name": "3.5 Run GDScript",    "shell_cmd": "%Godot% --no-window -s \"${file}\"", },
        {"name": "3.5 Run GDScript[GUI]", "shell_cmd": "%Godot% -s \"${file}\"", },
        {"name": "3.5 Run Scene",       "shell_cmd": "%Godot% -e \"${file}\"", },
        {"name": "3.5 Run Project",     "shell_cmd": "%Godot% --path \"${file_path}\"", },
        {"name": "4.x Help",            "shell_cmd": "%Godot4% --help", },
        {"name": "4.x Check GDScript",  "shell_cmd": "%Godot4% --headless --check-only -s \"${file}\"", },
        {"name": "4.x Run GDScript",    "shell_cmd": "%Godot4% --headless -s \"${file}\"", },
        {"name": "4.x Run GDScript[GUI]", "shell_cmd": "%Godot4% -s \"${file}\"", },
        {"name": "4.x Run Scene",       "shell_cmd": "%Godot4% \"${file}\"", },
        {"name": "4.x Run Project",     "shell_cmd": "%Godot4% --path \"${file_path}\"", },
    ]
}
```

æ¨èå®‰è£…ä»¥ä¸‹æ’ä»¶ï¼Œä»¥æä¾›è¯­æ³•é«˜äº®å’Œè‡ªåŠ¨å®ŒæˆåŠŸèƒ½ï¼š

- GDScript support for Sublime Text
- LSP - Language Server Protocol for Sublime Text

å®‰è£…å¥½æ’ä»¶åï¼Œéœ€è¦é…ç½® LSPï¼Œå°†ä»¥ä¸‹é…ç½®å†™å…¥ Preferences > Package Settings > LSP > Settingsï¼Œ
æ·»åŠ  "godot-lsp" å®¢æˆ·æœåŠ¡åå°±å¯ä»¥é€šè¿‡ LSP æä¾›è‡ªåŠ¨å®Œæˆï¼Œä»¥åŠä¸Šä¸‹æ–‡æç¤ºï¼š

```json
{
    "clients": {
        "godot-lsp": {
            "enabled": true,
            "command": [
                "/PATH/TO/godot-editor.exe", // Update the PATH
                "--headless",  // No rendering, No Window 
                "--script", "path/to/some/scenetree.gd"
            ],
            "tcp_port": 6008, // Godot 4.x 6008, Godot 3.x 6005
            "selector": "source.gdscript",
        }
    }
}
```

å¯åŠ¨ Godot ç¼–è¾‘å™¨åï¼Œé»˜è®¤å°±ä¼šå¯ç”¨ LSP Clientï¼Œåœ¨ç¼–è¾‘å™¨è®¾ç½®ä¸­å¯ä»¥ä¿®æ”¹é»˜è®¤é…ç½®ã€‚Sublime Text çš„
å¿«æ·å‘½ä»¤é¢æ¿ä¸­ï¼ŒCtrl-Shift-Pï¼Œæ‰§è¡Œ LSP: Troubleshoot Server å¯ä»¥å¯¹è¯­è¨€æœåŠ¡è¿›è¡Œæ£€æµ‹ã€‚å¦‚æœé…ç½®
çš„ç«¯å£ä¸ä¸€è‡´ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡è¿æ¥ä¸ä¸Šï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨å¯¹åº” Godot ç‰ˆæœ¬çš„ç«¯å£ï¼Œé‚£ä¹ˆæä¾›çš„æç¤ºä¿¡æ¯å°±å¯èƒ½ä¸
æ˜¯æœ€å‡†ç¡®çš„ã€‚æ¯”å¦‚ï¼Œæ—§ç‰ˆ ClassDB.instance() å’Œæ–°ç‰ˆæœ¬çš„ instantiate() æ˜¯ç”¨äºæ‰§è¡Œç±»å‹å®ä¾‹çš„å‡½æ•°ï¼Œ
å¯èƒ½å› ä¸ºä½¿ç”¨çš„ Godot LSP Client ç‰ˆæœ¬ä¸åŒè€Œå‡ºç°ä¸åŒçš„æç¤ºä¿¡æ¯ã€‚

Sublime Text ä¸­ï¼Œå¯ç”¨ Godot LSP æœåŠ¡æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰“å¼€é…ç½®ä¸­ Godot ç¼–è¾‘å™¨ä»¥è¿è¡Œ LSP Clientã€‚
å¦‚æœï¼Œå·²ç»è¿è¡Œå…¶å®ƒåŒç‰ˆæœ¬çš„ Godot ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆ LSP Client å°±å¯èƒ½å·²ç»åœ¨è¿è¡Œäº†ï¼Œè‡ªåŠ¨æ‰“å¼€çš„å¯ä»¥å…³é—­ã€‚
Godot åœ¨é¡¹ç›®ç®¡ç†åˆ—è¡¨ç•Œé¢ä¸‹ï¼ŒLSP Client æ˜¯å…³é—­çš„ã€‚

ä¸ºäº†è§£å†³ Sublime Text ä¸­ LSP æ’ä»¶é»˜è®¤æ€»æ˜¯è‡ªåŠ¨è¿è¡Œ Godot é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ --headless å‚æ•°å¯åŠ¨
Godotï¼Œå¹¶ä¸”ä½¿ç”¨ --script æŒ‡å®šä¸€ä¸ªè„šæœ¬è®© Godot è‡ªåŠ¨ç»“æŸç¨‹åºï¼Œè„šæœ¬ä¸­åªéœ€è¦æ‰§è¡Œ quit() æ–¹æ³•ï¼Œ
æˆ–è€…ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ª process å›è°ƒæ–¹æ³•ä¸­è¿”å› trueï¼Œå³å¯ä»¥ç»“æŸ Godotï¼š

<!-- c:\\download\\games\\Godot_v4.0-beta16_win64.exe --headless --script "C:\\download\\games\\scenetree.gd" -->

```py
#!/usr/bin/env -S godot -s
class_name MyScene
extends SceneTree

func _init():
    print_debug("step 1: _init")
    quit() # exit command: godot --headless --script scenetree.gd

func _iteration(delta):
    assert(Engine.get_version_info().major == 3)
    print_debug("step 3: _iteration (Node._physics_process)")

func _idle(delta):
    assert(Engine.get_version_info().major == 3)
    print_debug("step 3: _idle (Node._process)")

func _physics_process(delta):
    assert(Engine.get_version_info().major == 4)
    root.title = "MyScene 4.x" # root is Window in Godot 4
    #root.set("theme_override_colors/title_color", Color.YELLOW)
    print_debug("step 3: _physics_process")

func _process(delta):
    assert(Engine.get_version_info().major == 4)
    print_debug("step 4: _process")

func _initialize():
    print_debug("step 2: _initialize")

func _finalize():
    print_debug("step 5: _finalize")
```

åœ¨åŒæ˜¾å¡ç³»ç»Ÿï¼Œä½¿ç”¨ --gpu-index å¯ä»¥æŒ‡å®šæ˜¾å¡ï¼Œ--verbose å¯ä»¥æ‰“å°è¯¦ç»†ä¿¡æ¯ï¼ŒGodot è¿è¡Œé¡¹ç›®æ—¶å°±
ä¼šæ‰“å°å‡ºå½“å‰ç³»ç»Ÿä¸­çš„æ˜¾å¡ä¿¡æ¯ï¼ŒVulkan é©±åŠ¨é»˜è®¤é€‰æ‹©ç‹¬ç«‹æ˜¾å¡ï¼š

    Vulkan devices:
      #0: NVIDIA NVIDIA GeForce GTX 1050 - Supported, Discrete
      #1: Intel Intel(R) UHD Graphics 620 - Supported, Integrated
    Vulkan API 1.3.224 - Using Vulkan Device #0: NVIDIA - NVIDIA GeForce GTX 1050

å®‰è£… Vulkan SDKï¼Œä½¿ç”¨ Vulkan Configurator (vkconfig) å¯ä»¥å¯¹ç¨‹åºçš„ Vulkan ç¯å¢ƒé…ç½®è¿›è¡Œä¿®æ”¹ã€‚


ä»¥ä¸‹ï¼Œæ–°å»ºæµ‹è¯•è„šæœ¬ sayhello.gd ä»¥æ¼”ç¤ºé€šè¿‡ Godot å‘½ä»¤è¿è¡Œè„šæœ¬ï¼Œæ–¹ä¾¿ç¼–è¾‘ä»£ç å’Œåšæµ‹è¯•ã€‚

æ³¨æ„ï¼Œè„šæœ¬å¿…é¡»ç»§æ‰¿ **SceneTree** æˆ– **MainLoop** ç±»å‹ï¼Œè¿™æ˜¯ Godot æ¸¸æˆçš„å…¥å£ç±»å‹ã€‚åœºæ™¯æ ‘ç±»å‹
æ²¡æœ‰ Node ç±»å‹ä¸­çš„ ready ä¹‹ç±»çš„å›è°ƒï¼Œä½¿ç”¨çš„æ˜¯å¦ä¸€å¥—å›è°ƒã€‚å¦‚æœä»£ç æœ‰è¯­æ³•é”™è¯¯ï¼ŒGodot è¿è¡Œå¯èƒ½ä¸ä¼š
ç»™å‡ºä¿¡æ¯æç¤ºï¼Œè€Œæ˜¯ç›´æ¥é€€å‡ºã€‚æ¯”å¦‚ï¼Œæ··ç”¨ TAB å’Œç©ºæ ¼ä½œä¸ºç¼©è¿›ï¼Œåˆå¦‚åœ†æ‹¬å·ä¸åŒ¹é…ï¼š

```py
#!/usr/bin/env -S godot -s
extends SceneTree

func _init():
    var a = Vector2 (-10, -10) 
    var b = Vector2 (1, 1)
    var format = "Normalized vector %s is %s, angle between %s and %s is %d degree"
    print(format % [a, a.normalized(), a, b, (a - b).angle()*180/PI])
    quit()


func _ready():
    quit() # why not? SceneTree no _ready() life cycle funtion
```

MainLoop å®ç°éœ€è¦æä¾›ç»™ OS è°ƒç”¨ï¼Œé”™è¯¯å°±ä¼šå¯¼è‡´ Godot ç»ˆæ­¢æ‰§è¡Œå¹¶é€€å‡ºï¼Œä»¥ä¸‹æ˜¯ç±»å‹ç»“æ„å‚è€ƒï¼š

```py
class_name CustomMainLoop
extends MainLoop

var time_elapsed = 0

func _initialize():
    print("Initialized:")
    print("  Starting time: %s" % str(time_elapsed))

func _process(delta):
    time_elapsed += delta
    # Return true to end the main loop.
    return Input.get_mouse_button_mask() != 0 || Input.is_key_pressed(KEY_ESCAPE)

func _finalize():
    print("Finalized:")
    print("  End time: %s" % str(time_elapsed))
```


    Godot Engine v3.5.1.stable.official.6fed1ffa3 - https://godotengine.org
    Free and open source software under the terms of the MIT license.
    (c) 2007-2022 Juan Linietsky, Ariel Manzur.
    (c) 2014-2022 Godot Engine contributors.

    Usage: Godot_v3.5.1-stable_win64.exe [options] [path to scene or 'project.godot' file]

    General options:
      -h, --help                       Display this help message.
      --version                        Display the version string.
      -v, --verbose                    Use verbose stdout mode.
      --quiet                          Quiet mode, silences stdout messages. Errors are still displayed.

    Run options:
      -e, --editor                     Start the editor instead of running the scene.
      -p, --project-manager            Start the project manager, even if a project is auto-detected.
      --debug-server <address>         Start the editor debug server (<IP>:<port>, e.g. 127.0.0.1:6007)
      -q, --quit                       Quit after the first iteration.
      -l, --language <locale>          Use a specific locale (<locale> being a two-letter code).
      --path <directory>               Path to a project (<directory> must contain a 'project.godot' file).
      -u, --upwards                    Scan folders upwards for project.godot file.
      --main-pack <file>               Path to a pack (.pck) file to load.
      --render-thread <mode>           Render thread mode ('unsafe', 'safe', 'separate').
      --remote-fs <address>            Remote filesystem (<host/IP>[:<port>] address).
      --remote-fs-password <password>  Password for remote filesystem.
      --audio-driver <driver>          Audio driver ('WASAPI', 'Dummy').
      --video-driver <driver>          Video driver ('GLES3', 'GLES2').

    Display options:
      -f, --fullscreen                 Request fullscreen mode.
      -m, --maximized                  Request a maximized window.
      -w, --windowed                   Request windowed mode.
      -t, --always-on-top              Request an always-on-top window.
      --resolution <W>x<H>             Request window resolution.
      --position <X>,<Y>               Request window position.
      --low-dpi                        Force low-DPI mode (macOS and Windows only).
      --no-window                      Run with invisible window. Useful together with --script.
      --enable-vsync-via-compositor    When vsync is enabled, vsync via the OS' window compositor (Windows only).
      --disable-vsync-via-compositor   Disable vsync via the OS' window compositor (Windows only).
      --enable-delta-smoothing         When vsync is enabled, enabled frame delta smoothing.
      --disable-delta-smoothing        Disable frame delta smoothing.
      --tablet-driver                  Tablet input driver ('wintab', 'winink') (Windows only).

    Debug options:
      -d, --debug                      Debug (local stdout debugger).
      -b, --breakpoints                Breakpoint list as source::line comma-separated pairs, no spaces (use %20 instead).
      --profiling                      Enable profiling in the script debugger.
      --remote-debug <address>         Remote debug (<host/IP>:<port> address).
      --debug-collisions               Show collision shapes when running the scene.
      --debug-navigation               Show navigation polygons when running the scene.
      --debug-shader-fallbacks         Use the fallbacks of the shaders which have one when running the scene (GL ES 3 only).
      --frame-delay <ms>               Simulate high CPU load (delay each frame by <ms> milliseconds).
      --time-scale <scale>             Force time scale (higher values are faster, 1.0 is normal speed).
      --disable-render-loop            Disable render loop so rendering only occurs when called explicitly from script.
      --disable-crash-handler          Disable crash handler when supported by the platform code.
      --fixed-fps <fps>                Force a fixed number of frames per second. This setting disables real-time synchronization.
      --print-fps                      Print the frames per second to the stdout.

    Standalone tools:
      -s, --script <script>            Run a script.
      --check-only                     Only parse for errors and quit (use with --script).
      --export <preset> <path>         Export the project using the given preset and matching release template. The preset name should match one defined in export_presets.cfg.
                                       <path> should be absolute or relative to the project directory, and include the filename for the binary (e.g. 'builds/game.exe'). The target directory should exist.
      --export-debug <preset> <path>   Same as --export, but using the debug template.
      --export-pack <preset> <path>    Same as --export, but only export the game pack for the given preset. The <path> extension determines whether it will be in PCK or ZIP format.
      --doctool [<path>]               Dump the engine API reference to the given <path> (defaults to current dir) in XML format, merging if existing files are found.
      --no-docbase                     Disallow dumping the base types (used with --doctool).
      --build-solutions                Build the scripting solutions (e.g. for C# projects). Implies --editor and requires a valid project to edit.
      --gdnative-generate-json-api     Generate JSON dump of the Godot API for GDNative bindings.
      --test <test>                    Run a unit test ('string', 'math', 'basis', 'transform', 'physics', 'physics_2d', 'render', 'oa_hash_map', 'gui', 'shaderlang', 'gd_tokenizer', 'gd_parser', 'gd_compiler', 'gd_bytecode', 'ordered_hash_map', 'astar', 'xml_parser', 'theme').


    Godot Engine v4.0.beta16.mono.official.518b9e580 - https://godotengine.org
    Free and open source software under the terms of the MIT license.
    (c) 2014-present Godot Engine contributors.
    (c) 2007-2014 Juan Linietsky, Ariel Manzur.

    Usage: Godot_v4.0-beta16_mono_win64.exe [options] [path to scene or 'project.godot' file]

    General options:
      -h, --help                        Display this help message.
      --version                         Display the version string.
      -v, --verbose                     Use verbose stdout mode.
      -q, --quiet                       Quiet mode, silences stdout messages. Errors are still displayed.

    Run options:
      --, ++                            Separator for user-provided arguments. Following arguments are not used by the engine, but can be read from `OS.get_cmdline_user_args()`.
      -e, --editor                      Start the editor instead of running the scene.
      -p, --project-manager             Start the project manager, even if a project is auto-detected.
      --debug-server <uri>              Start the editor debug server (<protocol>://<host/IP>[:<port>], e.g. tcp://127.0.0.1:6007)
      --quit                            Quit after the first iteration.
      -l, --language <locale>           Use a specific locale (<locale> being a two-letter code).
      --path <directory>                Path to a project (<directory> must contain a 'project.godot' file).
      -u, --upwards                     Scan folders upwards for project.godot file.
      --main-pack <file>                Path to a pack (.pck) file to load.
      --render-thread <mode>            Render thread mode ['unsafe', 'safe', 'separate'].
      --remote-fs <address>             Remote filesystem (<host/IP>[:<port>] address).
      --remote-fs-password <password>   Password for remote filesystem.
      --audio-driver <driver>           Audio driver ['WASAPI', 'Dummy'].
      --display-driver <driver>         Display driver (and rendering driver) ['windows' ('vulkan', 'opengl3'), 'headless' ('dummy')].
      --rendering-method <renderer>     Renderer name. Requires driver support.
      --rendering-driver <driver>       Rendering driver (depends on display driver).
      --gpu-index <device_index>        Use a specific GPU (run with --verbose to get available device list).
      --text-driver <driver>            Text driver (Fonts, BiDi, shaping).
      --tablet-driver <driver>          Pen tablet input driver.
      --headless                        Enable headless mode (--display-driver headless --audio-driver Dummy). Useful for servers and with --script.
      --write-movie <file>              Writes a video to the specified path (usually with .avi or .png extension).
                                        --fixed-fps is forced when enabled, but it can be used to change movie FPS.
                                        --disable-vsync can speed up movie writing but makes interaction more difficult.

    Display options:
      -f, --fullscreen                  Request fullscreen mode.
      -m, --maximized                   Request a maximized window.
      -w, --windowed                    Request windowed mode.
      -t, --always-on-top               Request an always-on-top window.
      --resolution <W>x<H>              Request window resolution.
      --position <X>,<Y>                Request window position (if set, screen argument is ignored).
      --screen <N>                      Request window screen.
      --single-window                   Use a single window (no separate subwindows).
      --xr-mode <mode>                  Select XR (Extended Reality) mode ['default', 'off', 'on'].

    Debug options:
      -d, --debug                       Debug (local stdout debugger).
      -b, --breakpoints                 Breakpoint list as source::line comma-separated pairs, no spaces (use %20 instead).
      --profiling                       Enable profiling in the script debugger.
      --gpu-profile                     Show a GPU profile of the tasks that took the most time during frame rendering.
      --gpu-validation                  Enable graphics API validation layers for debugging.
      --gpu-abort                       Abort on graphics API usage errors (usually validation layer errors). May help see the problem if your system freezes.
      --remote-debug <uri>              Remote debug (<protocol>://<host/IP>[:<port>], e.g. tcp://127.0.0.1:6007).
      --debug-collisions                Show collision shapes when running the scene.
      --debug-paths                     Show path lines when running the scene.
      --debug-navigation                Show navigation polygons when running the scene.
      --debug-stringnames               Print all StringName allocations to stdout when the engine quits.
      --frame-delay <ms>                Simulate high CPU load (delay each frame by <ms> milliseconds).
      --time-scale <scale>              Force time scale (higher values are faster, 1.0 is normal speed).
      --disable-vsync                   Forces disabling of vertical synchronization, even if enabled in the project settings. Does not override driver-level V-Sync enforcement.
      --disable-render-loop             Disable render loop so rendering only occurs when called explicitly from script.
      --disable-crash-handler           Disable crash handler when supported by the platform code.
      --fixed-fps <fps>                 Force a fixed number of frames per second. This setting disables real-time synchronization.
      --print-fps                       Print the frames per second to the stdout.

    Standalone tools:
      -s, --script <script>             Run a script.
      --check-only                      Only parse for errors and quit (use with --script).
      --export-release <preset> <path>  Export the project in release mode using the given preset and output path. The preset name should match one defined in export_presets.cfg.
                                        <path> should be absolute or relative to the project directory, and include the filename for the binary (e.g. 'builds/game.exe').
                                        The target directory must exist.
      --export-debug <preset> <path>    Export the project in debug mode using the given preset and output path. See --export-release description for other considerations.
      --export-pack <preset> <path>     Export the project data only using the given preset and output path. The <path> extension determines whether it will be in PCK or ZIP format.
      --convert-3to4 [<max_file_kb>] [<max_line_size>]
                                        Converts project from Godot 3.x to Godot 4.x.
      --validate-conversion-3to4 [<max_file_kb>] [<max_line_size>]
                                        Shows what elements will be renamed when converting project from Godot 3.x to Godot 4.x.
      --doctool [<path>]                Dump the engine API reference to the given <path> (defaults to current dir) in XML format, merging if existing files are found.
      --no-docbase                      Disallow dumping the base types (used with --doctool).
      --build-solutions                 Build the scripting solutions (e.g. for C# projects). Implies --editor and requires a valid project to edit.
      --dump-gdextension-interface      Generate GDExtension header file 'gdextension_interface.h' in the current folder. This file is the base file required to implement a GDExtension.
      --dump-extension-api              Generate JSON dump of the Godot API for GDExtension bindings named 'extension_api.json' in the current folder.
      --startup-benchmark               Benchmark the startup time and print it to console.
      --startup-benchmark-file <path>   Benchmark the startup time and save it to a given file in JSON format.




## ğŸŸ¡ TSCN & TRES èµ„æºæ–‡ä»¶æ ¼å¼
- https://docs.godotengine.org/en/stable/development/file_formats/tscn.html
- https://github.com/godotengine/godot/blob/master/scene/resources/resource_format_text.cpp
- https://github.com/godotengine/godot/blob/master/core/variant_parser.cpp
- godot-docs\development\file_formats\tscn.rst
- godot\scene\resources\resource_format_text.cpp
- godot\core\variant_parser.cpp

TSCN (text scene) å­—ç¬¦ä¸²æ ¼å¼åœºæ™¯æ–‡ä»¶ï¼ŒGodot åŠ è½½åä¼šç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜åœ¨ `.import/` æˆ– 
å·¥ä½œç›®å½•ï¼ŒGodot 4.x åˆ™ä¿å­˜åœ¨ `.godot/imported/`ã€‚

Godot åœ¨åº•å±‚å®šä¹‰äº†ä¸€ä¸ªä¸“ç”¨ç”¨äºæ–‡æœ¬æ–‡ä»¶æ ¼å¼çš„è§£æå™¨ï¼ŒVariantParserï¼Œé€šè¿‡ä¸ªå˜ä½“è§£æå™¨ï¼Œå¯ä»¥å°†å„ç§
Godot èµ„æºä¿å­˜åˆ°æ–‡æœ¬æ ¼å¼æ–‡ä»¶ä¸­ã€‚åœºæ™¯æ–‡ä»¶ TSCN å°±æ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œèµ„æºæ–‡ä»¶ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯ `Resource`
è¿™ç§èµ„æºç±»å‹ä¿å­˜çš„æ–‡ä»¶ï¼Œä¹ŸåŒæ ·ä½¿ç”¨æ–‡æœ¬æ ¼å¼ã€‚æ¯ä¸ªæ–‡æœ¬æ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ª File Descriptorï¼Œç”¨äºè¡¨ç¤ºå…¶
è®°å½•çš„ç±»å‹ã€‚

TSCN æ–‡ä»¶æœ‰ 5 ä¸ªåŒºæ®µï¼Œåˆ†åˆ«å¼€å¤´è¡¨ç¤ºæ³¨è§£ï¼š

0. File Descriptor    - ``[gd_scene]``
1. External resources - ``[ext_resource]``
2. Internal resources - ``[sub_resource]``
3. Nodes              - ``[node]``
4. Signal Connections - ``[connection]``

æ‰€æœ‰åŒºæ®µä¸­ä½¿ç”¨çš„å®ä½“ä½¿ç”¨æ–¹æ‹¬å·åŒ…æ‹¬ï¼Œå®ä½“å¯ä»¥æ·»åŠ ä»»æ„çš„ key="value" é”®å€¼å¯¹ï¼Œå®ä½“åå¯ä»¥ç´§è·Ÿå±æ€§è®¾ç½®ï¼Œ
ä½¿ç”¨ property=value è¿™æ ·çš„æ ¼å¼ä¹¦å†™ã€‚

Godot 4.x ä½¿ç”¨çš„æ ¼å¼ç‰ˆæœ¬ä¸º Version 3ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºèµ„æº IDã€UIDï¼Œä¸å‰ä¸€ä¸ªç‰ˆæœ¬ä¸å…¼å®¹ï¼š

- Version 2: changed names for Basis, AABB, Vectors, PoolVectors, etc.
- Version 3: new string ID for ext/subresources, and uid, breaks forward compat.

éœ€è¦å°† Godot 4.x å·¥ç¨‹é™çº§ä¸ºä½ç‰ˆæœ¬çš„ Godot 3.x å·¥ç¨‹ï¼Œåˆ™éœ€è¦è€ƒè™‘ç±»å‹åç§°å˜åŒ–ã€èµ„æºæ–‡ä»¶æ ¼å¼é—®é¢˜ï¼Œ
è¿˜æœ‰æ–°ç‰ˆæœ¬ä¸­ GDScript å…³é”®å­—ã€æ³¨è§£åŠŸèƒ½çš„å·®åˆ«ã€‚æ‰‹åŠ¨é™çº§ Godot å·¥ç¨‹çš„æ“ä½œæ­¥éª¤ï¼š

- ä¿®æ”¹ project.godot ä¸­çš„ç‰ˆæœ¬å·ï¼Œå°†æ–°ç‰ˆæœ¬ config_version=5ï¼Œæ—§ç‰ˆæœ¬ Godot 3.x ç‰ˆæœ¬ä¸º 4ï¼›
- ä¿®æ”¹åœºæ™¯æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·ï¼Œæ”¹ä¸º format=2ï¼›
- åˆ é™¤åœºæ™¯ä¸­çš„ uid å±æ€§ï¼Œå¹¶é‡æ–°è®¾ç½®å®ä½“çš„ id å±æ€§ï¼Œå»æ‰åŒå¼•å·åŠå­—ç¬¦ä¸²ï¼Œç›´æ¥ä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„æ•°å€¼ï¼›
- ç›¸åº”åœ°ä¿®æ”¹èµ„æºå¼•ç”¨ SubResource(id) æˆ– ExtResource(id)ï¼›
- æ ¹æ®èŠ‚ç‚¹åŠæ•°æ®ç±»å‹ä¿®æ”¹ type å±æ€§ï¼Œæ›´æ–°ç›¸åº”çš„åç§°ï¼Œä»¥åŠç»“æ„ï¼›
- æ›´æ–° GDScript è„šæœ¬ä¸­å…³é”®å­—ã€æ³¨è§£çš„ä½¿ç”¨ï¼ŒåŒæ—¶ä¿®æ”¹ç±»å‹åç§°ï¼›

ä¾‹å¦‚ï¼ŒGodot 4.x ä¸­çš„ RPC æ ‡æ³¨ä¸ Godt 3.5 ä¸­çš„å…³é”®å­—ç­‰ä»·å…³ç³»ï¼š

|      Godot 3.5 keywords     |                 Godot 4 @rpc annotations                |
|-----------------------------|---------------------------------------------------------|
| remote                      | "any_peer", "call_remote"                               |
| remotesync                  | "any_peer", "call_local"                                |
| master                      | "authority", "call_remote"                              |
| mastersync                  | "authority", "call_local"                               |
| rpc_unreliable()            | @rpc("unreliable")                                      |
| rpc_unreliable(master func) | @rpc or @rpc("authority", "call_remote", "reliable", 1) |


```py
    ; Godot 3.5
    [gd_scene load_steps=3 format=2]
    
    [ext_resource path="res://Sprite_2D.gd" type="Script" id=1]
    [ext_resource path="res://MyNode2D.cs" type="Script" id=2]
    [ext_resource path="res://icon.svg" type="Texture" id=3]

    [node name="Cube" type="Spatial" parent="."]
    transform=Transform( 1.0, 0.0, 0.0 ,0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0 )

    ; Godot 4.x
    [gd_scene load_steps=3 format=3 uid="uid://bxv0sdh81ec2f"]
    [ext_resource path="res://Sprite_2D.gd" type="Script" id="Script_xxx1"]
    [ext_resource path="res://MyNode2D.cs" type="Script" id="Script_xxx2"]
    [ext_resource path="res://icon.svg" type="Texture" id="Script_xxx3"]

    [node name="Cube" type="Node3D" parent="."]
    transform=Transform( 1.0, 0.0, 0.0 ,0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0 )
```

æ–‡ä»¶æè¿°ç¬¦å·æ˜¯åœºæ™¯æ–‡ä»¶çš„å¼€å¤´åŒºæ®µï¼Œå®šä¹‰åœºæ™¯æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å’ŒåŠ è½½æ­¥éª¤æ•°ï¼šå¤–éƒ¨èµ„æºæ•°é‡+åœºæ™¯æ–‡ä»¶æœ¬èº«ã€‚å³ä½¿
load_steps æ•°å€¼ä¸æ­£ç¡®ï¼Œå¼•æ“è¿˜æ˜¯ä¼šåŠ è½½åœºæ™¯æ–‡ä»¶ï¼Œä½†ä¼šå½±å“ä½¿ç”¨è¿™ä¸ªå€¼çš„ä»£ç ã€‚

é™¤äº†å¤–éƒ¨èµ„æºï¼Œåœºæ™¯æ–‡ä»¶è¿˜å¯ä»¥å†…åµŒèµ„æºï¼Œæ¯”å¦‚èŠ‚ç‚¹å†…åµŒçš„è„šæœ¬ï¼Œåˆ†åˆ«ä½¿ç”¨ `ExtResource` å’Œ `SubResource`
å¼•ç”¨ ID æŒ‡å®šçš„å¤–éƒ¨èµ„æºå’Œå†…åµŒèµ„æºã€‚å†…åµŒèµ„æºåŒ…æ‹¬ meshes, materials, GDScript ç­‰ç­‰æ•°æ®ã€‚

æ¯”å¦‚ä»¥ä¸‹åœºæ™¯æ–‡ä»¶ï¼Œæ ¹èŠ‚ç‚¹å¼•ç”¨äº†å†…åµŒè„šæœ¬èµ„æºï¼Œå†…åµŒèµ„æºä½¿ç”¨ [sub_resource] å®ä½“å®šä¹‰ï¼Œå¹¶é€šè¿‡èµ„æºå±æ€§
`script/source` æŒ‡å®šè„šæœ¬æºä»£ç ï¼Œä»£ç æŒ‰åŸæ ·ç›´æ¥ç´§æ¥èµ„æºå±æ€§çš„ = åé¢ï¼Œå¹¶ä½¿ç”¨åŒå¼•å·åŒ…æ‹¬ï¼Œæºä»£ç ä¸­
çš„åŒå¼•å·å’Œ \ ä¼šè¢«è½¬ä¹‰ä¸º \" å’Œ \\ï¼š

```py
    [gd_scene load_steps=2 format=2]

    [sub_resource type="GDScript" id=1]
    resource_name = "builtin-gdscript"
    script/source = "extends Spatial

    # Declare member variables here. Examples:
    # var b = \"text\\newline\"


    # Called when the node enters the scene tree for the first time.
    func _ready():
        pass # Replace with function body.
    "

    [node name="Spatial" type="Spatial"]
    script = SubResource( 1 )
```

èŠ‚ç‚¹å’Œå¤–éƒ¨èµ„æºæ˜¯åœºæ™¯æ ‘å±‚æ¬¡ç»“æ„ç»„ç»‡çš„åŸºæœ¬æ–¹å¼ï¼Œ[ext_resource] å®ä½“å®šä¹‰å¤–éƒ¨èµ„æºï¼Œ[node] å®šä¹‰èŠ‚ç‚¹ã€‚
åœºæ™¯æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªå®šä¹‰èŠ‚ç‚¹å³ä¸ºåœºæ™¯çš„æ ¹èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹é€šè¿‡ parent å±æ€§æŒ‡å®šçˆ¶çº§èŠ‚ç‚¹ã€‚

```py
    [node name="Player" type="Node3D"]             ; The scene root
    [node name="Arm" parent="." type="Node3D"]     ; Parented to the scene root
    [node name="Hand" parent="Arm" type="Node3D"]
    [node name="Finger" parent="Arm/Hand" type="Node3D"]
```

åœºæ™¯æ ‘ä¸­ä¸€äº›èŠ‚ç‚¹éœ€è¦å¼•ç”¨å…¶å®ƒèŠ‚ç‚¹ï¼Œåœºæ™¯æ–‡ä»¶ä¸­éœ€è¦ä½¿ç”¨``NodePath(Path/To/Node)``æ¥æŒ‡å®šèŠ‚ç‚¹è·¯å¾„ï¼Œ
æ¯”å¦‚ï¼ŒMeshInstance3D ä¸­çš„éª¨æ¶å±æ€§ï¼Œéœ€è¦ä½¿ç”¨``NodePath()``å¼•ç”¨æŒ‡å®šéª¨æ¶èŠ‚ç‚¹ã€‚åŠ¨ç”»èŠ‚ç‚¹ Animation
ä¹Ÿç±»ä¼¼åœ°ä½¿ç”¨``NodePath()``å¼•ç”¨æŒ‡å®šèŠ‚ç‚¹çš„å±æ€§ï¼š

```py
    [node name="mesh" type="MeshInstance3D" parent="Armature001"]
    mesh = SubResource(1)
    skeleton = NodePath("..:")


    [sub_resource id=3 type="Animation"]
    ...
    tracks/0/type = "transform"
    tracks/0/path = NodePath("Cube:")
    ...
```

èµ„æºç±»å‹ä½œä¸º Godot æœ€å¸¸ç”¨çš„ç±»å‹ä¹‹ä¸€ï¼Œå®ƒæœ¬èº«ä¹Ÿå¯ä»¥åƒåœºæ™¯ä¸€æ ·ï¼Œä½¿ç”¨ TSCN è¿™æ ·çš„é€šç”¨æ–‡æœ¬æ ¼å¼ä¿å­˜ï¼Œ
åªæ˜¯æ‰©å±•åä¸º .tresï¼Œä¸€ä¸ªæ–°åˆ›å»ºçš„èµ„æºç±»å‹ï¼Œå®ƒçš„æ–‡æœ¬æ ¼å¼å†…å®¹å¦‚ä¸‹ï¼Œåªæœ‰ä¸€ä¸ª File Descriptor å®ä½“ï¼Œ
å’Œä¸€ä¸ªç±»å‹å®ä½“ [resource]ã€‚æ–‡ä»¶æè¿°ç¬¦ç”¨äºæ ‡å¿—è¿™ä¸ªèµ„æºæ–‡ä»¶æ‰€å±çš„ç±»å‹ï¼Œè¿™é‡Œçš„ç±»å‹å°±æ˜¯ `Resource`ï¼Œ
è€Œèµ„æºç±»å‹å®ä½“ [resource] ç”¨äºå®šä¹‰èµ„æºç±»å‹çš„å±æ€§æ•°æ®ï¼Œè¿™é‡Œæ²¡æœ‰ä»»ä½•å±æ€§æ•°æ®ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„
èµ„æºå¯¹è±¡ï¼š

```py
[gd_resource type="Resource" format=2]

[resource]
```

é€šè¿‡ GDSCript æ‰©å±•èµ„æºç±»å‹åï¼Œå¯ä»¥ä½¿ç”¨èµ„æºæ‹¥æœ‰å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚ `MyResource`ï¼š

```py
    class_name MyResource
    extends Resource

    export var title = ""
    export var subtitle = ""
    export(NodePath) var visual = null
    export(String, FILE) var file_path = "user://local.file"
    export(String, MULTILINE) var text = ""

    # Called when the node enters the scene tree for the first time.
    func _ready():
        pass # Replace with function body.
```

èµ„æºç±»å‹çš„å±æ€§ä¹Ÿå¯ä»¥æ˜¯èµ„æºï¼Œä¹Ÿå¯ä½¿ç”¨ ExtResource æˆ– SubResource è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾—è‡ªå®šä¹‰èµ„æºç±»å‹
æ‹¥æœ‰å„ç§ç”¨é€”ï¼Œè®°å½•å„ç§æ•°æ®èµ„æºã€‚

åœ¨ Godot ç¼–è¾‘å™¨ä¸­åŒå‡»æ‰“å¼€èµ„æºæ–‡ä»¶ï¼Œåœ¨å±æ€§é¢æ¿ä¸­å¯ä»¥å°† MyResource é™„åŠ åˆ°èµ„æºæ–‡ä»¶çš„è„šæœ¬å±æ€§ï¼Œè¿™æ ·
è®¾ç½®åï¼Œèµ„æºæ–‡ä»¶ä¸­çš„å®šä¹‰çš„èµ„æºå°±æˆä¸º MyResource ç±»å‹ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è„šæœ¬ä¸­çš„å¯¼å‡ºå˜é‡è®¾ç½®æ›´å¤šçš„èµ„æº
å±æ€§æˆ–æ•°æ®ã€‚æ¯”å¦‚å°†ï¼ŒMyResource è„šæœ¬å†…å®¹ä½œä¸ºèµ„æºçš„ **text** å±æ€§è®°å½•åˆ°èµ„æºæ–‡ä»¶ï¼š

```py
[gd_resource type="Resource" load_steps=2 format=2]

[ext_resource path="res://course/MyResource.gd" type="Script" id=1]

[resource]
script = ExtResource( 1 )
title = "Demo Resource"
subtitle = ""
visual = NodePath("Robot")
file_path = "user://local.file"
text = "extends Resource

export var title = \"\"
export(String, MULTILINE) var text = \"\"

# Called when the node enters the scene tree for the first time.
func _ready():
    pass # Replace with function body.
"
```

æ³¨æ„ `script = ExtResource( 1 )` è¿™é‡Œï¼ŒMyResource è„šæœ¬å°†é™„åŠ åˆ°èµ„æºä¸Šï¼Œå¹¶ä½œä¸ºèµ„æºçš„æ‰©å±•ç±»å‹ã€‚
å°†è„šæœ¬é™„åŠ åˆ°ä¸€ç§ç±»å‹ä¸­ï¼Œå¹¶é€šè¿‡è„šæœ¬æ‰©å±•è¿™ç§ç±»å‹çš„è¿™ç§æœºåˆ¶æ˜¯ Godot é¡¶çº§çˆ¶ç±» Object æä¾›çš„èƒ½åŠ›ã€‚è¿™æ˜¯
ä¸é€šçŸ¥æœºåˆ¶ã€ä¿¡å·æœºåˆ¶ç­‰ç­‰ä¹‹å¤–çš„ï¼Œå¦ä¸€ç§æœ€åŸºç¡€çš„èƒ½åŠ›ã€‚


æç¤ºï¼šä¿®æ”¹è‡ªå®šä¹‰ç±»å‹åï¼Œå†ç¼–è¾‘èµ„æºæ–‡ä»¶æ—¶ï¼Œå¯èƒ½å‡ºç°èµ„æºå±æ€§ä¸èƒ½æ›´æ–°ä¸ºæœ€æ–°çŠ¶æ€ï¼Œè¿™æ—¶å¯ä»¥é‡æ–°åŠ è½½å·¥ç¨‹ã€‚


æ­¤å¤–ï¼Œåœºæ™¯æ–‡ä»¶ä¸­è¿˜æœ‰å…¶å®ƒè®¸å¤šä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼ŒåŠæ•°æ®æ ¼å¼ï¼Œå‚è€ƒ TSCN æ–‡ä»¶æ ¼å¼æ–‡æ¡£ã€‚

æºä»£ç ä¸­å®šä¹‰äº†æ–‡æœ¬èµ„æºåŠ è½½å™¨ï¼Œä½¿ç”¨ is_scene æŒ‡ç¤ºåŠ è½½çš„æ˜¯ TSCN åœºæ™¯èµ„æºæ–‡ä»¶ï¼Œå³ç­‰åŒ [gd_scene]ã€‚
ResourceLoaderText::open() è´Ÿè´£æ‰“å¼€æ–‡æœ¬èµ„æºæ–‡ä»¶ï¼Œå¹¶é€šè¿‡ VariantParser::parse_tag() è§£æ
èµ„æºæ–‡ä»¶ä¸­çš„å®ä½“å®šä¹‰ã€‚VariantParser::parse_value() ä¸­å®šä¹‰äº†æ”¯æŒä½¿ç”¨çš„æ•°æ®ç±»å‹ï¼š

- godot\scene\resources\resource_format_text.cpp
- godot\core\variant_parser.cpp

```py
    # Godot 3.5
    } else if (id == "Vector2") {
    } else if (id == "Rect2") {
    } else if (id == "Vector3") {
    } else if (id == "Transform2D" || id == "Matrix32") { //compatibility
    } else if (id == "Plane") {
    } else if (id == "Quat") {
    } else if (id == "AABB" || id == "Rect3") {
    } else if (id == "Basis" || id == "Matrix3") { //compatibility
    } else if (id == "Transform") {
    } else if (id == "Color") {
    } else if (id == "NodePath") {
    } else if (id == "RID") {
    } else if (id == "Object") {
    } else if (id == "Resource" || id == "SubResource" || id == "ExtResource") {
    } else if (id == "InputEvent") {
    } else if (id == "PoolByteArray" || id == "PackedByteArray" || id == "ByteArray") {
    } else if (id == "PoolIntArray" || id == "PackedInt32Array" || id == "PackedInt64Array" || id == "IntArray") {
    } else if (id == "PoolRealArray" || id == "PackedFloat32Array" || id == "PackedFloat64Array" || id == "FloatArray") {
    } else if (id == "PoolStringArray" || id == "PackedStringArray" || id == "StringArray") {
    } else if (id == "PoolVector2Array" || id == "PackedVector2Array" || id == "Vector2Array") {
    } else if (id == "PoolVector3Array" || id == "PackedVector3Array" || id == "Vector3Array") {        } else if (id == "PoolColorArray" || id == "PackedColorArray" || id == "ColorArray") {

    # Godot 4.x
    } else if (id == "Vector2i") {
    } else if (id == "Rect2") {
    } else if (id == "Rect2i") {
    } else if (id == "Vector3") {
    } else if (id == "Vector3i") {
    } else if (id == "Vector4") {
    } else if (id == "Vector4i") {
    } else if (id == "Transform2D" || id == "Matrix32") { //compatibility
    } else if (id == "Plane") {
    } else if (id == "Quaternion" || id == "Quat") { // "Quat" kept for compatibility
    } else if (id == "AABB" || id == "Rect3") {
    } else if (id == "Basis" || id == "Matrix3") { //compatibility
    } else if (id == "Transform3D" || id == "Transform") { // "Transform" kept for compatibility with Godot <4.
    } else if (id == "Projection") { // "Transform" kept for compatibility with Godot <4.
    } else if (id == "Color") {
    } else if (id == "NodePath") {
    } else if (id == "RID") {
    } else if (id == "Object") {
    } else if (id == "Resource" || id == "SubResource" || id == "ExtResource") {
    } else if (id == "Array") {
    } else if (id == "PackedByteArray" || id == "PoolByteArray" || id == "ByteArray") {
    } else if (id == "PackedInt32Array" || id == "PackedIntArray" || id == "PoolIntArray" || id == "IntArray") {
    } else if (id == "PackedInt64Array") {
    } else if (id == "PackedFloat32Array" || id == "PackedRealArray" || id == "PoolRealArray" || id == "FloatArray") {
    } else if (id == "PackedFloat64Array") {
    } else if (id == "PackedStringArray" || id == "PoolStringArray" || id == "StringArray") {
    } else if (id == "PackedVector2Array" || id == "PoolVector2Array" || id == "Vector2Array") {
    } else if (id == "PackedVector3Array" || id == "PoolVector3Array" || id == "Vector3Array") {
    } else if (id == "PackedColorArray" || id == "PoolColorArray" || id == "ColorArray") {
```


## ğŸŸ¡ Debug & Profiler è°ƒè¯•ä¸æ€§èƒ½åˆ†æã€ä¼˜åŒ–
- [The Profiler](https://docs.godotengine.org/en/latest/tutorials/scripting/debug/the_profiler.html)
- [Optimization](https://docs.godotengine.org/en/stable/tutorials/performance/index.html)
- [Debugging and profiling](https://docs.godotengine.org/en/latest/contributing/development/debugging/index.html)
- [Using C++ profilers](https://docs.godotengine.org/en/stable/development/cpp/using_cpp_profilers.html)
- [GDQuest Optimization 3D](https://www.gdquest.com/tutorial/godot/3d/optimization-3d/)
- [GDQuest Optimization Code](https://www.gdquest.com/tutorial/godot/gdscript/optimization-code/)
- [Optimizing for size](https://docs.godotengine.org/en/stable/development/compiling/optimizing_for_size.html)
- https://github.com/VerySleepy/verysleepy/wiki/User-Interface
- godot-docs\tutorials\scripting\debug\overview_of_debugging_tools.rst
- godot-docs\tutorials\scripting\debug\the_profiler.rst
- godot-docs\development\cpp\using_cpp_profilers.rst

ä½¿ç”¨ Godot å‘½ä»¤è¡Œå‚æ•°è°ƒè°ƒæ•´çª—å£ä½ç½®ã€å¤§å°ä»¥åŠç½®é¡¶çŠ¶æ€æ–¹ä¾¿ç½‘ç»œè°ƒè¯•å¼€å‘ï¼š

```sh
    #  -t, --always-on-top               Request an always-on-top window.
    #  --resolution <W>x<H>              Request window resolution.
    #  --position <X>,<Y>                Request window position (if set, screen argument is ignored).

    $godot3 = "C:\download\games\Godot_v3.5.1-stable_win64.exe"
    $godot4 = "C:\download\games\Godot_v4.0-rc1_win64.exe"
    $godot3m = "C:\download\games\Godot_v3.5.1-stable_mono_win64\Godot_v3.5.1-stable_mono_win64.exe"
    $godot4m = "C:\download\games\Godot_v4.0-rc1_mono_win64\Godot_v4.0-rc1_mono_win64.exe"
    &$godot3 --path . --client --gpu-index 1 -t --resolution 180x240 --position 1200,500
    # &$godot4 --path . --client --gpu-index 1 -t --resolution 180x240 --position 800,400
```

![the Graphics Monitor](https://gdquest.com/tutorial/godot/3d/optimization-3d/monitors.png)

Godot è‡ªå¸¦çš„å›¾å½¢ç›‘è§†é¢æ¿æ”¶é›†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„ 3D åœºæ™¯ç»˜åˆ¶çš„ä¿¡æ¯ï¼š

- **Mat changes** are when the CPU tells the GPU to replace a material with a new one.
- **Shader changes** are when you change shader code.
- **Surface changes** are when you update the worldâ€™s geometry.
- **Draw calls** are the CPU telling the GPU to render something.

é€šè¿‡ä¼˜åŒ–ç½‘æ ¼ã€ç€è‰²å™¨ç­‰ç­‰ï¼Œå¯ä»¥é™ä½å¯¹ GPU æ‰§è¡Œçš„ Draw callsï¼Œå¹¶æä¾› GPU æ€§èƒ½ã€‚

åœ¨ä½¿ç”¨ C++ åˆ†æå™¨ä¹‹å‰ï¼Œéœ€è¦ä¸º Godot ä¸»ç¨‹åºè®¾ç½®è°ƒè¯•ç¬¦å·ä¿¡æ¯ï¼Œå®˜æ–¹æä¾›çš„ä¸‹è½½å·²ç»æ¸…ç†äº†è°ƒè¯•ç¬¦å·æ•°æ®ä»¥
å‡å°ä¸‹è½½æ•°æ®ã€‚éœ€è¦åœ¨æœ¬åœ°é‡æ–°ç¼–è¯‘ Godot å¹¶ä¸”æŒ‰ä»¥ä¸‹ç¼–è¯‘é…ç½®ä¿ç•™è°ƒè¯•ç¬¦å·æ•°æ®ï¼š

- For editor binaries: ``target=release_debug use_lto=yes``
- For debug export templates: ``target=release_debug use_lto=yes``
- For release export templates: ``tools=no target=release debug_symbols=yes``

```sh
> scons platform=list
scons: Reading SConscript files ...
The following platforms are available:

        android
        windows

Please run SCons again and select a valid platform: platform=<string>

# Custom modules
scons custom_modules="../modules,/abs/path/to/modules,~/src/godot_modules"
# Bits
# - `32`: Build binaries for 32-bit platforms.
# - `64`: Build binaries for 64-bit platforms.
# - `default`: Build for the architecture that matches the host platform.
scons platform=<platform> bits=default/32/64
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¼å‡ºæ¨¡æ¿ä¸­å·²ç»åˆ é™¤è°ƒè¯•ç¬¦å·ï¼Œå¯¹äºå¯¼å‡ºæ¨¡æ¿ ``debug_symbols=yes`` æ˜¯å¿…éœ€çš„ã€‚

ä¸è¦ä½¿ç”¨ç¼–è¯‘å™¨çš„ ``strip`` å‘½ä»¤ï¼Œå®ƒä¼šæ¸…ç†è°ƒè¯•ç¬¦å·ï¼Œè¿™æ ·ç¼–è¯‘çš„ç¨‹åºå¹¶ä¸èƒ½æœ‰æ•ˆåœ°è¿›è¡Œæ€§èƒ½åˆ†æã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒSCons ä¼šå­˜å‚¨ç¼–è¯‘ç”Ÿæˆæ–‡ä»¶çš„ md5ï¼Œå†æ¬¡æ‰§è¡Œç¼–è¯‘æ—¶ï¼Œå¦‚æœ md5 æ²¡å˜ï¼Œåˆ™ä¸éœ€è¦ rebuildã€‚
è„šæœ¬ä¸­ä½¿ç”¨ Decider('timestamp-newer') å¯ä»¥æŒ‡å®šä¸ºæ—¶é—´æ¯”è¾ƒï¼Œé»˜è®¤ä¸º MD5-timestampã€‚
Scons ç”¨æˆ·æ‰‹å†Œ 6.1.5 è¯´æ˜äº†å¦‚ä½•å¤„ç†ä¾èµ–æ–‡ä»¶å˜æ›´ã€‚

å¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ fast_unsafe=yes åŠ é€Ÿç¼–è¯‘è¿‡ç¨‹ï¼Œæˆ–è€…ä½¿ç”¨ -j 8 è¿™æ ·æŒ‡å®šçº¿ç¨‹æ•°ã€‚


Godot 4.x å—åˆ° Windows 10 é…ç½®å½±å“ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•ç¨‹åºé‡åˆ°é¦–æ¬¡å¯åŠ¨æ…¢çš„æƒ…å†µï¼Œå› ä¸ºå¼€å‘ä¸­æ¯æ¬¡
å¯åŠ¨éƒ½æ˜¯ä¸€ä¸ªæ–°ç¨‹åºï¼Œéœ€è¦é…ç½®ï¼Œå³æ¯æ¬¡å¯åŠ¨éƒ½æ˜¯é¦–æ¬¡è¿è¡Œï¼Œæ‰€ä»¥ç‰¹åˆ«æ…¢ï¼Œæ—§ç‰ˆæœ¬ä¸­ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ã€‚

è¡¨ç°ä¸ºä¸¤ä¸ªå±‚é¢ï¼š

- Godot ç¼–è¾‘å™¨ä¸­æ‰§è¡Œè°ƒè¯•æ—¶ï¼Œç¨‹åºå¯åŠ¨æ…¢ã€‚
- å¯¼å‡ºçš„å·¥ç¨‹æ‰§è¡Œç¨‹åºåœ¨é¦–æ¬¡å¯åŠ¨æ…¢ï¼Œåé¢å¯åŠ¨é€Ÿåº¦æ­£å¸¸ï¼Œä½†ä¿®æ”¹å¯æ‰§è¡Œç¨‹åºæ–‡ä»¶ååï¼Œé¦–æ¬¡å¯åŠ¨ä¾ç„¶æ…¢ã€‚

æµ‹è¯•ç¨‹åºä¸æ¶‰åŠç½‘ç»œè®¿é—®ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¿®æ”¹é˜²ç«å¢™è§„åˆ™é…ç½®ã€‚

é—®é¢˜æŒ‡å‘ NVIDIA é©±åŠ¨å®‰è£…æœªæ­£ç¡®å®‰è£…ï¼Œå¯èƒ½æ˜¯å› ä¸ºç¦ç”¨äº†ç‹¬ç«‹æ˜¾å¡ï¼Œå¯¼è‡´ç¨‹åºå¯åŠ¨æ…¢ã€‚Godot 4.x å‡çº§å
ä½¿ç”¨äº† Vulkan é©±åŠ¨ï¼Œè¿™éœ€è¦ç¨‹åºé‡æ–°è¿›è¡Œé…ç½®ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ Godot å°è¯•æ£€æŸ¥æ‰€æœ‰è¿æ¥çš„ USB è®¾å¤‡ï¼Œæ£€æŸ¥
é”®ç›˜ã€æ¸¸æˆæ§åˆ¶å™¨ã€VRè€³æœºç­‰ã€‚USB æ§åˆ¶å™¨/é©±åŠ¨ç¨‹åºæœªæ­£ç¡®å®‰è£…ï¼Œé‡æ–°å®‰è£…é©±åŠ¨ç¨‹åºå°†è§£å†³æ­¤é—®é¢˜ã€‚


C++ åº”ç”¨æ€§èƒ½åˆ†æå™¨æ¨èï¼š

- VerySleepy (Windows) http://www.codersnotes.com/sleepy/
- HotSpot (Linux) https://github.com/KDAB/hotspot
- Xcode Instruments (macOS) https://developer.apple.com/xcode/

åœ¨ä½¿ç”¨ VerySleepy åˆ†æå™¨å‰ï¼Œå…ˆå¯åŠ¨ Godotï¼Œæˆ–è€…å·¥ç¨‹ï¼Œå¦‚æœå¯åŠ¨äº†é¡¹ç›®ç®¡ç†å™¨ï¼Œéœ€è¦ç¡®ä¿ Godot è¿è¡Œäº†é¡¹ç›®ã€‚
å› ä¸ºåˆ†æå™¨å¹¶ä¸èƒ½åˆ†æ Godot å·¥ç¨‹ç®¡ç†å™¨äº§ç”Ÿçš„å­çº¿ç¨‹ï¼Œæ¯ä¸ª Godot ç¼–è¾‘å™¨éƒ½æ˜¯å®ƒçš„å­çº¿ç¨‹è¿è¡Œçš„ã€‚

ç„¶åè¿è¡Œ VerySleepy å¯¹å·²ç»è¿è¡Œä¸­çš„ Godot è¿›ç¨‹å®ä¾‹è¿›è¡Œåˆ†æï¼Œä»è¿›ç¨‹åˆ—è¡¨ä¸­é€‰æ‹©ã€‚ç‚¹å‡» **Profile All** 
æŒ‰é’®å¯åŠ¨åˆ†æå¹¶è®°å½•æ•°æ®ï¼Œç„¶åæ“ä½œ Godot å·¥ç¨‹è¿›è¡Œæµ‹è¯•ã€‚å®Œæˆæµ‹è¯•åï¼Œç‚¹å‡» **Stop** (*not* Abort) ç»“æŸè®°å½•ã€‚
ç„¶åï¼Œå¯¹è®°å½•åˆ°çš„ API æ•°æ®è¿›è¡Œåˆ†æã€‚

æ•°æ®è®°å½•åŒ…å«ä¸€ä¸ªå‡½æ•°åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨å³é”®èœå•è¿‡æ»¤æŒ‡å®šæ¨¡å—çš„ APIï¼š

- **Name** - the name of the function. If debugging symbols are not available, the instruction address will be displayed instead.
- **Exclusive** - displays the time spent during the execution of that function, but not of any of its callees.
- **Inclusive** - displays the time spent during the execution of that function, including any other functions called from it (and their callees, and so on).
- **% Exclusive**, **% Inclusive** - as above, but as a percentage of the program's total execution time.
- **Module** - the module (.exe or .dll file) this function belongs to.
- **Source File** - the path to the source code file containing the function. If debugging symbols are not available, this column will display [unknown]).
- **Source Line** - the line number corresponding to the beginning of the function's definition. If debugging symbols are not available, this column will display 0).
- **Address** - the address in memory of the function's compiled code.


Godot è‡ªå¸¦çš„æ€§èƒ½åˆ†æå™¨åœ¨è°ƒè¯•å™¨é¢æ¿ä¸­ï¼Œé€šè¿‡æ‰‹åŠ¨ç‚¹å‡» Start æŒ‰é’®å¯åŠ¨ï¼Œç„¶åè¿è¡Œå·¥ç¨‹å°±å¯ä»¥è®°å½•ç›¸åº” API
çš„æ—¶é—´æ¶ˆè€—ä¿¡æ¯ï¼Œæ”¶é›†åˆ°æ•°æ®åå°±å¯ä»¥å…³é—­ Profilerï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œä»¥ç¡®å®šæ€§èƒ½ç“¶é¢ˆåœ¨ CPU è¿˜ GPUã€‚


Measuring manually in microseconds by get_ticks_usec()

```py
class_name MyMainLoop
extends MainLoop

var time_elapsed = 0

func _initialize():
    print("Initialized:")
    print("  Starting time: %s" % str(time_elapsed))
    _test()

func _process(delta: float):
    time_elapsed += delta
    # Return true to end the main loop.
    return Input.get_mouse_button_mask() != 0 || Input.is_key_pressed(KEY_ESCAPE)

func _physics_process(delta: float):
    pass
    return true # exit main loop

func _finalize():
    print("Finalized:")
    print("  End time: %s" % str(time_elapsed))

# in Godot 3.x 
# bool _idle(delta: float) virtual      -> Node._process().
# bool _iteration(delta: float) virtual -> Node._physics_process().

func _test():
    var dim = 9455
    var arr2D = [range(dim)]
    arr2D.resize(dim) # 10000x10000 array, value of new element is null

    # OS.get_ticks_usec() in Godot 3.x
    var ticks = Time.get_ticks_usec()
    print_debug("Ticks start: %d" % [ticks])

    for i in range(dim):
        arr2D[i] = range(dim)
        for j in range(dim):
            var k = i+j*dim
            arr2D[i][j] = k

    var elapsed = (Time.get_ticks_usec() - ticks) / 1000000
    print_debug("  time_elapsed: %d seconds." % elapsed)

    var arr1D = range(dim * dim)
    ticks = Time.get_ticks_usec()

    for i in range(dim * dim):
        arr1D[i] = i

    elapsed = (Time.get_ticks_usec() - ticks) / 1000000
    print_debug("  time_elapsed: %d seconds." % elapsed)

    # print_debug("  123".to_int(), int("456"), "789" as int)
```

ä»è¾“å‡ºç»“æœæ¥çœ‹ï¼ŒCPU Intel i7-8650Uï¼ŒäºŒç»´æ•°ç»„å› ä¸ºå¤šäº†ä¸€ä¸ª for ç»“æ„ï¼Œä»¥åŠå‡½æ•° range()ï¼Œå®ƒæ¶‰åŠ
å†…å­˜åŠ¨æ€åˆ†é…çš„è°ƒç”¨ï¼Œè¿™éå¸¸æ¶ˆè€—æ—¶é—´ï¼š

    Initialized:
      Starting time: 0
    Ticks start: 1533756
      time_elapsed: 19 seconds.
      time_elapsed: 6 seconds.
    Finalized:
      End time: 0.15

Godot æ²¡æœ‰æä¾›ç›´æ¥åˆå§‹åŒ–å¤§æ•°ç»„çš„æ–¹æ³•ï¼Œä½¿ç”¨ range() å’Œ resize() å‡½æ•°é—´æ¥è·å–å¤§æ•°ç»„éœ€è¦çš„å†…å­˜ï¼Œ
æˆ–è€…é€šè¿‡ C++ åº•å±‚è¿›è¡Œå†…å­˜åŠ¨æ€åˆ†é…ã€‚

æ¯ä¸ª Variant å®ä¾‹è‡³å°‘å ç”¨å†…å­˜ä¸º 20 bytesï¼Œä½¿ç”¨ float ä½œä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œå¦‚æœä½¿ç”¨ double åˆ™
å ç”¨ 30 bytesã€‚å¦å¤–åƒ PoolVectorï¼Œaabbï¼Œmetrix è¿™äº›æ•°ç»„æˆ–ä¸“ç”¨ç±»å‹çš„é¢å¤–å†…å­˜å ç”¨å¦è®¡ã€‚

ä»¥ 10000 æ–¹å½¢äºŒç»´æ•°ç»„ä¸ºä¾‹ï¼Œä½¿ç”¨é»˜è®¤çš„å˜ä½“ç±»å‹å¤§å°å°±å ç”¨ 2GB = 10000 * 10000 * 20 å†…å­˜ï¼Œ
è¿™æ˜¯ç›¸å½“å ç”¨å†…å­˜ï¼


## ğŸŸ¡ Signals & Notifications ä¿¡å·ä¸æ¶ˆæ¯
- [Using signals](https://docs.godotengine.org/en/stable/getting_started/step_by_step/signals.html)
- [Godot notifications](https://docs.godotengine.org/en/3.5/tutorials/best_practices/godot_notifications.html)
- [GDScript grammar](https://docs.godotengine.org/en/stable/development/file_formats/gdscript_grammar.html)
- [Idle and Physics Processing](https://docs.godotengine.org/en/stable/tutorials/scripting/idle_and_physics_processing.html)
- [process and physics_process in Godot](http://kehomsforge.com/tutorials/single/process-physics-process-godot)

Godot åœ¨åŸºç¡€ç±»å‹ **Object** å®ç°äº†æ¶ˆæ¯æœºåˆ¶ï¼Œç”¨äºå“åº”å„ç§ engine-level çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚ï¼Œå¼•æ“è¦å¯¹ 
CanvasItem æ‰§è¡Œç»˜å›¾åŠŸèƒ½ï¼Œå®ƒä¸ä¼šç›´æ¥å»è°ƒç”¨ darw() æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡å‘é€ä¸€ä¸ªç»˜å›¾æ¶ˆæ¯ï¼Œç„¶åç”±éœ€è¦å“åº”
è¿™ä¸€æ¶ˆæ¯çš„ CanvasItem è¿›è¡Œç»˜å›¾åŠ¨ä½œï¼Œè€Œä¸éœ€è¦å“åº”ç»˜å›¾æ¶ˆæ¯çš„å¯¹è±¡å°±ä¸ä¼šæœ‰ç›¸åº”çš„åŠ¨ä½œï¼Œå¯¹è±¡ä¹‹é—´å®ç°äº†è§£è€¦ã€‚

```py
_notification(NOTIFICATION_DRAW)
```

å…¸å‹çš„åœºæ™¯èŠ‚ç‚¹ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸€ç³»åˆ—ä¸“ç”¨æ¶ˆæ¯ä»¥åŠç›¸åº”çš„ä¸“ç”¨å‡½æ•°ï¼Œå¤§å¤šæ¶ˆæ¯å¸¸é‡éƒ½å®šä¹‰åœ¨ Nodeï¼š

```py
_ready() : NOTIFICATION_READY

_enter_tree() : NOTIFICATION_ENTER_TREE

_exit_tree() : NOTIFICATION_EXIT_TREE

_process(delta) : NOTIFICATION_PROCESS

_physics_process(delta) : NOTIFICATION_PHYSICS_PROCESS

_draw() : NOTIFICATION_DRAW
```

è„šæœ¬ä¸­å¯ä»¥å®šä¹‰ `_notification(what:int)` å‡½æ•°å“åº”å¼•æ“å‘å‡ºçš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé€šå¸¸åªéœ€è¦å¤„ç†ä¸€éƒ¨åˆ†æ¶ˆæ¯ï¼Œ
åªéœ€è¦å®šä¹‰æŒ‡å®šçš„å“åº”å‡½æ•°ï¼Œå¦‚ä¸Šé¢ç½—åˆ—çš„å“åº”å‡½æ•°å¯¹åº”ä¸€ä¸ªæ¶ˆæ¯ã€‚

å¦‚æœè„šæœ¬åœ¨æ²¡æœ‰åœºæ™¯çš„æƒ…å†µä¸‹åˆå§‹åŒ–è‡ªå·±çš„èŠ‚ç‚¹å­æ ‘ï¼Œé‚£ä¹ˆä»£ç åº”è¯¥åœ¨åˆå§‹åŒ–æ–¹æ³• `_init()` è¿™é‡Œæ‰§è¡Œï¼Œå…¶ä»–
å±æ€§æˆ– SceneTree ç‹¬ç«‹åˆå§‹åŒ–ä¹Ÿåº”åœ¨æ­¤å¤„è¿è¡Œã€‚åˆå§‹åŒ–æ–¹æ³•åœ¨ `_ready` æˆ– `_enter_tree` ä¹‹å‰è§¦å‘ï¼Œ
ä½†åœ¨è„šæœ¬åˆ›å»ºå¹¶åˆå§‹åŒ–å…¶å±æ€§ä¹‹åè§¦å‘ã€‚

å¦‚æœä¸€ä¸ªèŠ‚ç‚¹éœ€è¦è§¦å‘ä½œä¸ºå¦ä¸€ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å‘ç”Ÿçš„è¡Œä¸ºï¼Œæ— è®ºå®ƒæ˜¯å¦ä½œä¸ºä¸»/æ´»åŠ¨åœºæ™¯çš„ä¸€éƒ¨åˆ†å‘ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨
PARENTED é€šçŸ¥ã€‚

ä¾‹å¦‚ï¼Œå°†èŠ‚ç‚¹çš„æ–¹æ³•è¿æ¥åˆ°çˆ¶èŠ‚ç‚¹ä¸Šçš„è‡ªå®šä¹‰ä¿¡å·ï¼Œè€Œä¸ä¼šå¤±è´¥ï¼š

```py
extend Node

# "one" is an "initialized value". These DO NOT trigger the setter.
# If someone set the value as "two" from the Inspector, this would be an
# "exported value". These DO trigger the setter.
export(String) var test = "one" setget set_test

func _init():
    # "three" is an "init assignment value".
    # These DO NOT trigger the setter, but...
    test = "three"
    # These DO trigger the setter. Note the `self` prefix.
    self.test = "three"

func set_test(value):
    test = value
    print("Setting: ", test)


var parent_cache

func connection_check():
    return parent.has_user_signal("interacted_with")

func _notification(what):
    match what:
        NOTIFICATION_PARENTED:
            parent_cache = get_parent()
            if connection_check():
                parent_cache.connect("interacted_with", self, "_on_parent_interacted_with")
        NOTIFICATION_UNPARENTED:
            if connection_check():
                parent_cache.disconnect("interacted_with", self, "_on_parent_interacted_with")

func _on_parent_interacted_with():
    print("I'm reacting to my parent's interaction!")
```

ä¿¡å·æ˜¯èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œé€šä¿¡çš„æ‰‹æ®µï¼Œå’Œæ¶ˆæ¯ä¸€æ ·ï¼Œå®ƒä»¬ä¸ä»…ä»…åœ¨èŠ‚ç‚¹å¯¹è±¡ä¸­ä½¿ç”¨ã€‚è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œæœ‰ä¸‰ä¸ªè¦ç´ ï¼š

- è¢«è§‚å¯Ÿè€…ï¼šæ˜¯æ¶ˆæ¯ã€ä¿¡å·çš„ç”Ÿäº§æ–¹ï¼Œé€šè¿‡è°ƒç”¨ emit_signal() æ–¹æ³•å‘å¸ƒæ¶ˆæ¯ï¼›
- è§‚å¯Ÿè€…ï¼šæ˜¯æ¶ˆæ¯ã€ä¿¡å·çš„æ¶ˆè´¹æ–¹ï¼Œè°ƒç”¨è¢«è§‚å¯Ÿè€…çš„ connect() æ–¹æ³•æ³¨å†Œå¤„ç†å‡½æ•°ï¼Œç„¶åç­‰å¾…è¦å¤„ç†çš„ä¿¡å·ï¼›
- æ¶ˆæ¯ã€ä¿¡å·ï¼šæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œé€šè¿‡ä¸€ä¸ªåç§°å°†è§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…è”ç³»èµ·æ¥ï¼›

åŸºç¡€ç±» **Object** ä¸­ä¸ä¿¡å·ç›¸å…³çš„æ–¹æ³•å¦‚ä¸‹ï¼š

```py
void add_user_signal(signal: String, arguments: Array = [  ]) const 

Error connect(signal: String, target: Object, method: String, binds: Array = [  ], flags: int = 0) 

void disconnect(signal: String, target: Object, method: String)

void emit_signal(signal: String, ...) vararg
```

é€šè¿‡ add_user_signal æ–¹æ³•å¯ä»¥æ·»åŠ ç”¨æˆ·è‡ªå®šä¹‰ä¿¡å·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ GDScript è„šæœ¬ä¸­ signal å…³é”®å­—
å®šä¹‰ç”¨æˆ·ä¿¡å·ï¼ŒGDScript grammar è§„èŒƒæ–‡æ¡£æ˜¾ç¤ºæœ‰ä¸¤æ¡ä¸ä¿¡å·æœ‰å…³çš„è§„åˆ™ï¼š

    signalDecl = "signal" IDENTIFIER [ signalParList ] NEWLINE ;
    signalParList = "(" [ IDENTIFIER { "," IDENTIFIER } ] ")" ;

å®šä¹‰ä¸€ä¸ªç”¨æˆ·ä¿¡å·ä½¿ç”¨ **signal** å…³é”®å­—ï¼Œåè·Ÿä¿¡å·æ ‡è¯†ç¬¦ï¼Œè¿˜å¯ä»¥è®¾ç½®ä¿¡å·è¦ä¼ é€’çš„å‚æ•°åˆ—è¡¨ã€‚

åˆ›å»ºä¸€ä¸ªç»“æ„å¦‚ä¸‹çš„åœºæ™¯ç”¨äºæ¼”ç¤ºè‡ªå®šä¹‰ä¿¡å·ï¼š

    +-- Node2D
        +-- Label
        +-- ButtonA
        +-- ButtonB

ç»™æ ¹èŠ‚ç‚¹ Node2D ç»‘å®šä»¥ä¸‹è„šæœ¬ï¼š

- è„šæœ¬å®šä¹‰äº†ä¸€ä¸ª SignalReceived ä¿¡å·ï¼Œå®ƒå¸¦ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ï¼›
- å®šä¹‰äº†ä¸€ä¸ª `_on_pressed()` æ–¹æ³•ç”¨æ¥å“åº”æŒ‰é”®åŠ¨ä½œï¼›
- å½“æŒ‰æŒ‰ä¸‹æ—¶è§¦å‘å¤„ç†ï¼Œå¹¶è°ƒç”¨ emit_signal() æ–¹æ³•å‘å¸ƒè‡ªå®šä¹‰ä¿¡å·ï¼›

```py
extends Node2D

signal SignalReceived(count)

var count = 0

func _ready():
    pass

func _on_pressed(name):
    $Label.text = name + " pressed"
    count += 1
    emit_signal("SignalReceived", count)
```

ç»™ä¸¤ä¸ªæŒ‰é’®ç»‘å®šä»¥ä¸‹è„šæœ¬ï¼Œè„šæœ¬åœ¨æŒ‰é’®èŠ‚ç‚¹åŠ è½½å®Œæˆæ—¶ï¼Œå‘æ ¹èŠ‚ç‚¹ Node2D æ³¨å†Œä¿¡å·å“åº”å‡½æ•°ï¼š

- connect() æ–¹æ³•æ³¨å†Œ `_on_feedback()` ä½œä¸ºè‡ªå®šä¹‰ä¿¡å·çš„å“åº”å‡½æ•°ï¼›
- å“åº”å‡½æ•°çš„å‚æ•°å°†ç”± Node2D åœ¨ emit_signal() æ–¹æ³•ä¸­ä¼ é€’è¿‡æ¥ï¼Œä½¿ç”¨ç©ºæ•°ç»„è¡¨ç¤ºè¿æ¥ä¿¡å·æ—¶ä¸ç»‘å®šå‚æ•°ï¼›
- å“åº”å‡½æ•°ä¸­ä½¿ç”¨ SceneTreeTween åšä¸€ä¸ªå»¶æ—¶æ•ˆæœåï¼Œå†æ›´æ–°æŒ‰é’®çš„æ–‡å­—ï¼Œæ˜¾ç¤ºå½“å‰åŠ¨ä½œæ¬¡æ•°ç´¯è®¡å€¼ï¼›

```py
extends Button

func _ready():
    $"..".connect("SignalReceived", self, "_on_feedback", [], CONNECT_PERSIST)

func _on_feedback(count:int):
    var tween = create_tween()
    tween.tween_interval(1)
    tween.tween_callback(self, "_update_log", [count])
    
func _update_log(count:int):
    self.text = "count %s" % (count)
```

éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä¸¤ä¸ªæŒ‰é’®éƒ½ä¼šå“åº” SignalReceived ä¿¡å·ï¼Œæ‰€ä»¥æŒ‰ä¸‹ä»»æ„ä¸€ä¸ªæŒ‰é’®åï¼ŒNode2D ä¼šæ›´æ–° Label
å†…å®¹ï¼Œç„¶åå‘å¸ƒè‡ªå®šä¹‰ä¿¡å·åï¼Œä¸¤ä¸ªæŒ‰é’®éƒ½ä¼šå“åº”è¿™ä¸ªä¿¡å·ï¼Œå¹¶æ›´æ–°æŒ‰é’®çš„æ–‡å­—ã€‚

å¦å¤–ï¼ŒæŒ‰é”®åŠ¨ä½œå“åº”å‡½æ•°å¯ä»¥ä½¿ç”¨ Godot IDE ç»‘å®šä¿¡å·ï¼Œå…ˆé€‰æ‹©åœºæ™¯èŠ‚ç‚¹ï¼Œå†åœ¨ Node -> Signals é¢æ¿
è¿›è¡Œä¿¡å·ç»‘å®šæ“ä½œï¼ŒåŒ…æ‹¬æ·»åŠ å‚æ•°ç»‘å®šã€‚IDE ç»‘å®šä¿¡å·å°±æ˜¯åœ¨åœºæ™¯æ–‡ä»¶ä¸­æ·»åŠ ä¸€æ¡ connection ä¿¡æ¯ï¼Œå¦‚ï¼š

    [connection signal="pressed" from="Node" to="Node" method="_some_func"]


ä¿¡å·è¿˜å¯ä»¥é…åˆ yield() æ–¹æ³•ä½¿ç”¨ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µéƒ½æ˜¯åœ¨ç­‰å¾…ä¿¡å·ï¼Œåœ¨ä¿¡å·å‡ºç°å‰ä¼šæš‚åœå‡½æ•°çš„æ‰§è¡Œï¼š

```py
yield(get_tree(), "idle_frame") # ä¸‹ä¸€å¸§æ¢å¤æ‰§è¡Œ
yield(get_node("AnimationPlayer"), "finished") #  åŠ¨ç”» AnimationPlayer æ’­æ”¾å®Œæ¯•åç»§ç»­æ‰§è¡Œ
yield(get_tree().create_timer(5.0), "timeout") #  æš‚åœ5ç§’åæ‰§è¡Œ
yield(button_func(), "completed") #   å‡½æ•°æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ
yield($Button0, "pressed") #  æŒ‰é’®ç‚¹å‡»åæ‰§è¡Œ
```


## ğŸŸ¡ InputMap ç”¨æˆ·è¾“å…¥ä¸æ˜ å°„
- [User Inputs](https://docs.godotengine.org/en/3.5/tutorials/inputs/index.html)
- https://github.com/expressobits/character-controller


ç°ä»£çš„æ¸¸æˆè¾“å…¥ç¡¬ä»¶éå¸¸ä¸°å¯Œï¼Œä¸‰å¤§æ¸¸æˆå¹³å°åˆ†åˆ«æ˜¯ï¼š

- PC Game å°å¼æœºæ¸¸æˆï¼›
- Console Game ä¸»æœºæ¸¸æˆï¼Œå¦‚ PS2ã€XBox ç­‰ï¼›
- Web Game ç½‘é¡µæ¸¸æˆï¼Œä»¥æµè§ˆå™¨é¡µé¢ä¸ºè½½ä½“ï¼›

å¯ç”¨çš„è¾“å…¥è®¾å¤‡ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œæœ‰ä¼ ç»Ÿçš„é”®ç›˜ã€Joystickã€Gamepadï¼Œä¹Ÿæœ‰ä»¿çœŸèµ›è½¦æ–¹å‘ç›˜ï¼Œç”šè‡³æ˜¯è§¦å±è™šæ‹Ÿæ‰‹æŸ„ï¼Œ
Godot å°±æä¾›äº†ä¸€ä¸ª TouchScreenButton ç”¨äºè§¦æ‘¸å±çš„è¾“å…¥ã€‚å¯¹äºä¸€ä¸ªæ”¯æŒå¤šç«¯å¼€å‘çš„æ¸¸æˆå¼•æ“ï¼Œè¿™ä¹ˆå¤šçš„
è¾“å…¥è®¾å¤‡ï¼Œå¦‚æœç›´æ¥ç¡¬ç¼–ç ï¼Œä¼šç»™åæœŸå¸¦æ¥å„ç§é€‚é…éº»çƒ¦ã€‚è€Œåœ¨è¾“å…¥ä¸æ¸¸æˆåº”ç”¨ä¹‹é—´è®¾ç½®ä¸€ä¸ªæ˜ å°„å±‚ï¼Œå¯ä»¥å¾ˆå¥½åœ°è§£è€¦ã€‚
ç”¨æˆ·æ“ä½œç¡¬ä»¶äº§ç”Ÿå„ç§ InputEventï¼Œé€šè¿‡ InputMap è®¾ç½®ç›¸åº”çš„ Actionï¼Œåœ¨æ¸¸æˆé€»è¾‘ä¸­ç›´æ¥ä½¿ç”¨ Action 
ä½œä¸ºç”¨æˆ·è¾“å…¥ï¼Œä¸åŒçš„ Action ç”±ä»€ä¹ˆç¡¬ä»¶äº§ç”Ÿå°±ä¸å†éœ€è¦å¼€å‘è€…å…³æ³¨ã€‚åªéœ€è¦è®¾ç½®å¥½ Action ä¸ InputEvent 
çš„æ˜ å°„å…³ç³»ï¼Œç”¨æˆ·æ“ä½œæŒ‰æ˜ å°„å…³ç³»äº§ç”Ÿç›¸åº”çš„åŠ¨ä½œã€‚

![Input Event Flow](https://docs.godotengine.org/en/3.5/_images/input_event_flow.png)

ç”¨æˆ·è¾“å…¥ä¼šå…ˆè¿›å…¥æ ‡å‡† `Node._input()` å‡½æ•°ï¼Œä»»ä½•èŠ‚ç‚¹ä¸­è¦†ç›–è¿™ä¸ªå‡½æ•°å°±å¯ä»¥å¤„ç†ç”¨æˆ·çš„æ‰€æœ‰è¾“å…¥ï¼Œåªè¦
è¿˜æ²¡æœ‰ä½¿ç”¨ `Node.set_process_input()` ç¦ç”¨è¾“å…¥å¤„ç†ã€‚å¦‚æœä»»ä½•ç”¨æˆ·è¾“å…¥çš„æ˜¯æ­£è¦å¤„ç†çš„äº‹ä»¶ï¼Œå¯ä»¥
è°ƒç”¨ SceneTree æˆ– Viewport çš„ `set_input_as_handled()` å‡½æ•°å‘Šè¯‰å¼•æ“ï¼Œè¿™ä¸ªäº‹ä»¶å·²ç»è¢«å¤„ç†å¥½ï¼Œ
ä¸å¿…å†ä¼ æ’­ï¼Œè¿™ç¡®ä¿å¯ä»¥è¿‡æ»¤æ‰€æœ‰æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚å¯¹äºæ¸¸æˆè¾“å…¥ï¼Œ`Node._unhandled_input()` é€šå¸¸æ›´é€‚åˆï¼Œ
å› ä¸ºå®ƒå…è®¸ GUI æ‹¦æˆªäº‹ä»¶ã€‚

æ ‡å‡†è¾“å…¥å¤„ç†åï¼Œäº‹ä»¶ä¼šæµå‘ GUI äº‹ä»¶å¤„ç†ï¼Œæ§ä»¶å¯ä»¥åœ¨ `Control._gui_input()` æ¥æ”¶åˆ° GUI äº‹ä»¶ï¼Œ
gui_input ä¿¡å·ä¼šåœ¨æ­¤å‘å¸ƒã€‚å¦‚æœæ§ä»¶å¤„ç†å¥½äº‹ä»¶ï¼Œåº”è¯¥è°ƒç”¨ `Control.accept_event()` é¿å…äº‹ä»¶å†
ä¼ æ’­ã€‚GUI æ§ä»¶å¯ä»¥è®¾ç½® mouse_filter å±æ€§æ¥é¿å…é¼ æ ‡ç©¿é€åˆ°ä¸‹ä¸€å±‚çš„æ§ä»¶ä¸Šã€‚

å¦‚æœï¼Œå‰ä¸¤æ­¥ä¸­è¿˜æ²¡æœ‰è¡¨æ˜äº‹ä»¶è¢«å¤„ç†å¥½ï¼Œäº‹ä»¶å°±ä¼šé€å…¥ `_unhandled_input()` åŠ `_unhandled_key_input()` 
å‡½æ•°ä¸­å¤„ç†ï¼Œåªè¦æ²¡æœ‰é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç¦ç”¨ã€‚

å¤„ç†æœªç»å¤„ç†çš„è¾“å…¥æ˜¯å…¨å±æ¸¸æˆäº‹ä»¶å¤„ç†çš„ç†æƒ³é€‰æ‹©ï¼Œå› æ­¤å½“ GUI å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œå®ƒä»¬ä¸ä¼šè¢«æ¥æ”¶ã€‚å¦‚æœåˆ°
è¿™ä¸€æ­¥è¿˜æ²¡è¡¨ç¤ºè¯¥äº‹ä»¶å·²ç»è¢«å¤„ç†ï¼Œåœ¨å¯ç”¨ Object Picking çš„æƒ…å†µä¸‹å°†æ‘„å½±æœºæŒ‡å®šç»™è§†å£ï¼Œåˆ™äº‹ä»¶å°†ä¼š
æŠ•å°„åˆ°å…‰çº¿æ–¹å‘çš„ç‰©ç†ä¸–ç•Œã€‚å¯¹äºæ ¹è§†å£ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®è®¾ç½®ä¸­å¯ç”¨æ­¤é€‰é¡¹ï¼Œå¦‚æœæ­¤å…‰çº¿å‡»ä¸­å¯¹è±¡ï¼Œå®ƒå°†è°ƒç”¨
`CollisionObject._input_event()` å‡½æ•°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»ä½“ä¼šæ¥æ”¶æ­¤å›è°ƒï¼Œä½†åŒºåŸŸä¸ä¼šï¼Œå¯ä»¥é€šè¿‡
åŒºåŸŸå±æ€§è¿›è¡Œé…ç½®ã€‚key_input åªåŒ…å«é”®ç›˜äº‹ä»¶ï¼Œé¼ æ ‡ã€æ‰‹æŸ„æŒ‰é”®ã€è½´è¿åŠ¨ç­‰ä¸å±äºé”®ç›˜äº‹ä»¶ã€‚

æœ€åï¼Œå¦‚æœäº‹ä»¶æœªå¤„ç†ï¼Œå®ƒå°†è¢«ä¼ é€’åˆ°æ ‘ä¸­çš„ä¸‹ä¸€ä¸ªè§†å£ï¼Œå¦åˆ™å°†è¢«å¿½ç•¥ã€‚GUI äº‹ä»¶ä¹Ÿä¼šåœ¨åœºæ™¯æ ‘ä¸­å‘ä¸Šä¼ æ’­ï¼Œ
ä½†ç”±äºè¿™äº›äº‹ä»¶é’ˆå¯¹ç‰¹å®šæ§ä»¶ï¼Œå› æ­¤åªæœ‰ç›®æ ‡æ§ä»¶èŠ‚ç‚¹çš„ç›´ç³»ä¸Šçº§èŠ‚ç‚¹æ‰èƒ½æ¥æ”¶äº‹ä»¶ã€‚

éœ€è¦æ³¨æ„ï¼Œäº‹ä»¶åœ¨èŠ‚ç‚¹ä¸­çš„ä¼ æ’­æ˜¯ä»åé¢ã€æ·±å±‚å¾€æ ¹èŠ‚ç‚¹ä¼ æ’­çš„ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹è°ƒç”¨ `accept_event()` æˆ–è€…
`set_input_as_handled()` å‡½æ•°åï¼Œåªèƒ½é˜»æ­¢ä¸Šå±‚èŠ‚ç‚¹æ¥æ”¶ç›¸åº”çš„äº‹ä»¶ï¼Œè€Œä¸èƒ½é˜»æ­¢ä¸‹å±‚æˆ–åé¢çš„èŠ‚ç‚¹
æ¥æ”¶äº‹ä»¶ã€‚åŒæ—¶ï¼ŒèŠ‚ç‚¹è¿˜å¯ä»¥ç›´æ¥åœ¨ process ç­‰å‡½æ•°ä¸­è°ƒç”¨ Input ä¸»åŠ¨è½®è¯¢è¾“å…¥çŠ¶æ€ï¼Œè€Œä¸å¿…è¢«åŠ¨æ¥æ”¶äº‹ä»¶ã€‚

![reverse depth-first order](https://docs.godotengine.org/en/3.5/_images/input_event_scene_flow.png)

æ€»ç»“ä¸€ä¸‹è¾“å…¥æ•°æ®çš„èµ°å‘ï¼Œåœ¨æ²¡æœ‰äº‹ä»¶ä¼ æ’­å¹²é¢„çš„æ¡ä»¶ä¸‹ï¼Œç”¨æˆ·è¾“å…¥çš„æµå‘ï¼š

```py
# Step 1: Node 
void _input(event: InputEvent) virtual

# Step 2: Control
void _gui_input(event: InputEvent) virtual

# Step 3: Node
void _unhandled_input(event: InputEvent) virtual
void _unhandled_key_input(event: InputEventKey) virtual
```

å¯¹è¾“å…¥æ•°æ®ä¼ æ’­è¿›è¡Œå¹²æ‰°çš„æ–¹æ³•ï¼š

```py
# SceneTree
void set_input_as_handled()

# Node
void set_process_input(enable: bool)
void set_process_unhandled_input(enable: bool)
void set_process_unhandled_key_input(enable: bool)

# Control
void accept_event()
```

å°±é”®ç›˜è¾“å…¥è€Œè¨€ï¼Œä¸åŒå›½å®¶ä½¿ç”¨çš„é”®ç›˜å¸ƒå±€ä¹Ÿä¸å°½ç›¸åŒï¼ŒæŒ‰é”®ç‰©ç†ä½ç½®åˆ†å¸ƒæœ‰æ‰€å·®å¼‚ã€‚Godot å·¥ç¨‹è®¾ç½® Input Map
å¯ä»¥å°†ä»¥ä¸‹ 5 ç§è¾“å…¥äº‹ä»¶æ˜ å°„åˆ°ä¸€ä¸ª Action ä¸Šï¼š

- Key é”®ç›˜è¾“å…¥ï¼Œä¸æŒ‰é”®æ‰«æç å…³è”ï¼Œæ‰«æç ä¿å­˜åœ¨ scancode å±æ€§ï¼›
- Physical Key é”®ç›˜è¾“å…¥ï¼Œä¸æŒ‰é”®ç‰©ç†ä½ç½®å…³è”ï¼Œæ‰«æç ä¿å­˜åœ¨ physical_scancode å±æ€§ï¼›
- Joy Button æ‰‹æŸ„æŒ‰é”®è¾“å…¥ï¼Œç”¨æˆ·æ¯æŒ‰ä¸€ä¸‹å°±è§¦å‘ä¸€æ¬¡äº‹ä»¶ï¼›
- Joy Axis æ‰‹æŸ„è½´è¾“å…¥ï¼Œå¦‚æ–¹å‘è½´ï¼Œåªè¦ç”¨æˆ·ä¿æŒæŒ‰é”®çŠ¶æ€ï¼Œäº‹ä»¶å°±ä¸æ–­æ¥æ”¶è¾“å…¥æ•°æ®ï¼›
- Mouse Button é¼ æ ‡æŒ‰é”®è¾“å…¥ï¼ŒåŒ…æ‹¬æ»šè½®ï¼Œä½†ä¸åŒ…å«ç§»åŠ¨äº‹ä»¶ï¼›

InputEventKey äº‹ä»¶æ¥æ”¶åˆ°é”®ç›˜è¾“å…¥çš„æ•°æ®ä¸­ï¼ŒåŒ…å« scancode å’Œ physical_scancodeï¼Œç‰©ç†æ‰«æç 
è®°å½•çš„æ˜¯æŒ‰é”®åœ¨é”®ç›˜çš„åºå·ï¼Œ101/102-key US QWERTY æ ‡å‡†é”®ç›˜å¸ƒå±€å¸¸ç”¨ä½œå‚ç…§ã€‚ä¾‹å¦‚ï¼ŒWASD å¸¸ç”¨äºæ¸¸æˆï¼Œ
ä½¿ç”¨ Physical Key ç»‘å®šæ—¶ï¼Œå°±æ˜¯ä»¥è¿™äº›æŒ‰é”®åœ¨æ ‡å‡†é”®ç›˜å¸ƒå±€çš„ä½ç½®å¯¹åº”çš„æŒ‰é”®ï¼Œè€Œ Key æ–¹å¼ç»‘å®šå…·ä½“çš„æŒ‰é”®ã€‚

åŒä¸€å°æœºå™¨ä¸Šï¼Œé™¤é”®ç›˜è¾“å…¥å¤–ï¼Œæ‰‹æŸ„ã€é¼ æ ‡ç­‰è®¾å¤‡å¯èƒ½åŒæ—¶å­˜åœ¨å¤šä¸ªï¼Œéœ€è¦æŒ‡å®šè®¾å¤‡å·ã€‚

ç”¨æˆ·è¾“å…¥è®¾å¤‡æœ‰ä¸¤ç§å½¢å¼ï¼š

- è¿ç»­çš„ Axis è¾“å…¥ï¼Œå¦‚æ‰‹æŸ„ä¸Šçš„æ–¹å‘åå­—è½´ï¼ŒåŒ…å«ä¸Šä¸‹ä¸€ä¸ªè½´å’Œå·¦å³ä¸€ä¸ªè½´ï¼›
- å•æ¬¡è§¦å‘çš„æŒ‰é”®è¾“å…¥ï¼Œå¦‚é¼ æ ‡æŒ‰é”®ï¼›

ä»è¾“å…¥å¤„ç†çš„æ–¹å¼æ¥çœ‹ï¼Œä¹Ÿæœ‰ä¸¤ç§ï¼š

- ç­‰å¾…äº‹ä»¶é€šçŸ¥å¼ï¼Œå¦‚ `_input()` ä¸­å¤„ç†çš„äº‹ä»¶ï¼ŒåŒ…å«æŒ‰é”®å¼å’Œæ‰‹æŸ„ Axis è¾“å…¥ï¼›
- ä¸»åŠ¨å¼è½®è¯¢ï¼Œé€šè¿‡ `Input` å¯¹è±¡ä¸»åŠ¨æŸ¥è¯¢æŒ‰é”®çš„çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥å®ç°ç±»å‹ Axis è¾“å…¥çš„æ•ˆæœï¼›

Godot å·¥ç¨‹è®¾ç½®ä¸­ï¼Œå¯ä»¥æ˜ å°„é”®ç›˜ã€é¼ æ ‡æŒ‰é”®ã€æ‰‹æŸ„æŒ‰é”®ã€æ‰‹æŸ„è½´è¾“å…¥ç­‰ç­‰ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›é¼ æ ‡ç§»åŠ¨äº‹ä»¶çš„æ˜ å°„ã€‚
InputEventMouseMotion éœ€è¦æŸ¥è¯¢äº‹ä»¶ç±»å‹è¿›è¡Œå¤„ç†ã€‚Mouse Motion ä¸ä»…ä»…åŒ…å«é¼ æ ‡çš„ç§»åŠ¨ï¼Œè¿˜å¯èƒ½æ˜¯
å‹æ„Ÿç¬”çš„ç§»åŠ¨ï¼Œè¿™ç§æƒ…å†µä¼šæœ‰å‚æ•°ä¼ é€’å€¾æ–œåº¦ã€å‹åŠ›ã€ç¬”æ†å€’è½¬ç­‰ä¿¡æ¯ã€‚é€Ÿåº¦ speed ä¸ºç§»åŠ¨åƒç´ é‡æ¯ç§’ã€‚

```py
    Vector2 tilt [default: Vector2( 0, 0 )]
      float pressure [default: 0.0]
       bool pen_inverted [default: false]
    Vector2 relative [default: Vector2( 0, 0 )]
    Vector2 speed [default: Vector2( 0, 0 )]
```

å•æ¬¡è§¦å‘çš„äº‹ä»¶å’Œè¿ç»­è§¦å‘çš„è½´äº‹ä»¶æœ‰ä¸€ä¸ªæ˜æ˜¾çš„å·®åˆ«ï¼Œå°±æ˜¯æ•°æ®çš„æŒç»­æ€§ï¼Œå…¨å±€çš„ Input å¯¹è±¡å¯ä»¥è½®è¯¢æŒ‰é”®çŠ¶æ€ï¼Œ
Events versus polling ä¸¤ç§æ–¹å¼å¦‚ä¸‹ï¼š

```py
func _input(event):
    if event.is_action_pressed("jump"):
        jump()


func _physics_process(delta):
    if Input.is_action_pressed("move_right"):
        # Move as long as the key/button is pressed.
        position.x += speed * delta
```

åˆ¤æ–­ä¸€ä¸ªåŠ¨ä½œæ˜¯å¦è§¦å‘ï¼ŒInput æä¾›äº†ä¸¤ä¸ªæ£€æµ‹æ–¹æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯ **is_action_just_pressed()**ï¼Œå®ƒåªåœ¨äº‹ä»¶
åˆšè§¦å‘æ—¶è¿”å›çœŸå€¼ï¼Œåç»­åªæœ‰åœ¨å¤ä½åå†æ¬¡è§¦å‘æ—¶æ‰è¿”å›çœŸå€¼ã€‚


ç”¨æˆ·è¾“å…¥æ—¶äº§ç”Ÿçš„äº‹ä»¶æ•°æ®ä¿å­˜åœ¨ InputEvent ç±»å‹åŠå…¶å­ç±»ä¸­ï¼Œä¸åŒçš„ç¡¬ä»¶äº‹ä»¶ä½¿ç”¨ä¸åŒçš„äº‹ä»¶ç±»å‹åŒ…è£…æ•°æ®ï¼š

- **InputEvent** - è¿™æ˜¯æ‰€æœ‰è¾“å…¥äº‹ä»¶ç±»å‹çš„åŸºç±»ï¼›
- **InputEventWithModifiers** - å¸¦æœ‰ä¿®é¥°æŒ‰é”®çš„äº‹ä»¶ï¼Œé”®ç›˜ã€é¼ æ ‡äº‹ä»¶ç­‰ï¼Œä¿®é¥°é”®æœ‰ Shiftã€Alt ç­‰ï¼›
- **InputEventKey** - é”®ç›˜è¾“å…¥äº‹ä»¶ï¼›
- **InputEventMouse** - é¼ æ ‡äº‹ä»¶åŸºç±»ï¼ŒåŒ…å«é¼ æ ‡åœ¨åœºæ™¯å†…çš„ä½ç½® position ä»¥åŠå…¨å±€å±å¹•ä½ç½® global_positionï¼›
- **InputEventGesture** - æ‰‹åŠ¿äº‹ä»¶ï¼›
- **InputEventMouseButton** - é¼ æ ‡æŒ‰é”®äº‹ä»¶ï¼ŒåŒ…å«åŒå‡»çŠ¶æ€ doubleclick æˆ–è€…æ»šåŠ¨å› æ•° factor ç­‰ç­‰ï¼›
- **InputEventMouseMotion** - é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ŒåŒ…å«é€Ÿåº¦ speed ä»¥åŠç›¸å¯¹è·ç¦» relative ç­‰ç­‰ï¼›

æ‰‹æŸ„äº‹ä»¶å’Œé¼ æ ‡ç±»ä¼¼ï¼Œæœ‰ä¸¤ç§ï¼ŒInputEventJoypadButton, InputEventJoypadMotionï¼Œæ‰‹æŸ„çš„è½´è¾“å…¥
æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿé‡ï¼Œé€šå¸¸åœ¨ [-1.0, 1.0] çš„èŒƒå›´ï¼Œæ‰‹æŸ„å¯ä»¥æœ‰å¤šä¸ªè½´ï¼Œæ–¹å‘åå­—é”®å°±åŒ…å« X/Y è½´ï¼Œè¿™äº›æ•°æ®åˆ†åˆ«
ä»¥ axis å’Œ axis_value å±æ€§è¡¨ç¤ºã€‚

å¦å¤–ï¼Œè§¦å±äº‹ä»¶ **InputEventScreenTouch** ç›¸å½“é¼ æ ‡å•å‡»ï¼Œ**InputEventScreenDrag** ç›¸å½“äºé¼ æ ‡ç§»åŠ¨ã€‚


å¯¹äºæœªå¤„ç†çš„äº‹ä»¶ï¼Œå¯ä»¥ç”¨ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œé»˜è®¤æ˜¯æ¿€æ´»çš„ï¼Œä¸éœ€è¦æ—¶å¯ä»¥åœ¨ `_ready()` è°ƒç”¨åè®¾ç½®ä¸ºç¦ç”¨ï¼š

```py
func _unhandled_input(event):
  print("unhandled input", event)

func _unhandled_key_input(event):
  print("unhandled key input", event)


void set_process_unhandled_input(enable: bool)

void set_process_unhandled_key_input(enable: bool)
```

ä½¿ç”¨ InputMap å¯ä»¥ä¸è€ƒè™‘ Action å…·ä½“ç”±ä»€ä¹ˆè®¾å¤‡è§¦å‘ï¼Œæˆ–è€…ç”±å¤šå°‘ä¸ªè®¾å¤‡è§¦å‘åŒä¸€ä¸ª Actionï¼ŒåŒæ—¶
è¿˜å¯ä»¥å®ç°è¿è¡Œæ—¶é‡æ–°é…ç½®æ˜ å°„å…³ç³»ï¼Œæ ¹æ®ç”¨æˆ·å–œå¥½é‡æ–°è®¾ç½®è®¾å¤‡æŒ‰é”®çš„åŠŸèƒ½ï¼Œæˆ–è€…é€šè¿‡ä»£ç è§¦å‘ Actionï¼š

```py
var ev = InputEventAction.new()
# Set as move_left, pressed.
ev.action = "move_left"
ev.pressed = true
# Feedback.
Input.parse_input_event(ev)
```

ä»¥ä¸‹æ˜¯ä»£ç ç‰‡æ®µç”¨äºç®¡ç† Actionï¼Œåœ¨åœºæ™¯ä¸­æ·»åŠ å››ä¸ª Buttonï¼Œå°†èŠ‚ç‚¹åç§°æ”¹ä¸ºå¯¹åº”çš„ Actoin åç§°ï¼Œç‚¹å‡»
æŒ‰é”®æ—¶ï¼Œå°±è§¦å‘é‡æ–°æ˜ å°„ Actionï¼š

- ä½¿ç”¨ has_action() æ–¹æ³•æ£€æµ‹å·¥ç¨‹æ˜¯å¦é…ç½®äº†æŒ‡å®š Actionï¼›
- å¦‚æœæ²¡æœ‰å®šä¹‰æŒ‡å®šçš„ Actionï¼Œå°±è°ƒç”¨ add_action() æ·»åŠ åŠ¨ä½œå®šä¹‰ï¼›
- æ–°çš„ Action è¦å’Œä»»æ„çš„äº‹ä»¶å¯¹è±¡å»ºç«‹æ˜ å°„å…³ç³»ï¼Œä½¿ç”¨ action_add_event() æ–¹æ³•ï¼›
- å¦‚æœæ—§çš„æ˜ å°„å…³ç³»ä¸éœ€è¦ä¿ç•™ï¼Œè°ƒç”¨ action_erase_events() ç­‰æ–¹æ³•æ“¦é™¤ï¼›

æ ¹æ®é¡¹ç›® Input Map é…ç½®ä¸åŒï¼ŒæŒ‰é”®ä¼šæœ‰ä¸¤ç§æ‰«æç ï¼Œä¿å­˜åœ¨ InputEventKey çš„ä¸¤ä¸ªå±æ€§ä¸­ï¼Œå°†å…¶è½¬æ¢
ä¸ºå¯é˜…è¯»çš„å­—ç¬¦æ—¶ï¼Œéœ€è¦æŒ‰å¯¹ scancodeã€physical_scancode å±æ€§è¿›è¡Œç›¸åº”å¤„ç†ã€‚

```py
extends Node2D

onready var up: = $PanelContainer/GridContainer/move_up
onready var down: = $PanelContainer/GridContainer/move_down
onready var left: = $PanelContainer/GridContainer/move_left
onready var right: = $PanelContainer/GridContainer/move_right

var remap:Button = null
var actions:Array = ["move_up", "move_right", "move_down", "move_left"]

func get_key(event:InputEventKey):
    var key = OS.get_scancode_string(event.get_scancode_with_modifiers())
    var code = event.scancode | event.physical_scancode
    var fallback = OS.get_scancode_string(code)
    return key if key else fallback

func get_button_name(raw_name):
    var name = remap.name.split("_")[1]
    assert(name != null)
    return name.capitalize()

func reset_button():
    if remap != null:
        var event = InputMap.get_action_list(remap.name)[0] as InputEventKey
        remap.text = "%s(%s)" % [get_button_name(remap.name), get_key(event)]
        remap = null
    
func _ready():
    up.connect("pressed", self, "_on_pressed", [up])
    down.connect("pressed", self, "_on_pressed", [down])
    left.connect("pressed", self, "_on_pressed", [left])
    right.connect("pressed", self, "_on_pressed", [right])
    init_actions()

func init_actions():
    for act in actions:
        if not InputMap.has_action(act):
            InputMap.add_action(act)
    print_all_actions()
    print_action_events("move_up")

func print_all_actions():
    print("all actions has defined: ", InputMap.get_actions())

func print_action_events(action):
    print("events for %s:" % action, InputMap.get_action_list(action))

func _on_pressed(button:Button):
    reset_button()
    remap = button
    remap.text = "%s(%s)" % [get_button_name(remap.name), "..."]
    print(button)
    # set_process_unhandled_key_input(true)

func _unhandled_key_input(event):
    if event.scancode == KEY_ESCAPE:
        reset_button()
    
    if remap != null:
        var action = remap.name
        InputMap.action_erase_events(action)
        InputMap.action_add_event(action, event)
        remap.text = "%s(%s)" % [get_button_name(remap.name), get_key(event)]
        remap = null
    # set_process_unhandled_key_input(false)
```

è¾“å…¥æ˜ å°„å¯ä»¥é€šè¿‡ `ProjectSettings` ä¿å­˜åˆ°å·¥ç¨‹æ–‡ä»¶å†…ï¼Œæˆ–è€…é€šè¿‡ I/O å†™å…¥ç”¨æˆ·é…ç½®æ–‡ä»¶ï¼š

```C++,ignore
Error ProjectSettings::save() {
    Error error = save_custom(get_resource_path().plus_file("project.godot"));
    if (error == OK) {
        last_save_time = FileAccess::get_modified_time(get_resource_path().plus_file("project.godot"));
    }
    return error;
}
```

ä¸€èˆ¬çš„æ‰‹æŸ„è½´è¾“å…¥å¤„ç†ä¸é”®ç›˜æ¨¡æ‹Ÿæ‰‹æŸ„æ–¹å‘è½´è¾“å…¥ï¼š

```py
extends Node2D

onready var icon = $"."

var base = 60
var sprint = 0

func _input(event):
    if event.is_action_pressed("move_sprint"):
        sprint = base * 2
    else:
        sprint = 0

func _axis_simulate(delta):
    if Input.is_action_just_pressed("move_down"):
        print("move_down")
    
    # Simualte X axis by keyboard
    if Input.is_action_pressed("move_right"):
        icon.position.x += (base + sprint) * delta
    elif Input.is_action_pressed("move_left"):
        icon.position.x -= (base + sprint) * delta
    
    # Simualte Y axis by keyboard
    if Input.is_action_pressed("move_down"):
        icon.position.y += (base + sprint) * delta
    elif Input.is_action_pressed("move_up"):
        icon.position.y -= (base  + sprint) * delta

    var axis_x = int(Input.is_key_pressed(KEY_A)) - int(Input.is_key_pressed(KEY_D))
    var axis_z = int(Input.is_key_pressed(KEY_W)) - int(Input.is_key_pressed(KEY_S))
    var direction:Vector3 = Vector3(-axis_x, 0, -axis_z)

func _process(delta):
    #Input.get_action_strength("move_up")
    var axis_y = Input.get_axis("move_up", "move_down")
    var axis_x = Input.get_axis("move_left", "move_right")
    var velocity = Vector2(axis_x * (base + sprint), axis_y * (base + sprint))
    if Input.is_action_just_released("move_sprint"):
        print("speed [%d, %d] %s" % [axis_x, axis_y, velocity])
    # This is a shorthand for writing 
    # Input.get_action_strength("positive_action") - Input.get_action_strength("negative_action").
    icon.position += velocity * delta
```

é¡¹ç›®å¼€å‘ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šå°†è¾“å…¥äº‹ä»¶çš„å¤„ç†æµç¨‹æŠ½åƒä¸ºä¸€ä¸ª Player Controller å¯¹è±¡æ¥æ¥ç®¡ï¼Œæé«˜ä»£ç å¤ç”¨ã€‚
Godot æ–‡æ¡£å…³äºç©å®¶æ§åˆ¶å™¨è®¾è®¡çš„å†…å®¹å‡ ä¹æ²¡æœ‰ï¼Œåªæœ‰ä¸¤ä¸ªé¡µé¢æåˆ°äº†ä¸€ä¸‹ã€‚ä»¥ä¸‹ç¤ºæ„å‚è€ƒ UE4 çš„ç±»ç»“æ„ï¼š

                        +-------------+
                        |    Game     |
                        |  GameMode   |
                        |  GameState  |
                        +------^------+
                               |
         Contains:  +----------+-----------+           +---------------+
       +----------- |    PlayerController  |           |  AIController |
       |            +----------+-----------+           +-------+-------+
       |                       |                               |
       |    +---------+        | Possess  +---------+  Possess |
       +--> |   HUD   |        +--------> |   Pawn  | <--------+
       |    +---------+                   +---------+
       |    +---------+
       +--> |  Input  |
       |    +---------+
       |    +------------------------+
       +--> |  PlayerCameraManager   |
            +------------------------+

                    GamePlay Framework Class Relationships




## ğŸŸ¡ IO & Serialization åºåˆ—åŒ–ä¸å­˜æ¡£è¯»æ¡£
- [Input and Output (I/O)](https://docs.godotengine.org/en/3.6/tutorials/io/index.html)
- [File System](https://docs.godotengine.org/en/latest/tutorials/scripting/filesystem.html)
- [Resources](https://docs.godotengine.org/en/latest/tutorials/scripting/resources.html)
- [Background loading](https://docs.godotengine.org/en/latest/tutorials/io/background_loading.html)
- [Exporting packs, patches, and mods](https://docs.godotengine.org/en/latest/tutorials/export/exporting_pcks.html)

Godot ä½¿ç”¨ res:// å’Œ user:// ä¸¤ä¸ªæ–‡ä»¶è·¯å¾„åè®®ï¼Œå‰è€…è¡¨ç¤ºå·¥ç¨‹å†…éƒ¨èµ„æºè·¯å¾„ï¼Œåè€…è¡¨ç¤ºç”¨æˆ·æ“ä½œç³»ç»Ÿ
èµ„æºè·¯å¾„ã€‚æ¸¸æˆå­˜æ¡£ã€ç”¨æˆ·é…ç½®ç­‰å°±éœ€è¦ä½¿ç”¨åè€…ï¼Œå¯ä»¥ä½¿ç”¨ OS.get_executable_path() æä¾›çš„è·¯å¾„å°†ï¼Œ
ä¿å­˜æ•°æ®åˆ°ç›¸å¯¹äºä¸»ç¨‹åºçš„ç›®å½•ä¸­ã€‚

èµ„æºåŠ è½½æœ‰å¤šç§æ–¹å¼ï¼Œèµ„æºè·¯å¾„é™¤äº†ä»¥ä¸Šä¸¤ç§åè®®ï¼Œä¸èƒ½ä½¿ç”¨å…¶å®ƒæ–¹å¼ï¼Œä¸æ”¯æŒç›¸å¯¹è·¯ï¼Œå¦‚æœæ´»åŠ›åè®®ï¼ŒAPI ä¼š
è‡ªåŠ¨æ·»åŠ é»˜è®¤çš„ res:// åè®®ä¸ºè·¯å¾„å‰ç¼€ï¼š

```py
    # @GDscript global functions
    Resource load(path: String)
    Resource preload(path: String)

    # ResourceLoader singleton
    Resource load(path: String, type_hint: String = "", no_cache: bool = false)
    ResourceInteractiveLoader load_interactive(path: String, type_hint: String = "")
```

- `load()` å…¨å±€å‡½æ•°åŠ¨æ€åŠ è½½ path æŒ‡å®šèµ„æºï¼Œä¸ºäº†é¿å…é‡å¤æ‰§è¡ŒåŠ è½½ï¼Œå¯ä»¥å°†èµ„æºä¿å­˜åˆ°å˜é‡ä¸­ã€‚
- `preload` å…³é”®å­—æä¾›çš„è¿™ç§åŠ è½½æ–¹æ³•åªåœ¨è§£ææ—¶æ‰§è¡Œé¢„è½½ï¼Œpath æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚
- `ResourceLoader.load()` æ˜¯å…¨å±€ load() å‡½æ•°çš„å®Œæˆç‰ˆã€‚
- `ResourceInteractiveLoader` ä»¥äº¤äº’æ–¹å¼åŠ è½½èµ„æºï¼Œå…è®¸é«˜ç²’åº¦æ‰§è¡Œ chunks åŠ è½½è¿‡ç¨‹ï¼Œä¾æ¬¡è°ƒç”¨å…¶ poll() æ–¹æ³•ã€‚

æ³¨æ„ï¼Œpreload ä¸æ˜¯å‡½æ•°ï¼Œæ˜¯å…³é”®å­—ï¼Œåœ¨è§£æå™¨æä¾›çš„æ–¹æ³•ï¼Œload() æ˜¯å…¨å±€å‡½æ•°ï¼Œå®ƒä»¬çš„åŠŸèƒ½ä¸å¤ªä¸€æ ·ã€‚

å‰é¢ `load()` å’Œ `preload` ä¸¤ç§æ–¹æ³•éƒ½ä¼šé˜»å¡çº¿ç¨‹ï¼Œä¸ºäº†è§£å†³èµ„æºåŠ è½½æ—¶å‡ºç°å¡é¡¿é—®é¢˜æä¾›äº†äº¤äº’å¼
èµ„æºåŠ è½½å™¨ï¼Œè¿˜è¿‡åœ¨ Godot 4 ä¸­ç§»é™¤äº†ã€‚è¿˜å¯ä»¥ä½¿ç”¨ ResourcePreloader æŒ‰åˆ—è¡¨åŠ è½½èµ„æºï¼Œç”šè‡³æ˜¯ä½¿ç”¨
å¤šçº¿ç¨‹è¿›è¡Œèµ„æºåŠ è½½å¤„ç†ã€‚

- https://docs.godotengine.org/en/latest/_downloads/bc54982daa1be2e5b495d74f01a098f1/resource_queue.gd

Godot å¯¼å‡ºå·¥ç¨‹ä¼šå°†æ‰€æœ‰èµ„æºæ‰“åŒ…ç”Ÿæˆ .pck èµ„æºåŒ…æ–‡ä»¶ï¼Œç›¸æ¯” zipï¼Œéå‹ç¼©çš„è¿™ç§èµ„æºåŒ…ä¼˜ç‚¹å¦‚ä¸‹ï¼š

- incremental updates/patches
- offer DLCs
- offer mod support
- no source code disclosure needed for mods
- more modular project structure
- users don't have to replace the entire game

Downloadable Content (DLC) æ˜¯æ¸¸æˆæ›´æ–°çš„ä¸€ç§æ–¹æ³•ï¼Œpck èµ„æºåŒ…å°±å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ è½½ï¼š

```py
func _your_function():
    # This could fail if, for example, mod.pck cannot be found.
    var success = ProjectSettings.load_resource_pack("res://mod.pck")

    if success:
        # Now one can use the assets as if they had them in the project from the start.
        var imported_scene = load("res://mod_scene.tscn")
```

é»˜è®¤è®¾ç½®ä¸‹ï¼ŒDLC åŠ è½½ä¼šè¦†ç›–ç›¸åŒè·¯å¾„çš„åŸå·¥ç¨‹èµ„æºï¼Œå¯ä»¥åœ¨åŠ è½½èµ„æºåŒ…æ—¶ä¼ å…¥å‚æ•°é¿å…è¿™ç§è¦†ç›–è¡Œä¸ºã€‚

å¯¹äº C# å·¥ç¨‹ï¼Œéœ€è¦ç¼–è¯‘ç”Ÿæˆç¨‹åºé›†çš„ DLL å¹¶å…ˆæ”¾ç½®åˆ°å·¥ç¨‹ç›®å½•ä¸­ï¼Œåœ¨åŠ è½½èµ„æºåŒ…ä¹‹å‰åŠ è½½è¿™ä¸ªç¨‹åºé›†ï¼š

```C#
    Assembly.LoadFile("mod.dll")
```

å…¸å‹çš„ç³»ç»Ÿä¸­ç”¨æˆ·æ•°æ®é»˜è®¤è·¯å¾„ä½ç½®å¦‚ä¸‹ï¼š

|     Type     |                              Location                             |
|--------------|-------------------------------------------------------------------|
| Default      | Windows: %APPDATA%\Godot\app_userdata\[project]                   |
|              | macOS: ~/Library/Application Support/Godot/app_userdata/[project] |
|              | Linux: ~/.local/share/godot/app_userdata/[project]                |
|--------------|-------------------------------------------------------------------|
| Custom dir   | Windows: %APPDATA%\[project]                                      |
|              | macOS: ~/Library/Application Support/[project]                    |
|              | Linux: ~/.local/share/[project]                                   |
|--------------|-------------------------------------------------------------------|
| Custom       | Windows: %APPDATA%\[custom_user_dir_name]                         |
| dir and name | macOS: ~/Library/Application Support/[custom_user_dir_name]       |
|              | Linux: ~/.local/share/[custom_user_dir_name]                      |


ç¼–è¾‘å™¨ä½¿ç”¨çš„æ•°æ®è·¯å¾„ï¼š

|       Type      |                   Location                  |
|-----------------|---------------------------------------------|
| Editor data     | Windows: %APPDATA%\Godot\                   |
|                 | macOS: ~/Library/Application Support/Godot/ |
|                 | Linux: ~/.local/share/godot/                |
|-----------------|---------------------------------------------|
| Editor settings | Windows: %APPDATA%\Godot\                   |
|                 | macOS: ~/Library/Application Support/Godot/ |
|                 | Linux: ~/.config/godot/                     |
|-----------------|---------------------------------------------|
| Cache           | Windows: %TEMP%\Godot\                      |
|                 | macOS: ~/Library/Caches/Godot/              |
|                 | Linux: ~/.cache/godot/                      |

å­˜æ¡£é¦–å…ˆè¦è€ƒè™‘ä»€ä¹ˆæ•°æ®éœ€è¦ä¿å­˜ï¼ŒGodot æä¾›äº†åˆ†ç»„åŠŸèƒ½ï¼Œå¯ä»¥å°†éœ€è¦æŒä¹…åŒ–çš„èŠ‚ç‚¹å½’ç±»ã€‚æ¯”å¦‚ï¼ŒPersist
åˆ†ç»„ç”¨äºè¡¨ç¤ºéœ€è¦ä¿å­˜æ•°æ®çš„èŠ‚ç‚¹åˆ†ç±»ã€‚åœ¨ Godot Node -> Group é¢æ¿ä¸­ï¼Œæ·»åŠ è¿™ä¸ªåˆ†ç±»ï¼Œç„¶åå†æ‰“å¼€
Group Editor ç¼–è¾‘åˆ†ç»„ï¼Œå°†éœ€è¦æŒä¹…åŒ–çš„èŠ‚ç‚¹æ·»åŠ åˆ°æ­¤åˆ†ç»„ä¸­ï¼Œå†é…ç½®ä»¥ä¸‹ä»£ç ç‰ˆæœ¬è¿›è¡Œå¤„ç†ï¼š

```py
var save_nodes = get_tree().get_nodes_in_group("Persist")
for i in save_nodes:
    # Now, we can call our save function on each node.
```

åˆ†ç»„ç®¡ç†æœ‰ä¸¤ç§æ–¹å¼ï¼š

- During design, by using the Node dock in the editor.
- During execution, by calling **Node.add_to_group()** **Node.remove_from_group()**.


åˆ†ç»„åŠŸèƒ½è¿˜å¯ä»¥ç”¨äºæ‰¹é‡æ“ä½œï¼ŒSceneTree æä¾›ç›¸åº”çš„æ–¹æ³•ï¼š

```py
Variant call_group(group: String, method: String, ...) vararg

void notify_group(group: String, notification: int)
```

GDScript æä¾›äº† **to_json()** å’Œ  **parse_json()** ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† JSON æ•°æ®æ–‡ä»¶ï¼Œç”¨äºæ¸¸æˆ
æ•°æ®æŒä¹…åŒ–å¤„ç†éå¸¸æ–¹ä¾¿ã€‚æ‰€è°“åºåˆ—åŒ– Serialization å³å°†å†…å­˜ä¸­çš„æ•°æ®æŒ‰ä¸€å®šçš„æ ¼å¼æ•´ç†åä¿å­˜èµ·æ¥ï¼Œåç»­
å¯ä»¥é€†å‘å¤åŸæ¥æ•°æ®ï¼Œä½¿æ¸¸æˆçš„è¿è¡ŒçŠ¶æ€ä¸å­˜æ¡£æ—¶ä¸€æ ·ã€‚

æŒä¹…åŒ–æ•°æ®å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š

- è®¾è®¡ä¸€ä¸ª Dictionary å­—å…¸å¯¹è±¡ä½œä¿å­˜å¿…è¦çš„æ•°æ®ï¼Œä¾‹å¦‚çˆ¶èŠ‚ç‚¹è·¯å¾„ã€è‡ªèº«ç±»å‹æ•°æ®ç­‰ï¼›
- ä¸ºéœ€è¦æŒä¹…åŒ–çš„èŠ‚ç‚¹å®šä¹‰ save() æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—å…¸æ•°æ®å¯¹è±¡ï¼›
- åˆ›å»ºä¸€ä¸ª save_game() æ–¹æ³•ï¼ŒæŒ‰æŒä¹…åŒ–åˆ†ç»„ä¸­çš„èŠ‚ç‚¹ï¼Œè°ƒç”¨ save() æ–¹æ³•è·å–æ•°æ®ï¼›
- æ•°æ®ä½¿ç”¨ **to_json()** æ ¼å¼åŒ–ç„¶é€šè¿‡ File å¯¹è±¡ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä¸ºäº†ç®€åŒ–å¯ä»¥é€è¡Œä¿å­˜ï¼›

é€†å‘å¤„ç†æ¢å¤å­˜æ¡£æ­¥éª¤å¦‚ï¼š

- å…ˆè¯»å–æ–‡ä»¶ï¼Œç¡®ä¿æ•°æ®æ–‡ä»¶æ­£å¸¸ã€å¯ç”¨ï¼›
- ä¸ºäº†ç®€åŒ–ï¼Œå…ˆå¤„ç†æ‰è¢«æ ‡è®°ä¸ºæŒä¹…åŒ–åˆ†ç»„çš„èŠ‚ç‚¹ï¼›
- é€è¡Œè¯»å…¥æ•°æ®ï¼Œ**parse_json()** è¿˜åŸå‡ºæ•°æ®å­—å…¸ï¼›
- æ ¹æ®æ•°æ®åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œå°†å„ç§å±æ€§æ•°æ®æ¢å¤åˆ°æ–°èŠ‚ç‚¹ï¼Œå†æ·»åŠ åˆ°èŠ‚ç‚¹æ ‘å¯¹åº”çš„çˆ¶èŠ‚ç‚¹ä¸‹ï¼›

æ›´é«˜æ•ˆçš„æŒä¹…åŒ–ä½¿ç”¨äºŒè¿›åˆ¶ï¼ŒFile æä¾›äº† **get_var** å’Œ **store_var** æ–¹æ³•æ¥æ–¹å—å­—å˜ä½“ç±»å‹æ•°æ®ã€‚
è¿˜æœ‰æ•°æ®æ‰“åŒ…å·¥å…· PacketPeerï¼Œè¿™ç§æ–¹å¼ä¸åœ¨äºŒè¿›åˆ¶åœºæ™¯ã€èµ„æºæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚

Godot æä¾›äº† File å’Œ Directory å¯¹è±¡å¤„ç†æ–‡ä»¶è¯»å†™ï¼Œå¯ä»¥é€šè¿‡å®ƒä»¬æ¥åˆ›å»ºã€åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ï¼Œä»¥ä¸‹ç®€å•åœ°
æ¼”ç¤ºå¦‚ä½•å°†èŠ‚ç‚¹æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶ï¼Œä»¥åŠè¯»å–åå†æ¢å¤åˆ°èŠ‚ç‚¹ä¸Šï¼š

```py
var path = "user://save_game.json"

func _ready():
    save_button.connect("pressed", self, "save_game")
    load_button.connect("pressed", self, "load_game")


func save_game():
    # game state data
    var content = []
    for node in get_tree().get_nodes_in_group("Persist"):
        if node.get('text') == null:
            print("Node has no data, ignore it: ", node)
            continue
        var item = {
            path = $bg/note.get_path(),
            text = $bg/note.text
            }
        content.append(item)
    var file = File.new()
    var err = file.open(path, File.WRITE)
    if err:
        $bg/note.text = "Fail to open file: " + path
    file.store_string(to_json(content))
    file.close()
    $bg/note.text = "Save game to file:" + path

func load_game():
    var file = File.new()
    file.open(path, File.READ)
    var content = file.get_as_text()
    file.close()
    for variant in parse_json(content):
        print("load: ", variant)
        get_node(variant.path).text = variant.text
    return content

```

Godot 4.x æ–‡ä»¶åŠç›®å½• API æ”¹å†™ä¸º FileAccess å’Œ DirAccessï¼ŒåŒæ—¶ä¹Ÿå–æ¶ˆäº† close() æ–¹æ³•ï¼Œåœ¨
è¶…å‡ºä½œç”¨åŸŸã€é€šè¿‡èµ‹å€¼ null é‡Šæ”¾æ–‡ä»¶å¼•ç”¨æ—¶ï¼ŒFileAccess ä¼šè‡ªåŠ¨å…³é—­æ–‡ä»¶ï¼Œè€Œåœ¨ C# ä¸­å¿…éœ€ disposedã€‚

```py
# Godot 3.x
    var path = "user://path/to/save.json"
    var file = File.new()
    var dir = Directory.new()
    if not file.file_exists(path):
        dir.make_dir_recursive(path)
        dir.remove(path)
        var json: String = to_json({NodePath=self.get_path()})
        var err = file.open(path, File.WRITE)
        if err != OK:
            return print("fail to write file: ", path)
        file.store_string(json)
        print("json save to file: ", path)
    else:
        file.open(path, File.READ)
        var json = file.get_as_text()
        var variant = parse_json(json)
        print("json read from file: ", path, "\n", variant)
    file.close()

# Godot 4.x
    path = "user://path/to/save.json"
    if not FileAccess.file_exists(path):
        DirAccess.make_dir_recursive_absolute(path)
        DirAccess.remove_absolute(path)
        var json: String = var_to_str({NodePath=self.get_path()})
        var file = FileAccess.open(path, FileAccess.WRITE)
        if FileAccess.get_open_error() != OK:
            return print("fail to write file: ", path)
        file.store_string(json)
        file = null
        print("json save to file: ", path)
    else:
        var file = FileAccess.open(path, FileAccess.READ)
        var json = file.get_as_text()
        var variant = str_to_var(json)
        print("json read from file: ", path, "\n", variant)
        file = null # File is closed. not file.close()
```

å¦å¤–ï¼ŒString ç±»å‹æä¾›äº†å‡ ä¸ªæ–¹æ³•ç”¨äºå¤„ç†æ–‡ä»¶ç›¸å…³çš„å­—ç¬¦ä¸²ï¼š

- get_base_dir()
- get_basename()
- get_extension()
- get_file()
- plus_file(file: String)

```py
print("/path/to/file.txt".get_extension())  # "txt"
print("file.txt".get_extension())  # "txt"
print("file.sample.txt".get_extension())  # "txt"
print(".txt".get_extension())  # "txt"
print("file.txt.".get_extension())  # "" (empty string)
print("file.txt..".get_extension())  # "" (empty string)
print("txt".get_extension())  # "" (empty string)
print("".get_extension())  # "" (empty string)
```


## ğŸŸ¡ Audio Stream å£°é¢‘æµå¤„ç†
- [Audio Generator Demo](https://godotengine.org/asset-library/asset/526)
- [Audio Mic Record Demo](https://godotengine.org/asset-library/asset/527)
- [Audio Spectrum](https://godotengine.org/asset-library/asset/528)
- [Audio Device Changer Demo](https://godotengine.org/asset-library/asset/525)
- [Godot 3.2 will get new audio features](https://godotengine.org/article/godot-32-will-get-new-audio-features/)
- [Importing audio samples](https://docs.godotengine.org/en/3.5/tutorials/assets_pipeline/importing_audio_samples.html)
- [Audio Buses](https://docs.godotengine.org/en/3.5/tutorials/audio/audio_buses.html)
- [Audio Stream](https://docs.godotengine.org/en/3.5/tutorials/audio/audio_streams.html)
- [Sync the gameplay with audio and music](https://docs.godotengine.org/en/3.5/tutorials/audio/sync_with_audio.html)
- [Recording with microphone](https://docs.godotengine.org/en/3.5/tutorials/audio/recording_with_microphone.html)

|           Godot 3.5            |            Godot 4.x             |
|--------------------------------|----------------------------------|
| AudioServer                    | AudioServer                      |
| AudioBusLayout                 | AudioBusLayout                   |
| AudioStream                    | AudioStream                      |
| - AudioStreamGenerator         | - AudioStreamGenerator           |
| - AudioStreamMP3               | - AudioStreamMP3                 |
| - AudioStreamMicrophone        | - AudioStreamMicrophone          |
| - AudicStreamOGGVorbis         | - AudicStreamOggVorbis           |
| - AudioStreamRandomPitch       | - AudioStreamRandomizer          |
| - AudioStreamSample            | - AudioStreamPolyphonic          |
| -                              | - AudioStreamWAV                 |
| AudioStreamPlayback            | AudioStreamPlayback              |
| - AudioStreamPlaybackResampled | - AudioStreamPlaybackResampled   |
| -                              | --- AudioStreamGeneratorPlayback |
| -                              | --- AudioStreamPlaybackOggVorbis |
| - AudioStreamGeneratorPlayback | - AudioStreamGeneratorPlayback   |
| AudioStreamPlayer              | AudioStreamPlayer                |
| AudioStreamPlayer2D            | AudioStreamPlayer2D              |
| AudioStreamPlayer3D            | AudioStreamPlayer3D              |
| -                              | AudioListener2D                  |
| -                              | AudioListener3D                  |

![AudioBuses](https://docs.godotengine.org/en/3.5/_images/audio_stream_reverb_bus2.png)

å£°æ•ˆç±»å‹è¾ƒå¤šå¦å¤–å±•ç¤ºï¼Œå¹¶ä¸”å‡çº§åæ•ˆæœç±»å‹æ²¡æœ‰å˜åŒ–ï¼š

- AudioEffect
- - AudioEffectAmplify
- - AudioEffectCapture
- - AudioEffectChorus
- - AudioEffectCompressor
- - AudioEffectDelay
- - AudioEffectDistortion
- - AudioEffectEQ
- --- AudioEffectEQ10
- --- AudioEffectEQ21
- --- AudioEffectEQ6
- - AudioEffectFilter
- --- AudioEffectBandLimitFilter
- --- AudioEffectBandPassFilter
- --- AudioEffectHighPassFilter
- --- AudioEffectHighShelfFilter
- --- AudioEffectLowPassFilter
- --- AudioEffectLowShelfFilter
- --- AudioEffectNotchFilter
- - AudioEffectLimiter
- - AudioEffectPanner
- - AudioEffectPhaser
- - AudioEffectPitchShift
- - AudioEffectRecord
- - AudioEffectReverb
- - AudioEffectSpectrumAnalyzer
- - AudioEffectStereoEnhance
- AudioEffectInstance
- - AudioEffectSpectrumAnalyzerInstance

ä¸€ä¸ªåªæœ‰åŸºæœ¬åŠŸèƒ½çš„ MP3 æ’­æ”¾å™¨ï¼š

```py
extends AudioStreamPlayer

var position = 0.0

func _ready():
    stream: AudioStreamMP3 = preload("res://some.mp3")

func _input(event):
    if not event is InputEventKey:
        return
    
    match [event.keycode, event.is_pressed(), event.ctrl_pressed, is_playing()]:
        [KEY_SPACE, true, _, true]:
            position = get_playback_position()
            stop()
            #set_stream_paused(true)
        [KEY_SPACE, true, _, false]:
            play(position)
            #set_stream_paused(false)
        [KEY_ESCAPE, true, _, _ ]:
            position = 0.0
            stop()
        [KEY_LEFT,  true, _, true ]:
            play(get_playback_position() + -5)
        [KEY_RIGHT, true, _, true ]:
            play(get_playback_position() + 5)
        [KEY_DOWN,  true, false, true]:
            set_volume_db(get_volume_db() + -1.0)
        [KEY_UP,    true, false, true]:
            set_volume_db(get_volume_db() + 1.0)
        [KEY_DOWN,  true, true, true]:
            set_pitch_scale(get_pitch_scale() + -0.01)
        [KEY_UP,    true, true, true]:
            set_pitch_scale(get_pitch_scale() + 0.01)
```











## ğŸŸ¡ UI ç”¨æˆ·ç•Œé¢
- [User Interface(UI)](https://docs.godotengine.org/en/3.5/tutorials/ui/index.html)
- [BBCode in RichTextLabel](https://docs.godotengine.org/en/3.5/tutorials/ui/bbcode_in_richtextlabel.html)
- [Using Containers](https://docs.godotengine.org/en/3.5/tutorials/ui/gui_containers.html)
- [Introduction to GUI skinning](https://docs.godotengine.org/en/3.5/tutorials/ui/gui_skinning.html)
- [Bitmap Font Generator](https://www.angelcode.com/products/bmfont/)

3D è§†å›¾å¿«æ·é”®ï¼š

-  To snap to grid, press `Ctrl` while moving, scaling or rotating.
-  Focus selected object, press `F`.
-  Focus origin, press `O`.
-  Toggle local or global space, press `T`.
-  `Q` Select mode.
-  `W` Move mode.
-  `E` Scale mode.
-  `R` Rotate mode.
-  `Ctrl-Alt-M` Align transform with view.
-  `Ctrl-Alt-F` Align rotation with view.
-  `Shift-F` Toggle free look.`Alt` speed slow. `Ctrl` speed up. Right click escape.
    -  `W` Free look forwards
    -  `S` Free look backwards
    -  `A` Free look left
    -  `D` Free look right
    -  `Q` Free look up
-  `Ctrl-UP` `Ctrl-Down` è°ƒæ•´èŠ‚ç‚¹åœ¨åœºæ™¯æ ‘çš„ä½ç½®ã€‚
-  `Ctrl-UP` `Ctrl-Down` è°ƒæ•´èŠ‚ç‚¹åœ¨åœºæ™¯æ ‘çš„ä½ç½®ã€‚

Godot 4 å¯ä»¥åƒ Blender é‚£æ ·é€šè¿‡å¿«æ·é”®æ‰§è¡Œå¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬æ“ä½œï¼Œç¼–è¾‘å™¨é…ç½®**Spatial Editor**
æœç´¢ Begin å…³é”®å­—ï¼Œå³å¯ä»¥å‡ºæ¥ä»¥ä¸‹ä¸‰é¡¹æ“ä½œï¼Œå¹¶ä¸”åç»­æŒ‰ç›¸å°±é”®å¯ä»¥é”å®š Xã€Yã€Z è½´ï¼Œåªæ˜¯ä¸èƒ½è¾“å…¥æ•°å€¼ï¼š

-  Begin Move Transformationï¼Œè®¾ç½®å’Œ Blender ä¸€æ · `G`ï¼›
-  Begin Scale Transformationï¼Œè®¾ç½®å’Œ Blender ä¸€æ · `S`ï¼›
-  Begin Roation Transformationï¼Œè®¾ç½®å’Œ Blender ä¸€æ · `R`ï¼›






å®˜æ–¹æä¾›äº†ä¸€ä¸ª Control Gallery ç¤ºèŒƒå·¥ç¨‹ï¼Œç”¨äºæ¼”ç¤ºå„ç§æ§ä»¶ã€å¸ƒå±€å®¹å™¨çš„ä½¿ç”¨ï¼Œ2D æ§ä»¶æ”¯æŒä¸»é¢˜è®¾ç½®ï¼Œ
å®šåˆ¶æ§ä»¶å¤–è§‚éå¸¸æ–¹ä¾¿ã€‚2D å¯¹è±¡ä½¿ç”¨ Anchors æ¨¡å‹è¿›è¡Œå›¾å½¢çš„æ¯”ä¾‹ã€å¤šåˆ†è¾¨ç‡å¤„ç†ï¼š

![Size and Anchors](https://docs.godotengine.org/en/3.5/_images/anchors.png)

ç°ä»£çš„å±å¹•å°ºå¯¸å¤šå˜ï¼Œå¦‚ä½•è§£å†³åœ¨ä¸åŒå°ºå¯¸ä¸‹å›¾åƒå¸ƒå±€ä¿æŒä¸å˜ï¼Ÿæœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå±å¹•åˆ†è¾¨ç‡æ”¹å˜ï¼Œ
æ§ä»¶éœ€è¦é‡æ–°å®šä½ã€‚æœ‰äº›äººéœ€è¦è·Ÿéšå±å¹•åº•éƒ¨ï¼Œå…¶ä»–äººåˆ™éœ€è¦è·Ÿéšå±å¹•é¡¶éƒ¨ï¼Œæˆ–è€…å¯èƒ½æ˜¯å·¦å³è¾¹è·ã€‚

é€šè¿‡ç¼–è¾‘æ§ä»¶çš„ Margin è¾¹è·å±æ€§æ¥è®¾ç½®ï¼Œæ¯ä¸ªæ§ä»¶æœ‰å››ä¸ªè¾¹è·è®¾ç½®ï¼šå·¦ã€å³ã€ä¸‹å’Œä¸Šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½è¡¨ç¤º
ç›¸å¯¹äºçˆ¶æ§ä»¶å·¦ä¸Šè§’çš„è·ç¦»ï¼Œä»¥åƒç´ ä¸ºå•ä½ï¼Œå¦‚æœæ²¡æœ‰çˆ¶æ§ä»¶å°±ç›¸å¯¹äºè§†å£ã€‚

é”šç‚¹ Anchors ä¹Ÿæ˜¯å››ä¸ªå€¼ï¼Œæ˜¯ç™¾åˆ†æ¯”ï¼Œå¹¶ä¸” Left å°äº Rightï¼ŒTop å°äº Bottomï¼Œå½“å€¼å…¨éƒ¨ä¸º 0 è¡¨ç¤º
å’Œçˆ¶èŠ‚ç‚¹çš„å·¦ä¸Šè§’ä¸ºé”šå®šä½ï¼Œå…¨è®¾ç½®ä¸º 1 è¡¨ç¤ºé”šå®šçˆ¶èŠ‚ç‚¹çš„å³ä¸‹è§’ï¼Œä¸ä¼šå½±å“èŠ‚ç‚¹å°ºå¯¸ã€‚

å½“ Left/Top ä¸º 0ï¼ŒBottom/Right ä¸º 1ï¼Œåˆ™è¡¨ç¤ºé”šå®šæ•´ä¸ªçˆ¶èŠ‚ç‚¹ç©ºé—´ã€‚å‡è®¾çˆ¶èŠ‚ç‚¹å°ºå¯¸ 100x100ï¼Œé€šè¿‡
Margin(0, 0, 100, 100) è®¾ç½®ï¼Œå­èŠ‚ç‚¹åŒæ ·è®¾ç½®ä¸º 100x100 å´ä¼šæœ‰åŠ å€çš„å°ºå¯¸ã€‚å› ä¸ºï¼ŒMargin å››ä¸ªå€¼
å¯¹åº”çš„æ˜¯çˆ¶èŠ‚ç‚¹çš„æ•´ä¸ªåŒºåŸŸï¼Œè¾¹è· Right é”šå®šçˆ¶èŠ‚ç‚¹çš„å³ä¾§ï¼Œè¾¹è· Left é”šå®šçˆ¶èŠ‚ç‚¹çš„å·¦ä¾§ï¼Œä¾æ­¤è§£æï¼Œå­
èŠ‚ç‚¹å°±ä¼šä¼¸å‡ºçˆ¶èŠ‚ç‚¹åŒºåŸŸä¸‹ä¾§ã€å³ä¾§å„ 100 åƒç´ çš„ç©ºé—´ï¼Œè¾¹é•¿åŠ å€ã€‚

å±æ€§é¢æ¿ä¸Šåªèƒ½è®¾ç½® Anchors çš„å€¼ä¸º [0, 1] åŒºé—´ï¼Œé€šè¿‡ Layout Presets å¯ä»¥ä¿®æ”¹ï¼Œç‚¹å‡»èˆ¹é”šå›¾æ ‡
å¯ä»¥æ¿€æ´»æ‹–åŠ¨èŠ‚ç‚¹æ—¶ç›´æ¥ä¿®æ”¹é”šç‚¹ä½ç½®ã€‚

Godot 3.x å‡çº§åˆ° 4.x åï¼ŒAnchor & Margin ä¸¤ä¸ªå±æ€§åˆå¹¶ï¼Œå¹¶ä½¿ç”¨ Anchors Preset é¢„é…ç½®æ›¿ä»£ã€‚

æ§ä»¶å¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸»é¢˜ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸»é¢˜è¦†ç›–è®¾ç½®ä¸­è¿›è¡Œä¿®æ­£ã€‚ä¸»é¢˜ä¸»è¦ä¿å­˜ 5 ç±»æ•°æ®ï¼š

- Colors é¢œè‰²ï¼Œä¸»è¦ç”¨äºèƒŒæ™¯ã€å­—ä½“é¢œè‰²ï¼Œä»¥åŠ modulation ç”¨äºè°ƒåˆ¶æ§ä»¶é¢œè‰²ã€‚
- Constants æ•´æ•°å¸¸é‡ï¼Œç”¨äºæ§ä»¶çš„æ•°å€¼æˆ– boolean flags å±æ€§ï¼Œå¦‚ BoxContainer çš„é—´éš”ã€‚
- Fonts å­—ä½“ï¼ŒGodot é»˜è®¤å­—ä½“ä¸æ”¯æŒä¸­æ–‡ï¼Œæ˜¾ç¤ºä¸­æ–‡éœ€è¦å¯¼å…¥ä¸­æ–‡å­—ä½“ã€‚
- Icon å›¾æ ‡ï¼Œçº¹ç†å›¾åƒï¼Œç”¨ä½œæŒ‰é’®æ§ä»¶çš„å›¾æ ‡ç­‰ç­‰ï¼›
- Styleboxs æ ·å¼ç›’ï¼ŒåŒ…å«ä¸€ç»„é…ç½®é¡¹ç”¨äºæ§ä»¶å¹³é¢çš„ç»˜å›¾ï¼Œä¸é™ç”¨äº Panel æ§ä»¶ï¼›

Godot æ”¯æŒ BitmapFont, DynamicFont ä¸¤ç±»å­—ä½“ï¼Œåˆ†åˆ«å¯¹åº”å­—ä½“çº¹ç†å’ŒçŸ¢é‡å­—ä½“ï¼ŒçŸ¢é‡å­—ä½“æ¸²æŸ“ä½¿ç”¨é€šè¿‡
FreeType library å®ç°ï¼Œæ”¯æŒå¸¸ç”¨æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼š

- TrueType (.ttf)
- OpenType (.otf)
- Web Open Font Format 1 (.woff)
- and Web Open Font Format 2 (.woff2)

BitmapFont åˆ™æ˜¯æŒ‰ BMFont æ ¼å¼æ¸²æŸ“å­—ä½“çº¹ç†ï¼Œä½å›¾å­—ä½“ä¹Ÿå°±æ˜¯ç”¨å›¾åƒä¿å­˜æ–‡å­—å›¾å½¢ï¼Œé€šå¸¸å°†æ–‡å­—ä¸€ä¸ªæ¥ä¸€ä¸ª
ç´§å¯†æ’åˆ—åœ¨ä¸€èµ·ï¼Œæ¸²æŸ“æ–‡å­—æ—¶å°±æŒ‰å¯¹åº”åæ ‡è¾“å‡ºå…¶ä¸­çš„å›¾æ¡ˆã€‚ä½¿ç”¨ Bitmap Font Generator å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿
åœ°ä»ç°æœ‰çŸ¢é‡å­—ä½“æ–‡ä»¶ä¸­å¯¼å‡ºä½å›¾å­—ä½“ï¼Œä½¿ç”¨ Edit -> Select characters from text file å¯ä»¥é€‰æ‹©
æ–‡ä»¶å†…å®¹ä¸­ç”¨åˆ°çš„å­—ç¬¦ï¼Œæ–‡ä»¶ç¼–ç æ”¯æŒ UTF16ï¼Œä½¿ç”¨ UTF8 ä¼¼ä¹æœ‰å…¼å®¹é—®é¢˜ã€‚å¯¼å‡ºå›¾ç‰‡æ—¶é…ç½®ä¸º 32-bit é¢œè‰²
æ·±åº¦ä»¥ä¿è¯ Alpha é€šé“ç”Ÿæ•ˆï¼Œå¦‚æœä½¿ç”¨ 8-bit å°è¯•å¯èƒ½å¯¼è‡´å­—ä½“ç¬¦å·é€æ˜åŒºä¸èƒ½æ­£ç¡®å¤„ç†ã€‚


Godot ç›®å‰æä¾›çš„å››ç§æ ·å¼ç›’å¯ä»¥ç»™æ§ä»¶è®¾ç½®ä¸åŒçš„å¤–è§‚å±æ€§ï¼š

- **StyleBoxEmpty** ç©ºç›’ï¼Œåªç®€å•ç»§æ‰¿ StyleBox æä¾›çš„è¾¹è·å±æ€§ï¼›
- **StyleBoxLine** é™¤äº†è¾¹è·å±æ€§å¤–ï¼Œç»™æ§ä»¶å¢åŠ ä¸€æ¡çº¿ï¼Œå¯ä»¥è®¾ç½®çº¿å®½ã€é¢œè‰²ã€ä½ç½®ç­‰ç­‰ï¼›
- **StyleBoxFlat** é™¤äº†è¾¹è·å±æ€§å¤–ï¼Œå¢åŠ äº†èƒŒæ™¯å¡«å……ã€Skew åˆ‡å˜ã€è¾¹æ¡†ã€åœ†è§’ã€é˜´å½±ç­‰ç­‰ï¼›
- **StyleBoxTexture** çº¹ç†æ ·å¼ç›’ï¼Œå¯ä»¥ç»™æ§åˆ¶è®¾ç½®çº¹ç†å’Œ Normal Mapï¼Œä»¥åŠè¾¹è·æ‰©å±•ç­‰ç­‰ï¼›

Godot ç»™çº¹ç†æ ·å¼å›¾ç‰‡æä¾›äº† 9 å®«æ ¼åŠŸèƒ½ï¼ŒTextureRegionï¼Œå³é€šè¿‡ä¸€ä¸ªçŸ©å½¢åŒºå°†çº¹ç†æŒ‰å››è¾¹åˆ†å‰²ä¸º 9 å—ï¼Œ
é™¤äº†å››ä¸ªè¾¹è§’çš„éƒ¨åˆ†ä¸ç¼©æ”¾ï¼Œå±…ä¸­çš„è¿™å—ï¼Œå’Œä¸Šä¸‹å·¦å³ 4 å—å¯ä»¥è‡ªç”±ç»½æ”¾ä»¥åŒ¹é…ä¸åŒå¤§å°çš„å†…å®¹ã€‚æ³¨æ„ï¼Œ6 ä¸ª
æ§åˆ¶ç‚¹ä¸ 4 æ¡çº¿ä¹‹é—´çš„å†…å®¹ä½œä¸ºå‘¨è¾¹å®«æ ¼æ˜¾ç¤ºçš„å›¾åƒã€‚å¯å°†é¡¹ç›®è®¾ç½® Ninepatch Mode é»˜è®¤çš„ Scaling 
é…ç½®æ”¹ä¸º Fixed æ¨¡å¼ï¼Œä»¥å…è¾¹æ¡†éƒ¨åˆ†è¢«ç¼©æ”¾å¯¼è‡´å˜å½¢ã€‚

Godot 4.x ç‰ˆæœ¬ä¸­ï¼ŒNinepatch Mode é…ç½®å·²ç»ç§»é™¤ï¼Œä¹å®«æ ¼é¢æ¿ä¹Ÿæ”¹ä¸º Sub-Regon -> Edit Regionã€‚



é€šå¸¸ï¼Œä¸»é¢˜æ•°æ®ä»¥æ§ä»¶åè¿›è¡Œåˆ†ç±»ï¼ŒManager Theme Item ä¸»é¢˜æ¡ç›®ç®¡ç†å™¨ä¸­å¯æŸ¥çœ‹ã€ç¼–è¾‘ï¼Œæˆ–åˆ›å»ºç±»å‹å˜ä½“ã€‚
ä¾‹å¦‚ï¼Œä¸€ä¸ª font_color é¢œè‰²ï¼Œå¯èƒ½æœ‰ Label ç±»å‹ï¼Œä¹Ÿå¯èƒ½æœ‰ RichTextLabel ç±»å‹ï¼Œå½±å“ä¸åŒçš„æ§ä»¶ã€‚
ä¸»é¢˜æ˜¯ä¸€ç§èµ„æºï¼Œåˆ›å»ºæ—¶ä» FileSystem é¢æ¿çš„å³é”®èœå•ä¸­é€‰æ‹© New Resource ... å¹¶ä¸”é€‰æ‹© Theme ç±»å‹ã€‚
åˆ›å»ºå¥½çš„ä¸»é¢˜å¯ä»¥ç›´æ¥ä» FileSystem ä¸­æ‹–æ”¾åˆ°æ§ä»¶å±æ€§é¢æ¿ä¸­çš„ Theme å±æ€§ä¸Šï¼Œæˆ–æ‹–æ”¾åˆ°åœºæ™¯æ ‘çš„èŠ‚ç‚¹ä¸Šã€‚
åŒå‡»æ‰“å¼€ä¸»é¢˜èµ„æºï¼Œåœ¨é»˜è®¤çš„ä¸»é¢˜é¢„è§ˆé¢æ¿ä¸­å¯ä»¥çœ‹åˆ°å„ç§æ§ä»¶çš„å¤–è§‚ï¼Œæˆ–è€…ç‚¹å‡» Add Preview æ·»åŠ è¦é¢„è§ˆ
çš„åœºæ™¯ã€‚ç‚¹å‡»ä¸»é¢˜ç¼–è¾‘å™¨å³ä¸Šè§’çš„ Manage Items... æ‰“å¼€ä¸»é¢˜æ•°æ®ç®¡ç†å™¨ï¼Œå°†éœ€è¦çš„ä½¿ç”¨çš„æ•°æ®å¯¼å…¥ï¼Œæˆ–è€…
ä½¿ç”¨å¸ç®¡åœ¨ Default Preview è§†å›¾ä¸­å¸å–å±•ç¤ºçš„æ§ä»¶ã€‚

æœ‰æ—¶æ§ä»¶éœ€è¦ä¸ä¸»é¢˜å®šä¹‰çš„å¤–è§‚æœ‰æ‰€å·®å¼‚ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸»é¢˜æ•°æ®ç±»å‹å˜ä½“ï¼ŒTheme type variationsã€‚
æ¯ä¸ªæ§ä»¶èŠ‚ç‚¹éƒ½æœ‰ä¸»é¢˜å±æ€§é‡å†™ Theme Overridesï¼Œå…è®¸é‡æ–°å®šä¹‰æ¯ä¸ª UI å…ƒç´ çš„æ ·å¼ã€‚ä½†åœ¨æ§ä»¶æ•°é‡å¾ˆå¤š
çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸»é¢˜ç±»å‹å˜ä½“ï¼Œåˆ™æ˜¯æ›´çµæ´»çš„æ–¹æ³•ã€‚å˜ä½“éœ€è¦æ‰©å±•äº†å¦ä¸€ç§åŸºæœ¬ç±»å‹ï¼Œæ›¿æ¢åŸºæœ¬ç±»å‹çš„æŸäº›è®¾ç½®ï¼Œ
ä½†åˆä¿ç•™å…¶ä»–æ–¹é¢ä¸å˜ï¼Œå˜ä½“è¿˜å¯ä»¥å®šä¹‰åŸºç¡€æ ·å¼å°šæœªå®šä¹‰çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª GrayButton å˜ä½“ä»¥è¦†ç›–
åŸºæœ¬çš„ Button å¸¸è§„æ ·å¼ï¼Œå¹¶æ·»åŠ  Button ä»æœªå®šä¹‰çš„ font_colorã€‚

ä¾‹å¦‚ï¼Œä¸º Label åˆ›å»ºä¸€ä¸ªä¸»é¢˜å˜ä½“ï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š

- åŒå‡»ä¸»é¢˜æ–‡ä»¶æ‰“å¼€ä¸»é¢˜ç¼–è¾‘å™¨ï¼›
- ç‚¹å‡»é¢æ¿çš„ Type åˆ—è¡¨å³ä¾§çš„ + å·ä»¥æ‰“å¼€ Add Item Typeï¼Œè¾“å…¥ä¸€ä¸ªæ–°åç§°ï¼Œå¦‚ MyLabel ä½œä¸ºç±»å‹å˜ä½“ï¼›
- ç‚¹å‡»æ ‡ç­¾æ å³ä¾§çš„å·¥å…·å›¾æ ‡ï¼Œåœ¨ Base Type ä¸­å¡«å†™ Labelï¼Œæˆ–è€…ç‚¹å‡»å³ä¾§ + å·æŒ‘é€‰ä¸€ä¸ªåŸºç¡€ç±»å‹ï¼›

é€šè¿‡ä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤å°±åˆ›å»ºäº†æ–°çš„ä¸»é¢˜ç±»å‹å˜ä½“ï¼Œæ§ä»¶ä½¿ç”¨å˜ä½“åªéœ€åœ¨ Theme Type Variation å±æ€§ä¸­æŒ‡å®šã€‚
ä¸€ä¸ªæ–°åˆ›å»ºçš„å˜ä½“é€šå¸¸æ²¡æœ‰æ–°æ•°æ®ï¼Œæ‰“å¼€ Show Default å¼€å…³ï¼Œå¯ä»¥æ˜¾ç¤ºå·²ç»ç»§æ‰¿çš„æ•°æ®ã€‚


2D ç•Œé¢å…ƒç´ å¯ä»¥ä½¿ç”¨å¸ƒå±€å®¹å™¨è¿›è¡Œæ’ç‰ˆï¼ŒGodot æä¾›ä»¥ä¸‹å¸ƒå±€å®¹å™¨ï¼š

- AspectRatioContainer å›¾å½¢æ¯”ä¾‹ä¿æŒå¸ƒå±€ï¼›
- BoxContainer > HBoxContainer and VBoxContainer ç”¨äºçºµæ¨ªæ’åˆ—å¸ƒå±€ï¼›
- CenterContainer å±…ä¸­å¸ƒå±€ï¼›
- EditorProperty å±æ€§å®¹å™¨ï¼Œç”¨äºç»™å±æ€§æ¢æµ‹å™¨ EditorInspector ä¸­æ·»åŠ å†…å®¹ï¼›
- FlowContainer > HFlowContainer and VFlowContainer æµå¼å¸ƒå±€ï¼ŒèŠ‚ç‚¹å‰åç´§å¯†ç›¸è¿ã€‚
- GraphNode åŒ…å«å¤šä¸ªè¾“å…¥ã€è¾“å‡ºæ’æ§½ï¼Œç”¨äºè¿æ¥å…¶å®ƒçš„ GraphNodeï¼ŒGodot èŠ‚ç‚¹ç¼–ç¨‹ä¸­æœ‰ä½¿ç”¨ï¼›
- GridContainer å¤šè¡Œã€å¤šåˆ—å¸ƒå±€ï¼›
- MarginContainer å¯è°ƒæ•´è¾¹è·ï¼›
- PanelContainer é¢æ¿å¸ƒå±€ï¼›
- ScrollContainer å†…å®¹å¯æ»šåŠ¨å¸ƒå±€ï¼›
- SplitContainer > HSplitContainer and VSplitContainer å¯æ´»åŠ¨çš„çºµæ¨ªæ–¹å‘åˆ†å‰²ï¼›
- TabContainer æ ‡ç­¾æ åˆ‡æ¢å¸ƒå±€ï¼›
- ViewportContainer ç‰¹æ®Šå®¹å™¨ï¼ŒåªåŒ…å«ä¸€ä¸ª Viewport å­èŠ‚ç‚¹ï¼Œä»¥æ˜¾ç¤ºå…¶å›¾å½¢ï¼›

ä½¿ç”¨å®¹å™¨æ—¶ï¼Œå®¹å™¨ä¼šæŒ‰å­èŠ‚ç‚¹çš„ç›¸å…³å±æ€§è®¾ç½®æ¥å¤„ç†è¿›ä½ç½®ã€å¤§å°çš„è°ƒæ•´ï¼Œå­èŠ‚ç‚¹å¯ä»¥é€šè¿‡æœ€å°å°ºå¯¸ Min Sizeï¼Œ
æˆ–è€… Size Flags å¯ç”¨ä¸åŒçš„è¡Œä¸ºæ¨¡å¼æ¥æ§åˆ¶å­èŠ‚ç‚¹çš„å¤§å°ã€ä½ç½®ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ Layout Presets æä¾›
çš„é¢„é…ç½®æ¥å¿«é€Ÿè®¾ç½®è¿™äº›å±æ€§ï¼š

- Fill å……æ»¡æ•´ä¸ªå®¹å™¨ï¼›
- Expand å°½é‡æ‰©å±•ä»¥å æ»¡å®¹å™¨ï¼›
- Shrink Center ç´§å‡‘æ’åˆ—åˆ°å®¹å™¨ä¸­å¤®ï¼›
- Shrink End ç´§å‡‘æ’åˆ—åˆ°å®¹å™¨æœ«å°¾ï¼›


Godot çš„åŸºç¡€ç±» **Object** æä¾›äº†ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•æ¥è¯»å†™å­å¯¹è±¡çš„å±æ€§ï¼Œåœ¨å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸­ï¼Œå¯ä»¥è·å–å„ç§
å±æ€§çš„è·¯å¾„ï¼Œä½¿ç”¨é¼ æ ‡å³é”®èœå• Copy Property Path (Ctrl+Shift+C) å¤åˆ¶å±æ€§è·¯å¾„ä¾›ä»¥ä¸‹æ–¹æ³•ä½¿ç”¨ã€‚
ä¾‹å¦‚ï¼Œé€šè¿‡è„šæœ¬ä¿®æ”¹ Label æ§ä»¶çš„å­—ä½“é¢œè‰²ã€é˜´å½±ï¼Œè¦†ç›– RichTextLabel æ§ä»¶çš„ä¸»é¢˜è®¾ç½®ï¼Œå±æ€§é¢æ¿ä½ç½®
Theme Overrides -> Colors -> Default Color å’Œ Selection Colorï¼š

```py
void set(property: String, value: Variant)
Variant get(property: String) const

$RichTextLabel.set("custom_colors/default_color", Color.red)
$RichTextLabel.set("custom_colors/selection_color", Color.red)

$Label.set("custom_colors/font_color", Color.whitesmoke)
$Label.set("custom_colors/font_color_shadow", Color.darkorange)
$Label.set("custom_constants/shadow_offset_x", 2)
$Label.set("custom_constants/shadow_offset_y", 2)
```


å¾€åœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ª RichTextLabel èŠ‚ç‚¹ï¼Œå¹¶é™„åŠ ä»¥ä¸‹è„šæœ¬å¯ä»¥å®ç° BBCode å†…å®¹æ˜¾ç¤ºï¼Œå¹¶ä¸”æ”¯æŒè¶…é“¾æ¥ï¼š

```py
extends RichTextLabel

onready var rich = $"."

# Called when the node enters the scene tree for the first time.
func _ready():
    bbcode_enabled = true
    bbcode_text = """
    Bitmap Font Generator
    å­—ä½“ç¤ºèŒƒ 
    Example: The word [url=https://www.bbcode.org]BBCode[/url] is clickable.
    [url=https://godotengine.org/][img]res://icon.png[/img][/url]
    The word BBCode is clickable, use meta_clicked signal to handle it.
    """
    connect("meta_clicked", self, "_on_meta_clicked", [], CONNECT_ONESHOT)

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
    pass

func _on_dragged(offset):
    rich.bbcode_text += ":%d " % offset

func _on_meta_clicked(meta):
    print(meta)
    OS.shell_open(meta)
```

æ³¨æ„ï¼Œåœ¨ Godot 4.x ä¸­ï¼Œå¦‚æœç¼–å†™å›¾ç‰‡è¿æ¥æ—¶æœ‰ç¼©è¿›ï¼Œè¡Œå‰ç©ºæ ¼æˆ– TAB å¯èƒ½ä¼šå¯¼è‡´æ— æ³•è§¦å‘ç‚¹å‡»äº‹ä»¶ã€‚




## ğŸŸ¡ Maths å›¾å½¢å­¦çš„æ•°å­¦
- [Vector math](https://docs.godotengine.org/en/stable/tutorials/math/vector_math.html)
- [3blue1brown çº¿æ€§ä»£æ•°çš„æœ¬è´¨](https://www.bilibili.com/video/BV1ys411472E)
- [å¼ ç­‘ç”Ÿã€Šæ•°å­¦åˆ†ææ–°è®²ã€‹ï¼ˆå…±ä¸‰å†Œï¼‰](http://fdjpkc.fudan.edu.cn/d201353/2015/0408/c17008a34495/page.htm)
- [GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/)
- [CMU 15-462/662 è®¡ç®—æœºå›¾å½¢å­¦ Computer Graphics](https://www.bilibili.com/video/BV1QZ4y1K7ga)
- Mathematical Logic for Computer Science
- [Eigen - C++ template library for linear algebra](https://eigen.tuxfamily.org/index.php)

æŒæ¡çº¿æ€§ä»£æ•°çš„é‡è¦æ€§åœ¨å›¾å½¢å­¦ä¸­ç‰¹åˆ«æ˜æ˜¾ï¼Œä¸åƒä¸€äº›ç®—æ³•åº“ï¼Œå¼€å‘å¥½äº†å°±å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘æ•°å­¦é—®é¢˜ã€‚
è€Œå›¾å½¢å­¦ä¸­ï¼Œéšå¤„éƒ½éœ€è¦ä½¿ç”¨æ•°å­¦å»è§£å†³å®é™…é—®é¢˜ï¼Œæ¯”å¦‚è§’è‰²çš„æ­£é¢æœå‘ï¼ŒæŠ•æ·æ­¦å™¨å‰å¦‚ä½•é¢å‘æ•Œäººï¼Œç›¸æœºè§’åº¦çš„
æ§åˆ¶ï¼Œå¦‚ä½•è·Ÿéšç©å®¶çš„è§’åº¦ä½œå˜æ¢ï¼Œç­‰ç­‰é—®é¢˜ï¼Œéƒ½éœ€è¦çº¿æ€§ä»£ç æ¥è§£å†³ã€‚

çº¿æ€§ä»£æ•° Linear Algebra æ˜¯ä¸€ä¸ªè§£å†³çº¿æ€§é—®é¢˜çš„å·¥å…·ï¼Œä»å‡ ä½•çš„è§‚ç‚¹å»ç†è§£çº¿æ€§ä»£æ•°æ˜¯ä¸€ä¸ªèƒ½ç›´è§‚æ„Ÿå—ä»€ä¹ˆ
æ˜¯çº¿æ€§çš„æœ¬è´¨ã€‚æ ¸å¿ƒæ˜¯çº¿æ€§ç©ºé—´å’Œçº¿æ€§å˜æ¢ï¼Œè€Œä¸æ˜¯ç®—è¡Œåˆ—å¼ã€‚

ä»¥ä¸‹æ˜¯ Jean DieudonnÃ© ä¸€æ®µè¯ï¼š

> å°½ç®¡ä¸€æ‰¹æ•™æˆå’Œæ•™ç§‘ä¹¦ç¼–è€…ç”¨å…³äºçŸ©é˜µçš„è’å”è‡³æçš„è®¡ç®—æ©ç›–äº†çº¿æ€§ä»£æ•°çš„ç®€æ˜æ€§ï¼Œè¿™é²œæœ‰ä¸ä¹‹ç›¸è¾ƒæ›´ä¸ºåˆç­‰çš„ç†è®ºã€‚
>
> There is hardly any theory which is more elementary than linear algebra, in 
> spite of the fact that generations of professors and textbook writers hav 
> obscured its simplicity by preposterous calculations with matrices.
>
> -- Jean DieudonnÃ©

ä»£æ•°æ€æƒ³æ˜¯è¿›å…¥çº¿æ€§ä»£ç çš„èµ·æ­¥ï¼Œä»å®æ•°çš„å››åˆ™è¿ç®—åˆ°ç¬¦å·çš„ä»£å…¥æ˜¯ä¸€ä¸ªåˆ†ç•Œçº¿ã€‚æ•°å­¦æ‰ä»ç­‰å¼æ–¹ç¨‹ã€ä¸ç­‰å¼ï¼Œ
Equationsï¼ŒInequalitiesï¼Œè¿›å…¥ä»£æ•°æ—¶ä»£ã€‚

ä»£æ•°çš„è¿ç®—ä¹ŸåŒæ ·éµå®ˆä¼˜å…ˆè§„åˆ™ï¼Œè¿™äº›è§„åˆ™ç®€ç§°ä¸º BODMAS!

- **B** - Brackets first
- **O** - Orders (i.e. Powers and Square Roots, etc.)
- **DM** - Division and Multiplication (left-to-right)
- **AS** - Addition and Subtraction (left-to-right)

å³å…ˆç®—æ‹¬å·ï¼Œå†ç®—é˜¶æ•°ï¼ˆå³å¹‚å’Œå¹³æ–¹æ ¹ç­‰ï¼‰ï¼Œç„¶åé™¤æ³•å’Œä¹˜æ³•ï¼ˆä»å·¦åˆ°å³ï¼‰ï¼Œæœ€ååŠ æ³•å’Œå‡æ³•ï¼ˆä»å·¦åˆ°å³ï¼‰ã€‚

æˆ–è€…å«åš PEMDAS !

- **P** Parentheses first
- **E** Exponents (ie Powers and Square Roots, etc.)
- **MD** Multiplication and Division (left-to-right)
- **AS** Addition and Subtraction (left-to-right)




### ğŸŸ ğŸ”µ Functions å‡½æ•°
- æ•°å­¦åˆ†æ(å…¨äºŒå·)(ç¬¬7ç‰ˆ) by B.A.å“é‡Œå¥‡
- å¼ ç­‘ç”Ÿã€Šæ•°å­¦åˆ†ææ–°è®²ã€‹ï¼ˆå…¨ä¸‰å†Œï¼‰
- [Maths is fun - Algebra](https://www.mathsisfun.com/algebra/index.html)

æ•°å­¦ä¸Šçš„å‡½æ•°æ¦‚å¿µå…¶å®æ˜¯æ˜ å°„å…³ç³»ï¼Œå½“å¹´å¼•å…¥è‹è”æ•™ææ—¶ç¿»è¯‘ä½œå‡½æ•°æœ‰äº›ä»¤äººè´¹è§£ï¼Œè¿™ä¸ªè¯æ„æ€åº”è¯¥æ˜¯ä¾èµ–å…³ç³»ã€‚
è¯´åˆ°å‡½æ•°å°±å¿…éœ€æœ‰é›†åˆ Setsï¼Œä¸¤ä¸ªé›†åˆä¸­çš„æ•°ï¼Œé€šè¿‡å‡½æ•°æ˜ å°„è§„åˆ™äº§ç”Ÿå¯¹åº”å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼š

![å•å°„ã€æ»¡å°„å’ŒåŒå°„](https://www.shuxuele.com/sets/images/function-mapping.svg)

å›¾ä¸­ï¼Œå°†ä¸€å¯¹å¤šçš„æƒ…å†µåˆ—ä¸ºä¸æ˜¯å‡½æ•°çš„ä¾‹å­ï¼Œä½†åœ¨æ˜¯å¤å˜å‡½æ•°ï¼Œå³ä»¥å¤æ•°ä½œä¸ºè‡ªå˜é‡å’Œå› å˜é‡çš„å‡½æ•°ï¼Œå°±å­˜åœ¨ä¸€
å¯¹å¤šçš„æ˜ å°„å…³ç³»ã€‚å¯¹äº Aã€B ä¸¤ä¸ªé›†åˆå…ƒç´ ä¹‹é—´çš„æ˜ å°„å­˜åœ¨å„ç§æƒ…å†µï¼š

- ä¸€èˆ¬å‡½æ•°æ˜ å°„ç‰¹ç‚¹ï¼šA é›†åˆå…ƒç´ ä¸€å¯¹ä¸€æ˜ å°„ B é›†åˆå…ƒç´ ï¼ŒB é›†åˆæœ‰å¤šä½™å…ƒç´ ï¼›
- å•å°„ **Injective**ï¼šA é›†åˆå…ƒç´ ä¸€å¯¹ä¸€æ˜ å°„ B é›†åˆå…ƒç´ ï¼Œä¸”æ²¡æœ‰å¤šå¯¹ä¸€çš„æƒ…å†µï¼›
- æ»¡å°„ **Surjective**ï¼šB é›†åˆå…ƒç´ åœ¨ A é›†åˆä¸­éƒ½æœ‰ä¸€ä¸ªå…ƒç´ å¯¹åº”ï¼›
- æ»¡å°„ **Bijective**ï¼šA å’Œ B é›†åˆçš„å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œæ²¡æœ‰å¤šä½™ï¼Œæ²¡æœ‰é‡å¤ï¼›

æ¯”å¦‚ï¼Œå¯¹äº Aã€B é›†åˆåˆ†åˆ«ä¸º {1, 2, 3} å’Œ {2, 4, 9}ï¼Œæ˜ å°„è§„åˆ™ä¸º"å¹³æ–¹"ï¼Œå³ f(x) = xÂ²ï¼Œï¼Œé‚£ä¹ˆè¿™
å°±æ˜¯ä¸€ä¸ªæ»¡å°„ï¼Œå³ä¸€ä¸€å¯¹åº”æ˜ å°„å…³ç³»çš„å‡½æ•°ï¼š

- A é›†åˆä½œä¸ºè¾“å…¥ç§°ä¸ºå®šä¹‰åŸŸ **Domain**ï¼›
- B é›†åˆä½œä¸ºå‡½æ•°çš„å®é™…è¾“å‡ºç§°ä¸ºå€¼åŸŸ **Range**ï¼›
- è€Œå‡½æ•°å¯èƒ½çš„è¾“å‡ºç§°ä¸ºåŸ¹åŸŸ **Codomain**ï¼›

æ‰€ä»¥ï¼Œå‡½æ•°æ˜¯æŒ‰æ˜ å°„è§„åˆ™å°†è¾“å…¥é›†åˆçš„å…ƒç´ ä¸è¾“å‡ºé›†åˆçš„å…ƒç´ ä¸Šå…³è”çš„åŠŸèƒ½ï¼Œå¦‚å›¾ï¼Œè¡¨è¾¾ä¸º x çš„å‡½æ•°ç­‰äº x çš„å¹³æ–¹ã€‚

![What is a functions?](https://www.mathsisfun.com/sets/images/function-fx-x2.svg)

é—­åŒ… **Closure** æ€§è´¨æ˜¯ï¼šå¯¹æŸä¸ªé›†åˆçš„æˆå‘˜è¿›è¡Œä¸€ç§è¿ç®—ï¼Œè¾“å‡ºç»“æœä»ç„¶æ˜¯è¿™ä¸ªé›†åˆçš„æˆå‘˜ï¼Œåˆ™è¯¥ç§°è¯¥é›†åˆä¸º
è¿™ä¸ªè¿ç®—ä¸‹çš„é—­åŒ…ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œé—­åŒ…ä¸€è¯ä¹Ÿä½œä¸ºæœ¯è¯­åœ¨ä½¿ç”¨ï¼Œå¹¶ä¸”å¸¸è§ï¼Œä½†æ˜¯å«ä¹‰æœ‰æ‰€å·®åˆ«ï¼Œç¼–ç¨‹ä¸Šæ›´å¤šæ˜¯æŒ‡
å¼•ç”¨è‡ªç”±å˜é‡çš„å‡½æ•°ã€‚ä»æŸç§è§’åº¦ä¸Šè®²ï¼Œå¦‚æœè‡ªç”±å˜é‡ç®—ä½œåŒä¸€ä¸ªé›†åˆä¸­çš„è¾“å…¥ï¼Œé‚£ä¹ˆä¹Ÿä¸è¿åé—­åŒ…çš„æ•°å­¦å®šä¹‰ã€‚

å¤åˆå‡½æ•° Function Composition æ˜¯æŒ‡å°†å‡½æ•°çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥ï¼Œè®°ä½œ (g Âº f)(x)ï¼Œæ„æ€æ˜¯
g(f(x))ã€‚

å’Œå‡ ä½•å¯ä»¥å˜æ¢ä¸€æ ·ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥å˜æ¢ï¼ŒFunction Transformationsï¼Œä¾‹å¦‚ï¼šg(x) = xÂ² åœ¨ç›´è§’åæ ‡ä¸­
æ˜¾ç¤ºä¸ºä¸€æ¡ç»è¿‡åŸç‚¹çš„å‘ä¸Šå¼¯æ›²çš„äºŒæ¬¡æ›²çº¿ï¼Œå˜æ¢ä¸º g(x) = xÂ² + C å½¢å¼åï¼Œå®ƒçš„æ›²çº¿å°±æ²¿ y è½´å‘ä¸Šç§»åŠ¨
C ä¸ªåç§»é‡ï¼Œå¦‚æœ C å°äº 0ï¼Œåˆ™å‘ä¸‹åç§»ã€‚

![Function Transformations](https://www.mathsisfun.com/sets/images/function-translation-a.gif)

å‡½æ•°çš„å¤åˆä¸å˜æ¢åœ¨å›¾å½¢å­¦ä¸­ç»å¸¸å‘ç”Ÿï¼Œå‡ ä¹åœ¨æ¯ä¸€ä¸ªç€è‰²å™¨ä¸­éƒ½éœ€è¦ä½¿ç”¨ã€‚

é€†å‡½æ•°ï¼Œæˆ–ç§°åå‡½æ•°ï¼ŒInverse Functionsï¼Œå³è¿ç®—è§„åˆ™å®Œå…¨ç›¸åçš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼Œf(x)=2x+3ï¼Œé‚£ä¹ˆåå‡½æ•°
å°±æ˜¯ fâ»Â¹(y)=(y-3)/2ï¼Œå°† f(x) çš„ç»“æœä½œä¸ºåå‡½æ•°çš„è¾“å…¥å°±å¯ä»¥å¾—åˆ° xï¼Œè®°ä½œ f(x) ä¸ fâ»Â¹(y) äº’ä¸º
åå‡½æ•°ã€‚åˆå¦‚ï¼ŒReciprocal æ•°çš„å€’æ•°äº’ä¸ºåå‡½æ•°ï¼Œ1/x <=> 1/yï¼Œåˆå¦‚ sin(x) <=> sinâ»Â¹(y) äº’ä¸º
åå‡½æ•°ï¼Œæ³¨æ„è¿™ä¸ªè´Ÿä¸€ä¸æ˜¯æŒ‡æ•°ï¼Œæ˜¯åå‡½æ•°æ ‡è®°ã€‚

æ³¨æ„ï¼Œä¸æ˜¯æ‰€æœ‰å‡½æ•°éƒ½æœ‰åå‡½æ•°ï¼ŒxÂ² åªåœ¨ x >= 0 æ—¶æ‰æœ‰åå‡½æ•°ï¼Œå°äº 0 æ—¶ï¼Œä¸èƒ½é€šè¿‡å¼€æ–¹ âˆš(x) æ±‚è§£è´Ÿå€¼ï¼Œ
å³ç«–ç›´å¯¹ç§°çš„å‡½æ•°éƒ½æ²¡æœ‰åå‡½æ•°ã€‚



### ğŸŸ ğŸ”µ Trigonomery ä¸‰è§’å‡½æ•°
- [Maths is fun - Trigonometry](https://www.mathsisfun.com/algebra/trigonometry.html)
- [Maths is fun - Trigonometry zh_CN](https://www.shuxuele.com/algebra/trigonometry.html)
- [Trigonometry](https://www.math.net/trigonometry)

Trigonometry ä¸‰è§’å‡½æ•°è¿™ä¸ªè¥¿æ–¹æœ¯è¯­è¯æºæ¥è‡ªå¸Œè…Šçš„ä¸‰è§’å­¦ï¼Œtrigonon + metronï¼Œå³ä¸‰è§’å½¢ + æµ‹é‡ã€‚
è¿™ä¹Ÿæ˜¯ä¸‰è§’å‡½æ•°çš„æœ€åˆç”¨é€”ï¼Œç”¨å®ƒæ¥æµ‹é‡ã€‚é‚£æ—¶æµ‹é‡çš„å¯èƒ½æ˜¯ä¸€æ£µå¤§æ ‘é«˜åº¦ï¼Œä¹Ÿå¯èƒ½æ˜¯æµ‹é‡å¤©ç©ºçš„æ˜Ÿæ˜Ÿã€‚

è¿›å…¥è¿‘ä»£æ•°å­¦è®©æ•°åŸŸæ‰©å±•åˆ°å¤æ•°ï¼Œä¹Ÿè®©ä¸‰è§’å‡½æ•°èµ°ä¸Šäº†å°ç¥ä¹‹è·¯ã€‚è‡ªä»æ¬§æ‹‰å…¬å¼çš„å‡ºç°ï¼Œä¸‰è§’å‡½æ•°å°±å’Œå¤æ•°å…³è”ï¼Œ
ä¸€äº›çº¯ä»£æ•°çš„ä¸œè¥¿ä¹Ÿèƒ½å¯¼å‡ºä¸‰è§’å‡½æ•°çš„å½±å­ï¼Œå°¤å…¶æ˜¯åœ¨å¤å˜å‡½æ•°é¢†åŸŸï¼Œä¸‰è§’å‡½æ•°ç®€ç›´æ³›æ»¥ï¼Œå› ä¸ºä¸‰è§’å‡½æ•°æœ¬è´¨ä¸Š
ä¸åœ†æœ‰å…³ï¼Œä¹Ÿé—´æ¥çš„å¯¼è‡´å¤å˜å‡½æ•°ä¸­ Ï€ æ³›æ»¥ã€‚å‚…é‡Œå¶å°†ä¸‰è§’å‡½æ•°æ¨å‘äº†å¦ä¸€ä¸ªæ–¹å‘ï¼Œä»–æå‡ºä»»æ„å‘¨æœŸå‡½æ•° s éƒ½
å¯ä»¥ç”¨ä¸‰è§’å‡½æ•°å»è¡¨ç¤ºï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä¸‰è§’å‡½æ•°æè¿°æ‰€æœ‰æ›²çº¿ï¼Œç”šè‡³ç”¨æ¥ç»˜å›¾ï¼Œè¿™å°±æ˜¯å‚…é‡Œå¶çº§æ•°ã€‚ç”±äºä¸‰è§’å‡½æ•°
é€šç”¨äºæè¿°å„ç§æ³¢ï¼Œç‰©ç†ä¸Šçš„å„ç§æ³¢éƒ½ç”¨ä¸‰è§’å‡½æ•°è¡¨ç¤ºï¼Œæ¯”å¦‚è–›å®šè°”çš„æ³¢å‡½æ•°ï¼Œé‡å­åŠ›å­¦ï¼Œä¸‰è§’å‡½æ•°éƒ½è¦å‡‘ä¸ªçƒ­é—¹ã€‚

1579å¹´ï¼ŒéŸ¦è¾¾å‡ºç‰ˆäº†ã€Šåº”ç”¨äºä¸‰è§’å½¢çš„æ•°å­¦å®šå¾‹ã€‹ï¼Œä»ç†è®ºçš„å±‚é¢å®šä¹‰åˆ†æäº†ä¸‰è§’å‡½æ•°ï¼Œåœ¨è¿™æœ¬ä¹¦ä¸­å°±å‡ºç°çš„éŸ¦è¾¾
å®šç†æœ‰è®©æ— æ•°ä¸­å­¦ç”Ÿå¤´ç–¼çš„å’Œå·®åŒ–ç§¯ï¼Œç§¯åŒ–å’Œå·®å…¬å¼ã€‚

17 ä¸–çºªæ˜¯ç‰›é¡¿è±å¸ƒå°¼å…¹åˆ›é€ å¾®ç§¯åˆ†çš„ä¸–çºªï¼Œä¹Ÿåœ¨è¿™ä¸ªä¸–çºªï¼Œç¬›å¡å°”æå‡ºäº†ç¬›å¡å°”åæ ‡ç³»ï¼Œä»æ­¤ä¸‰è§’å‡½æ•°å°±æœ‰äº†
å±äºè‡ªå·±çš„å›¾åƒï¼Œè´¹é©¬æå‡ºäº†å¯¼æ•°çš„æ¦‚å¿µï¼Œä¸ä¹…ä¹‹åä¸‰è§’å‡½æ•°å°±æœ‰äº†å¯¼æ•°ï¼Œè€Œä¸”ä¸‰è§’å‡½æ•°çš„å¯¼æ•°çš„ç‰¹æ®Šæ€§ã€‚

åŸºç¡€çš„æ­£å¼¦ã€ä½™å¼¦ã€æ­£åˆ‡å‡½æ•°ï¼ŒSineï¼ŒCosine å’Œ Tangent çš„æ­£ä¸‰è§’å½¢å®šä¹‰å¦‚å›¾æ‰€ç¤ºï¼Œæ­¤å¤–æœ‰å•ä½åœ†å®šä¹‰æ–¹å¼ï¼š

![Trigonometry](https://www.mathsisfun.com/algebra/images/sin-cos-tan.svg)

åœ¨å•ä½åœ†çš„å®šä¹‰ä¸­ï¼Œæ–œè¾¹å¯¹åº”åŠå¾„ï¼Œå¯¹è¾¹å¯¹åº”äºç«–ç›´è¾¹ï¼Œé‚»è¿‘è¾¹åˆ™å¯¹åº”äºè´´ç´§ X è½´çš„è¾¹ã€‚æ²¿é€†æ—¶é’ˆæ–¹å‘æ—‹è½¬åŠå¾„ï¼Œ
è§’åº¦ä¸ºæ­£ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬ä¸ºè´Ÿï¼Œä½¿ç”¨å¼§åº¦è¡¨ç¤ºä¸€å‘¨ä¸º 2Ï€ å¼§åº¦ï¼Œè€Œç”¨è§’åº¦è¡¨ç¤ºä¸€å‘¨ä¸º 360Â°ã€‚

- Sine å’Œ Cosine çš„å€¼åŸŸéƒ½æ˜¯ [-1, 1]ï¼Œå‘¨æœŸéƒ½æ˜¯ 2Ï€ã€‚
- Sine åœ¨ -Ï€/2 åˆ° Ï€/2 åŒºé—´æ˜¯é€’å¢ï¼Œè€Œ Cosine åœ¨ -Ï€ åˆ° 0 åŒºé—´æ˜¯é€’å¢ã€‚

![sine graph](https://www.mathsisfun.com/algebra/images/sine-graph.svg)
![cosine graph](https://www.mathsisfun.com/algebra/images/cosine-graph.svg)
![tangent graph](https://www.mathsisfun.com/algebra/images/tangent-graph.svg)

Tangent æ­£åˆ‡å‡½æ•°æ˜¯æ ¹æ®è§’åº¦ Î± æ±‚è§£å¯¹è¾¹ä¸é‚»è¾¹çš„æ¯”å€¼ï¼Œè€Œåå‘ä¸‰è§’å‡½æ•° atan åˆ™åè¿‡æ¥æ ¹æ®æ¯”å€¼æ±‚è§’åº¦ã€‚

    sin(Î±) = opposite side / hypotenuse    = a / h
    cos(Î±) = adjacent side / hypotenuse    = a / h
    tan(Î±) = opposite side / adjacent side = a / b

æœ€æ—©çš„å‹¾è‚¡å®šç†å°±æ˜¯å¯¹ç›´è§’ä¸‰è§’å½¢è¾¹é•¿çš„ç ”ç©¶ç»“è®ºï¼Œå‹¾ä¸‰è‚¡å››å¼¦äº”ï¼ŒæŒ‡çš„æ˜¯ç›´è§’ä¸‰è§’å½¢çš„ä¸¤ç›´è§’è¾¹ä¸º 3ã€4ï¼Œé‚£ä¹ˆ
æ–œè¾¹é•¿ä¸º 5ã€‚å›½å¤–ç§°ä¸ºæ¯•è¾¾å“¥æ‹‰æ–¯å®šç† Pythagoras theoremï¼Œå³æ–œè¾¹é•¿çš„å¹³æ–¹ç­‰äºä¸¤ç›´è§’è¾¹çš„å¹³æ–¹å’Œã€‚

![Unit circle](https://www.mathsisfun.com/geometry/images/unit-circle-xy.svg)

å¯¹äºå•ä½åœ†ï¼Œunit circleï¼Œæ ¹æ®å‹¾è‚¡å®šç†å¯å¾—ä»¥ä¸‹æ’ç­‰å¼ï¼š

    xÂ² + yÂ² = 1Â²  <=>  xÂ² + yÂ² = 1

åœ¨å•ä½åœ†ä¸Šï¼Œx = cos(Î¸) ä¸” y = sin(Î¸)ï¼Œä»£å…¥ä¸Šå¼å°±å¯ä»¥å¾—åˆ°æœ€é‡è¦çš„ä¸€æ¡ä¸‰è§’å‡½æ•°æ’ç­‰å¼ï¼Œä¹Ÿæ˜¯åœ†çš„æ–¹ç¨‹ï¼š

    cos(Î¸)Â² + sin(Î¸)Â² = 1

å› ä¸ºåœ†çš„å…³ç³»ï¼Œåœ¨å›¾å½¢å­¦ä¸Šï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ä¸‰è§’å‡½æ•°æ¥ä½œæ—‹è½¬å˜æ¢æ“ä½œã€‚


    å‹¾è‚¡å®šç†       aÂ² + bÂ² = cÂ²        ï¼ˆåªé€‚ç”¨äºç›´è§’ä¸‰è§’å½¢ï¼‰
                     
    ä½™å¼¦å®šç†       aÂ² + bÂ² âˆ’ 2ab cos(C) = cÂ²

    æ­£å¼¦å®šç†       a/sin A = b/sin B = c/sin C



### ğŸŸ ğŸ”µ Vectors å‘é‡
- [Vectors](https://www.math.net/vector)
- [Vectors - Maths is fun](https://www.mathsisfun.com/algebra/vectors.html)
- [Vectors - 3Blue1Brown](https://www.3blue1brown.com/lessons/vectors)
- [Math Typography](https://bisqwit.iki.fi/jutut/typography.html)

å‘é‡ Vector ä¹Ÿç§°ä¸ºæ¬§å‡ é‡Œå¾—å‘é‡ã€å‡ ä½•å‘é‡ã€çŸ¢é‡ï¼ŒæŒ‡å…·æœ‰å¤§å°ï¼ˆmagnitudeï¼‰å’Œæ–¹å‘çš„é‡ã€‚ä¸å‘é‡å¯¹åº”çš„
é‡å«åšæ•°é‡ Scalarï¼Œç‰©ç†å­¦ä¸­ç§°æ ‡é‡ï¼Œæˆ–è€…å«ä¸€ç»´å‘é‡ï¼Œæ•°é‡åªæœ‰å¤§å°ï¼Œæ²¡æœ‰æ–¹å‘ï¼Œå¦‚é‡é‡ã€æ—¶é—´ç­‰ï¼Œè‹±æ–‡
çš„é€Ÿåº¦ç”¨ speed è¡¨ç¤ºæ ‡é‡ï¼Œè€Œ velocity è¡¨ç¤ºå‘é‡ï¼Œä¸€èˆ¬è¯´å¹³å‡é€Ÿåº¦æ˜¯æŒ‡ average speedã€‚

æ•°å­¦ä¸Šå‘é‡çš„è§„èŒƒè¡¨è¾¾æœ‰ä¸‰ç§æ–¹å¼ï¼Œä»£æ•°è¡¨ç¤ºã€å‡ ä½•è¡¨ç¤ºã€åæ ‡è¡¨ç¤ºã€‚å‡ ä½•å›¾ä¸Šä¸ºå¸¦ç®­å¤´çš„çº¿æ®µï¼Œç®­å¤´è¡¨å‘é‡çš„æ–¹å‘ï¼Œ
çº¿æ®µé•¿åº¦ä»£è¡¨å‘é‡çš„å¤§å°ã€‚ä»£æ•°ç¬¦å·è¡¨è¾¾è®°ä½œé»‘ä½“å­—æ¯ï¼Œå¦‚ **ğ’‚**ã€**ğ’ƒ**ã€**ğ’–**ã€**ğ’—**ï¼Œä¹¦å†™æ—¶åœ¨å­—æ¯é¡¶ä¸Š
åŠ ä¸€å°ç®­å¤´â€œâ†’â€è¡¨ç¤ºæŒ‡å‘ï¼Œå¦‚ uâƒ—  vâƒ—  wâƒ—  xâƒ— yâƒ—ã€‚å¦‚æœç»™å®šå‘é‡çš„èµ·ç‚¹ï¼ˆAï¼‰å’Œç»ˆç‚¹ï¼ˆBï¼‰ï¼Œå¯å°†å‘é‡è®°ä½œ AB å¹¶äº
é¡¶ä¸ŠåŠ ç®­å¤´ç¬¦å·è¡¨ç¤ºæ–¹å‘ã€‚åœ¨æ–‡æ¡£ä¸­ï¼Œä¸ºäº†ç®€åŒ–è¾“å…¥ï¼Œå°±ç›´æ¥è¡¨ç¤ºä¸º **AB**ã€‚

å‘é‡ç©ºé—´ä¹Ÿç§°ä¸ºçº¿æ€§ç©ºé—´ï¼Œæ˜¯é›†åˆçš„è½½ä½“ï¼Œæ ‡é‡å¯ä»¥è¢«ç»„ç»‡åœ¨ä¸€èµ·ã€‚æ ‡é‡é€šå¸¸è¢«è®¤ä¸ºæ˜¯å®æ•°ï¼Œä¹Ÿå­˜åœ¨æ ‡é‡ä¹˜ä»¥å¤æ•°ã€‚
å‘é‡ç©ºé—´æ˜¯çº¿æ€§ä»£æ•°çš„ä¸»é¢˜ï¼Œç»´åº¦é€šè¿‡å®ƒä»¬å¯ä»¥å¾ˆå¥½åœ°è¡¨å¾ï¼Œç²—ç•¥åœ°è¯´ï¼Œå®ƒæŒ‡å®šäº†ç©ºé—´ä¸­ç‹¬ç«‹æ–¹å‘çš„æ•°é‡ã€‚æ— é™ç»´
å‘é‡ç©ºé—´åœ¨æ•°å­¦åˆ†æä¸­è‡ªç„¶å‡ºç°ï¼Œä½œä¸ºå‡½æ•°ç©ºé—´ï¼Œå…¶å‘é‡æ˜¯å‡½æ•°ã€‚è¿™äº›å‘é‡ç©ºé—´é€šå¸¸å…·æœ‰é™„åŠ ç»“æ„ï¼Œå¯ä»¥æ˜¯æ‹“æ‰‘ç»“æ„ï¼Œ
å…è®¸è€ƒè™‘æ¥è¿‘åº¦å’Œè¿ç»­æ€§é—®é¢˜ã€‚

æ­¤å¤–ï¼Œè¿˜æœ‰ç¬¬ä¸‰ç§é‡ï¼Œå¼ é‡ Tensorï¼Œæ ‡é‡ã€å‘é‡æ˜¯å¼ é‡çš„ç‰¹æ®Šå½¢å¼ï¼Œæ²¡æœ‰æ–¹å‘åˆ†é‡çš„å¼ é‡å°±æ˜¯æ ‡é‡ï¼Œæœ‰æ¨¡æœ‰æ–¹å‘
çš„å¼ é‡å°±æ˜¯å‘é‡ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªæ–¹å‘å°±æ˜¯å¹¶çŸ¢ã€å¹¶å‘é‡ã€‚

æ ‡é‡ã€å‘é‡ã€çŸ©é˜µã€å¼ é‡è¿™ 4 ä¸ªæ¦‚å¿µæ˜¯ç»´åº¦ä¸æ–­ä¸Šå‡çš„å…³ç³»ï¼Œç”¨ç‚¹ã€çº¿ã€é¢ã€ä½“çš„æ¦‚å¿µæ¥æ¯”å–»è§£é‡Šä¼šç›´è§‚ä¸€ç‚¹ï¼š

- ç‚¹ â€”â€” æ ‡é‡ï¼ˆscalarï¼‰
- çº¿ â€”â€” å‘é‡ï¼ˆvectorï¼‰
- é¢ â€”â€” çŸ©é˜µï¼ˆmatrixï¼‰
- ä½“ â€”â€” å¼ é‡ï¼ˆtensorï¼‰

å¼ é‡ç†è®ºæ˜¯æ•°å­¦çš„ä¸€ä¸ªåˆ†æ”¯å­¦ç§‘ï¼Œåœ¨åŠ›å­¦ä¸­æœ‰é‡è¦åº”ç”¨ï¼Œæœ¯è¯­èµ·æºäºåŠ›å­¦ï¼Œæœ€åˆç”¨æ¥è¡¨ç¤ºå¼¹æ€§ä»‹è´¨ä¸­å„ç‚¹åº”åŠ›çŠ¶æ€ï¼Œ
åæ¥å¼ é‡ç†è®ºå‘å±•æˆä¸ºåŠ›å­¦å’Œç‰©ç†å­¦çš„ä¸€ä¸ªæœ‰åŠ›çš„æ•°å­¦å·¥å…·ã€‚

å‘é‡ Vector æ˜¯ 2D æˆ– 3D ä¸–ç•Œä¸­å¤„ç†é—®é¢˜çš„åŸºæœ¬å·¥å…·ï¼Œåœ¨å›¾å½¢å­¦ä¸Šç»å¸¸å°†å®ƒå½“ä½œæ–¹å‘æŒ‡ç¤ºå™¨æ¥ä½¿ç”¨ï¼Œä¸€èˆ¬
ä¸å…³å¿ƒå‘é‡çš„èµ·ç‚¹ï¼Œæˆ–è€…è¯´æ ¹æ®éœ€è¦ç»™å®ƒä¸€ä¸ªèµ·ç‚¹åæ ‡ã€‚å½’ä¸€åŒ– Normalized æ˜¯çŸ¢é‡ä¸­ç»å¸¸å‡ºç°çš„æ“ä½œï¼Œå®ƒå°†
çº¦æŸçŸ¢é‡çš„æ¨¡é•¿ä¸º 1ï¼Œå³**å•ä½å‘é‡**å°±æ˜¯é•¿åº¦ä¸º 1 çš„å‘é‡ï¼ŒUnit vectorsã€‚

æ ¹æ®å‹¾è‚¡å®šç†ï¼Œå‘é‡çš„æ¨¡å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼Œç”¨ä¸¤æ¡ç«–çº¿è¡¨ç¤ºï¼Œåœ¨æ•°å­¦è®°å·ä¸­ï¼Œåœ¨å‘é‡ç¬¦å·ä¸¤ä¾§éƒ½ä½¿ç”¨åŒç«–çº¿ï¼š

    |a| = âˆš( xÂ² + yÂ² )

å•ä½å‘é‡è¿˜ç»å¸¸ç”¨ä½œè¡¨ç¤ºæ³•çº¿ normalsï¼Œæ³•å‘é‡å°±æ˜¯å‚ç›´äºæ›²é¢çš„å•ä½å‘é‡ï¼Œç”¨æ¥æŒ‡ç¤ºæ–¹å‘ï¼Œåœ¨å…‰ç…§æŠ€æœ¯ã€ç‰©ä½“
ç¢°æ’ç­‰ç­‰æ“ä½œä¸­éƒ½éœ€è¦ç”¨å®ƒæ¥è§£å†³åç»­å“åº”ã€‚

ç¬›å¡å°”å‘é‡æ˜¯ç‰¹æ®Šçš„å•ä½å‘é‡ï¼ŒæŒ‡å‘å’Œä¸ªè½´å‘ï¼Œå¯¹åº”äºç¬›å¡å°”åæ ‡ç³»ä¸­çš„ x/y/z è½´ï¼š 

    i=[1,0,0]áµ€      j=[0,1,0]áµ€      k=[0,0,1]áµ€

å®é™…åº”ç”¨ä¸­ä¸ºäº†ç®€åŒ–è¿ç®—ï¼Œéœ€è¦å¼•å…¥`åŸºåº•` Basis Vectors çš„æ¦‚å¿µï¼Œä¸ºæ¯ä¸ªè½´ä¸Šå®šä¹‰ä¸€ä¸ªå•ä½å‘é‡ã€‚ä¹Ÿå°±æ˜¯
å»ºç«‹åæ ‡ç³»ç»Ÿè¿›ç­‰è·åˆ†å‰²æ•°è½´æ—¶ï¼Œæ²¿ x è½´åˆ†å‰²çš„ä¸€ç­‰åˆ†è®°ä½œæ²¿ x æ­£æ–¹å‘çš„å•ä½å‘é‡ iï¼Œæ­£å¼ä¹¦å†™æ—¶ï¼Œå®ƒåº”è¯¥
ä¸Šé¢åŠ ä¸ªç›–å¸½ã€‚è¿˜æœ‰ y è½´ä¸Šçš„å•ä½å‘é‡ jï¼ŒåŒæ ·ä¹Ÿåº”è¯¥åœ¨ä¸Šé¢åŠ ä¸ªç›–å¸½ï¼Œä½†æ˜¯è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ‰“å­—çœç•¥äº†ã€‚

è¿™æ ·ä¸€æ¥ï¼Œå‘é‡ç›¸åŠ å’Œæ•°ä¹˜å°±å¯ä»¥ç†è§£ä¸ºï¼Œå¯¹å„è½´å•ä½å‘é‡çš„ç¼©æ”¾å†ç›¸åŠ ï¼Œè¿™ä¸ªæ€æƒ³æ—¢é‡è¦åˆåŸºç¡€ã€‚

å¯ä»¥è¿™æ ·ç†è§£çº¿æ€§ï¼Œåœ¨ä¸€ä¸ªå¹³é¢ä¸­é€‰å–ä¸¤ä¸ªå‘é‡ï¼Œä¿æŒå…¶ä¸­ä¸€ä¸ªä¸å˜ï¼Œå¦å¤–ä¸€ä¸ªä»»æ„ä¼¸ç¼©ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‘é‡ç›¸åŠ çš„
ç»“æœå°±æ˜¯æ‰«è¿‡è¿™ä¸ªå¹³é¢ä¸Šçš„ä¸€æ¡ç›´çº¿ã€‚

å½“ä¸¤ä¸ªå‘é‡éƒ½è¿›è¡Œä¼¸ç¼©æ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¼šæ‰«è¿‡æ•´ä¸ªå¹³é¢ï¼Œè€Œè¿™äº›å˜åŒ–ä¸­çš„å‘é‡é›†åˆæˆçš„å¹³é¢å°±å«ä½œ`å¼ æˆç©ºé—´` 
Span spaceã€‚ä¾‹å¤–çš„æƒ…å†µæ˜¯ï¼Œè¿™ä¸¤ä¸ªå‘é‡çš„æ–¹å‘é‡å æ—¶ï¼Œå®ƒä»¬å¼ æˆç©ºé—´æ˜¯ä¸€æ¡ç›´çº¿ã€‚

åŒæ ·ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸Šçš„ä¸‰ä¸ªä¸åŒæ–¹å‘çš„å‘é‡ï¼Œå®ƒä»¬å¼ æˆçš„ç©ºé—´å°±æ˜¯ä¸‰ç»´ç©ºé—´çš„ä½“ç§¯ã€‚åªè¦å…¶ä¸­æœ‰ä¸¤ä¸ªå‘é‡å…¶çº¿ï¼Œ
é‚£ä¹ˆå¼ æˆç©ºé—´å°±å‹ç¼©ä¸ºå¹³é¢ï¼Œå¦‚æœä¸‰å‘é‡éƒ½å…±çº¿ï¼Œå¼ æˆç©ºé—´å°±å‹ç¼©ä¸ºä¸€æ¡çº¿ã€‚æœ‰ä¸ªæç«¯çš„æƒ…å†µï¼Œå³å‘é‡éƒ½ä¸º 0 å‘é‡ï¼Œ
å¼ æˆç©ºé—´å°±æ˜¯åŸç‚¹ã€‚

å½“ä¸€ä¸ªç»´åº¦çš„çš„å‘é‡çš„å¢åŠ æˆ–æ•°ä¹˜ä¸èƒ½å¢åŠ å¼ æˆç©ºé—´çš„ç»´åº¦æ—¶ï¼Œä¹Ÿå³ç§°ä¸º`çº¿æ€§ç›¸å…³` Linearly dependentï¼Œ
æˆ–è€…ç†è§£ä¸ºè¿™ä¸ªå‘é‡çº¦æŸåœ¨å…¶å®ƒå‘é‡å¼ æˆçš„ç©ºé—´å†…ã€‚åŸæ–‡æ˜¯ dependent åŸå•æ˜¯ä¾èµ–ã€æŸç¼šçš„æ„æ€ï¼Œä¸­æ–‡çš„ç›¸å…³
ä¸€è¯ç•¥æ˜¾æ¾å®ä¸ä¸¥è°¨ã€‚å½“æŸå‘é‡çš„åŠ å…¥å¯ä»¥å¢åŠ åŸæœ‰å‘é‡çš„å¼ æˆç©ºé—´çš„ç»´åº¦ï¼Œå°±æ˜¯éçº¿æ€§çº¦æŸï¼Œå³`çº¿æ€§ä¸ç›¸å…³`
 Linearly independentã€‚

å½“æˆ‘ä»¬è¦è€ƒè™‘å¾ˆå¤šå‘é‡çš„æ—¶å€™ï¼Œä½¿ç”¨ç®­å¤´è¡¨è¾¾å‘é‡çš„æ–¹å¼ä¼šè®©ç©ºé—´æ˜¾å¾—è¿‡äºæ‹¥æŒ¤ï¼Œå¯ä»¥ä½¿ç”¨ç®€åŒ–çš„åœ†ç‚¹æ¥è¡¨ç¤ºï¼Œ
åªè¦åŸç‚¹æŒ‡å‘åœ†ç‚¹çš„ä½ç½®ç¬¦åˆåŸå…ˆçš„å‘é‡æ–¹å‘å³æ˜¯ç­‰ä»·çš„ã€‚



åœ¨ Godot 2D ç¯å¢ƒä¸‹ï¼Œåæ ‡æœå‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±å¹•å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œå³ã€ä¸‹ä¸ºæ­£å‘ã€‚

![Coordinate systems (2D)](https://docs.godotengine.org/en/3.5/_images/vector_xy1.png)

ä¾‹å¦‚ï¼Œä»åŸç‚¹åˆ°åæ ‡ (4, 3) ä½ç½®å°±å¯ä»¥ç”¨å‘é‡è¡¨ç¤ºä¸º Vector2(4, 3)ã€‚

ç¼–å†™ä»¥ä¸‹è¿™æ ·çš„ä¸€ä¸ª sayhello.gd è„šæœ¬ï¼Œä½¿ç”¨ godot.exe --headless -s sayhello.gd å‘½ä»¤æ‰§è¡Œï¼Œ
å°±å¯ä»¥å¾—åˆ°è„šæœ¬è¿è¡Œè¾“å‡ºçš„ç»“æœï¼Œå¹¶ä¸éœ€è¦è¿è¡Œæ•´ä¸ª Godot ç¼–è¾‘å™¨ï¼š

```py
extends SceneTree

func _init():
    var a = Vector2 (2, 5) 
    var b = Vector2 (3, 1)
    var format = "Normalized vector %s is %s, "
    var angle = "angle of %s - %s is %d degree"
    print(format % [a, a.normalized()])
    print(angle % [a, b, (a - b).angle()*180/PI])
    print(angle % [b, a, (b - a).angle()*180/PI])
    print("dot(%s, %s) = %s " % [a, b,  a.dot(b)])
    quit()
# Output:
# Normalized vector (2, 5) is (0.371391, 0.928477), 
# angle of (2, 5) - (3, 1) is 104 degree
# angle of (3, 1) - (2, 5) is -75 degree
# dot((2, 5), (3, 1)) = 11 
```

Godot Vector2.angle() æ–¹æ³•è¿”å›çš„å€¼æ˜¯ [-Ï€, Ï€] ä¹‹é—´çš„å¼§åº¦å€¼ï¼ŒX è½´æ­£å‘ä¸º 0 åº¦ï¼Œé€†æ—¶é’ˆæ–¹å‘ä¸ºæ­£ã€‚

å‘é‡çš„åŠ å‡è¿ç®—ï¼Œå°±æ˜¯æŒ‰åˆ†é‡è¿›è¡Œæ ‡é‡çš„åŠ å‡è¿ç®—ï¼Œåœ¨å›¾å½¢ä¸Šç­‰æ•ˆäºä¸¤ä¸ªå‘é‡é¦–å°¾è¿æ¥åœ¨ä¸€èµ·ï¼Œç»ˆç‚¹å°±è¡¨ç¤ºç»“æœã€‚
å‡æ³•ï¼Œç›¸å½“äºå°†åˆ†é‡ä¹˜ä»¥ -1 åè½¬ 180Â° æ–¹å‘å†ç›¸åŠ ã€‚å¦‚ä¸‹å›¾ï¼Œè“è‰²å‘é‡è¡¨ç¤º **a**ï¼Œç»¿è‰²å‘é‡è¡¨ç¤º **b**ï¼š

```py
# create a vector with coordinates (2, 5)
var a = Vector2(2, 5)
# create a vector and assign x and y manually
var b = Vector2()
b.x = 3
b.y = 1

# Adding vectors
var c = a + b  # (2, 5) + (3, 1) = (5, 6)
```

![Vector Addition](https://docs.godotengine.org/en/3.5/_images/vector_add1.png)

å‘é‡ä¸æ ‡é‡ç§¯ï¼Œåˆ™ç­‰æ•ˆäºå¤šæ¬¡ç›¸åŠ ã€‚ç†è§£è¿™äº›å†…å®¹ï¼Œå°±å¯ä»¥ç”¨å‘é‡æ¥åšæ¸¸æˆçš„ä¸­è¿åŠ¨ã€‚ç”¨ä¸€ä¸ªå‘é‡è¡¨ç¤ºé€Ÿåº¦ï¼Œä¾‹å¦‚ï¼Œ
ä¸Šå›¾ä¸­çš„ **b** è¡¨ç¤ºé€Ÿåº¦ï¼Œæ¯æ¬¡è¿è¡Œæ—¶é—´é—´éš”åï¼Œç‰©ä½“å°±ä¼šä» **a** ä½ç½®ç§»åˆ° **a+b** ä½ç½®ä¸Šã€‚è¦è¡¨è¾¾
åŠ é€Ÿåº¦ï¼Œä¹Ÿæ˜¯åŒä¸€ä¸ªé“ç†ï¼Œåªéœ€è¦åœ¨é—´éš”æ—¶é—´å†…å°†åŠ é€Ÿä¸é€Ÿåº¦ç›¸åŠ ï¼Œå³å¾—åˆ°å½“å‰çš„é€Ÿåº¦ã€‚

å‘çš„å‡æ³•å¯ä»¥ç”¨æ¥æ±‚æ–¹å‘ï¼Œå‡è®¾ tank æ˜¯ç©å®¶ï¼Œrobot æ˜¯å¯¹æ‰‹ï¼ŒäºŒè€…ä½ç½®åˆ†åˆ«ç”¨ **A** å’Œ **B** å‘é‡è¡¨ç¤ºï¼Œ
è¦ç¡®å®šä»ç©å®¶æŒ‡å‘å¯¹æ‰‹çš„æ–¹å‘ï¼Œåªéœ€å‘é‡å‡æ³•ï¼Œçº¢è‰²å‘é‡ä¸º **C** å³è¡¨ç¤ºæ–¹å‘ï¼Œä»å½“å‰ç©å®¶çš„ä½ç½®å¾€è¿™ä¸ªæ–¹å‘å°„å‡»
æˆ–è€…æŠ•æ·æ­¦å™¨å°±å¯ä»¥å‡»ä¸­å¯¹æ‰‹ï¼š

![Pointing toward a target](https://docs.godotengine.org/en/3.5/_images/vector_subtract2.png)

ç”± A æŒ‡å‘ Bï¼Œå°±éœ€è¦ç”¨ B - Aï¼ŒæŒ‰å‘é‡åŠ æ³•çš„æ€ç»´å»ç†è§£ï¼Œåˆ™å…ˆå°† A åè½¬ 180Â° å†ç›¸åŠ ï¼Œå¾—åˆ°çš„å°±æ˜¯ä¸€ä¸ª
ä»åŸç‚¹å‡ºå‘çš„è¡¨ç¤ºæ–¹å‘çš„å‘é‡ã€‚æ³¨æ„ï¼Œå‡æ³•çš„é¡ºåºä¸èƒ½åï¼Œå«ä¹‰å®Œå…¨ä¸åŒï¼ŒC = B - Aï¼Œç­‰ä»·äº A + C = Bï¼Œ
A - B = -Cï¼Œæ‰€ä»¥ï¼Œç»“æœæ˜¯åè½¬ 180Â°ã€‚è®°ä½œï¼Œè´Ÿå·åœ¨å“ªæ–¹ï¼Œç®­å¤´å°±ç”±å“ªæ–¹å¾€å¤–ï¼ŒB - A è®°ä½œ B <- Aã€‚

å‘é‡ä¹˜æ³•å½¢å¼å®šä¹‰æœ‰ä¸‰ç§ï¼š

- **Scalar multiplication** æœ€ç®€å•çš„æ˜¯æ ‡é‡ç§¯é‡ï¼Œç›¸å½“äºå¤šæ¬¡åŠ æ³•ï¼Œç»“æœè¿˜æ˜¯å‘é‡ï¼›
- **Dot product** ç‚¹ç§¯ï¼Œå‡ ä½•æ„ä¹‰æ˜¯æ±‚è§£ä¸¤ä¸ªåŒæ–¹å‘çš„å‘é‡çš„æ¨¡é•¿çš„æ•°é‡ç§¯ï¼Œç»“æœæ˜¯æ ‡é‡ï¼›
- **Cross product** å‰ç§¯ï¼Œæ±‚è§£çš„æ˜¯å¦ä¸€ä¸ªå‘é‡ï¼Œæ–¹å‘ä¸å½“å‰å‘é‡å¹³é¢ç›¸äº’å‚ç›´ï¼›

å‰é¢å·²ç»è§£æè¿‡æ ‡é‡ç§¯ï¼Œç‚¹ç§¯ç»“æœä¹Ÿä¸€æ ·æ˜¯æ ‡é‡ï¼Œå°†ä¸¤ä¸ªåŒæ–¹å‘çš„å‘é‡çš„æ¨¡é•¿ç›¸ä¹˜ã€‚å¯¹äºä¸åŒæ–¹å‘çš„å‘é‡ï¼Œé€šè¿‡
ä½™å¼¦å€¼å¯ä»¥æ±‚æ­£äº¤æŠ•å½±é•¿åº¦ï¼Œå³æŠ•å½±é•¿åº¦å³å¯è·å¾—åŒæ–¹å‘ä¸Šçš„åˆ†é‡ï¼Œç‰©ç†ä¸Šç”¨æ¥è®¡ç®—åˆåŠ›å’ŒåŠŸï¼š

    a Â· b = |a| Ã— |b| Ã— cos(Î¸)

é™¤äº†ç‚¹ç§¯çš„å‡ ä½•æ„ä¹‰çš„è®¡ç®—æ–¹æ³•ï¼Œè¿˜æœ‰åœ¨é«˜ç»´åº¦ä¸Šæ›´å¸¸ç”¨çš„é€šè¿‡åæ ‡è®¡ç®—çš„æ–¹å¼ï¼Œå®šä¹‰å¦‚ä¸‹ï¼šAã€B éƒ½æ˜¯ n ç»´å‘é‡ï¼Œ
ï¼Œç‚¹ç§¯å®šä¹‰ä¸º sum(aáµ¢báµ¢)ï¼Œi å–å€¼ä¸ºèŒƒå›´ [1, n]ã€‚å¦‚ä½•è¯æ˜è¿™ç§å®šä¹‰ä¸å‘é‡çš„å‡ ä½•ç‚¹ç§¯è¿ç®—ä¸¤è€…ç­‰ä»·å‘¢ï¼Ÿä½¿ç”¨
ä½™å¼¦å®šç†ï¼Œåœ¨å¹³é¢ä¸Šçš„ä¸¤ä¸ªå‘é‡ Aã€Bï¼Œé¦–å°¾è¿æ¥å³å¯ä»¥æ„æˆä¸€ä¸ªä¸‰è§’å½¢ã€‚è€Œä¸¤å‘é‡çš„åæ ‡å·²çŸ¥ï¼Œä¸‰æ¡è¾¹é•¿å¯é€šè¿‡
åæ ‡æ±‚å¾—ï¼Œå°†åæ ‡ä»£å…¥ä½™å¼¦å®šç†å…¬å¼ä¸­ï¼Œå³å¯ä»¥è¯æ˜ä¸¤è€…ç­‰ä»·å…³ç³»ã€‚

ç»™å®šä¸¤ä¸ªå‘é‡åæ ‡ v = [vâ‚, vâ‚‚] å’Œ w = [wâ‚, wâ‚‚]ï¼Œè®¡ç®—ç‚¹ç§¯ä¸º v âˆ™ w = vâ‚wâ‚ + vâ‚‚wâ‚‚ï¼Œè¡¨è¾¾æ›´ç®€æ´ã€‚
ä¾‹å¦‚ï¼Œç»™å®š v = [3, 5]áµ€ å’Œ w = [-2, 7]áµ€ï¼Œè®¡ç®— v Â· w å’Œ v Â· vï¼Œä¸Šæ ‡ T è¡¨ç¤ºçŸ©é˜µè½¬ç½®ï¼Œè¡Œå˜åˆ—ã€‚

å‘é‡ç‚¹ç§¯åœ¨å›¾å½¢å­¦ä¸­ä¸€å¤§ç”¨é€”å°±æ˜¯åˆ©ç”¨ç‚¹ç§¯ç»“æœæ¥åˆ¤æ–­å¤¹è§’çš„å¤§å°ï¼Œå‘é‡è‡ªèº«çš„ç‚¹ç§¯å°±æ˜¯æ¨¡çš„å¹³æ–¹ï¼š

- ç‚¹ç§¯ç»“æœä¸º 0 è¡¨ç¤ºä¸¤è€…äº’ç›¸å‚ç›´ï¼›
- ç‚¹ç§¯ç»“æœå¤§äº 0 è¡¨ç¤ºä¸¤è€…åŒå‘ï¼›
- ç‚¹ç§¯ç»“æœå°äº 0 è¡¨ç¤ºä¸¤è€…åæ–¹å‘ï¼›

å¯¹äºå¤šç»´å‘é‡ç‚¹ç§¯ï¼Œä¹Ÿä¸€æ ·çš„è®¡ç®—æ–¹æ³•ã€‚åœ¨æ¸¸æˆä¸­åˆ©ç”¨ç‚¹ç§¯ï¼Œå¯ä»¥åˆ¤æ–­å¯¹æ‰‹æ˜¯å¦å¤„äºå¯è§†è§’åº¦ä¸Šã€‚

![between two vectors](https://docs.godotengine.org/en/3.5/_images/vector_dot3.png)


å‘é‡å‰ç§¯ a x b æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶æ¨¡é•¿ç­‰äºå‘é‡ a å’Œ b ç»„æˆçš„å¹³è¡Œå››è¾¹å½¢çš„é¢ç§¯ï¼Œä¸”æ–¹å‘å‚ç›´äºæ­¤å¹³é¢ï¼š

![Cross product](https://www.mathsisfun.com/algebra/images/cross-product-area.svg)
![Cross product](https://img2018.cnblogs.com/i-beta/1046925/202002/1046925-20200204181223998-1486309.png)

ä½¿ç”¨å³æ‰‹å®šåˆ™ç¡®å®šå‰ç§¯æ–¹å‘ï¼Œä½¿æ‹‡æŒ‡ã€é£ŸæŒ‡ã€ä¸­æŒ‡ç›¸äº’å‚ç›´ï¼Œä¾§æ‹‡æŒ‡ä»£è¡¨å‰ç§¯æŒ‡å‘ï¼Œé£ŸæŒ‡å’Œä¸­æŒ‡åˆ†åˆ«ä»£è¡¨ a å’Œ bã€‚
æ ¹æ®ç‚¹ç§¯å’Œå‰ç§¯çš„çº¿æ€§å…³ç³»å«ä¹‰ï¼Œåˆåˆ†åˆ«å°†å®ƒä»¬ç§°ä¸º Inner product å†…ç§¯ã€Outer product å¤–ç§¯ã€‚

åœ¨äºŒç»´å¹³é¢ä¸­ï¼Œå‰ç§¯å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼Œä½¿ç”¨å¤¹è§’å’Œå•ä½å‘é‡ï¼š

    a Ã— b = |a| |b| sin(Î¸) n

1. `|a|` is the magnitude (length) of vector a
2. `|b|` is the magnitude (length) of vector b
3. `Î¸` is the angle between a and b
4. `n` is the unit vector at right angles to both a and b

ä½¿ç”¨è¡Œåˆ—å¼è®¡ç®—äºŒç»´å‘é‡å‰ç§¯ï¼š

            | xâ‚ yâ‚ |
    a x b = |       | = xâ‚yâ‚‚ - yâ‚xâ‚‚
            | xâ‚‚ yâ‚‚ |

åœ¨äºŒç»´ç©ºé—´ä¸èƒ½è¡¨ç¤ºçš„å‰ç§¯ï¼Œæ”¾åœ¨åœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œéƒ½å¯ä»¥æŒ‰ä»¥è¡Œåˆ—å¼çš„æ–¹å¼è®¡ç®—ï¼Œå‡å®šå‘é‡èµ·ç‚¹ä¸ºåŸç‚¹ (0,0,0)ï¼Œ
å‘é‡ a = (xâ‚, yâ‚, zâ‚) å’Œå‘é‡ b = (xâ‚‚, yâ‚‚, zâ‚‚)ï¼Œé‚£ä¹ˆå¤–ç§¯è®¡ç®—å¯è¡¨ç¤ºä¸ºï¼š

            | i  j  k  |
    a x b = | xâ‚ yâ‚ zâ‚ | = (yâ‚zâ‚‚ - zâ‚yâ‚‚)i - (xâ‚zâ‚‚ - zâ‚xâ‚‚)j + (xâ‚yâ‚‚ - yâ‚xâ‚‚)k
            | xâ‚‚ yâ‚‚ zâ‚‚ |

å‘é‡å‰ç§¯åœ¨å›¾å½¢å­¦ä¸Šçš„ä½œç”¨ï¼š

- å¯ä»¥è®¡ç®—è¡¨é¢çš„æ³•å‘é‡ `N = (a x b)/|a x b|`ï¼›
- å¯ä»¥è®¡ç®—å¹³è¡Œå…­é¢ä½“çš„ä½“ç§¯ï¼›
- åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨åŒä¸€å¹³é¢ï¼Œä¸€ç‚¹åœ¨æ­¤å¹³é¢çš„å‘é‡å’Œæ³•å‘é‡åšç‚¹ç§¯å³å¯ä»¥åˆ¤æ–­ï¼›



### ğŸŸ ğŸ”µ Vector in Godot å‘é‡çš„åº”ç”¨
- [Advanced vector math](https://docs.godotengine.org/en/3.5/tutorials/math/vectors_advanced.html)

å•ä½å‘é‡ä½œä¸ºæ³•å‘é‡ Normal ä½¿ç”¨æ—¶ä¸ä»…å¯ä»¥ç”¨æ¥æŒ‡ç¤ºæ–¹å‘ï¼Œåˆ©ç”¨æ³•å‘é‡è¿˜å¯ä»¥ä½œå„ç§åº”ç”¨ï¼Œä¸é™äºä»¥ä¸‹è¿™äº›ï¼š

- é€šè¿‡æ³•å‘é‡æ±‚ç‚¹åˆ°é¢çš„è·ç¦»ï¼›
- é€šè¿‡æ³•å‘é‡æ±‚ç¢°æ’åŠ¨ä½œå“åº”æ–¹å‘ï¼›

å‡è®¾æœ‰ä¸€ä¸ªè¿‡åŸç‚¹çš„å¹³é¢ï¼Œæ³•å‘å¦‚å›¾æ‰€ç¤ºï¼š

![distance from the point to the plane](https://docs.godotengine.org/en/3.5/_images/tutovec11.png)
![distance from the point to the plane - Away from the origin](https://docs.godotengine.org/en/3.5/_images/tutovec12.png)

å°½ç®¡å›¾ç‰‡å±•ç¤ºçš„æ˜¯å¹³é¢æŠ•å½±åœ¨äºŒç»´çš„ä¸€æ¡ç›´çº¿ï¼Œä½†è¿™ä¸ªå¹³é¢åœ¨ 3D ä¸–ç•Œï¼Œå°†æ•´ä¸ªç©ºé—´åˆ†å‰²ä¸ºä¸Šä¸‹ä¸¤éƒ¨åˆ†ï¼Œä½¿ç”¨
2D ä¹Ÿä¸€æ ·å¯ä»¥æ¼”ç¤ºã€‚ç©ºé—´ä¸Šä»»ä½•ä¸€ç‚¹éƒ½å¯ä»¥ä¸è¿™ä¸ªæ³•å‘é‡åšç‚¹ç§¯è¿ç®—ï¼Œå¾—åˆ°çš„ç»“æœä¸ºç‚¹åˆ°å¹³é¢çš„è·ç¦»ã€‚åŸç†å°±æ˜¯ï¼Œ
å¯ä»¥å°†ç©ºé—´ä¸Šçš„ç‚¹çœ‹ä½œæ˜¯ä»åŸç‚¹æŒ‡å‘è¿™ä¸ªç‚¹çš„å‘é‡ Pï¼Œå’Œæ³•å‘é‡è¿›è¡Œç‚¹ç§¯ PÂ·Nï¼Œç»“æœå°±æ˜¯æ²¿ç€æ³•å‘ä¸Šçš„é•¿åº¦ç§¯ï¼Œ
ä¹Ÿå°±æ˜¯åˆ°å¹³é¢çš„è·ç¦»ã€‚å‘é‡ç‚¹ç§¯è¿ç®—ï¼Œå¯ä»¥äº¤æ¢ä¸¤å‘é‡ä½ç½®ï¼Œç»“æœè¿˜æ˜¯ä¸€æ ·ã€‚å’Œæ³•å‘é‡åšç‚¹ç§¯ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œæ²¿ç€
å‘é‡ P æ–¹å‘ä¸Šçš„é•¿åº¦ç§¯ï¼Œç»“æœè¿˜æ˜¯ä¸€æ ·å¤šã€‚æ— è®ºé€‰å–å“ªä¸ªæ–¹å‘ä½œå‚è€ƒï¼Œå¦å¤–ä¸€ä¸ªå‘é‡éƒ½éœ€è¦å…ˆå–å¾—ä¸‹æ¬¡æŠ•å½±ï¼Œå†
ç®—æ•°é‡ç§¯ã€‚åªæ˜¯è·ç¦»æœ‰æ­£è´Ÿå€¼ä¹‹åˆ†ï¼Œåœ¨æ³•å‘çš„ç©ºé—´ç‚¹ä¸ºæ­£è·ç¦»ï¼Œåå‘åˆ™ä¸ºè´Ÿè·ç¦»ã€‚

```py
var distance = normal.dot(point)
```

ç„¶è€Œï¼Œç©ºé—´ä¸Šçš„å¹³é¢å¹¶ä¸æ€»æ˜¯ç»è¿‡åŸç‚¹çš„ï¼Œå½“ç„¶è¿™ä¹Ÿä¸æ˜¯å¤§é—®é¢˜ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªåç§»è·ç¦» D å°±å¯ä»¥è§£å†³ã€‚è®°ä½ï¼Œ
å¹³é¢ä¸ä»…å°†ç©ºé—´ä¸€åˆ†ä¸ºäºŒï¼Œè€Œä¸”è¿˜å…·æœ‰ææ€§ã€‚å°±åƒæœ‰å®Œå…¨é‡å çš„ä¸¤ä¸ªå¹³é¢ï¼Œä½†å®ƒä»¬çš„è´ŸåŠç©ºé—´å’Œæ­£åŠç©ºé—´è¢«äº¤æ¢ã€‚
æ‰€ä»¥ Godot è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå°†æ•´ä¸ªå¹³é¢æè¿°ä¸ºæ³•çº¿ N å’Œè·åŸç‚¹æ ‡é‡ D çš„è·ç¦»ï¼Œå¹³é¢ç”± N å’Œ D è¡¨ç¤ºã€‚åŸºæœ¬ä¸Šï¼Œ
ä½¿ç”¨ N å’Œ D å¯ä»¥è¡¨ç¤ºç©ºé—´ä¸­çš„ä»»ä½•å¹³é¢ï¼Œæ— è®ºæ˜¯ 2D è¿˜æ˜¯ 3Dï¼Œå–å†³äº N çš„ç»´æ•°ï¼Œä¸¤è€…çš„æ•°å­¦åŸç†ç›¸åŒã€‚
ä»åŸç‚¹åˆ°å¹³é¢çš„å‘é‡å¯ä»¥è¡¨ç¤ºä¸º N * Dï¼Œä»»æ„ç‚¹åˆ°å¹³é¢çš„è·ç¦»åªéœ€è¦å‡å»åç§»å€¼ Dï¼Œè€Œåœ¨ **Plane** ç±»å‹çš„
æ–¹æ³•å®ç°ä¸­ï¼Œå·²ç»å¤„ç†äº†è¿™ä¸ªåç§»å€¼ï¼š

```py
# var point_in_plane = N*D
var distance = N.dot(point) - D

# The same thing, using a built-in function:
var distance = plane.distance_to(point)

var inverted_plane = -plane
```

ç¿»è½¬å¹³é¢çš„ææ€§å¯ä»¥é€šè¿‡ -N å’Œ -D æ¥å®Œæˆï¼Œè¿™ä½¿ç”¨å¹³é¢å¤„äºç›¸åŒä½ç½®ï¼Œä½†å…·æœ‰åè½¬çš„æ­£è´ŸåŠç©ºé—´ï¼Œè¿™ä¸ªå–å
è¿ç®—æ“ä½œå¯ä»¥ç›´æ¥åœ¨ **Plane** å¯¹è±¡ä¸Šæ‰§è¡Œï¼Œå®ƒå®ç°äº†å–åè¿ç®—ç¬¦ã€‚

æ‰€ä»¥ï¼Œè®°ä½ï¼Œå¹³é¢å°±æ˜¯è¿™æ ·ï¼Œå®ƒçš„ä¸»è¦å®é™…ç”¨é€”æ˜¯è®¡ç®—ç©ºé—´ç‚¹åˆ°å®ƒçš„è·ç¦»ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè®¡ç®—ç‚¹åˆ°å¹³é¢çš„è·ç¦»æœ‰ç”¨å‘¢ï¼Ÿ

å®ƒéå¸¸æœ‰ç”¨ï¼çœ‹ä¸€äº›ç®€å•çš„ä¾‹å­ï¼š

- åœ¨ 2D ç©ºé—´åˆ›å»ºå¹³é¢ï¼›
- åˆ¤æ–­ç©ºé—´ç‚¹æ˜¯å¦åœ¨å¹³é¢å†…ï¼›
- åˆ¤æ–­ 3D ç‰©ä½“æ˜¯å¦ç¢°æ’ï¼›

å¹³é¢æ˜¾ç„¶ä¸æ˜¯å‡­ç©ºè€Œæ¥çš„ï¼Œæ‰€ä»¥å¿…é¡»å»ºé€ ã€‚åœ¨ 2D ä¸­æ„å»ºå¹³é¢ï¼Œåªéœ€è¦æ³•çº¿ï¼ˆå•ä½å‘é‡ï¼‰å’Œä¸€ä¸ªç‚¹ï¼Œæˆ–è€…ç©ºé—´ä¸­
çš„ä¸¤ä¸ªç‚¹æ¥å†³å®šä¸€ä¸ªå¹³é¢ã€‚åœ¨æ³•çº¿å’Œç‚¹çš„æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†å·¥ä½œéƒ½å·²å®Œæˆï¼Œå› ä¸ºæ³•çº¿å·²ç»è®¡ç®—å®Œæ¯•ï¼Œæ‰€ä»¥åªéœ€æ³•çº¿
å’Œç‚¹ä¹‹é—´çš„ç‚¹ç§¯è®¡ç®— D å³å¯ã€‚

å¯¹äºé€šè¿‡ç©ºé—´ä¸­çš„ä¸¤ä¸ªç‚¹å»ºç«‹å¹³é¢ï¼Œæ„å›¾æ˜¯å…ˆé€šè¿‡ä¸¤ç‚¹è®¡ç®—æ³•å‘é‡ã€‚æ‰€ä»¥ï¼Œå®é™…ä¸Šæœ‰ä¸¤ä¸ªå¹³é¢ï¼Œåˆ†åˆ«ç©¿è¿‡è¿™ä¸¤ç‚¹ï¼Œ
å…±äº«ç›¸åŒçš„ç©ºé—´ï¼Œä½†æ³•çº¿æŒ‡å‘ç›¸åçš„æ–¹å‘ã€‚è¦ä»ä¸¤ç‚¹è®¡ç®—æ³•çº¿ï¼Œå¿…é¡»é¦–å…ˆè·å¾—æ–¹å‘å‘é‡ï¼Œç„¶åæ ¹æ®éœ€è¦å°†å…¶æ—‹è½¬
90Â° è‡³ä»»æ„ä¸€ä¾§ï¼š

```py
# Calculate direction vector from `a` to `b`.
var dvec = (point_b - point_a).normalized()
# Rotate 90 degrees.
var normal = Vector2(dvec.y, -dvec.x)
# Alternatively (depending the desired side of the normal):
# var normal = Vector2(-dvec.y, dvec.x)

var N = normal
var D = normal.dot(point_a)
# this works the same
# var D = normal.dot(point_b)
```

åœ¨ 3D ç©ºé—´ä¸Šæ“ä½œä¼šå¤æ‚ç‚¹ã€‚


å‘é‡åœ¨å›¾å½¢å­¦ä¸Šçš„ä¸€ä¸ªé‡è¦åº”ç”¨å°±æ˜¯åˆ¤æ–­ç‚¹æ˜¯å¦å¹³é¢å†…éƒ¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ Plane åº”ç”¨ä¾‹å­ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ª
å‡¸å¤šè¾¹å½¢ Convex polygonï¼Œæ²¡æœ‰é¢å‘å†…å¼¯æ›²çš„å¤šè¾¹å½¢ï¼Œä¾‹å¦‚ï¼ŒçŸ©å½¢ã€æ¢¯å½¢ã€ä¸‰è§’å½¢ã€‚

å¯¹äºå¤šè¾¹å½¢çš„æ¯ä¸€çº¿æ®µï¼Œè®¡ç®—ç»è¿‡è¯¥æ®µçš„å¹³é¢ã€‚ä¸€æ—¦å»ºç«‹äº†å¹³é¢åˆ—è¡¨ï¼Œå°±å¯ä»¥åšä¸€äº›ç®€å•çš„äº‹æƒ…ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥ç‚¹
æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…ã€‚é€è¿‡æ‰€æœ‰å¹³é¢ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ‰¾åˆ°ä¸€ä¸ªåˆ°è¯¥ç‚¹çš„è·ç¦»ä¸ºæ­£çš„å¹³é¢ï¼Œé‚£ä¹ˆè¯¥ç‚¹åœ¨å¤šè¾¹å½¢ä¹‹å¤–ã€‚å¦åˆ™ï¼Œ
ç‚¹å°±åœ¨å¹³é¢å†…éƒ¨ï¼Œå› ä¸ºå‡¸å¤šè¾¹å½¢çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿å¾—åªè¦å‡ºç°ä¸€æ¬¡è·ç¦»ä¸ºæ­£ï¼Œå°±å¯ä»¥ç¡®å®šç‚¹åœ¨å¤šè¾¹å¼€å¤–ã€‚

å‡¸å¤šè¾¹å½¢çš„ç‰¹æ€§åœ¨äºå‡¸é›† convex setï¼Œæ¯ä¸¤ç‚¹ä¹‹é—´çš„ç›´çº¿ä¸Šçš„ç‚¹éƒ½è½åœ¨è¯¥é›†åˆä¸­çš„ç‚¹é›†åˆã€‚

![Convex polygon](https://docs.godotengine.org/en/latest/_images/tutovec13.png)


```py
var inside = true
for p in planes:
    # check if distance to plane is positive
    if (p.distance_to(point) > 0):
        inside = false
        break # with one that fails, it's enough
```

å†æ”¹è¿›ä¸€ä¸‹ï¼Œç±»ä¼¼çš„é€»è¾‘å¯ä»¥ç”¨æ¥æ£€æµ‹ä¸¤ä¸ªå‡¸å¤šè¾¹å½¢æ˜¯å¦é‡å ï¼Œè¿™ç§°ä¸º Separating Axis Theorem (SAT)
åˆ†ç¦»è½´å®šç†ï¼Œå¤§å¤šæ•°ç‰©ç†å¼•æ“ä½¿ç”¨å®ƒæ¥æ£€æµ‹ç¢°æ’ã€‚åˆ†è½´ç†è®ºç”± Hermann Minkowski æå‡ºï¼Œå¯ç”¨äºè§£å†³å‡¸å¤šè¾¹å½¢
ç¢°æ’é—®é¢˜ï¼Œè¯¥ç†è®ºè¡¨æ˜ï¼šå¦‚æœå­˜åœ¨ä¸€æ¡è½´çº¿ï¼Œå‡¸é¢ä½“åœ¨è¯¥è½´ä¸Šçš„æŠ•å½±ä¸é‡å ï¼Œåˆ™å‡¸é¢ä½“é—´å°±ä¸é‡å ã€‚

å¯¹äºç‚¹ï¼Œä»…æ£€æŸ¥å¹³é¢æ˜¯å¦è¿”å›æ­£è·ç¦»å°±è¶³ä»¥åˆ¤æ–­è¯¥ç‚¹æ˜¯å¦åœ¨å¤–éƒ¨ã€‚å¯¹äºå¦ä¸€ä¸ªå¤šè¾¹å½¢ï¼Œå¿…é¡»æ‰¾åˆ°ä¸€ä¸ªå¹³é¢ï¼Œå…¶æ‰€æœ‰
ç‚¹åˆ°è¯¥å¹³é¢çš„è·ç¦»éƒ½ä¸ºæ­£å€¼ã€‚è¯¥æ£€æŸ¥å…ˆæ˜¯ç”¨ A å¹³é¢ä¸ B çš„ç‚¹è¿›è¡Œçš„æµ‹è¯•ï¼Œç„¶åç”¨ B å¹³é¢ä¸ A çš„ç‚¹è¿›è¡Œï¼š

![SAT & Convex](https://docs.godotengine.org/en/latest/_images/tutovec14.png)


```py
var overlapping = true

for p in planes_of_A:
    var all_out = true
    for v in points_of_B:
        if (p.distance_to(v) < 0):
            all_out = false
            break

    if (all_out):
        # a separating plane was found
        # do not continue testing
        overlapping = false
        break

if (overlapping):
    # only do this check if no separating plane
    # was found in planes of A
    for p in planes_of_B:
        var all_out = true
        for v in points_of_A:
            if (p.distance_to(v) < 0):
                all_out = false
                break

        if (all_out):
            overlapping = false
            break

if (overlapping):
    print("Polygons Collided!")
```

ä»¥ä¸Šæ˜¯ä½¿ç”¨å¹³é¢ç©ºé—´åˆ†å‰²å®ç°çš„åŸºæœ¬é€»è¾‘ï¼Œå¯¹äºéå‡¸é¢ä½“ï¼Œé€šå¸¸åªæ˜¯é€šè¿‡å°†å‡¹å¤šè¾¹å½¢åˆ†å‰²æˆè¾ƒå°çš„å‡¸å¤šè¾¹å½¢æ¥å¤„ç†ï¼Œ
æˆ–ä½¿ç”¨äºŒå‰ç©ºé—´åˆ†å‰² Binary Space Partitioning(BSP)ï¼ˆç°åœ¨å¾ˆå°‘ä½¿ç”¨ï¼‰ç­‰æŠ€æœ¯æ¥å¤„ç†ã€‚

é€šè¿‡å‡¸é¢ä½“ä¸Šçš„é¢æ¥æ£€æµ‹é‡å ç°è±¡ï¼Œè¿™ä¹Ÿé€‚ç”¨äº 3D åœºæ™¯ä¸­å¤šé¢ä½“çš„ç¢°æ’æ£€æµ‹ï¼Œæ— æ³•æ‰¾åˆ°åˆ†ç¦»å¹³é¢æ—¶å°±å‘ç”Ÿäº†ç¢°æ’ã€‚
å¦‚æœå‘ç°äº†åˆ†ç¦»å¹³é¢ï¼Œé‚£ä¹ˆè¿™äº›å½¢çŠ¶è‚¯å®šä¸ä¼šå‘ç”Ÿç¢°æ’ã€‚

ä½†æ˜¯ï¼Œåœ¨ 3D ç¯å¢ƒä¸­ï¼Œå­˜åœ¨è¿™ç§æƒ…å†µï¼Œå³æ‰¾ä¸åˆ°åˆ†ç¦»å¹³é¢ï¼Œä½†ç‰©ä½“ç¡®å®æ²¡æœ‰ç¢°æ’åœ¨ä¸€èµ·ï¼š

![box collision](https://docs.godotengine.org/en/latest/_images/tutovec22.png)
![box collision](https://docs.godotengine.org/en/latest/_images/tutovec23.png)

è¿™ç§æƒ…å†µï¼Œéœ€è¦æ·»åŠ é¢å¤–çš„å¹³é¢ä½œä¸ºåˆ†ç¦»å¹³é¢ï¼Œè¿›è¡Œæµ‹è¯•ã€‚è¿™äº›å¹³é¢æ‰€åœ¨æ˜¯å¤šè¾¹å½¢ A çš„è¾¹å’Œ B çš„è¾¹ä¹‹é—´çš„å‰ç§¯ï¼Œ
å³å‚ç›´äºè¿™äº›è¾¹ç¡®å®šçš„å¹³é¢ã€‚


### ğŸŸ ğŸ”µ Vector & Normal Mapping å‘é‡ä¸æ³•çº¿è´´å›¾
- [Tangent Space Normal Mapping](https://docs.cryengine.com/display/SDKDOC4/Tangent%2BSpace%2BNormal%2BMapping)
- [Normal map (Bump mapping)](https://docs.unity.cn/2020.3/Documentation/Manual/StandardShaderMaterialParameterNormalMap.html)
- [LearnOpenGL Advanced Lighting - Normal Mapping](https://learnopengl.com/Advanced-Lighting/Normal-Mapping)
- [Real Shading in UE4 by Brian Karis, Epic Games](https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf)
- [Real-Time Rendering, Fourth Edition](http://www.realtimerendering.com/)
- OpenGL Programming Guide Eighth Edition - The Official Guide to Learning OpenGL, Version 4.3

3D æ¸²æŸ“ä¸­å¦‚æœæ¨¡å¼åˆ¶ä½œè¦çœŸå®ï¼Œé‚£ä¹ˆå°±ä¼šéœ€è¦å·¨å¤§é‡çš„ç½‘æ ¼ Mesh é¢æ•°ï¼Œè¿™ç›´æ¥ç»™ GPU æ¸²æŸ“æµæ°´çº¿å‡ºäº†ä¸€é“
æ€§èƒ½éš¾é¢˜ã€‚ä¸ºäº†ç»™ GPU å‡è½»è´Ÿæ‹…ï¼Œé€šå¸¸å¯ä»¥é‡‡ç”¨æè´¨è´´å›¾çš„æ–¹å¼æ¥å¢åŠ æ¨¡å‹çš„çœŸå®æ„Ÿï¼ŒåŒæ—¶å¤§é™ä½æ¨¡å‹é¢æ•°ã€‚
ä¸ºäº†æä¾›æ›´è½»é‡åŒ–çš„çœŸå®å‡¹å‡¸æ„Ÿï¼Œå¯ä»¥ä½¿ç”¨æ³•çº¿è´´å›¾ Normal Textureï¼Œè¿˜æœ‰ç½®æ¢æ˜ å°„ Displacement Mappingï¼Œ
è§†å·®æ˜ å°„ Parallax Mapping ç­‰æŠ€æœ¯ï¼Œå®ƒä»¬éƒ½å±äºå‡¹å‡¸æ˜ å°„èŒƒç•´ï¼Œ**Bump Map**ï¼Œéƒ½åŸºäº Normal Mapã€‚

å¦‚ä¸‹å›¾ï¼ŒNormal Maps, Height Maps éƒ½è¡¨ç¤ºç®€å•å¤šè¾¹å½¢ç½‘æ ¼è¡¨é¢ä¸Šçš„ç»†èŠ‚çš„æ•°æ®ï¼Œä½†å­˜å‚¨æ•°æ®æ–¹å¼ä¸åŒã€‚

![Height Maps vs. Normal Maps](https://docs.unity.cn/2020.3/Documentation/uploads/Main/BumpMapHeightMapNormalMapComparison.jpg)

åœ¨ç°ä»£æ¸¸æˆå¼€å‘è‰ºæœ¯å·¥ä½œæµç¨‹ä¸­ï¼Œè‰ºæœ¯å®¶å°†ä½¿ç”¨ä»–ä»¬çš„ 3D å»ºæ¨¡ç¨‹åºï¼ŒåŸºäºéå¸¸é«˜åˆ†è¾¨ç‡çš„æºæ¨¡å‹ç”Ÿæˆæ³•çº¿è´´å›¾ã€‚
ç„¶ååœ¨æ¸¸æˆå‘è¡Œç‰ˆæœ¬ä¸Šä½¿ç”¨ä½åˆ†è¾¨ç‡æ¨¡å‹ï¼Œå¹¶å°†æ³•çº¿è´´å›¾æ˜ å°„åœ¨æ¨¡å‹ä¸Šï¼Œé€šè¿‡æ³•çº¿è´´å›¾æ¸²æŸ“åŸå§‹çš„é«˜åˆ†è¾¨ç‡ç»†èŠ‚ã€‚

![Normal mapping across three polygons, viewed as a 2D diagram](https://docs.unity.cn/2020.3/Documentation/uploads/Main/BumpMapBumpShadingDiagram.svg)

ç¤ºæ„å›¾ä¸Šï¼Œä¸Šé¢çš„é»‘è‰²é•¿çº¿æ¡è¡¨ç¤ºç‰©ä½“è¡¨é¢ï¼Œç»¿è‰²çº¿æ¡è¡¨ç¤º Smooth shading æ¨¡å¼ä¸‹çš„å¹³æ»‘æ³•çº¿èµ°å‘ï¼Œè¡¨é¢
äº¤æ¥ç‚¹çš„çº¢è‰²ç®­å¤´å°±æ˜¯é¡¶ç‚¹çš„æ³•å‘é‡ã€‚ä¸‹é¢çš„åç´«è‰²æ–¹å—è¡¨ç¤ºæ³•çº¿è´´å›¾ä¸Šçš„åƒç´ å€¼ï¼Œä»¥åŠåƒç´ å¯¹åº”çš„æ³•çº¿å‘é‡ã€‚

æ³•çº¿å‘é‡ Normal Vector æ˜¯å½±å“å…‰çš„æŠ˜å°„ä¼ æ’­çš„å‚è€ƒå‘é‡ï¼Œæ¯ä¸ªç½‘æ ¼çš„é¡¶ç‚¹ Vertexï¼Œæˆ–è€…ç½‘æ ¼æ„æˆçš„é¢éƒ½
æœ‰ä¸€ä¸ªæ³•çº¿å‘é‡æŒ‡ç¤ºå®ƒä»¬çš„æœå‘ï¼Œæ”¹å˜æ³•çº¿å‘é‡å°±ä¼šæ”¹å˜è¿™ä¸ªé¢çš„å…‰ç…§ç»†èŠ‚å‘ˆç°ã€‚


å‡ ä¹æ‰€æœ‰å¼•æ“éƒ½ä¼šæä¾›é»˜è®¤æ”¯æŒæ³•çº¿è´´å›¾çš„æè´¨åŠŸèƒ½ï¼Œæ³•çº¿è´´å›¾æ˜¯ä¸€å¼ ä¿å­˜æ³•çº¿ä¿¡æ¯çš„å›¾ç‰‡æ–‡ä»¶ï¼Œç›´æ¥æ‰“å¼€çœ‹èµ·æ¥
å°±æ˜¯ç´«è‰²è°ƒçš„å›¾åƒï¼Œæˆ–è€…æ˜¯å¤šå½©çš„å›¾åƒï¼Œè¿™å–å†³äºæ³•çº¿è´´å›¾é‡‡ç”¨çš„æ ¼å¼æˆ–è€…å‚è€ƒåæ ‡ï¼š

- World Space Normal Mapping
- Object Space Normal Mapping
- Tangent Space Normal Mapping

åœ¨ 3D åœºæ™¯ä¸­æ¯ä¸ªç‰©ä½“æ¯ä¸ªé¢çš„æœå‘éƒ½ä¸åŒï¼Œæ³•çº¿æŒ‡å‘ä¹Ÿå˜åŒ–å¤šç«¯ï¼Œä¸èƒ½ä»¥å›ºå®šæ–¹å‘çš„å½¢å¼ä¿å­˜æ³•å‘é‡ã€‚æ‰€ä»¥ä½¿ç”¨
ä¸–ç•Œç©ºé—´ World Space ä¿å­˜çš„æ³•çº¿è´´å›¾ï¼Œåªæœ‰åœ¨åœºæ™¯ä¸æ”¹å˜ï¼Œè¡¨é¢ä¿æŒåŸæ¥æœå‘æ‰é€‚ç”¨ã€‚

å¯¹äºå¤æ‚æ¨¡å‹ç¡®å®å¯ä»¥æŠŠæœå‘å„ä¸ªæ–¹å‘çš„æ³•çº¿å‚¨å­˜åœ¨åŒä¸€å¼ è´´å›¾ä¸Šï¼Œä½ å¯èƒ½çœ‹åˆ°è¿‡ä¸åªæ˜¯è“è‰²çš„æ³•çº¿è´´å›¾ï¼Œä¸è¿‡
ç”¨é‚£æ ·çš„æ³•çº¿è´´å›¾æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œå¿…é¡»è®°ä½æ¨¡å‹çš„èµ·å§‹æœå‘ï¼Œå¦‚æœæ¨¡å‹è¿åŠ¨äº†è¿˜è¦è®°å½•æ¨¡å‹çš„å˜æ¢ï¼Œè¿™éå¸¸ä¸æ–¹ä¾¿ï¼Œ
è¿™å°±æ˜¯ Object space æ³•çº¿è´´å›¾çš„å¼Šç«¯ã€‚

å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨åˆ‡çº¿ç©ºé—´ Tangent Spaceï¼Œè¿™ä¸ªåæ ‡ç©ºé—´é‡Œï¼Œæ³•çº¿è´´å›¾ä¸­ä¿å­˜çš„å‘é‡æ€»æ˜¯æŒ‡å‘ +Z æ–¹å‘ï¼Œ
æ‰€æœ‰çš„æ³•çº¿å‘é‡éƒ½ç›¸å¯¹ä¸è¿™ä¸ª +Z æ–¹å‘è¿›è¡Œå˜æ¢ï¼Œè¿™æ ·å°±èƒ½å§‹ç»ˆä½¿ç”¨åŒæ ·çš„æ³•çº¿è´´å›¾ï¼Œè€Œä¸ç®¡æœå‘é—®é¢˜ã€‚æ‰€è°“åˆ‡çº¿ï¼Œ
å³å‚ç›´æ–¹å‘çš„çº¿ï¼Œå¦‚åœ¨ä¸€ä¸ªåœ†çš„è¡¨é¢ï¼Œåˆ‡çº¿å°±æ˜¯è¿‡åœ†è¾¹ä¸Šä¸€ç‚¹çš„ç›´çº¿ï¼Œå¹¶ä¸”è¿™ä¸ªæ¡ä¸è¿™ç‚¹åˆ°åœ†å¿ƒä¹‹é—´çš„è¿çº¿å‚ç›´ã€‚
æ‰€ä»¥ï¼Œåˆ‡çº¿ç©ºé—´ä¸Šçš„å‘é‡éƒ½ç›¸å¯¹äºç‰©ä½“è¡¨é¢æ³•å‘é‡ï¼Œè¿™ç§æ³•çº¿è´´å›¾äº§ç”Ÿçš„è‰²è°ƒæ˜¯åè“è‰²çš„ï¼Œå› ä¸ºæ‰€æœ‰æ³•çº¿çš„åŸºæœ¬æŒ‡å‘
éƒ½åå‘ Z è½´ï¼ˆ0, 0, 1ï¼‰ï¼Œå¯¹äºæ³•çº¿æ˜ å°„è€Œè¨€ï¼Œè¯¥çŸ¢é‡ä¸ºâ€œå‘ä¸Šâ€ï¼Œè¡¨ç¤ºæ¨¡å‹è¡¨é¢æ²¡æœ‰å˜åŒ–ã€‚

ä¸ºäº†å°†æ³•çº¿å‘é‡ä¿å­˜åˆ°è´´å›¾æ–‡ä»¶ä¸­åƒç´ ä¸­çš„ RGB ä¸‰ä¸ªåˆ†é‡ä¸­ï¼Œåˆ™éœ€è¦å°† XYZ åæ ‡å–å€¼èŒƒå›´ [-1, 1] é‡æ–°æ˜ å°„
åˆ° OpenGL ä¸­é€šå¸¸ä½¿ç”¨çš„ RGBA æµ®ç‚¹æ•°è¡¨ç¤ºèŒƒå›´ [0.0, 1.0]ã€‚æ‰€ä»¥ï¼Œä¸ºäº†è¡¨ç¤ºè´Ÿå€¼ï¼Œ(0, 0, 1ï¼‰ä¼šæ˜ å°„ä¸º
(0.5,0.5,1)ï¼Œå³ RGB(127,127,255)ï¼Œå°±æ˜¯è“è‰²åˆ†é‡ä¸ºä¸»è‰²è°ƒçš„åƒç´ å€¼ã€‚

åœ¨ç€è‰²å™¨ä¸­è¯»å–æ³•çº¿è´´å›¾æ—¶ï¼Œå°±éœ€è¦å°† RGB åˆ†é‡é‡æ–°æ˜ å°„ä¸º [-1, 1] åŒºé—´ï¼š

```c
// transforms from [-1,1] to [0,1]
// vec3 rgb_normal = normal * 0.5 + 0.5;

// obtain normal from normal map in range [0,1]
normal = texture(normalMap, fs_in.TexCoords).rgb;
// transform normal vector to range [-1,1]
normal = normalize(normal * 2.0 - 1.0);   
```

åˆ‡çº¿ç©ºé—´çš„æ³•å‘å°±æ˜¯ Z è½´æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯ç‰©ä½“è¡¨é¢æ³•å‘é‡æ‰€æŒ‡çš„æ–¹å‘ï¼Œæ— è®ºæ˜¯ä»€ä¹ˆç‰©ä½“çš„è¡¨é¢ï¼Œéƒ½é€šè¿‡è®¡ç®—ï¼Œå°†
æ³•çº¿è´´å›¾çš„åæ ‡å¯¹åº”åˆ°è¡¨é¢ã€‚å¹¶ä¸”è¡¨é¢çš„å‡¹å‡¸ä¸å¹³çš„ç‚¹å¯¹åº”çš„æ³•å‘é‡æŒ‰ Z è½´è¿™ä¸ªåŸºæœ¬æŒ‡å‘è¿›è¡Œåç§»ï¼Œå°±å¯ä»¥æ§åˆ¶
æ¨¡å‹è¡¨é¢æ³•çº¿çš„åç§»ã€‚

ç®—æ³•ä¸Šç”¨ä¸€ä¸ª TBN çŸ©é˜µå°±èƒ½å°†åˆ‡çº¿ç©ºé—´ä¸­çš„æ³•çº¿å‘é‡åæ ‡è½¬æˆä¸–ç•Œåæ ‡ï¼Œä½¿å®ƒä»¬è½¬å‘åˆ°æœ€ç»ˆçš„è´´å›¾è¡¨é¢çš„æ–¹å‘ã€‚
å…ˆåœ¨ä¸–ç•Œç©ºé—´å®šä¹‰ä¸‰ä¸ªè½´ï¼ŒTangantï¼ˆTï¼‰ã€Bitangentï¼ˆBï¼‰åŠæ³•çº¿è½´ï¼ˆNï¼‰ï¼ŒTBN æ„æˆä¸€ä¸ª 3x3 çš„çŸ©é˜µã€‚
ç›´è§‚åœ°è®²ï¼Œæ¨¡å‹é¡¶ç‚¹ä¸­çš„çº¹ç†åæ ‡ï¼Œå°±å’Œåˆ‡å‘å…±å¹³é¢ï¼Œå³äºŒç»´çš„ UV çº¹ç†åæ ‡ï¼Œåˆ†åˆ«å¯¹åº”åˆ‡çº¿ç©ºé—´ TB ä¸¤è½´ã€‚
æ¨¡å‹ä¸­ä¸åŒçš„ä¸‰è§’é¢ï¼Œéƒ½æœ‰å¯¹åº”çš„åˆ‡çº¿ç©ºé—´ï¼ŒTB ä¸¤è½´æ‰€ç¡®å®šçš„å¹³é¢å°±æ˜¯ä¸‰è§’å½¢æ‰€åœ¨å¹³é¢ï¼ŒN ç­‰ä»·å¹³é¢æ³•å‘é‡ã€‚

TBN æ˜¯è½¬æ¢çŸ©é˜µï¼Œå¹¶ä¸”æ˜¯æ­£äº¤çŸ©é˜µï¼Œå³çŸ©é˜µè½¬ç½®å°±æ˜¯é€†çŸ©é˜µï¼Œå®ƒå°†åˆ‡çº¿ç©ºé—´çš„å‘é‡åæ ‡å˜æ¢ä¸ºå…¶ä»–ç©ºé—´çš„åæ ‡ã€‚

                [ Tx Bx Nx ]
    [T, B, N] = [ Ty By Ny ]
                [ Tz Bz Nz ]

![TBN vectors](https://learnopengl.com/img/advanced-lighting/normal_mapping_tbn_vectors.png)
![Normal mapping surface edges](https://learnopengl.com/img/advanced-lighting/normal_mapping_surface_edges.png)

è®¡ç®—åˆ‡å‘é‡å’Œå‰¯åˆ‡å‘é‡ä¸åƒæ³•å‘é‡é‚£æ ·ç®€å•ï¼ŒåŸºäºæ³•çº¿è´´å›¾çš„åˆ‡çº¿å’Œå‰¯åˆ‡çº¿çš„æ–¹å‘ä¸å®šä¹‰æ›²é¢ UV çº¹ç†åæ ‡å¯¹é½
çš„è¿™ä¸ªäº‹å®ï¼Œå¯ä»¥ç”¨ UV åæ ‡æ¥è®¡ç®—æ¯ä¸ªæ›²é¢çš„åˆ‡çº¿å’Œå‰¯çº¿å‘é‡ã€‚

```c
// git@github.com:JoeyDeVries/LearnOpenGL.git
// \src\6.pbr\1.2.lighting_textured\1.2.pbr.fs
// ----------------------------------------------------------------------------
// Easy trick to get tangent-normals to world-space to keep PBR code simplified.
// Don't worry if you don't get what's going on; you generally want to do normal 
// mapping the usual way for performance anways; I do plan make a note of this 
// technique somewhere later in the normal mapping tutorial.
vec3 getNormalFromMap()
{
    vec3 tangentNormal = texture(normalMap, TexCoords).xyz * 2.0 - 1.0;

    vec3 Q1  = dFdx(WorldPos);
    vec3 Q2  = dFdy(WorldPos);
    vec2 st1 = dFdx(TexCoords);
    vec2 st2 = dFdy(TexCoords);

    vec3 N   = normalize(Normal);
    vec3 T  = normalize(Q1*st2.t - Q2*st1.t);
    vec3 B  = -normalize(cross(N, T));
    mat3 TBN = mat3(T, B, N);

    return normalize(TBN * tangentNormal);
}
```

GLSL åå¯¼æ•°å‡½æ•°ï¼ˆHLSL: ddx ddyï¼ŒGLSL: dFdx dFdyï¼‰åœ¨ç‰‡å…ƒç€è‰²å™¨ä¸­çš„ç”¨äºè®¡ç®—ä»»ä½•å˜é‡åŸºäºå±å¹•ç©ºé—´åƒç´ å˜åŒ–ç‡çš„å˜åŒ–ç‡ã€‚ 
dFdx, dFdy â€” return the partial derivative of an argument with respect to x or y
- [An introduction to shader derivative functions](http://www.aclockworkberry.com/shader-derivative-functions/)

- dFdx(v) = è¯¥åƒç´ ç‚¹å³è¾¹çš„vå€¼ - è¯¥åƒç´ ç‚¹çš„vå€¼ // v å¯ä»¥æ˜¯ä»»æ„å€¼
- dFdy(v) = è¯¥åƒç´ ç‚¹ä¸‹é¢çš„vå€¼ - è¯¥åƒç´ ç‚¹çš„vå€¼
- fwidthï¼ˆvï¼‰ = abs( dFdx(v) + dFdy(v))

![Shader partial derivative functions](http://www.aclockworkberry.com/wp-content/uploads/2016/02/Shader-Derivatives-1.png)


åˆ‡çº¿ç©ºé—´çš„ä¼˜ç‚¹æœ‰å‡ ä¸ªï¼Œç”±äºæ³•çº¿çš„å•ä½é•¿åº¦å±æ€§å’Œé™åˆ¶ Z å§‹ç»ˆä¸ºæ­£ï¼Œé‡å»ºä¸€ä¸ª Z åˆ†é‡åªéœ€è¦å­˜å‚¨ä¸¤ä¸ªåˆ†é‡ï¼Œ
å†…å­˜ä¸Šå°±èŠ‚çœäº† 2 ä¸ªå­—èŠ‚è€Œä¸æ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œå¦å¤–ä¸€ä¸ªå­—èŠ‚é€šå¸¸ç”¨äºå¯¹é½ã€‚å¹¶ä¸”æœ‰å¤šç§ GPU æ”¯æŒçš„æ ¼å¼ï¼Œ
ç”¨äº 2 é€šé“çº¹ç†ï¼Œé€šå¸¸ä¸º 1 å­—èŠ‚è€Œä¸æ˜¯ 2 å­—èŠ‚ã€‚è¿™äº›æ ¼å¼èŠ‚çœå†…å­˜ï¼Œå‡å°‘å†…å­˜å¸¦å®½ï¼Œå¹¶ä¸”è§£å‹ç¼©æˆæœ¬ä¹Ÿå¾ˆä½ï¼Œ
å› æ­¤ä½¿ç”¨å®ƒä»¬å¯ä»¥æé«˜æµå’Œæ¸²æŸ“æ€§èƒ½ã€‚

ç”±äºåˆ‡çº¿ç©ºé—´æ³•çº¿æ€»æŒ‡å‘è¡¨é¢å¤–éƒ¨ï¼Œå› æ­¤å‡å®šå•ä½é•¿åº¦ï¼Œå¯ä»¥ä» X å’Œ Y åˆ†é‡é‡å»ºæ³•çº¿ Z åæ ‡ã€‚åæ ‡ä» 0..1 
æ‰©å±•åˆ° -1..1 èŒƒå›´åï¼Œå°±å¯ä»¥è®¡ç®— Z = sqrt(1 - XÂ²+YÂ²)ã€‚è¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªé€šé“çº¹ç†æ¥å­˜å‚¨æ³•çº¿è´´å›¾ï¼Œ
æ¯ä¸ªçº¹ç†åƒç´ ä¸º 2 ä¸ªå­—èŠ‚ï¼Œå¤§å¤§æé«˜äº†çº¹ç†å‹ç¼©æ€§èƒ½ã€‚

åˆ‡çº¿ç©ºé—´æ ¼å¼çš„æ³•çº¿è´´å›¾ç‹¬ç«‹äºåŸºç¡€å‡ ä½•ä½“ï¼Œå³çº¹ç†ä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–å‡ ä½•ä½“ï¼Œæ— è®ºé•œåƒã€æ—‹è½¬ã€ç¼©æ”¾æˆ–å¹³ç§»å¦‚ä½•ï¼Œ
å®ƒéƒ½å°†è‡ªåŠ¨ä¸æ›²é¢å¯¹é½ã€‚è€Œä½¿ç”¨å¯¹è±¡ç©ºé—´ï¼Œæˆ–ä¸–ç•Œç©ºé—´çš„æ³•çº¿è´´å›¾ä»…æ”¯æŒåä¸¤è€…ã€‚å‡ ä½•ç‹¬ç«‹æ€§å…è®¸é«˜æ•ˆé‡ç”¨ï¼Œä¾‹å¦‚ï¼Œ
ä»¥å¹³é“ºæ³•çº¿è´´å›¾çš„å½¢å¼ï¼Œä»è€ŒèŠ‚çœæ›´å¤šå†…å­˜å¹¶å‡å°‘ç”Ÿäº§æ—¶é—´ã€‚

åˆ‡çº¿ç©ºé—´æ³•çº¿æ˜ å°„çš„åŸºæœ¬æ€æƒ³ä¹Ÿæœ‰å…¶ç¼ºé™·ï¼Œå¯¹è‰ºæœ¯å®¶æ¥è¯´ï¼Œæ‹†å¼€å¤æ‚æ¨¡å‹å¹¶å°†æ¥ç¼æ”¾åœ¨æš´éœ²è¾ƒå°‘çš„åŒºåŸŸä¼šå¾ˆæ£˜æ‰‹ã€‚

å¯¹äºåœºæ™¯ä¸­ä¸€ä¸ª XY å¹³é¢ä¸Šçš„è¡¨é¢ï¼Œæ³•çº¿è´´å›¾çš„åƒç´ é¢œè‰²å¤§æ¦‚å¯¹åº”çš„æ³•çº¿æ–¹å‘å¦‚ä¸‹ï¼Œæ³•çº¿å‘é‡çš„ XY åç§»é‡å¯¹åº”
RGB ä¸­çš„ RG åˆ†é‡ï¼Œæ‰‹ç»˜æ³•çº¿è´´å›¾å¯ä»¥å‚è€ƒï¼š

- (0.5, 0.5, 1.0) å‚ç›´å‘å¤–ï¼Œæµ…è“ï¼›
- (0.5, 1.0, 0.6) æŒ‡å‘å—è¾¹ï¼Œæµ…ç»¿ï¼›
- (1.0, 0.5, 0.6) æŒ‡å‘ä¸œè¾¹ï¼Œç²‰çº¢ï¼›
- (1.0, 0.0, 0.6) æŒ‡å‘ä¸œåŒ—ï¼Œç´«çº¢ï¼›
- (0.0, 1.0, 0.6) æŒ‡å‘è¥¿å—ï¼Œé’è‰²ï¼›

åªè¦é¢æ³•å‘å¸¦è“è‰²ï¼Œé‚£ä¹ˆæ³•çº¿å°±æ˜¯æœå¤–çš„ï¼Œæ­£å¸¸ã€‚ä¸å¸¦è“è‰²åˆ†é‡ï¼Œå°±æœå‘å†…è¡¨é¢ã€‚






### ğŸŸ ğŸ”µ Matrix & Determinant çŸ©é˜µä¸è¡Œåˆ—å¼
- [Linear Algebra](https://www.3blue1brown.com/topics/linear-algebra)
- [Solving Systems of Linear Equations Using Matrices](https://www.mathsisfun.com/algebra/systems-linear-equations-matrices.html)
- [Solving Systems of Linear Equations Using Matrices zh_CN](https://www.shuxuele.com/algebra/systems-linear-equations-matrices.html)
- [Determinant of a Matrix](https://www.mathsisfun.com/algebra/matrix-determinant.html)
- [Matrix Calculator](https://www.mathsisfun.com/algebra/matrix-calculator.html)
- [Determinant](https://www.math.net/determinant)
- [Matrix](https://www.math.net/matrix)

çº¿æ€§ä»£æ•°ä¹‹æ‰€ä»¥å«çº¿æ€§ä»£æ•°ï¼Œå› ä¸ºå®ƒå°±æ˜¯ç”¨æ¥è§£å†³çº¿æ€§é—®é¢˜çš„ï¼Œè€Œçº¿æ€§é—®é¢˜å¯ä»¥ç†è§£ä¸ºï¼Œèƒ½ç”¨äºŒç»´åæ ‡ä¸­çš„çº¿æ¡è¡¨ç¤ºçš„é—®é¢˜ã€‚

åˆ—è¡¨æœ‰ä¸€ç³»åˆ—é£Ÿå“ï¼š

|    é£Ÿå“   |  å•ä»· |
|-----------|------|
| Apple     | $3   |
| Cherry    | $4   |
| Blueberry | $2   |

é”€å”®é‡ï¼š

|           | Mon | Tue | Wed | thu |
|-----------|-----|-----|-----|-----|
| Apple     | 13  | 9   | 7   | 15  |
| Cherry    | 8   | 7   | 4   | 6   |
| Blueberry | 6   | 4   | 0   | 3   |
| Count     | $83 | $63 | $37 | $75 |

æŠŠå®ƒä»¬å½“ä½œä¸¤ä¸ªåªæœ‰ä¸€è¡Œçš„çŸ©é˜µï¼Œè®¡ç®—å‘¨ä¸€çš„é”€å”®é¢ï¼Œå°±æ˜¯ç‚¹ç§¯ dot productã€‚åè¿‡æ¥ï¼Œå‡å¦‚çŸ¥é“å½“å¤©çš„é”€å”®é¢ï¼Œ
è€Œä¸çŸ¥é“æŸä¸€ä¸ªé”€å”®é‡ï¼Œè¿™å°±ä¸€ä¸ªå…¸å‹çš„çº¿æ€§ä»£æ•°é—®é¢˜ã€‚

    ($3, $4, $2) â€¢ (13, 8, 6) = $3Ã—13 + $4Ã—8 + $2Ã—6 = $83

æ³¨æ„ä¸€ç‚¹ï¼Œå®é™…ä¸Šç¬¬äºŒä¸ªåœ†æ‹¬å·çš„å†…å®¹åº”è¯¥æ˜¯ç«–ç›´æ–¹å‘ä¹¦å†™çš„ï¼Œå› ä¸ºçŸ©é˜µä¹˜æ³•æ˜¯ä¸€è¡Œä¹˜ä¸€åˆ—ï¼Œæ¯è¡Œå…ƒç´ å’Œåè€…çš„
æ¯åˆ—å…ƒç´ åŒ¹é…ã€‚è¿™é‡Œä¸ºäº†ç®€ä¾¿ï¼Œå°±æ²¡æœ‰æŒ‰ç…§æ•°å­¦ä¸Šçš„ä¹ æƒ¯ä¹¦å†™ã€‚

çŸ©é˜µï¼ˆMatrixï¼‰æ˜¯ä¸€ä¸ªé˜µåˆ—æ’åˆ—çš„å¤æ•°æˆ–å®æ•°é›†åˆï¼Œå…ƒç´ æ˜¯å®æ•°çš„çŸ©é˜µç§°ä¸ºå®çŸ©é˜µï¼Œå…ƒç´ æ˜¯å¤æ•°çš„çŸ©é˜µç§°ä¸ºå¤çŸ©é˜µã€‚
æ³¨æ„ï¼Œ"å› ä¸ºè¿™ç§è¡¨è¾¾æ–¹å¼æœ‰è¡Œæœ‰ä¾‹ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºè¡Œåˆ—å¼"è¿™ç§ç”±äºåå­—æš—ç¤ºå¾—å‡ºçš„æ˜¯é”™è¯¯çš„ç†è§£ã€‚

è¿™ç§ï¼Œç”¨çŸ©é˜µçš„è¡Œã€åˆ—ä¸­çš„å„ä¸ªæ•°ç›¸ä¹˜å†ç›¸åŠ çš„å¾—åˆ°çš„å€¼å«è¡Œåˆ—å¼ The determinantï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ç§å½¢è±¡çš„
åç§°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä»¤äººè´¹è§£çš„åå­—ã€‚

ç®€å•çš„è¯´ï¼Œè¡Œåˆ—å¼å°±æ˜¯ä¸€ä¸ªå®šä¹‰åœ¨æ–¹é˜µä¸Šçš„å‡½æ•° det: â„^(nÃ—n) â†’ â„ï¼Œåªæ˜¯åå­—ç¿»è¯‘ä½œè¡Œåˆ—å¼ã€‚è¡Œåˆ—å¼è¿™ä¸ªå€¼
å¯ä»¥å¸®åŠ©å¯»æ‰¾åˆ°çŸ©é˜µçš„é€†çŸ©é˜µï¼Œthe inverse of a matrixï¼ŒçŸ©é˜µåœ¨çº¿æ€§æ–¹ç¨‹ã€å¾®ç§¯åˆ†ç­‰ç³»ç»Ÿä¸­æœ‰ç”¨çš„ä¸œè¥¿ã€‚

- ä»…å½“è¡Œåˆ—å¼ â‰  0 æ—¶ï¼ŒçŸ©é˜µæ‰å¯é€†ã€‚
- çº¿æ€§æ–¹ç¨‹ç»„ç³»æ•°çŸ©é˜µçš„è¡Œåˆ—å¼ â‰  0ï¼Œåˆ™æ–¹ç¨‹ç»„æœ‰å”¯ä¸€çš„è§£ï¼›å¦‚æœä¸º 0ï¼Œåˆ™æ–¹ç¨‹ç»„æ— è§£æˆ–æœ‰ä¸åŒçš„è§£ã€‚

çŸ©é˜µä¸è¡Œåˆ—å¼çš„åŒºåˆ«æœ‰å››ç‚¹ï¼Œä¸‹é¢å°±æ˜¯å…·ä½“ä»‹ç»ï¼š

- æœ¬è´¨ä¸Šï¼ŒçŸ©é˜µæ˜¯ä¸€ä¸ªæ•°è¡¨ï¼ŒåŒ…å«çº¿æ€§ç©ºé—´ä¸­çš„å…ƒç´ ï¼›è€Œè¡Œåˆ—å¼æ˜¯ä¸€ä¸ªæ•°å€¼ï¼Œn é˜¶çš„æ–¹é˜µã€‚
- ç¬¦å·ä¸Šï¼ŒçŸ©é˜µç”¨èŠ±æ‹¬å·è¡¨ç¤ºï¼Œè¡Œåˆ—å¼ç”¨åŒç«–çº¿è¡¨ç¤ºã€‚
- ç»“æ„ä¸Šï¼ŒçŸ©é˜µçš„è¡Œæ•°å’Œåˆ—æ•°å¯ä»¥ä¸ä¸€æ ·ï¼Œè¡Œåˆ—å¼çš„è¡Œæ•°ä¸åˆ—æ•°ä¸€è‡´ã€‚
- è¿ç®—ä¸Šï¼Œä¸€ä¸ªæ•°ä¹˜ä»¥è¡Œåˆ—å¼ï¼Œåªèƒ½ä¹˜ä»¥è¡Œåˆ—å¼çš„ä¸€è¡Œæˆ–è€…ä¸€åˆ—ã€‚ä¸€ä¸ªæ•°ä¹˜ä»¥çŸ©é˜µï¼Œå°±è¦å’ŒçŸ©é˜µçš„æ¯ä¸ªå…ƒç´ ç›¸ä¹˜ã€‚
  ä¸¤ä¸ªçŸ©é˜µç›¸ç­‰æ˜¯æŒ‡å¯¹åº”å…ƒç´ éƒ½ç›¸ç­‰ï¼›ä¸¤ä¸ªè¡Œåˆ—å¼ç›¸ç­‰ä¸è¦æ±‚å¯¹åº”å…ƒç´ éƒ½ç›¸ç­‰ï¼Œç”šè‡³é˜¶æ•°ä¹Ÿå¯ä»¥ä¸ä¸€æ ·ï¼Œåªè¦è¿ç®—
  ä»£æ•°å’Œçš„ç»“æœä¸€æ ·å°±è¡Œäº†ã€‚è¡Œåˆ—å¼ç›¸ç­‰ï¼Œå°±æ˜¯å€¼ç›¸ç­‰ï¼Œè¡Œå’Œåˆ—æ•°ç›®ä¸å¿…ç›¸ç­‰ï¼Œæ•°æ®ä¹Ÿä¸å¿…ç›¸ç­‰ã€‚çŸ©é˜µç›¸ç­‰ï¼Œè¡Œå’Œåˆ—
  æ•°ç›®å¿…é¡»ç›¸ç­‰ï¼Œå¯¹åº”ä½ç½®çš„æ•°æ®ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚è¡Œåˆ—å¼ç›¸åŠ å‡ï¼Œå°±æ˜¯ä¸¤ä¸ªæ•°å€¼ç›¸åŠ å‡ï¼Œç»“æœè¿˜æ˜¯æ•°å€¼ã€‚çŸ©é˜µç›¸åŠ å‡ï¼Œ
  å¯¹åº”ä½ç½®çš„æ•°æ®ç›¸åŠ å‡ã€‚

å¯¹äºä¸€ä¸ª 2Ã—2 æ–¹é˜µï¼Œè¡Œåˆ—å¼(å€¼)å³ä¸ºçŸ©é˜µä¸­çš„å…ƒç´ äº¤å‰ç›¸ä¹˜å†æ±‚å·®å€¼ï¼Œä¸¤ä¾§çš„ç«–çº¿ä¹Ÿè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç»å¯¹å€¼ï¼š

        | a  b |
    A = |      |        The determinant is:      |A| = ad âˆ’ bc
        | c  d |

å¯¹äºæ›´å¤šç»´çš„æ–¹é˜µï¼Œåªéœ€è¦æ‹†åˆ†ç¬¬ä¸€è¡Œï¼Œå•ç‹¬ä¸åé¢ä¸¤è¡Œä¸­çš„å°æ–¹é˜µç›¸ä¹˜ï¼Œç»“æœæ±‚å’Œï¼Œæ›´é«˜ç»´åº¦ä¾æ ·å¤„ç†ï¼š

![Det of 3x3 Matrix](https://www.mathsisfun.com/algebra/images/matrix-3x3-det.svg)


        | a  b  c |      a                  b                  c  
        |         |       x                 x                 x   
    A = | d  e  f | =>    | e  f |  -  | d     f |  +  | d  e |   
        |         |       |      |     |         |     |      |   
        | g  h  i |       | h  i |     | g     i |     | g  h |   

         |A| = a(ei âˆ’ fh) âˆ’ b(di âˆ’ fg) + c(dh âˆ’ eg)

![Det of 4x4 Matrix](https://www.mathsisfun.com/algebra/images/matrix-4x4-det.svg)

ä»¥ä¸Šè¿™ç§å±•å¼€æ–¹æ³•ç§°ä¸ºâ€œæ‹‰æ™®æ‹‰æ–¯å±•å¼€â€ï¼Œæˆ‘å–œæ¬¢å®ƒï¼Œå› ä¸ºæ¨¡å¼å¾ˆå®¹æ˜“è®°ä½ï¼Œå½“ç„¶è¿˜æœ‰å…¶ä»–æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œè¨é²æ–¯è§„åˆ™
Sarrusâ€™s ruleï¼Œè¿™ç§æ–¹æ³•æ˜¯å°†è¡Œåˆ—å¼å¾€å³è¾¹å¾ªç¯æ‰©å±•ï¼Œä»å·¦ä¸Šè§’å¾€å³ä¸‹è§’è¿çº¿çš„æ•°ä¹˜ç§¯ç›¸åŠ ï¼Œå†å‡å»ä»å³ä¸Šè§’
å¾€å·¦ä¸‹è§’è¿çº¿çš„æ•°ä¹˜ç§¯ã€‚

å‘é‡å’Œè¡Œåˆ—å¼ç»“åˆæ—¶ï¼Œé€šå¸¸ä»¥åˆ—å‘é‡çš„å½¢å¼ç¼–å†™ï¼Œæ–¹ä¾¿åšè®¡ç®—ï¼Œå…¶ä¸­å‘é‡ä¸­çš„æ¯ä¸ªå€¼è¡¨ç¤ºå‘é‡çš„ä¸€ä¸ªåˆ†é‡ã€‚

ç»™å®šä¸¤ä¸ªå‘é‡åæ ‡ v = [vâ‚, vâ‚‚] å’Œ w = [wâ‚, wâ‚‚]ï¼Œè®¡ç®—ç‚¹ç§¯ä¸º v âˆ™ w = vâ‚wâ‚ + vâ‚‚wâ‚‚ï¼Œè¡¨è¾¾æ›´ç®€æ´ã€‚
ä¾‹å¦‚ï¼Œç»™å®š v = [3, 5]áµ€ å’Œ w = [-2, 7]áµ€ï¼Œè®¡ç®— v Â· w å’Œ v Â· vï¼Œä¸Šæ ‡ T è¡¨ç¤ºçŸ©é˜µè½¬ç½®ï¼Œè¡Œå˜åˆ—ã€‚


çŸ©é˜µçš„é‡è¦ä¹‹å¤„åœ¨äºå®ƒå°†è®¸å¤šçš„ä»£æ•°é—®é¢˜ç»™æ–¹ä¾¿çš„è¡¨ç¤ºï¼Œç‰¹åˆ«æ˜¯åˆ©ç”¨çŸ©é˜µçš„ä¹˜æ³•å°†ä½¿ä»£æ•°é—®é¢˜å¾—åˆ°ç®€æ´çš„è¡¨ç¤ºå’Œæ±‚è§£ã€‚
çŸ©é˜µçš„åŠ æ³•å®šä¹‰ä¸ºä¸¤ä¸ªå…·æœ‰åŒæ ·ç»´åº¦çš„çŸ©é˜µä¹‹å‰è¿›è¡Œçš„å åŠ è¿ç®—ï¼Œä¸¤ä¸ªçŸ©é˜µä¸­è¡Œåˆ—åæ ‡å¯¹åº”ä½ç½®çš„æ•°ç›¸åŠ å¹¶ä¿æŒç»“æœ
åœ¨åŒæ ·çš„ä½ç½®ã€‚

çŸ©é˜µçš„ä¹˜æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯**æ ‡é‡ä¹˜æ³•**ï¼Œå³çŸ©é˜µä¸ä¸€ä¸ªæ ‡é‡ç›¸ä¹˜ï¼ŒçŸ©é˜µä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½è¦ä¹˜ä¸Šè¿™ä¸ªæ ‡é‡ã€‚å¦ä¸€ç§æ˜¯
çŸ©é˜µä¸çŸ©é˜µä¹‹é—´çš„ä¹˜æ³•ï¼Œç®€ç§°**çŸ©é˜µä¹˜æ³•**ï¼Œåªæœ‰å·¦ä¾§çŸ©é˜µçš„åˆ—æ•°ä¸å³ä¾§çŸ©é˜µçš„è¡Œæ•°ä¸€è‡´æ—¶æ‰å¯ä»¥è¿›è¡Œã€‚å¹¶ä¸”ï¼Œè¡Œåˆ—
ä¸Šçš„æ•°ä¸€å¯¹ä¸€å¯¹ç›¸ä¹˜ï¼Œç»“æœæ±‚å’Œå†æ”¾åˆ°ç»“æœçŸ©é˜µä¸Šã€‚æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªçŸ©é˜µè¡Œæ•°ã€åˆ—æ•°åˆ†åˆ«å’Œä¹˜å·å·¦ä¾§ã€å³ä¾§çŸ©é˜µå¯¹åº”ã€‚
å¯¹äº mÃ—n çŸ©é˜µä¸ nÃ—p çŸ©é˜µç›¸ä¹˜ï¼Œn å¿…é¡»ç›¸åŒï¼Œç›¸ä¹˜ç»“æœæ˜¯ mÃ—p çŸ©é˜µã€‚

![Matrix multiply](https://www.shuxuele.com/algebra/images/matrix-multiply-a.svg)
![Matrix multiply](https://www.shuxuele.com/algebra/images/matrix-multiply-b.svg)
![Matrix multiply](https://www.shuxuele.com/algebra/images/matrix-multiply-c.svg)

ä¹˜æ³•çš„äº’æ¢å¾‹åœ¨çŸ©é˜µçš„é¢†åŸŸé€šå¸¸æ˜¯ä¸é€‚ç”¨çš„ï¼ŒçŸ©é˜µä¹˜æ³•å¹¶éå¯äº’æ¢ï¼Œé™¤ç‰¹æ®Šçš„å•ä½çŸ©é˜µå¤–ï¼Œå®ƒä¸ä»»ä½•çŸ©é˜µç›¸ä¹˜éƒ½
ä¸ä¼šæ”¹å˜åŸçŸ©é˜µã€‚**å•ä½çŸ©é˜µ** Identity matrix æ˜¯çŸ©é˜µé¢†åŸŸé‡Œçš„ "1"ï¼š

- ç¬¦å·ä¸ºå¤§å†™å­—æ¯ Iã€‚
- å•ä½çŸ©é˜µæ˜¯"æ–¹å½¢"çš„ï¼ˆè¡Œä¸åˆ—æ•°ç›®ç›¸åŒï¼‰ã€‚
- å¯¹è§’çº¿ä¸Šï¼Œå³å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„è¿çº¿ä¸Šå…¨æ˜¯ 1ï¼Œå…¶ä»–å…¨æ˜¯ 0ã€‚
- å®ƒæ˜¯ä¸ªç‰¹åˆ«çš„çŸ©é˜µï¼Œä»»ä½•çŸ©é˜µå’Œå•ä½çŸ©é˜µç›¸ä¹˜ï¼Œä¿æŒä¸å˜ã€‚

é€†çŸ©é˜µçš„å®šä¹‰å¦‚ä¸‹ï¼ŒA çš„é€†ï¼ˆçŸ©é˜µï¼‰æ˜¯ Aâ»Â¹ï¼Œä»…å½“ï¼š

    AAâ»Â¹ = Aâ»Â¹A = I

ä½†æœ‰äº›çŸ©é˜µæ˜¯æ²¡æœ‰é€†çŸ©é˜µçš„ï¼Œå½“çŸ©é˜µçš„è¡Œåˆ—å¼ä¸º 0 å³ä¸åœ¨é€†çŸ©é˜µã€‚å¯¹äºä¸€ä¸ª 2x2 çŸ©é˜µæ¥è¯´ï¼Œé€†çŸ©é˜µæ±‚æ³•å¦‚ä¸‹ï¼š

           -1                  
    [ a b ]      1   [  d  -b ]
    [     ]  = ----- [        ]
    [ c d ]     det  [ -c   a ]

å³ï¼Œå°†åŸçŸ©é˜µçš„æ–œè§’å…ƒç´ æ¢ä½ï¼Œç»™å¦å¤–ä¸¤ä¸ªæ•°åŠ è´Ÿå·ï¼Œæœ€åé™¤ä»¥è¡Œåˆ—å¼ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹ 2x2 çŸ©é˜µçš„é€†çš„æ±‚æ³•ï¼Œä»¥åŠé€šè¿‡ AAâ»Â¹ = Aâ»Â¹A = I éªŒè¯é€†çŸ©é˜µï¼š

           -1
    [ 4 7 ]      1   [  6  -7 ]   [0.6 -0.7]     [0.6 -0.7][ 4 7 ]   [ 1 0 ]
    [     ]  = ----- [        ] = [        ] ==> [        ][     ] = [     ]
    [ 2 6 ]    24-14 [ -2   4 ]   [-0.2 0.4]     [-0.2 0.4][ 2 6 ]   [ 0 1 ]

çŸ©é˜µå¹¶ä¸æ€»æ˜¯æœ‰é€†çŸ©é˜µçš„ï¼Œå°±åƒæ–¹ç¨‹ç»„å¹¶ä¸æ€»æ˜¯æœ‰è§£ä¸€æ ·ã€‚

- é¦–å…ˆï¼ŒçŸ©é˜µä¸€å®šè¦æ˜¯"æ–¹å½¢"å³å¯ä»¥è®¡ç®—è¡Œåˆ—å¼ï¼Œæ‰å¯èƒ½æœ‰é€†çŸ©é˜µã€‚
- åŒæ—¶ï¼Œè¡Œåˆ—å¼ä¸èƒ½æ˜¯é›¶ï¼Œæ±‚è§£çº¿ç¨‹æ–¹ç¨‹ç»„æ—¶ä¾¿è¦é™¤ä»¥é›¶äº†ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹è¿™ä¸ªçŸ©é˜µå°±æ²¡æœ‰é€†çŸ©é˜µï¼Œè¡Œåˆ—å¼ä¸º 0ï¼Œå¯¹äºæ±‚è§£é€†çŸ©é˜µæ—¶ï¼Œ1/0 é™¤æ³•æ²¡æœ‰å®šä¹‰ã€‚

    [ 3 4 ]
    [     ]  ==> det = 3x8 - 4x6 = 0
    [ 6 8 ]

è¿™ç§çŸ©é˜µå«**é™ç§©çŸ©é˜µ**ï¼ŒSingularï¼Œå°±æ˜¯è¡Œåˆ—å¼ä¸ºé›¶çš„çŸ©é˜µã€‚ä»çº¿æ€§å…³ç³»ä¸Šæ¥çœ‹ï¼Œè¿™å¾ˆåˆç†ã€‚æ¥çœ‹çŸ©é˜µç¬¬äºŒè¡Œ
çš„æ•°å­—ï¼Œå®ƒä»¬ä¸è¿‡æ˜¯ç¬¬ä¸€è¡Œçš„åŒå€ï¼Œä¹Ÿå°±æ˜¯è¯´å¹¶æ²¡æœ‰æä¾›æ–°çš„ä¿¡æ¯ã€‚åœ¨çº¿æ€§ç›¸å…³ä¸Šï¼Œè¿˜æ˜¯åŸæ¥çš„çº¿æ€§å…³ç³»ã€‚å®ƒä»¬å°±
æ˜¯å¹³é¢ä¸Šçš„åŒä¸€æ¡ç›´çº¿ï¼Œé€šè¿‡åŸæ–¹ç¨‹å¼å°±å¯ä»¥å°†è¿™ä¸ª 2 å€ç³»æ•°çº¦åˆ†æ‰ï¼Œè¡Œåˆ—å¼çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰è¿™ä¸ªçº¿æ€§å…³ç³»ã€‚

å¯¹äºé«˜é˜¶çŸ©é˜µçš„é€†ï¼Œéœ€è¦ä½¿ç”¨å…¶å®ƒæ–¹æ³•æ¥æ±‚è§£ï¼š

- Inverse of a Matrix using Elementary Row Operations (Gauss-Jordan)
- Inverse of a Matrix using Minors, Cofactors and Adjugate
- Use a computer (such as the Matrix Calculator)

åˆ¥å¿˜äº†ï¼Œæˆ‘å€‘çš„ç›®çš„è¦å¾—åˆ°ç·šæ€§æ–¹ç¨‹çš„è§£ï¼Œè€Œä¸æ˜¯é€†çŸ©é™£çš„æ¯ä¸€å€‹å…ƒã€‚å¦‚æœå°‹è¦“é€†çŸ©é™£å…¬å¼çš„è¡Œå‹•å–®ç´”æºæ–¼äººé¡
å¤©ç”Ÿæƒ³è¦æ¢ç´¢æœªçŸ¥ä¸–ç•Œçš„å¥½å¥‡å¿ƒï¼Œå°šå¯ç†è§£ã€‚ä¸éï¼Œå€˜è‹¥åªå› ç‚ºè¦è§£ç·šæ€§æ–¹ç¨‹è€Œè¨ˆç®—é€†çŸ©é™£ï¼Œå¯å°±è¦å¥‰å‹¸è«¸ä½ï¼š
ã€Œä½ å€‘çš„æ™‚é–“æœ‰é™ï¼Œæ‰€ä»¥ä¸è¦æµªè²»æ™‚é–“åœ¨é€†çŸ©é™£çš„è¨ˆç®—ä¸Šã€‚ã€æ­£å¦‚ Steve Jobs åœ¨ç¾åœ‹å²ä¸¹ä½›å¤§å­¸ç•¢æ¥­å…¸ç¦®ä¸Šèªªï¼š

>Your time is limited, so donâ€™t waste it living someone elseâ€™s life.â€

ç”¨åˆç­‰è¡Œè¿ç®—æ¥æ±‚é€†çŸ©é˜µæ˜¯æœ€åŸºæœ¬çš„æ±‚é€†æ–¹æ³•ï¼Œä¹Ÿç§°é«˜æ–¯ï¼è‹¥å°”å½“æ–¹æ³•ï¼Œ"åˆç­‰è¡Œè¿ç®—"åŒ…æ‹¬è¡Œç›¸åŠ ï¼Œä¹˜ï¼Œå¯¹æ¢ä½ç½®
ç­‰ç­‰ã€‚æ³¨æ„åªèƒ½åšä»¥ä¸‹è¿™äº› "åˆç­‰è¡Œè¿ç®—"ï¼š

- å¯¹æ¢ä¸¤è¡Œçš„ä½ç½®ï¼Œè¿™å’Œäº¤æ¢åŸçº¿æ€§æ–¹ç¨‹çš„å…ˆåé¡ºåºä¸€æ ·ï¼›
- æŠŠä¸€è¡Œé‡Œçš„æ¯ä¸ªå…ƒç´ ä¹˜ä»¥æˆ–é™¤ä»¥ä¸€ä¸ªå¸¸æ•°ï¼Œè¿™å¯¹åº”åœ¨åŸçº¿æ€§æ–¹ç¨‹ä¸ŠåŒæ—¶ä¸¤è¾¹ä¹˜ä¸€ä¸ªç³»æ•°ï¼›
- ä¸€è¡ŒåŠ ä¸Šå¦ä¸€è¡Œï¼Œå¹¶å–ä»£å‰è€…ï¼›

ä»¥åç»­è¦ä½¿ç”¨çš„çŸ©é˜µä¸ºä¾‹ï¼Œå…ˆå°†çŸ©é˜µ A ä¸å…¶å•ä½çŸ©é˜µ I å¹¶æ’å†™ä¸‹æ¥ï¼Œè¿™ä¸ªå«**å¢å¹¿çŸ©é˜µ**ï¼š

    [ 13  8  6 | 1 0 0 ]
    [  9  7  4 | 0 1 0 ]
    [  7  4  0 | 0 0 1 ]

æ¥ç€å°½åŠ›å»æŠŠå¢å¹¿çŸ©é˜µå·¦è¾¹çš„çŸ©é˜µå˜æˆå•ä½çŸ©é˜µï¼Œç›®æ ‡æ˜¯æŠŠçŸ©é˜µ A å˜æˆå•ä½çŸ©é˜µï¼Œå¯¹è§’çº¿å˜æˆå…¨æ˜¯ 1ã€‚å°½é‡å…ˆ
å°†å¯¹è§’çº¿å¤–çš„æ•°å˜æˆ 0ï¼Œå†å°†å¯¹è§’çº¿çš„æ•°å½’ä¸€åŒ–ã€‚å¯¹å¢å¹¿çŸ©é˜µå³è¾¹çš„çŸ©é˜µä¹ŸåšåŒæ ·çš„è¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª Aâ»Â¹ã€‚
è¿™é‡Œå¾ˆå¤šçš„æ“ä½œï¼Œåªéœ€è¦å ä¸€ä¸‹çŸ©é˜µè®¡ç®—å™¨ "inv(A)" é”®ã€‚


ç”¨ä½™å­å¼ã€ä»£æ•°ä½™å­å¼å’Œä¼´éšæ¥æ±‚é€†çŸ©é˜µï¼Œæ­¥éª¤å¦‚ä¸‹:

ä¸€ã€æ±‚ä½™å­å¼çŸ©é˜µï¼Œ
äºŒã€è½¬æˆä»£æ•°ä½™å­å¼çŸ©é˜µï¼Œ
ä¸‰ã€è½¬æˆä¼´éšçŸ©é˜µï¼Œ
å››ã€ä¹˜ä»¥è¡Œåˆ—å¼å€’æ•°ã€‚

æ‰€è°“ä½™å­å¼çŸ©é˜µï¼Œå³ä¸€ä¸ªç”¨æ¥å­˜æ”¾â€œä½™å­å¼â€çš„çŸ©é˜µã€‚ä½™å­å¼æ˜¯ç‰¹æ®Šçš„è¡Œåˆ—å¼ï¼Œå³é€‰ä¸­åŸçŸ©é˜µä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œæ¯”å¦‚
ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒä½äºç¬¬ä¸€è¡Œã€ç¬¬ä¸€åˆ—ï¼Œé‚£ä¹ˆå°±å°†è¿™äº›è¡Œã€ä¾‹çš„å…ƒç´ æ’é™¤æ‰ï¼Œå¯¹ä½™ä¸‹çš„å…ƒç´ æ‰€æ„æˆçš„çŸ©é˜µæ±‚è¡Œåˆ—å¼ï¼Œ
è¿™ä¸ªç»“æœä¿å­˜åˆ°ä½™å­å¼çŸ©é˜µä¸­ã€‚

æ‰€è°“ä»£æ•°ä½™å­å¼çŸ©é˜µï¼Œå°±æ˜¯å°†"çºµæ¨ªäº¤é”™"æ’åˆ—çš„æ­£è´Ÿå·æ”¾åœ¨"ä½™å­å¼çŸ©é˜µ"ä¸Šã€‚æ¢å¥è¯è¯´ï¼Œæ¯éš”ä¸€ä¸ªæ ¼æ”¹å˜æ­£è´Ÿå·ï¼Œ
ç¬¬ä¸€ä¸ªä¸ºæ­£ï¼Œç¬¬äºŒä¸ªä¸ºè´Ÿï¼Œç­‰ç­‰ï¼Œéš”ä¸€è¡Œåˆ™é¡ºåºåè¿‡æ¥ã€‚

ä¼´éšçŸ©é˜µï¼Œå³è½¬ç½®ä»¥ä¸Šçš„çŸ©é˜µã€‚å°±æ˜¯æ²¿å¯¹è§’çº¿å¯¹è°ƒå…ƒç´ çš„ä½ç½®ï¼Œåœ¨å¯¹è§’çº¿ä¸Šçš„å…ƒç´ ä¸å˜ã€‚


çŸ©é˜µç›¸ä¹˜è¿ç®—è§„åˆ™ç±»ä¼¼å‘é‡åšç‚¹ç§¯è¿ç®—ï¼Œå³ä¾§çŸ©é˜µä¸­çš„å‘é‡ä¸º Column Vector è¡¨è¾¾ï¼Œè€Œä¸æ˜¯ä¸€è¡Œçš„å½¢å¼ã€‚
æ‰€ä»¥ï¼Œå›åˆ°å‰é¢é£Ÿå“é”€å”®æ•°æ®å¤„ç†ä¸Šæ¥ï¼Œé‡ç‚¹æ˜¯è¦æŠŠä»·é’±å’Œé”€å”®é‡æ­£ç¡®åœ°ä½¿ç”¨çŸ©é˜µè¡¨ç¤ºå‡ºæ¥ï¼š

                 [ 13 9  7  15 ]
    [$3 $4 $2] x [ 8  7  4  6  ] = [ $83 $63 $37 $75 ]
                 [ 6  4  0  3  ]

åè¿‡æ¥ï¼Œå‡å¦‚çŸ¥é“å½“å¤©çš„é”€å”®é¢å’Œå’Œå„ç§é£Ÿå“æ•°é‡ï¼Œä½†ä¸çŸ¥é“å”®ä»·ï¼Œè¿™å°±ä¸€ä¸ªå…¸å‹çš„çº¿æ€§ä»£æ•°é—®é¢˜ã€‚åˆ©ç”¨çŸ©é˜µå°±
å¯ä»¥æ±‚è§£çº¿æ€§æ–¹ç¨‹ç»„ã€‚æœ€ä¸»è¦çš„å°±æ˜¯å†™å‡ºæœªçŸ¥æ•°çš„ç³»æ•°çŸ©é˜µï¼Œè¿™é‡Œå°±ä½¿ç”¨ xyz æ›¿ä»£æ‰ä»·é’±ï¼Œå¹¶æ”¹å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

    [ 13  8  6 ] [x]   [$83]
    [  9  7  4 ] [y] = [$63]
    [  7  4  0 ] [z]   [$37]
    [ 15  6  3 ]       [$75]

å¯¹äºä¸‰å…ƒä¸€æ¬¡æ–¹ç¨‹ç»„ï¼Œå…¶å®åªè¦æœ‰å’ŒæœªçŸ¥æ•°ä¸€æ ·å¤šçš„æ–¹ç¨‹å³å¯ä»¥æ±‚è§£ï¼Œä»¥ä¸Šå¤šå‡ºæ¥ä¸€æ¡æ–¹ç¨‹çš„æ•°æ®å¯ä»¥å»æ‰ã€‚é€šè¿‡
çŸ©é˜µè®¡ç®—å™¨ï¼Œå¯ä»¥å¾—åˆ° det = -62ã€‚åŒæ ·ï¼Œåˆ©ç”¨çŸ©é˜µè®¡ç®—å™¨å¯ä»¥å¸®åŠ©è‡ªåŠ¨è¿›è¡Œå¤§é‡çš„çŸ©é˜µè®¡ç®—ï¼Œæ±‚å¾— xyzã€‚

è¿™ä¸‰ä¸ªçŸ©é˜µç§°ä¸º "A", "X" å’Œ "B"ï¼Œæ–¹ç¨‹ç»„çš„çŸ©é˜µè¡¨ç¤ºä¾¿æ˜¯ AX = Bï¼Œåªä¸è¿‡å°†åŸæ¥é›¶æ•£çš„æ–¹ç¨‹é›†ä¸­ä»¥å¤šç»´
æ•°æ®å‘ˆç°ã€‚è€Œçº¿æ€§æ–¹ç¨‹ç»„çš„æ±‚è§£ä¹Ÿå˜æˆäº†çŸ©é˜µæ±‚é€†çš„æ“ä½œï¼Œé€šè¿‡é€†çŸ©é˜µæ±‚è§£å°±å¯ä»¥è§£çº¿æ€§æ–¹ç¨‹ç»„ï¼Œå…¬å¼æ˜¯ï¼š

    X = Aâ»Â¹B

è¿™ä¸ªå…¬å¼çš„æ„æ€æ˜¯ï¼šxã€y å’Œ z çš„å€¼ï¼ˆX çŸ©é˜µï¼‰ç­‰äº **A çŸ©é˜µçš„é€†**ä¹˜ä»¥ **B çŸ©é˜µ**ã€‚çŸ©é˜µä¸é€†çŸ©é˜µçš„å…³ç³»
å°±æ˜¯ä¸€ä¸ªæ•°ä¸å…¶å€’æ•°çš„å…³ç³»ï¼ŒæŠŠçŸ©é˜µä¸å…¶é€†ç›¸ä¹˜ï¼Œç»“æœæ˜¯å•ä½çŸ©é˜µï¼Œå°±åƒæ˜¯çŸ©é˜µé‡Œçš„"1"ã€‚

å¦‚æœçŸ©é˜µç­‰å¼ AX = B æ¯è¾¹éƒ½å¯ä»¥é™¤ä»¥ A å¾—åˆ° X=B/A å°±æœ€å¥½äº†ï¼Œä½†ä¸èƒ½é™¤çŸ©é˜µã€‚æ¯è¾¹ä¹˜ä»¥ Aâ»Â¹ æ˜¯å¯è¡Œçš„ï¼š

    XAAâ»Â¹ = BAâ»Â¹
       XI = BAâ»Â¹
        X = BAâ»Â¹

æˆ‘ä»¬çŸ¥é“ AAâ»Â¹ = Iï¼Œæ‰€ä»¥å¯ä»¥å°† AAâ»Â¹ ä½œä¸º I æ‹¿èµ°ï¼Œå°±å¦‚åŒä»ä»£æ•°æ•°å¼å­ 1x = ab æ‹¿èµ° "1" ä¸€æ ·ã€‚
æ³¨æ„ï¼ŒåšçŸ©é˜µç›¸ä¹˜æ¬¡åºæ˜¯é‡è¦çš„ï¼ŒAB å‡ ä¹æ°¸è¿œéƒ½ä¸ä¼šç­‰äº BAã€‚å¦‚æœå¼å­æ˜¯ååºçš„ï¼ŒåŒæ ·æŒ‰ç…§é¡ºåºï¼š

       AX = B
    Aâ»Â¹AX = Aâ»Â¹B
       IX = Aâ»Â¹B
        X = Aâ»Â¹B



### ğŸŸ ğŸ”µ Complexes å¤æ•°
- [é—«ä»¤çª GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ - 04 Transformation Cont.](https://www.bilibili.com/video/BV1X7411F744/?p=3)
- [Imaginary Numbers Are Real - Welch Labs](https://www.bilibili.com/video/BV1Ts411u7iH?p=5)
- [Imaginary Numbers Are Real - Welch Labs](https://www.welchlabs.com/resources/freebook)
- [How Imaginary Numbers Became â€œRealâ€](https://www.themathdoctors.org/how-imaginary-numbers-became-real)
- [A Short History of Complex Numbers - Orlando Merino](https://www.math.uri.edu/~merino/spring06/mth562/ShortHistoryComplexNumbers2006.pdf)
- [Imaginary Numbers](https://www.mathsisfun.com/numbers/imaginary-numbers.html)
- [Complex Plane](https://www.mathsisfun.com/algebra/complex-plane.html)
- [Imaginary Multiplication vs. Imaginary Exponents](https://betterexplained.com/articles/imaginary-multiplication-exponents/)
- [A Visual, Intuitive Guide to Imaginary Numbers](https://betterexplained.com/articles/a-visual-intuitive-guide-to-imaginary-numbers/)
- [æ•°å­¦é‡Œæœ€ç¾çš„å…¬å¼ï¼š e^iÏ€+1=0 - Surein Aziz åšå£«](https://www.meipian.cn/588prp7)
- [å¤æ•°çš„å®çŸ©é˜µè¡¨ç¤º - Shenelry](https://zhuanlan.zhihu.com/p/160270375)
- [Maths - Rotation Theory](http://euclideanspace.com/maths/geometry/rotations/theory/index.htm)
- [Rotations And Infinitesimal Generators](https://www.reedbeta.com/blog/rotations-and-infinitesimal-generators/)

ä»»æ„ä¸€ä¸ªå¤æ•° ğ‘§ âˆˆ â„‚ éƒ½å¯ä»¥è¡¨ç¤ºä¸º ğ‘§ = ğ‘ + ğ‘ğ‘– çš„å½¢å¼ï¼Œå…¶ä¸­ ğ‘, ğ‘ âˆˆ â„ è€Œä¸” ğ‘–Â² = âˆ’1ï¼æˆ‘ä»¬å°† ğ‘ ç§°ä¹‹
ä¸ºè¿™ä¸ªå¤æ•°çš„å®éƒ¨ï¼ˆReal Partï¼‰ï¼Œğ‘ ç§°ä¹‹ä¸ºè¿™ä¸ªå¤æ•°çš„è™šéƒ¨ï¼ˆImaginary Partï¼‰ã€‚Imaginary æœ¬èº«è¯‘ä½œ
â€œæŠ½è±¡çš„â€æ›´åˆé€‚ï¼Œå®ƒæœ¬èº«ä¸è™šï¼Œåªæ˜¯å¤ªæŠ½è±¡ã€‚å†å²ä¸Šï¼Œé«˜æ–¯è®¤ä¸ºè¿™ä¸ªæ•°çš„åå­—åº”è¯¥å«åšä¾§æ•° lateral æ›´æ°å½“ã€‚

![Complex Number](https://www.mathsisfun.com/numbers/images/complex-number.svg)

Girolamo Cardano (or Cardan) (1501-1576) åœ¨ 16 ä¸–çºªå‘æ˜äº†å¤æ•°ï¼Œä½†ç›´åˆ°å¾ˆä¹…ä»¥åï¼Œè¿™ä¸€è§‚ç‚¹æ‰åœ¨
Leonhard Euler (1707-1783) å’Œ Carl Friedrich Gauss (1777-1855) ä½œå“ä¸­ç¡®å®šä¸‹æ¥ã€‚

Gauss å¢å†™åˆ°è™šæ•°åº”è¯¥å«åšä¾§æ•°ï¼Œè¿™æ ·å¯ä»¥é¿å…è¢«äººè¯¯è§£ï¼š

    "That this subject [imaginary numbers] has hitherto been surrounded by 
    mysterious obscurity, is to be attributed largely to an ill adapted notation. 
    If, for example, +1, -1, and the square root of -1 had been called direct, 
    inverse and lateral units, instead of positive, negative and imaginary 
    (or even impossible), such an obscurity would have been out of the question."


å…¶å® ğ‘§ = ğ‘ + ğ‘ğ‘– å°±æ˜¯å¯¹äº {1, ğ‘–} è¿™ä¸ªåŸºåº•ï¼ˆBasisï¼‰çš„çº¿æ€§ç»„åˆï¼ˆLinear Combinationï¼‰ï¼Œæ‰€ä»¥ï¼Œ
å¤æ•°è¿˜æ˜¯çº¿æ€§ä»£æ•°çš„èŒƒç•´ï¼Œå¯ä»¥ç”¨å‘é‡æ¥è¡¨ç¤ºä¸€ä¸ªå¤æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨å¤æ•°æ¥è¡¨ç¤ºå‘é‡ã€‚å¤æ•°å’Œå‘é‡ä¸€æ ·æœ‰é•¿åº¦å’Œæ–¹å‘ï¼Œ
magnitude (length) and directionã€‚

å¤æ•°æœ€å¤§çš„æ„ä¹‰ä¸åœ¨äºè™šæ•°å•ä½ i çš„åˆ›é€ ï¼Œè€Œåœ¨äºå¤æ•°çš„åˆ›ç«‹æ­£å¼å°†æ•°å­¦ä»ä¸€ç»´æŠ½è±¡ä¸–ç•Œå¸¦å…¥äºŒç»´æŠ½è±¡ä¸–ç•Œå»
çœ‹é—®é¢˜ã€‚è®¾æƒ³ä¸€ä¸‹ï¼Œæœ‰ä¸ªäººæœ‰ 2 ä¸ªè‹¹æœï¼Œä½ æ‹¿èµ° 3 ä¸ªï¼Œè¯·é—®è¿˜ä¹˜å‡ ä¸ªï¼Ÿåœ¨äººç±»æŠ½è±¡åŠŸèƒ½å‘æŒ¥ä¹‹å‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸
å¯è§£å†³çš„é—®é¢˜ã€‚ä½†æ˜¯æŠ½è±¡ä¸€ä¸‹ï¼Œç”¨â€œå€Ÿâ€çš„æ–¹æ³•ï¼ŒæŠ½è±¡åœ°å€Ÿèµ°ä¸€ä¸ªä¸å­˜åœ¨çš„ä¸œè¥¿ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå¼•å…¥è´Ÿæ•°æ¥è§£å†³å®ƒã€‚
åœ¨å¤æ•°åˆ›é€ å‡ºæ¥ä¹‹å‰ï¼Œæ•°å­¦ä¸€ç›´éƒ½æ˜¯å®æ•°ç©ºé—´ä¸‹çš„ä¸€ç»´ä¸–ç•Œï¼Œå®ƒä¹Ÿä¸æ–­åœ°è¡¥å……å°æ•°ã€æœ‰ç†æ•°ã€æ— ç†æ•°ç­‰ç­‰çš„æ¦‚å¿µã€‚
ä»å®æ•°çš„æ¼”å˜ï¼Œåˆ°å¤æ•°çš„å‘æ˜ï¼Œè¿™ä¸€åˆ‡çš„æœ¬è´¨éƒ½æ˜¯ä»£è¡¨äº†äººç±»å¯¹æœªçŸ¥çš„æ¢ç´¢ã€‚

å‘é‡å°½ç®¡ä¹Ÿå…·æœ‰äºŒç»´å±æ€§ï¼Œä½†å®ƒåœ¨æ•°å­¦ä¸Šçš„æ¨¡å‹è¿˜æ˜¯åŸºäºä¸€ç»´çš„å®æ•°ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ˜¯ä¸€ç»´çš„æ•°å­¦æ€æƒ³ã€‚

å¤æ•°å¼•å…¥çš„å‡ºå‘ç‚¹æ˜¯åœ¨äººç±»æ— æ³•è§£å†³å¯¹è´Ÿæ•°å¼€æ–¹é—®é¢˜ï¼Œå³åœ¨è§£äºŒæ¬¡æ–¹ç¨‹æ—¶é‡åˆ° âˆš(-1) æ— è§£é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯å®æ•°æ— æ³•
è§£å†³ä¸€ä¸ªæ•°çš„å¹³æ–¹ä¸ºè´Ÿæ•°çš„æƒ…å†µã€‚è€Œå¼•å…¥è™šæ•°åï¼Œä½¿å¾— **iÂ² = -1**ï¼Œå°±å¯ä»¥ç”¨ âˆš(-1) = i ä»£è¡¨äºŒæ¬¡æ–¹ç¨‹çš„è§£ã€‚
åœ¨å›¾å½¢ç›´è§‚ä¸Šï¼Œä½¿ç”¨å¤æ•°å¹³é¢è¡¨è¾¾ï¼Œæ°´å¹³è½´ä¸ºå®æ•°è½´ï¼Œç«–ç›´è½´ä¸ºè™šæ•°è½´ã€‚è™šæ•° i é€šè¿‡å¤æ•°ä¹˜æ³•ï¼Œå¯ä»¥åœ¨å®æ•°ä¸è™šæ•°
ä¹‹é—´å˜æ¢ï¼Œè¿™ç§èƒ½åŠ›ä½¿å¾—è™šæ•°ä¸å®æ•°ç›¸ä¹˜åœ¨å¤æ•°å¹³é¢ä¸Šè¡¨ç¤ºä¸ºæ—‹è½¬çš„ç›´è§‚ç°è±¡ã€‚

å¦‚ä¸‹å›¾ï¼Œä»å®è½´ä¸Šçš„ 1 å¼€å§‹ï¼Œä¹˜ä¸Šè™šæ•°å•ä½ i å°±å˜æˆæ—‹è½¬ 90Â° åˆ°äº†è™šè½´ä¸Šæ–¹ã€‚å†ä¹˜ i å³å¾—åˆ° iÂ² = -1ï¼Œ
å°±åˆ°äº†å®è½´çš„è´Ÿæ•°ä½ç½®ï¼Œåˆæ˜¯æ—‹è½¬äº† 90Â°ã€‚åŒç†ï¼Œä¹˜ä¸Šè´Ÿå€¼çš„è™šæ•°ï¼Œæ—‹è½¬è§’åº¦å°±æ˜¯è´Ÿå€¼ã€‚ä¾‹å¦‚ï¼Œ(3 + 4i) ä¹˜ä»¥
i åå¾—åˆ° (-4 + 3i)ï¼Œåœ¨å¤æ•°å¹³é¢ä¸Šï¼Œå‰åä¸¤è€…åæ ‡æ—‹è½¬äº† 90Â°ã€‚å¯ä»¥ä½¿ç”¨å‘é‡è¿ç®—è¿›è¡ŒéªŒè¯ï¼Œå¯¹ä¸¤ä¸ªå‘é‡åš
ç‚¹ç§¯ï¼Œç»“æœä¸º 0ã€‚æ‰€ä»¥ï¼Œåªæ˜¯å¼•å…¥äº†è™šæ•°ï¼Œå¤æ•°å’Œå‡ ä½•å°±å®Œç¾ç»“åˆåœ¨ä¸€èµ·ã€‚

![Positive & Negative Rotation](https://betterexplained.com/wp-content/webp-express/webp-images/uploads/complex/positive_negative_rotation.png.webp)

è‡³æ­¤ï¼Œæ•°å­¦ä¸Šå‡ºç°äº†ä¸‰ä¸ªæœ€å¸¸ç”¨çš„åæ ‡å½¢å¼ï¼š

- Cartesian Coordinates ç¬›å¡å°”åæ ‡ç³»ç»Ÿï¼Œå³è¡¨ç¤ºè·ç¦»çš„ XY è½´ç›´è§’åæ ‡ç³»ï¼›
- Polar Coordinates æåæ ‡ç³»ï¼Œå³è¡¨ç¤ºæ—‹è½¬è§’åº¦ä¸è·ç¦»çš„å…³è”ï¼›
- Complex Plane å¤æ•°å¹³é¢ï¼Œå³å®æ•°ä¸è™šæ•°äºŒç»´åæ ‡ç³»ç»Ÿï¼›

åœ¨å¤æ•°äºŒç»´ä¸–ç•Œä¸­ï¼Œå…·æœ‰äº†æ›´ç»´åº¦è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œå‘é‡çš„åŠŸèƒ½ä¹Ÿå®Œå…¨åœ¨å¤æ•°çš„èŒƒå›´ä¹‹å†…ï¼ŒåŒæ ·å…·æœ‰æ¨¡å’Œæ–¹å‘ã€‚
å‘é‡åŠ å‡å’Œå¤æ•°åŠ å‡å®Œå…¨ä¸€è‡´ï¼Œåªéœ€è¦å°†å¤æ•°çš„åˆ†é‡å¯¹åº”ç›¸åŠ å‡ã€‚ä¾‹å¦‚ï¼Œ7+2i ä¸ 3+5i ç›¸å‡ç»“æœä¸º 4-3iï¼š

![Complex addition](https://www.mathsisfun.com/algebra/images/complex-plane-vector-add.svg)

å¤æ•°çš„ä¹˜æ³•å´è¦æ¯”å‘é‡æ›´ç®€æ´æ˜äº†ï¼š

![Complex Multiplying](https://www.mathsisfun.com/algebra/images/foil-complex.svg)

ä¸¤ä¸ªå¤æ•°ç›¸ä¹˜ï¼Œä¸¤åˆ†é‡ä¿©ä¿©ç›¸ä¹˜å†ç›¸åŠ ï¼Œå½’çº³å¦‚å›¾ï¼Œ"FOIL" å³ "Firsts, Outers, Inners, Lasts"ï¼š

    (a+bğ‘–)(c+dğ‘–) => ac + adğ‘– + bcğ‘– + bdğ‘–Â² => (ac âˆ’ bd) + (ad + bc)ğ‘–

- Firsts: a Ã— c
- Outers: a Ã— dğ‘–
- Inners: bğ‘– Ã— c
- Lasts: bğ‘– Ã— dğ‘–

ä½¿ç”¨ Matlab ç­‰å·¥å…·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰§è¡Œå¤æ•°çš„è®¡ç®—ï¼š

    >> a = sqrt(2) + sqrt(2)*i;
    >> a^2

    ans = 0.0000 + 4.0000i

    >> b = 1 + i;
    >> b^2

    ans = 0.0000 + 2.0000i

Matlab å‘é‡è®¡ç®—åˆ™ï¼Œç›´æ¥ä½¿ç”¨æ–¹æ‹¬å·è¡¨ç¤ºå‘é‡ï¼š

    >> dot([3 4], [-4 3])

    ans = 0

è®¡ç®—è¾è§’ä½¿ç”¨å¤æ•°å‚æ•°ï¼Œè®¡ç®—æ¨¡é•¿ç”¨ abs å‡½æ•°ï¼Œå¤æ•°ç›¸ä¹˜çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯è¾è§’ç›¸åŠ æ¨¡ç›¸ä¹˜ï¼š

    >> rad2deg(angle(3+4i)) %phase angle

    ans = 53.1301

    >> rad2deg(angle(-4+3i))

    ans = 143.1301

    >> rad2deg(angle((-4+3i)*(3+4i)))

    ans = -163.7398

    >> abs((-4+3i)*(3+4i))  %magnitude

    ans = 25

    >> abs(-4+3i)

    ans = 5

å¯¹äºé™¤æ³•ï¼Œéœ€è¦ä½¿ç”¨å…±è½­å¤æ•°ã€‚ä½•è°“å…±è½­ï¼Ÿå…±è½­å³ä¸ºæŒ‰ä¸€å®šçš„è§„å¾‹ç›¸é…çš„ä¸€å¯¹ï¼Œé€šä¿—ç‚¹è¯´å°±æ˜¯å­ªç”Ÿã€‚å…±è½­å¤æ•°å°±æ˜¯
ä¸¤ä¸ªå®éƒ¨ç›¸ç­‰ï¼Œè™šéƒ¨äº’ä¸ºç›¸åæ•°çš„å¤æ•°ï¼ŒConjugate complex numberï¼Œä¸€ä¸ªå¤æ•°çš„å…±è½­è¡¨ç¤ºä¸ºå…¶ç¬¦å·ä¸ŠåŠ ä¸€æ¨ªï¼Œ
ä¸ºäº†è¾“å…¥æ–¹ä¾¿ï¼Œæœ‰æ—¶ä¹Ÿå¯ä»¥è¿™æ ·è¡¨ç¤ºï¼Œz* ä¸ z å…±è½­ã€‚ä¸€å¯¹å…±è½­å¤æ•°ï¼Œåœ¨å¤å¹³é¢ä¸Šå…³äºå®è½´å¯¹ç§°ã€‚

è½­ï¼Œæœ€æ—©æ˜¯ç”¨æ¥è¡¨ç¤ºæ‹‰è½¦æ—¶ï¼Œæ¶åœ¨ç‰›è„–å­ä¸Šçš„æ›²æœ¨ï¼Œå¤ä»£æ‹‰è½¦é€šå¸¸ä¸¤å¤´ç‰›å¹¶é©¾é½é©±ï¼Œå› æ­¤è¯´è¿™ä¸¤å¤´ç‰›æ˜¯â€œå…±è½­â€ã€‚

å¤æ•°é™¤æ³•çš„è¯€çªå°±æ˜¯åœ¨åˆ†å¼ä¸ŠåŒæ—¶ä¹˜ä»¥åˆ†æ¯çš„å…±è½­å¤æ•°ï¼ä¸€ä¸ªå¤æ•°ä¸å…¶å…±è½­å¤æ•°ç›¸ä¹˜å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼ï¼š

    (a + bğ‘–)(a âˆ’ bğ‘–) = aÂ² + bÂ²ï¼š

è¯æ˜è¿‡ç¨‹ä¹Ÿç®€å•ï¼š

    (a + bğ‘–)(a âˆ’ bğ‘–) = aÂ² (- abğ‘– + abğ‘–) -bÂ²ğ‘–Â²
                     = aÂ² - bÂ²ğ‘–Â²
                     = aÂ² + bÂ²

è®¡ç®— (2 + 3ğ‘–) ä¸ (4 âˆ’ 5ğ‘–) ç›¸é™¤ä¸ºä¾‹ï¼š

    (2 + 3ğ‘–) / (4 âˆ’ 5ğ‘–) = (2 + 3ğ‘–)(4 + 5ğ‘–) / (4 - 5ğ‘–)(4 + 5ğ‘–)
                       = (8 - 15) + (10 + 12)ğ‘– / (4Â² + 5Â²)
                       = -(7 + 22ğ‘–) / 41
                       = -7/41 + 22ğ‘–/41

å¤æ•°çš„ä»£æ•°ä¹˜æ³•çœ‹ä¸Šå»å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ï¼Œå€ŸåŠ©å¤æ•°çš„çŸ©é˜µè¡¨ç¤ºï¼Œå¯ä»¥é‡æ–°ç†è§£å®ƒæ‰€è¡¨ç¤ºçš„å®é™…å«ä¹‰ã€‚

ä¸€ä¸ªå¤æ•°å¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ—‹è½¬ã€ç¼©æ”¾å˜æ¢ï¼Œå¤šä¸ªå¤æ•°ç›¸ä¹˜ï¼Œå¯ä»¥çœ‹ä½œæ˜¯å¤šä¸ªæ—‹è½¬ç¼©æ”¾å˜æ¢çš„å åŠ ã€‚ç”±äº 2D æ—‹è½¬
å’Œç¼©æ”¾æ— é¡ºåºå·®åˆ«ï¼Œæ‰€ä»¥å¤æ•°ç›¸ä¹˜æ»¡è¶³äº¤æ¢å¾‹ã€‚

æ„é€ ä¸€ä¸ªä»å¤æ•°é›†åˆ â„‚ åˆ°ç‰¹å®šçŸ©é˜µé›†åˆ ğ•„ çš„æ˜ å°„ï¼Œä½¿ä»»æ„å¤æ•° ğ‘ = ğ‘ + ğ‘ğ‘– ä¸€ä¸€å¯¹åº”æ˜ å°„åˆ°çŸ©é˜µ Mï¼š

    [ ğ‘  -ğ‘ ]
    [ ğ‘   ğ‘ ]

å½“ç„¶ï¼Œè¿™æ ·çš„æ˜ å°„å½“ç„¶ä¸æ˜¯æ»¡å°„ï¼Œå³çŸ©é˜µçš„ç»´æ•°ä¸ä»…æœ‰ 2x2ï¼Œæ‰€ä»¥å¯¹å€¼åŸŸåŠ è¿™ä¸ªç»´æ•°é™åˆ¶ï¼Œåˆ™ä½¿ä¹‹æˆä¸ºæ»¡å°„ã€‚
è¿™æ ·å®šä¹‰å¤æ•°çš„çŸ©é˜µè¡¨è¾¾ï¼Œå¯ä»¥ä½¿å¤æ•°çš„çŸ©é˜µè¿ç®—å®Œå…¨å’Œä¸€èˆ¬çŸ©é˜µæ— å¼‚ï¼ŒåŠ ã€å‡ã€ä¹˜ã€é™¤è¿ç®—è§„åˆ™éƒ½ä¸€è‡´ã€‚

å¤æ•°è¡¨ç¤ºçš„ 2D æ—‹è½¬å¦‚ä¸‹ï¼Œåœ¨å¤å¹³é¢å†…ï¼Œå‡è®¾å‘é‡ ğ‘ ä¸å®è½´çš„å¤¹è§’ä¸º Î˜ï¼Œåˆ™ï¼š

    cos(Î˜) = ğ‘ / âˆš(ğ‘Â² + ğ‘Â²)

    sin(Î˜) = ğ‘ / âˆš(ğ‘Â² + ğ‘Â²)

æå–å› å­ï¼Œå³å¯å°†ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä»£å…¥å¤æ•° ğ‘ = ğ‘ + ğ‘ğ‘– å¯¹åº”çš„çŸ©é˜µè¡¨è¾¾å¼ä¸­ï¼š

    [ ğ‘  -ğ‘ ]               [ cos(Î˜)  -sin(Î˜) ]
               = âˆš(ğ‘Â² + ğ‘Â²) 
    [ ğ‘   ğ‘ ]               [ sin(Î˜)   cos(Î˜) ]

æ‰€ä»¥ï¼Œå¤æ•°çš„çŸ©é˜µå½¢å¼ä»£è¡¨çš„æ˜¯ä¸€ä¸ªæ—‹è½¬ã€ç¼©æ”¾å˜æ¢ï¼Œæ—‹è½¬è§’åº¦ä¸º Î˜ï¼Œç»½æ”¾æ¯”ä¾‹ä¸º âˆš(ğ‘Â² + ğ‘Â²)ã€‚



å›åˆ°ä¸‰è§’å‡½æ•°è¡¨è¾¾çš„å•ä½åœ†æ–¹ç¨‹ï¼Œå°†å…¶å˜æ¢åˆ°å¤æ•°å¹³é¢ä¸Šï¼Œå®ƒå°±å¯ä»¥ç”¨æ¥ä»»æ„è§’åº¦æ—‹è½¬å¤æ•°ã€‚

    cos(Î¸)Â² + sin(Î¸)Â² = 1

ä»‹ç»ä¸€ä¸‹æåæ ‡(polar coordinate)ï¼Œå¸¸ç”¨çš„ xy ä¸¤è½´åæ ‡ç§°ä¸º Cartesian åæ ‡ï¼Œæåæ ‡çš„ä¹Ÿç”¨ xy è½´ï¼Œ
ä¸åŒçš„æ˜¯ï¼Œæåæ ‡åŠ å…¥äº†æ—‹è½¬è§’åº¦ï¼Œç”¨æ¥ Î¸ è¡¨ç¤ºæ²¿ x è½´æ­£æ–¹å‘é€†æ—¶é’ˆæ—‹è½¬åº¦æ•°ã€‚åœ¨æåæ ‡å¹³é¢ç³»ç»Ÿä¸­çš„ä»»æ„ç‚¹
å¯ä»¥ç”¨åŠå¾„å’Œæ—‹è½¬è§’åº¦æ¥è¡¨ç¤º (r,Î¸)ï¼Œå¤å¹³é¢å†…çš„ç‚¹å¯ä»¥å˜æ¢ä¸ºæåæ ‡çš„å½¢å¼ã€‚

å¯ç”¨ x = r cos(Î¸) å’Œ y = r sin(Î¸) æ¥è½¬åŒ–åˆ°ç¬›å¡å°”åæ ‡ï¼Œæ‰€ä»¥å¤æ•°æåæ ‡ (r, Î¸) è¡¨ç¤ºå¦‚ä¸‹ï¼š

    z = x + ğ‘–y 
      = r cos(Î¸) + ğ‘– r sin(Î¸)
      = e^(ğ‘–Î¸)

ç‰¹åˆ«çš„ï¼Œå¦‚æœ r = 1ï¼Œ åˆ™ 

    z = cos(Î¸) + ğ‘– sin(Î¸)

å½¢å¦‚ r e^(ğ‘–Î¸) çš„å¤æ•°ä¸ºæåæ ‡å½¢å¼ï¼Œå¹¶ä¸”ä¸ä¹‹ç›¸å¯¹çš„ x+ğ‘–y ä¸ºç¬›å¡å°”å½¢å¼. 1743 å¹´ï¼Œç‘å£«æ•°å­¦å®¶æ¬§æ‹‰
ç»™å‡ºäº†è‘—åçš„æ¬§æ‹‰å…¬å¼ï¼Œå¯¹æ‰€æœ‰å®æ•° Î¸ éƒ½æˆç«‹ã€‚è¿™å°±æ˜¯ç”¨å¯¹æ•°å½¢å¼è¡¨ç¤ºçš„æ¬§æ‹‰å…¬å¼ï¼Œä½†æ˜¯ï¼Œè¦ç†è§£è¿™ä¸ªå…¬å¼æ˜¯
å¦‚ä½•æ¥çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ ·ä¸œè¥¿ï¼Œå«åšæ³°å‹’çº§æ•° Taylor seriesã€‚

    e^(ğ‘–Î¸) = cos(Î¸) + ğ‘– sin(Î¸)

ç‰¹åˆ«å½“ Î¸ = Ï€ æ—¶ï¼ŒæŒ‰å¤æ•°å¹³é¢è§„åˆ™è¿ç®—ï¼Œå³è¾¹çš„å€¼ä¸º -1ï¼Œæ¬§æ‹‰å…¬å¼çš„ç‰¹æ®Šå½¢å¼æ›´æ˜¯è¢«è¯„ä¸ºæ•°å­¦ä¸Šæœ€ç¾çš„å…¬å¼ï¼š

    e^(ğ‘–Ï€) + 1 = ï¼

è¿™ä¸ªç®€æ´å…¬å¼åŒ…æ‹¬äº†æ•°å­¦ä¸Šæœ€é‡è¦çš„ 5 ä¸ªå¸¸æ•°ï¼š

- 0ï¼Œ1 è‡ªç„¶æ•°çš„åŸºæœ¬å•ä½ï¼›
- e æè¿°å˜åŒ–ç‡çš„è‡ªç„¶æŒ‡æ•°ï¼›
- Ï€ åœ†å‘¨ç‡ï¼›
- ğ‘– è™šæ•°çš„åŸºæœ¬å•ä½ã€‚

æœ€å¥‡æ€ªçš„é—®é¢˜æ˜¯ï¼šæˆ‘ä»¬æ€æ ·å–ä¸€ä¸ªæ•°çš„ ğ‘– æ¬¡æ–¹ï¼ŸæŒ‡æ•°ä¸Šæœ‰è™šæ•°æ€ä¹ˆç®—ï¼Ÿé‚£å°±æ˜¯ç”¨å¯¹æ•°å½¢å¼å¯¼å‡ºçš„æ¬§æ‹‰å…¬å¼ã€‚

ç”¨å‡ ä½•çš„æ–¹æ³•è¯æ˜è¯¥ç­‰å¼ï¼Œä¸åŒçš„ Î¸ å€¼å¯¹åº”çš„æåæ ‡ e^Î¸ï¼Œç‰¹åˆ«æ³¨æ„å¤å¹³é¢æ—‹è½¬è§’åº¦ 180Â° è½åˆ° -1 çš„æ—¶åˆ»ã€‚

ç”±æ•°å­¦å®¶å¸ƒé²å…‹Â·æ³°å‹’å‘ç°çš„ Taylor series åœ¨è¿‘ä¼¼è®¡ç®—ä¸­æœ‰é‡è¦ä½œç”¨ã€‚å‡½æ•° e^x çš„æ³°å‹’çº§æ•°æ‰©å±•å¦‚ä¸‹ï¼Œ
å› ä¸ºé˜¶ä¹˜ 0! å’Œ 1! çš„å€¼éƒ½å®šä¹‰ä¸º 1ï¼Œå¼å­å‰ä¸¤é¡¹ä¸º 1 + x:

    eË£ = xâ°/0! + xÂ¹/1! + xÂ²/2! + xÂ³/3! + xâ´/4! ... xâ¿/n!

é˜¶ä¹˜æ˜¯åŸºæ–¯é¡¿Â·å¡æ›¼ï¼ˆChristian Krampï¼Œ1760ï½1826ï¼‰äº 1808 å¹´å‘æ˜çš„è¿ç®—ç¬¦å·ï¼Œæ˜¯æ•°å­¦æœ¯è¯­ã€‚ä¸€ä¸ªæ­£
æ•´æ•°çš„é˜¶ä¹˜ï¼ˆfactorialï¼‰æ˜¯æ‰€æœ‰å°äºåŠç­‰äºè¯¥æ•°çš„æ­£æ•´æ•°çš„ç§¯ï¼Œå¹¶ä¸” 0 é˜¶ä¹˜ä¸º 1ã€‚è‡ªç„¶æ•° n é˜¶ä¹˜å†™ä½œ n!ã€‚
1808å¹´ï¼ŒåŸºæ–¯é¡¿Â·å¡æ›¼å¼•è¿›è¿™ä¸ªè¡¨ç¤ºæ³•ã€‚

å¦‚æœ n æ¯”è¾ƒå¤§ï¼Œç»“æœå‡ ä¹ç­‰äº e^xï¼Œä¸”æ·»åŠ çš„æ±‚å’Œé¡¹æ•°è¶Šå¤šï¼Œä¸¤ä¸ªç»“æœè¶Šé è¿‘ã€‚åœ¨æŸäº›æ—¶å€™ï¼Œè®¡ç®—å™¨ä¸Šçš„ä¸¤ä¸ª
ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè®¡ç®—å™¨ç²¾åº¦æ— æ³•æ£€æµ‹å®ƒä»¬ä¹‹é—´çš„å¾®å°åŒºåˆ«ã€‚å½“ä½ å¯¹æ— ç©·å¤šé¡¹æ±‚å’Œæ—¶ï¼Œä¸¤ä¸ªç»“æœæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚
å½“ä½ å¯¹æ— ç©·å¤šé¡¹æ±‚å’Œæ—¶ï¼Œä¸¤ä¸ªç»“æœæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚æ¬§æ‹‰å…¬å¼åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°çš„æ³°å‹’çº§æ•°ï¼Œæ³¨æ„è§’åº¦ä½¿ç”¨å¼§åº¦ã€‚

    cos(x) = 1 - xÂ²/2! + xâ´/4! - xâ¶/6! + ...
    sin(x) = x - xÂ³/3! + xâµ/5! - xâ·/7! + ...

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æ³°å‹’çº§æ•°ä¸­çš„å˜é‡ x æ¢æˆ ix å°±å¾—åˆ°ï¼š

    eâ±Ë£ = (ğ‘–x)â°/0! + (ğ‘–x)Â¹/1! + (ğ‘–x)Â²/2! + (ğ‘–x)Â³/3! + (ğ‘–x)â´/4! ... (ğ‘–x)â¿/n!

æŸäº› ğ‘– çš„æ¬¡æ–¹å¯ä»¥ç®€åŒ–ï¼Œä¾‹å¦‚ï¼ŒæŒ‰å®šä¹‰ ğ‘–Â² = âˆ’1ï¼Œğ‘–Â³ = -ğ‘– åŠ ğ‘–â´ = 1ï¼Œç­‰ç­‰ã€‚ä¸Šå¼ç®€åŒ–åï¼Œæ¶‰åŠ ğ‘– çš„é¡¹
åˆå¹¶åœ¨ä¸€èµ·ï¼Œç®€åŒ–å¼ä¼šåŒ…å«ä¸¤ä¸ªçº§æ•°ä¸å‰é¢ sin(x) å’Œ cos(x) çš„çº§æ•°ä¸€æ ·ï¼Œå°†å®ƒä»¬ä»£å…¥è€Œå¾—æ¬§æ‹‰å…¬å¼ã€‚



å¤æ•°çš„å¼•å…¥ï¼Œä¸ä»…ä»…è§£å†³äº†è´Ÿæ•°çš„å¼€æ–¹é—®é¢˜ï¼Œåœ¨å„è¡Œä¸šä¸Šä¹Ÿå¤§æ”¾å¼‚å½©ã€‚ä¾‹å¦‚ï¼Œä¿¡å·å¤„ç†é¢†åŸŸåˆ©ç”¨å‚…é‡Œå¶å˜æ¢å¯ä»¥
å®ç°é¢‘è°±åˆ†æä»ª Spectrum Analyzerï¼Œå¯ä»¥ç”¨æ¥åšéŸ³é¢‘ã€è§†é¢‘æ»¤æ³¢å¤„ç†ã€‚ç”µå­é¢†åŸŸä¸Šï¼ŒAC (Alternating Current)
äº¤æµç”µæŒ‰æ­£å¼¦å‡½æ•°è§„å¾‹å˜åŒ–ï¼Œç›´æ¥ä½¿ç”¨æ­£å¼¦å‡½æ•°å¾ˆéš¾å¤„ç†äº¤æµç”µçš„å åŠ ï¼Œä½†æ˜¯ä½¿ç”¨å¤æ•°å¹³é¢å°±å®¹æ˜“è§£å†³çš„å¤šã€‚

è¿˜å¯ä»¥ä½¿ç”¨å¤æ•°æ¥æ”¾å¤§ Mandelbrot Set æ›¼å¾·å¸ƒç½—ç‰¹é›†åˆ†å½¢å›¾å½¢ï¼Œåˆ†å½¢ä¹‹çˆ¶åˆ›é€ çš„è¿™ç§åˆ†å½¢åŸºäºå¤æ•°æ–¹ç¨‹
zâ‚™+1 ï¼ zâ‚™Â² + cï¼Œé‡å¤è¯¥æ­¥éª¤ç›´åˆ°ï¼š

- å‘æ•£åˆ°æ— ç©·è¿œå¤„ï¼Œæ ¹æ®å‘æ•£çš„é€Ÿåº¦é€‰æ‹©é¢œè‰²ï¼›
- ä¸ä¼šå‘æ•£ï¼Œå¹¶å½¢æˆå®é™…çš„ Mandelbrot é›†ï¼Œæ˜¾ç¤ºä¸ºé»‘è‰²ã€‚


### ğŸŸ ğŸ”µ Quaternions å››å…ƒæ•°
- [å››å…ƒæ•°çš„å¯è§†åŒ– by 3Blue1Brown](https://www.bilibili.com/video/av33385105/)
- [Visualizing quaternions, an explorable video series](https://eater.net/quaternions/video/intro)
- [Understanding Quaternions](https://www.3dgep.com/understanding-quaternions/)
- [å››å…ƒæ•°ä¸ä¸‰ç»´æ—‹è½¬ - Krasjet](https://krasjet.github.io/quaternion/quaternion.pdf)
- Visualizing Quaternions by Andrew J. Hanson
- [å››å…ƒæ•°â€”â€”åŸºæœ¬æ¦‚å¿µ - æ¨æ™ºä¸º](https://zhuanlan.zhihu.com/p/27471300)
- [å››å…ƒæ•°åº”ç”¨â€”â€”è½¬çŸ©é˜µã€Slerpæ’å€¼ä¸ä¸‡å‘èŠ‚](https://zhuanlan.zhihu.com/p/28189289)
- [å¦‚ä½•å½¢è±¡åœ°ç†è§£å››å…ƒæ•°ï¼Ÿ - Yang Eninala](https://www.zhihu.com/question/23005815/answer/33971127)
- [ç»´åº¦ï¼šæ•°å­¦æ¼«æ­¥ Dimensions: A Walk Through Mathematics (2008)](https://www.bilibili.com/video/BV1rx411J7EL)
- [GAMES105-è®¡ç®—æœºè§’è‰²åŠ¨ç”»åŸºç¡€-åˆ˜åˆ©æ–Œ](https://www.bilibili.com/video/BV1GG4y1p7fF/)
- [08.æ¸¸æˆå¼•æ“çš„åŠ¨ç”»æŠ€æœ¯åŸºç¡€ GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ](https://www.bilibili.com/video/BV1jr4y1t7WR?t=3794.3)

![Hamilton plaque at Broombridge, Cabra](https://ingeniousireland.ie/wp-content/uploads/2011/10/Broombridge-plaque-BDolan-2010-web-600x450.jpg)

ç›¸æ¯”çŸ©é˜µï¼Œç”¨å››å…ƒæ•°å¤„ç† 3D æ—‹è½¬çš„ä¼˜åŠ¿æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œä½†æ˜¯ Quaternions å››å…ƒæ•°æ¦‚å¿µå¤æ‚ï¼Œéš¾äºç†è§£ã€‚
å››å…ƒæ•°çš„å®šä¹‰å’Œå¤æ•°éå¸¸ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å››å…ƒæ•°æœ‰ä¸‰ä¸ªè™šéƒ¨ï¼Œè€Œå¤æ•°åªæœ‰ä¸€ä¸ªï¼æ‰€æœ‰çš„å››å…ƒæ•° ğ‘ âˆˆ â„ï¼Œ
â„ ä»£è¡¨å››å…ƒæ•°çš„å‘ç°è€… William Rowan Hamiltonï¼Œéƒ½å¯ä»¥å†™æˆä¸‹é¢è¿™ç§å½¢å¼ã€‚

    ğ‘ = ğ‘ + ğ‘ğ‘– + ğ‘ğ‘— + ğ‘‘ğ‘˜ âˆˆ â„ (ğ‘, ğ‘, ğ‘, ğ‘‘ âˆˆ â„)

    ğ‘–Â² = ğ‘—Â² = ğ‘˜Â² = ğ‘–ğ‘—ğ‘˜ = âˆ’1

    ğ‘–ğ‘— = -ğ‘—ğ‘– = ğ‘˜
    ğ‘—ğ‘˜ = -ğ‘˜ğ‘— = ğ‘–
    ğ‘˜ğ‘– = -ğ‘–ğ‘˜ = ğ‘—

ä¸€ä¸ªå››å…ƒæ•°ç”±ä¸€ä¸ªå®æ•°å’Œä¸€ä¸ªä¸‰ç»´å‘é‡æ„æˆï¼Œå››å…ƒæ•°å°±æ˜¯ä¸€ä¸ªé«˜é˜¶å¤æ•°ï¼Œå››å…ƒæ•°å…¶å®å°±æ˜¯åŸºåº• {1, ğ‘–, ğ‘—, ğ‘˜} 
çš„çº¿æ€§ç»„åˆï¼Œä¹Ÿå¯ä»¥å†™æˆå‘é‡çš„å½¢å¼ã€‚æœ‰è¯´æ³•æŒ‡å‡ºï¼Œå‘é‡è¿™ä¸ªåå­—å°±æ˜¯æ±‰å¯†å°”é¡¿å‘æ˜çš„ï¼Œå‘é‡çš„å‰ä¹˜ä¹Ÿæ˜¯å››å…ƒæ•°çš„
å‰¯äº§ç‰©ï¼š

    q = (ğ‘£âƒ— + ğ’˜)áµ€ = ((x,y,z),ğ’˜)áµ€

    qâ‚qâ‚‚ = (ğ’˜â‚ + xâ‚ğ‘– + yâ‚ğ‘— + zâ‚ğ‘˜) (ğ’˜â‚‚ + xâ‚‚ğ‘– + yâ‚‚ğ‘— + zâ‚‚ğ‘˜)
         = (ğ’˜â‚ğ’˜â‚‚ - xâ‚xâ‚‚ - yâ‚yâ‚‚ - zâ‚zâ‚‚) +
           (ğ’˜â‚xâ‚‚ + xâ‚ğ’˜â‚‚ + yâ‚zâ‚‚ - zâ‚yâ‚‚ )ğ‘– +
           (ğ’˜â‚yâ‚‚ + yâ‚ğ’˜â‚‚ + zâ‚xâ‚‚ - xâ‚zâ‚‚ )ğ‘— +
           (ğ’˜â‚zâ‚‚ + zâ‚ğ’˜â‚‚ + xâ‚yâ‚‚ - yâ‚xâ‚‚ )ğ‘˜

        = (ğ’˜â‚, ğ‘£âƒ—â‚) (ğ’˜â‚‚, ğ‘£âƒ—â‚‚)
        = (ğ’˜â‚ğ’˜â‚‚ - ğ‘£âƒ—â‚ âˆ™ ğ‘£âƒ—â‚‚, ğ’˜â‚ğ‘£âƒ—â‚‚ + ğ’˜â‚‚ğ‘£âƒ—â‚ + ğ‘£âƒ—â‚ â¨‰ ğ‘£âƒ—â‚‚)


å…¶å®ƒè¡¨è¾¾å½¢å¼åŠè¿ç®—ï¼š

- çº¯å››å…ƒæ•°   ğ‘ = 0 + ğ‘ğ‘– + ğ‘ğ‘— + ğ‘‘ğ‘˜, (ğ‘, ğ‘, ğ‘, ğ‘‘ âˆˆ â„)
- å•ä½å››å…ƒæ•° q = (ğ’˜, ğ‘£âƒ—)áµ€ = (cos(Î˜/2), ğ‘¢ sin(Î˜/2))  |ğ‘¢| = xÂ² + yÂ² + zÂ² + ğ’˜Â² = 1
- å…±è½­å››å…ƒæ•° q* = (ğ’˜, -ğ‘£âƒ—)áµ€
- æ ‡é‡ç§¯    sğ’’ = (sğ’˜, sğ‘£âƒ—)áµ€
- åŠ æ³•     qâ‚ + qâ‚‚ = (ğ’˜â‚+ğ’˜â‚, ğ‘£âƒ—â‚‚+ğ‘£âƒ—â‚‚)áµ€
- ç‚¹ç§¯     qâ‚ Â· qâ‚‚ = (ğ’˜â‚ğ’˜â‚ + ğ‘£âƒ—â‚‚Â·ğ‘£âƒ—â‚‚)
- ç‚¹ç§¯å…±è½­  (qâ‚ Â· qâ‚‚)* = qâ‚‚* Â· qâ‚*
- æ¨¡é•¿     |q| = âˆš(ğ’˜â‚ğ’˜â‚ + ğ‘£âƒ—â‚‚Â·ğ‘£âƒ—â‚‚) = âˆš(q Â· q)
- æ¨¡é•¿å¹³æ–¹  |q|Â² = q Â· q* = q* Â· q
- å€’æ•°     qâ»Â¹ = q* / |q|Â²
- å€’æ•°ç§¯   qqâ»Â¹ = qâ»Â¹q = 1


åœ¨ä¸‰ç»´ç©ºé—´çš„æ—‹è½¬æ“ä½œä¸­ï¼Œå³å·¥ç¨‹ä¸­çš„åˆšä½“æ—‹è½¬é—®é¢˜ï¼Œéœ€è¦è€ƒè™‘ç‰©ä½“å¦‚ä½•æ—‹è½¬ï¼Œæ˜¯æ ¹æ®å…¨å±€åæ ‡ç³»ç»Ÿï¼Œè¿˜æ˜¯ç‰©ä½“
å±€éƒ¨åæ ‡ç³»ç»Ÿã€‚ä¸€èˆ¬æ“ä½œä¸Šæ˜¯ä»¥å…¨å±€ç©ºé—´å®šä¹‰çš„ï¼Œé€šå¸¸ç‰©ä½“çš„åˆå§‹çŠ¶æ€ä¸‹ï¼Œæœ¬åœ°åæ ‡ä¸å…¨å±€åæ ‡æ˜¯å¯¹é½çš„ã€‚

Blender ä¸­æä¾›äº†ä¸‰ç§æ—‹è½¬æ–¹å¼ï¼Œå‘è´Ÿè½´å‘çœ‹ï¼Œä»¥é€†æ—¶é’ˆæ—‹è½¬ä¸ºæ­£æ—‹è½¬è§’åº¦ï¼š

- **Euler** The gizmo handles are aligned to the Euler axis, allowing you to see 
    the discreet XYZ axis underlying the Euler rotation, as well as possible Gimbal Lock.
- **Axis Angle** The X, Y, and Z coordinates define a point relative to the 
    object origin. This point and the origin define an axis around the W value 
    defines the rotation.
- **Quaternion** X, Y, Z and W correspond to the Quaternion components.

æ¬§æ‹‰è§’æ—‹è½¬æ—‹è½¬è½´ä¸ XYZ å„åæ ‡è½´å¯¹é½ï¼Œå³å„åæ ‡è½´å°±æ˜¯æ—‹è½¬è½´ï¼ŒæŒ‰å…ˆåé¡ºåºæ—‹è½¬ æœ‰ 6 ç§é¡ºåºç»„åˆï¼Œåˆ—è¡¨ä¸­
çš„åç§°ä¸­çš„å„è½´é¡ºåºä¸ Gimbal è®¾å¤‡ä¸­çš„å„è½´ç”±å†…åˆ°å¤–çš„å¥—æ¥é¡ºåºç›¸åŒã€‚ä¾‹å¦‚ï¼ŒZYX Euler æ—‹è½¬å°±æ˜¯ä¼˜å…ˆè¯»å–
Z è½´æ—‹è½¬è§’åº¦ï¼Œæœ€åè¯»å– X è½´æ—‹è½¬è§’ã€‚æˆ–è€…å¯ä»¥è¿™æ ·ç†è§£ï¼Œæ— è®ºå…¶å®ƒè½´å¦‚ä½•æ—‹è½¬ï¼Œåå­—å¼€å¤´çš„è¿™ä¸ªè½´æ€»æ˜¯ç»•ç‰©ä½“
å±€éƒ¨åæ ‡å¯¹åº”è½´ä½œä¸ºæ—‹è½¬è½´ï¼Œè€Œåå­—ç»“å°¾çš„ X åˆ™ç›¸å½“äºå…¨å±€ç©ºé—´çš„ X åæ ‡è½´ä½œä¸ºæ—‹è½¬è½´ã€‚
åå­—ä¸­é—´çš„æ—‹è½¬è½´å°±å–å†³äºå¦å¤–ä¸¤è€…çš„æ—‹è½¬çŠ¶æ€ï¼Œå› ä¸ºæœ‰ä¼˜å…ˆçº§çš„å…³ç³»ï¼Œç®—æ³•å°±å¯èƒ½å­˜åœ¨ Gimbal Lock ç°è±¡ã€‚

![Gimbal](https://pic2.zhimg.com/v2-2f3d8c9c2de8c7f225ab65092598685d_b.webp)

ä»¥è½´è§’è¡¨ç¤ºæ—‹è½¬ï¼ŒAxis Angle æ–¹å¼éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œæ—‹è½¬è½´å‘é‡ ğ‘¢ å’Œæ—‹è½¬è§’åº¦ Î˜ã€‚å³è¡¨ç¤ºç‰©ä½“ç»•è¿‡åŸç‚¹çš„ ğ‘¢ è½´
æ—‹è½¬ Î˜ è§’åº¦ã€‚å› è¯¥è½´ç©¿è¿‡åŸç‚¹ï¼Œåªéœ€è¦ä¸€ä¸ªä¸‰ç»´å•ä½çŸ¢é‡è¡¨ç¤ºè¯¥è½´æ–¹å‘ã€‚åœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œæ—‹è½¬è½´ ğ‘¢ çš„åæ ‡ä»¥åŠ
æ—‹è½¬è§’ç»„æˆå››ä¸ªè‡ªç”±åº¦ (Degree of Freedom)ï¼Œå¤šäºæ¬§æ‹‰è§’çš„ä¸‰ä¸ªè‡ªç”±åº¦ã€‚

è½´è§’æ³•æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼Œä¸¤ä¸ªç¡¬ä¼¤ï¼š

- ä¼˜ç‚¹ä¸€ï¼šåŒè½´çš„ä¸¤æ¬¡æ—‹è½¬å¯ä»¥ç›´æ¥ç›¸åŠ æ¥ç­‰æ•ˆä¸ºä¸€æ¬¡æ—‹è½¬ã€‚
- ä¼˜ç‚¹äºŒï¼šå®šä¹‰ç®€å•ï¼Œç›¸å¯¹ç›´è§‚ã€‚
- ç¡¬ä¼¤ä¸€ï¼šä¸¤ä¸ªåæ ‡ç³» xyz å’Œ x'y'z'ï¼Œè½´è§’æ³•è¡¨ç¤ºä¸å”¯ä¸€ï¼ˆè§’åº¦è§„å®šåœ¨0-180ï¼‰ã€‚å½“æ—‹è½¬è§’åº¦ä¸º 0ï¼Œæ—‹è½¬è½´
  å¯ä»¥ä¸ºä»»æ„æ–¹å‘ã€‚ä½†æ˜¯åœ¨åº”ç”¨ä¸­ï¼Œä¸€ä¸€å¯¹åº”å¾ˆé‡è¦ï¼Œè¿™ä¹Ÿå°±æš´éœ²å‡ºäº†è½´è§’æ³•è¡¨ç¤ºçš„æœ€è‡´å‘½çš„é—®é¢˜ã€‚
- ç¡¬ä¼¤äºŒï¼šä¸¤æ¬¡è¿ç»­çš„æ—‹è½¬æ€æ ·åˆæˆå‘¢ï¼Ÿæˆ–è€…è¯´æ˜¯ä¸¤ä¸ªæ—‹è½¬å¦‚ä½•åšå·®å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ²¡åŠæ³•ï¼Œé™¤éå€ŸåŠ©å…¶ä»–è¡¨ç¤ºæ–¹æ³•ã€‚

ä¸‹å›¾æ¼”ç¤ºäº†ä»¥å¾®ç§¯åˆ†æ€æƒ³çš„ä¸‰ç»´æ—‹è½¬è¡¨è¾¾ï¼Œdğ‘¢âƒ—/dÎ¸ = ğ‘âƒ— x ğ‘¢âƒ—ï¼š

![Axis-Angle Rotations in 3D](https://www.reedbeta.com/blog/rotations-and-infinitesimal-generators/rotation03.png)

å››å…ƒæ•°æ—‹è½¬ä¹Ÿå®šä¹‰äº†å››ä¸ªæ•°ï¼Œå…¶ä¸­ W å®šä¹‰ä¸€ä¸ªè§’åº¦ï¼Œä½†å®ƒä¸è½´è§’åº¦æˆªç„¶ä¸åŒã€‚é»˜è®¤ w = 1.0 çš„å‰æä¸‹ï¼Œæ—‹è½¬
1.0 ç›¸å½“ 90Â°ï¼Œä½†æ°¸è¿œåˆ°è¾¾ä¸äº† 180Â°ï¼Œå¹¶ä¸”ä¸æ˜¯çº¿æ€§å…³ç³»ï¼Œè®¾ç½®ç³»æ•° w = 0.5ï¼Œæ—‹è½¬è§’åº¦ç›¸å½“äºåŠ å€ï¼Œ
æœ€å¤§æ—‹è½¬è§’ä¾ç„¶ä¸º 180Â°ã€‚

è½´è§’æ—‹è½¬æ–¹å¼ Axis Angle (ğ‘£âƒ—, Î˜) å¯ä»¥å¯¹åº”åˆ°å››å…ƒæ•°æ—‹è½¬ï¼Œä½†è¿™ç§å¯¹åº”ä¸æ˜¯ä¸€ä¸€å¯¹åº”ï¼Œå³éæ»¡å°„å…³ç³»ï¼Œå½¢å¼
ä¹Ÿä¸åŒã€‚

    q = (ğ’˜, ğ‘£âƒ—)áµ€ = (cos(Î˜/2), ğ‘¢ sin(Î˜/2))
    Î˜ = 2argcos(ğ’˜)
    ğ‘¢ = ğ‘£âƒ—/|ğ‘£âƒ—|

æŒ‰ ğ‘¢ å‘é‡æ‰€å¯¹é½çš„è½´æ—‹è½¬ ğ‘ å¾—åˆ° ğ‘' å¯ä»¥è¡¨ç¤ºä¸ºï¼Œq æˆ– -q è¡¨ç¤ºåŒæ ·çš„æ—‹è½¬çš„ä¸¤ä¸ªæ–¹å‘ï¼Œä¸¤ä¸ªå››å…ƒæ•°æ—‹è½¬
å¯ä»¥å˜æ¢æˆè¿™ä¸¤ä¸ªå››å…ƒæ•°çš„å‰ç§¯çš„æ—‹è½¬ï¼š

    (0, ğ‘')áµ€ = q (0, ğ‘')áµ€ q* = (-q) (0, ğ‘')áµ€ (-q*)

ä¸€ä¸ªå››å…ƒæ•°å€¼å¯ä»¥åœ¨å‡ ä½•å­¦ä¸Šè§£é‡Šä¸ºï¼Œå®šä¹‰ 4D ç©ºé—´ä¸­å•ä½çƒä½“ä¸Šçš„ç‚¹ã€‚æ²¿ç€çƒä½“çš„ä»»ä½•å¤§åœ†ç§»åŠ¨ï¼Œè¡¨ç¤ºå›´ç»•å›ºå®š
è½´æ—‹è½¬ï¼Œä¸€ä¸ªå®Œæ•´çš„åœ†åŒ¹é…ä¸¤ä¸ªå®Œæ•´çš„æ—‹è½¬ã€‚

ä½¿ç”¨å››å…ƒæ•°è¿›è¡Œæ—‹è½¬æ“ä½œçš„ä¼˜ç‚¹ï¼š

- æä¾›çƒå½¢æ—‹è½¬çš„å¹³æ»‘æ’å€¼åŠŸèƒ½ï¼ŒSpherical Linear Interpolation (SLERP)ï¼›
- è§£å†³ä¸‡å‘èŠ‚æ­»é”ï¼ˆGimbal Lockï¼‰é—®é¢˜ï¼›
- ä»…éœ€å­˜å‚¨ 4 ä¸ªæµ®ç‚¹æ•°ï¼Œç›¸æ¯”çŸ©é˜µæ›´åŠ è½»é‡ï¼›
- å››å…ƒæ•°æ— è®ºæ˜¯æ±‚é€†ã€ä¸²è”ç­‰æ“ä½œï¼Œç›¸æ¯”çŸ©é˜µæ›´åŠ é«˜æ•ˆï¼›

æ‰€ä»¥ç»¼åˆè€ƒè™‘ï¼Œä¸»æµæ¸¸æˆæˆ–åŠ¨ç”»å¼•æ“éƒ½ä¼šç»„åˆç¼©æ”¾å‘é‡ã€æ—‹è½¬å››å…ƒæ•°ã€å¹³ç§»å‘é‡æ•°æ®å­˜å‚¨è§’è‰²çš„è¿åŠ¨ã€‚

æ€»ç»“ä¸€ä¸‹å·²ç»å¾—å‡ºçš„å››å…ƒæ•°ç‰¹æ€§ï¼š

- å››å…ƒæ•°æ˜¯å››ç»´ç©ºé—´ä¸­ä¸€ä¸ªè¶…çƒä¸Šé¢çš„ç‚¹ï¼Œæ»¡è¶³ wÂ²+xÂ²+yÂ²+zÂ²=1ã€‚
- å››å…ƒæ•°æ˜¯å¤æ•°è™šéƒ¨æ‰©å±•çš„ç»“æœï¼Œå¤æ•°çš„è™šéƒ¨ä¸º 1 ä¸ªï¼Œè€Œå››å…ƒæ•°è™šéƒ¨æœ‰ 3 ä¸ªï¼Œä¸”ä¸¤ä¸¤äº’ç›¸æ­£äº¤ã€‚
- ç”±äº wÂ²+xÂ²+yÂ²+zÂ²=1 çº¦æŸï¼Œå››å…ƒæ•°æ—‹è½¬åªæœ‰ 3 ä¸ªè‡ªç”±åº¦ï¼Œä¸”æ¯ä¸ªå››å…ƒæ•°å¯ä»¥å¯¹åº”ä¸€ä¸ªç‰¹å¾å‘é‡ï¼Œå³ nã€‚ä½†è¯·è®°ä½å››å…ƒæ•°å¹¶ä¸æ˜¯ä¸ç‰¹å¾å‘é‡ä¸€ä¸€å¯¹åº”ã€‚

åœ¨äºŒç»´å¹³é¢ç©ºé—´ä¸­åœ†è¡¨ç¤ºä¸º xÂ²+yÂ²=1ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­çƒä½“è¡¨ç¤ºä¸º xÂ²+yÂ²+zÂ²=1ï¼Œè€Œå››å…ƒæ•°å¯è¡¨ç¤ºä¸€ä¸ªè¶…çƒä½“ï¼Œ
Hypersphereï¼Œè€Œå…¶ä¸­çš„ 3 ä¸ªè™šéƒ¨åˆ†å³æ‹¥æœ‰ä¸‰ç»´ç©ºé—´ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªçƒä½“ã€‚Grant Sanderson å°è¯•ç”¨
Stereographic projection çƒæå¹³é¢æŠ•å½±ï¼Œé™ç»´æŠ•å°„çš„æ–¹å¼å¸®åŠ©ç†è§£å››å…ƒæ•°ï¼Œå°†äºŒç»´åœ†ä½œä¸ºä¸€ç»´çƒææŠ•å½±
å¾—åˆ°ä¸€æ¡æŠ•å½±çº¿ï¼Œçƒä½œä¸ºäºŒç»´çƒæå¹³é¢æŠ•å½±å¾—åˆ°ä¸€ä¸ªå¹³é¢ï¼Œè¶…çƒä½œä¸ºä¸‰ç»´çƒæå¹³é¢æŠ•å½±å¾—åˆ°ä¸€ä¸ªçƒä½“ã€‚

ç”±äºå››å…ƒæ•°å­˜åœ¨äºå››ç»´ç©ºé—´ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä½ç»´ä¿¡æ¯å»ç†è§£é«˜ç»´ä¿¡æ¯ã€‚ç”¨ä¸‰ç»´çƒä¸ºä¾‹ï¼Œä»£æ•°æ–¹ç¨‹ä¸º xÂ²+yÂ²+zÂ²=1ï¼Œ
è™½ç„¶çƒä¸Šé¢çš„ç‚¹æ˜¯ç”± xï¼Œyï¼Œz ä¸‰ä¸ªå‚æ•°æ¥ç¡®å®šï¼Œä½†å®é™…ä¸Šåªéœ€è¦ä¸¤ä¸ªï¼Œå› ä¸ºå·²ç»æ–¹ç¨‹å…³ç³»ã€‚å‡è®¾ x å’Œ z è¡¨ç¤ºï¼Œ
å…¶ä¸­ y å¯ä»¥é€šè¿‡ x å’Œ z è¿›è¡Œæ±‚è§£ã€‚æ‰€ä»¥å°† y è½´ä¿¡æ¯ç»™éšå»ï¼Œä¸‰ç»´çƒå°±å¯ä»¥æŠ•å½±ä¸ºå¹³é¢ä¸Šçš„åœ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
å›¾ç‰‡æ¥è‡ª Visualizing Quaternions Chapter 8 Visualizing Spheresï¼Œæ•™æç”¨ q è¡¨ç¤ºå››å…ƒå‘é‡ã€‚

![3D Sphere projection](https://pic2.zhimg.com/80/v2-8934d9751fb9f2485156b87b2d718171_1440w.webp)

> FIGURE 8.9 The standard sphere SÂ² visualized as two filled 2D discs, the northern 
> and southern hemispheres, together with the equatorial circle (i.e., SÂ¹ ) that 
> forms the border exactly between the two, at qâ‚€ = 0, or equivalently at |q| = 1.

è¿™å¼ å›¾çš„æ„æ€æ˜¯ï¼Œä¸‰ç»´çƒåœ¨ xOz å¹³é¢ä¸ŠæŠ•å½±æ˜¯ä¸€ä¸ªåœ†ï¼Œå½“çƒé¢ä¸€ç‚¹æŠ•å½±åœ¨è¿‡åœ†å¿ƒçš„å¹³é¢ä¸çƒé¢ç›¸äº¤çš„åœ†ä¸Šæ—¶ï¼Œ
y = 0ï¼ŒæŠ•å½±ç»“æœå°±æ˜¯å›¾ä¸Šçš„åœ†ã€‚å½“æŠ•å½±ä½äºåœ†å†…ï¼Œåˆ™åˆ†ä¸¤ç§æƒ…å†µï¼Œy > 0 å¤„äºåŒ—åŠçƒï¼Œy < 0 å¤„äºå—åŠçƒï¼Œ
ä¸¤ä¸ªåŠåœ†äº¤ç•Œå°±æ˜¯åœ†ã€‚æ‰€ä»¥ï¼Œé€šè¿‡æŠ•å½±åçš„åœ†å³å¯è¿˜åŸå‡ºæ•´ä¸ªçƒä½“ã€‚

![4D Sphere Projection](https://pic2.zhimg.com/80/v2-d636d27ab4a72b31925b1d610469b32d_1440w.webp)

> FIGURE 8.11 The quaternion SÂ³ visualized as two solid 3D balls, the northern 
> and southern hemispheres, together with the equatorial SÂ² that forms the border 
> exactly between the two, at qâ‚€ = 0, or equivalently at |q| = 1.

æ¨å¹¿åˆ°å››ç»´ç©ºé—´ï¼ŒwÂ²+xÂ²+yÂ²+zÂ²=1 ä¸­å– xã€yã€z æ¥è¡¨ç¤ºè¶…çƒ hypersphere åœ¨ä¸‰ç»´ç©ºé—´ä¸Šçš„æŠ•å½±ã€‚å››ç»´ç©ºé—´
çš„è¶…çƒæŠ•å½±åˆ°ä¸‰ç»´è¶…å¹³é¢å¯èƒ½æ˜¯ä¸€ä¸ª two-sphereï¼Œå½“æŠ•å½±ç‚¹åœ¨æ•´ä¸ª two-sphere çš„äº¤ç•Œæ—¶ï¼Œw = 0ã€‚æŠ•å½±ç‚¹
è½åœ¨ two-sphere çš„å†…éƒ¨æ—¶ï¼Œä¹Ÿåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œw > 0 å’Œ w < 0ã€‚è¿™ä¸¤ç§æƒ…å†µä¸‹å¯¹åº”çš„ç‰¹å¾å‘é‡æ˜¯ä¸€æ ·çš„ï¼Œ
æ‰€ä»¥æˆ‘ä»¬å°†æ—‹è½¬çŸ©é˜µå‘å››å…ƒæ•°è½¬æ¢æ—¶ï¼Œæ˜¯æœ‰ä¸¤ä¸ªå¯¹åº”å€¼çš„ï¼Œå››å…ƒæ•°çš„èŒƒå›´æ˜¯ 2 å€è¦†ç›–äº 3D æ—‹è½¬ï¼ˆ2:1 mappingï¼‰ã€‚



### ğŸŸ ğŸ”µ Calculus å¾®ç§¯åˆ†
- [Highlights of Calculus - Bilbert Strang](https://www.bilibili.com/video/BV13v411t7A6/)

å¾®ç§¯åˆ†ï¼ŒåŒ…æ‹¬å¾®åˆ†å’Œç§¯åˆ†ä¸¤ç§å®Œå…¨ç›¸åçš„é—®é¢˜å¤„ç†æ€ç»´ï¼Œdifferential and integralï¼Œå¾®åˆ†å‘ç»†å¾®å¤„æ±‚è§£ï¼Œ
ç§¯åˆ†å°†ç»†å¾®å˜åŒ–ç´¯ç§¯æˆä¸ºä¸€ä¸ªå®Œæ•´çš„ç»“æ„ã€‚

âˆ«â‚™áµ


### ğŸŸ ğŸ”µ Transformations å˜æ¢
- [Matrices and transforms](https://docs.godotengine.org/en/latest/tutorials/math/matrices_and_transforms.html)
- [Matrices and transforms](https://docs.godotengine.org/en/3.5/tutorials/math/matrices_and_transforms.html)
- [Viewport and canvas transforms](https://docs.godotengine.org/en/3.5/tutorials/2d/2d_transforms.html)
- [Using 3D transforms](https://docs.godotengine.org/en/3.5/tutorials/3d/using_transforms.html)
- [Matrix Transform Demo](https://github.com/godotengine/godot-demo-projects/tree/master/misc/matrix_transform)
- [Geometry Transformations](https://www.mathsisfun.com/geometry/transformations.html)
- [Visualization - Geometric Algorithms](https://www.cs.usfca.edu/~galles/visualization/Algorithms.html)
- [GAMES101: ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨](https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html)
- [GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª](https://www.bilibili.com/video/av90798049)
- [Grant Sanderson - 3blue1brown çº¿æ€§ä»£æ•°çš„æœ¬è´¨](https://www.bilibili.com/video/BV1ys411472E)
- [CSD 15-462 Computer Graphics - Carnegie Mellon University](https://www.cs.cmu.edu/afs/cs/academic/class/15462-f11/www/)

å›¾å½¢å­¦ä¸Šçš„å˜æ¢æ“ä½œä¸çŸ©é˜µè¿ç®—å¯†åˆ‡è”ç³»ï¼Œè¿™éœ€è¦æŒæ¡çŸ©é˜µè¿ç®—æ–¹æ³•ï¼Œä¸»è¦æ˜¯çŸ©é˜µä¹˜æ³•ã€‚

è¿™é‡Œè¯´çš„å˜æ¢æ˜¯äºŒç»´çš„ä»¿å°„å˜æ¢ï¼ˆAffine Transformationï¼‰ï¼Œå³ä¸¤ç§ç®€å•å˜æ¢çš„å åŠ ï¼šçº¿æ€§å˜æ¢åŠ å¹³ç§»å˜æ¢ã€‚
ä»¿å°„å˜æ¢ååŸæ¥çš„ç›´çº¿è¿˜æ˜¯ç›´çº¿ï¼ŒåŸæ¥çš„å¹³è¡Œçº¿ç»è¿‡ä»¿å°„å˜æ¢ä¹‹åè¿˜æ˜¯å¹³è¡Œçº¿ï¼Œè¿™å°±æ˜¯ä»¿å°„ã€‚æ‹‰ä¸è¯­ affine 
æ„æ€ä¸ºâ€œå’Œâ€¦ç›¸å…³â€ï¼Œå³å’ŒåŸå‹çº¿æ€§ç›¸å…³çš„å˜æ¢ã€‚å¹³ç§»ä¸æ˜¯çº¿æ€§å˜æ¢ï¼Œå› ä¸ºå¹³ç§»å¹¶æ²¡å‘ç”Ÿçº¿æ€§å…³ç³»çš„æ”¹å˜ï¼Œå¦‚åŒä¸€ä¸ª
è‹¹æœæ”¾åˆ°å¦ä¸€ä¸ªä½ç½®ä¸Šï¼Œè¿˜æ˜¯ä¸€ä¸ªè‹¹æœï¼Œè¿™ä¸ªæ¯”å–»å¯èƒ½ä¸å¤ªæ°å½“ã€‚

ä»¿å°„å˜æ¢å˜åŒ–åŸºæœ¬åŒ…æ‹¬ï¼š

- ç¼©æ”¾ Scale
- å¹³ç§» translation
- æ—‹è½¬ rotate
- åå°„ reflection
- é”™åˆ‡ shear mapping

ä»¿å°„å˜æ¢ä¸­é›†åˆä¸­çš„ä¸€äº›æ€§è´¨ä¿æŒä¸å˜ï¼š

- å‡¸æ€§ä¿æŒä¸å˜ï¼›
- å…±çº¿æ€§ï¼šè‹¥å‡ ä¸ªç‚¹å˜æ¢å‰åœ¨ä¸€æ¡çº¿ä¸Šï¼Œåˆ™ä»¿å°„å˜æ¢åä»ç„¶åœ¨ä¸€æ¡çº¿ä¸Šï¼›
- å¹³è¡Œæ€§ï¼šè‹¥ä¸¤æ¡çº¿å˜æ¢å‰å¹³è¡Œï¼Œåˆ™å˜æ¢åä»ç„¶å¹³è¡Œï¼›
- å…±çº¿æ¯”ä¾‹ä¸å˜æ€§ï¼šå˜æ¢å‰ä¸€æ¡çº¿ä¸Šä¸¤æ¡çº¿æ®µçš„æ¯”ä¾‹ï¼Œåœ¨å˜æ¢åæ¯”ä¾‹ä¸å˜ï¼›

å¡è€åŸºæ¢…éš†å¤§å­¦è®¡ç®—æœºå›¾å½¢å­¦ CMU 15-462/662 Computer Graphics è¯¾ä»¶ç›´è§‚åœ°æ¼”ç¤ºäº†ä»€ä¹ˆæ˜¯çº¿æ€§å˜æ¢ã€‚

![Linear Maps - Geometric Definition](http://15462.courses.cs.cmu.edu/fall2020content/lectures/02_linearalgebra/thumbs/slide_041.jpg)

è¯¾ç¨‹å¯¹ä»£æ•°çŸ¥è¯†çš„è®²è§£ä¹Ÿéå¸¸å…¨é¢ï¼Œæ¯”å¦‚å¯¹æ–¹ç¨‹ç»„è¿™ä¸ªæ¦‚å¿µçš„è§£æï¼ŒSystem of Linear Equations å³ç±»ä¼¼
ä»¥ä¸‹ä¸€ç»„æ–¹ç¨‹ï¼Œå·¦æ‰‹è¾¹æ˜¯çº¿æ€§å‡½æ•°ï¼Œå³æ‰‹è¾¹æ˜¯å¸¸é‡ã€‚æœªçŸ¥é‡æœ‰æ—¶ä¹Ÿå«åšè‡ªç”±åº¦ï¼Œdegrees of freedom (DOFs)ã€‚
æ–¹ç¨‹æœ‰æ—¶ä¹Ÿå«åšçº¦æŸï¼Œæ–¹ç¨‹ç»„çš„ç›®æ ‡æ˜¯æ±‚è§£åŒæ—¶æ»¡è¶³æ‰€æœ‰çº¦æŸçš„ DOFsã€‚

     x + 2y = 3
    4x + 5y = 6


å¯¹äºä¸€ä¸ªé›†åˆ ğ• çš„ä»¿å°„å˜æ¢å¯ä»¥å®šä¹‰ä¸ºï¼š

    f(x) = Ax + b, x âˆˆ ğ•

äºŒç»´å¹³é¢ä¸Šçš„ç‚¹è¿›è¡Œä»¿å°„å˜æ¢åªéœ€è¦ä¸€ä¸ª 2x2 çŸ©é˜µï¼Œå·¦ä¹˜ä¸¤ä¸ªçŸ©é˜µå…·æœ‰è¿ç»­å‡ ä½•å˜æ¢ä½œç”¨ï¼Œå¦‚ä¸‹ä¸¤ç§å‡ ä½•å˜æ¢ï¼š

    [ 1 1 ]   [ 0 -1 ]   [ x ]     [ 1 -1 ] [ x ]   [ x - y]
    [ 0 1 ]   [ 1  0 ]   [ y ]  =  [ 1  0 ] [ y ] = [ x    ]

     Shear    Rotation   Input      Composition

ä»£æ•°åŒ–è¡¨è¾¾çš„å„ç§çº¿æ€§å˜æ¢çŸ©é˜µï¼š

    [ s 0 ]   [ 1 a ]   [  cosÎ¸ sinÎ¸ ]
    [ 0 s ]   [ a 1 ]   [ -sinÎ¸ cosÎ¸ ]
     Scale     Shear       Rotation

ä¸¤ä¸ªç‹¬ç«‹çš„å˜æ¢ç­‰ä»·äºä¸€ä¸ªå¤åˆå˜æ¢ï¼ŒæŒ‰ç…§çŸ©é˜µä¹˜æ³•ï¼Œæ—‹è½¬çŸ©é˜µå¯ä»¥æ˜ å°„ [x, y] ä¸º [-y, x]ï¼ŒåŸå…ˆ x æ˜ å°„
åˆ°äº† -y ä¸Šï¼ŒåŸå…ˆ y æ˜ å°„åˆ° x è½´ä¸Šï¼Œä¹Ÿå°±æ˜¯é¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚ç„¶åæ²¿ x è½´åˆ‡å˜ä¸º [x - y, x]ã€‚æ³¨æ„ï¼Œ
è¿™ä¸¤ä¸ªå˜æ¢çš„çŸ©é˜µè¿ç®—é¡ºåºä¼šå½±å“ç»“æœã€‚å˜æ¢çŸ©é˜µè®¡ç®—å’Œä¹¦å†™é¡ºåºéƒ½ä»å³å¾€å·¦ï¼Œå’Œå¤åˆå‡½æ•° f(g(x)) è¡¨è¾¾ä¸€è‡´ã€‚
å¯ä»¥è®¡ç®—å‡ºç­‰ä»·çš„ç»„åˆå˜æ¢çŸ©é˜µæ›¿ä»£ä¸¤ä¸ªå˜æ¢çŸ©é˜µï¼Œä½†æ˜¯ç°åœ¨è®°ä½ä¸¤ä¸ªçŸ©é˜µç›¸ä¹˜çš„å‡ ä½•æ„ä¹‰æ›´é‡è¦ã€‚

åˆ©ç”¨å‡ ä½•å˜æ¢çš„æ„ä¹‰å»æ›¿ä»£å®é™…çš„è¿ç®—ï¼Œå³é€šè¿‡è·Ÿè¸ªå‘é‡åŸºåº•çš„è¿åŠ¨æ–¹å‘æ¥ç†è§£çŸ©é˜µè¿ç®—äº§ç”Ÿçš„å‡ ä½•æ„ä¹‰ï¼Œè¿™æ ·
æ›´æœ‰åŠ©äºç†è§£çº¿æ€§å˜æ¢çš„æ„ä¹‰ã€‚

å›¾å½¢å­¦ä¸Šï¼ŒäºŒç»´å›¾åƒå¤„ç†ä¸€èˆ¬ç”¨ 3x3 çŸ©é˜µè¡¨è¾¾ä»¿å°„å˜æ¢çš„çº¿æ€§å…³ç³»ï¼š

    [ x']   [ Râ‚€â‚€ Râ‚€â‚ Tx ]   [ x ]
    [ y'] = [ Râ‚â‚€ Râ‚â‚ Ty ] = [ y ]
    [ 1 ]   [ 0   0   1  ]   [ 1 ]

![Affine transformation - from Wiki](https://img-blog.csdnimg.cn/20190809112449680.png)


è‡³äºä¸ºä½•éœ€è¦é¢å¤–ç»™çŸ©é˜µæ·»å¢åŠ ä¸€ä¸ªç»´åº¦ï¼Œå³é½æ¬¡åæ ‡ Homogeneous coordinatesï¼Œç›®çš„æ˜¯ä¸ºè¾¾æˆçŸ©é˜µä¹˜æ³•
è¿ç®—çš„æ¡ä»¶ï¼Œä½¿èƒ½å¤„ç†å¹³ç§»å˜æ¢ï¼Œå¢åŠ  w åˆ†é‡å€¼æ„ä¹‰å–å†³äºç”¨é€”ã€‚

> â€œé½æ¬¡åæ ‡è¡¨ç¤ºæ˜¯è®¡ç®—æœºå›¾å½¢å­¦çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ï¼Œå®ƒæ—¢èƒ½å¤Ÿç”¨æ¥æ˜ç¡®åŒºåˆ†å‘é‡å’Œç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ›´æ˜“ç”¨äºè¿›è¡Œä»¿å°„å‡ ä½•å˜æ¢ã€‚â€
> â€”â€” F.S. Hill, JR

- 2D point  = (x, y, 1)áµ€
- 2D vector = (x, y, 0)áµ€
- 3D point  = (x, y, z, 1)áµ€
- 3D vector = (x, y, z, 0)áµ€

Valid operation if w-coordinate of result is 1 or 0

- vector + vector = vector å‘é‡ç›¸åŠ è¿˜æ˜¯å‘é‡
- point â€“ point = vector äº§ç”Ÿä¸€ä¸ªå‘é‡
- point + vector = point ç§»åŠ¨ä¸€ä¸ªç‚¹
- point + point = ?? ä¸¤ç‚¹çš„ä¸­ç‚¹ (x, y, w) --> (x/w, y/w, 1)ï¼Œä¸¤ç‚¹ç›¸åŠ å w åˆ†é‡åŠ å€ï¼Œè¦å˜å› 1 å°±éœ€è¦é™¤ä»¥ wã€‚

é€šè¿‡é½æ¬¡åæ ‡ï¼Œå¯ä»¥ç”¨å®ƒæ¥åŒºåˆ«ç‚¹ä¸å‘é‡ï¼Œä¹Ÿå¯ä»¥åœ¨åšè¿ç®—æ—¶ä¿æŒå‘é‡çš„å¹³è¡¡ä¸å˜æ€§è´¨ã€‚

å®Œæ•´ä»¿å°„å˜æ¢åŒ…å« Geometric contractionã€expansionã€dilationã€reflectionã€rotationã€shearã€
similarity transformationsã€spiral similarities å’Œ translation ç­‰ç±»åˆ«çš„ç»„åˆï¼Œé€šå¸¸æ¥è®²ï¼Œ
å¯ä»¥ç®€å•åœ°è®¤ä¸ºä»¿å°„å˜æ¢ç”± Rotationsã€Translationsã€Dilations å’Œ Shears å››ç±»ç»„åˆè€Œæˆã€‚

åœ¨ä¸‰ç»´å˜æ¢ä¸­ï¼Œå°†äºŒç»´å˜æ¢æ¨å¹¿ä½¿ç”¨ï¼Œåœ¨ [4x4] çš„ä»¿å°„çŸ©é˜µä¸­ï¼Œä½¿ç”¨å·¦ä¸Šè§’çš„ [3x3] ä½œä¸ºç¼©æ”¾ã€åˆ‡å˜ã€æ—‹è½¬
å˜æ¢ä½¿ç”¨ï¼Œå¤šç»´åº¦å˜æ¢å†ç»„åˆåˆ°ä¸€å—å°±æ˜¯ 3D å˜æ¢ã€‚å¯¹äºæ—‹è½¬ï¼Œé€šå¸¸ä¹Ÿæ˜¯æŒ‰æŒ‡å®šè½´è¿›è¡Œæ—‹è½¬ï¼Œè€Œä¸æ˜¯æŒ‰ä»»æ„å‘é‡
è¿›è¡Œæ—‹è½¬ï¼Œè¿™æ ·ä¼šå¾ˆå¤æ‚ã€‚

    [ x 0 0 0 ]  [ 1 0 0 x ]  [ 1     0     0 0 ]  [ cosÎ± 0 sinÎ± 0 ]  [ cosÎ± -sinÎ± 0 0 ]
    [ 0 y 0 0 ]  [ 0 1 0 y ]  [ 0  cosÎ± -sinÎ± 0 ]  [ 0    1    0 0 ]  [ sinÎ±  cosÎ± 0 0 ]
    [ 0 0 z 0 ]  [ 0 0 1 z ]  [ 0  sinÎ±  cosÎ± 0 ]  [-sinÎ± 0 cosÎ± 0 ]  [ 0     0    1 0 ]
    [ 0 0 0 1 ]  [ 0 0 0 1 ]  [ 0     0     0 1 ]  [ 0    0    0 1 ]  [ 0     0    0 1 ]
     S(x,y,z)     T(x,y,z)        Rx(Î±)                 Ry(Î±)                Rz(Î±)     

æ³¨æ„ï¼Œæ—‹è½¬å˜æ¢ä¸­çš„ä¸‰è§’å‡½æ•°ä½ç½®ï¼Œå¯¹ä»€ä¹ˆè½´è¿›è¡Œæ—‹è½¬æ“ä½œï¼Œå¯¹åº”è½´ä¸Šçš„åæ ‡å°±ä¿ç•™å•ä½çŸ©é˜µçš„å–å€¼ã€‚ç»•ä¸€ä¸ªè½´å‘
æ—‹è½¬ï¼Œè¿™ä¸ªè½´å¯¹åº”çš„çŸ©é˜µç³»æ•°å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œå³å°†ä½äºå¯¹è§’çº¿ä¸Šçš„å€¼è®¾ç½®ä¸º 1ï¼Œè¡Œã€åˆ—å†…å…¶å®ƒçš„å€¼è®¾ç½®ä¸º 0ã€‚

å¦å¤–ï¼Œæ—‹è½¬çŸ©é˜µä¸­çš„è´Ÿå·ä½ç½®å–å†³äºåæ ‡ç³»ç»Ÿï¼Œä»¥ä¸Šè¿™ç§å†™æ³•é€‚ç”¨äºå³æ‰‹åæ ‡ç³»ç»Ÿï¼Œæ‹‡æŒ‡æŒ‡å‘ Xï¼Œé£ŸæŒ‡æŒ‡å‘ Yï¼Œ
ä¸­æŒ‡æŒ‡å‘ Zï¼Œå¹¶ä¸”ä¸‰è€…ç›¸äº’å‚ç›´ã€‚å³ XY å‰ç§¯æŒ‡å‘ Zï¼Œè€Œ YZ å‰ç§¯æŒ‡å‘ Xï¼ŒZX å‰ç§¯æŒ‡å‘ Yã€‚å¦‚æ²¿ X è½´æ—‹è½¬ï¼Œ
è´Ÿå·è·Ÿç€ Z å¯¹åº”çš„çŸ©é˜µå…ƒç´ ï¼Œæ²¿ Y è½´æ—‹è½¬ï¼Œè´Ÿå·è·Ÿç€ X å¯¹åº”çš„çŸ©é˜µå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ã€‚ä½¿å¾—å‘è´Ÿè½´æ–¹å‘çœ‹ï¼Œ
æ—‹è½¬è§’ Î± çš„æ­£è´Ÿå€¼å§‹ç»ˆå’Œæ•°å­¦å®šä¹‰çš„æ­£è´Ÿæ–¹å‘ä¸€è‡´ï¼Œé€†æ—¶é’ˆä¸ºæ­£æ–¹å‘æ—‹è½¬ã€‚

å…³äºæ—‹è½¬çŸ©é˜µçš„æ¨ç†æ±‚è§£è¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒé—«ä»¤çªçš„ç½‘è¯¾ GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ 
[03 Transformation](https://www.bilibili.com/video/BV1X7411F744/?t=1111.3&p=3)

ä¸‰ç»´ç©ºé—´çš„è§’ç”¨ Euler angles æ¬§æ‹‰è§’è¡¨ç¤ºï¼Œå…¶æ—‹è½¬æŒ‰ä¸åŒçš„è½´å‘è¿›è¡Œï¼Œä»¥å¹³é©¶é£æœºä¸ºä¸»ä½“å‚è€ƒï¼š

- **Yaw**  - åèˆªè§’ï¼Œé£æœºç»•å‚ç›´æœºèº«çš„ä¸­è½´å·¦å³æ—‹è½¬çš„è§’åº¦ï¼›
- **Pitch**- ä¿¯ä»°è§’ï¼Œé£æœºç»•æœºç¿¼æ–¹å‘å¹³è¡Œçš„ä¸­è½´ä¸Šä¸‹æ‘‡æ‘†æœºå¤´çš„è§’åº¦ï¼›
- **Roll** - æ¨ªæ»šè§’ï¼Œé£æœºç»•è¡Œé©¶æ–¹å‘å¹³è¡Œçš„ä¸­è½´é¡º/é€†æ—¶é’ˆæ—‹åŠ¨çš„è§’åº¦ã€‚

æ¬§æ‹‰è§’æ˜¯å¤šè½´ç‹¬ç«‹çš„ã€æœ‰åºçš„æ—‹è½¬ç»„åˆï¼Œå¯èƒ½å¯¼è‡´ Gimbal lockï¼Œå¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¸å®¹æ˜“æ’å€¼å®ç°å¹³æ»‘çš„è¿åŠ¨ã€‚
æ‰€ä»¥ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ `rotation`ï¼Œè€Œæ˜¯ä½¿ç”¨å˜æ¢çŸ©é˜µã€‚

3D ç¯å¢ƒä¸‹ä¸‰ç§æ—‹è½¬æ–¹å¼å¯¹æ¯”ï¼š

|     æ–¹å¼   |              ä¼˜ç‚¹                  |                 ç¼ºç‚¹                     |
|-----------|------------------------------------|-----------------------------------------|
| çŸ©é˜µæ—‹è½¬   | ä½¿ç”¨é½æ¬¡åæ ‡å¯ä»¥ç®—æ˜¯å¹³ç§»ï¼Œå¯æŒ‰ä»»æ„å‘é‡æ—‹è½¬ | æ•°æ®å ç”¨ç©ºé—´å’Œæ—¶é—´ä¸Šæœ‰äº›æµªè´¹ï¼Œä¹˜æ³•æ“ä½œå¢åŠ è®¡ç®—é‡ |
| æ¬§æ‹‰è§’æ—‹è½¬  | å½¢è±¡ç›´è§‚ï¼Œåªéœ€è¦xã€yã€zè½´çš„æ—‹è½¬è§’åº¦       | ä½¿ç”¨3ä¸ª3x3çš„çŸ©é˜µåšå˜æ¢ï¼Œæ•ˆç‡ä¸å¦‚å››å…ƒæ•°        |
| å››å…ƒæ•°æ—‹è½¬  | 4ç»´çš„å››å…ƒæ•°å¯ä»¥ç»•åŸç‚¹ä»»æ„æ—‹è½¬ï¼Œå¯å¹³æ»‘æ’å€¼ | å¤šäº†ä¸€ä¸ªç»´åº¦ï¼Œæ¯”æ¬§æ‹‰æ—‹è½¬å¤æ‚ï¼Œä¸ç›´è§‚          |

æ¬§æ‹‰è§’æ—‹è½¬é€šå¸¸è¦æŒ‰ç…§ä¸€ä¸ªå›ºå®šçš„åæ ‡è½´çš„ä¼˜å…ˆé¡ºåºæ—‹è½¬ï¼Œå› æ­¤ä¸åŒçš„é¡ºåºä¼šé€ æˆä¸åŒçš„ç»“æœã€‚è¿™ç§ä¼˜å…ˆå¤„ç†æ–¹å¼
ä¼šé€ æˆä¸‡å‘èŠ‚é”ï¼ˆGimbal Lockï¼‰ç°è±¡ï¼Œå› æ­¤ç§æƒ…å½¢ï¼Œæ¬§æ‹‰æ—‹è½¬æ— æ³•å®ç°çƒé¢å¹³æ»‘æ’å€¼ã€‚ç†è®ºä¸Šï¼Œæ¬§æ‹‰æ—‹è½¬å¯ä»¥
é è¿™å„è½´ç‹¬ç«‹çš„æ—‹è½¬è®©ä¸€ä¸ªç‰©ä½“æŒ‡åˆ°ä»»ä½•ä¸€ä¸ªæƒ³è¦çš„æ–¹å‘ã€‚

è€Œä¸‡å‘èŠ‚é”é—®é¢˜ gimbal lockï¼Œæ˜¯åœ¨æ—‹è½¬è¿‡ç¨‹ä¸­å‡ºç°å¤±å»ä¸€ä¸ªè½´å‘ä¸Šçš„è‡ªç”±åº¦çŠ¶æ€ã€‚

ä¸‡å‘èŠ‚ï¼Œæˆ–å¹³è¡¡ç¯æ¶ Gimbal æ˜¯ä¸€å…·æœ‰æ¢çº½çš„è£…ç½®ï¼Œä½œç”¨æ˜¯ä½¿å¾—ä¸€ç‰©ä½“èƒ½ä»¥å•ä¸€è½´æ—‹è½¬ã€‚ç”±å½¼æ­¤å‚ç›´çš„æ¢çº½è½´
æ‰€ç»„æˆçš„ä¸€ç»„ä¸‰åªå¹³è¡¡ç¯æ¶ï¼Œåˆ™å¯ä½¿æ¶åœ¨æœ€å†…çš„ç¯æ¶çš„ç‰©ä½“ç»´æŒæ—‹è½¬è½´ä¸å˜ï¼Œè€Œåº”ç”¨åœ¨èˆ¹ä¸Šçš„é™€èºä»ªã€ç½—ç›˜ã€é¥®æ–™
æ¯æ¶ç­‰ç”¨é€”ä¸Šï¼Œè€Œä¸å—èˆ¹ä½“å› æ³¢æµªä¸Šä¸‹éœ‡åŠ¨ã€èˆ¹èº«è½¬å‘çš„å½±å“ã€‚

![Gimbal](https://pic2.zhimg.com/v2-2f3d8c9c2de8c7f225ab65092598685d_b.webp)

è¿™ç§è£…ç½®åœ¨å‡ºç°ä¸¤ä¸ªæ¢çº½å¯¹é½é‡å ï¼Œå°±æœ‰å¼•èµ·ä¸€ä¸ªè‡ªç”±åº¦å¤±æ•ˆçš„é—®é¢˜ã€‚ä¸‰ç»´è½¯ä»¶ç®—æ³•ä¸Šå¤„ç†ä¸å½“ï¼Œä¹Ÿä¼šæœ‰ç±»ä¼¼ç°è±¡ã€‚


ä»¿å°„å˜æ¢æ˜¯äºŒç»´å¹³é¢é‡è¦çš„å˜æ¢å½¢å¼ï¼Œåœ¨å›¾å½¢å¤„ç†é¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ï¼ŒGodot æä¾›ä»¥ä¸‹ç±»å‹æ”¯æŒå˜æ¢æ“ä½œï¼š

|    Class    |              Usage              |
|-------------|---------------------------------|
| Vector2     | Vector used for 2D math.        |
| Vector3     | Vector used for 3D math.        |
| Transform2D | 2D transformation (2Ã—3 matrix). |
| Transform3D | 3D transformation (3Ã—4 matrix). |

2D èŠ‚ç‚¹åªéœ€è¦ global_position å°±å¯ä»¥å®šä½åœ¨å±å¹•ç©ºé—´ï¼Œ3D èŠ‚ç‚¹åˆ™éœ€è¦ä¸€ä¸ªå˜æ¢çŸ©é˜µï¼Œå¹¶ä¸”æœ‰å…¨å±€ã€æœ¬åœ°
ä¸¤ä¸ªå˜æ¢ï¼Œåœ¨å±‚çº§å…³ç³»ä¸­ï¼Œçˆ¶èŠ‚ç‚¹çš„å˜æ¢ä¼šä¼ é€’ç»™å­èŠ‚ç‚¹ï¼Œå½±å“å­èŠ‚ç‚¹çš„ä½ç½®ã€‚

ä»¥ä¸‹æ˜¯ 3D èŠ‚ç‚¹ä¸å˜æ¢çŸ©é˜µç›¸å…³çš„å±æ€§é»˜è®¤å€¼ï¼Œä»¥åŠå˜æ¢çŸ©é˜µçš„é»˜è®¤å€¼ï¼š

```c,ignore
// Node3D
      Vector3 translation           [default: Vector3( 0, 0, 0 )]
      Vector3 rotation_degrees      [default: Vector3( 0, 0, 0 )]
      Vector3 rotationVector3scale  [default: Vector3( 1, 1, 1 )]
    Transform global_transform
      Vector3 global_translation
      Vector3 global_rotation
    Transform transform [default: Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0 )]

// Transform3D
        Basis basis [default: Basis( 1, 0, 0, 0, 1, 0, 0, 0, 1 )]
      Vector3 origin [default: Vector3( 0, 0, 0 )]

// Basis
Basis Basis(from: Quat)
Basis Basis(from: Vector3)
Basis Basis(axis: Vector3, angle: float)
Basis Basis(x_axis: Vector3, y_axis: Vector3, z_axis: Vector3)
```

å…¨å±€å¹³ç§» `global_translation` å¯¹åº”æ˜¯èŠ‚ç‚¹çš„å…¨å±€ä½ç½®åæ ‡ï¼Œç­‰ä»· global_transform.originã€‚
åŸºçŸ©é˜µåŒ…å«ä¸‰ä¸ªæ—‹è½¬è½´å‘é‡ï¼Œxã€yã€zï¼Œæ¯ä¸ªå‘é‡éƒ½æŒ‡å‘å…¶è½´æ—‹è½¬çš„æ–¹å‘ï¼Œå› æ­¤å®ƒä»¬æœ‰æ•ˆåœ°æè¿°äº†èŠ‚ç‚¹çš„æ€»æ—‹è½¬ã€‚
ä¹Ÿå¯ä»¥è¯´ï¼ŒåŸºçŸ©é˜µåŒ…å«äº†æ—‹è½¬åçš„å„è½´æŒ‡å‘ã€‚

Godot åœºæ™¯ä¸­ï¼Œæ‘„åƒæœºæ€»æ˜¯æœå‘å…¶ z-negative æ–¹å‘æ‘„åƒçš„ï¼š

![Camera in Godot Scene](https://docs.godotengine.org/en/stable/_images/transforms_camera.png)

æ‰€ä»¥ï¼Œå¦‚æœå°†ä¸€ä¸ªç›¸æœºä¸ç©å®¶è§†è§’ç»‘å®šï¼Œé‚£ä¹ˆç©å®¶çš„å‰è¡Œæ–¹å‘å°±åº”è¯¥å’Œæ‘„åƒæœºçš„åŸºçŸ©é˜µä¸­çš„ basis.z ä¸€è‡´ã€‚
ç›¸æœºåˆ™åªåšä¿¯ä»°è§’åº¦çš„è°ƒæ•´ï¼ˆpitchï¼‰ï¼Œè€Œç©å®¶è§’åº¦åšåèˆªè§’åº¦çš„è°ƒæ•´ï¼ˆyawï¼‰ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå®¹æ˜“å¤„ç†ï¼Œä¸ä¼š
æœ‰æ¬§æ‹‰è§’çš„çº¦æŸé—®é¢˜ã€‚ä¹Ÿä¸éœ€è¦ç›´æ¥è€ƒè™‘å¤æ‚çš„ç©ºé—´æ—‹è½¬é—®é¢˜ï¼Œåªéœ€è¦æ ¹æ®ç©å®¶çš„ yaw æ–¹å‘æ¥å†³å®šå‰è¡Œæ–¹å‘ã€‚

Godot åæ ‡ç³»ç»Ÿä¸­ï¼ŒæŒ‰ä»¥ä¸‹å‘é‡ç¡®å®šæ–¹å‘ï¼Œx è½´æŒ‡å‘ RIGHTï¼Œy è½´æŒ‡å‘ UPï¼Œz è½´æŒ‡å‘ BACK(backward)ï¼š

    Vector3.UP (0, 1, 0)
    Vector3.RIGHT (1, 0, 0)
    Vector3.FORWARD (0, 0, -1)

åŸºçŸ©é˜µæœ‰å››ç§æ„é€ æ–¹æ³•ï¼Œå¯ä»¥æ¥æ”¶ä¸€ä¸ªå››å…ƒæ•°ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ—‹è½¬è½´å‘é‡å’Œå¯¹åº”çš„æ—‹è½¬è§’ã€‚æˆ–è€…ä»¥ä¸€ä¸ªå‘é‡ç»™å®šçš„
Euler è§’åº¦æ„é€ çº¯æ—‹è½¬åŸºçŸ©é˜µï¼Œåœ¨ YXZ çº¦å®šä¸­ï¼šåˆæˆæ—¶é¦–å…ˆæ˜¯ Yï¼Œç„¶åæ˜¯ Xï¼Œæœ€åæ˜¯ Zï¼Œä»¥çŸ¢é‡æ ¼å¼ç»™å‡º
X è§’åº¦ã€Y è§’åº¦ã€Z è§’åº¦ã€‚åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨å››å…ƒæ•°ï¼Œè€Œä¸æ˜¯æ¬§æ‹‰è§’ã€‚


æ ¹æ®å˜æ¢çŸ©é˜µçš„ç»´åº¦ä¸åŒï¼Œ2D æˆ– 3Dï¼Œå˜æ¢çŸ©é˜µå¯¹è±¡åŒ…å«çš„åªæ˜¯ä¸€ç³»åˆ—å­˜å‚¨æµ®ç‚¹æ•°å€¼çš„å‘é‡ï¼Œä¹Ÿå°±æ˜¯ xyz ä¸‰è½´
å¯¹åº”çš„ä¸‰ä¸ªå‘é‡ï¼Œé€šè¿‡ä¸‹æ ‡å¯ä»¥è®¿é—®è¿™æ­¤çŸ©é˜µå…ƒç´ ï¼Œå°±åƒè®¿é—®æ•°ç»„çš„å…ƒç´ ä¸€æ ·ã€‚æ³¨æ„ï¼Œå˜æ¢çŸ©é˜µåªæ˜¯å®šä¹‰å¦‚ä½•å˜æ¢ï¼Œ
è€Œå˜æ¢åçš„ç»“æœï¼Œå¦‚ 3D ç‰©ä½“çš„æ—‹è½¬è§’åº¦è¿™äº›å€¼åˆ™æ˜¯å¦å¤–çš„å±æ€§ä¸­å­˜å‚¨çš„æ•°æ®ï¼Œåœ¨å±æ€§æ¢æµ‹å™¨ Transform åˆ†ç»„ï¼Œ
è€Œå˜æ¢çŸ©é˜µæ•°æ®åˆ™åœ¨ Matrix åˆ†ç»„ä¸­æ˜¾ç¤ºã€‚å˜æ¢åçš„å±æ€§å€¼é€šè¿‡å¯¼å‡ºå±æ€§è¯»å–ï¼Œå¦‚å½“å‰ç‰©ä½“çš„æ—‹è½¬è§’åº¦ï¼š

```py
var rotation:Vector3 = get("rotation_degrees")

var t = Transform2D()
# Translation
t.origin = Vector2(350, 150)
# Rotation
var rot = -0.5 # The rotation to apply.
t.x.x = cos(rot)
t.y.y = cos(rot)
t.x.y = sin(rot)
t.y.x = -sin(rot)
# Scale
t.x *= 3
t.y *= 3
transform = t # Change the node's transform to what we just calculated.
```

æ ¹æ®ï¼Œæ•°ç»„åœ¨å†…å­˜ä¸­çš„é¡ºåºç»“æ„ï¼ŒçŸ©é˜µçš„ç¬¬ä¸€ä¸ªç»´åº¦è¡¨ç¤ºä¸€è¡Œï¼Œç¬¬äºŒç»´åº¦è¡¨ç¤ºåˆ—ï¼Œå¦‚ t.x.y è¡¨ç¤º y è¡Œ x åˆ—ã€‚
ä¸€èˆ¬ä¸ä¼šç›´æ¥ä¿®æ”¹å˜æ¢çŸ©é˜µçš„å…ƒç´ ï¼Œè€Œæ˜¯é€šè¿‡æ–¹æ³•æ¥é—´æ¥ä¿®æ”¹ï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯æ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»ä¸‰ç§ä»¿å°„å˜æ¢ï¼š

```py
Transform rotated(axis: Vector3, angle: float)
Transform scaled(scale: Vector3)
Transform translated(offset: Vector3)
```

```py
Transform affine_inverse()
Transform interpolate_with(transform: Transform , weight: float)
Transform inverse() 
bool is_equal_approx(transform: Transform )
Transform looking_at(target: Vector3, up: Vector3)
Transform orthonormalized()
Variant xform(v: Variant)
Variant xform_inv(v: Variant)
```

ç”»å¸ƒä¸­çš„å›¾åƒè¦æ˜¾ç¤ºåˆ°å±å¹•ä¸Šï¼Œå³ä»ç”»å¸ƒé¡¹ç›®åæ ‡ç³»ç»Ÿè½¬æ¢åˆ°å±å¹•åæ ‡ç³»ç»Ÿï¼Œä¼šç»å†ä»¥ä¸‹å››ä¸ªå˜æ¢ã€‚å¹¶ä¸”ï¼Œç”»å¸ƒ
ä¸ CanvasLayer æ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œå³èŠ‚ç‚¹ä¹‹é—´çš„å±‚æ¬¡å—åˆ°æœ¬èº«åæ ‡å½±å“å¤–ï¼Œè¿˜å—åˆ° CanvasLayer çš„å½±å“ï¼š

- CanvasItem Coordinates
    - > CanvasItem Global Transform `CanvasItem.get_global_transform()`
    - > Canvas Layer Transform `CanvasItem.get_canvas_transform()`
    - > Viewport Global Canvas Transform
    - > Viewport Stretch Transform
- Screen Coordinates

æ³¨æ„ï¼Œå±å¹•åæ ‡æ˜¯æŒ‡ç¨‹åºçª—å£æ‰€å æ®çš„å±å¹•åŒºåŸŸï¼Œå·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œå³ä¸‹è§’ä¸ºæ­£æ–¹å‘ã€‚å…¶ä¸­ï¼ŒStretch Transform 
å˜æ¢å’Œé¡¹ç›®è®¾ç½® Stretch Mode ç›¸å…³ï¼Œå¯ä»¥é€šè¿‡ SceneTree æä¾›çš„æ–¹æ³•æ‰‹åŠ¨ç»™è§†å£è®¾ç½®å»¶ç”³å˜æ¢çŸ©é˜µï¼Œç›®çš„æ˜¯ä¸ºäº†å¤„ç†å¤šåˆ†è¾¨ç‡æ˜¾ç¤ºçš„é€‚åº”é—®é¢˜ã€‚

```py
void set_screen_stretch(mode: StretchMode, aspect: StretchAspect, minsize: Vector2, scale: float = 1)
```

ä½¿ç”¨ `CanvasItem.get_viewport_transform()` è·å– CanvasLayerã€GlobalCanvasã€Stretch 
ä¸‰åˆä¸€å˜æ¢çŸ©é˜µã€‚

åœ¨è¾“å…¥äº‹ä»¶`MainLoop._input_event()` ä¸­ï¼Œåæ ‡æ•°æ®æ˜¯ç»è¿‡ Stretch Transform å˜æ¢åçš„å€¼ï¼Œè¿™ä¸ª
å€¼å¯¹åº”çš„æ˜¯çª—å£åæ ‡ã€‚å¦å¤–è¿˜æä¾›äº† `CanvasItem.make_input_local()` å‡½æ•°æ–¹ä¾¿è½¬æ¢åˆ°ç”»å¸ƒå¯¹è±¡åæ ‡ã€‚

é»˜è®¤çŠ¶æ€ä¸‹ï¼Œè¾“å…¥äº‹ä»¶ä¸­çš„é¼ æ ‡ä½ç½®æ˜¯æŒ‡å…¨å±€ç©ºé—´ä¸‹ç›¸å¯¹äºå½“å‰èŠ‚ç‚¹çš„ CanvasLayer çš„åæ ‡ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸º
èŠ‚ç‚¹æœ¬åœ°åæ ‡ï¼Œæœ¬åœ°åæ ‡æ–¹å‘ä¸å…¨å±€åæ ‡ä¸åŒï¼Œä»¥å·¦ä¸‹è§’ä¸ºåŸç‚¹ï¼Œå³ä¸Šæ–¹å‘ä¸ºæ­£æ–¹å‘ã€‚å…¨å±€åæ ‡åˆ™ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œ
å³ä¸‹è§’ä¸ºæ­£æ–¹å‘ï¼Œå³ä¸Šä¸‹åè½¬å…³ç³»ã€‚

```py
Vector2 get_global_mouse_position() const # è·å–é¼ æ ‡ä½äºå½“å‰èŠ‚ç‚¹ç›¸å¯¹å½“å‰ CanvasLayer çš„åæ ‡

Vector2 get_local_mouse_position() const  # è·å–é¼ æ ‡ä½äºå½“å‰èŠ‚ç‚¹æœ¬åœ°åæ ‡

InputEvent make_input_local(event: InputEvent) const # è¾“å…¥äº‹ä»¶çš„é¼ æ ‡ä½ç½®è½¬æ¢ä¸ºå½“å‰èŠ‚ç‚¹æœ¬åœ°åæ ‡

Vector2 make_canvas_position_local(screen_point: Vector2) const
# Assigns screen_point as this node's new local transform.
```

æœ¬åœ°åæ ‡è¦è½¬æ¢ä¸ºå…¨å±€åæ ‡ï¼Œåªéœ€è¦æŒ‰ä»¥ä¸‹é¡ºåºåšé€†å˜æ¢ï¼Œå³å¯ä»¥å¾—åˆ°å±å¹•åæ ‡ã€‚è¿˜å¯ä»¥æ¨¡æ‹Ÿé¼ æ ‡äº‹ä»¶ï¼Œå°†å¸¦æœ‰
æŒ‡å®šåæ ‡ä¿¡æ¯çš„é¼ æ ‡äº‹ä»¶æŠ•å–‚åˆ° SceneTree äº‹ä»¶è¾“å…¥é˜Ÿåˆ—ä¸­ï¼š

```py
var screen_coord = get_viewport_transform() * (get_global_transform() * mouse.position)

var local_pos = Vector2(10, 20) # local to Control/Node2D
var ie = InputEventMouseButton.new()
ie.button_index = BUTTON_LEFT
ie.position = get_viewport_transform() * (get_global_transform() * local_pos)
get_tree().input_event(ie)
```


### ğŸŸ ğŸ”µ Curve & Geometry æ›²çº¿ä¸å‡ ä½•æŠ½è±¡æ€ç»´
- [Geometry](https://www.mathsisfun.com/geometry/index.html)
- [ä»é›¶å¼€å§‹å­¦å›¾å½¢å­¦ - è´å¡å°”æ›²çº¿](https://zhuanlan.zhihu.com/p/344934774)
- [æ›²çº¿ç¯‡: è´å¡å°”æ›²çº¿](https://zhuanlan.zhihu.com/p/136647181)
- [Bezier Curve Demos](http://math.hws.edu/eck/cs424/notes2013/canvas/bezier.html)
- [Animated BÃ©zier Curves](https://www.jasondavies.com/animated-bezier/)
- [ã€åä¸­ç§‘æŠ€å¤§å­¦ã€‘è®¡ç®—æœºå›¾å½¢å­¦ #ä¸‡ç³æ•™æˆ](https://www.bilibili.com/video/BV1V7411k74z?p=32)
- [GAMES101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨  Geometry - é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/?p=11)
- [æ¸…åå¤§å­¦-è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ - èƒ¡äº‹æ°‘](https://www.bilibili.com/video/BV13441127CH/)
- [CS3621 Introduction to Computing with Geometry Notes](https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/)
- [Mesh Shimplification](https://pages.mtu.edu/~shene/COURSES/cs3621/SLIDES/Simplification.pdf)
- [Multiresolution Modeling A Very Brief Introduction](https://pages.mtu.edu/~shene/COURSES/cs3621/SLIDES/Multiresolution.pdf)
- [Beziers, curves and paths](https://docs.godotengine.org/en/latest/tutorials/math/beziers_and_curves.html)
- [Interpolation](https://docs.godotengine.org/en/latest/tutorials/math/interpolation.html)

æ›²çº¿ä¸æ’å€¼å¯†åˆ‡ç›¸å…³ï¼ŒGodot æä¾›çš„çŸ¢é‡ç±»å‹éƒ½æœ‰çº¿æ€§æ’å€¼æ–¹æ³•ï¼ŒVector2.lerp() æˆ– Vector3.lerp()ï¼Œæˆ–è€…ï¼Œ
è¿›è¡Œä¸‰æ¬¡æ’å€¼ï¼ŒVector2.cubic_interpolate() æˆ– Vector3.cubic_interpolate()ï¼Œå®ƒä»¬éƒ½æ˜¯ Bezier æ’å€¼ã€‚
Curve2D, Curve3D, Path å’Œ Path2D éƒ½æ˜¯æ’å€¼ç»˜åˆ¶çš„æ›²çº¿èŠ‚ç‚¹ï¼Œåªéœ€è¦æä¾›ç›¸åº”çš„æ§åˆ¶ç‚¹åæ ‡ã€‚

ä»¥ä¸‹ä»£ç æ¼”ç¤ºæ’å€¼æ–¹æ³•æ¥ç§»åŠ¨ä¸€ä¸ª Sprite èŠ‚ç‚¹æ¥è·Ÿè¸ªé¼ æ ‡ä½ç½®ï¼š

```py
const FOLLOW_SPEED = 4.0

func _physics_process(delta):
    var mouse_pos = get_local_mouse_position()

    $Sprite2D.position = $Sprite2D.position.lerp(mouse_pos, delta * FOLLOW_SPEED)
```

å˜æ¢çŸ©é˜µä¹Ÿå¯ä»¥è¿›è¡Œæ’å€¼ï¼š

```py
var t = 0.0

func _physics_process(delta):
    t += delta

    $Monkey.transform = $Position1.transform.interpolate_with($Position2.transform, t)
```

BÃ©zier Curve è´å¡å°”æ›²çº¿æ˜¯è®¡ç®—æœºå›¾å½¢å­¦äºŒç»´å›¾å½¢åº”ç”¨ç¨‹åºçš„æ•°å­¦æ›²çº¿ï¼Œæ›²çº¿å®šä¹‰æœ‰èµ·å§‹ç‚¹ã€ç»ˆæ­¢ç‚¹ã€æ§åˆ¶ç‚¹ï¼Œ
é€šè¿‡è°ƒæ•´æ§åˆ¶ç‚¹ï¼Œè´å¡å°”æ›²çº¿çš„å½¢çŠ¶ä¼šå‘ç”Ÿå˜åŒ–ã€‚

1962 å¹´ï¼Œæ³•å›½æ•°å­¦å®¶ Pierre BÃ©zier ç¬¬ä¸€ä¸ªç ”ç©¶äº†è¿™ç§çŸ¢é‡ç»˜åˆ¶æ›²çº¿çš„æ–¹æ³•ï¼Œå¹¶ç»™å‡ºäº†è¯¦ç»†çš„è®¡ç®—å…¬å¼ï¼Œ
å› æ­¤æŒ‰ç…§å…¬å¼ç»˜åˆ¶å‡ºæ¥çš„æ›²çº¿å°±ç”¨ä»–çš„å§“æ°æ¥å‘½åï¼Œç§°ä¸ºè´å¡å°”æ›²çº¿ã€‚

äºŒæ¬¡ BÃ©zier æ›²çº¿åªéœ€è¦ä¸€ä¸ªæ§åˆ¶ç‚¹ï¼Œå¯ä»¥ç”»ä¸€æ¡ 1/4 åœ†å¼§ã€‚ä¸‰æ¬¡è´èµ›æ›²çº¿ï¼Œå‰ä¸¤ä¸ªæ˜¯æ§åˆ¶ç‚¹åæ ‡ã€‚å¯ä»¥é€šè¿‡
è°ƒèŠ‚æ§åˆ¶ç‚¹çš„ä½ç½®ï¼Œè¿›è€Œè°ƒæ•´æ•´ä¸ªæ›²çº¿ï¼Œæ¯”å¦‚ä½¿ç”¨ä¸¤ä¸ªæ§åˆ¶ç‚¹å¯ä»¥ç”» 1/2 åœ†ã€‚

![BÃ©zier curve](https://pic1.zhimg.com/80/c5e0a5463172222a82983fde34ccac5c_1440w.webp)

ä»¥äºŒæ¬¡ BÃ©zier æ›²çº¿çš„å®ç°è¿‡ç¨‹è§£æï¼Œæœ‰èµ·ç‚¹ã€æ§åˆ¶ç‚¹å’Œç»ˆç‚¹ P0ã€P1ã€P2ï¼Œæ›²çº¿çš„äº§ç”Ÿå®Œå…¨ä¸è¿™ä¸‰ä¸ªç‚¹ä½ç½®ç›¸å…³ã€‚
ä¸ºäº†ç¡®å®šç”»çº¿ï¼Œéœ€è¦ä¸¤ä¸ªè¿åŠ¨çš„å‚è€ƒç‚¹ï¼š

- R1 ä» P0 åˆ° P1 åŒ€é€Ÿç§»åŠ¨ï¼›
- R2 ä» P1 åˆ° P2 åŒ€é€Ÿç§»åŠ¨ï¼›

åœ¨æœŸé—´ R1 R2 è¿çº¿ï¼Œå…¶çº¿æ®µå¯èƒ½ä¼šé•¿çŸ­å˜åŒ–ï¼Œä½†åªéœ€æŒ‰æ¯”ä¾‹å– R1-R2 çº¿ä¸Šçš„ç‚¹è¿›è¡Œç»˜åˆ¶å³å¯å¾—åˆ°å¹³æ»‘çš„æ›²çº¿ã€‚
å¯¹äºä¸‰æ¬¡æˆ–æ›´é«˜é˜¶çš„ BÃ©zier æ›²çº¿ï¼Œéœ€è¦åœ¨å‚è€ƒç‚¹è¿çº¿ä¸Šå†è¿å‚è€ƒçº¿ï¼Œä¾ç…§å¤„ç†ï¼ŒåŒæ ·å¾—åˆ°å¹³æ»‘æ›²çº¿ã€‚

è™½ç„¶è´å¡å°”æ›²çº¿çš„é˜¶æ•°å¯ä»¥å¾ˆé«˜ï¼Œä½†æ˜¯é˜¶æ•°è¿‡é«˜ï¼Œè°ƒæ•´æ§åˆ¶ç‚¹å¯¹æ›²çº¿çš„å½±å“å°±æ¯”è¾ƒå°ï¼Œè°ƒæ•´èµ·æ¥ç›¸å½“éº»çƒ¦ã€‚äºæ˜¯ï¼Œ
é€šå¸¸ç”¨åˆ†æ®µçš„è´å¡å°”æ›²çº¿ï¼Œä¿è¯æ¯ä¸€å°æ®µä¸ä¼šå¤ªå¤æ‚ã€‚è¿™æ ·æ¯æ¬¡åªç”¨è°ƒå°æ®µï¼Œè¿˜å¯ä»¥åšåˆ°åªè°ƒå±€éƒ¨ä¸å½±å“å¤§å±€ã€‚

åˆ†æ®µå¸¦æ¥çš„å”¯ä¸€é—®é¢˜æ˜¯ï¼Œæ›²çº¿åœ¨æ®µä¸æ®µçš„äº¤ç•Œå¤„ï¼Œå¦‚ä½•ä¿è¯å¹³æ»‘ï¼Ÿæ‰€è°“å¹³æ»‘ï¼Œå°±æ˜¯ä¸€é˜¶å¯¼æ•°è¿ç»­ï¼Œå·¦å³å¯¼æ•°çš„æé™ç›¸åŒã€‚
æ›²çº¿ Anti-Aliasingï¼Œåªéœ€è¦åœ¨æ›²çº¿é™„è¿‘åšç‚¹æ’å€¼å°±è¡Œï¼Œæ»¡è¶³ç¦»æ›²çº¿è¶Šè¿‘çš„åƒç´ çš„åƒç´ å€¼è¶Šé«˜ï¼Œè¶Šè¿œçš„è¶Šä½ï¼Œå³å¯ã€‚

æ”¹è¿›çš„æ ·æ¡æ›²çº¿å°±æ˜¯ä¸€ç§æ–¹ä¾¿å•ç‹¬æ§åˆ¶çº¿æ®µçš„æ›²çº¿æè¿°ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ B-Splinesï¼Œå³ Basis-Splinesã€‚æ ·æ¡ä¸­
æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸¤ä¸ªæ§åˆ¶ç‚¹ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªæ§åˆ¶ç‚¹å°±å¯ä»¥æ”¹å˜çº¿æ®µçš„å¤–è§‚ã€‚

ç”±æ ·æ¡æ›²çº¿ä¸å¹³é¢ç»“åˆï¼Œå°±å¯ä»¥äº§ç”Ÿä»»æ„çš„æ›²é¢ï¼ŒNon-Uniform Rational B-Splines (NURBS) éå‡åŒ€
æœ‰ç† B æ ·æ¡æ›²é¢æ˜¯å·¥ä¸šå¸¸ç”¨çš„æ›²é¢ç”Ÿæˆå·¥å…·ã€‚é€šè¿‡æ›²çº¿æ§åˆ¶å¹³é¢ä¸Šçš„é¡¶ç‚¹åç§»ï¼Œä»è€Œæ„é€ å‡ºä»»æ„çš„æ›²é¢ï¼š

![Curve & surface](https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/surface/bs-local-mod-2.jpg)


æ›²é¢ç»†åˆ†æ˜¯æŒ‡å°†ä¸€ä¸ªæ¨¡å‹çš„é¢åˆç†çš„åˆ†æˆæ›´å¤šå°çš„é¢ï¼Œä»è€Œæå‡æ¨¡å‹ç²¾åº¦ï¼Œæé«˜æ¸²æŸ“æ•ˆæœã€‚è€Œæ›²é¢ç®€åŒ–æ˜¯æŒ‡å°†ä¸€ä¸ª
æ¨¡å‹çš„é¢åˆç†çš„åˆæˆæ›´å°‘çš„é¢ï¼Œä»è€Œé™ä½æ¨¡å‹ç²¾åº¦ï¼Œä¸ºç‰¹å®šæƒ…å½¢ä¸‹æä¾›ä½¿ç”¨ï¼Œå¦‚ Level Of Detail (LOD) æŠ€æœ¯ã€‚

å‡ ä½•æ¨¡å‹ç®€åŒ–æ˜¯å›¾å½¢å­¦çš„éš¾ç‚¹ï¼Œä¸ä¹‹ç›¸åçš„æ˜¯å‡ ä½•å›¾å½¢ç»†åˆ†é—®é¢˜ã€‚ç»†åˆ†çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨æ¯æ¡è¾¹ä¸Šæ’å…¥ä¸€ä¸ªæ–°çš„é¡¶ç‚¹ï¼Œ
éšç€ç»†åˆ†æ¬¡æ•°çš„å¢åŠ ï¼ŒæŠ˜çº¿é€æ¸å˜æˆä¸€æ¡å…‰æ»‘çš„æ›²çº¿ã€‚æ›²é¢ç»†åˆ†éœ€è¦æœ‰å‡ ä½•è§„åˆ™å’Œæ‹“æ‰‘è§„åˆ™ï¼Œå‡ ä½•è§„åˆ™ç”¨äºè®¡ç®—æ–°çš„
é¡¶ç‚¹ä½ç½®ï¼Œæ‹“æ‰‘è§„åˆ™ç”¨äºç¡®å®šæ–°é¡¶ç‚¹çš„è¿æ¥å…³ç³»ã€‚Catmull-Clark ç»†åˆ†æ˜¯ä¸€ç§å››è¾¹å½¢ç½‘æ ¼çš„ç»†åˆ†æ³•åˆ™ï¼Œæ¯ä¸ªé¢
è®¡ç®—ç”Ÿæˆä¸€ä¸ªæ–°çš„é¡¶ç‚¹ï¼Œæ¯æ¡è¾¹è®¡ç®—ç”Ÿæˆä¸€ä¸ªæ–°çš„é¡¶ç‚¹ï¼ŒåŒæ—¶æ¯ä¸ªåŸå§‹é¡¶ç‚¹æ›´æ–°ä½ç½®ã€‚

æ—¶é’Ÿæ‹¨å›åˆ° 1972 å¹´, åœ¨ Utah å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦è¯¾ç¨‹ä¸Š, ä¸€ä½åšå£«, ç”¨è´å¡å°”æ›²çº¿ç®—æ³•, ä¸ºè¿™èŠ‚è¯¾æäº¤äº†
ä¸€ä¸ªè¯¾ç¨‹é¡¹ç›®ï¼šA Computer Animated Handï¼Œè¿™åªæ‰‹, æ˜¯ç¾å›½å†å²ä¸Šæœ€æ—©è®°è½½çš„è®¡ç®—æœºç”ŸæˆåŠ¨ç”»(CG)ã€‚
è¿™ä½åšå£«å°±æ˜¯å¡ç‰¹ç¼ªå°” Edwin Catmullï¼Œåœ¨æ­¤å‰ 3 å¹´ï¼Œä»–åˆšæ‹¿åˆ°è‡ªå·±çš„ç‰©ç†ç³»å­¦ä½ï¼Œå‡­å€Ÿç€å¯¹äºå›¾å½¢çš„çƒ­æƒ…ï¼Œ
ä»–æˆä¸ºäº†ä¸€å®¶å« Applicon çš„åš CAD è½¯ä»¶çš„å…¬å¸çš„é›‡å‘˜ã€‚ç›´åˆ°ä»–é‡åˆ°äº† Ivan Sutherland è€Œå¼€å§‹äº†è®¡ç®—æœº
ç§‘å­¦åšå£«å­¦ä½çš„è¿›ä¿®ï¼Œä»¿ä½›é‡è·æ–°ç”Ÿï¼Œæ‰¾åˆ°äº†å°†è‡ªå·±çš„è‰ºæœ¯ç†æƒ³ä¸ç†å·¥ç§‘å­¦ç»“åˆçš„å¸Œæœ›ã€‚Catmull åšå£«çš„æ¯•ä¸šè®ºæ–‡ 
A subdivision algorithm for computer display of curved surfaces è‡³ä»Šè¶…è¿‡ä¸€åƒå¼•ç”¨ã€‚

Ivan Sutherland æ˜¯å›¾çµå¥–å¾—ä¸»ã€è®¡ç®—æœºå…ˆé©±ã€å†¯è¯ºä¼Šæ›¼å¥–ç« ã€å·¥ç¨‹ä¸ç§‘å­¦é™¢é™¢å£«ã€ACMä¼šå£«ã€è®¡ç®—æœºå†å²åšç‰©é¦†ä¼šå£«ï¼Œ
ä¼Šå‡¡Â·è‹æ³½å…°æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ä¹‹çˆ¶ï¼Œæ˜¯ Sun ç ”ç©¶é™¢çš„é«˜çº§æŠ€æœ¯é¡¾é—®ï¼Œæ˜¯éšè—åœ¨ Sun å›¢é˜ŸèƒŒåçœŸæ­£çš„å¯¼å¸ˆã€‚


æ›²çº¿æ˜¯æ•°å­¦æŠ½è±¡æ€ç»´çš„è¡¨è¾¾ï¼Œé€šè¿‡æ•°å­¦è¯­è¨€æ¥ç»„ç»‡æ€è€ƒï¼Œå¹¶è¿›è¡Œé«˜åº¦æŠ½è±¡æ€ç»´ï¼Œæ˜¯ä¸€ç§ä»æ— åˆ°æœ‰çš„åˆå‡†ç¡®çš„æ¦‚æ‹¬æ€ç»´ã€‚
æŠ½è±¡æ˜¯ä¸€ä¸ªå­¤ç«‹çš„è¿‡ç¨‹ï¼Œæ˜¯æ€è€ƒç€é€æ¸å°†ä¿¡æ¯é™ç»´ï¼Œä»¥ä¿ç•™æœ€æ™®éä¿¡æ¯çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ç¼ºä¹æŠ½è±¡æ€ç»´ï¼Œåˆ™é¢ä¸´è¢«ä¿¡æ¯æ·¹æ²¡ã€‚
ç¼ºä¹é€»è¾‘ï¼Œåˆ™éš¾ä»¥å»ºç«‹é—®é¢˜ä¸æ±‚è§£çš„å…³ç³»ã€‚ä¸€è¾¹ç®€åŒ–ä¿¡æ¯ï¼Œä¸€è¾¹å»ºç«‹é—®é¢˜ä¸è§£çš„å…³ç³»ï¼Œæ‰æ˜¯æœ€æ ¹æœ¬ä¹Ÿæ˜¯æœ€é‡è¦çš„åšæ³•ã€‚

æŒ‰ä»¥ä¸‹å°† 6 é¡¹æ€ç»´èƒ½åŠ›å½’ç±»ï¼š

- æ”¹å˜ä¸–ç•Œ <-- åˆ›æ–°æ€ç»´
- ç†è§£ä¸–ç•Œ <-- æ•´ä½“æ€ç»´ã€è¾©è¯æ€ç»´ã€é€»è¾‘æ€ç»´
- æ„Ÿå—ä¸–ç•Œ <-- å½¢è±¡æ€ç»´

å¯ä»¥æŠŠç†è§£ä¸–ç•Œçš„ 3 ä¸ªåŸºæœ¬çš„æ€ç»´ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„æŠ½è±¡æ€ç»´ï¼š

- é€»è¾‘æ€ç»´ï¼ˆä¸€å…ƒæ€ç»´ã€çº¿å½¢ã€æ˜ç¡®çš„å› æœå…³ç³»ï¼‰
- è¾©è¯æ€ç»´ï¼ˆäºŒå…ƒæ€ç»´ï¼Œå¯¹ç«‹ç»Ÿä¸€çš„ä¸¤ä¸ªè¦ç´ ï¼‰
- æ•´ä½“æ€ç»´ï¼ˆå¤šå…ƒæ€ç»´ï¼Œè®¤ä¸ºäº‹ç‰©æ˜¯ç›¸äº’è”ç³»çš„æ•´ä½“ï¼Œæ—¢è§æ ‘æœ¨åˆè§æ£®æ—ï¼‰

æ€ç»´æ˜¯äººè„‘å€ŸåŠ©äºè¯­è¨€å¯¹äº‹ç‰©çš„æ¦‚æ‹¬å’Œé—´æ¥çš„ååº”è¿‡ç¨‹ï¼Œçœ‹è‹¹æœæ˜¯è‹¹æœï¼Œè¿™å°±æ˜¯`å½¢è±¡æ€ç»´`ã€‚ä»ä¸€ä¸ªè‹¹æœä¸€æ ¹é»„ç“œ
æŠ½è±¡å‡ºæ•°å­— 1 çš„æ¦‚å¿µï¼Œè¿›ä¸€æ­¥æŠ½è±¡å‡ºåŠ å‡ä¹˜é™¤å››åˆ™è¿ç®—çš„æ¦‚å¿µï¼Œè¿™åº”è¯¥æ˜¯å¤§éƒ¨åˆ†æ™ºåŠ›æ­£å¸¸çš„äººéƒ½èƒ½è¾¾åˆ°çš„ã€‚
ç„¶åä»å…·ä½“çš„æ•°å­—è¿ç®—æŠ½è±¡å‡ºç”¨å­—æ¯ä»£æ›¿æ•°å­—ï¼Œå‡ºæ¥æ–¹ç¨‹ã€ä»£æ•°æ¦‚å¿µï¼Œè¿™ä¸€æ­¥å·²ç»èƒ½æ·˜æ±°ä¸€äº›äººäº†ã€‚å†æŠ½è±¡åˆ°é›†åˆï¼Œ
æŠ½è±¡åˆ°å‡½æ•°ï¼Œè¿™ä¸€æ­¥èƒ½æ·˜æ±°æ‰å¤§åŠäººä»¥ä¸Šã€‚`å‡½æ•°`ã€`é›†åˆè®º`çš„æŠ½è±¡è¿™ä¸€æ­¥è¿‡ä¸å»ï¼Œå°±å¾ˆéš¾åšè¿›ä¸€æ­¥çš„æŠ½è±¡ã€‚å‡½æ•°
ä¹‹ä¸Šè¿˜æœ‰ epsilon-delta è¯­è¨€ï¼Œè¿™æ˜¯å¾ˆå¤šäººç¬¬ä¸€æ¬¡æ¥è§¦çœŸæ­£æ„ä¹‰ä¸Šçš„ç°ä»£æ•°ç†é€»è¾‘ã€‚æ˜¯çš„ï¼Œå¾ˆå¤šäººçš„æŠ½è±¡æ€ç»´
èƒ½åŠ›è¿˜æ ¹æœ¬æ²¡è¾¾åˆ°èƒ½è¯»æ‡‚å½¢å¼é€»è¾‘çš„åœ°æ­¥ï¼Œè¿˜æœ‰æŠ½è±¡ä»£æ•°ï¼Œè¿˜æœ‰æ‹“æ‰‘ã€‚

ç½—ç´ è¯´è¿‡ï¼Œæ•°å­¦æ˜¯ç¬¦å·åŠ é€»è¾‘ã€‚å¤§å«Â·å¸Œå°”ä¼¯ç‰¹ David Hilbert è¯´è¿‡ï¼Œå¬åˆ«äººè®²è§£æŸäº›æ•°å­¦é—®é¢˜æ—¶ï¼Œå¸¸è§‰å¾—å¾ˆéš¾ç†è§£ï¼Œ
ç”šè‡³ä¸å¯èƒ½ç†è§£ã€‚è¿™æ—¶ä¾¿æƒ³ï¼Œæ˜¯å¦å¯ä»¥å°†é—®é¢˜åŒ–ç®€äº›å‘¢ï¹–å¾€å¾€ï¼Œåœ¨ç»ˆäºå¼„æ¸…æ¥šä¹‹åï¼Œå®é™…ä¸Šï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ›´ç®€å•çš„é—®é¢˜ã€‚


å‡ ä½•å›¾å½¢è¡¨è¾¾æœ‰æ˜¾å¼ã€éšå¼ä¸¤ç§åŸºæœ¬å½¢å¼ï¼š

- éšå¼ Implicitï¼šç”¨è§£æå¼è¡¨ç¤ºã€‚æ˜“äºåˆ¤æ–­ç‚¹ç›¸å¯¹äºé¢çš„ä½ç½®ï¼Œä¸æ˜“åˆ¤æ–­å“ªäº›ç‚¹åœ¨é¢ä¸Šã€‚
    - æ•°å­¦å…¬å¼ï¼šè§£æå‡ ä½•ä½¿ç”¨æ•°å­¦å…¬å¼è¡¨è¾¾å‡ ä½•ä½“ï¼Œç¼ºç‚¹æ˜¯ä¸å®¹æ˜“è¡¨ç¤ºå¤æ‚å½¢çŠ¶ã€‚
    - Constructive Solid Geometry (CSG)ï¼šé€šè¿‡ä¸€ç³»åˆ—åŸºæœ¬å‡ ä½•çš„åŸºæœ¬è¿ç®—ï¼ˆä¾‹å¦‚å¸ƒå°”è¿ç®—ï¼‰æ¥å½¢æˆæ–°çš„å‡ ä½•ã€‚
    - Distance Functionsï¼šå¦‚ç¬¦å·è·ç¦»å‡½æ•° Signed Distance Functions (SDF)ã€‚
    - Fractals åˆ†å½¢
- æ˜¾å¼ Explicitï¼šæ˜¾å¼ç»™å‡ºæˆ–å‚æ•°æ˜ å°„æ¥å®šä¹‰å‡ ä½•è¡¨é¢ã€‚æ˜“äºåˆ¤æ–­å“ªäº›ç‚¹åœ¨é¢ä¸Šï¼Œä¸æ˜“åˆ¤æ–­ç‚¹ç›¸å¯¹äºé¢çš„ä½ç½®ã€‚
    - Point Cloudï¼šç‚¹äº‘æ˜¯å¤§é‡ç‚¹çš„åˆ—è¡¨ã€‚å®ƒé€šè¿‡å¯†é›†çš„ç‚¹æ¥ç»™äººä»¥é¢çš„æ„Ÿè§‰ã€‚ç‚¹äº‘ä¸€èˆ¬æ˜¯æ‰«æåå¾—åˆ°çš„æ•°æ®ã€‚
    - Polygon Meshï¼šå¤šè¾¹å½¢é¢æ˜¯æœ€å¸¸è§çš„æ˜¾å¼è¡¨ç¤ºæ–¹å¼ã€‚

The Wavefront Object Fileï¼ˆ.objï¼‰æ–‡ä»¶å®šä¹‰ç©ºé—´ä¸­çš„ç‚¹ã€æ³•çº¿ã€çº¹ç†åæ ‡ç­‰ï¼Œç„¶åç»„ç»‡èµ·æ¥è¡¨ç¤ºå¤šè¾¹å½¢é¢ã€‚

è·ç¦»å‡½æ•°æè¿°ç©ºé—´ä¸­ä»»ä½•ä¸€ä¸ªç‚¹åˆ°è¡¨é¢çš„æœ€å°è·ç¦»ï¼Œè¡¨é¢å¤–éƒ¨çš„ä¸ºæ­£æ•°ï¼Œè¡¨é¢å†…éƒ¨ä¸ºè´Ÿæ•°ï¼ŒSDF ä¸º 0 çš„ä½ç½®
å°±æ˜¯ç‰©ä½“çš„è¡¨é¢ã€‚ä½¿ç”¨è·ç¦»å‡½æ•°å¯¹ä¸¤ä¸ªç‰©ä½“è¿›è¡Œæ··åˆçš„åšæ³•æ˜¯ï¼šå…ˆæ··åˆå®ƒä»¬çš„ SDFï¼Œç„¶åå°†ç»“æœæ¢å¤æˆå½¢çŠ¶ã€‚

ä¾‹å¦‚ (x - a)Â² + (x - b)Â² = rÂ² è¡¨ç¤ºä¸€ä¸ªåœ†å½¢ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªæ²¡æœ‰æ¥è§£è¿‡ä»£æ•°å‡ ä½•çš„äººï¼Œæ˜¯å¾ˆéš¾ç›¸åƒå®ƒ
æ˜¯ä»€ä¹ˆçš„ï¼Œè¿™å°±æ˜¯å‡ ä½•å›¾å½¢çš„éšå¼è¡¨è¾¾ã€‚å³ä½¿å—è¿‡é«˜ç­‰æ•°å­¦æ•™è‚²çš„äººï¼Œä¹Ÿéš¾ä»¥æƒ³è±¡ä¸€ä¸ªå¤æ‚å›¾å½¢çš„ä»£æ•°è¡¨è¾¾ã€‚æ¯”å¦‚ï¼Œ
(R - âˆš(xÂ² + yÂ²))Â² + zÂ² = rÂ² å°±å¾ˆéš¾çœ‹å‡ºæ¥æ˜¯ä¸€ä¸ªåœ†ç¯ã€‚

ä½†æ˜¯ï¼Œè¿™ç§éšå¼å‡ ä½•å›¾å½¢çš„è¡¨è¾¾åœ¨è®¡ç®—å¤„ç†æ—¶å´éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨å‡ ä½•ä½“å†…ã€‚

è€Œä¸€ç§æ¯”è¾ƒç›´è§‚çš„å›¾å½¢è¡¨è¾¾æ–¹å¼æ˜¯å›¾å½¢çš„å¸ƒå°”è¿ç®—ï¼Œå¸ƒå°”æ˜¯è‹±å›½çš„æ•°å­¦å®¶ï¼Œåœ¨ 1847 å¹´å‘æ˜äº†å¤„ç†äºŒå€¼ä¹‹é—´å…³ç³»
çš„é€»è¾‘æ•°å­¦è®¡ç®—æ³•ï¼ŒåŒ…æ‹¬ï¼š

- è”åˆ unionwaov
- ç›¸äº¤ intersection
- ç›¸å‡ subtraction

åœ¨å›¾å½¢å¤„ç†æ“ä½œä¸­å¼•ç”¨äº†è¿™ç§é€»è¾‘è¿ç®—æ–¹æ³•ï¼Œä»¥ä½¿ç®€å•çš„åŸºæœ¬å›¾å½¢ç»„åˆäº§ç”Ÿæ–°çš„å½¢ä½“ï¼Œè¿˜å¯ä»¥è¿›è¡Œå›¾å½¢æ‰“æ•£ï¼Œå¹¶ç”±
äºŒç»´å¸ƒå°”è¿ç®—å‘å±•åˆ°ä¸‰ç»´å›¾å½¢çš„å¸ƒå°”è¿ç®—ã€‚

è€ƒè™‘å›¾å½¢å…³ç³»çš„å‡ ç§æƒ…å†µï¼š

- ä¸¤å›¾å½¢æ²¡æœ‰ç›¸äº¤éƒ¨åˆ†ï¼Œåšå¸ƒå°”è¿ç®—éƒ½ç®€å•ã€‚
- å…¶ä¸­ä¸€ä¸ªå›¾å½¢åŒ…å«å¦ä¸€ä¸ªå›¾å½¢ï¼Œè¿™ä¹Ÿæ˜¯å®¹æ˜“çš„æƒ…å½¢ï¼Œå°†å…¶ä¸­ä¸€ä¸ªå›¾å½¢åè½¬æ–¹å‘ç»˜åˆ¶ï¼Œè¿™æ ·å¾—åˆ°çš„ Loop å°±æ˜¯é•‚ç©ºçš„ã€‚
- å½“ä¸¤ä¸ªå›¾å½¢ç›¸äº¤æ—¶ï¼Œæƒ…å†µå°±å¤æ‚äº†ã€‚å¯èƒ½æ˜¯ç‚¹çº¿ç›¸äº¤ï¼Œä¹Ÿå¯ä»¥æ˜¯éƒ¨åˆ†ç›¸äº¤ï¼Œæ ¹æ®ä¸åŒçš„è¿ç®—éœ€æ±‚ä¸ä¸€æ ·ã€‚

Path å…ƒç´ å¯èƒ½æ˜¯æ‰€æœ‰ SVG å›¾å½¢ä¸­æœ€é€šç”¨çš„å½¢çŠ¶ï¼Œå¯èƒ½ä¹Ÿæ˜¯æœ€éš¾æŒæ¡çš„å…ƒç´ ã€‚å›¾å½¢å­¦è½¯ä»¶å®ç°å›¾å½¢é€»è¾‘è¿ç®—ï¼Œ
SVG çŸ¢é‡å›¾å½¢å¯¹è±¡å¸ƒå°”è¿ç®—æ˜¯å¸¸è§„éœ€æ±‚ï¼Œè¿™æ˜¯å¾ˆæœ‰è¶£çš„é—®é¢˜ï¼Œåœ¨ä¸€ç»´çš„æ•°å­¦ä¸­ 1+1=2ï¼Œåˆ°äº†äºŒç»´å°±æ˜¯ä¸€ä¸ªå›¾å’Œ
å¦ä¸€å›¾çš„è¿ç®—ã€‚


Godot æä¾› CSG èŠ‚ç‚¹æ”¯æŒæ˜¾å¼å‡ ä½•çš„æ„é€ ï¼Œçˆ¶ç±» `CSGShape` æ´¾ç”Ÿä»¥ä¸‹ CSG èŠ‚ç‚¹ï¼š

- CSGCombiner 
- CSGPrimitive
    - CSGBox
    - CSGCylinder
    - CSGMesh
    - CSGPolygon
    - CSGSphere
    - CSGTorus

CSG åˆå¹¶èŠ‚ç‚¹ä¸‹æ·»åŠ ä»»æ„åŸºæœ¬å‡ ä½•ä½“ï¼Œç„¶ååœ¨å…¶å±æ€§é¢æ¿ä¸­é€‰æ‹©æ‰€è¦ä½¿ç”¨çš„ CSG è¿ç®—æ–¹å¼ï¼Œè”åˆã€ç›¸äº¤ã€ç›¸å‡ã€‚
ç›®å‰ Godot 3.x æˆ– 4.0 éƒ½æ²¡æœ‰ä¸º CSG å®ç°ç¢°æ’å½¢çŠ¶çš„ç”Ÿæˆå·¥å…·ï¼Œä½†é€šè¿‡ CSGShape - Use Collision
å¯ä»¥å¯ç”¨å†…ç½®çš„ç¢°æ’å½¢çŠ¶ï¼Œå¹¶ä¸”ä½œä¸ºä¸€ä¸ª static bodyã€‚

MeshInstance3D èœå•ä¸­è‡ªå¸¦æœ‰ç¢°æ’å½¢çŠ¶ç”ŸæˆåŠŸèƒ½ï¼Œä½†æ˜¯ Mesh æä¾›çš„ç¢°æ’ä½“ç”Ÿæˆå·¥å…·ï¼Œä¸ä¼šå¤„ç†å‡ ä½•ä½“çš„ç¼©æ”¾ï¼Œ
ä¼šå°†ç»½æ”¾å±æ€§ç›´æ¥å¤åˆ¶åˆ°ç”Ÿæˆçš„ç¢°æ’ä½“ä¸­ã€‚è€Œ Godot åˆä¸èƒ½åƒ Blender é‚£æ ·ï¼Œå¯ä»¥åº”ç”¨å‡ ä½•ä½“çš„ä»¿å°„å˜æ¢æ“ä½œã€‚




## ğŸŸ¡ Color Theory è‰²å½©ç†è®º
- [è‰²å½©æ„æˆç†è®ºåŸºç¡€](https://www.bilibili.com/video/BV1Vx411G7ZV)
- [è‰²å½©æ­é…åŸºç¡€ç†è®º](https://www.bilibili.com/video/BV1t7411o79q)
- [Jerry Vickery å…‰å½±è‰²å½©ç†è®º](https://www.bilibili.com/video/BV14t41127Xz)
- [è‰²å½©æ­é…çš„åŸç†](https://www.bilibili.com/video/BV15b411q75C/)
- Contemporary Color : Theory and Use, Cengage Learning, by Steven Bleicher
- Color and Light: A Guide for the Realist Painter, Andrews McMeel Publishing, James Gurney
- [Victo Ngai å€ªä¼ å©§ Mastering Color: Simple Steps to Create Vivid Art](https://www.bilibili.com/video/BV1At4y1S76A)
- ç”»å®¶ä¹‹çœ¼ the Eye of the Painter and Elements of Beauty by Andrew Loomis
- [Key to Drawing ç´ æçš„è¯€çª (ç¾)ä¼¯ç‰¹Â·å¤šå¾·æ£®](https://book4you.org/book/15425289/667bb9)
- [The Complete Introduction to Drawing](https://book4you.org/book/3690965/5f8857)
- [è§‚çœ‹ä¹‹é“ ï¼ˆWays of Seeing, 1972ï¼‰çº¦ç¿°Â·ä¼¯æ ¼](https://www.bilibili.com/video/av15938583/)
- [The fundamentals of understanding color theory](https://99designs.com/blog/tips/the-7-step-guide-to-understanding-color-theory/)

å­¦ä¹ è‰²å½©ç†è®ºç›®çš„æ˜¯æŒæ¡è‰²å½©çš„åº”ç”¨ï¼Œæ­£ç¡®åœ°ä½¿ç”¨è‰²å½©è¡¨è¾¾åˆ›ä½œæ„å›¾ï¼Œä»¥åŠè‰²å½©å…³ç³»æ¥å½±å“æˆ–å¼•å¯¼è§‚ä¼—çš„æ³¨æ„åŠ›ã€‚

æœ€ç®€å•çš„è‰²å½©åº”ç”¨å°±æ˜¯æ–‡å­—çš„ç²—ä½“ï¼Œè¯»è€…åœ¨çœ‹åˆ°ä¸€é¡µæ»¡æ˜¯æ–‡å­—çš„æŠ¥çº¸ï¼Œé¦–å…ˆçœ‹åˆ°çš„å°±æ˜¯å¤§å­—æ ‡é¢˜ã€‚è¿™å°±æ˜¯è‰²å½©ç†è®º
æœ€æœ´ç´ çš„åº”ç”¨ï¼Œè€Œåœ¨å•†ä¸šä¸­ï¼Œè‰²å½©çš„åº”ç”¨è¿œæ¯”è¿™æŠ¥çº¸çš„æ–‡å­—å¤æ‚çš„å¤šã€‚åœ¨ç°ä»£ç¤¾ä¼šï¼Œäººç±»æœ‰é™çš„æ—¶é—´é‡Œï¼Œæœ‰é™çš„
æ³¨æ„åŠ›æ˜¯ä¸€ç§æå®è´µçš„èµ„æºã€‚

ä½“ç§¯æ„Ÿçš„è¡¨è¾¾å’Œçº¿æ¡ã€é¢œè‰²çš„ä½¿ç”¨å¯†åˆ‡ç›¸å…³ã€‚ä¾‹å¦‚ï¼Œåœ¨çƒä½“è¡¨é¢ä¸Šå¹³æ»‘è¿‡åº¦çš„æš—éƒ¨è¡¨è¾¾äº†è¿™æ˜¯å¹³æ»‘æ›²é¢ï¼Œæ˜æš—å˜åŒ–
æ˜æ˜¾çš„ä½ç½®å°±éšå«äº†ä¸€æ¡åˆ†ç•Œçº¿ã€‚åœ¨æš—éƒ¨è¿‡åº¦çš„åŒºåŸŸå¡«ä¸Šä¸€å—ç‰¹åˆ«æš—çš„è‰²å—ï¼Œå°±å¾ˆå®¹æ˜“ç»™è§†è§‰é€ æˆä¸€ç§æ·±å‘çš„æ„Ÿè§‰ã€‚
å› ä¸ºå…‰çº¿ä¸èƒ½å®Œå…¨æ‰“åœ¨å¹³æ»‘çš„è¡¨é¢ï¼Œæ›´æ— æ³•ç…§è¿›æ·±å‡¹çš„å‘å†…ã€‚

ç¾å›½ç¾é™¢åŸºç¡€æ•™å­¦æ³•ï¼šäº”æ˜åº¦æ³•ï¼Œåªéœ€è€ƒè™‘å½¢çŠ¶ï¼Œæ˜åº¦å’Œå½¢çŠ¶ä¹‹é—´çš„è¾¹ç¼˜ï¼Œæ˜¯ä¸€å¥—é€‚åˆåˆå­¦è€…ç®€å•è€Œè§„èŒƒçš„æ–¹æ³•è®ºã€‚

é¢œè‰²æ˜¯çœ¼ç›èƒ½è§‚å¯Ÿåˆ°çš„ç”µç£æ³¢ï¼Œæ³¢é•¿è¶ŠçŸ­èƒ½é‡è¶Šä½ï¼Œæ³¢é•¿è¶ŠçŸ­èƒ½é‡è¶Šé«˜ã€‚æŒ‰ç…§çº¢ã€æ¾„ã€é»„ã€ç»¿ã€é’ã€è“ã€ç´«é¡ºåºæ’åˆ—ï¼Œ
ç»˜ç”»ä¸­ä¸»è¦æ˜¯åŒºåˆ†é¢œè‰²å¯¹å¿ƒç†çš„å†·æš–æ„Ÿè§‰çš„å½±å“ã€‚ç‰¹å®šæ³¢é•¿çš„èƒ½é‡å¯ä»¥è¢«ç‰©ä½“å¸æ”¶ï¼Œä¾‹å¦‚ï¼Œç«ç„°çœ‹èµ·æ¥è¶Šåçº¢ã€é»„ï¼Œ
è¿™äº›å…‰æ˜¯å±äºå¯ä»¥è¢«äººä½“å¸æ”¶çš„çƒ­è¾å°„å…‰ï¼Œè¿™æ˜¯æš–è‰²è°ƒã€‚è€Œèƒ½é‡æ›´ä½çš„ç»¿è‰²ã€è“è‰²ä½¿å¿ƒç†æ„Ÿè§‰æ˜¾å¾—å†·ï¼Œå¦‚é›ªå¤©çš„è“ï¼Œ
åˆæ¯”å¦‚æ¤ç‰©ä¹Ÿä¼šå¸æ”¶èƒ½é‡è€Œè¿‡æ»¤æ‰éç»¿è‰²çš„å…‰çº¿ï¼Œåå°„å‡ºæ¥çš„åŸºæœ¬æ˜¯ç»¿è‰²å…‰ã€‚

æ—©æ™¨çš„å¤©ç©ºå¤šå‘ˆç°è“è‰²ï¼Œå› ä¸ºæ— äº‘å±‚,å¤§æ°”å¯¹å¤ªé˜³å…‰ä¸»è¦èµ·æ•£å°„ä½œç”¨ã€‚ç´«å…‰çš„æ³¢é•¿æœ€çŸ­ï¼Œæ•£å°„èƒ½åŠ›æœ€å¤§ï¼Œåœ¨æ²¡æœ‰åˆ°
è¾¾åœ°é¢ä¹‹å‰å°±åœ¨å¤–å±‚å¤§æ°”ä¸­æ•£å°„æ‰äº†ï¼Œæ¥è¿‘åœ°é¢çš„ç´«å…‰å¾ˆå°‘ã€‚è€Œè“å…‰æœ€å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åœ°é¢çœ‹å¤©ç©ºæ˜¯è“è‰²ï¼Œè€Œåœ¨
é«˜ç©ºåˆ™é€æ¸å˜æˆç´«è‰²ã€‚

è€Œå‚æ™šå¤©ç©ºå¤šæ˜¯ç«çº¢è‰²ï¼Œå› ä¸ºæ—¥é—´å¤ªé˜³çš„èƒ½é‡ä½¿å¾—ç©ºæ°”ä¸Šå‡é€ æˆäº‘å±‚å¯†é›†ï¼Œå¹¶ä¸”å¯¹çŸ­æ³¢é•¿çš„è“ã€ç»¿å…‰çº¿æœ‰æ›´å¼ºçš„
è¿‡æ»¤ä½œç”¨ï¼Œè€Œçº¢ã€é»„å…‰åˆ™æ›´å®¹æ˜“ç©¿é€äº‘å±‚ã€‚è¿™äº›æ—¥ç§¯æœˆç´¯çš„è‡ªç„¶ç°è±¡å·²ç»æ˜¯åˆ»è¿› DNA çš„ä¿¡æ¯ï¼Œå°±å¦‚è‡ªç„¶çš„æ¡ä»¶
åå°„ï¼Œå³æ˜¯å†¬å¤©ï¼Œçœ¼ç›çœ‹åˆ°çº¢è‰²å°±ä¼šæœ‰æš–æ„ã€‚

çœ¼ç›çœ‹åˆ°çš„é¢œè‰²ä¸æ˜¯å…‰çš„é¢œè‰²ï¼Œè€Œæ˜¯å…‰ä»ç‰©ä½“è¡¨é¢åå°„çš„é¢œè‰²ã€‚æ¯”å¦‚ç»¿è‰²æ¤ç‰©ï¼Œç”¨æ¥å¸æ”¶å…‰èƒ½çš„å¶ç»¿ç´ å¯¹å¤ªé˜³å…‰
æœ‰ä¸¤ä¸ªå¸æ”¶é«˜å³°ï¼Œåˆ†åˆ«æ˜¯ 440nm é™„è¿‘çš„è“åŒºå’Œ 680nm é™„è¿‘çš„çº¢åŒºï¼Œè€Œå¯¹äºå¤„åœ¨ 500 - 600 çº³ç±³ä¹‹é—´çš„
ç»¿å…‰å¸æ”¶çš„ç”šå°‘ï¼Œç»¿å…‰å°±åå°„è¢«çœ¼ç›æ¥æ”¶åˆ°ã€‚

ã€Šè‰²å½©äº’åŠ¨å­¦ã€‹ Interaction of Color æœ¬ä¹¦è®°å½•äº†å¦‚ä½•ç”¨å®éªŒçš„æ–¹æ³•å­¦ä¹ å’Œæ•™æˆé¢œè‰²çŸ¥è¯†ã€‚ä»ç‰©ç†å’Œç”Ÿç†ä¸Šè®²ï¼Œ
è§†è§‰æ„ŸçŸ¥åˆ°çš„é¢œè‰²å¹¶ä¸çœŸå®ã€‚è¿™ä¸€äº‹å®è®©é¢œè‰²åœ¨è‰ºæœ¯åˆ›ä½œä¸­å¯Œæœ‰å¼¹æ€§ã€‚é«˜æ•ˆä½¿ç”¨é¢œè‰²ï¼Œæœ‰å¿…è¦é€æ­¥è¯†è®¤é¢œè‰²å¦‚ä½•æ¬ºäººã€‚
ä¸ºæ­¤ï¼Œæœ¬ä¹¦ä»¥äº’åŠ¨çš„æ–¹å¼æ¥ç ”ç©¶é¢œè‰²ç³»ç»Ÿã€‚


ç”¨æ¥ç»˜ç”»çš„é¢œæ–™å°±æ˜¯åˆ©ç”¨å…¶å¯¹å…‰çº¿çš„åå°„å½¢çŠ¶ï¼Œçº¢é»„è“ä¸‰ç§åŸè‰²ï¼Œä½¿ç”¨è¿™ä¸‰ç§é¢œè‰²å¯ä»¥æ··åˆå¾—åˆ°ä»»æ„çš„å…¶å®ƒé¢œè‰²ã€‚
æ‰€è°“åŸè‰² Primaryï¼Œæ­£æ˜¯æŒ‡ä¸èƒ½é€è¿‡å…¶ä»–é¢œè‰²æ··åˆè°ƒé…è€Œå¾—å‡ºçš„åŸºæœ¬è‰²ï¼Œåœ¨ä¸åŒé¢†åŸŸä½¿ç”¨ä¸åŒçš„åŸè‰²ï¼Œä¾‹å¦‚ï¼Œ
æ˜¾ç¤ºå™¨å…‰å­¦ä¸‰åŸè‰² RGBï¼Œæ˜¯å åŠ è‰²æ¨¡å‹ï¼Œè‰²å€¼è¶Šé«˜å°±è¶Šäº®ã€‚ä¸‰åŸè‰²ç›¸åŠ ä¸ºç™½è‰²ï¼Œå±äºæ— è‰²ç³»ï¼ˆé»‘ç™½ç°ï¼‰ã€‚

![Additive color mixing](https://99designs-blog.imgix.net/blog/wp-content/uploads/2017/02/RBG-2-column.png?auto=format&q=60&fit=max&w=930)

åŸè‰²ä¸¤ä¸¤æ··åˆå°±å¯ä»¥å¾—åˆ°ä¸‰ç§é—´æ¥è‰²ï¼š

    çº¢+ç»¿=é»„     çº¢+é»„=æ©™
    ç»¿+è“=é’     è“+é»„=ç»¿
    è“+çº¢=ç´«     è“+çº¢=ç´«

é¢œæ–™ä¸‰åŸè‰²ï¼ˆCMYKï¼‰ï¼šå“çº¢ã€é»„ã€é’(å¤©è“)ï¼Œå±äºå‡è‰²æ³•ï¼Œé¢œæ–™ç”¨å¾—è¶Šå°‘ï¼Œå¸æ”¶çš„å…‰çº¿å°±è¶Šå°‘ï¼Œé¢œè‰²è¶Šæµ…ã€‚ä¸‰åŸè‰²
å¯ä»¥æ··åˆå‡ºæ‰€æœ‰é¢œæ–™çš„é¢œè‰²ï¼ŒåŒæ—¶ç›¸åŠ ä¸ºé»‘è‰²ï¼Œé»‘ç™½ç°å±äºæ— è‰²ç³»ã€‚

![Subtractive color mixing](https://99designs-blog.imgix.net/blog/wp-content/uploads/2017/02/CMYK-915x915px.png?auto=format&q=60&fit=max&w=930)

ä¼ ç»Ÿç¾æœ¯è‰²å½©ä¸‰åŸè‰²ï¼šçº¢ï¼Œé»„ï¼Œè“ï¼Œå±äºå‡è‰²æ³•åŸç†ã€‚ä¸ºäººä»¬åŠ å…¥äº†æ„Ÿè§‰å®é™…ï¼Œæ˜¯å®é™…ä¸Šçš„ä¸‰åŸè‰²ã€‚

ç»˜ç”»ä¸­æ›´å¸¸ç”¨çš„æ˜¯ HSV è‰²è°ƒæ¨¡å‹ï¼š

- Hueï¼šè‰²ç›¸/è‰²è°ƒï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é¢œè‰²çš„å«ä¹‰ã€‚
- Saturationï¼šé¥±å’Œåº¦ï¼Œæ˜¯æŒ‡çº¯è‰²çš„å¼ºåº¦ï¼Œæ¢å¥è¯è¯´ï¼Œé¢œè‰²æ˜¯å¦æ˜¾å¾—æ›´éšæ™¦ã€æš—æ·¡æˆ–è€…æ›´æœ‰æ´»åŠ›ã€‚
- Valueï¼šäº®åº¦ï¼Œè‰²å€¼ä¸é¢œè‰²çš„æ·±æµ…ç›¸å…³ã€‚

è‰²ç›¸ã€è‰²è°ƒæ˜¯åŒä¹‰è¯ï¼Œä½†è‰²è°ƒæ›´åŠ å¼ºè°ƒç”»é¢ç»Ÿä¸€çš„è‰²å½©æ„Ÿå—å’Œè‰²å½©å€¾å‘ï¼Œæ˜¯ç”»é¢ç»™äººçš„æ•´ä½“è‰²å½©å°è±¡ã€‚è‰²è°ƒä¸ç»Ÿä¸€ï¼Œ
ç”»é¢ä¸­çš„è‰²å½©å°±æ˜¯ä¸€ç›˜æ•£æ²™ï¼Œç”»é¢ä¸­çš„æ¯ä¸€å—é¢œè‰²éƒ½åº”è¯¥æœä»äºæ•´ä½“çš„è‰²è°ƒï¼Œåœ¨ç»Ÿä¸€çš„è‰²è°ƒä¸‹å½¢æˆä¸°å¯Œçš„å˜åŒ–ã€‚

é©¬èµ«å¸¦æ•ˆåº”ï¼ˆMach band effectï¼‰æ˜¯ä¸€ç§ä¸»è§‚çš„è¾¹ç¼˜å¯¹æ¯”æ•ˆåº”ã€‚è§‚å¯Ÿäº®åº¦ä¸åŒçš„ä¸¤å—åŒºåŸŸï¼Œè¾¹ç•Œå¤„äº®åº¦å¯¹æ¯”åŠ å¼ºï¼Œ
ä½¿è½®å»“è¡¨ç°å¾—ç‰¹åˆ«æ˜æ˜¾ã€‚ç”Ÿç†å­¦å¯¹é©¬èµ«å¸¦æ•ˆåº”çš„è§£é‡Šæ˜¯ï¼šäººç±»çš„è§†è§‰ç³»ç»Ÿæœ‰å¢å¼ºè¾¹ç¼˜å¯¹æ¯”åº¦çš„æœºåˆ¶ã€‚

![Mach band effect](https://pic4.zhimg.com/80/v2-dd31b2d7e50e5a6ecab13b2a89c719ff_1440w.webp)

åœ¨è‡ªç„¶ç¯å¢ƒä¸­ï¼Œæ¤ç‰©çš„èŠ±æœµã€æœå®é€šå¸¸æ˜¯é«˜é¥±å’Œåº¦çš„é¢œè‰²ï¼Œçº¯çº¢ã€çº¯é»„ã€çº¯é»‘ç­‰ç­‰ã€‚

ç»˜ç”»è½¯ä»¶ä¸­å¸¸ä½¿ç”¨ä¸€ä¸ªè‰²ç¯è¡¨ç¤ºè‰²å½©æ¨¡å‹ï¼ŒHue çš„å–å€¼ 0Â° ~ 360Â° å¾ªç¯è¡¨ç¤º çº¢ã€æ¾„ã€é»„ã€ç»¿ã€é’ã€è“ã€ç´«ã€çº¢ï¼Œ
å†æ­é…ä¸€ä¸ªçŸ©å½¢è‰²å—è¡¨ç¤ºé¥±å’Œåº¦å’Œäº®åº¦ã€‚

é™¤äº†åŸè‰²æ··åˆå¾—åˆ°çš„é—´æ¥è‰² Secondary Colorsï¼Œç¬¬ä¸‰ç±»é¢œè‰²å°±æ˜¯å¤è‰²ï¼Œæˆ–ç§°ä¸ºä¸‰æ¬¡è‰² Tertiary Colorsã€‚
å®ƒä»¬æ˜¯ç”±è‰²ç¯ä¸­é‚»è¿‘çš„åŸè‰²å’Œé—´è‰²æ··åˆè€Œæ¥ï¼Œå…­ç§åŸºæœ¬çš„å¤è‰²åˆ†åˆ«æ˜¯é»„ç»¿è‰²ã€è“ç»¿è‰²ã€è“ç´«è‰²ã€ç´«çº¢è‰²ã€çº¢æ©™è‰²ã€é»„æ©™è‰²ã€‚

![Pigment colours](https://public-media.interaction-design.org/images/uploads/user-content/1445/S9qTpVld44SchHmpmYf7mYgCmcOhXwGdb5eD56t8.jpeg)

å¯ä»¥æ³¨æ„åˆ°ï¼Œç»¿è‰²éƒ¨åˆ†å æ®çš„ä½ç½®æ˜¯æœ€å¤šçš„ï¼ŒåŒæ—¶ç»¿è‰²ä¹Ÿæ˜¯å¯è§å…‰ä¸­åˆ†å¸ƒæœ€å¹¿çš„éƒ¨åˆ†ï¼Œç›¸åº”åœ°çœ¼ç›æ„Ÿå…‰åŒºä¸­åˆ†å¸ƒçš„
æ„ŸçŸ¥ç»¿è‰²çš„è§†é”¥ç»†èƒæ•°é‡ä¹Ÿæœ€å¤šã€‚ä»èƒ½é‡é›†ä¸­è§’åº¦çœ‹ï¼Œä¸åˆ©äºæ¤ç‰©çš„å…‰åˆä½œç”¨é‡‡ç”¨ï¼Œæ‰€ä»¥å¶ç»¿ç´ é‡‡ç”¨èƒ½é‡æ›´é›†ä¸­çš„å…‰ã€‚
ç”±äºçœ¼ç›çš„ç»¿è‰²æ„Ÿå…‰ç»†èƒåˆ†å¸ƒæ›´å¤šï¼Œæ‰€ä»¥åœ¨æ™šä¸Šï¼Œç»¿è‰²å…‰æ›´å®¹æ˜“è¢«æ„ŸçŸ¥ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ ·çš„å¼ºåº¦çš„å…‰ï¼Œç»¿è‰²ä¼šæ›´æ˜æ˜¾ã€‚

é˜´å½±æ˜¯å¯ä»¥ä¸»è§‚å–èˆå½¢çŠ¶çš„ï¼Œå¹¶ä¸æ˜¯æ¯ä¸€ä¸ªåœ°æ–¹éƒ½è¦é¢é¢ä¿±åˆ°ï¼›é˜´å½±æ˜¯å¯ä»¥è‰²å½©å€¾å‘å¾ˆå¼ºçš„ï¼Œä¹Ÿè¦å’Œç”»åšæ¶‚æ—¶å€™
ä¸€æ ·æ³¨æ„å†·æš–ï¼›åŒä¸€å—é˜´å½±å¯èƒ½å› ä¸ºä½ç½®ä¸åŒï¼Œé¢œè‰²ä¹Ÿä¼šæœ‰å˜åŒ–ã€‚

åœ¨åšæ¶‚ç»˜ç”»è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå…ˆä¸Šå¤§å—çš„åº•è‰²ï¼Œè¿™å’Œæ²¹ç”»çš„å‰æœŸé“ºè‰²æ“ä½œä¸€æ ·ã€‚å…ˆåˆ¤æ–­ç‰©ä½“çš„çº¹ç†èµ°å‘ï¼Œåœ¨ç»˜åˆ¶çº¹ç†
å‰é¢„å…ˆå°†å¤§å—çš„åº•è‰²é“ºåˆ°ç”»å¸ƒä¸Šï¼Œç„¶åå†æ…¢æ…¢æ·»åŠ çº¹ç†ç»†èŠ‚ã€‚åœ¨é“ºåº•è‰²æ—¶è¦å¤§èƒ†ï¼Œä¸è¦è€ƒè™‘ç»†èŠ‚ï¼Œåªéœ€è¦åœ¨ä¿è¯è½®
å»“æˆ–æ˜æš—åˆ†ç•Œçº¿æ­£ç¡®çš„å‰æä¸‹æ— æ‹˜æ— æŸåœ°ç»˜ç”»ã€‚

é¢œè‰²ç†è®ºä¸­çš„æ­é…å…¬å¼ Color Schemesï¼š

1. *Monochromatic*ï¼šå•è‰²æ­é…ï¼Œå¹¶ä½¿ç”¨é¥±å’Œåº¦å’Œè‰²å€¼çš„çŸ¥è¯†æ¥åˆ›é€ å˜åŒ–ã€‚è¯¥æ–¹æ¡ˆçš„å¥½å¤„æ˜¯è‰²å½©èƒ½å¤Ÿä¿è¯åŒ¹é…ã€‚
2. *Analogous*ï¼šç›¸ä¼¼è‰²æ­é…ï¼Œä½¿ç”¨è‰²è½®ä¸­å½¼æ­¤ç›¸é‚»çš„è‰²å½©è¿›è¡Œæ­é…ï¼Œæ¯”å¦‚çº¢è‰²å’Œæ©™è‰²ã€‚
3. *Complementary*ï¼šäº’è¡¥è‰²æ­é…ï¼Œäº’è¡¥è‰²åœ¨è‰²è½®ä¸­å½¼æ­¤ç›¸å¯¹ï¼Œå¦‚è“è‰²å’Œæ©™è‰²ï¼Œä½¿ç”¨ä¸åŒé¥±å’Œåº¦é¿å…äº’è¡¥è‰²æ–¹æ¡ˆå‘†æ¿ã€‚
4. *Split Complementary*ï¼šåˆ†è£‚äº’è¡¥é…è‰²ï¼Œä½¿ç”¨ç›¸å¯¹é¢œè‰²çš„ä¸¤ä¾§ç›¸é‚»é¢œè‰²è¿›è¡Œæ­é…ã€‚å¯ä»¥æå‡å¯¹æ¯”ä¹Ÿæ›´æœ‰è¶£ã€‚
5. *Triadic*ï¼šä¸‰å…ƒè‰²æ­é…ï¼Œé‡‡ç”¨ä¸‰ç§å‡åŒ€åˆ†å¸ƒçš„é¢œè‰²ï¼Œåœ¨è‰²è½®ä¸Šå½¢æˆä¸€ä¸ªå®Œç¾çš„ä¸‰è§’å½¢ã€‚
6. *Tetradic*ï¼šå››å…ƒè‰²æ­é…ï¼Œä½¿ç”¨çš„é¢œè‰²åœ¨è‰²è½®ä¸Šå½¢æˆäº†ä¸€ä¸ªçŸ©å½¢ã€‚å¯ä»¥å°†å…¶ä¸­ä¸€ä¸ªé¢œè‰²ç”¨äºä¸»è‰²ï¼Œå…¶ä½™ç”¨äºè¾…è‰²ã€‚

![Complementary colors](https://99designs-blog.imgix.net/blog/wp-content/uploads/2017/02/Complementary-3-column.png?auto=format&q=60&fit=max&w=930)
![Analogous colors](https://99designs-blog.imgix.net/blog/wp-content/uploads/2017/02/Analogous-3-column.png?auto=format&q=60&fit=max&w=930)
![Triadic colors](https://99designs-blog.imgix.net/blog/wp-content/uploads/2017/02/Triadic-3-column.png?auto=format&q=60&fit=max&w=930)

ç»å…¸çš„é¢œè‰²è¡Œä¸ºå‡†åˆ™ï¼š

1. é‡åˆ°æ‰çœ¼çš„è‰²å½©æ­é…æ—¶ï¼Œæœ€ç®€å•çš„ä¸€ä¸ªåŠæ³•å°±æ˜¯æƒ³åŠæ³•ç¡®å®šè‰²è°ƒã€‚é€‰æ‹©å…¶ä¸­ä¸€ç§é¢œè‰²ï¼Œè°ƒæ•´æ˜æš—åº¦æˆ–é¥±å’Œåº¦ã€‚
2. å¯è¯»æ€§ Readability æ˜¯ä»»ä½•è®¾è®¡çš„å¿…å¤‡è¦ç´ ã€‚æ¸…æ™°æ˜“è¯» Legibleï¼Œé¿å…ç¹æ‚ï¼Œå¤šç”¨ä¸­æ€§é¢œè‰²å¹³è¡¡ç”»é¢ã€‚
3. æ¯ç§é¢œè‰²éƒ½ä¼šå‘å‡ºä¸€ä¸ªä¿¡æ¯ã€‚é‡è¦çš„æ˜¯è¦è€ƒè™‘åˆ°é¡¹ç›®çš„è‰²è°ƒï¼Œå¹¶é€‰æ‹©åˆç†çš„é…è‰²æ–¹æ¡ˆã€‚
4. ä½ å¯ä»¥åœ¨å„ç§æœ‰è¶£çš„åœ°æ–¹æ‰¾åˆ°é…è‰²æ–¹æ¡ˆï¼Œæ¯”å¦‚å¹¿å‘Šã€é…è‰²ç½‘ç«™ä»¥åŠä¸€äº›æœ‰åçš„è‰ºæœ¯ä½œå“ã€‚

è‰²å½©çš„ä¸ƒç§å¯¹æ¯”å³è‰²ç›¸å¯¹æ¯”ã€æ˜åº¦å¯¹æ¯”ã€å†·æš–å¯¹æ¯”ã€è¡¥è‰²å¯¹æ¯”ã€åŒè‰²å¯¹æ¯”ã€è‰²åº¦å¯¹æ¯”å’Œé¢ç§¯å¯¹æ¯”ï¼š

- *æ˜åº¦å¯¹æ¯”*ï¼šæ˜åº¦å¯¹æ¯”æŒ‡é»‘ã€ç™½ã€ç°ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿæ˜¯å¸¸è¯´çš„ç´ ææ˜æš—å…³ç³»ã€‚é»‘ã€ç™½ä¸¤æä¹‹é—´çš„è‰²é˜¶éå¸¸æ˜ç¡®ï¼Œ
            å®¹æ˜“åˆ†è¾¨ã€‚ä¾æ˜åº¦å…³ç³»åˆ†ç”»é¢æœ‰é«˜è°ƒã€ä¸­è°ƒã€ä½è°ƒä¹‹åˆ†ã€‚æ˜åº¦å¯¹æ¯”æ˜¯æ„æˆè‰²å½©ä¸­å±‚æ¬¡æ„Ÿã€ä½“ç§¯æ„Ÿã€
            ç©ºé—´æ„Ÿã€é‡é‡æ„Ÿçš„é‡è¦å› ç´ ï¼Œä»ç”»é¢å±‚æ¬¡æ„Ÿã€ç©ºé—´æ„Ÿå—çš„è§’åº¦ç†è§£ï¼Œæ˜åº¦å…³ç³»ä½¿å‰æ™¯äº®ã€è¿œæ™¯æš—ï¼›
            å—å…‰è¿‘çš„äº®ã€å—å…‰è¿œçš„æš—ã€‚ä»ä½“ç§¯æ„Ÿå’Œé‡é‡æ„Ÿç†è§£ï¼Œè¶Šæ·±çš„è‰²è°ƒè¶Šé‡ï¼Œè¶Šäº®çš„è‰²è°ƒè¶Šè½»ï¼›å±‚æ¬¡è¶Š
            ä¸°å¯Œçš„è‰²è°ƒï¼Œä½“ç§¯æ„Ÿå—è¶Šå¼ºï¼Œå±‚æ¬¡è¶Šç®€å•çš„è‰²è°ƒä½“ç§¯æ„Ÿè¶Šå¼±ã€‚
- *åŒè‰²å¯¹æ¯”*ï¼šåŒè‰²å¯¹æ¯”æ˜¯è‰²å½©ç¾å­¦çš„æ ¸å¿ƒã€‚æ²¡æœ‰åŒè‰²å¯¹æ¯”å°±æ²¡æœ‰è‰²å½©çš„äº’è¡¥è§„å¾‹ï¼Œä¹Ÿæ²¡æœ‰è‰²å½©çš„å’Œè°ã€‚åŒè‰²å¯¹æ¯”
            ä¸­å› çº¯åº¦çš„å¼ºå¼±ä¸åŒè€Œå½¢æˆå¯¹æ¯”ï¼Œå±â€œåŒç±»è‰²å¯¹æ¯”â€çš„è‰²è°ƒã€‚åœ¨è§‚å¯Ÿå’ŒåŒºåˆ«è¿™ç±»è‰²å½©æ—¶å¿…é¡»è¿›è¡Œæ¯”è¾ƒï¼Œ
            åŒºåˆ«å‡ºå…¶è‰²ç›¸çš„ç»†å¾®å·®åˆ«ï¼Œè€Œä¸”æ³¨æ„å…¶æ˜åº¦å’Œçº¯åº¦ã€‚ä¸ç„¶ï¼Œå®¹æ˜“ç”»å¾—è‰²å½©é›·åŒã€‚ä¸€èˆ¬è¯´ï¼Œä¸åŒè‰²æ€§
            å’Œè‰²ç›¸è·ç¦»å¤§çš„å®¹æ˜“åŒºåˆ«ï¼Œè€ŒåŒç±»è‰²æ¥è¿‘çš„åŒºåˆ†è¾ƒéš¾ï¼Œé€šè¿‡è¿™ç±»è®­ç»ƒï¼Œå¯ä»¥æé«˜è§‚å¯ŸåŠ›å’Œè¡¨ç°åŠ›ã€‚
- *è‰²åº¦å¯¹æ¯”*ï¼š è‰²åº¦å¯¹æ¯”ä¹Ÿç§°çº¯åº¦å¯¹æ¯”ï¼Œå³å¼ºçƒˆå’Œæš—æ·¡è‰²å½©ä¹‹é—´çš„å¯¹æ¯”ã€‚çº¯åº¦è¾ƒé«˜çš„è‰²å½©ä»¥åŸè‰²ä¸ºæœ€çº¯ï¼ŒåŠ å…¥ç›¸
            è¿‘çš„åŒç±»è‰²å½©ä¹Ÿæœ‰è¾ƒé«˜çš„çº¯åº¦ã€‚æš—æ·¡çš„è‰²å½©æ˜¯åŠ å…¥äº†é»‘ã€ç™½ã€ç°æˆ–å¯¹æ¯”è‰²ä½¿è‰²å½©å‡ä½äº†çº¯åº¦ã€‚ç”±ä¸åŒ
            è‰²ç›¸ã€è‰²æ€§ã€æ˜åº¦ã€çº¯åº¦ç­‰è‰²å½©ç»„æˆçš„ç”»é¢ï¼Œå®ƒä»¬ä¹‹é—´äº§ç”Ÿä¸åŒç¨‹åº¦çš„å¯¹æ¯”ï¼Œå½¢æˆç”»é¢çš„æ•´ä½“æ•ˆæœï¼Œ
            ä¸€èˆ¬è¾ƒä¸ºå¸¸è§ã€‚ä½†æ­¤ç±»å¯¹æ¯”ï¼Œåº”è¯¥æŠŠä¸€ç§è‰²ç›¸ä½œä¸ºä¸»å¯¼è‰²ï¼ŒæŠŠä¸€ç§å¯¹æ¯”ä½œä¸ºä¸»è¦å¯¹æ¯”æ¥ç»Ÿä¸€å…¨å±€ï¼Œ
            é˜²æ­¢è¿‡äºåˆ†æ•£å’Œæ‚ä¹±ã€‚ç”±äºè‰²å½©å’Œå„ç§å¤æ‚å…³ç³»ï¼Œéœ€è¦ç‰¹åˆ«åŠ å¼ºæ•´ä½“è§‚å¿µï¼Œä»æ•´ä¸ªç”»é¢æ•ˆæœå‡ºå‘ï¼Œ
            æœ‰æ¯”è¾ƒåœ°è¡¨ç°å‡ºä¸åŒå±‚æ¬¡å’Œä¸»æ¬¡å…³ç³»ã€‚
- *è‰²ç›¸å¯¹æ¯”*ï¼šè‰²ç›¸å¯¹æ¯”æ˜¯å› è‰²ä¸è‰²ä¹‹é—´çš„å·®åˆ«è€Œå½¢æˆçš„å¯¹æ¯”ã€‚å¯¹æ¯”è¶Šå¼ºçƒˆï¼Œè‰²å½©æ•ˆæœè¶Šé²œæ˜ï¼Œå¯¹æ„Ÿå®˜åˆºæ¿€è¶Šå¤§ã€‚
            çº¢ã€é»„ã€è“ä¸‰åŸè‰²æ˜¯æœ€åŸå§‹ã€æœ€å…¸å‹çš„è‰²ç›¸å¯¹æ¯”ã€‚ç”¨å†·æš–æ¥è¡¨ç¤ºè‰²å½©çš„æ„Ÿè§‰å’Œå¿ƒç†ï¼Œä¸»è¦æºäºäººä»¬
            çš„ç»éªŒã€‚â€œæš–â€è‰²ç»™äººä»¥çƒ­çƒˆçš„æ°”æ°›å’Œæ¸©é¦¨çš„æ„Ÿè§‰ï¼Œâ€œå†·â€è‰²ç»™äººæœ‰å‡‰çˆ½å’Œä¸¥è‚ƒçš„æ„Ÿè§‰ã€‚
- *å†·æš–å¯¹æ¯”*ï¼šè‰²å½©æœ‰å†·æš–ä¹‹åˆ†ã€‚å†·è‰²æ³›æŒ‡è“ç»¿è‰²ç³»ï¼Œæš–è‰²æŒ‡çº¢é»„è‰²ç³»ï¼Œç„¶è€Œå†·æš–å¯¹æ¯”ä¸æ˜¯ç»å¯¹çš„ï¼Œå…³é”®å–å†³äº
            å®ƒåŒæ›´å†·çš„è¿˜æ˜¯æ›´æš–çš„è‰²ç›¸æ¥æ¯”è¾ƒã€‚å†·æš–å¯¹æ¯”åœ¨è‰²å½©è¿ç”¨å½“ä¸­æä¸ºé‡è¦ï¼Œæ˜¯è‰²å½©çš„ç ”ç©¶çš„å…³é”®æ‰€åœ¨ã€‚
            ä»è‰²å½©è‡ªèº«çš„åŠŸèƒ½æ¥çœ‹ï¼Œçº¢ã€æ©™é»„è‰²ä½¿è§‚è€…å¿ƒè·³åŠ ã€è¡€å‹å‡é«˜ï¼Œæ‰€ä»¥äº§ç”Ÿçƒ­çš„æ„Ÿè§‰ã€‚è“ã€è“ç»¿ã€è“ç´«è‰²
            èƒ½ä½¿è§‚è€…è¡€å‹ä½ã€å¿ƒè·³æ…¢ï¼Œäº§ç”Ÿå†·çš„æ„Ÿè§‰ã€‚è‰²å½©åœ¨å†·æš–æ„Ÿè§‰æ˜¯è‰²å½©çš„ç‰©ç†ã€ç”Ÿç†ã€å¿ƒç†åŠè‰²å½©æœ¬èº«
            ç»¼åˆæ€§å› ç´ å†³å®šçš„ã€‚
- *è¡¥è‰²å¯¹æ¯”*ï¼šåœ¨è‰²ç›¸å¯¹æ¯”ä¸­ï¼Œè‰²å½©äº’ç›¸è”ç³»è¡¬æ‰˜ã€äº’ç›¸è¡¥å……ï¼Œæ‰€ä»¥ä¹Ÿå«äº’è¡¥è‰²ã€‚è¡¥è‰²å¯¹æ¯” æœ€å¼ºçš„æ˜¯çº¢ä¸ç»¿ã€é»„
            ä¸ç´«ã€è“ä¸æ©™ï¼Œå…¶å®ƒæ¬¡ä¹‹ã€‚æ‰€è°“è¡¥è‰²çš„å¯¹æ¯”æ˜¯æŒ‡çœ‹åˆ°ä»»ä½•ä¸€ç§ç‰¹å®šé¢œè‰²ï¼Œçœ¼ç›éƒ½ä¼šåŒæ—¶äº§ç”Ÿå¯¹å…¶
            è¡¥è‰²çš„éœ€è¦ã€‚å¦‚ä¸€å¼ ç™½çº¸å•ç‹¬çœ‹æ˜¯ç™½çº¸ï¼Œåœ¨çº¢çº¸ä¸Šä¼šæ„Ÿè§‰å«ç»¿ã€æ”¾åœ¨ç»¿è‰²çº¸ä¸Šä¼šæ„Ÿè§‰å«çº¢ã€‚è¡¥è‰²å¯¹æ¯”
            æ­é…å¯æ„æˆäº’è¡¥è‰²è°ƒï¼Œäº’è¡¥è‰²ç›¸è‰²è°ƒçš„è‰²ç›¸æ„Ÿæ¯”å¯¹æ¯”è‰²ç›¸è‰²è°ƒæ•ˆæœè¦æ›´å¼ºçƒˆã€æ›´ä¸°å¯Œã€æ›´å®Œç¾ã€
            æ›´æœ‰åˆºæ¿€æ€§ã€‚äº’è¡¥è‰²ç›¸è‰²è°ƒèƒ½æ»¡è¶³è§†è§‰è‰²ç›¸çš„è¦æ±‚ï¼Œå–å¾—è§†è§‰æ‚Ÿç”Ÿç†ä¸Šçš„å¹³è¡¡ï¼Œæ—¢å¯¹ç«‹åˆäº’è¡¥ã€‚
            äº’è¡¥è‰²ç›¸å¦‚ä¸æ˜åº¦ã€çº¯åº¦ç›¸é…åˆå¯æ„æˆå®¡ç¾ä»·å€¼å¾ˆé«˜çš„è‰²å½©æ•ˆæœã€‚
- *é¢ç§¯å¯¹æ¯”*ï¼šé¢ç§¯å¯¹æ¯”æ˜¯å¤§ä¸å°ä¹‹é—´å¯¹æ¯”ã€‚ä¾¿é¢ç§¯å¯¹æ¯”ä¸èƒ½å•çº¯ä»ä½“é‡ä¸Šè¿›è¡Œæ¯”è¾ƒï¼Œè¦æ³¨æ„è‰²å½©è§†è§‰æ•ˆæœçš„å‡
            è¡¡é—®é¢˜ï¼Œè€Œå‡è¡¡åº¦åˆéšè‰²å½©æ˜åº¦çš„å˜åŒ–è€Œå˜åŒ–ã€‚é¢ç§¯å¯¹æ¯”å®è´¨ä¸Šæ˜¯ä¸€å¹…ä½œå“ä¸­æ‰€å«çš„è‰²å½©æ•°é‡çš„
            æ¯”ä¾‹å¯¹æ¯”ã€‚ç”»é¢è‰²å½©é¢ç§¯çš„åˆ†å¸ƒä¼šäº§ç”Ÿä¸åŒç¨‹åº¦çš„å¼ºå¼±å¯¹æ¯”ï¼Œè°ƒèŠ‚å¤§å°å¯ä»¥å–å¾—çš„è‰²å½©å¯¹æ¯”å¼ºå¼±ã€
            è‰²å½©çš„éŸµå¾‹èŠ‚å¥ä»¥åŠè§†è§‰ä¸ŠåŠ›çš„å¹³è¡¡ã€‚å› æ­¤é¢ç§¯å¯¹æ¯”æ˜¯å…·æœ‰ç»“æ„æ€§çš„ï¼Œå®ƒæ˜¯æ•´ä¸ªç”»é¢â€œæ˜æš—ç»“æ„â€
            å’Œè‰²å½©ç»“æ„â€œçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ç”±äºé¢ç§¯å¯¹æ¯”æ‰€èµ·çš„é‡è¦ä½œç”¨ï¼Œå› æ­¤åœ¨æ„æ€æ„å›¾æ—¶éœ€è¦ä¼˜å…ˆè€ƒè™‘ã€‚


è§†è§‰ä¸Šçš„è‰²å½©é”™è§‰æˆ–è¯¯å·®æ˜¯äººä»¬åœ¨æ„ŸçŸ¥å¤–éƒ¨ä¸–ç•Œæ—¶ç»å¸¸ä½“éªŒåˆ°çš„ä¸€ç§çŸ¥è§‰çŠ¶æ€ã€‚å…¶å…·ä½“è¡¨ç°åœ¨çœ¼ç›æ„ŸçŸ¥çš„è‰²å½©æ•ˆæœ
ï¼ˆå¿ƒç†ä¸Šçš„çœŸå®ï¼‰ä¸å®¢è§‚å­˜åœ¨çš„è‰²å½©å®ä½“ï¼ˆç‰©ç†ä¸Šçš„çœŸå®ï¼‰ä¹‹é—´å­˜åœ¨ç€ä¸€å®šçš„å·®è·ã€‚è‰²å½©è§†é”™ç°è±¡çš„äº§ç”Ÿé™¤ä»¥ç”Ÿç†
ç‰¹å¾ä¸ºå‰ææ¡ä»¶å¤–ï¼Œè¿˜ä¸ç‰©ç†å› ç´ ã€å¿ƒç†ä½œç”¨å¯†åˆ‡å…³è”ï¼Œå¹¶ä¸”å„å…·ç‰¹ç‚¹ã€‚å¤§ä½“ä¸Šåˆ†ï¼Œè‰²å½©è§†é”™ä¸»è¦åŒ…æ‹¬ç‰©ç†æ€§è§†é”™ä¸
å¿ƒç†æ€§è§†é”™ã€‚

ä»ç”Ÿç†å­¦è§’åº¦è®²ï¼Œç‰©ä½“å¯¹è§†è§‰çš„åˆºæ¿€ä½œç”¨çªç„¶åœæ­¢åï¼Œäººçš„è§†è§‰æ„Ÿåº”å¹¶éç«‹åˆ»å…¨éƒ¨æ¶ˆå¤±ï¼Œè€Œæ˜¯æ˜ åƒä»ç„¶æš‚æ—¶å­˜ç•™ï¼Œ
è¿™ç§ç°è±¡ä¹Ÿç§°ä½œâ€œè§†è§‰æ®‹åƒâ€ã€‚è§†è§‰æ®‹åƒå½¢æˆåŸç†æ˜¯ï¼Œå› ä¸ºç¥ç»å…´å¥‹æ‰€ç•™ä¸‹çš„ç—•è¿¹è€Œå¼•å‘ï¼Œæ˜¯çœ¼ç›è¿ç»­æ³¨è§†çš„ç»“æœï¼Œ
æ‰€ä»¥ç§°ä¹‹ä¸ºâ€œè¿ç»­å¯¹æ¯”â€ã€‚è§†è§‰æ®‹åƒåˆåˆ†ä¸ºä¸ºæ­£æ®‹åƒå’Œè´Ÿæ®‹åƒä¸¤ç±»ã€‚

çœ¼çƒä¸­çš„è§†é”¥ç»†èƒåŒ…å«èƒ½æ„Ÿåº”çº¢è‰²ã€ç»¿è‰²å’Œè“è‰²çš„å…‰åŒ–å­¦ç‰©è´¨ã€‚å‡è§†æŸç‰©ä½“è¶…è¿‡æ•°ç§’ä¹‹åï¼Œè¿™äº›ç‰©è´¨å°±ä¼šå¼€å§‹æŸè€—ï¼Œ
ç„¶åè§†é”¥ç»†èƒå¼€å§‹å‘æˆ‘ä»¬çš„å¤§è„‘å‘é€é”™è¯¯çš„ä¿¡æ¯ï¼Œå¤§è„‘ä¾ç„¶ä¼šæ”¶åˆ°å½±åƒï¼Œè¿™å«åš*æ®‹å½±*ã€‚

æ‰€è°“çš„æ­£æ®‹åƒï¼Œåˆç§°â€œæ­£ååƒâ€ï¼Œæ˜¯è¿ç»­å¯¹æ¯”ä¸­çš„ä¸€ç§è‰²è§‰ç°è±¡ã€‚å®ƒæ˜¯æŒ‡åœ¨åœæ­¢ç‰©ä½“çš„è§†è§‰åˆºæ¿€åï¼Œè§†è§‰ä»ç„¶æš‚æ—¶
ä¿ç•™åŸæœ‰ç‰©è‰²æ˜ åƒçš„çŠ¶æ€ï¼Œä¹Ÿæ˜¯ç¥ç»å…´å¥‹æœ‰ä½™çš„äº§ç‰©ã€‚å¦‚å‡æ³¨çº¢è‰²ï¼Œå½“å°†å…¶ç§»å¼€åï¼Œçœ¼å‰è¿˜ä¼šæ„Ÿåˆ°æœ‰çº¢è‰²æµ®ç°ã€‚
é€šå¸¸ï¼Œæ®‹åƒæš‚ç•™æ—¶é—´åœ¨ 0.1 ç§’å·¦å³ã€‚å½±è§†è‰ºæœ¯å°±æ˜¯æ ¹æ®è¿™ä¸€è§†è§‰ç”Ÿç†ç‰¹æ€§çš„åˆ›ä½œï¼Œå¦‚æŠŠæ¯ç§’ 24 ä¸ªé™æ­¢ç”»é¢
è¿ç»­æ”¾æ˜ æ—¶ï¼Œçœ¼ç›å°±å¯ä½“éªŒåˆ°ä¸ç”Ÿæ´»ä¸­çš„è¿åŠ¨èŠ‚å¥ç›¸å¯¹åº”çš„å°è±¡ï¼Œå› è€Œä½¿äººæ„Ÿåˆ°æ ©æ ©å¦‚ç”Ÿã€‚
 
æ‰€è°“çš„è´Ÿæ®‹åƒï¼Œåˆç§°â€œè´Ÿååƒâ€ï¼Œæ˜¯è¿ç»­å¯¹æ¯”ä¸­çš„åˆä¸€ç§è‰²è§‰ç°è±¡ã€‚å®ƒæ˜¯æŒ‡åœ¨åœæ­¢ç‰©ä½“çš„è§†è§‰åˆºæ¿€åï¼Œè§†è§‰ä¾æ—§æš‚æ—¶
ä¿ç•™ä¸åŸæœ‰ç‰©è‰²æˆè¡¥è‰²æ˜ åƒçš„è§†è§‰çŠ¶æ€ã€‚é€šå¸¸ï¼Œè´Ÿæ®‹åƒåœ°åæ˜ å¼ºåº¦åŒå‡è§†ç‰©è‰²çš„æ—¶é—´é•¿çŸ­æœ‰å…³ï¼Œå³æŒç»­æ—¶é—´è¶Šé•¿ï¼Œ
è´Ÿæ®‹åƒçš„è½¬æ¢æ•ˆæœè¶Šé²œæ˜ã€‚ä¾‹å¦‚ï¼Œå½“ä¹…è§†çº¢è‰²åï¼Œè§†è§‰è¿…é€Ÿç§»å‘ç™½è‰²æ—¶ï¼Œçœ‹åˆ°çš„å¹¶éç™½è‰²è€Œæ˜¯çº¢è‰²çš„è¡¥è‰²â€”â€”ç»¿è‰²ã€‚
å¦‚ä¹…è§†çº¢è‰²åï¼Œåœ¨è½¬å‘ç»¿è‰²æ—¶ï¼Œåˆ™ä¼šè§‰å¾—ç»¿è‰²æ›´ç»¿ã€‚è€Œå‡æ³¨çº¢è‰²åï¼Œå†ç§»è§†æ©™è‰²æ—¶ï¼Œåˆ™ä¼šæ„Ÿåˆ°è¯¥è‰²å‘ˆæš—ã€‚


è¦è§‚å¯Ÿè¿™ç§ç°è±¡ï¼Œåªéœ€è¦åœ¨å…¨é»‘çš„èƒŒæ™¯ä¸­ç”¨ç™½è‰²çº¿ç”»å‡ºæ ¼å­ï¼Œç„¶åå°±å¯ä»¥è§‚å¯Ÿåˆ°ç™½è‰²çº¿æ¡çš„äº¤å‰ç‚¹ä¼šå‡ºç°é»‘ç‚¹æ®‹åƒç°è±¡ã€‚

![æ£‹ç›˜è§†é”™è§‰](https://picx.zhimg.com/80/bfa8d0ad15cf0ac735b9df38a5948411_1440w.webp)

å…ˆæ³¨è§†å·¦ä¾§çš„ç‹ç‹¸ 30 ç§’æ—¶é—´ï¼Œç„¶åå†æ³¨è§†å³ä¾§çš„ç‹ç‹¸ï¼Œä¼šåœ¨å³ä¾§çš„ç‹ç‹¸ä¸Šå‘ç°ä¸€ä¸ªçº¢è‰²çš„é—ªå½±ã€‚

![Fox](https://img3.jiemian.com/jiemian/original/20151011/144454807244297500_a700xH.jpg)

è¿™å¼  19 ä¸–çºªçš„ç´«ç½—å…°é›•åˆ»ç”»èƒŒåè—ç€æ‹¿ç ´ä»‘Â·æ³¢æ‹¿å·´å’Œä»–çš„ç¬¬äºŒä»»å¦»å­ç›ä¸½Â·éœ²æ˜“ä¸ä»¥åŠä»–ä»¬çš„å„¿å­ã€‚è§‚çœ‹è¿™ç§
æ¨¡ç³Šçš„ç”»åƒæ—¶ï¼Œä½ çš„å¤§è„‘è¢«è¿«é€‰æ‹©æˆ–æ˜¯çœ‹ç”»æˆ–æ˜¯çœ‹è„¸ï¼Œè¦åŒæ—¶çœ‹åˆ°è¿™ä¸¤æ ·ä¸œè¥¿æ˜¯å¾ˆéš¾çš„ã€‚æç¤ºï¼šä½ å¯ä»¥æ‰¾åˆ°æ‹¿ç ´ä»‘çš„å¸½å­ã€‚

![NP](https://img1.jiemian.com/jiemian/original/20151011/14445479452906300_a700xH.jpg)

åœ¨å¤§é¢ç§¯çš„èƒŒæ™¯è‰²ä¸­ï¼Œä¸€ä¸ªç°è‰²ç‚¹ä¼šè‡ªç„¶åœ°å‡ºç°èƒŒæ™¯è‰²çš„è¡¥è‰²çš„å€¾å‘ã€‚

çœ¼ç›çš„è§‚å¯ŸåŠ›æ€»ä¼šè¢«å¤§å—çš„èƒŒæ™¯è‰²å½±å“ï¼ŒèƒŒæ™¯æ•ˆåº”æ¯å¤©æ— æ—¶æ— åˆ»ä¸åœ¨å‘æŒ¥ç€ä½œç”¨ï¼Œæˆ‘ä»¬ç”šè‡³éƒ½ä¸ä¼šè§‰å¯Ÿåˆ°ã€‚æ¯”å¦‚ï¼Œ
åœ¨è‰ºæ ¡ä¸­ç”¨æ¥è®­ç»ƒçš„ç°åº¦çº§è‰²å—ï¼Œä¸åŒèƒŒæ™¯è‰²ä¸‹ä¼šè¡¨ç°å‡ºä¸åŒçš„æ•ˆæœã€‚åœ¨å…¨ç™½çš„èƒŒæ™¯è‰²ä¸‹ï¼Œé»‘è‰²å—ä¼šæ˜¾å¾—ç‰¹åˆ«é»‘ï¼Œ
è€Œå…¶å®ƒæµ…ç°è‰²ä¼šæ˜¾å¾—æ¨¡ç³Šã€‚è€Œå¦‚æœåœ¨å…¨é»‘è‰²èƒŒæ™¯ä¸‹ï¼Œç™½è‰²å°±ä¼šæ˜¾å¾—ç‰¹åˆ«å…‰äº®ã€‚æ‰€ä»¥ï¼Œçœ¼ç›ä¼šåˆ†è¾¨ä¸äº†åœ¨ä¸åŒèƒŒæ™¯è‰²
ä¸­çš„ä¸¤ä¸ªç›¸åŒçš„è‰²å—ã€‚

èƒŒæ™¯æ•ˆåº”å‡ ä¹æ—¶åˆ»åœ¨æ¬ºéª—çœ¼ç›ï¼Œä¸€ä¸ªç®€å•çš„åˆ—å­å°±æ˜¯ä½¿ç”¨é»‘ç™½æ£‹ç›˜æ ¼ï¼Œä¸€åŠæ”¾åœ¨é˜´å½±ä¸‹ï¼Œå¦ä¸€åŠæ”¾åœ¨é˜³å…‰ä¸‹ã€‚ç”±äº
è§†è§‰ç»éªŒï¼Œå¤§è„‘ä¼šè‡ªåŠ¨è¯†åˆ«é˜³å…‰ä¸‹çš„é»‘è‰²æ ¼å­ä¸ºé»‘è‰²ï¼Œä½†å…¶å®åœ¨é˜³å…‰ä¸‹çš„é»‘æ ¼å­å’Œé˜´å½±ä¸‹çš„ç™½è‰²æ ¼å­è‰²å€¼æ˜¯ç›¸åŒçš„ã€‚

![æ£‹ç›˜è§†é”™è§‰](https://pic1.zhimg.com/80/v2-ea71587ad249dfec6a460e7815e112d6_1440w.webp)

Victo Ngai å€ªä¼ å©§åœ¨å…¶ Mastering Color ç½‘è¯¾ä¸Šä¸¾ä¾‹ï¼š
åœ¨ HSV(309, 28, 40) å’Œ HSV(104, 30, 68) ä¸¤ä¸ªèƒŒæ™¯è‰²å—ä¸­ï¼Œåˆ†åˆ«æ”¾ç½®é¥±å’Œåº¦ã€äº®åº¦éƒ½æ›´ä½çš„ä¸¤ä¸ªè‰²å—
HSV(311, 17, 42) å’Œ HSV(104, 15, 62)ï¼Œåœ¨èƒŒæ™¯æ•ˆåº”ä¸‹ï¼Œè¿™ä¼šè®©å®ƒä»¬çœ‹ä¸‹æ¥æ˜¯ä¸€æ ·çš„é¢œè‰²ã€‚

å› ä¸ºï¼Œé™ä½äº†é¥±å’Œåº¦ï¼Œé¢œè‰²æ›´éš¾ä»¥åŒºåˆ†è‰²ç›¸ï¼ŒåŒæ—¶é™ä½äº®åº¦åˆåŠ å¼ºäº†è¿™ä¸€å˜åŒ–ã€‚ç™½è‰²èƒŒæ™¯ä¼šè®©å…¶å®ƒé¢œè‰²çœ‹èµ·æ¥æ›´æš—ï¼Œ
è€Œé»‘è‰²èƒŒæ™¯åˆ™ä¼šè®©å…¶å®ƒé¢œè‰²çœ‹èµ·æ¥æ›´äº®ã€‚

æ‰€ä»¥ï¼Œå¤§è„‘é€šè¿‡çœ¼ç›çœ‹åˆ°çš„ä¼¼ä¹ä¸€æ ·çš„é¢œè‰²ï¼Œæˆ–è€…æ˜¯ä¸ä¸€æ ·çš„é¢œè‰²ï¼Œéƒ½ä¸ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œç­”æ¡ˆå°±åœ¨æ•°å­—åŒ–å›¾åƒä¸­ã€‚
å¤§è„‘åªéœ€è¦ä¸€ä¸ªåˆç†çš„é¢œè‰²å…³ç³»ï¼Œçœ¼ç›è‡ªç„¶éœ€è¦é™ä½é¢œè‰²çš„é«˜å¯¹æ¯”åº¦ï¼Œåœ¨ç»˜ç”»æ—¶ï¼Œéœ€è¦è€ƒè™‘è¿™ç§ç‰¹æ€§ã€‚


å‚è€ƒ Color and Light by James Gurney - Separation of Light and Shadowã€‚ä¹¦ä¸­è¿˜æ¯”è¾ƒäº†
ç›´æ¥è§‚å¯Ÿä¸å‚è€ƒç…§ç‰‡çš„ç»˜ç”»æ–¹å¼çš„åŒºåˆ«ï¼ŒæŒ‡å‡ºäº†å‚è€ƒç…§ç‰‡è¿›è¡Œç»˜ç”»çš„ä¸è¶³ã€‚å› ä¸ºç”±äºè®¾å¤‡å…‰çº¿åŠ¨æ€èŒƒå›´èƒ½åŠ›æœ‰é™ï¼Œ
æœ‰äº›åŒºåŸŸä¼šå‡ºç°çº¯ç™½æˆ–çº¯é»‘ï¼Œä¸¢å¤±å¤§é‡ç»†èŠ‚ã€‚

Victo Ngai å€ªä¼ å©§åœ¨å…¶ Mastering Color ç½‘è¯¾ä¸ŠæŒ‡å‡ºå‡ æ¡æœ€é‡è¦çš„è‰²å½©åŸç†ï¼š

- **ç›¸å¯¹æ€§åŸç†** Relativityï¼šè‰²å½©ä¹‹é—´å…·æœ‰å…³è”æ€§ï¼Œä¸å¯å°†è‰²å½©å•ç‹¬çœ‹å¾…ã€‚çœ¼ç›çš„è§‚å¯Ÿæ˜¯æ„Ÿæ€§çš„ï¼ŒèƒŒæ™¯æ•ˆåº”è§£é‡Šäº†çœ¼ç›å¯¹é¢œè‰²çš„è§‚å¯Ÿå¹¶ä¸å®Œå…¨å‡†ç¡®ã€‚
- **ä¸€è‡´æ€§åŸç†** Consistencyï¼šåŒä¸€ä»¶ä½œå“ä¸­çš„é¢œè‰²åº”è¯¥å­˜åœ¨äºåŒä¸€ä¸ªä¸–ç•Œä¸­ï¼Œåœ¨ä½œå“ä¸­ä¼ è¾¾é¢œè‰²ä¸€è‡´æ€§å¾ˆé‡è¦ã€‚
  æ¯”å¦‚åœ¨ä¸€ç´«è‰²æ°´æ± ä¸­ï¼Œæ°´ä¸­çš„ç‰©ä½“ä¹Ÿåº”è¯¥æ˜¯åœ¨ç´«è‰²è¿™ä¸ªè‰²è°ƒï¼Œå¦åˆ™ï¼Œæ²¡æœ‰å’Œç´«è‰²äº§ç”Ÿå…³ç³»ï¼Œç‰©ä½“çœ‹èµ·æ¥å°±åƒæ˜¯æ¸¸ç¦»åœ¨å¦ä¸€ä¸ªç©ºé—´ã€‚
- **è‰²å€¼å¯¹æ¯”åŸç†** Value Contrastï¼šä½¿ç”¨æ˜æš—å¯¹æ¯”åŒºåŸŸæ¥å¼•å¯¼è§‚ä¼—çš„è§†çº¿ã€‚åœ¨ä¸€å¹…æš—è°ƒçš„ç”»é¢ä¸­çš„äº®è‰²ï¼Œæˆ–è€…ä¸€å¹…æ˜äº®è‰²è°ƒç”»é¢ä¸­çš„æš—è‰²ï¼Œä¼šå…·æœ‰èšé›†ä½œç”¨ã€‚
- **å¼ºè°ƒè‰²åŸç†** Accent Colorï¼šé€‚å½“çš„å¼ºè°ƒé¢œè‰²å¯ä»¥çªå‡ºç”»é¢é‡ç‚¹ï¼Œå¹¶å…·èšé›†ç›®å…‰ã€‚åˆ—å¦‚ï¼Œå†°å¤©é›ªåœ°ä¸­çš„çº¢è‰²ï¼Œåœ¨è“è‰²è°ƒç”»é¢ä¸­çš„çº¢å°±æ˜¯æœ€å¸å¼•ç›®å…‰çš„ã€‚
- **æ¯”ä¾‹åŸç†** Ratioï¼šä½¿ç”¨æ›´å¼ºçš„é¥±å’Œåº¦é€‰å‡ºä¸€ç§é¢œè‰²ä½œä¸ºä¸»å¯¼ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨äº’è¡¥è‰²é…è‰²æ–¹æ¡ˆæ—¶å°¤å…¶æ˜¯ï¼Œå¦åˆ™å…¶å®ƒé¢œè‰²å°±ä¼šæ‰“æ¶ã€‚

è¯¾ç¨‹ä¸­ï¼Œè¿˜æ¼”ç¤ºäº†å¦‚ä½•ä»å‚è€ƒä½œå“æˆ–è€…å›¾ç‰‡ä¸­è·å–é…è‰²æ–¹æ¡ˆï¼Œå¹¶å°†å…¶è½¬åŒ–ä¸ºè‡ªå·±çš„å·¥ä½œä¸­ä½¿ç”¨çš„è°ƒè‰²æ¿ï¼Œå¹¶åŠ å…¥è‡ªå·±çš„ä¸ªæ€§åŒ–å…ƒç´ ã€‚


ç´ æçš„è¯€çªæåˆ°å…‰çš„æ•ˆæœè¦ç‚¹ï¼š

* æŠŠäº®çš„éƒ¨åˆ†å’Œæš—çš„éƒ¨åˆ†åŒºåŸŸæ ‡è®°å‡ºæ¥ã€‚å¼€å§‹æ—¶ï¼ŒæŠŠé˜´å½±éƒ¨åˆ†çš„è¾¹ç•Œæ˜ç¡®å®šå‡ºæ¥ï¼Œåç»­å¯ä»¥æ·¡åŒ–ã€ä¿®æ”¹è¾¹ç•Œã€‚ 
* ç”¨å…‰å½±å›¾æ¡ˆå®šé€ å‹ã€‚æ‰¾å‡ºå…‰å½±å›¾æ¡ˆçš„å››ä¸ªåŸºæœ¬è¦ç´ :äº®é¢ã€ æš—é¢ã€æŠ•å½±å’Œåå°„å…‰ã€‚ç²¾å¿ƒåœ°å‹¾ç”»å‡ºè¿™å››ä¸ªè¦ç´ å°±å¯ä»¥äº§ç”Ÿå¾ˆå¼ºçš„ä¸‰ç»´æ„Ÿã€‚ 
* å¤„ç†å¥½ç¡¬è¾¹ç¼˜å’Œè½¯è¾¹ç¼˜ã€‚å‰è€…è¦æœ‰åŠ›åº¦ï¼Œåè€…è¦æœ‰æŸ”åº¦ã€‚ä¸¤ç§è¾¹ç¼˜å¤„ç†å¾—å¥½çš„è¯ï¼Œå¯ä»¥äº§ç”Ÿéå¸¸é€¼çœŸçš„æ•ˆæœã€‚ 
* é€šè¿‡æ¸²æŸ“å…‰æºå’Œå…‰çš„æ€§è´¨åˆ†æå…‰ã€‚ 
* æ¸²æŸ“æ°›å›´ã€‚è¦æƒ³è®©ç”»æ›´å¸å¼•äººã€æ›´æ‰“åŠ¨äººï¼Œå°±è¦ä½¿ç”¨ç‰¹æ®Šæ•ˆæœçš„å…‰ï¼Œå‹¾ç”»ç‰¹æ®Šçš„æŠ•å½±ï¼Œæˆ–æ˜¯åœ¨é‡è¦éƒ¨åˆ†çš„æš—å¤„æŠ•ä¸Šå…‰ã€‚ 
* æ¯”è¾ƒè‰²è°ƒï¼Œä»è€Œæ„å»ºè‰²è°ƒå…³ç³»ã€‚è‰²è°ƒæ˜¯åœ¨å½¼æ­¤å¯¹æ¯”ä¸­æ‰æ˜¾å‡ºæ·±æµ…ã€‚ 
* åˆå¹¶é˜´å½±å½¢çŠ¶ã€‚é˜´å½±æ˜¯ä¼Ÿå¤§çš„ç»Ÿä¸€è€…ï¼Œå®ƒå¯ä»¥æŠŠç”»ä¸­çš„ä¸åŒéƒ¨åˆ†è¿æ¥èµ·æ¥ã€‚ç”¨ä¸€ä¸ªé˜´å½±å½¢çŠ¶å°±å¯ä»¥æŠŠä¸€ç¾¤å°çš„å½¢çŠ¶æ‹‰åˆ°ä¸€èµ·ï¼Œç»†èŠ‚ä¸å†æ˜¯æœ€é‡è¦ï¼Œè€Œæ•´ä½“çš„æ•ˆæœå´æ˜æ˜¾å¢å¼ºã€‚ 
* ç”¨å…‰æ¥åˆ¶ä½œå›¾æ¡ˆã€‚å½“ä½ å¼€å§‹æŠŠå…‰å’Œå½±ä½œä¸ºå½¢çŠ¶çœ‹å¾…çš„æ—¶å€™ï¼Œå®ƒä»¬å°±æˆä¸ºäº†åˆ¶å›¾çš„å·¥å…·ï¼Œå‹¾ç”»å‡ºå„ç§å›¾æ¡ˆã€‚


ã€Šç”»å®¶ä¹‹çœ¼ã€‹è¿™æœ¬ä¹¦çš„ä¸»é¢˜å°±æ˜¯ç¾çš„åäºŒé¡¹åŸºæœ¬è¦ç´ ï¼š

- *ç»Ÿä¸€*ï¼ˆunityï¼‰ï¼šè¿™ç§ä¸€ä½“æ€§å°†ç”»é¢çš„æ‰€æœ‰ç‰¹è´¨ç»“åˆæˆå•ä¸€è¡¨ç°æˆ–æ•´ä½“è¡¨ç°ï¼Œæ„å³å°†è®¾è®¡ã€è‰²å½©ã€çº¿æ¡ã€æ˜æš—ã€
        è´¨æ„Ÿå’Œä¸»é¢˜å·§å¦™å®‰æ’ï¼Œç»“åˆä¸ºä¸€ç§å…¨é¢æ€§çš„è¡¨ç°ã€‚
- *ç®€æ´*ï¼ˆsimplicity or clarityï¼‰ï¼šæŠŠè·Ÿä¸»è¦æ„æƒ³æ— å…³çš„æ‰€æœ‰ç´ æå’Œç»†èŠ‚å˜æˆæ¬¡è¦ï¼Œå°†ä¸»é¢˜ç®€åŒ–ä¸ºæœ€
        åŸºæœ¬çš„è®¾è®¡ã€å½¢å¼ä¸å›¾æ¡ˆã€‚
- *è®¾è®¡*ï¼ˆdesignï¼‰ï¼šæ„æŒ‡å—é¢ã€å½¢å¼ä¸è‰²å½©çš„æ•´ä½“å…³ç³»ã€‚ç”»é¢å°±æ˜¯ç”±è®¾è®¡åˆ›é€ å‡ºæ¥çš„ã€‚
- *æ¯”ä¾‹*ï¼ˆproportionï¼‰ï¼šæ„æŒ‡ç”»é¢ä¸­å„ä¸ªä¸»é¢˜ä¸å„ä¸ªéƒ¨åˆ†çš„åè°ƒå…³ç³»ã€‚æ¯”ä¾‹å¤±çœŸï¼ˆdistortionï¼‰å°±ä¸åè°ƒï¼Œ
        ä¸è¿‡æŸäº›å¤±çœŸæˆ–è®¸æ˜¯åˆç†çš„ï¼Œå› ä¸ºç”»å®¶å¯èƒ½æƒ³è¦å¼ºè°ƒæŸä¸ªæ„æƒ³æˆ–æƒ…æ„Ÿã€‚
- *è‰²å½©*ï¼ˆcolorï¼‰ï¼šè¿™æ˜¯ç¾çš„è¦ç´ ä¸­æœ€æœ‰å½±å“åŠ›çš„è¦ç´ ä¹‹ä¸€ï¼Œè€Œä¸”åœ¨ä½¿ç”¨è¿™é¡¹è¦ç´ æ—¶ï¼Œç”»å®¶ä¸èƒ½åªä»¥å“ä½å’Œ
        å¥½æ¶ä¸ºå‡†åˆ™ï¼Œè¿˜å¿…é¡»äº†è§£è‰²å½©ä¸æ˜åº¦çš„å…³ç³»ï¼Œä»¥åŠåˆ›é€ å†™å®ä¸åè°ƒæ•ˆæœçš„åŸºæœ¬è°ƒè‰²åŸç†ã€‚
- *éŸµå¾‹*ï¼ˆrhythmï¼‰ï¼šä¹Ÿå¯ç§°ä¸ºèŠ‚å¥ï¼Œè™½ç„¶è¿™é¡¹è¦ç´ å¸¸è¢«è½»è§†æˆ–è¯¯è§£ï¼Œå´å¯¹ç”»ä½œç¾æ„Ÿæœ‰æå¤§çš„è´¡çŒ®ã€‚æ‰€æœ‰ç”Ÿç‰©å’Œ
        éç”Ÿç‰©éƒ½æœ‰éŸµå¾‹ï¼Œä»æœ€å¾®å°çš„å½¢ä½“åˆ°å®‡å®™çš„å¾ªç¯æ— ä¸€ä¾‹å¤–ã€‚æ²¡æœ‰éŸµå¾‹ï¼Œå½¢ä½“å°±é™æ­¢ä¸åŠ¨ï¼Œä¹Ÿæ¯«æ— ç”Ÿæ°”ã€‚
        å¦‚åŒè‡ªç„¶ç•Œçš„è¿ä½œï¼Œç›¸è¿‘è‰²æˆ–çº¿æ¡çš„é‡å¤ï¼Œæˆ–æ˜¯å½¢çŠ¶æ¸è¿›æ‰©å¤§æˆ–ç¼©å°ï¼Œéƒ½èƒ½ä¸ºç”»ä½œåˆ›é€ éŸµå¾‹ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ
        æ ‘æœ¨æœ¬èº«æä¸«å’Œæ ‘å¶çš„é‡å¤çº¿æ¡éŸµå¾‹ï¼Œæ–‘é©¬èƒŒä¸Šçš„çº¿æ¡ï¼Œæˆ–èŠ±ç“£å’ŒèŠ±æœµçº¹è·¯çš„çº¿æ¡ä¹Ÿèƒ½å‘ç°éŸµå¾‹ã€‚
- *å½¢ä½“*ï¼ˆformï¼‰ï¼šå½¢ä½“ç»“æ„ä¸æ•´ä½“çš„å…³ç³»æ˜¯ä¸€é¡¹åŸºæœ¬è‰ºæœ¯åŸç†ã€‚ä¸‡ç‰©å­˜åœ¨çš„æ ·æ€ï¼Œä¸å¤–ä¹å½¢ä½“æˆ–ç©ºé—´çš„å®ä¸è™šï¼Œ
        solid vs. voidï¼Œè€Œä¸”ä¸¤è€…ä¸å¯æˆ–ç¼ºï¼Œæ— æ³•ç‹¬è‡ªå­˜åœ¨ã€‚å½“ç”»ä½œä¸­çš„ç‰©ä½“å½¢çŠ¶ç»è¿‡å·§å¦™çš„æç»˜å’Œç»„åˆï¼Œ
        å¹¶ä¸å¼€æ”¾åŒºåŸŸå½¢æˆé€‚å½“çš„å¯¹æ¯”ï¼Œè­¬å¦‚æ ‘ä¸å¤©ç©ºå½¢æˆçš„å¯¹æ¯”ï¼Œå°±ä¼šè®©ç”»ä½œå…·æœ‰â€œå½¢ä½“â€ã€‚
- *è´¨æ„Ÿ*ï¼ˆtextureï¼‰ï¼šæ„æŒ‡å¯¹äºè¡¨é¢çš„æç»˜ã€‚æ‰€æœ‰å½¢ä½“éƒ½æœ‰å…¶è¡¨é¢ç‰¹å¾ï¼Œè¿™ä¸€ç‚¹å°±è·Ÿæœ¬èº«å½¢ä½“ç»“æ„ä¸€æ ·é‡è¦ã€‚
        ä»¥åŒæ ·çš„è¡¨é¢ç‰¹å¾æç»˜æ‰€æœ‰å½¢ä½“ï¼Œå°±æ˜¯åƒç¯‡ä¸€å¾‹çš„æ¯›ç—…ï¼Œå½“ç„¶ä¸å¯èƒ½ç”»å‡ºçœŸæ­£çš„ç¾ï¼Œæ˜¯å¹³åº¸ä¹‹ä½œå¸¸æ€ã€‚
- *æ˜åº¦*ï¼ˆvalueï¼‰ï¼šæ˜åº¦å’Œè‰²å½©ï¼Œä¸¤è€…å¯†ä¸å¯åˆ†ã€‚è¦ç”»å‡ºç¾ï¼Œä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚é€‚å½“çš„æ˜åº¦å…³ç³»èƒ½ä¸ºç”»é¢åˆ›é€ å…‰æ„Ÿ
        å¹¶å¢æ·»ç»Ÿåˆæ„Ÿã€‚ä¸æ­£ç¡®çš„æ˜åº¦å…³ç³»å°±ä¼šå¯¹ç”»é¢ç¾æ„Ÿé€ æˆæœ€å¤§çš„ç ´åã€‚
- *å…‰æ„Ÿ*ï¼ˆquality of lightï¼‰ï¼šè¿™é¡¹è¦ç´ æœ€é‡è¦ä¸è¿‡ï¼Œç”»ä½œä¸­çš„å…‰æ„Ÿè·Ÿå®é™…ç…§å°„äºç”»é¢ä¸Šçš„å…‰çº¿èåˆï¼Œæˆä¸º
        æ•´å¼ ç”»ä½œçš„ä¸€éƒ¨åˆ†ã€‚å…‰æœ‰è®¸å¤šç§ï¼Œå®¤å†…å…‰ã€å®¤å¤–å…‰ã€é˜³å…‰ã€æ¼«å°„å…‰å’Œåå°„å…‰ã€‚å…‰æºå¿…é¡»è·Ÿå½¢ä½“çš„å¡‘é€ ã€è‰²å½©
        çš„æ€§è´¨ä¸æ˜åº¦ä»¥åŠè´¨æ„Ÿæœ‰å…³ã€‚å¦‚æœç”»å®¶æ²¡æœ‰çœŸæ­£ç†è§£å…‰çš„åŸç†ï¼Œç”»ä½œå°±å¯èƒ½åªæ˜¯é¢œæ–™åœ¨ç”»å¸ƒï¼ˆç”»çº¸ï¼‰ä¸Š
        çš„å¹³é¢æç»˜ï¼Œæ— æ³•åˆ›é€ å‡ºç”»é¢çš„ç©ºé—´æ„Ÿã€‚
- *ä¸»é¢˜*ï¼ˆsubjectï¼‰ï¼šè¿™é¡¹è¦ç´ æä¾›ç»™ç”»å®¶å¤§å¥½æœºä¼šï¼Œå……åˆ†å‘æŒ¥ä¸ªäººå“ä½ã€‚ç”»å®¶å¯ä»¥ä»ç”Ÿæ´»å’Œå¤§è‡ªç„¶ä¸­ï¼Œæ‰¾åˆ°
        æ•°ä¸æ¸…çš„ä¸»é¢˜ï¼Œä»ä¸­æŒ‘é€‰ã€è®¾è®¡å’Œåˆ›é€ å‡ºè‡ªå·±ä¸“æ³¨çš„ä¸»é¢˜ï¼Œå±•ç°ç”»å®¶æœ¬èº«å¯¹ç¾çš„é‰´èµåŠ›ã€‚
- *æŠ€æ³•*ï¼ˆtechniqueï¼‰ï¼šæ„æŒ‡è¡¨ç°çš„æ–¹å¼è€Œéè¡¨ç°æœ¬èº«ã€‚æŠ€æ³•åŒ…æ‹¬å¯¹äºç‰©ä½“è¡¨é¢å’Œè´¨æ„Ÿçš„ç†è§£ï¼Œä»¥åŠå¯¹åª’æ
        åŠåª’æåº”ç”¨ä¹‹è¯¸å¤šæ–¹æ³•çš„è®¤è¯†ã€‚æŠ€æ³•æ˜¯ç»“åˆå…¶ä»–ç¾çš„è¦ç´ æ‰€åšçš„ä¸ªäººè¡¨ç°ã€‚




## ğŸŸ¡ Environment & Lighting ç¯å¢ƒä¸å…‰ç…§
- [Lights and shadow](https://docs.godotengine.org/en/3.5/tutorials/3d/lights_and_shadows.html)
- [Reflection probes](https://docs.godotengine.org/en/3.5/tutorials/3d/reflection_probes.html)
- [Global illumination probes](https://docs.godotengine.org/en/3.5/tutorials/3d/gi_probes.html)
- [Baked lightmaps](https://docs.godotengine.org/en/3.5/tutorials/3d/baked_lightmaps.html)
- [GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ-ç‹å¸Œ](https://www.bilibili.com/video/BV1J3411n7WT/)
- [GAMES202ï¼šã€Šé«˜è´¨é‡å®æ—¶æ¸²æŸ“ã€‹é—«ä»¤çª](https://www.bilibili.com/video/BV1YK4y1T7yY/)
- [å®æ—¶é˜´å½±æŠ€æœ¯ Real-time Shadows](https://www.cnblogs.com/KillerAery/p/15201310.html)
- [Introduction to 3D](https://docs.godotengine.org/en/latest/tutorials/3d/introduction_to_3d.html)
- [å¼€æ”¾ä¸–ç•Œç¯å¢ƒå…‰ç…§ Godot 3D æ•™ç¨‹](https://www.bilibili.com/video/BV1bM4y1c74E/)
- [Introduction to global illumination](https://docs.godotengine.org/en/latest/tutorials/3d/introduction_to_global_illumination.html)
- [Volumetric fog and fog volumes](https://docs.godotengine.org/en/latest/tutorials/3d/volumetric_fog.html)

Godot ä¸­ä½¿ç”¨ç±³åˆ¶å•ä½ç³»ç»Ÿï¼Œå³å±æ€§é¢æ¿ä¸­çš„ 1 å•ä½ä»£è¡¨ 1 ç±³ï¼Œç‰©ç†æˆ–å…¶å®ƒé¢ç§¯æŒ‰æ­¤ä¼¸ç¼©ã€‚

åæ ‡ç³»ç»Ÿä½¿ç”¨ Y è½´ä½œä¸º "up" çš„æŒ‡å‘ï¼Œè€Œæ°´å¹³è½´ä¸º X/Zã€‚ä½¿ç”¨å³æ‰‹åæ ‡ç³»ç»Ÿï¼Œä¿æŒé£ŸæŒ‡ã€ä¸­æŒ‡ã€æ‹‡æŒ‡ç›¸ç³»å‚ç›´ï¼š

- å¹¶ä¸”é£ŸæŒ‡æŒ‡å‘ä¸Šï¼Œå¯¹åº” Y è½´æŒ‡å‘ï¼›
- ä¸­æŒ‡å‚ç›´å±å¹•æŒ‡å‘è‡ªå·±ï¼Œå¯¹åº” Z è½´æŒ‡å‘ï¼›
- æ‹‡æŒ‡å¹³è¡¡å±å¹•æ°´å¹³å‘å³ï¼Œå¯¹åº” X è½´æŒ‡å‘ï¼›

åœºæ™¯ä¸­é»˜è®¤çš„ç›¸æœºé•œå¤´æŒ‡å‘ Z è½´è´Ÿå‘ï¼Œç‰©ä½“çš„æŒ‡å‘ Z è½´æ–¹å‘ä¸ºå‰å‘ï¼Œç®€è€Œè¨€ä¹‹ï¼š

- X è½´æ˜¯ä¸¤è¾¹ï¼š right/left
- Y è½´æ˜¯ä¸Šä¸‹ï¼š up/down
- Z è½´æ˜¯å‰åï¼š front/back

ä»¥ä¸‹æ˜¯ Freya HolmÃ©r åˆ¶ä½œçš„å„ç§è½¯ä»¶ä½¿ç”¨çš„åæ ‡ç³»ç»Ÿ UP æ–¹å‘è½´çš„å·®åˆ«å¯¹ç…§å‚è€ƒï¼š

![Image by Freya HolmÃ©r](https://docs.godotengine.org/en/latest/_images/introduction_to_3d_coordinate_systems.webp)

åœ¨ 3D åœºæ™¯è§†å›¾ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å¿«æ·é”®ï¼š

- æŒ‰ä¸‹ Ctrl é…åˆé¼ æ ‡æ“ä½œå¯ä»¥å°† moving, scaling or rotating æ“ä½œå¸é™„åˆ°å‚è€ƒçº¿ã€‚
- ä½¿ç”¨ F å¯ä»¥å°†è§†å›¾ä¸­é€‰ä¸­çš„å¯¹è±¡å±…ä¸­åˆ°å±å¹•ã€‚


ä¸åŒäºç”µå½±è¡Œä¸šä¸ºäº†è¿½æ±‚é«˜è´¨é‡çš„ç¦»çº¿æ¸²æŸ“ off-line renderingï¼Œæ¸¸æˆè¡Œä¸šä¸­æ˜¯å®æ—¶æ¸²æŸ“ï¼Œè¿™å°±ä¸ºç¡¬ä»¶æå‡º
äº†é«˜åº¦çš„æ€§èƒ½è¦æ±‚ï¼Œåœ¨ä¸€å®šçš„ç¡¬ä»¶æ€§èƒ½æ¡ä»¶ä¸‹ï¼Œå®æ—¶æ¸²æŸ“å¹¶ä¸èƒ½ä¸€å‘³ä¸ºäº†åšæœ€ä½³å›¾åƒè´¨é‡ï¼Œè€Œæ˜¯åœ¨è´¨é‡ä¸æµç•…ä½“éªŒ
ä¹‹é—´çš„æƒè¡¡ã€‚

ä¸ºäº†å®ç°å›¾åƒè´¨é‡åˆå¥½ï¼Œæ¸¸æˆæ“ä½œä½“éªŒåˆæµç•…çš„åŒå¹³è¡¡ï¼Œæ¸²æŸ“ä¸­é€šè¿‡å¼•ç”¨ä¸€äº›ä»£è¿ç®—æˆæœ¬çš„æŠ€æœ¯ï¼Œä¾‹å¦‚å¼•å…¥æ³•çº¿
è´´å›¾æ›¿ä»£é«˜ç²¾åº¦é«˜é¢æ•°çš„æ¨¡å‹ã€‚å…‰ç…§ç³»ç»Ÿä¸­ï¼Œå¼•å…¥å„ç§æ¢é’ˆæ¥è®¾ç½®éœ€è¦ç»†è‡´å¤„ç†çš„å…‰ç…§ç©ºé—´ï¼Œé¿å…å°†æœ‰é™çš„ç®—åŠ›
ç”¨åˆ°æ€§ä»·æ¯”ä¸é«˜çš„åŒºåŸŸä¸Šã€‚


Godot å¼•å…¥äº†ä»¥ä¸‹å…‰ç…§æ¢é’ˆã€åæœŸå¤„ç†æˆ–å…¶å®ƒç›¸å…³æŠ€æœ¯ï¼š

- Real-time global illumination (GI) probe å…¨å±€ç…§æ˜æ¢é’ˆï¼Œåªå¤„ç†æŒ‡å®šåŒºåŸŸçš„å…¨å±€å…‰ã€‚
- Reflection probes åå°„å…‰æ¢é’ˆï¼Œåªå¤„ç†æŒ‡å®šåŒºåŸŸçš„åå°„å…‰ã€‚
- Baked lightmaps å…‰ç…§çƒ˜åŸ¹ï¼Œå°†å…‰ç…§æ•ˆæœä»¥å›¾ç‰‡å½¢å¼ä¿å­˜ä¸‹æ¥ï¼Œè¿è¡Œæ—¶ç›´æ¥è´´å›¾è¿˜åŸå…‰ç…§æ•ˆæœã€‚
- Screen-Space Reflections (SSR) å±å¹•ç©ºé—´åå°„æœ€æœ‰æ„ä¹‰çš„åœºæ™¯åœ¨ç‰©ä½“å½¼æ­¤æ¥è§¦æ—¶ï¼Œå¦‚ç‰©ä½“åœ¨åœ°æ¿ä¸Šçš„å€’å½±ã€‚
- Screen-Space Ambient Occlusion (SSAO) å±å¹•ç©ºé—´ç¯å¢ƒå…‰é®è”½ï¼Œæ¨¡æ‹Ÿç¯å¢ƒå…‰é®æŒ¡ï¼ˆé˜´å½±ï¼‰ã€‚
- Screen-space indirect lighting (SSIL) å±å¹•ç©ºé—´é—´æ¥å…‰ç…§å¤„ç†ã€‚
- Signed distance field global illumination (SDFGI) æœ‰å‘è·ç¦»åœºå…¨å±€å…‰ç…§ï¼Œé€šè¿‡ç¯å¢ƒèŠ‚ç‚¹å¯ç”¨ã€‚

![SSR](https://docs.godotengine.org/en/3.5/_images/environment_ssr.png)

Godot ç›®å‰æ¥çœ‹ï¼Œå…‰ç…§æ•ˆæœç›¸å½“å¼±ï¼Œä¸ Blender å®Œå…¨ä¸åœ¨åŒä¸€æ°´å¹³ï¼Œä¸é€‚åˆåˆ¶ä½œå†™å®ç±»å‹ä½œå™¨ï¼Œé£æ ¼åŒ–æ›´é€‚åˆã€‚
Godot 4.0 å¼•å…¥äº†å¤šç§å®æ—¶ã€åŠå®æ—¶çš„å…‰æ•ˆæå‡æŠ€æœ¯ï¼Œ3D å…‰ç…§æŠ€æœ¯æ¯”æ—§ç‰ˆæœ¬æœ‰äº†ä¸å°è¿›æ­¥ã€‚

ä¸è€ƒè™‘ç²’å­èŠ‚ç‚¹ï¼Œä»¥ä¸‹æ˜¯æ–°æ—§ç‰ˆæœ¬ä¸­å…³äºå…‰æ•ˆå¤„ç†çš„èŠ‚ç‚¹ç±»å‹å˜åŒ–ï¼š

|      Godot 3.5       |          Godot 4.0           |
|----------------------|------------------------------|
| VisualInstance       | VisualInstance3D             |
| - BakedLightmap      | - Decal                      |
| - GIProbe            | - FogVolume                  |
| - Light              | - Light3D                    |
| - - DirectionalLight | - - DirectionalLight3D       |
| - - OmniLight        | - - OmniLight3D              |
| - - SpotLight        | - - SpotLight3D              |
| - ReflectionProbe    | - LightmapGI                 |
|                      | - ReflectionProbe            |
|                      | - VisibleOnScreenNotifier3D  |
|                      | - - VisibleOnScreenEnabler3D |
|                      | - VoxelGI                    |
|                      | Lightmapper                  |
|                      | - LightmapperRD              |

æ—§ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ GIProbe å…¨å±€å…‰æ¢é’ˆï¼Œæ–°ç‰ˆæœ¬ç§»é™¤æ­¤èŠ‚ç‚¹ï¼Œå¢åŠ äº†å¤šä¸ªè§†æ•ˆèŠ‚ç‚¹ï¼Œä½¿ç”¨å®ƒä»¬åº”è¯¥æƒè¡¡ï¼š

- **Performance** å®æ—¶å…‰ç…§æ¯”åŠå®æ—¶ã€çƒ˜ç„™æŠ€æœ¯æ›´æ¶ˆè€—ç®—åŠ›ï¼›
- **Visuals** å®æ—¶æŠ€æœ¯ä¸èƒ½æä¾›æœ€é¡¶çº§çš„è§†è§‰æ•ˆæœã€‚ 
- **Real-time ability** åŠå®æ—¶æŠ€æœ¯æœ‰å®æ—¶æŠ€æœ¯ä¸­ä¸å­˜åœ¨çš„çº¦æŸï¼Œå¦‚ç§»åŠ¨çš„ç‰©ä½“å…‰ç…§å¤„ç†é—®é¢˜ã€‚
- **User work needed** GI æŠ€æœ¯æœ‰å®Œå…¨è‡ªåŠ¨çš„ï¼Œä¹Ÿæœ‰éœ€è¦ç”¨æˆ·ä»”ç»†è§„åˆ’å’Œè°ƒæ•´çš„ï¼Œæ ¹æ®å·¥ä½œéœ€è¦ä½¿ç”¨ã€‚

æ–°ç‰ˆæœ¬çš„å…‰ç…§æŠ€æœ¯åº”ç”¨åœºåˆæ¦‚è¦ï¼š

|          GI          |        Perference        |      RT ability      |
|----------------------|--------------------------|----------------------|
| **ReflectionProbe:** | Update Mode: Always/Once | Optionally real-time |
| **LightmapGI:**      | Baked                    | not real-time        |
| **VoxelGI:**         | Forward+ Projects        | Fully real-time      |
| **SSIL:**            | Forward+ Projects        | Fully real-time      |
| **SDFGI:**           | Forward+ Proejcts        | Semi real-time       |

æ­¤å¤–ï¼Œé€šè¿‡æ‰“å…‰æŠ€æœ¯è¾…åŠ©ï¼Œå¯ä»¥æ¨¡æ‹Ÿå…¨å±€å…‰çš„æ•ˆæœã€‚è¦ç‚¹æ˜¯åœ¨ä¸»å…‰æºç¡®å®šåï¼Œæ·»åŠ é¢å¤–çš„è¡¥å…‰å…‰æºï¼Œé‡è¦çš„æ˜¯å…³æ‰
è¡¥å…‰çš„é˜´å½±å±æ€§ï¼ŒShadow = Offï¼Œå¹¶ä¸”é€‚å½“å‡å¼±å¼ºåº¦é¿å…å½±å“ä¸»å…‰æºã€‚æœ€åå…³æ‰é«˜äº® Specular = 0ï¼Œå¹¶è°ƒæ•´
è¡¥å…‰çš„æ‰“å…‰æ–¹å‘ã€‚ä¸‰ç¯å¸ƒå…‰æ³•æ˜¯ä¸€ç§ç»å…¸æ‰“å…‰æŠ€æœ¯ï¼Œé€šè¿‡ä¸åŒæ–¹ä½ç»„åˆï¼Œé€šè¿‡ä¸»å…‰ã€è¾…å…‰ã€è½®å»“å…‰å±•ç¤ºä¸åŒçš„æ•ˆæœã€‚

å¤šæ•°å…‰æ•ˆè®¾ç½®éœ€è¦åœ¨ç´ æå¯¼å…¥æ—¶è®¾ç½®ï¼š

    Project Settings > Rendering > Global Illumination 

    Meshes > Light Baking > Static Lightmaps (VoxelGI/SDFGI/LightmapGI)
    Meshes > Lightmap Texel Size

    MeshInstance > Global Illumination > Mode > Static


### ğŸŸ ğŸ”µ 2D lights äºŒç»´ç¯å…‰
- [2D lights and shadows](https://docs.godotengine.org/en/3.5/tutorials/2d/2d_lights_and_shadows.html)
- [2D lights and shadows demo](https://github.com/godotengine/godot-demo-projects/tree/master/2d/lights_and_shadows)
- [Trace Bitmap In Inkscape](https://inkscape.org/doc/tutorials/tracing/tutorial-tracing.html)
- [GPU Gems 1 - 11. Shadow Map Antialiasing](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-11-shadow-map-antialiasing)

é™¤äº†ç¯å¢ƒè®¾ç½®ï¼Œåœ¨ 2D åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ **CanvasModulate** å¯¹æ•´ä¸ªç”»å¸ƒè¿›è¡Œé¢œè‰²è°ƒæ•´ï¼Œå¯ä»¥æ‰¹é‡æ”¹å˜
åœºæ™¯ä¸­çš„ CanvasItem çš„é¢œè‰²ï¼Œä½†æ˜¯å¯¹ CanvasLayer æˆ–å­ç±» ParallaxBackground æ— æ•ˆï¼Œå› ä¸ºå®ƒä»¬
æ˜¯ç‹¬ç«‹çš„ç”»å¸ƒå¯¹è±¡ï¼Œå…·æœ‰ä¸åŒ layer ç»˜ç”»é¡ºåºã€‚åŒæ ·ï¼Œé…åˆ Light2D èŠ‚ç‚¹ï¼Œåˆå¯ä»¥æ·»åŠ äºŒç»´å…‰ç…§ï¼Œä½¿å¾—åœºæ™¯
ä¸­ä¸å…‰ç…§èŠ‚ç‚¹çš„çº¹ç†é‡å çš„åŒºåŸŸä¸è¢«è°ƒåˆ¶å½±å“ã€‚

- **CanvasModulate** é€šè¿‡é¢œè‰²è°ƒåˆ¶ä½¿åœºæ™¯å˜æš—ï¼Œæˆ–è€…è°ƒåˆ¶æˆä»»ä½•å¸Œæœ›çš„è‰²è°ƒã€‚
- **Sprite** è®¾ç½®çº¹ç†æ˜¾ç¤ºç¯å…‰æ–‘ç‚¹ã€èƒŒæ™¯å’Œé˜´å½±æŠ•å°„å™¨ï¼Œå…¶çº¹ç†æœ¬èº«ä¸ä¼šèƒ½å‚ä¸å…‰çº¿çš„è®¡ç®—ã€‚
- **Light2D** ç…§äº®åœºæ™¯ï¼ŒäºŒç»´ç¯å…‰é€šå¸¸çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œåœ¨åœºæ™¯çš„å…¶ä½™éƒ¨åˆ†æ·»åŠ é€‰å®šçš„çº¹ç†ä»¥æ¨¡æ‹Ÿç…§æ˜ã€‚ä½†å®ƒä¹Ÿå¯ä»¥ä»¥å…¶ä»–æ–¹å¼ä½¿ç”¨ï¼Œä¾‹å¦‚æ©ç›–åœºæ™¯çš„æŸäº›éƒ¨åˆ†ã€‚
- **LightOccluder2D** ç”¨äºå‘Šè¯‰ç€è‰²å™¨åœºæ™¯çš„å“ªäº›éƒ¨åˆ†æŠ•å°„é˜´å½±ã€‚é˜´å½±ä»…æ˜¾ç¤ºåœ¨ Light2D è¦†ç›–çš„åŒºåŸŸä¸Šï¼Œå…¶æ–¹å‘åŸºäºç¯å…‰çš„ä¸­å¿ƒã€‚

![2D lights and shadows demo](https://docs.godotengine.org/en/3.5/_images/light_shadow_main.png)

Sprite æœ¬èº«ä¸ä¼šæŠ•èº«é˜´å½±ï¼Œåªç”¨äºè®¾ç½®åœºæ™¯éœ€è¦çš„çº¹ç†ï¼Œä½†ä¼šå—åˆ° CanvasModulate çš„è°ƒåˆ¶ã€‚é˜´å½±æœ¬èº«éœ€è¦
é€šè¿‡ LightOccluder2D èŠ‚ç‚¹è®¾ç½® OccluderPolygon2D å¤šè¾¹å½¢æ¥å†³å®š Light2D è¦†ç›–èŒƒå›´å†…çš„é˜´å½±æŠ•å°„ã€‚
LightOccluder2D æä¾›äº†ä¸€ä¸ª Show Behind Parent é€‰é¡¹ï¼Œæ‰€ä»¥å¯ä»¥ä½œä¸º Sprite å­èŠ‚ç‚¹ä»¥æ˜¾ç¤ºåœ¨çˆ¶
èŠ‚ç‚¹çº¹ç†çš„åº•å±‚ï¼Œé¿å…ç”¨äºæŠ•å°„é˜´å½±çš„å¤šè¾¹å½¢é®æŒ¡å†…å®¹ã€‚

é˜´å½±æŠ•å°„åŒºå¤šè¾¹éœ€è¦æ‰‹åŠ¨ç»˜åˆ¶ï¼Œä¸èƒ½ç»“åˆ Inkscape è¿™ç±»å·¥å…·æä¾›çš„ Trace Bitmap åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆçš„çŸ¢é‡å›¾ã€‚
æˆ–è€…æ²¡æä¾›åƒ Blender é‚£æ ·çš„ç”»ç¬”ç»˜åˆ¶æ›²çº¿çš„ç¼–è¾‘å™¨ã€‚

Light2D é€šè¿‡çº¹ç†æ¥å»ºç«‹å…‰æºçš„å„ç§å±æ€§ï¼Œä¸»è¦æ˜¯å…‰æºçš„é¢œè‰²ã€è¾å°„èŒƒå›´ã€‚çº¹ç†å°ºå¯¸è¶Šå¤§ï¼Œæˆ–è€… Scale è¶Šå¤§ï¼Œ
å…‰çº¿ç…§å°„åˆ°çš„èŒƒå›´è¶Šå¹¿ã€‚å¯ä»¥ä½¿ç”¨å›¾åƒçº¹ç†ä½œï¼Œæˆ–è€…ä½¿ç”¨ AnimatedTexture è¿™æ ·çš„åŠ¨ç”»çº¹ç†ï¼Œä»¥äº§ç”Ÿäº¤æ›¿çš„
ç¯å…‰æ•ˆæœã€‚å…‰æºçº¹ç†çš„ä¸€èˆ¬åˆ¶ä½œï¼Œä½¿ç”¨ä¸­å¿ƒæ”¾å°„è¿‡æ¸¡çš„çº¯è‰²ï¼Œä¸­å¿ƒé€æ˜åº¦ä½è¡¨ç¤ºå…‰ç…§å¼ºï¼Œå‘¨è¾¹é€æ˜åº¦é«˜è¡¨ç¤ºå¼±å…‰ç…§ã€‚
é€šè¿‡çº¹ç†åˆ¶ä½œï¼Œå¯ä»¥æ¨¡æ‹Ÿæ•£å…‰ç¯ã€å°„ç¯æˆ–è€…èšå…‰ç¯ï¼Œå…‰æºä¹Ÿæä¾› Colorã€Energyã€Modeã€Height ç­‰è°ƒåˆ¶å±æ€§ã€‚

è™½ç„¶ï¼Œå…‰æºå¯ä»¥è®¾ç½® Height æ¥ä¸ Sprite ä¸­çš„æ³•çº¿è´´å›¾è¿›è¡Œå…‰çº¿çš„äº¤äº’ï¼Œä½† LightOccluder2D å´æ²¡æœ‰
æä¾›é«˜åº¦å±æ€§ï¼Œæ‰€ä»¥å…‰æºå§‹ç»ˆè¢«å¤šè¾¹å½¢åˆ†éš”ä¸ºå†…å¤–ä¸¤ä¸ªåŒºï¼Œåœ¨å¤šè¾¹å½¢å¤–é¢ã€å†…é¢çš„å…‰çº¿ä¸ä¼šç©¿é€å¤šè¾¹å½¢ã€‚

2D å…‰æºå¯ä»¥ä½¿ç”¨ 20 ä¸ªç¯å…‰åˆ†å±‚ç®¡ç†å…‰çº¿äº¤äº’ã€é˜´å½±æŠ•å°„ï¼Œåªæœ‰å…‰æºä¸­ Rangeã€Shadow è®¾ç½®çš„ **Item Cull**
é®ç½©å±‚ä¸ CanvasItemã€LightOccluder2D ä¸­çš„ **Light Mask** ä½¿ç”¨äº†ä¸€è‡´çš„åˆ†å±‚ï¼Œå®ƒä»¬æ‰ä¼šä¸ç›¸åº”çš„
å…‰æºã€é˜´å½±äº§ç”Ÿäº¤äº’æ•ˆæœã€‚Light Mask é®ç½©å±æ€§åœ¨ç¼–ç¨‹æŠ€æœ¯ä¸Šï¼Œä½¿ç”¨çš„æ˜¯ bit ä½è®°å½•åˆ†å±‚ä¿¡æ¯ã€‚å…‰æºä¸ç‰©ä½“åœ¨
åŒä¸€ä¸ªæ¯”ç‰¹ä½ç½® 1 è¡¨ç¤ºå®ƒä»¬æ˜¯åŒå±‚äº¤äº’å…³ç³»ï¼Œåº”è¯¥äº§ç”Ÿå…‰çº¿äº¤äº’æ•ˆæœã€‚

Godot æ”¯æŒ Percentage Closer Filtering (PCF)ï¼Œè¿™æ˜¯ä¸€ç§é˜´å½±è´´å›¾çš„æŠ—é”¯é½¿ä¼˜åŒ–ç®—æ³•æŠ€æœ¯ã€‚

é˜´å½±è´´å›¾ shadow mapping æ˜¯ä¸€ç§ç”¨äºå½±ç‰‡å›¾åƒçš„é«˜ç«¯æ¸²æŸ“æŠ€æœ¯ï¼Œä½†æ˜¯åœ¨å®æ—¶çš„è§†é¢‘æ¸¸æˆä¸­ï¼Œä¼šå‡ºç°ä¸¥é‡çš„
é”¯é½¿åŒ–é—®é¢˜ã€‚å¹¶ä¸”ï¼Œå½“å…‰çº¿å‡ ä¹å¹³è¡Œäºé˜´å½±è¡¨é¢ä¼ æ’­æ—¶ï¼Œä½¿ç”¨é€è§†é˜´å½±è´´å›¾æŠ€æœ¯å’Œå¢åŠ é˜´å½±è´´å›¾åˆ†è¾¨ç‡å¹¶ä¸èƒ½è§£å†³
é”¯é½¿é—®é¢˜ï¼Œå› ä¸ºæ”¾å¤§ç‡æ¥è¿‘æ— ç©·å¤§ã€‚é«˜ç«¯æ¸²æŸ“è½¯ä»¶é€šè¿‡ä½¿ç”¨ä¸€ç§ç§°ä¸º PCF ç™¾åˆ†æ¯”æ¸è¿›æ»¤æ³¢çš„æŠ€æœ¯æ¥è§£å†³æ··å é—®é¢˜ã€‚

ä¸æ³•çº¿çº¹ç†ä¸åŒï¼Œé˜´å½±è´´å›¾ä¸èƒ½é¢„è¿‡æ»¤å»æ¶ˆé™¤é”¯é½¿ã€‚ç›¸åï¼Œæ¯ä¸ªåƒç´ éƒ½è¦è¿›è¡Œå¤šä¸ªé˜´å½±è´´å›¾çš„æ¯”è¾ƒï¼Œæ±‚å¹³å‡å€¼ã€‚
è¿™ç§æŠ€æœ¯è¢«ç§°ä¸º PCFï¼Œå› ä¸ºå®ƒè®¡ç®—çš„æ˜¯æ›´æ¥è¿‘å…‰çº¿çš„æ›²é¢çš„ç™¾åˆ†æ¯”ï¼Œè€Œä¸æ˜¯åœ¨é˜´å½±ä¸­ã€‚

![Figure 11-1 Percentage-Closer Filtering](https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems/elementLinks/fig11-01.jpg)

åŸå§‹ PCF ç®—æ³•è¦æ±‚å°†è¦ç€è‰²çš„åŒºåŸŸæ˜ å°„åˆ°é˜´å½±è´´å›¾ç©ºé—´ï¼Œå¹¶éšæœºé‡‡æ ·è¯¥åŒºåŸŸã€‚è¯¥ç®—æ³•é¦–å…ˆç”± REYES æ¸²æŸ“å¼•æ“
å®ç°ï¼Œå› æ­¤è¦ç€è‰²çš„åŒºåŸŸæ„å‘³ç€å››è¾¹çš„å¾®å¤šè¾¹å½¢ã€‚

ä¸€èˆ¬ç‚¹å…‰æºä¼šç”Ÿæˆç¡¬é˜´å½±ï¼Œè€Œé¢å…‰æºåˆ™ä¼šç”Ÿæˆè½¯é˜´å½±ã€‚å½“é®æŒ¡ç‰©è¶Šæ¥è¿‘å…‰çº¿æ¥å—ç‰©ä½“ï¼Œä¼šè¶‹å‘äºç”Ÿæˆæ›´ç¡¬çš„é˜´å½±ï¼Œ
è¿œç¦»çš„æ—¶å€™ï¼Œä¼šè¶‹å‘äºç”Ÿæˆæ›´è½¯çš„é˜´å½±ã€‚è°ƒæ•´ filter, filter smooth, gradient length ç­‰å±æ€§æ”¹å˜
é˜´å½±çš„è½¯ç¡¬ç¨‹åº¦ã€‚




### ğŸŸ ğŸ”µ 3D SpatialMaterial ç©ºé—´æè´¨
- [Material Maker by R0dZill4](https://godotengine.org/showcase/material-maker/)
- [Standard Material 3D and ORM Material 3D](https://docs.godotengine.org/en/latest/tutorials/3d/standard_material_3d.html)
- [Godot 4 Alpha æ£®æ—åˆ¶ä½œ](https://www.bilibili.com/video/BV1p54y1f7Lf/)
- [Vertex displacement with shaders](https://docs.godotengine.org/en/3.0/tutorials/3d/vertex_displacement_with_shaders.html)
- [Your 1st 3D shader](https://docs.godotengine.org/en/latest/tutorials/shaders/your_first_shader/your_first_3d_shader.html)

Godot 3D å‡ ä½•èŠ‚ç‚¹æä¾›äº†ä¸¤ä¸ªè®¾ç½®æè´¨çš„å±æ€§ï¼š

- Material Override - The material override for the whole geometry.
- Material Overlay - The material overlay for the whole geometry.

Override å’Œ Overlay ä¸¤ç§æ–¹å¼çš„å·®åˆ«æ˜¯ï¼Œå‰è€…ä¼šè¦†ç›–æ•´ä¸ªå‡ ä½•ä½“ï¼Œæ›¿ä»£æ‰€æœ‰ matereial slot ä¸­çš„æè´¨ï¼Œ
åè€…åˆ™æ˜¯å åŠ åœ¨ä¸€èµ·ï¼Œåœ¨æ‰€æœ‰æ›²é¢çš„ä»»ä½•å…¶ä»–æ´»åŠ¨æè´¨ä¹‹ä¸Šæ¸²æŸ“è¯¥æè´¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ Sprite3D ä¸Šä½¿ç”¨ Texture
å¯èƒ½ä¼šè¦†ç›–æ‰ Overlay çš„æè´¨ï¼Œå¦‚æœçº¹ç†å›¾å®Œå…¨ä¸é€æ˜ã€‚åè¿‡æ¥å¯¹äº Overrideï¼Œçº¹ç†å›¾åˆ™å¯è¢«è¦†ç›–æ‰ã€‚


Godot 3.x æè´¨å¯¹è±¡ä¸å¤šï¼Œåªæœ‰ 4 ä¸ªç±»åˆ«ï¼š

- CanvasItemMaterial
- ParticlesMaterial
- ShaderMaterial
- SpatialMaterial

Godot 4.x å’Œæ—§ç‰ˆæœ¬çš„æè´¨å¯¹è±¡æœ‰äº›å·®åˆ«ï¼ŒåŒ…å«åç§°ä¸Šçš„å˜åŒ–å’Œæ–°å¢çš„æè´¨ã€‚

æè´¨åŸºç±» `Material` ä¸‹æœ‰ä¸¤å¥—å­ç±»å‹ï¼Œä¸€å¥—æ˜¯ç»ç”± BaseMaterial3D è¡ç”Ÿçš„ç©ºé—´æè´¨ï¼ŒåŒ…æ‹¬ï¼š

- `ORMMaterial3D` å’Œæ ‡å‡†ç©ºé—´æè´¨åŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯é®æŒ¡ã€ç²—ç³™åº¦å’Œé‡‘å±ç­‰é€šé“åªä½¿ç”¨åŒä¸€ä¸ª ORM çº¹ç†ï¼›
- `StandardMaterial3D` æ ‡å‡†ç©ºé—´æè´¨å¯¹åº”æ—§ç‰ˆæœ¬çš„ `SpatialMaterial`ï¼›

Godot 4 æè´¨æ–°å¢ `ORMMaterial3D` æè´¨ï¼Œå®ƒå‡ ä¹å’Œæ ‡å‡† BaseMaterial3D æè´¨å®Œå…¨ç›¸åŒï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒã€‚
æ²¡æœ‰ä¸ºé®æŒ¡ã€ç²—ç³™åº¦å’Œé‡‘å±è®¾ç½®å•ç‹¬çš„è®¾ç½®å’Œçº¹ç†ï¼Œè€Œä½¿ç”¨ä¸€ä¸ª ORM çº¹ç†ï¼Œè¯¥çº¹ç†çš„ä¸åŒé¢œè‰²é€šé“ç”¨äºæ¯ä¸ªå‚æ•°ã€‚
è¯¸å¦‚ Substance Painter å’Œ Armor Paint ä¹‹ç±»çš„ç¨‹åºæä¾›äº†è¿™ç§æ ¼å¼å¯¼å‡ºçš„é€‰é¡¹ï¼Œè¿™ä¸¤ä¸ªç¨‹åºå…·æœ‰ç”¨äº
è™šå¹»å¼•æ“çš„å¯¼å‡ºé¢„è®¾ï¼Œè¯¥å¼•æ“ä¹Ÿä½¿ç”¨ ORM çº¹ç†ã€‚é€šè¿‡ Physically based rendering (PBR) æè´¨å¯ä»¥å°†
ORM çº¹ç†åº”ç”¨äº 3D å¯¹è±¡ï¼Œè¿™ä¹Ÿå°±æ˜¯ `ORMMaterial3D` æè´¨å¯¹è±¡çš„åŠŸèƒ½ã€‚

å¦ä¸€å¥—æ˜¯ç»§æ‰¿ `Material` çš„ä¸“ç”¨æè´¨ï¼š

- `CanvasItemMaterial` ç”»å¸ƒå¯¹è±¡æè´¨ï¼Œæ˜¯åº”ç”¨äº CanvasItem å¯¹è±¡çš„äºŒç»´æè´¨ï¼Œå¯ä»¥ä½¿ç”¨ç€è‰²å™¨æè´¨æ·±å…¥è‡ªå®šä¹‰ã€‚
- `FogMaterial` ä½“ç§¯é›¾æè´¨ï¼Œé…åˆ `FogVolume` èŠ‚ç‚¹ä½¿ç”¨ã€‚
- `PanoramaSkyMaterial` å¯¹åº”æ—§ç‰ˆçš„ PanoramaSky èµ„æºç±»å‹ã€‚
- `ParticleProcessMaterial` ä¸º GPU ç²’å­ç³»ç»Ÿå¤„ç†ç²’å­å±æ€§ï¼Œ`GPUParticles3D` å’Œ `GPUParticles2D`ã€‚
- `PhysicalSkyMaterial` æ–°å¢çš„åŸºäºç‰©ç†çš„å¤©ç©ºæè´¨ï¼Œå…‰æºå±æ€§æ¥è‡ªåœºæ™¯æ ‘ä¸­ç¬¬ä¸€ä¸ª `DirectionalLight3D` èŠ‚ç‚¹ã€‚
- `PlaceholderMaterial` æè´¨å ä½ç¬¦ï¼Œå¹¶éæ˜¯çœŸæ­£çš„æè´¨ï¼Œè€Œæ˜¯ç”¨äºè§£å†³æè´¨åŠ è½½çš„å·¥å…·ã€‚
- `ProceduralSkyMaterial` å¯¹åº”æ—§ç‰ˆçš„ ProceduralSky èµ„æºç±»å‹ã€‚
- `ShaderMaterial` ç€è‰²å™¨æè´¨ï¼Œå¯ä»¥è¿›è¡Œç€è‰²å™¨ç¼–ç¨‹å¼€å‘ã€‚

å…¶ä¸­ï¼Œ`ShaderMaterial` ç€è‰²å™¨æè´¨æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç§ï¼Œå®ƒå¯ä»¥è¿›è¡Œç€è‰²å™¨ç¼–ç¨‹å¼€å‘ï¼Œå¯ä»¥å®šåˆ¶å„ç§ç‰¹æ•ˆã€‚

æ³¨æ„ï¼Œå¤©ç©ºæè´¨ä¸­çš„å¤ªé˜³è§’åº¦ï¼Œéœ€è¦é€šè¿‡ `DirectionalLight3D` èŠ‚ç‚¹çš„æ—‹è½¬è°ƒæ•´å¤ªé˜³é«˜åº¦è§’ã€‚

éƒ¨åˆ†æ–°å¢çš„æè´¨å¯¹è±¡ï¼Œåœ¨æ—§ç‰ˆæœ¬ä¹Ÿæœ‰ç›¸åº”çš„ç±»å‹ï¼Œåªä¸è¿‡ä¸æ˜¯æè´¨ç±»å‹ï¼Œä¾‹å¦‚ PanoramaSky å’Œ ProceduralSkyï¼Œ
å®ƒç”¨äºä¸º `WorldEnvironment` ç¯å¢ƒèŠ‚ç‚¹æä¾›å¤©ç©ºç¯å¢ƒæè´¨è®¾ç½®ï¼Œé€šè¿‡ `Environment` èµ„æºåˆ›å»ºå¤©ç©ºç¯å¢ƒã€‚

å½“ä½¿ç”¨ `Material` å­ç±»çš„é¡¹ç›®å‡ºç°ä»¥ä¸‹ä¸¤ç§åŠ è½½æ¡ä»¶æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨æè´¨å ä½ç¬¦ï¼š

- åœ¨ä¸“ç”¨æœåŠ¡å™¨æ¨¡å¼ä¸‹è¿è¡Œå¯¼å‡ºçš„é¡¹ç›®æ—¶ï¼Œä»…ä¿ç•™çº¹ç†çš„å°ºå¯¸ï¼Œå¯ç”¨äºæ¸¸æˆç›®çš„æˆ–å…¶ä»–å…ƒç´ çš„å®šä½ï¼Œå¹¶æ˜¾è‘—å‹ç¼©å¯¼å‡ºçš„ PCK æ–‡ä»¶ã€‚
- å½“è¯¥å­ç±»ç”±äºä½¿ç”¨ä¸åŒçš„å¼•æ“ç‰ˆæœ¬æˆ–æ„å»ºè€Œä¸¢å¤±æ—¶ï¼ˆä¾‹å¦‚æ¨¡å—ç¦ç”¨ï¼‰ã€‚


Material Maker æ˜¯åŸºäº Godot å¼€å‘çš„ä¸€æ¬¾ç¨‹åºåŒ–æè´¨ç¼–è¾‘å™¨ï¼Œå®ƒæ”¯æŒä¸º Godotã€Unityã€Unreal ç­‰å¼•æ“
å¯¼å‡ºç¼–è¾‘å¥½çš„ç¨‹åºåŒ–æè´¨ï¼Œä¹Ÿå¯ä»¥ä¸º Blender å¯¼å‡º EXR æ ¼å¼æè´¨ã€‚EXR æ˜¯ä¸€ç§å¤šå±‚çš„å¯Œä¿¡æ¯å›¾åƒæ ¼å¼ï¼Œéå¸¸
æ–¹ä¾¿ç”¨äºåˆæˆã€åæœŸå¤„ç†ã€‚EXR èƒ½å¤Ÿå­˜å‚¨é«˜åŠ¨æ€èŒƒå›´ï¼Œå¸¸è§„å›¾åƒæ–‡ä»¶æ ¼å¼å¦‚ JPEG æˆ– PNG ä¿å­˜çš„æ˜¯ä½åŠ¨æ€èŒƒå›´ã€‚
è¿™æ„å‘³ç€ EXR å¯ä»¥ä½¿ç”¨é«˜åŠ¨æ€èŒƒå›´ï¼Œä»å›¾åƒçš„å®Œå…¨ç™½è‰²æˆ–å®Œå…¨é»‘è‰²åŒºåŸŸæ£€ç´¢ä¿¡æ¯ã€‚

Material Maker 1.2 å¯¼å‡º Godot æè´¨æ ¼å¼ä¸º `.tres`ï¼Œæ˜¯ä¸€ä¸ªé…ç½®å¥½çš„ SpatialMaterial æè´¨ï¼Œå¯ä»¥ç›´æ¥
ç»™ MeshInstance èŠ‚ç‚¹ä½¿ç”¨ã€‚æ ¹æ® Godot ç‰ˆæœ¬ï¼Œæœ‰ä¸‰ç§å¯¼å‡ºæ–¹å¼ï¼š

- Godot 3 Spatial ä¸‰ç»´ç©ºé—´æè´¨ï¼›
- Godot 4 ORM 
- Godot 4 Standard Spatial æ ‡å‡†ä¸‰ç»´ç©ºé—´æè´¨ï¼›

EXR ä¹Ÿæ˜¯ Blender é»˜è®¤æ”¯æŒå¯¼å…¥ã€å¯¼å‡ºçš„ä¸€ç§å›¾åƒæ ¼å¼ï¼Œå¯ä»¥é€šè¿‡ Blender è¾“å‡ºå±æ€§é¢æ¿ï¼Œè®¾ç½®è¾“å‡ºæ ¼å¼ä¸º
OpenEXR æˆ–è€… OpenEXR MultiLayerï¼Œå³å¯ä»¥æ¸²æŸ“å¾—åˆ° EXR å›¾åƒæ–‡ä»¶ã€‚å¯ä»¥å°† EXR æ–‡ä»¶æ‹–æ”¾åˆ° Shading
ç€è‰²å™¨ç¼–è¾‘å™¨ä¸­ï¼ŒImage Texture èŠ‚ç‚¹ä¼šè‡ªåŠ¨ç”Ÿæˆï¼ŒMaterial Maker å¯¼å‡ºçš„ä¸‰ä¸ª EXR å¯ä»¥åšä»¥ä¸‹è¿æ¥ï¼Œ
ä»¥è‡ªå¸¦çš„ beehive èœ‚å·¢è¿™ä¸ªç¨‹åºåŒ–æè´¨å¯¼å‡ºçš„æ–‡ä»¶ä¸ºä¾‹ï¼š

- beehive_metal.exr ä¸»æè´¨å›¾åƒï¼Œè¿æ¥åˆ° Principle BSDF æè´¨èŠ‚ç‚¹çš„ BaseColor ç«¯å£ï¼›
- beehive_rough.exr ç²—ç³™åº¦å›¾åƒï¼Œè¿æ¥åˆ° Principle BSDF æè´¨èŠ‚ç‚¹çš„ Roughness ç«¯å£ï¼›
- beehive_displace.exr ç½®æ¢è´´å›¾ï¼Œè¿æ¥åˆ° Material Output æè´¨è¾“å‡ºèŠ‚ç‚¹çš„ Displacement ç«¯å£ï¼›

ä½¿ç”¨ Irfanview å·¥å…·ï¼Œå®‰è£…ç›¸åº”çš„ Exr.dll æ’ä»¶å³å¯ä»¥æŸ¥çœ‹ EXR æè´¨å›¾åƒã€‚


æè´¨ä¸­ Height ç”¨äºå¯ç”¨è§†å·®é«˜åº¦è´´å›¾ï¼Œå’Œ Normal Mapping ç±»ä¼¼ï¼Œæ˜¯ç”¨äºæ”¹å˜è¡¨é¢å…‰çº¿ç»†èŠ‚çš„è´´å›¾ã€‚
Godot 3.5 ä¸­ä½¿ç”¨ Depth å±æ€§è¡¨ç¤ºè§†å·®è´´å›¾ã€‚

å¦ä¸€ç§ç”¨äºåœ°å½¢åˆ¶ä½œçš„ç½®æ¢è´´å›¾ï¼ŒDisplacement Mappingï¼ŒGodot æ²¡æœ‰ç›´æ¥åœ¨æè´¨ä¸­æä¾›è®¾ç½®ï¼Œè€Œåªèƒ½
é€šè¿‡ç€è‰²å™¨æ¥å®ç°ï¼Œå³éœ€è¦åˆ›å»ºç€è‰²å™¨æè´¨ï¼Œå¯¹å‡ ä½•ä½“çš„é¡¶ç‚¹è¿›è¡Œç›´æ¥å¤„ç†ã€‚




### ğŸŸ ğŸ”µ Procedural geometry å‡ ä½•ä½“å¤„ç†
- [Procedural geometry](https://docs.godotengine.org/en/latest/tutorials/3d/procedural_geometry/index.html)
- [Prototyping levels with CSG](https://docs.godotengine.org/en/3.5/tutorials/3d/csg_tools.html)
- [3D Voxel Demo](https://godotengine.org/asset-library/asset/676)
- https://docs.godotengine.org/en/latest/tutorials/3d/procedural_geometry/arraymesh.html

å‡ ä½• Geometry æ˜¯ä¸€ä¸ªæ•°å­¦æ¦‚å¿µï¼Œåœ¨ Godot ä¸­ä½¿ç”¨ Mesh æ¥è¡¨è¾¾å‡ ä½•ï¼Œä¹Ÿå°±å±å¹•ä¸Šçœ‹åˆ°çš„å„ç§ä¸‰ç»´å¯¹è±¡ã€‚
å‡ ä½•ä½“åŒ…å«ä¸€ç³»åˆ—çš„é¡¶ç‚¹ vertices æ•°æ®ï¼Œé¡¶ç‚¹å¯ä»¥æ„å»ºæˆä¸‰è§’é¢ï¼Œè¿›è€Œå½¢æˆ Mesh ç½‘æ ¼ä½“å¹¶è¡¨ç°å‡ ä½•ä½“ã€‚

æ¦‚æ‹¬æ¥è¯´ï¼ŒMesh åŒ…å«ä¸€ç»„ç”±é¡¶ç‚¹æ•°æ®å®šä¹‰çš„æ›²é¢ Surfacesï¼Œè€Œæ¯ä¸ªæ›²é¢ç”±ä¸€ä¸ªå¤šç»´æ•°ç»„å®šä¹‰ï¼Œç»„åˆäº†é¡¶ç‚¹åæ ‡ã€
æ³•çº¿ã€UVåæ ‡ç­‰ç­‰ä¿¡æ¯ã€‚

Godot æä¾›äº†å¤šç§ç±»å‹æ¥å¤„ç†å‡ ä½•ä½“ï¼Œé€šè¿‡ä¿®æ”¹å‡ ä½•ä½“çš„æ•°æ®å¯ä»¥å¾—åˆ°ä»»æ„ç»“æ„çš„å‡ ä½•å¯¹è±¡ï¼Œè¿™äº›å·¥å…·åŒ…æ‹¬ï¼š

- `ArrayMesh` èµ„æºç±»å‹æä¾›é¡¶ç‚¹æ•°æ®è®¿é—®ï¼Œå¹¶é€šè¿‡è„šæœ¬æ„å»º Mesh æ›²é¢çš„èƒ½åŠ›ï¼Œæ˜¯æœ€åŸºç¡€çš„å‡ ä½•å¤„ç†å·¥å…·ã€‚
- `MeshDataTool` å¼•ç”¨ç±»å‹æä¾›å°† Mesh è½¬æ¢ä¸º vertices, faces, edges å¹¶åœ¨è¿è¡Œæ—¶ç¼–è¾‘çš„èƒ½åŠ›ï¼›
- `SurfaceTool` å¼•ç”¨ç±»å‹æä¾› OpenGL 1.x ç«‹å³æ¨¡å¼é£æ ¼çš„ API æ„é€ ç½‘æ ¼çš„èƒ½åŠ›ï¼Œç±»ä¼¼ `ImmediateMesh` èŠ‚ç‚¹ï¼›
- `ImmediateMesh` èŠ‚ç‚¹ç±»å‹æä¾›ä»¥ç«‹å³æ¨¡å¼é£æ ¼ç»˜åˆ¶ç½‘æ ¼çš„èƒ½åŠ›ï¼Œä½†åªç”¨äºåŸå‹ä¸­ï¼Œå› ä¸ºæ¯ä¸€å¸§å…¶å‡ ä½•ä½“éƒ½ä¼šé‡å»ºï¼›

SurfaceTool å’Œ ArrayMesh å¯ä»¥æ„é€ ä¸éœ€è¦æ¯ä¸€å¸§éƒ½éœ€è¦æ”¹å˜çš„é™æ€ç½‘æ ¼ï¼Œåè€…é€Ÿåº¦æ›´å¿«ï¼Œå‰è€… API æ›´æ˜“ç”¨ï¼Œ
MeshDataTool ä¹Ÿä¸å¿«ï¼Œä½†æ˜¯å¯ä»¥æä¾›è¾¹é¢ç›¸å…³çš„ APIã€‚

SurfaceTool å¯ä»¥é€šè¿‡ç›´æ¥æ·»åŠ é¡¶ç‚¹æˆ–è€…ä½¿ç”¨é¡¶ç‚¹ç´¢å¼•æ¥æ„é€ å‡ ä½•ä½“ï¼Œæœ€åé€šè¿‡ commit() è¿”å› ArrayMeshï¼š

```py
    void begin(primitive: PrimitiveType)

    void set_bones(bones: PackedInt32Array)
    void set_color(color: Color)
    void set_uv(uv: Vector2)

    void add_index(index: int)
    void add_vertex(vertex: Vector3)
    
    ArrayMesh commit(existing: ArrayMesh = null, flags: int = 0)
```

Godot 4.x ç›®å‰åªæ”¯æŒåœ¨ CPU ä¸Šä¿®æ”¹å‡ ä½•ä½“ï¼Œè€Œä¸æ”¯æŒ GPU ä¸Šçš„å‡ ä½•ä¿®æ”¹ã€‚

Godot ç³»ç»Ÿä¸­ Mesh æ˜¯èµ„æºç±»å‹ï¼Œå¯ä»¥æä¾›å‡ ä½•ä½“çš„æ•°æ®ï¼Œè€Œå°†æ•°æ®è¡¨è¾¾ä¸ºå‡ ä½•ä½“åˆ™é€šè¿‡ MeshInstance3D
æˆ–è€… MultiMeshInstance3D è¿™äº›èŠ‚ç‚¹æ¥å®ç°ã€‚

 the Mesh, the ArrayMesh, the MeshInstance3D, the MultiMesh, and the MultiMeshInstance3D. 
 While they are all related, they have slightly different uses.

- `ArrayMesh` é¡¶ç‚¹æ•°ç»„èµ„æºï¼Œæä¾›é¡¶ç‚¹çº§åˆ«çš„å‡ ä½•è¡¨é¢æ“ä½œã€‚
- `ImmediateMesh` å¯¹åº”æ—§ç‰ˆæœ¬çš„ ImmediateGeometry èŠ‚ç‚¹ã€‚
- `PlaceholderMesh` Godot 4.x æ–°å¢çš„ Mesh å ä½èŠ‚ç‚¹ã€‚
- `PrimitiveMesh` å¸¸ç”¨çš„åŸºæœ¬å‡ ä½•ä½“çš„ç½‘æ ¼å¯¹è±¡ï¼Œå®šä¹‰åœ¨æºä»£ç  scene\resources\primitive_meshes.cppã€‚
    - BoxMesh çŸ©å½¢ç›’å­ï¼›
    - CapsuleMesh èƒ¶å›Šä½“ï¼›
    - CylinderMesh åœ†æŸ±ä½“ï¼›
    - PlaneMesh å¹³é¢ï¼›
    - PointMesh å•ä¸ªé¡¶ç‚¹åŸºæœ¬ä½“ï¼›
    - PrismMesh æ£±é•œï¼›
    - RibbonTrailMesh å¸¦çŠ¶è½¨è¿¹ï¼›
    - SphereMesh çƒä½“ï¼›
    - TextMesh æ–‡æœ¬ç½‘æ ¼ï¼›
    - TorusMesh åœ†ç¯ï¼›
    - TubeTrailMesh ç®¡é“è½¨è¿¹ï¼›

PointMesh æ˜¯åªæœ‰å•ä¸ªé¡¶ç‚¹çš„åŸºæœ¬ä½“ï¼Œå®ƒç”šè‡³éƒ½ä¸èƒ½å«åš Meshï¼Œä½†æ˜¯å…‰æ …åŒ–æ—¶å®ƒå°±æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ–¹å—ï¼Œ
Rectangleï¼Œæ³¨æ„ä¸æ˜¯æœ‰å››ä¸ªé¡¶ç‚¹çš„é‚£ç§çŸ©å½¢ï¼Œå®ƒå¯ä»¥ç”¨äºç²’å­ç³»ç»Ÿã€‚


å¦å¤–ï¼Œ`MultiMesh` æ˜¯ä¸€ç§ä½¿ç”¨ GPU æ‰¹é‡å®ä¾‹åŒ–ä»¥æä¾›ç½‘æ ¼çš„é«˜æ€§èƒ½ç»˜å›¾çš„èµ„æºç±»å‹ã€‚

`ArrayMesh` ä¸­é¡¶ç‚¹ä½¿ç”¨çš„æ•°æ®ç±»å‹å®šä¹‰åœ¨ Mesh.ArrayType æšä¸¾ç±»å‹ä¸­ï¼Œå¯¹åº”çš„æ•°æ®ç±»å‹å¦‚ä¸‹ï¼š

| Index | Mesh.ArrayType Enum |                               Array type                              |
|-------|---------------------|-----------------------------------------------------------------------|
|     0 | ARRAY_VERTEX        | PackedVector3Array or PackedVector2Array                              |
|     1 | ARRAY_NORMAL        | PackedVector3Array                                                    |
|     2 | ARRAY_TANGENT       | PackedFloat32Array of groups of 4 floats.                             |
|     3 | ARRAY_COLOR         | PackedColorArray                                                      |
|     4 | ARRAY_TEX_UV        | PackedVector2Array or PackedVector3Array                              |
|     5 | ARRAY_TEX_UV2       | PackedVector2Array or PackedVector3Array                              |
|    10 | ARRAY_BONES         | PackedFloat32Array or PackedInt32Array of groups of 4 floats or ints. |
|    11 | ARRAY_WEIGHTS       | PackedFloat32Array of groups of 4 floats.                             |
|    12 | ARRAY_INDEX         | PackedInt32Array                                                      |

``ARRAY_TANGENT`` ä½¿ç”¨ `PackedFloat32Array` æ•°æ®ç±»å‹ï¼Œæ¯ç»„å…± 4 ä¸ªæµ®ç‚¹æ•°ï¼Œå‰é¢ 3 ä¸ªæµ®ç‚¹å€¼
å†³å®šåˆ‡æ¢å‘é‡ï¼Œæœ€åä¸€ä¸ªæµ®ç‚¹å€¼ä¸ºå‰¯æ³•çº¿æ–¹å‘ï¼Œå€¼ä¸º -1 æˆ– 1ã€‚

``ARRAY_BONES`` ä½¿ç”¨ `PackedFloat32Array` æˆ– `PackedInt32Array` æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå€¼
ä¸€ç»„ï¼Œæ¯ç»„åŒ…å«å½±å“æŒ‡å®šé¡¶ç‚¹çš„ 4 ä¸ªéª¨éª¼çš„ç´¢å¼•ã€‚

``ARRAY_WEIGHTS``ä½¿ç”¨ `PackedFloat32Array` æ•°æ®ç±»å‹ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå€¼ä¸€ç»„ï¼Œæ¯ä¸ªæµ®ç‚¹å€¼åŒ…å«æƒé‡ï¼Œ
å¯¹åº”äº†``ARRAY_BONES``ä¸­ä¸é¡¶ç‚¹å…³è”çš„éª¨éª¼ã€‚


ä¾‹å¦‚ï¼Œé€šè¿‡åŸºæœ¬çš„åœ†æŸ±ä½“å®ä¾‹çš„é¡¶ç‚¹æ•°æ®ï¼Œç»“åˆ ArrayMesh é‡æ„å‡ºå¦ä¸€ä¸ªåœ†æŸ±ä½“ï¼š

```py
var c = CylinderMesh.new()
var arr_mesh = ArrayMesh.new()
arr_mesh.add_surface_from_arrays(Mesh.PRIMITIVE_TRIANGLES, c.get_mesh_arrays())
```

ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç é€šè¿‡ ArrayMesh æ„é€ å‡ ä½•ä½“ï¼Œæ˜¯ä¸€ä¸ªä¸‰è§’å½¢ï¼Œå¹¶æ·»åŠ åˆ°åœºæ™¯æ ‘ä¸­ï¼š

```py
var vertices = PackedVector3Array()
vertices.push_back(Vector3(0, 1, 0))
vertices.push_back(Vector3(1, 0, 0))
vertices.push_back(Vector3(0, 0, 1))

# Initialize the ArrayMesh.
var arr_mesh = ArrayMesh.new()
var arrays = []
arrays.resize(Mesh.ARRAY_MAX)
arrays[Mesh.ARRAY_VERTEX] = vertices

# Create the Mesh.
arr_mesh.add_surface_from_arrays(Mesh.PRIMITIVE_TRIANGLES, arrays)
var m = MeshInstance3D.new()
m.mesh = arr_mesh
```


ä¾‹å¦‚ï¼Œä»¥ä¸‹ä½¿ç”¨ SurfaceTool æ„é€ åªæœ‰ä¸€ä¸ªé¡¶ç‚¹çš„ä¸‰è§’å½¢ï¼Œæ³¨æ„äº‹é¡¹ï¼š

- é¡¶ç‚¹å±æ€§éœ€è¦åœ¨ add_vertex() æ–¹æ³•æ‰§è¡Œå‰æ·»åŠ ï¼›
- ä½¿ç”¨ add_uv() å’Œ add_color() ç»™åç»­çš„é¡¶ç‚¹è®¾ç½® UV åæ ‡å’Œé¢œè‰²å±æ€§ï¼›
- ç¬¬ä¸€ä¸ªé¡¶ç‚¹æ·»åŠ å‰è®¾ç½®çš„å±æ€§å†³å®šäº†ç½‘æ ¼æ•°æ®æ ¼å¼ï¼Œä¾‹å¦‚ï¼Œåªæ·»åŠ äº† UV åæ ‡ï¼Œé‚£ä¹ˆæ·»åŠ é¡¶ç‚¹åå°±ä¸èƒ½å†è®¾ç½®é¡¶ç‚¹é¢œè‰²å±æ€§äº†ã€‚

```py
var st = SurfaceTool.new()
st.begin(Mesh.PRIMITIVE_TRIANGLES)
st.add_color(Color(1, 0, 0))
st.add_uv(Vector2(0, 0))
st.add_vertex(Vector3(0, 0, 0))
# Commit to a mesh.
var arr_mesh = st.commit()
```

Below is an example of how MeshDataTool may be used.

```py
var mesh = ArrayMesh.new()
mesh.add_surface_from_arrays(Mesh.PRIMITIVE_TRIANGLES, CubeMesh.new().get_mesh_arrays())
var mdt = MeshDataTool.new()
mdt.create_from_surface(mesh, 0)
for i in range(mdt.get_vertex_count()):
    var vertex = mdt.get_vertex(i)
    # In this example we extend the mesh by one unit, which results in separated faces as it is flat shaded.
    vertex += mdt.get_vertex_normal(i)
    # Save your change.
    mdt.set_vertex(i, vertex)
mesh.surface_remove(0)
mdt.commit_to_surface(mesh)
var mi = MeshInstance.new()
mi.mesh = mesh
add_child(mi)
```



### ğŸŸ ğŸ”µ Texture Map çº¹ç†è´´å›¾
- [Texture Mapping - GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744?p=9)
- [GAMES101 éšå ‚ç¬”è®°-Lecture 09 Shading 3 Texture Mapping](https://blog.csdn.net/weixin_44848751/article/details/127887098)
- [Physically Based Rendering 3rd - 10 Texture](https://www.pbr-book.org/3ed-2018/Texture)
- [OpenGL Programming Guide > Chapter 9 Texture Mapping](http://www.glprogramming.com/red/chapter09.html)
- Fundamentals Of Computer Graphics - 11. Texture Mapping
- [OGLDev Tutorial 16: Basic Texture Mapping](https://ogldev.org/www/tutorial16/tutorial16.html)
- [LearnOpenGL - Textures](https://learnopengl.com/Getting-started/Textures)
- OpenGL 4.6 (Core Profile) 8.14 Texture Minification & 8.15 Texture Magnification
- [GPU Gems II - 28. Mipmap-Level Measurement](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-28-mipmap-level-measurement)

çº¹ç†è´´å›¾æ˜¯å›¾å½¢ç€è‰²ä¸­çš„ä¸€ç§åŸºæœ¬æ–¹æ³•ï¼Œè´´å›¾å°±æ˜¯ä¸€å¼ è´´åœ¨å›¾å½¢ä¸Šçš„å›¾åƒã€‚è¦å°†ä¸€å¼ å›¾ç‰‡æ˜ å°„åˆ°ä¸€ä¸ªå›¾å½¢ï¼Œæ¯”å¦‚
ä¸‰è§’å½¢æˆ–è€…æ­£æ–¹å½¢ä¸Šï¼Œè¿™å°±éœ€è¦ä¸€ç§ç¡®å®šæ˜ å°„å…³ç³»çš„æ–¹æ³•ã€‚å›¾å½¢å­¦ä¸­ï¼Œå°†æ¸²æŸ“å¾—åˆ°çš„å›¾åƒä¸­çš„æ¯ä¸€ä¸ªç‚¹ç§°ä¸ºåƒç´ ï¼Œ
ç›¸ä¼¼åœ°ï¼Œå¯¹äºçº¹ç†å›¾åƒä¸Šçš„æ¯ä¸ªç‚¹ç§°ä¸ºçº¹ç´ ï¼Œpixel vs. texelã€‚

å½“ç„¶ï¼Œçº¹ç†ä¸ä¸€å®šå±€é™äºå›¾åƒæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¨‹åºè´´å›¾çº¹ç† Procedural Texturingï¼Œé€šè¿‡å™ªå£°å‡½æ•°ç®—æ³•ç”Ÿæˆï¼Œ
Noise Function æ—¨åœ¨åˆ›å»ºå¯ä»¥æ¨¡æ‹Ÿè‡ªç„¶å…ƒç´ çš„çº¹ç†ï¼Œä¾‹å¦‚æœ¨æï¼Œå¤§ç†çŸ³ï¼ŒèŠ±å²—å²©ï¼Œé‡‘å±ï¼ŒçŸ³å¤´ç­‰ã€‚å™ªå£°å‡½æ•°
åŒ…æ‹¬åˆ†å½¢ fractal noiseï¼Œæ¹æµæ‰°åŠ¨å‡½æ•° turbulence functionsï¼ŒPerlin noiseï¼ŒVoroni ç­‰ç­‰ã€‚
åœ¨è¿‡å»ï¼Œç”±äºè¿‡ç¨‹çº¹ç†è®¡ç®—é‡å¾ˆå¤§ï¼Œåœ¨å®æ—¶ç»˜åˆ¶ä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œè€Œ GPU ä¿ƒè¿›äº†å™ªå£°çº¹ç†åœ¨å®æ—¶æ¸²æŸ“ä¸­çš„å¹¿æ³›åº”ç”¨ã€‚


åœ¨ 2D çº¹ç†å¤„ç†ä¸­éœ€è¦ä½¿ç”¨ UV åæ ‡ï¼Œ3D çº¹ç†åˆ™ä½¿ç”¨ UVW åæ ‡ï¼Œå› ä¸ºè¡¨ç¤ºä½ç½®çš„åæ ‡ä½¿ç”¨ XYZ è¡¨ç¤ºï¼Œä¸ºäº†
åŒºåˆ«å¼€æ¥ï¼Œæ‰€ä»¥ä½¿ç”¨ UVW ä¸‰ä¸ªé‡è¡¨ç¤ºä¸‰ä¸ªè½´å‘ï¼Œä»¥å’Œä½ç½®åæ ‡åŒºåˆ†ã€‚

Godot ä¸­çš„çº¹ç†åæ ‡ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼Œå³ä¸‹è§’ä¸ºæ­£æ–¹å‘ ï¼Œä¸ OpenGL æœ‰ç‚¹å·®åˆ«ï¼Œå°±æ˜¯å°† V è½´ä¸Šä¸‹åè½¬ã€‚

![UV Mapping](https://docs.godotengine.org/en/3.5/_images/iconuv.png)

ä»¥ä¸‹æ˜¯ OpenGL çš„ UV åæ ‡ï¼Œçº¹ç†æ˜¯ä¸€å¼ ç –å¢™å›¾åƒï¼Œå°†å®ƒæ˜ å°„åˆ°ä¸€ä¸ªä¸‰è§’å½¢å›¾å½¢ä¸Šï¼Œåªä½¿ç”¨äº†çº¹ç†ä¸­é—´çš„éƒ¨åˆ†ï¼š

![https://learnopengl.com/Getting-started/Textures](https://learnopengl.com/img/getting-started/tex_coords.png)

UV åæ ‡å–å€¼èŒƒå›´åœ¨ [0,1] åŒºé—´ï¼Œåœ¨å±å¹•ç©ºé—´çœ‹èµ·æ¥å°±æ˜¯ U å¯¹åº”ä»å·¦åˆ°å³çš„æ–¹å‘ï¼ŒV å¯¹åº”ä»ä¸Šåˆ°ä¸‹çš„æ–¹å‘ã€‚
åœ¨ç»™ GPU ä¼ é€’é¡¶ç‚¹æ•°æ®æ—¶ï¼Œä¸€èˆ¬åŒ…å«ä½ç½®åæ ‡åŠé¡¶ç‚¹å¯¹åº”çš„ UV åæ ‡ï¼Œè¿™æ ·å°±å¯ä»¥æŒ‰ UV åæ ‡ç»™è¡¨é¢è´´çº¹ç†ã€‚
é€šè¿‡è®¾ç½® UV Mapping æ˜ å°„å…³ç³»ï¼Œå¯ä»¥å°†çº¹ç†å›¾æŒ‰åæ ‡å¯¹åº”è´´ç´§æ¨¡å¼è¡¨é¢ï¼Œå¯ä»¥åŸç‚¹ã€å¤§å°ä¸€ä¸€å¯¹é½ï¼Œä¹Ÿå¯ä»¥
ä¸å¯¹é½ï¼Œä¾‹å¦‚ï¼Œå°†å›¾ç‰‡åŸç‚¹å¯¹åº”åˆ°æ¨¡å‹ UV æœ€å¤§å€¼æŒ‡å‘çš„ä½ç½®ï¼Œè€Œå°†å›¾ç‰‡çš„æœ€å¤§å°ºå¯¸ä½ç½®å¯¹åº”åˆ°æ¨¡å‹åŸç‚¹ï¼Œå°±
å°†çº¹ç†å›¾åè½¬ã€‚


åœ¨çº¹ç†æ˜ å°„å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°è¿™æ ·çš„ä¸¤ç§é—®é¢˜ï¼Œå³çº¹ç†ç¼©æ”¾é—®é¢˜ï¼š

- çº¹ç†å¤ªå°ï¼Œå›¾å½¢å¤ªå¤§ï¼Œéœ€è¦å¯¹çº¹ç†è¿›è¡Œæ”¾å¤§å¤„ç†ï¼›
- çº¹ç†å¤ªå¤§ï¼Œå›¾å½¢å¤§å°ï¼Œéœ€è¦å¯¹çº¹ç†é‡é‡‡æ ·ï¼Œè®©å®ƒå˜å°ï¼›

è¿™ä¸¤ç§é—®é¢˜å°±æ˜¯ Point Query vs. (Avg.) Range Queryï¼Œçº¹ç†å¤„ç†ä¸­çš„å¹³å‡èŒƒå›´æŸ¥è¯¢åªæ˜¯ä¸€ç§å…·ä½“æ“ä½œï¼Œ
å¹¶ä¸æ˜¯èŒƒå›´æŸ¥è¯¢çš„ä¸€èˆ¬å½¢å¼ã€‚

ä¸ºäº†æ”¾å¤§çº¹ç†é€‚ç”¨å›¾å½¢ï¼Œç®€å•å¤åˆ¶çº¹ç´ ä¼šå¯¼è‡´ä¸¥é‡çš„é”¯é½¿é—®é¢˜ï¼Œä¾‹å¦‚ä»¥ä¸‹å›¾å·¦ä¾§æ˜¾ç¤ºçš„è¿™æ ·ï¼š

![GL_NEAREST vs. GL_LINEAR](https://learnopengl.com/img/getting-started/texture_filtering.png)

è€Œå³ä¾§ï¼Œåˆ™ä½¿ç”¨äº†çº¿æ€§æ’å€¼é‡é‡‡æ ·ï¼Œçœ‹èµ·æ¥æ•ˆæœæ˜æ˜¾å¥½å¤šäº†ã€‚çº¿æ€§æ’å€¼æ˜¯æœ€ç®€å•çš„çº¹ç†æ”¾å¤§æ–¹æ³•ï¼Œé€šè¿‡åœ¨çº¹ç´ é—´
å¢åŠ å¹³æ»‘å˜åŒ–å€¼åˆ›é€ å‡ºæ›´çš„çº¹ç´ ï¼Œçº¹ç†å°ºå¯¸ä¹Ÿç›¸åº”å˜å¤§ï¼Œè¿™äº›çº¹ç†é‡é‡‡æ ·æ–¹æ³•ä¹Ÿå«åš Texture filteringã€‚

é«˜åˆ†è¾¨ç‡çš„åƒç´ åæ ‡ç»çº¹ç†æ˜ å°„ï¼Œåªæœ‰å¤§å°ä¸€è‡´çš„æƒ…å†µä¸‹æ‰ä¼šè½åœ¨çº¹ç´ ä¸­å¿ƒï¼Œé€šå¸¸ä¸ä¼šè½åœ¨çº¹ç´ ä¸­å¿ƒï¼Œå³æ˜ å°„åæ ‡
éæ•´æ•°å€¼ï¼Œå¦‚ä½•è®¡ç®—çº¢ç‚¹å¤„çš„çº¹ç†å€¼ï¼Ÿå°±æ˜¯æ’å€¼éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚

ä¸€ä¸ªæ–¹æ³•æ˜¯åŸºäºä¸‰è§’å½¢é‡å¿ƒåæ ‡çš„æ’å€¼ç®—æ³•ï¼ŒInterpolation Across Triangles: Barycentric Coordinatesã€‚
ä¸‰è§’å½¢æ˜¯äºŒç»´ç¯å¢ƒä¸‹çš„å•å½¢ï¼Œå³å¯ä»¥é€šè¿‡ä¸‰è§’å½¢æ‹¼æ¥é“ºæ»¡æ•´ä¸ª 2D ç©ºé—´ã€‚ä¸‰è§’å½¢å†…çš„ä»»æ„ä¸€ç‚¹ï¼Œå¯ä»¥è¡¨ç¤ºä¸ºä¸‰è§’å½¢
ä¸‰ä¸ªé¡¶ç‚¹åæ ‡çš„çº¿æ€§ç»„åˆï¼š

    (x, y) = Î±A + Î²B + Î³C
         1 = Î± + Î² + Î³      (Î±, Î², Î³ non-negative)

ä¸‰è§’å½¢æ‰€åœ¨å¹³é¢ä¸Šä»»æ„ä¸€ä¸ªç‚¹ï¼ˆxï¼Œyï¼‰éƒ½å¯ä»¥ç”¨ä¸‰ä¸ªé¡¶ç‚¹ Aã€Bã€C åæ ‡çš„çº¿æ€§ç»„åˆæ¥è¡¨ç¤ºã€‚å½“çº¿æ€§ç»„åˆçš„ç³»æ•°éè´Ÿï¼Œ
ä¸” Î±ã€Î²ã€Î³ ä¹‹å’Œç­‰äº 1ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªç‚¹åœ¨ä¸‰è§’å½¢å†…éƒ¨ï¼Œè€Œä¸‰ä¸ªç³»æ•°åˆ™ä¼šç”¨äºè®¡ç®—æ’å€¼ã€‚

å¯¹äºä¸€ä¸ªå·²çŸ¥é¢ç§¯çš„å°ä¸‰è§’å‹ï¼Œå¯ä»¥æ±‚è§’ä»»æ„ç‚¹ Î±Î²Î³ ä¸‰ä¸ªç³»æ•°ã€‚å‡å®šæŸç‚¹ï¼ˆxï¼Œyï¼‰ä¸ä¸‰ä¸ªé¡¶ç‚¹è¿æ¥ï¼Œå°†ä¸‰è§’å½¢
åˆ’åˆ†æˆä¸‰ä¸ªå°ä¸‰è§’å½¢ï¼Œå„è‡ªçš„é¢ç§¯ä¸º Aá´¬ Aá´® Aá¶œï¼Œé‚£ä¹ˆåˆ©ç”¨é¢ç§¯æ¯”å¯ä»¥æ±‚å‡ºç³»æ•° Î±ã€Î²ã€Î³ã€‚

    Î± = Aá´¬ Ã· (Aá´¬ + Aá´® + Aá¶œ)
    Î² = Aá´® Ã· (Aá´¬ + Aá´® + Aá¶œ)
    Î³ = Aá¶œ Ã· (Aá´¬ + Aá´® + Aá¶œ)

![Geometric viewpoint â€” proportional areas](https://img-blog.csdnimg.cn/bcd7595c4bc64587a08351dd029f47ec.png)

ä¸‰è§’å½¢çš„é‡å¿ƒï¼ˆè´¨å¿ƒï¼‰æ ‡å¯¹åº”çš„ç³»æ•°å°±æ˜¯ï¼ˆ1/3, 1/3, 1/3ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç­‰å¯†åº¦çš„ç‰©ä½“åœ¨å‡è¡¡çš„é‡åŠ›åœºä¸‹ï¼Œ
é‡å¿ƒå’Œè´¨å¿ƒæ˜¯é‡åˆçš„ï¼Œè¿™ä¸ªç‚¹ä¼šå°†ä¸‰è§’å½¢åˆ†å‰²æˆä¸‰ä¸ªé¢ç§¯ç›¸ç­‰çš„å°ä¸‰è§’å½¢ã€‚æ‰€ä»¥ï¼Œç›¸æ¯”äºé€šè¿‡é¢ç§¯æ±‚ç³»æ•°ï¼Œæ›´å¿«çš„
æ˜¯ç›´æ¥é€šè¿‡é¡¶ç‚¹åæ ‡æ¥è®¡ç®—ï¼Œé€šè¿‡å‘é‡å‰ä¹˜å¯ä»¥æ¨å¯¼ä»¥ä¸‹å¼å­ã€‚å¼å­ä¸é‡è¦ï¼Œå…³é”®æ˜¯ç†è§£é€šè¿‡é‡å¿ƒåæ ‡æ¥æ’å€¼ã€‚

    Î± = ((x - Ax)(By - Cy) + (y - By)(Cx - Bx))Ã·((Ax - Bx)(By - Cy) + (Ay - By)(Cx - Bx))
    Î² = ((x - Cx)(Cy - Ay) + (y - Cy)(Ax - Cx))Ã·((Bx - Cx)(Cy - Ay) + (By - Cy)(Ax - Cx))
    Î³ = 1 - Î± - Î²

![Barycentric Coordinates: Formulas](https://img-blog.csdnimg.cn/596fb2e34799442fa59e1f123493220a.png)

å½“ä¸€ä¸ªç‚¹çš„é‡å¿ƒåæ ‡ï¼ˆÎ±ï¼ŒÎ²ï¼ŒÎ³ï¼‰æ±‚å‡ºæ¥ä»¥åï¼Œå°±å¯ä»¥æ±‚è§£ä»»æ„å±æ€§ V åœ¨æ­¤ç‚¹çš„æ’å€¼ï¼Œåªéœ€è¦å°†ä¸‰ä¸ªé¡¶ç‚¹æ‰€å®šä¹‰
çš„å±æ€§å’Œç³»æ•°åšä¹˜æ³•å†ç›¸åŠ ï¼Œå³å¯æ±‚å‡ºæ’å€¼å‡ºæ¥çš„å±æ€§å€¼ã€‚å±æ€§å¯ä»¥æ˜¯ä½ç½®ï¼Œçº¹ç†åæ ‡ï¼Œé¢œè‰²ï¼Œæ³•çº¿ï¼Œæ·±åº¦ç­‰ç­‰ã€‚

ä½†æ˜¯è¦æ³¨æ„ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œåº”è¯¥è€ƒè™‘æŠ•å½±äº§ç”Ÿçš„å˜å½¢å½±å“ï¼Œå°¤å…¶å¯¹äºåœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„å±æ€§ï¼Œæ¯”å¦‚æ·±åº¦ä¿¡æ¯ï¼Œåº”è¯¥
ç”¨ä¸‰ç»´ç©ºé—´åæ ‡æ‰¾åˆ°å¯¹åº”ä½ç½®ï¼Œç„¶ååœ¨ä¸‰ç»´ç©ºé—´ä¸­å¯¹ Aã€Bã€C çš„æ·±åº¦å±æ€§æ’å€¼ï¼Œç„¶åå†æŠ•å½±å›æ¥ï¼Œè¿™ä¸ªè¿‡ç¨‹éœ€è¦
åšä¸€æ¬¡é€†å˜æ¢å°±å¯ä»¥ã€‚

æœ€ç®€å•çš„æ’å€¼å°±æ˜¯ä¸€ç»´çº¿æ€§æ’å€¼ï¼ŒLinear Interpolationï¼Œå‡½æ•°ç®€å†™ä¸º lerpã€‚æ›´å¤æ‚çš„æ’å€¼å¯ä»¥æœ‰äºŒæ¬¡æ›²çº¿ã€
ä¸‰æ¬¡æ›²çº¿ç­‰æ’å€¼æ–¹æ³•ã€‚å¯¹çº¹ç†çš„æ’å€¼ç¼©æ”¾å°ºå¯¸ï¼Œè¿™ç§æ“ä½œå°±æ˜¯è¶…é‡‡æ · supersamplingã€‚

å‡å®šåœ¨ä¸€ä¸ªå°ä¸‰è§’å½¢é¡¶ç‚¹ä¸Šï¼Œåˆšå¥½å¯¹åº”åˆ°ç›¸é‚»çš„çº¹ç´ ï¼Œé‚£ä¹ˆè¿™ä¸ªå°ä¸‰è§’å½¢ä¸­é—´åŒºåŸŸçš„æ¸²æŸ“å¾—åˆ°çš„åƒç´ å°±éœ€è¦åœ¨å„
ä¸ªé¡¶ç‚¹å¯¹åº”çš„çº¹ç´ å–å€¼ä¹‹é—´ï¼Œè¿›è¡Œçº¿æ€§çš„å¹³æ»‘æ’å€¼ã€‚æ¯”å¦‚ï¼Œä¸¤é¡¶ç‚¹ä¹‹é—´åªå¤šæ¸²æŸ“ä¸€ä¸ªåƒç´ ï¼Œè€Œä¸¤ä¸ªé¡¶ç‚¹çš„å€¼åˆ†åˆ«ä¸ºï¼Œ
0.5 å’Œ 0.7ï¼Œé‚£ä¹ˆæ’å€¼ç‚¹å°±å¯ä»¥æŒ‰ä¸¤ç‚¹çš„å¹³å‡å€¼è®¡ç®—å¾—åˆ° 0.6ã€‚

å¯¹äºäºŒç»´å›¾åƒï¼Œéœ€è¦è¿›è¡ŒäºŒçº¿æ€§æ’å€¼ï¼ŒBilinear interpolationï¼Œåˆ†åˆ«å¯¹åº”æ°´å¹³æ–¹å‘ã€ç«–ç›´æ–¹å‘æ’å€¼ã€‚ä¸‰ç»´
ä¸­è¿˜æœ‰ä¸‰çº¿æ€§æ’å€¼ Trilinear Interpolationã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„äºŒã€ä¸‰ä¸æ˜¯æŒ‡äºŒæ¬¡æ›²çº¿æˆ–ä¸‰æ¬¡æ›²çº¿ï¼Œè€Œæ˜¯ä¸€æ¬¡
çš„ç›´çº¿åšäº†å‡ å›æ’å€¼æ“ä½œã€‚

![Bilinear interpolation](https://img-blog.csdnimg.cn/5f070c0acce34afa8562c076fe289fd4.png)

è¶…é‡‡æ ·æŠ—é”¯é½¿ Super-Sampling Anti-aliasing (SSAA) æ˜¯æ—©æœŸæŠ—é”¯é½¿æ–¹æ³•ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºã€‚ä¸€èˆ¬æŒ‰æ•´æ•°
å€æ”¾å¤§ï¼Œx2ã€x4ã€x8 ç­‰å€æ•°ã€‚ è¶…çº§é‡‡æ ·æŠ—é”¯é½¿ä¸­ä½¿ç”¨çš„é‡‡æ ·æ³•ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š

- é¡ºåºæ …æ ¼è¶…çº§é‡‡æ · Ordered Grid Super-Sampling (OGSS)ï¼Œé‡‡æ ·æ—¶é€‰å– 2 ä¸ªé‚»è¿‘åƒç´ ã€‚
- æ—‹è½¬æ …æ ¼è¶…çº§é‡‡æ · Rotated Grid Super-Sampling (RGSS)ï¼Œé‡‡æ ·æ—¶é€‰å– 4 ä¸ªé‚»è¿‘åƒç´ ã€‚


å¯¹äºé«˜è´¨é‡çš„çº¹ç†ï¼Œæ¯”å¦‚ 4K çº¹ç†åœ¨ç»™å°å›¾å½¢ç€è‰²æ—¶ï¼Œå°±ä¼šé¢ä¸´å®Œå…¨ä¸åŒçš„é—®é¢˜ï¼Œä¸€å¤§å—çš„çº¹ç´ è¦å¦‚ä½•é€‚é…ä¸€ä¸ª
åƒç´ ã€‚è¿™å°±æ˜¯å—æŸ¥è¯¢é—®é¢˜ã€‚å½“ç„¶ï¼Œä¸èƒ½ç›´æ¥ç”¨ä¸€ä¸ªå¹³å‡å€¼å»ä»£è¡¨ä¸€æ•´å—çš„çº¹ç´ ï¼Œä¼šé€ æˆä¸¥é‡çš„å¤±çœŸã€‚

ä¸€ä¸ªç»å…¸çš„è§£å†³æ–¹æ³•æ˜¯ Mipmapï¼Œå®ƒé€šè¿‡ä¸ºé«˜è´¨é‡çš„çº¹ç†ç”Ÿæˆä¸åŒç²¾ç»†å±‚çº§çš„ç¼©å°ç‰ˆçº¹ç†ï¼Œå¾ˆå¥½åœ°è§£å†³äº†çº¹ç†
é€‚é…é—®é¢˜ï¼Œå¹¶ä¸”é€Ÿåº¦å¾ˆå¿«ï¼Œä½†æ˜¯å®ƒåªèƒ½åšæ­£æ–¹å½¢çš„å¤„ç†ï¼Œæ¯”å¦‚ 1x1ã€64x64ã€512x512 è¿™æ ·çš„çº¹ç†å°ºå¯¸ã€‚ä¸€èˆ¬
æ¯å±‚é‡é‡‡æ ·æŒ‰ 1/2 çš„å¤§å°ç¼©å°ï¼ŒLevel 0 ä¸ºåŸå›¾ï¼ŒLevel 1 ä¸ºåŸå›¾çš„ 1/4 å¤§å°ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ‰€ä»¥å¢åŠ çš„
å­˜å‚¨ç©ºé—´æœ€å¤§ä¸ºåŸçº¹ç†å¤§å°çš„ 1/3ã€‚

![Figure 9-4 : Mipmaps](http://www.glprogramming.com/red/images/Image114.gif)

Mipmap é‡é‡‡æ ·çº¹ç†å¯ä»¥é¢„å…ˆç”Ÿæˆï¼Œå¾—åˆ° Mipmap å±‚çº§çº¹ç†åï¼Œè´´çº¹ç†æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªæ˜ å°„æ–¹æ³•ï¼Œæ ¹æ®å›¾å½¢çš„
å¤§å°æ¥é€‰æ‹©æ‰€éœ€è¦çš„ç²¾ç»†åº¦å±‚çº§ï¼ŒComputing Mipmap Level Dã€‚

![Computing Mipmap Level D](https://img-blog.csdnimg.cn/cbc21cd30b7f4e129dfd141783d1aa0e.png)

è®¡ç®— Mipmap å±‚çº§éœ€è¦ç”¨åˆ°åå¾®åˆ†ï¼Œå›¾ä¸Šçš„å¼ä¸­çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å…¶å®å°±æ˜¯æ±‚è§£åƒç´ ä¸çº¹ç´ å˜åŒ–ç‡çš„æ¯”å€¼é—®é¢˜ã€‚
å°†åƒç›¸é‚»ç´ ç‚¹æŠ•å½±åˆ°å¯¹åº”çš„çº¹ç´ ï¼Œå›¾ä¸­çš„çº¢ç‚¹ä»£è¡¨æŠ•å°„åæ ‡ï¼Œå››ä¸ªç›¸é‚»åƒç´ æ„æˆçš„çŸ©å½¢å°±ä¼šåœ¨çº¹ç†ä¸ŠæŠ•å°„å‡ºä¸€ä¸ª
å››è¾¹å½¢ã€‚å·²çŸ¥ç›¸é‚»ä¸¤ä¸ªåƒç´ ä¸­å¿ƒçš„è·ç¦»æ˜¯ 1ï¼Œå¯¹åº”åˆ°å³è¾¹çº¹ç†ä¸Šæœ‰çš„è·ç¦» L ä¹Ÿå°±å¯ä»¥æ±‚å‡ºï¼Œåªéœ€è¦ç”¨å˜åŒ–å¤§çš„
ä¸€è¾¹çš„å€¼å°±å¯ä»¥è®¡ç®—å‡ºç›®æ ‡çš„ Mipmap Levelã€‚å¦‚æœ L åŒæ ·ä¸º 1 å°±è¡¨ç¤ºåº”è¯¥ä½¿ç”¨åŸçº¹ç†ï¼Œå¦‚æœ L ä¸º 2 åˆ™
åº”è¯¥ä½¿ç”¨ Level 1 çº¹ç†ï¼ŒæŸ¥è¯¢ç»“æœæ€»ä¼šå¯¹åº” D  = log2L å±‚çº¹ç†ä¸Šçš„ä¸€ä¸ªçº¹ç´ ã€‚

å› æ­¤ï¼Œåªéœ€è¦ç®—å‡º Dï¼Œå³åœ¨ç¬¬å‡ å±‚æ­£æ–¹å½¢çš„åŒºåŸŸå¯¹åº”ä¸€ä¸ªåƒç´ ï¼Œå°±å¯ä»¥å¾—å‡ºè¿™ä¸ªåŒºåŸŸå†…å¹³å‡å€¼æ˜¯å¤šå°‘ã€‚


Mipmap å¹¶ä¸èƒ½å¤„ç†ä¸€åˆ‡çº¹ç†é€‚é…é—®é¢˜ï¼Œå½“å›¾å½¢éœ€è¦çº¹ç†åœ¨ä¸¤ä¸ªå±‚çº§ä¹‹é—´è¿‡æ¸¡éœ€è¦æ—¶ï¼Œå¦‚æœç›´æ¥åœ¨ç°æœ‰çš„ä¸¤ä¸ªå±‚
çº§ä¹‹é—´è½¬æ¢ï¼Œè¿™å°±ä¼šå¯¼è‡´çº¹ç†ä»ä¸€ä¸ªç²¾ç»†çº¹ç†ç›´æ¥æ”¹å˜ä¸ºå¦ä¸€å¼ ç²¾åº¦åªæœ‰ä¸€åŠçš„çº¹ç†ï¼Œå›¾åƒä¼šå‡ºç°ä¸è¿ç»­çš„ç°è±¡ã€‚
è¿™å°±éœ€è¦å¯¹ Mipmap è¿›è¡Œä¸‰çº¿æ€§æ’å€¼ï¼šå…ˆæŸ¥è¯¢å‡ºä¸¤ä¸ªå±‚çº§çš„çº¹ç†å„è‡ªçš„äºŒçº¿æ€§æ’å€¼ï¼Œå†åœ¨è¿™ä¸¤ä¸ªå€¼ä¹‹é—´åšä¸€æ¬¡
é¢å¤–çš„å±‚åˆ°å±‚ä¹‹é—´çš„æ’å€¼ã€‚

ä¸‰çº¿æ€§æ’å€¼æä¾›äº†ä¸€ç§ç±»ä¼¼å¯ä»¥æä¾›ä»»æ„å±‚çš„ Mipmap çš„æ•ˆæœï¼Œå‡ºæ¥çš„æ•ˆæœå°±æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®çš„è¿ç»­æ¸å˜çš„å±‚çº§ã€‚

![Mipmap Trilinear Interpolation](https://img-blog.csdnimg.cn/cc252947b2f1434cbc10db1dbf1cffb5.png)


å¾ˆæ˜¾ç„¶ï¼Œéæ­£æ–¹å½¢çš„å˜æ¢ä¹Ÿä¸èƒ½ç”¨ Mipmap å¤„ç†ï¼Œè¿™ç§æƒ…å†µä¸‹åº”ç”¨ Mipmap å°±ä¼šäº§ç”Ÿä¸è‰¯æ•ˆæœã€‚

![Mipmap é”¯é½¿åŠæ‘©å°”çº¹](https://img-blog.csdnimg.cn/f187e0f6755749c5a68961c80d8405a5.png)

è¿™ç§ç°è±¡äº§ç”Ÿçš„åŸå› æ˜¯å˜å½¢æ–¹å‘ä¸é‡‡æ ·ä¸é€‚é…ï¼ŒMipmap éƒ½æ˜¯æ­£æ–¹å½¢åŒºåŸŸç¼©æ”¾ï¼Œåªèƒ½åšæ­£æ–¹å½¢çš„ Range Queryã€‚
ç„¶è€ŒçœŸå®æƒ…å†µå¹¶ä¸æ˜¯å¦‚æ­¤ï¼Œè§ä¸‹å›¾ï¼Œä¸åŒ Screen space çš„åƒç´ æ‰€å¯¹åº”çš„çº¹ç´ å»¶å±•æ–¹å‘ä¸åŒï¼Œæœ‰æ–¹å—ï¼Œæœ‰é•¿æ¡ï¼Œ
æ–¹å‘ä¹Ÿä¸ä¸€æ ·ï¼Œç”šè‡³æ˜¯ä¸è§„åˆ™å›¾å½¢ã€‚ä¸‹å›¾æ¥æº Fundamentals Of Computer Graphics - 11. Texture Mapping

![Screen space to texture space](https://pic2.zhimg.com/80/v2-1003f344d0ffc9d683b66167e45c0359_1440w.webp)

Figure 11.18. The footprints in texture space of identically sized square areas 
in the image vary in size and shape across the image.

ä¸ºäº†è§£å†³ Mipmap ä¸èƒ½è§£å†³éæ­£æ–¹å½¢å˜æ¢çš„é—®é¢˜ï¼Œåˆå¼•å…¥äº†å„å‘å¼‚æ€§è¿‡æ»¤ Anisotropic Filtering ä»¥è§£å†³
ä¸‰çº¿æ€§æ’å€¼å¼Šç«¯ï¼Œåœ¨ä¸åŒçš„æ–¹å‘ä¸Šè¡¨ç°å„ä¸ç›¸åŒï¼ˆè€ƒè™‘æ–¹å‘æ€§ï¼‰ï¼š

![Anisotropic Filtering](https://img-blog.csdnimg.cn/4b84789bb6074c46b9baff3903fa8deb.png)

Mipmap æ“ä½œçš„ç›¸å½“äºæ˜¯ä¸Šå›¾çš„å¯¹è§’çº¿å›¾ç‰‡ï¼Œæ¯æ¬¡é•¿å®½å„ç¼©å°ä¸€åŠï¼Œè€Œå„å‘å¼‚æ€§å¯ä»¥ç”¨ä¸åŒçš„é•¿å®½æ¯”è¿›è¡Œç¼©å°ï¼Œ
åŒ…å«ä¸Šå›¾é™¤äº†å¯¹è§’çº¿ä»¥å¤–çš„å›¾ç‰‡ï¼Œå°±å¯ä»¥åº”å¯¹éçŸ©å½¢åŒºåŸŸåšèŒƒå›´æŸ¥è¯¢ï¼Œé¢å¤–å­˜å‚¨å¼€é”€æ˜¯åŸæ¥çš„ä¸‰å€ã€‚


ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›æ–œç€çš„å›¾å½¢ï¼Œä¾ç„¶æ²¡æœ‰å¾ˆå¥½çš„æ–¹æ³•å»æŸ¥è¯¢ã€‚ä¸ºäº†è§£å†³ä»»æ„å˜å½¢çº¹ç†æ˜ å°„é—®é¢˜ï¼Œåˆå¼•å…¥äº†æ›´å¤æ‚çš„
çº¹ç†è¿‡æ»¤æ–¹æ³•ï¼Œå¦‚ Elliptically Weighted Average (EWA) æ¤­åœ†åŠ æƒå¹³å‡è¿‡æ»¤ã€‚æ•ˆæœä¸Šï¼Œæ¯”ä¸‰çº¿æ€§æ»¤æ³¢ 
Trilinear Filter è¦å¥½äº†ä¸€å¤§æˆªã€‚

å¯¹äºä»»ä½•ä¸€ä¸ªå½¢çŠ¶ï¼ŒEWA éƒ½å¯ä»¥å°†å…¶æ‹†æˆå¾ˆå¤šä¸åŒçš„åœ†å½¢å»è¦†ç›–è¿™ä¸ªå½¢çŠ¶ã€‚æ¯”å¦‚ï¼ŒæŸ¥è¯¢ä¸€ä¸ªæ¤­åœ†ï¼Œå¯å°†å…¶æ‹†æˆå¤šä¸ª
åœ†å½¢ï¼Œæ¯æ¬¡å»æŸ¥è¯¢ä¸€ä¸ªåœ†å½¢ï¼Œå¤šæ¬¡æŸ¥è¯¢è‡ªç„¶å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåŒºåŸŸï¼Œä½†æ˜¯ä»£ä»·æ˜¯â€œå¤šæ¬¡æŸ¥è¯¢â€ã€‚å¯è§è´¨é‡è¶Šé«˜çš„æ•ˆæœï¼Œ
æ€§èƒ½å¼€é”€è¶Šå¤§ã€‚

![EWA filtering](https://img-blog.csdnimg.cn/ea8e695554e04d74bf530569f6d7c04a.png)



### ğŸŸ ğŸ”µ IBL & Skybox çº¹ç†è´´å›¾å…‰ç…§
- [Poly Haven - The Public 3D Asset Library](https://polyhaven.com/all)
- [LearnOpenGL - Cubemaps skybox](https://learnopengl.com/Advanced-OpenGL/Cubemaps)
- [OGLDev Tutorial 25: SkyBox](https://ogldev.org/www/tutorial25/tutorial25.html)
- [GAMES101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ - é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/?p=10)
- [è¯¦è§£çƒé¢ç¯å¢ƒæ˜ å°„ - Spherical Environment Mapping](https://zhuanlan.zhihu.com/p/84494845)
- [GPU Gems I - 19. Image-Based Lighting](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-19-image-based-lighting)
- [Programming with OpenGL: Advanced Rendering - 9.3.2 Sphere Mapping](https://www.opengl.org/archives/resources/code/samples/advanced/advanced97/notes/node93.html)
- Real-Time Rendering - 10.4 Environment Mapping
- [Real-Time Rendering 3rd çº¹ç†è´´å›¾åŠç›¸å…³æŠ€æœ¯æç‚¼æ€»ç»“](https://zhuanlan.zhihu.com/p/27551369)
- [Real-Time Rendering 3rd åŸºäºå›¾åƒçš„æ¸²æŸ“æŠ€æœ¯æç‚¼æ€»ç»“](https://zhuanlan.zhihu.com/p/30345339)
- [Real-Time Rendering 3rd å…¨å±€å…‰ç…§ GI æŠ€æœ¯è¿›åŒ–ç¼–å¹´å²](https://zhuanlan.zhihu.com/p/29418992)
- [Procedural geometry](https://docs.godotengine.org/en/latest/tutorials/3d/procedural_geometry/index.html)
- [Using the ArrayMesh](https://docs.godotengine.org/en/3.5/tutorials/3d/procedural_geometry/arraymesh.html)

çº¹ç†è´´å›¾ä¸ä»…å¯ä»¥ç”¨æ¥ç»™å›¾å½¢ç€è‰²ï¼Œå®ƒè¿˜æœ‰å„å¼å„æ ·çš„ç”¨æ³•ï¼Œå¦‚ä¸‹ï¼ŒæŒ‰æŠ€æœ¯å‡ºç°å…ˆååºï¼š

- Bump Mapping å‡¹å‡¸è´´å›¾ï¼Œä½¿ç”¨çº¹ç†å˜åŒ–æ¥å½±å“æ³•çº¿æ–¹å‘ï¼Œå¢åŠ å›¾å½¢è¡¨é¢çš„å‡¹å‡¸ç»†èŠ‚ï¼›
- Displacement Mapping è½¬æ¢è´´å›¾ï¼Œä½¿ç”¨çº¹ç†æ¥æ”¹å˜é¡¶ç‚¹çš„ä½ç½®ï¼›
- Normal Mapping æ³•çº¿è´´å›¾ï¼Œæ˜¯å‡¹å‡¸è´´å›¾çš„ä¸€ç§åº”ç”¨ï¼Œä½¿ç”¨çº¹ç†è®°å½•æ³•çº¿å‘é‡ï¼›
- Parallax Mapping è§†å·®è´´å›¾ï¼Œåˆç§°ä¸º Offset Mappingï¼Œæ˜¯å‡¹å‡¸è´´å›¾æ”¹è¿›ç‰ˆï¼Œçº¹ç†å°†æœ‰æ›´æ˜æ˜¾çš„æ·±åº¦ã€‚
- Relief Mapping æµ®é›•è´´å›¾ï¼Œæœ‰äººæŠŠå®ƒèª‰ä¸ºå‡¹å‡¸è´´å›¾çš„æè‡´ã€‚

è§†å·®è´´å›¾æ˜¯é’ˆå¯¹ Normal Mapping çš„æ”¹è¿›ï¼Œåˆ©ç”¨ Height Map è¿›è¡Œäº†è¿‘ä¼¼çš„ Texture Offsetã€‚
è€Œ Relief Mapping æ˜¯ç²¾ç¡®çš„ Texture Offsetï¼Œæ‰€ä»¥åœ¨è¡¨ç°åŠ›ä¸Šæ¯”è¾ƒå®Œç¾ã€‚



ç”¨çº¹ç†å›¾åƒæ¥æ¨¡æ‹Ÿå…‰ç…§å°±æ˜¯å¸¸è§ç”¨æ³•ï¼Œçº¹ç†å½“ä½œç¯å¢ƒå…‰ä½¿ç”¨ï¼Œé‚£ä¹ˆçº¹ç†ä¸­è®°å½•çš„å°±æ˜¯å…‰ç…§ä¿¡æ¯ã€‚æˆ–è€…ç›´æ¥å°†çº¹ç†
å½“ä½œ Environment Map æ¸²æŸ“åˆ°å›¾å½¢ä¸Šã€‚

Skybox å°±æ˜¯å°†ç¯å¢ƒå…‰çº¹ç†ä¿å­˜åœ¨ä¸€ä¸ª Cube ä¸Šç”¨æ¥æ¨¡æ‹Ÿå¤©ç©ºå¤§æ°”çš„ç¯å¢ƒï¼ŒåŸç†å°±æ˜¯å‡è®¾ä¸€ä¸ªæ— é™è¿œçš„ç›’å­ï¼Œ
ä»¥ç©å®¶ä¸ºä¸­å¿ƒï¼Œæ— è®ºç©å®¶ç§»åŠ¨äº†å¤šè¿œï¼Œå¤©ç©ºç›’éƒ½ä¸ä¼šå˜è¿‘ï¼Œè¿™æ ·å°±äº§ç”Ÿä¸€ç§å››å‘¨çš„ç¯å¢ƒçœŸçš„éå¸¸å¤§çš„å‡è±¡ã€‚

![Cubemaps skybox](https://learnopengl.com/img/advanced/cubemaps_skybox.png)

ä½¿ç”¨äº†ç¯å¢ƒç«‹æ–¹ä½“è´´å›¾çš„æŠ€æœ¯å«åšç¯å¢ƒè´´å›¾æŠ€æœ¯ï¼Œè®©ç‰©ä½“æœ‰åå°„(reflection)å’ŒæŠ˜å°„(refraction)å±æ€§ã€‚

æ›´æ—©æœŸçš„åšæ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªçƒä½“æ¥ä¿å­˜ç¯å¢ƒå…‰ï¼ŒSpherical enviroment mapï¼Œå®ƒé‡‡ç”¨å•å¼ è´´å›¾è¡¨ç¤ºæ•´ä¸ªç¯å¢ƒï¼Œ
ç¼ºç‚¹æ˜¯çƒå½¢è´´å›¾çš„å‘¨è¾¹ç²¾ç¡®åº¦æ€¥å‰§ä¸‹é™ã€‚è¿™ç§æ¨¡å‹ä¸­ï¼Œæ‘„åƒæœºä½äºæ— ç©·è¿œï¼Œè€Œçƒä½“æ— ç©·å°ï¼ŒåŒæ—¶å‡è®¾ç›¸æœºçš„åˆ†è¾¨ç‡
å¯ä»¥ä»»æ„é«˜ã€‚ç›¸å½“äºæŠŠä¸€ä¸ªæ“¦å¾—é”ƒäº®çš„å®Œç¾çƒä½“æ”¾åœ¨ç¯å¢ƒçš„ä¸­å¤®ï¼Œç„¶ååœ¨æ— ç©·è¿œå¤„ç”¨é•¿ç„¦é•œå¤´å¯¹å®ƒè¿›è¡Œæ‹ç…§ã€‚ç…§ç‰‡
å°±æ˜¯ä¸­è¦†ç›–æ•´ä¸ªåœ†å½¢åŒºåŸŸçš„éƒ¨åˆ†ï¼Œå®ƒä¸çº¹ç†å›¾åƒçš„é¡¶ã€åº•ã€å·¦ã€å³è¾¹ç¼˜ç›¸åˆ‡ã€‚è¿™ä¸ªåœ†å½¢åŒºåŸŸä¹‹å¤–çš„åŒºåŸŸä¸é‡è¦ï¼Œå› ä¸º
å®ƒä»¬ä¸ä¼šåœ¨ç¯å¢ƒçº¹ç†ä¸­ä½¿ç”¨ã€‚

![Sphere Mapping](https://pic3.zhimg.com/80/v2-1528a601b4105d6e1b4c935444ac75e2_1440w.webp)
![Sphere Mapping](https://www.opengl.org/archives/resources/code/samples/advanced/advanced97/notes/img130.gif)

å‡è®¾åå°„çƒè¡¨é¢æ³•çº¿ä¸º nï¼Œè§†è§’æ–¹å‘ vï¼Œåå°„å‘é‡ rï¼Œé‡‡æ ·å…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼Œé€šè¿‡åå°„å‘é‡æ±‚é‡‡æ ·åæ ‡ï¼š

    m = 2 âˆš(rğ‘¥Â² + rğ‘¦Â² + (rğ‘§ + 1)Â²)
    ğ‘¢ = rğ‘¥/m + 1/2
    ğ‘£ = rğ‘¦/m + 1/2

åå°„çƒä½“ä»…åœ¨çƒä½“çš„æ­£é¢æ˜¾ç¤ºæ•´ä¸ªç¯å¢ƒï¼Œäº§ç”Ÿçš„åœ†å½¢å›¾åƒä¹Ÿç§°ä¸ºå…‰ç…§æ¢é’ˆï¼ˆlight probeï¼‰ï¼Œå› ä¸ºå®ƒæ•è·äº†çƒä½“
ä½ç½®å¤„çš„ç…§æ˜æƒ…å†µï¼Œæ‹æ‘„çƒå½¢æ¢é’ˆæ˜¯æ•è·åŸºäºå›¾åƒçš„ç…§æ˜çš„æœ‰æ•ˆæ–¹æ³•ã€‚å°†çƒå½¢è´´å›¾å¯ä»¥å±•å¼€ä¸ºä¸€å¼ çŸ©å½¢çš„ç»çº¬è´´å›¾ï¼Œ
ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼çš„å›¾åƒä¼šå‡ºç°ä¸Šä¸‹ä¸¤ç«¯çš„ç•¸å˜ï¼Œè€Œèµ¤é“éƒ¨åˆ†åˆ™ç›¸å¯¹è¿‡åº¦é‡‡æ ·ã€‚

1986 å¹´ï¼ŒGreene æ¨å‡ºäº†ç«‹æ–¹ç¯å¢ƒæ˜ å°„ï¼ˆcubic environment mapï¼‰ï¼Œè¿™ç§æ˜¯å½“ä»Šæœ€æµè¡Œçš„æ–¹æ³•ï¼Œå®ƒçš„æŠ•å½±
ç›´æ¥åœ¨ç°ä»£ GPU çš„ç¡¬ä»¶ä¸­å®ç°ã€‚Cubemaps æ–¹å¼ä½¿ç”¨ 6 å¼ çº¹ç†å›¾ï¼Œåˆ™ä¸ä¼šæœ‰çƒä½“è´´å›¾çš„ç•¸å˜é—®é¢˜ã€‚å¤©ç©ºç›’ä¹Ÿè¦ä»¥
çƒä½“çš„æ–¹å¼å‘ˆç°ç¯å¢ƒè´´å›¾ï¼Œæ‰€ä»¥æ˜¯å°†ä¸€ä¸ªç›’å­åŒ…è£¹ç€ä¸€ä¸ªçƒä½“ï¼Œåœ¨è®¡ç®—ä¸Šä¸åŠç›´æ¥ä½¿ç”¨çƒä½“æ–¹ä¾¿ã€‚ä¸çƒå½¢æ˜ å°„ä¸åŒï¼Œ
ç«‹æ–¹ä½“ç¯å¢ƒæ˜ å°„ç‹¬ç«‹äºè§†å›¾ï¼Œä¸ç»çº¬æ˜ å°„ç›¸æ¯”ï¼Œå®ƒè¿˜å…·æœ‰æ›´åŠ ç»Ÿä¸€çš„é‡‡æ ·ç‰¹æ€§ã€‚


ä»¥ä¸‹ä½¿ç”¨ Blender + Godot åˆ›å»ºä¸€ä¸ª Cubemapã€‚å…ˆåœ¨ Blender åˆ›å»ºä¸€ä¸ª Cubeï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼š

- æ¿€æ´» Face selection modeï¼Œå¹¶é€‰æ‹©æ‰€æœ‰é¢ï¼›
- æ‰§è¡Œ Mesh - Normals - Flip å°†å…­ä¸ªé¢çš„æ³•çº¿åè½¬ï¼ŒæŒ‡å‘ç«‹æ–¹ä½“å†…éƒ¨ï¼›
- è®¾ç½® Viewport Overlays - Normals å¯ä»¥æ˜¾ç¤ºæ³•çº¿ï¼Œä»¥ç¡®è®¤æ³•çº¿æœå‘ï¼›
- æ‰§è¡Œ UV - Cube Projection ä½¿å„é¢çš„ UV åæ ‡é“ºæ»¡æ•´ä¸ªçº¹ç†ç©ºé—´ï¼›
- æ‰§è¡Œ Mesh - Split - Faces by Edges åˆ†ç¦»å…­ä¸ªé¢ï¼›
- æ‰§è¡Œ Mesh - Separate - By Loose Parts å°†å…­ä¸ªåˆ†ç¦»é¢ç‹¬ç«‹ä¸º Mesh å¯¹è±¡ï¼›
- æ“æŒå„ä¸ªé¢é€‰æ‹©çŠ¶æ€ï¼Œæ‰§è¡Œèœå•å¯¼å‡º Export - Wavefront (.obj)ï¼Œå¯¼å‡ºé€‰é¡¹è®¾ç½®ï¼š
    - Limit to: Selected Only åªå¯¼å‡ºå·²é€‰æ‹©çš„å…­ä¸ªé¢ï¼›
    - Foward Axis: -Z
    - Up Axis: Y

å³æ‰‹ç³» (right-hand system)ï¼Œä½¿å¤§æ‹‡æŒ‡ã€é£ŸæŒ‡ã€ä¸­æŒ‡äº’æˆç›´è§’ï¼Œå¤§æ‹‡æŒ‡ã€é£ŸæŒ‡ã€ä¸­æŒ‡åˆ†åˆ«æŒ‡å‘ xã€yã€z è½´
æ­£æ–¹å‘ï¼Œå¹¶ä¸”ä¸­æŒ‡æŒ‡å‘è‡ªå·±ã€‚è€Œå·¦æ‰‹ç³» (left-hand system)åˆ™æ˜¯ä¸­æŒ‡æŒ‡å‘ z è½´è´Ÿæ–¹å‘ï¼Œå¹¶ä¸”ä¸­æŒ‡æŒ‡å‘å‰æ–¹ã€‚

Godot åæ ‡ç³»ç»Ÿä¸­ï¼ŒæŒ‰ä»¥ä¸‹å‘é‡ç¡®å®šæ–¹å‘ï¼Œx è½´æŒ‡å‘ RIGHTï¼Œy è½´æŒ‡å‘ UPï¼Œz è½´æŒ‡å‘ BACK(backward)ï¼š

    Vector3.UP (0, 1, 0)
    Vector3.RIGHT (1, 0, 0)
    Vector3.FORWARD (0, 0, -1)

Blender è™½ç„¶ä¹Ÿä½¿ç”¨å³æ‰‹ç³»ï¼Œä½†æ˜¯å®ƒæ˜¯ z è½´å‘ä¸Šçš„ï¼Œè¿™ç‚¹ä¸ Godot ä¸åŒã€‚é€šè¿‡ä»¥ä¸Šçš„å¯¼å‡ºè®¾ç½®å¯ä»¥é€‚é… Godot
æ­£å¸¸ä½¿ç”¨çš„å³æ‰‹ç³»ï¼Œä¼šè‡ªåŠ¨å°† Blender çš„ -Z å¯¹åº”åˆ° Godot çš„ -Yï¼Œå³å¯¹é½åº•éƒ¨ï¼ŒBlender ä¸­æ˜¾ç¤ºçš„åº•éƒ¨ï¼Œ
åœ¨ Godot ä¸­ä¾ç„¶æ˜¯åº•éƒ¨ã€‚

å¯¼å‡ºåï¼Œå„ä¸ªé¢çš„é¡ºåºå¯ä»¥ç›´æ¥æ‰“å¼€ obj æ–‡ä»¶æŸ¥çœ‹ï¼Œåœ¨ Blender åœºæ™¯ä¸­ä¿®æ”¹ Mesh åç§°ä¼šæ”¹å˜æ˜¾ç¤ºé¡ºåºï¼Œ
ä½†å¯¼å‡ºçš„é¡ºåºå¯èƒ½è¿˜æŒ‰åŸæ¥çš„æ•°æ®é¡ºåºï¼Œå¯ä»¥æŒ‰éœ€è¦çš„é¡ºåºé‡æ–°å°† Mesh æ·»åŠ åˆ° Collection é›†ä½“ä¸­å†å¯¼å‡ºã€‚

Cube ä¸æ‘„åƒæœºå‰è¿›æ–¹å‘ç›¸åŒçš„ä¸€é¢ä¸º Backï¼Œç›¸åæ–¹å‘çš„ä¸€é¢ä¸º Frontï¼ŒåŒæ ·ï¼Œå·¦å³ä¸¤é¢ä¹Ÿä¸æ‘„åƒæœºçš„å·¦å³
å¯¹æ¢ã€‚åœ¨è´´çº¹ç†å›¾æ—¶ï¼ŒæŒ‰å‰é¢å±•ç¤ºçš„ Skybox çš„å›¾åƒå‘½åï¼Œå¯¹åº” Cube çš„é¢è¿›è¡Œè´´å›¾ã€‚å› ä¸ºï¼Œæ‘„åƒæœºéœ€è¦é€è¿‡
Cube çš„å†…è¡¨é¢æˆåƒï¼Œæœ‰ä¸‰ä¸ªé¢çš„ UV åæ ‡éœ€è¦å¯¹ U è½´åè½¬ï¼Œåˆ†åˆ«æ˜¯ Topã€Frontã€Rightï¼Œå¦å¤– Buttom
éœ€è¦ UV åŒæ—¶åè½¬ã€‚

è¿™ç§ç®€å•é€šè¿‡ Cube æ¨¡æ‹Ÿçš„ Skybox æœ‰ç¼ºç‚¹ï¼Œå°±æ˜¯æ‘„åƒæœºå‘é¡¶ã€åº•æ–¹å‘æ—¶ï¼Œæˆåƒä¼šæœ‰è¾ƒæ˜æ˜¾çš„çŸ©å½¢è¾¹ç•Œã€‚æ›´æ­£ç¡®
çš„åšæ³•æ˜¯ä½¿ç”¨ ArrayMesh ä¿®æ”¹å‡ ä½•ç»“æ„ï¼Œå¹¶å°† Box è¡¨é¢æ˜ å°„åˆ°çƒä½“ã€‚

```py
var vertices = PoolVector3Array()
vertices.push_back(Vector3(0, 1, 0))
vertices.push_back(Vector3(1, 0, 0))
vertices.push_back(Vector3(0, 0, 1))
# Initialize the ArrayMesh.
var arr_mesh = ArrayMesh.new()
var arrays = []
arrays.resize(ArrayMesh.ARRAY_MAX)
arrays[ArrayMesh.ARRAY_VERTEX] = vertices
# Create the Mesh.
arr_mesh.add_surface_from_arrays(Mesh.PRIMITIVE_TRIANGLES, arrays)
var m = MeshInstance.new()
m.mesh = arr_mesh
```


ç„¶åï¼Œé€šè¿‡ GDScript åŠ è½½å¯¼å‡ºçš„ Mesh å¹¶è®¾ç½®çº¹ç†ï¼š

```py
tool
extends Spatial
class_name SkyBox

onready var sky_mesh = load("res://assets/skybox/skybox.obj")

export(StreamTexture) var TextureLeft = null setget set_TextureLeft
func set_TextureLeft(value):
    TextureLeft = value
    set_mat()

export(StreamTexture) var TextureRight = null setget set_TextureRight
func set_TextureRight(value):
    TextureRight = value
    set_mat()

export(StreamTexture) var TextureFront = null setget set_TextureFront
func set_TextureFront(value):
    TextureFront = value
    set_mat()

export(StreamTexture) var TextureBack = null setget set_TextureBack
func set_TextureBack(value):
    TextureBack = value
    set_mat()

export(StreamTexture) var TextureBottom = null setget set_TextureBottom
func set_TextureBottom(value):
    TextureBottom = value
    set_mat()

export(StreamTexture) var TextureUp = null setget set_TextureUp
func set_TextureUp(value):
    TextureUp = value
    set_mat()

onready var _mesh:MeshInstance = $SkyMeshInstance

func create_mat(texture):
    var m = SpatialMaterial.new()
    m.flags_unshaded = true
    m.albedo_texture = texture
    return m

func set_mat():
    if _mesh:
        _mesh.queue_free()
    
    _mesh = MeshInstance.new()
    _mesh.name = "SkyMeshInstance"
    _mesh.mesh = sky_mesh
    add_child(_mesh)
    _mesh.owner = self
    print(_mesh.owner, sky_mesh)
    _mesh.set_surface_material(0, create_mat(TextureRight))
    _mesh.set_surface_material(1, create_mat(TextureLeft))
    _mesh.set_surface_material(2, create_mat(TextureFront))
    _mesh.set_surface_material(3, create_mat(TextureBack))
    _mesh.set_surface_material(4, create_mat(TextureBottom))
    _mesh.set_surface_material(5, create_mat(TextureUp))


func _ready():
    set_mat()
```



### ğŸŸ ğŸ”µ Blinn-Phong åŸºç¡€å…‰ç…§ç€è‰²æ¨¡å‹
- [GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744?p=7)
- [GAMES202 ä½œä¸š 0: WebGL æ¡†æ¶çš„ä½¿ç”¨ä¸ Blinn-Phong ç€è‰²æ¨¡å‹ é—«ä»¤çª](https://sites.cs.ucsb.edu/~lingqi/teaching/games202.html)
- [Learn OpenGL - Basic Lighting](https://learnopengl.com/Lighting/Basic-Lighting)
- [Learn OpenGL - Advanced Lighting](https://learnopengl.com/Advanced-Lighting/Advanced-Lighting)
- [Phong shading - HandWiki](https://handwiki.org/wiki/Phong_shading)
- [Blinnâ€“Phong reflection model From HandWiki](https://handwiki.org/wiki/Blinnâ€“Phong_reflection_model)
- [CS-116A: Introduction to Computer Graphics - Light and Color - Rob Bruce](http://www.cs.sjsu.edu/~bruce/fall_2016_cs_116a_lecture_light_and_color_part_1_of_2.html)

é—«ä»¤çªçš„ç½‘è¯¾ GAMES202: é«˜è´¨é‡å®æ—¶æ¸²æŸ“ï¼Œä½œä¸šé›¶æ˜¯ Blinn-Phong ç€è‰²æ¨¡å‹ç¼–ç¨‹çš„å®éªŒã€‚è¿™ç§ç€è‰²å™¨åˆå«
åå°„æ¨¡å‹ã€ä¿®æ­£æ¨¡å‹ï¼ŒBlinnâ€“Phong reflection model æˆ–è€… modified Phong reflection modelï¼Œ
æ˜¯ç”± Jim Blinnäº 1977 å¹´åœ¨æ–‡ç« ä¸­å¯¹ä¼ ç»Ÿ phong å…‰ç…§æ¨¡å‹åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹æå‡ºçš„ã€‚å®ƒæ˜¯ä¸€ä¸ªç»éªŒæ¨¡å‹ï¼Œ
å¹¶ä¸å®Œå…¨ç¬¦åˆçœŸå®ä¸–ç•Œä¸­çš„å…‰ç…§ç°è±¡ï¼Œä½†ç”±äºå®ç°èµ·æ¥ç®€å•æ–¹ä¾¿ï¼Œå¹¶ä¸”è®¡ç®—é€Ÿåº¦å’Œå¾—åˆ°çš„æ•ˆæœéƒ½è¿˜ä¸é”™ï¼Œå› æ­¤åœ¨
æ—©æœŸè¢«å¹¿æ³›çš„ä½¿ç”¨ã€‚

åŸæ¨¡å‹ä½œè€…æ˜¯ BÃ¹i TÆ°á»ng Phong (1942 â€“ 1975)ï¼Œä»–äº 1973 å¹´åœ¨çŠ¹ä»–å¤§å­¦å–å¾—è®¡ç®—æœºç§‘å­¦åšå£«å­¦ä½ï¼Œ
å¹¶å‘æ˜äº† Phong åå°„æ¨¡å‹åŠ Phong Shading ç€è‰²ç®—æ³•ï¼Œå¹¶å¹¿ä¸º CG ç•Œé‡‡ç”¨ï¼Œä½œè€… 1975 æ­»äºç™½è¡€ç—…ã€‚

åŒæ ·çš„æ¨¡å‹ï¼Œä½¿ç”¨ä¸åŒçš„ç€è‰²ç®—æ³•ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœï¼Œä»¥ä¸‹æ˜¯ä¸‰ç§æœ€åŸºç¡€çš„ä¸åŒç€è‰²é¢‘ç‡çš„æ¨¡å‹ï¼š

- Flat shding æŒ‰ä¸‰è§’é¢ç€è‰²ï¼Œper-faceï¼Œä½é¢‘ç€è‰²æ–¹æ³•ï¼›
- Gouraud shading æŒ‰é¡¶ç‚¹ç€è‰²ï¼Œper-vertexï¼Œå±äºä¸­é¢‘ç€è‰²æ–¹æ³•ï¼›
- Phong shding æŒ‰å’Œåƒç´ ç€è‰²ï¼Œper-pixelï¼Œå±äºé«˜é¢‘ç€è‰²æ–¹æ³•ï¼›

![Flat shading (left) versus Phong shading (right)](https://handwiki.org/wiki/images/8/84/Phong-shading-sample.jpg)


Blinn-Phong å…‰ç…§æ¨¡å‹å°†è¿›å…¥æ‘„åƒæœºçš„å…‰çº¿åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼ŒAmbientã€Diffuseã€Specularï¼Œå³ç¯å¢ƒå…‰ã€æ¼«åå°„
å’Œé«˜å…‰åå°„ï¼Œæ¯ä¸ªéƒ¨åˆ†ä½¿ç”¨ä¸€ç§æ–¹æ³•æ¥è®¡ç®—å®ƒçš„è´¡çŒ®åº¦ã€‚å°±æ˜¯è¯´ï¼Œåªè¦å°†è¿™ä¸‰ç§å…‰è®¡ç®—å‡ºæ¥ï¼Œå°±å¯ä»¥å®ç°å¸ƒæ—å†¯
å…‰ç…§æ¨¡å‹æ•ˆæœã€‚æ•´ä¸ª Blinn-Phong å…‰ç…§æ¨¡å‹çš„ç»“æœå°±æ˜¯ Lğ‘ + Lğ‘‘ + Lğ‘  ä¸‰è€…æ±‚å’Œï¼Œä»¥ä¸‹é€ä¸ªè§£æã€‚

![Blinn-Phong reflection model](https://handwiki.org/wiki/images/6/6b/Phong_components_version_4.png)


è®¡ç®—ä¸­éœ€è¦å…ˆå®šä¹‰ä¸€äº›å•ä½å‘é‡ç”¨äºè¡¨ç¤ºæ–¹å‘ï¼Œæ›´é«˜æ•ˆæœè¦æ±‚çš„ç€è‰²æ¨¡å‹è¿˜ä¼šéœ€è¦å…¶å®ƒå‚æ•°ï¼š

- **Viewer direction**ï¼Œè§‚å¯Ÿæ–¹å‘ï¼Œä½¿ç”¨ ğ‘£ è¡¨ç¤ºï¼Œç”±ç€è‰²ç‚¹æŒ‡å‘æ‘„åƒæœºï¼›
- **Surface normal**ï¼Œè¡¨é¢æ³•çº¿æ–¹å‘ï¼Œä½¿ç”¨ ğ‘› è¡¨ç¤ºï¼›
- **Light direction**ï¼Œå…‰çº¿å…¥å°„æ–¹å‘ï¼Œä½¿ç”¨ ğ‘™ è¡¨ç¤ºï¼Œç”±ç€è‰²ç‚¹æŒ‡å‘å…‰æºï¼›

![Lights reflection](https://pic1.zhimg.com/80/v2-62c91756b8b182383578c6708db35da4_1440w.webp)

ç¯å¢ƒå…‰ä¹Ÿç§°é—´æ¥å…‰ï¼Œå…‰çº¿ç»è¿‡å‘¨å›´ç¯å¢ƒè¡¨é¢å¤šæ¬¡åå°„åä¼šåœ¨ç‰©ä½“è¡¨é¢å½¢æˆå‡åŒ€ç»Ÿä¸€çš„å…‰ç…§æ•ˆæœï¼Œåˆ©ç”¨å®ƒå¯ä»¥æè¿°
ç‰©ä½“åŸºæœ¬å¤–è§‚äº®åº¦ï¼Œåœ¨å…‰ç…§æ¨¡å‹ä¸­ï¼Œé€šå¸¸ç”¨ä¸€ä¸ªå¸¸é‡æ¥è¡¨ç¤ºã€‚å…¬å¼è¡¨è¾¾å¦‚ä¸‹ï¼Œkğ‘ã€Iğ‘ åˆ†åˆ«ä¸ºç¯å¢ƒå…‰ç³»æ•°ã€å…‰å¼ºåº¦ã€‚

    Lğ‘ = kğ‘ â¨‰ Iğ‘

ä¸€èˆ¬ä¸Šï¼Œå¯¹äºä¸ªå…·æœ‰ä¸€å®šç²—ç³™åº¦çš„éå…‰æ»‘ç‰©ä½“ï¼Œå½“å…‰çº¿ç…§å°„åˆ°ç‰©ä½“æ—¶ï¼Œå…‰çº¿ä¼šè¢«å‡åŒ€çš„åå°„åˆ°å„ä¸ªæ–¹å‘ï¼Œè¿™ç§åå°„å…‰
ç§°ä¸ºæ¼«åå°„ã€‚ä»å¾®è§‚è§’åº¦çœ‹ï¼Œæ¨¡å‹åˆ†ææ¯ä¸€ç‚¹å…‰ç…§éƒ½è®¾å®šè¿™ä¸€ç‚¹æœ‰æ— æ•°æ–¹å‘å®Œå…¨éšæœºçš„æ³•çº¿ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ¼«åå°„ä¸­ï¼Œ
è§†è§’çš„ä½ç½®æ˜¯ä¸é‡è¦çš„ï¼Œå› æ­¤å¯ä»¥è®¤ä¸ºæ¼«åå°„å…‰åœ¨ä»»ä½•åå°„æ–¹å‘ä¸Šçš„åˆ†å¸ƒéƒ½æ˜¯ä¸€æ ·çš„ã€‚è€Œæ•´ä½“ä¸Šï¼Œç‰©ä½“çš„ä¸€ä¸ªé¢ä¸Šï¼Œ
å¤§å¤šæ•°æ³•çº¿éƒ½ä¸è¿™ä¸ªé¢å‚ç›´ï¼Œå…‰çº¿åå°„éµå¾ªæ•´ä½“è§„å¾‹ã€‚

åå°„å…‰ä¸åå°„ç³»æ•°æœ‰å…³ç³»ï¼Œreflection coefficientï¼Œç‰©ä½“è¡¨é¢åå°„å…‰çº¿çš„èƒ½åŠ›ï¼Œå°±æ˜¯åå°„å…‰å¼ºåº¦ä¸å…¥å°„å…‰
çš„å¼ºåº¦ä¹‹æ¯”å€¼ï¼Œå–å€¼ [0, 1]ï¼Œå—å…¥å°„å…‰çš„æŠ•å°„è§’åº¦ã€å¼ºåº¦ã€æ³¢é•¿ã€ç‰©ä½“è¡¨é¢ææ–™çš„æ€§è´¨ï¼Œä»¥åŠåå°„å…‰çš„è§‚å¯Ÿè§’åº¦
ç­‰å› ç´ å½±å“ã€‚

æ¼«å°„å…‰çš„å¼ºåº¦ä¸**å…¥å°„è§’åº¦**ï¼Œå…¥å°„å…‰çº¿ä¸æ³•çº¿çš„å¤¹è§’ï¼Œä»¥åŠå…¥å°„å…‰çº¿å¼ºåº¦ç›¸å…³ã€‚Lambert Consine Law
å…°ä¼¯ç‰¹ä½™å¼¦å®šå¾‹æŒ‡å‡ºï¼Œå…¥å°„å…‰è§’åº¦è¶Šå¤§ï¼Œæ¼«åå°„åˆ†é‡è¶Šå°ï¼Œå½“å¤¹è§’æ¥è¿‘ 90Â°ï¼Œè®¤ä¸ºæ¼«åå°„å‡ ä¹ä¸ºé›¶ï¼Œå…¨éƒ¨éƒ½æ˜¯
åå°„å…‰ã€‚å¤¹è§’å¤§äº 90Â° æ—¶çš„ä½™å¼¦å€¼å°äº 0ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå– 0 å€¼ã€‚

    f(Î˜) = max(0, cosÎ˜) = max(0, ğ‘™Â·ğ‘›)

ç‚¹ç§¯ ğ‘™Â·ğ‘› å°±æ˜¯æ±‚å‘é‡ ğ‘™ åœ¨ ğ‘› ä¸Šçš„æŠ•å½±ï¼Œå³åå°„å…‰çº¿å¼ºåº¦ï¼ŒÎ˜ ä¸ºå…¥å°„è§’ã€‚

å…‰çº¿å¼ºåº¦ä¼šéšç€è·ç¦»çš„å¢åŠ è€Œè¡°å‡ï¼Œå‡è®¾ä¸€ä¸ªå…‰æºï¼Œåœ¨è·ç¦»å®ƒå•ä½åœ†ä¸Šæ¯ä¸€ä¸ªç‚¹æ¥æ”¶åˆ°å…‰çš„å¼ºåº¦æ˜¯ Iã€‚é‚£ä¹ˆæ ¹æ®
èƒ½é‡å®ˆæ’å®šå¾‹ï¼Œä¸”ä¸è€ƒè™‘è¡°å‡ï¼Œåœ¨è·ç¦»å…‰æº r ä½ç½®çš„åœ†ä¸Šæ¯ä¸ªç‚¹æ¥æ”¶åˆ°å…‰çš„å¼ºåº¦å°±æ˜¯ I/rÂ²ã€‚æ‰€ä»¥ï¼Œæ¼«å°„å…‰å¼º
Lğ‘‘ å¯ä»¥è¡¨è¾¾ä¸ºä»¥ä¸‹å…¬å¼ï¼Œå…¶ä¸­ kğ‘‘ ä¸ºåå°„ç³»æ•°ï¼š

    Lğ‘‘ = kğ‘‘ â¨‰ (I/rÂ²) â¨‰ max(0, ğ‘™Â·ğ‘›)

è¿™ä¸ªå…¬å¼è¯´çš„æ˜¯ï¼Œæ¼«å°„å…‰ç­‰äºç€è‰²ç‚¹å¤„æ¥æ”¶åˆ°çš„å…‰èƒ½åœ¨åå°„ç³»æ•°ã€å…‰çº¿ä¼ æ’­è·ç¦»çº¦æŸä¸‹çš„åå°„å½¢æˆäºŒæ¬¡ä¼ æ’­çš„å…‰èƒ½ã€‚

![Diffuse and Specular](https://learnopengl.com/img/lighting/basic_lighting_specular_theory.png)

é«˜å…‰åå°„ä¹Ÿç§°ä¸ºé•œé¢åå°„ï¼Œå½“ç„¶å¹¶ä¸è¯´è¯´åªæœ‰é•œé¢æ‰æœ‰é«˜å…‰åå°„ï¼Œåªæ˜¯è¯´ä½“è¡¨é¢è¶Šå…‰æ»‘ï¼Œé•œé¢åå°„è¶Šæ˜æ˜¾ï¼Œç†æƒ³
æ¡ä»¶ä¸‹ï¼Œå®Œå…¨çš„é•œé¢æ˜¯æ²¡æœ‰æ¼«å°„å…‰çš„ã€‚å½“å¹³è¡Œå…¥å°„çš„å…‰çº¿å°„åˆ°è¿™ä¸ªç‰©ä½“è¡¨é¢æ—¶ï¼Œä»ä¼šå¹³è¡Œåœ°å‘ä¸€ä¸ªæ–¹å‘åå°„å‡ºæ¥ã€‚
å…¥å°„å…‰çº¿ ğ‘™ ç…§å°„åœ¨å…‰æ»‘çš„å¹³é¢ä¸Šï¼Œä¼šæ²¿ç€ R æ–¹å‘åå°„ï¼Œå½“è§‚å¯Ÿè§’åº¦æ­£å¥½ä¸ R æ–¹å‘å¯¹é½æ—¶ï¼Œè¿™æ—¶çš„é•œé¢åå°„å…‰
æœ€å¼ºï¼Œæœ€æ˜æ˜¾ã€‚éå®Œå…¨å…‰æ»‘çš„è¡¨é¢ä¸Šï¼Œé«˜å…‰åå°„çš„æ–¹å‘å¹¶éåªæœ‰ R ä¸€ä¸ªæ–¹å‘ï¼Œè€Œæ˜¯ R å‘¨è¾¹çš„ä¸€å°å—åŒºåŸŸï¼Œè§’åº¦
è¶Šæ¥è¿‘å°±è¶Šæ˜æ˜¾ã€‚å¯ä»¥å¾—å‡ºä¸€æ¡ç»“è®ºï¼šé«˜å…‰åå°„å’Œè¡¨é¢å…‰æ»‘åº¦ã€è§‚å¯Ÿè§’åº¦æœ‰å…³ã€‚

å¸ƒæ—å†¯æ¨¡å‹ä¸­è®¤ä¸ºï¼Œé«˜å…‰åå°„çš„å¼ºåº¦ä¸åå°„å…‰çº¿ R å’Œè§‚å¯Ÿè§’åº¦ ğ‘£ ä¹‹é—´å¤¹è§’çš„ä½™å¼¦å€¼æˆæ­£æ¯”ã€‚å®ƒçš„å¼ºåº¦ï¼Œç›¸å½“äº
æ±‚å‘é‡ ğ‘£ åœ¨ R ä¸Šçš„æŠ•å½±ï¼Œå³ ğ‘£Â·Rã€‚

ä½†æ˜¯ï¼Œå¯¹äºä¸€ä¸ªç°æˆçš„åœºæ™¯ï¼Œä¸€èˆ¬å·²çŸ¥é‡æ˜¯æ‘„åƒæœºä»£è¡¨çš„è§‚å¯Ÿæ–¹å‘ï¼Œç‰©ä½“è¡¨é¢æ³•çº¿æ–¹å‘ï¼Œä»¥åŠå…‰çº¿å…¥å°„æ–¹å‘ã€‚è€Œ
åå°„æ–¹å‘ R æ˜¯ä¸ªæœªçŸ¥é‡ï¼Œè™½ç„¶å¯ä»¥é€šè¿‡ä½™å¼¦å®šç†æ±‚è§£ï¼Œä½†æ˜¯è¿ç®—æ¯”è¾ƒéº»çƒ¦ã€‚

![Halfway vector](https://learnopengl.com/img/advanced-lighting/advanced_lighting_halfway_vector.png)

Blinn-Phong å¯¹å†¯æ°å…‰ç…§æ¨¡å‹çš„ä¸€ä¸ªæ”¹è¿›ï¼Œå°±æ˜¯è§‚å¯Ÿåˆ°äº†åŠç¨‹å‘é‡ half-angle vector å’Œæ³•çº¿æ–¹å‘æ¥è¿‘ï¼Œ
å°±è¡¨æ˜é«˜å…‰è¶Šæ˜æ˜¾ï¼Œè¿™ä¸€å‘ç°å°±é¿å…äº†ç›´æ¥è®¡ç®— R å€¼ï¼Œè€Œæ˜¯è®¡ç®—æ›´å®¹æ˜“å¾—åˆ°çš„åŠç¨‹å‘é‡ â„ï¼Œè®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š

    â„ = (ğ‘™ + ğ‘£)/|ğ‘™ + ğ‘£|

ä¹Ÿå°±æ˜¯åŠç¨‹å‘é‡ç­‰äºï¼Œå…¥å°„æ–¹å‘ä¸è§‚å¯Ÿæ–¹å‘çš„å‘é‡å’Œï¼Œé™¤äºä¸¤å‘é‡çš„æ¨¡ï¼Œç›¸å½“äºåš normalize å½’ä¸€åŒ–å¤„ç†ã€‚
æœ€åï¼Œé«˜å…‰åå°„å…‰å¯ä»¥è¡¨è¾¾ä¸ºä»¥ä¸‹å…¬å¼ï¼š

    Lğ‘  = kğ‘  â¨‰ (I/rÂ²) â¨‰ max(0, ğ‘›Â·â„)áµ–

é«˜å…‰åå°„ä¸é•œé¢ç¨‹åº¦æœ‰ä¸€äº›æ˜æ˜¾çš„è§†è§‰æ•ˆæœï¼Œé•œé¢ç¨‹åº¦è¶Šé«˜ï¼Œé«˜å…‰è¶Šé«˜å¹¶ä¸”é¢ç§¯ä¼šè¶Šå°ï¼Œæ˜æš—åˆ†ç•Œè¶Šæ¸…æ™°ï¼Œé€šè¿‡
è®¾ç½®æŒ‡æ•°å°±å¯ä»¥å®ç°è¿™ä¸€äº›æ•ˆæœï¼Œä¸€èˆ¬æŒ‡æ•°é¡¹ p å–å€¼ 64 æ¬¡æ–¹çš„æƒ…å†µä¸‹ï¼Œé«˜å…‰èŒƒå›´çš„è§’åº¦å¤§æ¦‚å¯¹åº” 35Â° å·¦å³ã€‚
è™½ç„¶ï¼Œåå°„å…‰è¿™æ˜¯ä½¿ç”¨çš„æ˜¯å¹‚è¿ç®—ï¼Œä½†æ˜¯å› ä¸ºå‘é‡éƒ½æ˜¯å•ä½å‘é‡ï¼Œç‚¹ç§¯æœ€å¤§å€¼ä¸ä¼šè¶…è¿‡ 1.0ï¼Œæ‰€ä»¥æŒ‡æ•°å€¼è¶Šå¤§ï¼Œ
å…‰æ–‘åè€Œä¼šè¶Šå°ã€‚

![basic lighting specular shininess](https://learnopengl.com/img/lighting/basic_lighting_specular_shininess.png)



### ğŸŸ ğŸ”µ Shadow Map é˜´å½±è´´å›¾
- [GAMES101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨  Geometry - é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/?p=12)
- [GAMES202 é«˜è´¨é‡å®æ—¶æ¸²æŸ“ - é—«ä»¤çª](https://www.bilibili.com/video/BV1YK4y1T7yY)
- [Optimized StencilShadow Volumes Cass Everitt & Mark J. Kilgard](https://slidetodoc.com/optimized-stencil-shadow-volumes-cass-everitt-mark-j/)
- [GPU Gems 1 - Part II: Lighting and Shadows](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows)
- [GPU Gems 3 - Part II: Light and Shadows](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows)
- [RTR4 å›¾å½¢å­¦åŸºç¡€ - é˜´å½± - ShadowMapåŠå…¶å»¶ä¼¸ - æ¨é¼è¶…](https://zhuanlan.zhihu.com/p/384446688)
- [Planar Shadow æ–¹å‘å…‰ - Jeffrey Zhuang](https://zhuanlan.zhihu.com/p/94491734)
- [Planar Shadow ç‚¹å…‰æº - Jeffrey Zhuang](https://zhuanlan.zhihu.com/p/94555744)
- [OGLDev Tutorial 40: Stencil Shadow Volume](https://ogldev.org/www/tutorial40/tutorial40.html)
- [æ¸¸æˆä¸­çš„é˜´å½±åŸºç¡€ - æ´›åŸ](https://zhuanlan.zhihu.com/p/27572129)
- [GAMES202 L3&L4&L5ï¼šå®æ—¶é˜´å½±ï¼ˆReal-time Shadowsï¼‰ - æˆ´å­ç²](https://zhuanlan.zhihu.com/p/471190375)
- Real-Time Rendering, Fourth Edition - Chapter 7 Shadows
- [é˜´å½±ä½“(shadow volume)](https://blog.csdn.net/zhao_92221/article/details/46756645)
- [å®æ—¶é˜´å½±æŠ€æœ¯ Real-time Shadows](https://www.cnblogs.com/KillerAery/p/15201310.html)
- [åä¸­ç§‘æŠ€å¤§å­¦ è®¡ç®—æœºå›¾å½¢å­¦ å®æ—¶é˜´å½± - ä¸‡ç³](https://www.bilibili.com/video/BV1V7411k74z?p=72)

Planar Shadow æ˜¯ä¸€ç§ç›´æ¥é€šè¿‡å‡ ä½•å˜æ¢ï¼Œå°†å›¾å½¢ä½œä¸ºé˜´å½±çš„ä¸€ç§ä½è¿ç®—å¾—çš„ä½æ•ˆæœçš„é˜´å½±æ¨¡æ‹ŸæŠ€æœ¯ï¼Œç›¸å½“äº
å°†å›¾å½¢æ‹å¹³åˆ°æŠ•å°„å¹³é¢ä¸Šï¼Œä¼˜ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼š

- ä¼˜ç‚¹ï¼šé˜´å½±è¾¹ç•Œå¯ä»¥å¾ˆæ¸…æ™°ï¼ŒèŠ‚çœ RenderTexture (RT)ï¼Œç›¸æ¯” shadow map å°±éœ€è¦ RTã€‚
- ç¼ºç‚¹ï¼šä¸é€‚ç”¨äºæ›²é¢ï¼Œæœ€å¥½çš„åº”ç”¨ç¯å¢ƒæ˜¯å¹³å¦åœ°å½¢ã€‚

é˜´å½±æ˜ å°„ Shadow Mapping æ˜¯ Williams äº 1978 å¹´å‘æ˜çš„ä¸€ç§æµè¡Œçš„é˜´å½±ç®—æ³•ï¼ŒåŒ Frank Crow äº
1977 å‘æ˜çš„ä½“ç§¯é˜´å½± Shadow volumes ç›¸æ¯”ï¼Œå…·æœ‰å‡ ä¸ªé‡è¦ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯ï¼Œé˜´å½±è´´å›¾å¯ä»¥åœ¨ä»»æ„ä½ç½®æŸ¥è¯¢ï¼Œ
å¹¶ä¸”å¯¹å‡ ä½•å¤æ‚æ€§ä¸å¤ªæ•æ„Ÿã€‚

Shadow Volume æœ€å¤§çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰é˜´å½±é”¯é½¿é—®é¢˜ï¼Œä½†å®ƒåŸºäºå‡ ä½•æ–¹æ³•ï¼Œæœ‰å¯èƒ½æ¯å¸§éƒ½è¦æ„é€ å’Œæ¸²æŸ“é˜´å½±é”¥ï¼Œ
è€Œä¸”æœ‰äº›å·¥ä½œå¿…é¡»ç”± CPU å®Œæˆï¼Œå¹¶ä¸”ï¼Œæ— æ³•å¤„ç†å…·æœ‰é€æ˜æè´¨ç‰©ä½“çš„é˜´å½±æŠ•å°„ï¼Œå¦‚å…¬å‘Šæ¿ï¼Œç²’å­ç³»ç»Ÿï¼Œæ ‘å¶ç­‰ã€‚
ä½¿å¾—å®ƒåœ¨æ•ˆç‡ä¸Šæ²¡æœ‰ Shadow Map é«˜ï¼Œå› ä¸ºåè€…è®¡ç®—éƒ½åœ¨ GPU å®Œæˆã€‚

Shadow Volume æ ¹æ®å…‰æºå’Œé®è”½ç‰©çš„ä½ç½®å…³ç³»è®¡ç®—å‡ºåœºæ™¯ä¸­ä¼šäº§ç”Ÿé˜´å½±çš„åŒºåŸŸï¼Œç„¶åå¯¹æ‰€æœ‰ç‰©ä½“è¿›è¡Œæ£€æµ‹ï¼Œ
ä»¥ç¡®å®šå…¶ä¼šä¸ä¼šå—é˜´å½±çš„å½±å“ã€‚ä¸‹å›¾çš„ç»¿è‰²ç‰©ä½“æ˜¯é®è”½ç‰©ï¼Œè€Œç°è‰²çš„åŒºåŸŸå°±æ˜¯ shadow volumeï¼Œé˜´å½±åŒºåŸŸå†…çš„
ç‰©ä½“æ‰ä¼šå—é˜´å½±çš„å½±å“ã€‚å‡å¦‚ä¸€ä¸ªç‰©ä½“é®ä½äº†å…‰æºæŠ•å°„å‡ºé˜´å½±ï¼Œå°±ç§°ç‰©ä½“ä¸º Shadow Caster (SC)ã€‚è€Œé˜´å½±æŠ•å°„
åˆ°å¦ä¸€ä¸ªç‰©ä½“ä¸Šå½¢æˆé˜´å½±ï¼Œå¦ä¸€ä¸ªç‰©ä½“å°±ç§°ä¸º Shadow Receiver (SR)ã€‚

![Optimized StencilShadow Volumes Cass Everitt & Mark J. Kilgard](https://img-blog.csdn.net/20150704160224644)

å›¾ç‰‡æ¥æºï¼šOptimized StencilShadow Volumes Cass Everitt & Mark J. Kilgard

![Z-pass vs. Z-fail](https://images0.cnblogs.com/i/292994/201408/042015297253279.png)

Shadow Volume çš„ä¸€ç§å®ç°æ˜¯ Z-pass ç®—æ³•ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•æ”¯æŒ stencil buffer åŠŸèƒ½çš„ GPU ä¸Šè¿è¡Œã€‚
åŸºæœ¬åŸç†å¦‚ä¸‹ï¼Œåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š

- Pass1ï¼šenable z-buffer write æ¡ä»¶ä¸‹æ¸²æŸ“æ•´ä¸ªåœºæ™¯ï¼Œå¾—åˆ°æ‰€æœ‰ç‰©ä½“çš„ depth mapã€‚
- Pass2ï¼šdisable z-buffer write & enable stencil buffer write æ¡ä»¶ä¸‹æ¸²æŸ“æ‰€æœ‰ shadow volumeã€‚
    å¯¹è§†çº¿ç©¿è¶Šé˜´å½±åŒºåŸŸè¾¹ç•Œè¿›è¡Œè®¡æ•°ï¼Œåœ¨æ·±åº¦æµ‹è¯•ç»“æœä¸º pass çš„å‰æä¸‹ï¼Œç©¿è¶Š front face å’Œ back face
    åˆ†åˆ« +1 å’Œ -1ï¼Œæ­£é¢å³é¢å¯¹è§†ç‚¹çš„è¿™ä¸€é¢ï¼Œè®¡æ•°ç»“æœå³ä¸º stencil å€¼ã€‚
- Pass3ï¼šæ ¹æ®æ¯ä¸ªè±¡ç´ çš„ stencil å€¼æ˜¯å¦å¤§äº 0 åˆ¤æ–­å…¶æ˜¯å¦å¤„äºé˜´å½±å½“ä¸­ï¼Œç„¶åæ®æ­¤ç»˜åˆ¶é˜´å½±æ•ˆæœã€‚

ä»¥ä¸Šè¿‡ç¨‹æ¦‚æ‹¬èµ·æ¥ï¼ŒZ-pass ç®—æ³•å°±æ˜¯ä»è§†ç‚¹å‘ç‰©ä½“å¼•ä¸€æ¡å°„çº¿ï¼Œå½“å®ƒå¯ä»¥ç©¿è¶Šæ‰€æœ‰ shadow volume åŒºåŸŸï¼Œ
å³ stencil = 0ï¼Œå³è¡¨ç¤ºè§†çº¿å¯ä»¥çœ‹åˆ°ç‰©ä½“ï¼Œå› ä¸ºå®ƒä¸åœ¨ shadow volume åŒºåŸŸå†…ã€‚

Z-pass ç®—æ³•é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œæ‘„åƒæœºæœ¬èº«æ˜¯å‡å®šä½äºé˜´å½±ä½“å¤–ï¼Œå½“æœ¬èº«å‡ºç°åœ¨é˜´å½±åŒºåŸŸå†…éƒ¨æ—¶ï¼Œç®—æ³•å°±å¤±æ•ˆäº†ã€‚

Z-fail ç®—æ³•æ˜¯ John Carmackï¼ŒBill Bilodeau å’Œ Mike Songy å„è‡ªç‹¬ç«‹å‘æ˜çš„ï¼Œå…¶ç›®çš„å°±æ˜¯è§£å†³
è§†ç‚¹è¿›å…¥ shadow volume å Z-pass ç®—æ³•å¤±æ•ˆçš„é—®é¢˜ã€‚å®ƒé’ˆå¯¹ Z-pass ç¬¬äºŒæ­¥ä½œäº†è¡¥å……ï¼Œåœ¨å°è¯•æµ‹è¯•ç»“æœ
ä¸º fail çš„æ¡ä»¶ä¸‹ï¼Œç©¿è¶Š front face å’Œ back face åˆ†åˆ«å¯¹ stencil å€¼ -1 å’Œ +1ï¼Œåˆšå¥½æ˜¯åå‘æ“ä½œã€‚


Shadow Map æ˜¯ç›®å‰ä¸»æµçš„é˜´å½±ç”Ÿæˆç®—æ³•ï¼Œè¿™ä¸»è¦å¾—ç›Šäºå®ƒç®—æ³•ç›´è§‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿå……åˆ†åˆ©ç”¨ç°ä»£ç¡¬ä»¶çš„å…‰æ …åŒ–èƒ½åŠ›ã€‚
è¿™ä¹Ÿæ˜¯å…¥é—¨å›¾å½¢å­¦çš„åŸºç¡€ç®—æ³•ä¹‹ä¸€ï¼Œç®—æ³•æ€è·¯æ˜¯é€šè¿‡è§†ç‚¹æ·±åº¦ä¸å…‰æºå°è¯•ä¿¡æ¯çš„æ¯”è¾ƒï¼Œç¡®å®šé˜´å½±åŒºåŸŸã€‚å¯¹äºç¡®å®š
å…‰æºæ¥è¯´ï¼Œåœºæ™¯ä¸­æŸä¸ªç‚¹æ˜¯å¦è¢«å…¶ç…§äº®ï¼Œå–å†³äºä»å…‰æºçš„è§†è§’çœ‹å»ï¼Œè¿™ä¸ªç‚¹æ˜¯å¦å¯è§¦åŠï¼Œä»¥åŠä»æ‘„åƒè§†è§’æ¥çœ‹ï¼Œ
è¿™ä¸ªç‚¹æ˜¯å¦å¯è§ã€‚å½“ä¸¤è€…ä»»æ„ä¸€æ–¹ä¸å¯ä»¥è§¦åŠä¸€ä¸ªä½ç½®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¡®å®šä¸€ä¸ªé˜´å½±ä½ç½®ã€‚

Shadow Map ç®—æ³•è¢«åˆ†æˆå…‰æºè§†è§’å¤„ç†ã€æ‘„åƒæœºè§†è§’å¤„ç†ä¸¤ä¸ªé˜¶æ®µï¼š

- ä»å…‰æºè§†è§’å‡ºå‘ï¼Œç»˜åˆ¶æ•´ä¸ªåœºæ™¯ï¼Œå¹³è¡Œå…‰ç”¨æ­£äº¤æŠ•å½±ï¼Œç‚¹å…‰ç”¨é€è§†æŠ•å½±ï¼ŒShadow Map è®°å½•ä¸‹ç‰©ä½“è¡¨é¢çš„è·ç¦»ï¼›
- ä»æ‘„åƒæœºè§†è§’å‡ºå‘ï¼Œé‡æ–°ç»˜åˆ¶åœºæ™¯ï¼Œè·å–ä¸–ç•ŒæŠ•å½±ç©ºé—´å†…çš„åƒç´ åˆ°å…‰æºçš„æ·±åº¦ dï¼›
- å¹¶æ ¹æ®å…‰æºæŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µï¼Œå°†ä¸–ç•Œåæ ‡ç©ºé—´å˜æ¢å›å…‰æºçš„æŠ•å½±ç©ºé—´ï¼Œæ‰¾å‡ºå¯¹åº”å…‰æºæŠ•å½±ç©ºé—´ UV åæ ‡ï¼›
- åˆ©ç”¨å…‰æºæŠ•å½±ç©ºé—´çš„ UV åæ ‡é‡‡æ · Shadow Mapï¼Œå¾—åˆ°å…‰æºè§†è§’ä¸‹çš„æ·±åº¦ä¿¡æ¯ ï¼›
- æ¯”è¾ƒä¸¤ä¸ªæ·±åº¦å€¼ï¼Œè‹¥ d > zï¼Œåˆ™å½“å‰ä½ç½®è¢«é®æŒ¡ï¼Œå¤„äºé˜´å½±å†…ï¼Œå¦åˆ™æœªè¢«é®æŒ¡ï¼›

![Shadow Map Projections](https://pic3.zhimg.com/80/v2-3f2c370b6b39cade31f8b3e4bf3d815e_1440w.webp)

å›é¡¾ä¸€ä¸‹ z-buffer ç®—æ³•ï¼Œæ·±åº¦å°±æ˜¯ç‰‡å…ƒçš„åˆ°ç›¸æœºçš„è·ç¦»ä¿¡æ¯ï¼Œé»˜è®¤å€¼ 1.0 è¡¨ç¤ºæ— é™è¿œï¼Œæ·±åº¦å›¾å°±æ˜¯ä¸€å¼ 
ç°åº¦å›¾åƒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæŠŠç›¸æœºä½ç½®æ¢æˆå…‰æºï¼Œé‚£ä¹ˆâ€œå…‰çœ‹ä¸åˆ°çš„åœ°æ–¹å°±æ˜¯é˜´å½±â€ï¼Œè¿™å°±æ˜¯é˜´å½±è´´å›¾çš„æ€æƒ³ã€‚
ç”±äºç›¸æœºè§†è§’å¤„ç†é˜¶æ®µï¼Œéœ€è¦çš„æ•°æ®åªæ˜¯æ·±åº¦å€¼ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå…‰ç…§è®¡ç®—å…³æ‰ï¼Œæ‰“å¼€ z-test å’Œ z-writeã€‚

![Depth map in Shadow map](https://pic2.zhimg.com/80/v2-7fc6cceda943968a08e8ec83fa46fe41_1440w.webp)

æ³¨æ„ï¼ŒShadow mapping å’Œ Shadow volume é‡Œé¢ä½¿ç”¨çš„ depth map æ˜¯æœ‰åŒºåˆ«çš„ï¼Œå‰è€…ä»¥å…‰æºå’Œè§†ç‚¹ã€
åè€…ä»¥è§†ç‚¹è§’åº¦è®¡ç®—å¾—åˆ°æ·±åº¦å›¾ã€‚


é˜´å½±è´´å›¾æ˜¯ä¸€ç§ç›¸å¯¹é«˜æ•ˆå’Œç›´è§‚çš„å…‰ç…§æ¨¡æ‹ŸæŠ€æœ¯ï¼Œåº”ç”¨æ­¤æŠ€æœ¯æœ‰ä¸‰å¤§éš¾ç‚¹ï¼š

- 1ï¼‰ Omnidirectional Shadow Mapsï¼šå…¨æ–¹å‘çš„é˜´å½±è´´å›¾
- 2ï¼‰ Depth Biasï¼šæ¯”è¾ƒæ·±åº¦æ—¶çš„åå·®é—®é¢˜
- 3ï¼‰ Aliasingï¼šé˜´å½±è´´å›¾çš„é‡‡æ ·å’Œé‡é‡‡æ ·é—®é¢˜

ç”±äºçº¹ç†é‡‡æ ·çš„ç¦»æ•£æ€§ç‰¹ç‚¹ï¼Œä»¥åŠæµ®ç‚¹æ•°çš„ç²¾åº¦è¯¯å·®ï¼Œä¸èƒ½ç›´æ¥æ¯”è¾ƒç›¸ç­‰å€¼ï¼Œç­‰ç­‰å› ç´ éƒ½ä¼šå¯¼è‡´é˜´å½±è´´å›¾èµ°æ ·ï¼Œ
äº§ç”Ÿæ‰€è°“çš„â€œShadow Acneâ€ã€‚ç‰¹åˆ«æ˜¯åœ¨ç¯å…‰ä¸æŠ•å½±å¹³é¢å¤¹è§’è¾ƒå¤§æ—¶ï¼Œé”¯é½¿ç°è±¡æ›´ä¸¥é‡ã€‚é€šå¸¸çš„è§£å†³æ–¹æ¡ˆæ˜¯æ¯”è¾ƒæ—¶
åŠ ä¸Šä¸€ä¸ªå›ºå®šåå·®å€¼ biasï¼Œä½†æ˜¯è‹¥åå·®å€¼é€‰å–è¿‡å¤§ï¼Œåˆä¼šäº§ç”Ÿâ€œPeter-Panningâ€é—®é¢˜ï¼Œå½±å­é£èµ·æ¥ã€‚è‡ªé€‚åº”
æ–¹æ¡ˆæ˜¯ Slope Scale Depth Biasï¼ŒåŸºäºæ–œç‡è®¡ç®—å½“å‰æ·±åº¦è¦åŠ çš„åå·®ã€‚

![Slope Scale Depth Bias](https://pic2.zhimg.com/80/v2-713a366f76e8637c7b27efbc95027ccd_1440w.webp)

Shadow Map äº§ç”Ÿé”¯é½¿çš„æ™®éåŸå› åœ¨äºï¼Œåæ ‡å˜æ¢æ˜¯è¿ç»­çš„ï¼Œä½†å…‰æ …åŒ–åçš„åƒç´ ä½ç½®åˆ™æ˜¯ç¦»æ•£çš„ï¼Œä¸è®ºé˜´å½±è´´å›¾
çš„ç²¾åº¦æœ‰å¤šé«˜ï¼Œéƒ½æ— æ³•ä¿è¯ä»å±å¹•ç©ºé—´çš„åƒç´ æ˜ å°„åˆ°å…‰æºç©ºé—´æ—¶ï¼Œèƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªä½ç½®å®Œå…¨åŒ¹é…çš„åƒç´ ã€‚ä¸€ä¸ªè§£å†³
è®¿æ±‚æ˜¯ï¼Œç™¾åˆ†æ¯”æ¸è¿›æ»¤æ³¢ Percentage-Closer Filtering (PCF)ï¼Œå½“è®¡ç®—ä¸€ä¸ªå±å¹•ç©ºé—´çš„åƒç´ æ˜¯å¦å¤„äº
é˜´å½±å½“ä¸­æ—¶ï¼Œéœ€è¦è€ƒè™‘å®ƒæŠ•å½±åˆ°çš„ Shadow Map ä½ç½®é™„è¿‘çš„å¤šä¸ªåƒç´ ï¼Œä½¿ç”¨é˜´å½±è½¯åŒ–ã€‚


### ğŸŸ ğŸ”µ Ray Trace å…‰çº¿è¿½è¸ª
- [å®æ—¶å…‰çº¿è¿½è¸ªæŠ€æœ¯ï¼šä¸šç•Œå‘å±•è¿‘å†µä¸æœªæ¥æŒ‘æˆ˜](https://zhuanlan.zhihu.com/p/102397700)
- [RTX Global Illumination (RTXGI)](https://developer.nvidia.com/rtx/ray-tracing/rtxgi)
- [DLSS 2.0 - é‡æ–°å®šä¹‰AIæ¸²æŸ“ - æ–‡åˆ€ç§‹äºŒ](https://zhuanlan.zhihu.com/p/116211994)
- [GAMES101 ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ Ray Tracing - é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744?p=13)
- [GAMES202 é«˜è´¨é‡å®æ—¶æ¸²æŸ“ Real-Time Ray Tracing - é—«ä»¤çª](https://www.bilibili.com/video/BV1YK4y1T7yY?p=12)
- [GAMES101 L15ï¼šå…‰çº¿è¿½è¸ª - è¾å°„åº¦é‡å­¦ã€æ¸²æŸ“æ–¹ç¨‹ã€å…¨å±€å…‰ç…§](https://www.yuque.com/sugelameiyoudi-jadcc/okgm7e/eb2c162cc558657da2aea25b68a6c580)
- [CS190I: Introduction to Offline Rendering Fall 2020](https://sites.cs.ucsb.edu/~lingqi/teaching/cs190I.html)
- [CS291A: Real-Time High Quality Rendering Spring 2020](https://sites.cs.ucsb.edu/~lingqi/teaching/cs291a.html)
- [Physically Based Rendering: From Theory to Implementation", 3rd](http://www.pbr-book.org/3ed-2018/contents.html)
- [Peter Shirley, "Ray Tracing in One Weekend -- The Book Series"](https://raytracing.github.io/)
- [Computer Graphics Lecture Notes 17 - Photorealistic Effects](http://www.cs.kent.edu/~farrell/cg00/lectures/rendering/render.html)
- [The Cornell Box](http://www.graphics.cornell.edu/online/box/)
- [Introduction to Ray Tracing: a Simple Method for Creating 3D Images](https://www.scratchapixel.com/lessons/3d-basic-rendering/introduction-to-ray-tracing/how-does-it-work)
- [ç©ºé—´æ•°æ®ç»“æ„(å››å‰æ ‘/å…«å‰æ ‘/BVHæ ‘/BSPæ ‘/k-dæ ‘)](https://www.cnblogs.com/KillerAery/p/10878367.html)

ä¸ºäº†ç®€åŒ–å›¾åƒæ ¼å¼å¸¦æ¥çš„é—®é¢˜ï¼Œä»¥å°†é‡å¿ƒæ”¾åˆ°å…‰çº¿è¿½è¸ªçš„å¤„ç†ä¸Šï¼ŒRay Tracing in One Weekend æ•™ç¨‹ä¸­
ä½¿ç”¨äº† Portable PixMap (PPM) ä¾¿æºåƒç´ å›¾ç‰‡æ ¼å¼ä¿å­˜å›¾åƒã€‚

PPM æ˜¯ Netpbm é¡¹ç›®å®šä¹‰çš„ä¸€ç³»åˆ—çš„å›¾ç‰‡æ ¼å¼ä¸­çš„ä¸€ä¸ªï¼š

|       Type       |  Magic Number & Format  | Extension |        Colors       |
|------------------|-------------------------|-----------|---------------------|
| Portable BitMap  | P1 (ASCII)  P4 (binary) | .pbm      | 0â€“1 (black & white) |
| Portable GrayMap | P2 (ASCII)  P5 (binary) | .pgm      | 0â€“255 (gray scale)  |
| Portable PixMap  | P3 (ASCII)  P6 (binary) | .ppm      | 0â€“255 (RGB)         |

PPM æ˜¯å…¶ä¸­ä¸€ç§æ”¯æŒå½©è‰²çš„æ ¼å¼ï¼Œæœ‰å­—ç¬¦ä¸²æ ¼å¼å’Œ binary ä¸¤ç§ä¿å­˜æ ¼å¼ï¼Œå¯¹åº” P3ã€P6 ä¸¤ä¸ªé­”æœ¯æ•°å­—ã€‚ä¾‹å¦‚ï¼Œ
ä»¥ä¸‹ä¸º ASCII ä¿å­˜çš„ PPM å½©è‰²å›¾åƒï¼Œåªæœ‰ 3x2 ä¸ªåƒç´ ï¼š

```sh
    P3
    # The magic number P3 means colors are in ASCII,
    # The magic number P6 means colors are in binary.
    3 2
    255
    # then 3 columns and 2 rows,
    # then 255 for max color,
    # then RGB triplets
    255 0   0   0   255   0   0 0 255
    255 255 0   255 255 255   0 0 0
```

å›¾åƒæ•°æ®éƒ¨åˆ†ï¼Œä½¿ç”¨ ASCII å­—ç¬¦ä¸²è¡¨ç¤º RGB ä¸‰ä¸ªåˆ†é‡ï¼Œå¹¶ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œå›¾åƒæ¯ä¸€è¡Œåƒç´ å¯¹åº”æ–‡ä»¶çš„ä¸€è¡Œï¼Œ
åƒç´ æ•°æ®ä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œä¸å›¾åƒå¯¹åº”ã€‚å½“ç„¶ï¼Œå®Œå…¨å¯ä»¥ä¸åˆ†è¡Œï¼Œåªéœ€è¦å®šä¹‰å¥½ columns x rows å³å¯ã€‚

å¯¹äº binary æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨å­—èŠ‚æ•°å€¼è¡¨ç¤º RGBï¼Œä¸éœ€è¦ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼Œä½¿ç”¨ P6 æ ¼å¼å°±æ˜¾å¾—æ²¡é‚£ä¹ˆå¯è¯»ï¼Œ
å¯ä»¥ç”¨ GIMPã€IrfanView ç­‰å·¥å…·ç”Ÿæˆï¼š

    00000000:  5036 0a23 2043 7265 6174 6564 2062 7920  P6.# Created by 
    00000010:  4972 6661 6e56 6965 770a 3320 320a 3235  IrfanView.3 2.25
    00000020:  350a ff00 0000 ff00 0000 ffff ff00 ffff  5...............
    00000030:  ff00 0000                                ....

ä½¿ç”¨ ffmpeg å¯ä»¥å°†å›¾ç‰‡åˆæˆä¸ºè§†é¢‘ï¼Œæˆ–è€… gif åŠ¨ç”»ï¼Œå›¾ç‰‡åç§°æ ¼å¼å¦‚ demo01.ppmï¼š

    ffmpeg -f image2 -framerate 15 -i demo%02d.ppm -loop -0 animation.gif

å›¾å½¢æ¸²æŸ“æœ‰ä¸¤å¤§å…¸å‹åº”ç”¨åœºæ™¯ï¼š

- ç¦»çº¿æ¸²æŸ“ offlineï¼Œå…¸å‹çš„æ˜¯ç”µå½±ä¸­åº”ç”¨ Ray tracing ç­‰é«˜ç«¯æŠ€æœ¯å’Œå¤§é‡çš„ç®—åŠ›ç”Ÿäº§æé«˜è´¨é‡çš„å›¾å½¢ã€‚
- å®æ—¶å…‰æ …åŒ–æ¸²æŸ“ real-timeï¼Œå…¸å‹çš„æ˜¯æ¸¸æˆåº”ç”¨ï¼Œéœ€è¦æƒè¡¡æ€§èƒ½ä¸ä½“éªŒï¼Œéœ€è¦åœ¨ä¿è¯æµç•…ä½“éªŒçš„å‰æä¸‹æé«˜ç”»è´¨ã€‚

å…‰çº¿è¿½è¸ªçš„ä¸¤ç§åŸºæœ¬å½¢å¼å¦‚ä¸‹ï¼š

- Forward Tracing (light tracing) å‘å…‰çº¿ä¼ æ’­æ–¹å‘è¿½è¸ªï¼›
- Backward Tracing (eye tracing) å‘å…‰çº¿æ¥è·¯æ–¹å‘è¿½è¸ªï¼›

çœ¼ç›è§‚å¯Ÿåˆ°çš„ä¸–ç•Œï¼Œå°±æ˜¯å…‰çº¿è¿›å…¥çœ¼çƒï¼Œæˆ–è€…è¯´çœ¼çƒç»“æ„é€šè¿‡èšç„¦è®©æ„Ÿå…‰ç»†èƒçœ‹åˆ°æˆåƒå¹³é¢ä¸Šçš„è‰²å½©ã€‚åœ¨æˆåƒå¹³é¢
ä¸Šï¼Œæœ‰æ— æ•°å¤šçš„ç‚¹ï¼Œæ¯ä¸ªç‚¹éƒ½ä¼šæœ‰å…‰å­è¢«åå°„åˆ°çœ¼ç›çš„è§†ç½‘è†œä¸Šï¼š

![photons & eyes](https://www.scratchapixel.com/images/upload/introduction-to-ray-tracing/lighttoeyebounce.png)


æŠ½è±¡çš„å…‰çº¿è¦ä»¥ä»£ç çš„å½¢å¼è¡¨è¾¾å®åœ¨æ˜¯æŠ½è±¡ä¸ŠæŠ½è±¡çš„å·¥ä½œï¼Œä½†æ˜¯è¿˜æ˜¯è¦å›åˆ°æ•°å­¦å·¥å…·ä¸Šæ¥ï¼Œå‘é‡æ˜¯å¿…ä¸å°‘çš„å·¥å…·ã€‚
Ray Tracing In One Weekend æ•™ç¨‹å°†å…‰çº¿æŠ½è±¡åœ°è¡¨è¾¾ä¸ºä¸€ä¸ªå°„çº¿ç±» ray classï¼Œè¿™æœ‰åŠ©äºç›´è§‚åœ°ç†è§£
å…‰çº¿è¿½è¸ªé‡Œçš„å°„çº¿å¦‚ä½•å·¥ä½œã€‚

æ‰€æœ‰å…‰çº¿è¿½è¸ªå™¨éƒ½ä¼šæœ‰ ray class ç”¨äºè®¡ç®—æ²¿ç€å…‰çº¿å‰è¡Œçš„å¯ä»¥çœ‹åˆ°ä»€ä¹ˆè‰²å½©ã€‚

![Figure 2: Linear interpolation](https://raytracing.github.io/images/fig-1.02-lerp.jpg)

å…ˆæ¥å‡è®¾ä¸€ä¸ªå‡½æ•° P(t) = A + tğ‘ï¼Œè¿™é‡Œ P è¡¨ç¤ºä¸€ä¸ªå…‰å­æ²¿ç€å…‰çº¿ä¸Šä¼ æ’­çš„ 3D åæ ‡ï¼ŒAã€ğ‘ åˆ†åˆ«æ˜¯å…‰çº¿çš„
ä¼ æ’­èµ·ç‚¹å’Œæ–¹å‘ã€‚å…‰çº¿å‚æ•° t æ˜¯ä¸€ä¸ªå®æ•°ï¼Œåœ¨ä»£ç ä¸­ç”¨ double ç±»å‹è¡¨ç¤ºã€‚ä½¿ç”¨ä¸åŒçš„ t å¯ä»¥ä½¿ç”¨å…‰å­ P(t) 
æ²¿å°„çº¿ç§»åŠ¨ç‚¹ã€‚

ä½¿ç”¨è´Ÿå€¼ t å¯ä»¥åœ¨ 3D ç©ºé—´ä¸Šæ²¿å…‰çº¿çš„å‘åçš„ä»»ä½•ä½ç½®ç§»åŠ¨ã€‚å¯¹äºæ­£å€¼ tï¼Œåªå¾—åˆ°èµ·ç‚¹ A å‰é¢çš„éƒ¨åˆ†ï¼Œè¿™å°±æ˜¯
é€šå¸¸æ‰€è¯´çš„åŠç›´çº¿æˆ–å°„çº¿ã€‚

    P(t) = origin + tâˆ—direction

é‚£ä¹ˆï¼Œå‡½æ•° P(t) å¯ä»¥è¡¨ç¤ºå…‰å­çš„è¿åŠ¨ï¼Œç”¨ä»£ç è¡¨ç¤ºï¼Œå°±æ˜¯ ray::at(t) æ–¹æ³•ä½¿åŸç‚¹å‘ç”Ÿå˜åŒ–ï¼Œå˜åŒ–é‡å°±æ˜¯
æ²¿ç€å‰è¿›æ–¹å‘çš„å•ä½å‘é‡ä¸å‚æ•° t çš„ä¹˜ç§¯ï¼š

```c++,ignore
#ifndef RAY_H
#define RAY_H

#include "vec3.h"

class ray {
    public:
        ray() {}
        ray(const point3& origin, const vec3& direction)
            : orig(origin), dir(direction)
        {}

        point3 origin() const  { return orig; }
        vec3 direction() const { return dir; }

        point3 at(double t) const {
            return orig + t*dir;
        }

    public:
        point3 orig;
        vec3 dir;
};

#endif
// Listing 8: [ray.h] The ray class
```

æœ‰äº†è¿™ä¸€å±‚æŠ½è±¡åï¼Œæ¥ä¸‹æ¥è¦åšçš„äº‹å°±æ˜¯å®ç°ä¸€ä¸ª ray tracerï¼Œæœ€æ ¸å¿ƒçš„æ˜¯ï¼Œå‡è®¾å®ƒä»ç›¸æœºä½ç½®å‘å‡ºå°„çº¿ï¼Œ
ç©¿è¿‡å±å¹•ä¸Šçš„åƒç´ ï¼Œå¹¶è®¡ç®—æ²¿å°„çº¿æ–¹å‘ä¸Šå¯ä»¥çœ‹åˆ°çš„è‰²å½©ã€‚

å½“ç„¶ï¼Œè¿™é‡Œåˆå¼•å…¥äº†ä¸€å±‚æŠ½è±¡ï¼Œå°„çº¿å¹¶éè¦çœŸçš„ç©¿é€å±å¹•ï¼Œè€Œæ˜¯ 3D ç©ºé—´æŠ½è±¡çš„ç›¸æœºæˆåƒå¹³é¢ï¼Œviewportï¼Œ
è¿™ä¸ªå¹³é¢è®°å½•çš„æ˜¯æ‰€æœ‰å¯ä»¥çœ‹åˆ°çš„è‰²å½©ï¼Œæœ€ç»ˆä¼šæ¸²æŸ“åˆ° frame buffer å¹¶è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚

æ‰€æ¶‰åŠçš„æ­¥éª¤æ˜¯ï¼š

1. è®¡ç®—ä»çœ¼ç›åˆ°åƒç´ çš„å…‰çº¿ï¼Œ
2. ç¡®å®šå…‰çº¿ä¸å“ªäº›å¯¹è±¡ç›¸äº¤ï¼Œä»¥åŠ
3. è®¡ç®—è¯¥äº¤ç‚¹çš„é¢œè‰²ã€‚

![Ray trace diagram](http://suncio.me/images/RayTraceDiagram.svg)

æ‰€ä»¥ï¼Œå…‰çº¿è¿½è¸ªé—®é¢˜åˆå›åˆ°äº†æ•°å­¦å·¥å…·çš„ä½¿ç”¨ä¸Šï¼Œå‡ ä½•å›¾å½¢çš„å¤„ç†é—®é¢˜ä¸Šã€‚ 

ä¾‹å¦‚ä¸‹å›¾ï¼Œå¾€æˆåƒå¹³é¢æ¯ä¸ªåƒç´ æ‰“ä¸€é“å°„çº¿ï¼Œå¹¶è®¡ç®—å®ƒä¼šä¸ä»€ä¹ˆå…‰æºæ¥è§¦ï¼Œå¹¶å°†ç»“æœè®°å½•ä¸‹æ¥ï¼š

![Lighting shadow](https://www.scratchapixel.com/images/upload/introduction-to-ray-tracing/lightingshadow.gif)
![Pixeld render](https://www.scratchapixel.com/images/upload/introduction-to-ray-tracing/pixelrender.gif)

å°è¯•å¼€å‘å…‰çº¿è·Ÿè¸ªå™¨æ—¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ç›¸æœºæ¥å¯åŠ¨å’Œè¿è¡Œä»£ç ï¼Œåˆ¶ä½œä¸€ä¸ªç®€å•çš„ ray_color(ray) å‡½æ•°ï¼Œ
å®ƒåªéœ€è¦è¿”å›èƒŒæ™¯çš„é¢œè‰²ï¼Œä¾‹å¦‚ä¸€ä¸ªç®€å•æ¸å˜è‰²å³å¯ã€‚

å¯¹äºä¸€ä¸ªå…‰çº¿ r å’Œçƒä½“ p æ±‚äº¤è¿ç®—ï¼Œå°±æ˜¯å°†å…‰çº¿æ–¹ç¨‹ä»£å…¥çƒä½“æ–¹ç¨‹ä¸­ï¼Œè¿™æ˜¯è§£æå‡ ä½•é—®é¢˜ï¼š

    Ray: r(t) = origin + tâˆ—direction, t >= 0

    Sphere: p: (p - c)Â² - RÂ² = 0

    Intersection: (origin + t*direction - c)Â² - RÂ² = 0

![GAMES101 Lecture 13 - Ray Intersection With Sphere](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257130807-a02c66ae-5d27-43d1-b53e-1e513f77d011.png)

å°±æ˜¯æ±‚è§£äºŒæ¬¡æ–¹ç¨‹ï¼š

    atÂ² + bt + c = 0, where
    a = direction Â· direction
    b = 2(o - c) Â· direction
    c = (o - c) Â· (o - c) - RÂ²

    t = (-b Â± âˆš(bÂ² - 4ac)) / 2a

å¯¹äºä»»æ„éšå¼å‡ ä½•æ›²é¢ï¼Œè¦æ±‚è§£ä¸å…‰çº¿æ–¹ç¨‹çš„äº¤ç‚¹ï¼Œåªéœ€è¦å°†å…‰çº¿æ–¹ç¨‹ä»£å…¥å‡ ä½•æ–¹ç¨‹ï¼Œå¹¶æ±‚è§£å®æ•°ã€æ­£æ•°æ ¹ï¼š

    Ray: r(t) = origin + tâˆ—direction, t >= 0

    General implicit surface: p: f(p) = 0

    Substitute ray equation: f(origin + t*direction) = 0
    
    Solve for real, positive roots

å¯¹äºæ˜¾å¼å‡ ä½•ä½“ï¼Œä¸€èˆ¬å°±æ˜¯ä¸‰è§’çš„è¿ç®—ï¼Œä¸‰è§’å½¢ä¹Ÿæ˜¯å›¾å½¢å­¦ä¸­æœ€åŸºç¡€æœ€å¸¸ç”¨çš„å‡ ä½•ä½“ï¼Œæ¨¡å‹ä¸­åŒ…å«å¤§é‡çš„ä¸‰è§’æˆ–
å››è¾¹å½¢ï¼Œä½†èƒ½é€šå¸¸ä¸ä¼šç›´æ¥å°†å…‰çº¿ä¸æ¯ä¸ªé¢è¿›è¡Œè¿ç®—ï¼Œè¿™ä¸ªè¿ç®—é‡æå¤§ã€‚åè€Œæ˜¯å¹³é¢çš„è¿ç®—æœ‰éå¸¸å¤§çš„ç”¨é€”ï¼ŒAABB
ç®—æ³•ä¸­å°±éœ€è¦è®¡ç®—å…‰çº¿ä¸å¹³é¢çš„äº¤ç‚¹ã€‚ä¸€ä¸ªä¸‰è§’å½¢å°±å¯ä»¥å½“ä½œä¸€ä¸ªå¹³é¢çœ‹å¾…ï¼Œé€šå¸¸ä½¿ç”¨æ³•çº¿å‘é‡å’Œä¸€ä¸ªç‚¹è¡¨è¾¾ã€‚

å¹³é¢çš„éšå¼è¡¨è¾¾æœ‰ä»£æ•°æ–¹ç¨‹æ–¹å¼ ax + by + cz + d = 0ï¼Œä¹Ÿæœ‰ç‚¹ã€æ³•çº¿å®šä¹‰æ–¹å¼ï¼š

    p : (p - pâ€˜) Â· N = 0

ä¸Šå¼æ„æ€æ˜¯ï¼šæ‰€æœ‰ p é›†åˆçš„ç‚¹æ»¡è¶³ï¼Œä¸å¹³é¢ä¸Šä¸€ç‚¹ pâ€˜ çš„å·®å€¼ä¸æ³•çº¿çš„å‰ç§¯ä¸º 0ã€‚è¦ä¸å…‰çº¿ç›¸äº¤ï¼Œåªéœ€è¦å°†
å…‰çº¿æ–¹ç¨‹ä»£å…¥ p å‚æ•°ï¼Œè®¾ p = r(t) å¹¶æ±‚è§£ tï¼š

    t = (pâ€˜ - origin)Â·N /(dÂ·N) = 0, 0<=t


![GAMES101 Lecture 13 - Ray Intersection With Plane](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257167963-81fb43a2-ece1-4db3-8079-013020ed0b77.png)

MÃ¶ller Trumbore Algorithm ç®—æ³•å¯ä»¥åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…éƒ¨ã€‚

![GAMES101 Lecture 13 - MÃ¶ller Trumbore Algorithm](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257174848-5dc69262-34b0-47ff-998f-9fb7c9415d5f.png)


çœŸå®åº”ç”¨åœºæ™¯ä¸‹çš„å…‰çº¿è¿½è¸ªé¢å¯¹çš„æ˜¯ä¸€ä¸ªå¤æ‚çš„ç¯å¢ƒï¼Œå¯èƒ½æœ‰å¤šå…‰æºï¼Œå¤šç‰©ä½“ï¼Œæœ‰æ— æ•°çš„è¿ç®—éœ€è¦å¤„ç†ï¼Œç®—æ³•æ˜¯
å¿…ç„¶éœ€è¦åšä¼˜åŒ–ã€‚Axis aligned bounding box (AABB) è½´å¯¹é½è¾¹ç•Œç›’å°±æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç©ºé—´æ±‚äº¤ç®€åŒ–ç®—æ³•ã€‚ 
AABB åŸºæœ¬æ€æƒ³æ˜¯ï¼Œç”¨ä¸€ä¸ªç›’å­çš„ä¸‰å¯¹é¢ï¼Œä¸Šä¸‹ã€å·¦å³ã€å‰åå„é¢å‡è®¾ä¸ºæ— é™å»¶ç”³çš„å¹³é¢ï¼Œç›’å­è‡ªèº«æ˜¯å®ƒä»¬çš„äº¤é›†ã€‚
ç„¶åï¼Œç‰©ä½“åŒ…è£¹åœ¨è¿™ä¸ªç›’å­å†…éƒ¨ï¼Œæ ¹æ®å…‰çº¿ä¸ä¸‰å¯¹é¢çš„å…³ç³»æ¥åˆ¤æ–­æ˜¯å¦çœŸæ­£ç›¸äº¤ï¼š

- æ˜¾ç„¶ï¼Œå¦‚æœå…‰çº¿æ²¡æœ‰å‡»ä¸­ç›’å­ï¼Œå³æ²¡æœ‰åŒæ—¶ç©¿è¿‡ä¸‰å¯¹é¢ï¼Œåˆ™ä¸å¯èƒ½ä¸ç‰©ä½“ç›¸äº¤ï¼›
- å…‰çº¿ä¸ä¸‰å¯¹é¢éƒ½ç›¸äº¤ï¼Œåˆ™å…‰çº¿å¯èƒ½ä¸ç‰©ä½“ç›¸å…³ï¼›

å¹¶ä¸” 2Dã€3D åŒæ ·é€‚ç”¨ï¼Œåªéœ€è¦è®¡ç®—å…‰çº¿è¿›å…¥ã€ç©¿é€ä½ç½®ï¼Œå…‰çº¿è¿›å…¥ã€ç©¿é€ä¸€å¯¹é¢çš„ä½ç½®è®°ä¸º tmin å’Œ tmaxï¼Œ
é‚£ä¹ˆï¼Œå…‰çº¿è¿›å…¥ã€ç©¿é€ç›’å­çš„ä½ç½®(æ—¶é—´)å°±ä¸ºï¼š

    tâ‚— = max(tmin)
    tâ‚’ = min(tmax)

åªè¦æ»¡è¶³ tâ‚— < tâ‚’ å³è¡¨ç¤ºå…‰çº¿åœ¨ç›’å­æœ‰åœç•™ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ç©¿é€äº†ä¸‰å¯¹é¢ã€‚å¦‚æœ tâ‚’ < 0 è¡¨ç¤ºç‰©ä½“åœ¨å…‰çº¿åæ–¹ï¼Œ
å³æ²¡æœ‰ç›¸äº¤ã€‚å¦‚æœï¼Œtâ‚— < 0 å¹¶ä¸” tâ‚’ >= 0ï¼Œå³è¡¨ç¤ºå…‰æºä½äºç›’å­å†…éƒ¨ã€‚

ä¸€èˆ¬ï¼Œtâ‚— < tâ‚’ && tâ‚’ >= 0 å°±è®¤ä¸ºå…‰çº¿ä¸ AABB ç›¸äº¤ã€‚

AABB æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç©ºé—´åˆ†å‰²æŠ€æœ¯ï¼ŒUniform Spatial Partitions (Grids)ï¼Œä¹Ÿæ˜¯æ ‘çŠ¶æ•°æ®ç»“æ„ç®—æ³•ã€‚
åœ¨å›¾å½¢å­¦ä¸Šï¼ŒåŸºäºæ ‘çŠ¶æ•°æ®ç»“æ„çš„ç®—æ³•å¯ä»¥å¸¦æ¥éå¸¸å¤§çš„æ€§èƒ½çš„æå‡ï¼Œç›¸å…³ç®—æ³•æ¯”è¾ƒå¦‚ä¸‹ï¼š

- BSP-tree äºŒå‰æ ‘åœ¨æ¸¸æˆå·¥ä¸šç®—æ˜¯è€åŠŸè‡£ï¼Œæ˜¯æ—©æœŸæŠ€æœ¯ï¼Œå°†ç©ºé—´äºŒç­‰åˆ†ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œå¦‚å¯¹è±¡å¹³é¢ç›¸äº¤æ—¶ã€‚
- Quad-treeã€Oct-tree å››å‰æ ‘/å…«å‰æ ‘å‡åŒ€åˆ‡åˆ†ä¸‰ç»´ç©ºé—´ï¼Œå¯¹è±¡åˆ†å¸ƒå‡åŒ€æ—¶æ’å…¥å’ŒæŸ¥è¯¢æ•ˆç‡è¾ƒé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ O(logN)ã€‚
- KD-tree æ˜¯å®šåˆ¶çš„äºŒå‰æ ‘ï¼ŒK-Dimensional treeï¼ŒèŠ‚ç‚¹è®°å½•ä¸€ä¸ª k ç»´åæ ‡ç‚¹ã€‚
- Bounding Volume Hierarchy (BVH) å±‚æ¬¡åŒ…å›´ç›’æ˜¯å¤šå‰æ ‘ã€‚

![GAMES101 Lecture 14 - Acceleration & Radiometry](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257855961-cd607ec6-e167-4ad9-aa80-6cd5ace37720.png)

BSP Trees å…¨ç§°äºŒç»´ç©ºé—´åˆ†å‰²æ ‘ Binary Space Partioning treesï¼Œä½¿ç”¨äºŒå‰æ ‘çš„å¶èŠ‚ç‚¹ä¿å­˜ç©ºé—´ä¸­çš„
å›¾å…ƒé›†åˆï¼Œä¸»è¦ç”¨äº Z-depth æ’åºï¼Œå®ç°èƒŒé¢å‰”é™¤ã€‚å› ä¸ºåœ¨ 90 å¹´ä»£åˆå—ç¡¬ä»¶é™åˆ¶ï¼Œåªèƒ½ä½¿ç”¨ BSP å¯¹ç©ºé—´ä¸­
çš„å›¾å…ƒè¿›è¡Œæ’åºï¼Œä»¥ä¿è¯æ¸²æŸ“å›¾å…ƒçš„é¡ºåºæ˜¯æŒ‰ç…§ç”±åè‡³å‰è¿›è¡Œçš„ï¼Œæ¢å¥è¯è¯´ï¼ŒZ å€¼æœ€å°çš„ç‰©ä½“æ€»æ˜¯æœ€åè¢«æ¸²æŸ“ã€‚

å››å‰æ ‘/å…«å‰æ ‘è¿™ç±»ç´§å¯†ç©ºé—´åˆ†å‰²ç®—æ³•æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç‰©ä½“æœ‰å¯èƒ½åœ¨è¾¹ç•Œå¤„æ¥å›ï¼Œä»è€Œå¯¼è‡´ç‰©ä½“æ€»æ˜¯åœ¨åˆ‡æ¢èŠ‚ç‚¹ï¼Œ
ä½¿å¾—æ•°æ®ç»“æ„ä¸­é¢‘ç¹åšèŠ‚ç‚¹çš„å¢åˆ æ“ä½œï¼Œå½±å“æ€§èƒ½ã€‚è€Œæ¾æ•£å››å‰æ ‘/å…«å‰æ ‘æ­£æ˜¯è§£å†³è¿™ç§è¾¹ç•Œé—®é¢˜çš„ä¸€ç§æ–¹å¼ï¼Œ
å®ƒå®šä¹‰èŠ‚ç‚¹æœ‰å‡ºå…¥å£è¾¹ç•Œï¼Œinner boundary vs. outerboundaryï¼Œè¾¹ç•ŒåŒºåŸŸä½œä¸ºä¸€ä¸ªç¼“å†²åœ°å¸¦é¿å…é¢‘ç¹æ“ä½œï¼Œ
å°±åƒæ–½å¯†ç‰¹è§¦å‘å™¨ Schmitt Trigger å·¥ä½œåŸç†ä¸€æ ·ã€‚

KD æ ‘çš„æ¯å±‚éƒ½æ˜¯å¯¹åº”ä¸€ä¸ªåˆ’åˆ†ç»´åº¦ï¼Œå–å†³äºä½¿ç”¨è€…å¦‚ä½•å®šä¹‰å„å±‚ä½¿ç”¨å“ªä¸ªç»´åº¦ã€‚æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¶…å¹³é¢ï¼Œ
è¯¥è¶…å¹³é¢å‚ç›´äºå½“å‰å±‚åˆ’åˆ†ç»´åº¦çš„åæ ‡è½´ï¼Œå¹¶åœ¨è¯¥ç»´åº¦ä¸Šå°†ç©ºé—´åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†åœ¨å…¶å·¦å­æ ‘ï¼Œå¦ä¸€éƒ¨åˆ†åœ¨
å…¶å³å­æ ‘æ¯æ¬¡åªæ²¿æŸä¸€ä¸ªè½´åˆ’åˆ†ã€‚

ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸ºä¸€ä¸ª 2D å¹³é¢çš„ KD-treeï¼Œç¬¬ä¸€å±‚åˆ’åˆ†ç»´åº¦ä¸º X è½´ï¼Œè¿‡èŠ‚ç‚¹åæ ‡ç«–ç›´åˆ†å‰²ï¼›ç¬¬äºŒå±‚ä¸º Y è½´ï¼Œ
è¿‡èŠ‚ç‚¹åæ ‡æ°´å¹³åˆ†å‰²ï¼›ç¬¬ä¸‰å±‚åˆä¸º X è½´ï¼Œè¿‡èŠ‚ç‚¹åæ ‡ç«–ç›´åˆ†å‰²ã€‚

![KD-tree](https://img2018.cnblogs.com/blog/1409576/201905/1409576-20190524233211006-2118364092.png)

ä½†æ˜¯ï¼Œè¿™äº›èŠ‚ç‚¹æ ‘ä½¿ç”¨å¶èŠ‚ç‚¹æ¥è®°å½•ç©ºé—´ä¸­çš„ç‰©ä½“ï¼Œéƒ½å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¸ªåŒºåŸŸçš„åˆ†å‰²çº¿å¯èƒ½ä¸åŒä¸€ç‰©ä½“æœ‰äº¤é›†ï¼Œ
è¿™ä¼šå¯¼è‡´åŒä¸€ä¸ªç‰©ä½“è®°å½•åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸­ã€‚å¹¶ä¸”ï¼ŒKD-tree è¿˜æœ‰æ›´ä¸¥é‡çš„é—®é¢˜ï¼Œå¾ˆéš¾å¤„ç†ä¸‰è§’å½¢å’Œç›’å­æ±‚äº¤ã€‚
è€Œç›´æ¥å¯¹ç‰©ä½“è¿›è¡Œåˆ’åˆ†çš„ BVH åˆ™å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œå­èŠ‚ç‚¹å­˜åŒ…å›´ç›’ï¼Œæ ¹èŠ‚ç‚¹ä»£è¡¨å¤§åŒ…å›´ç›’ï¼Œå¶èŠ‚ç‚¹è®°å½•ç‰©ä½“ï¼Œ
å¹¶çº¦æŸä¸€ä¸ªç‰©ä½“åªåœ¨ä¸€ä¸ªåŒ…å›´ç›’å†…ï¼ŒåŒ…å›´ç›’å¯èƒ½ç›¸äº¤ï¼Œä½†é—®é¢˜ä¸å¤§ï¼Œåªè¦åˆç†è§„åˆ’é™ä½åŒ…å›´ç›’é‡åˆåŒºã€‚ä¾‹å¦‚ï¼Œæ²¿é•¿
è½´æ–¹å‘åˆ’åˆ†ï¼Œå¹³å‡åœ°åˆ’åˆ†ä¸‰è§’å½¢æ•°é‡ã€‚

![Spatial vs. Object Partitions](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257912908-d9c99f26-76ad-4bd2-8e1d-6e5cd9d82750.png)


åœ¨ç ”ç©¶ç‰©ç†å…‰ç…§è§„å¾‹ä¹‹å‰ï¼Œéœ€è¦äº†è§£ä¸€ä¸‹è¾å°„åº¦é‡å­¦ç†è®ºçš„ä¸€äº›åŸºç¡€ï¼š

- **Solid angle** ç«‹ä½“è§’ï¼Œçƒé¢ä¸Šçš„æŠ•å½±é¢ç§¯ä¸åŠå¾„çš„å¹³æ–¹ä¹‹æ¯”ï¼Œç±»ä¼¼åœ†æœ‰ 2ğœ‹ å¼§åº¦ï¼Œçƒä½“æœ‰ 4ğœ‹ ç«‹ä½“å¼§åº¦ã€‚
- **Radiant Intensity** è¾å°„å¼ºåº¦æ˜¯å•ä½ç«‹ä½“è§’çš„è¾å°„é€šé‡ï¼Œä¸éšåŠå¾„å˜åŒ–ï¼Œå› ä¸ºå•ä½ç«‹ä½“è§’å¯¹åº”é¢ç§¯å æ¯”æ’å®šã€‚
- **Irradiance** è¾ç…§åº¦ï¼Œå•ä½é¢ç§¯æ¥æ”¶åˆ°çš„è¾å°„é€šé‡ï¼Œç§°ä¸ºè¯¥å¤„çš„è¾ç…§åº¦ï¼Œä¼šéšç€å…‰æºåŠå¾„å¢åŠ è€Œè¡°å‡ã€‚
- **Radiance** è¾å°„ï¼Œå•ä½æŠ•å½±é¢ç§¯æˆ–è€…å•ä½ç«‹ä½“è§’ä¸Šçš„è¾å°„é€šé‡ï¼Œå›¾å½¢å­¦ä¸­ä¸»è¦å…³å¿ƒå®ƒä»£è¡¨çš„å…‰çº¿ä¼ æ’­æ–¹å‘ã€‚
- **Incident Radiance** å…¥å°„è¾å°„ï¼ŒæŒ‡åˆ°è¾¾è¡¨é¢çš„å•ä½ç«‹ä½“è§’çš„è¾ç…§åº¦ã€‚
- **Exiting Radiance** å‡ºå°„è¾å°„ï¼Œç¦»å¼€è¡¨é¢çš„å•ä½æŠ•å½±é¢ç§¯çš„è¾å°„å¼ºåº¦ã€‚

![Radiosity Concepts](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617258508714-099b7136-5b79-470a-b69e-c7cead25bdd5.png)
![Differential solid angle](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617258521227-d45f943e-ea8f-47d4-bb34-519b530998b3.png)

åœ¨å›¾å½¢å­¦ä¸­ï¼Œå…³å¿ƒçš„æ˜¯å…‰æºå‘å°„çš„èƒ½é‡ã€å—å…‰ä½“æ¥å—åˆ°çš„èƒ½é‡ã€å…‰çº¿ä¼ æ’­æ–¹å‘ï¼š

- Radiant Intensity - Light Emitted From A Source
- Irradiance - Light Falling On A Surface
- Radiance - Light Traveling Along A Ray

![Light Source vs. Surface vs. Ray](https://cdn.nlark.com/yuque/0/2021/png/12962324/1617257932482-f621be8d-d5ce-4b61-a0be-40544395199a.png)

å…‰æºä¸Šå¼ºè°ƒçš„æ˜¯è¾å°„å¼ºåº¦è¶Šå¼ºï¼Œé‡Šæ”¾å‡ºæ¥çš„èƒ½é‡è¶Šå¤§ï¼Œç›¸å¯¹å°±è¶Šäº®ï¼Œå…‰æºä¸€èˆ¬åªè€ƒè™‘å¯¹å¤–çš„è¾å°„ï¼Œå³ radianceã€‚
å—å…‰ç‰©ä½“æ¥å—åˆ°çš„èƒ½é‡ä¸ºå…¥å°„å…‰ irradianceï¼Œå¯¹å¤–è¾å°„ä¸º radiances ä¹Ÿç§°äº®åº¦ luminanceï¼Œç›¸å½“å…‰æºã€‚


ä¸ºäº†å¯»æ‰¾ä¸€ç§èƒ½å¤Ÿæ›´å‡†ç¡®åœ°æ¸²æŸ“æ›´å…·æ¼«åå°„ç‰¹å¾çš„ç¯å¢ƒçš„æŠ€æœ¯ï¼Œ20ä¸–çºª80å¹´ä»£ä¸­æœŸï¼ŒDon Greenberg å’Œä»–åœ¨
åº·å¥ˆå°”å¤§å­¦çš„åˆä½œè€…è®¾è®¡äº†å›¾åƒåˆæˆçš„è¾å°„åº¦æ–¹æ³• radiosity methodï¼Œè¿™å°±æ˜¯ The Cornell Box ä¸­éµå¾ª
çš„æ¸²æŸ“åŸç†ï¼Œè¿™ä¸ªç›’å­ç»å¸¸åœ¨å›¾å½¢å­¦æ–‡ç« ä¸­çœ‹åˆ°ã€‚

![The Cornell Box](http://www.graphics.cornell.edu/online/box/box.jpg)

å…‰èƒ½ä¼ é€’çš„åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š

    radiosity = âˆ‘(emissions + reflections + transmissions)

- åœ¨ä¸€ä¸ªå°é—­ç³»ç»Ÿç¯å¢ƒä¸­ç ”ç©¶å…‰èƒ½é‡çš„å¹³è¡¡ï¼›
- å°é—­ç¯å¢ƒæ˜¯æŒ‡è¿™æ ·çš„ä¸€ä¸ªç¯å¢ƒï¼šä»ç»™å®šè¡¨é¢å‘å°„ã€åå°„çš„æ‰€æœ‰èƒ½é‡éƒ½è¢«å…¶ä»–è¡¨é¢åå°„å’Œå¸æ”¶ï¼›
- å¯ä»¥å®šä¹‰æ›²é¢å…‰èƒ½ä¼ é€’å€¼ï¼šèƒ½é‡ç¦»å¼€æ›²é¢çš„é€Ÿç‡ã€‚

å…‰èƒ½ä¼ é€’è®¡ç®—æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š

é¦–å…ˆï¼Œæ ¹æ®ç¯å¢ƒä¸­æ¯ä¸ªæ›²é¢çš„ path ä¸æ‰€æœ‰å…¶ä»–æ›²é¢é¢ç‰‡ä¹‹é—´çš„èƒ½é‡äº¤äº’é‡ï¼ˆå½¢çŠ¶å› å­ï¼‰è®¡ç®—å…¶æ›²é¢å…‰èƒ½ä¼ é€’ã€‚
è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹äºè§†å›¾çš„è¿‡ç¨‹ï¼›è™½ç„¶ç›¸å½“è€—æ—¶ï¼Œä½†æ¯ä¸ªåœºæ™¯åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼ˆå‰ææ˜¯èƒ½é‡å¹³è¡¡ä¸å˜ï¼‰ã€‚

ç„¶åï¼Œæ¸²æŸ“åœºæ™¯æ—¶è€ƒè™‘ aï¼‰å¯è§æ›²é¢ bï¼‰æ’å€¼ç€è‰² (flat or Gouraud)ã€‚è¿™æ˜¯ä¾èµ–äºè§†å›¾çš„è¿‡ç¨‹ï¼Œç§»åŠ¨ç›¸æœº
ä½ç½®æ„å‘³ç€éœ€è¦é‡æ–°è®¡ç®—å›¾åƒï¼Œä½†è¿™å‡ ä¹å¯ä»¥è¶³å¤Ÿå¿«åœ°å®ç°å®æ—¶æ¸²æŸ“ã€‚å½“ç„¶ï¼Œé€šè¿‡é€‚å½“çš„æŠ€å·§ï¼Œå…‰èƒ½ä¼ é€’å¯ä»¥ä»¥
æ¯ç§’ 15-20 å¸§çš„é€Ÿåº¦åŠ¨æ€ç”Ÿæˆæ¸²æŸ“å›¾åƒï¼Œå¯ä½œä¸ºæ¼«æ¸¸çš„åŸºç¡€ã€‚

ä¸å…‰çº¿è¿½è¸ªä¸€æ ·ï¼Œå…‰èƒ½ä¼ é€’ç†è®ºä¹Ÿç ”ç©¶è®¸å¤šé—®é¢˜é¢†åŸŸï¼Œä»¥åŠç§¯æç ”ç©¶çš„é¢†åŸŸï¼š

- ä½¿ç”¨å„ç§æ··åˆæ–¹æ³•ï¼Œç»“åˆé•œé¢åå°„ã€çœŸåå°„å’Œé€å°„æ•ˆæœæ˜¯å¯èƒ½çš„ï¼›ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›æ–¹æ³•ä¾èµ–äºè§†å›¾ã€‚
- å¿…é¡»åœ¨å…è®¸äº¤äº’å¼è°ƒæ•´ç…§æ˜å‚æ•°çš„ç³»ç»Ÿä¸­é‡æ–°è®¡ç®—å…‰èƒ½ä¼ é€’è§£å†³æ–¹æ¡ˆï¼Œå¦‚å‰§é™¢å’Œç…§æ˜è®¾è®¡ï¼Œç¯å…‰é¢œè‰²ä¿®æ”¹ã€‚
- å…‰èƒ½ä¼ é€’è§£å†³æ–¹æ¡ˆï¼ˆä»¥åŠç”Ÿæˆçš„å›¾åƒï¼‰çš„è´¨é‡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ›²é¢é¢ç‰‡çš„å®šä¹‰æ–¹å¼ï¼ˆæ›²é¢ç»†åˆ†ï¼‰ï¼Œä»¥åŠåœ¨å…³é”®åŒºåŸŸï¼ˆå°¤å…¶æ˜¯é˜´å½±ï¼‰ä¸­å¦‚ä½•é‡æ–°å®šä¹‰æ›²é¢é¢ç‰‡ã€‚
- ä¸å…‰çº¿è·Ÿè¸ªä¸€æ ·ï¼Œè¯¥æŠ€æœ¯çš„è®¡ç®—æ•ˆç‡å¯ä»¥é€šè¿‡å„ç§æ–¹å¼æé«˜ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡åŠ¨æ€é‡æ–°å®šä¹‰å½¢çŠ¶å› å­ï¼ˆæ¸è¿›ç»†åŒ–ï¼‰ã€‚



### ğŸŸ ğŸ”µ Subsurface Scattering æ¬¡è¡¨é¢æ•£å°„
- Real-Time Rendering - CH9 Physically Based Shading
- [The Last of Us 2 Wallpapers](https://wallpapercave.com/tlou2-wallpapers)
- [è§’è‰²æ¸²æŸ“æŠ€æœ¯â€”â€”çš®è‚¤ - æ´›åŸ](https://zhuanlan.zhihu.com/p/27014447)
- [Real-Time Rendering 3rd ç¬¬ä¸ƒç«  Â· é«˜çº§ç€è‰²ï¼šBRDFåŠç›¸å…³æŠ€æœ¯](https://zhuanlan.zhihu.com/p/28059221)
- [GPU Gems 3 çœŸå®æ„Ÿçš®è‚¤æ¸²æŸ“æŠ€æœ¯æ€»ç»“](https://zhuanlan.zhihu.com/p/42433792)
- [GPU Gems 3 - 14. Advanced Techniques for Realistic Real-Time Skin Rendering](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-14-advanced-techniques-realistic-real-time-skin)

åŠé€æ˜æè´¨ä¸æ¬¡è¡¨é¢æ•£å°„ï¼ˆTranslucent and Subsurface Scatteringï¼‰åœ¨ç”Ÿæ´»ä¸­æ— å¤„ä¸åœ¨ï¼šæ ‘å¶ã€çº¸ã€
èœ¡çƒ›ã€ç‰›å¥¶ã€å¸ƒæ–™ã€çš®è‚¤ã€è´å£³ã€ç›ç‘™ç­‰ã€‚éé‡‘å±ç‰©ä½“å‡ ä¹éƒ½å­˜åœ¨ Subsurface Light Transport (SSLT)
æ¬¡è¡¨é¢å…‰ä¼ è¾“ç°è±¡ï¼Œç”Ÿç‰©çš®è‚¤çŠ¹ä¸ºæ˜æ˜¾ã€‚

![Grapes](https://www.creativeshrimp.com/wp-content/uploads/2015/03/grapes_04.jpg)

åŠ¨ç‰©çš®è‚¤æ˜¯ä¸€ä¸ªå¤šå±‚ç»“æ„ï¼Œå…¶è¡¨é¢æ²¹è„‚å±‚ä¸»è¦è´¡çŒ®äº†çš®è‚¤å…‰ç…§çš„åå°„éƒ¨åˆ†ï¼Œçº¦å å…¥å°„å…‰ä¸­çš„ 6%ã€‚è€Œæ²¹è„‚å±‚ä¸‹çš„
è¡¨çš®å±‚ã€çœŸçš®å±‚åˆ™ä¸»è¦è´¡çŒ®äº†æ¬¡è¡¨é¢æ•£å°„éƒ¨åˆ†ï¼Œçº¦å å…¥å°„å…‰ä¸­çš„ 94%ã€‚ä»»ä½•æ²¡æœ‰ç›´æ¥ä»çš®è‚¤è¡¨é¢åå°„å‡ºå»çš„å…‰ï¼Œ
éƒ½ä¼šç›´æ¥è¿›å…¥æ¬¡è¡¨é¢å±‚ã€‚è¿™ç§å ä¸»è¦ä¸»å¯¼å› ç´ çš„æ¬¡è¡¨é¢æ•£å°„å±æ€§ï¼Œå†³å®šäº†çš®è‚¤åŠé€æ˜çš„ç‰¹å¾ä»¥åŠæŸ”è½¯çš„è§†è§‰å¤–è§‚ã€‚

![Figure 14-3 A Multilayer Skin Model](https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems3/elementLinks/14fig03.jpg)
![Figure 14-4 Scattering and Absorption in Multiple Tissue Layers](https://developer.nvidia.com/sites/all/modules/custom/gpugems/books/GPUGems3/elementLinks/14fig04.jpg)

å…¥å°„å…‰ä¸çš®è‚¤è¿›è¡Œäº¤äº’çš„è¿‡ç¨‹ä¸­ï¼Œè¢«éƒ¨åˆ†å¸æ”¶ï¼ˆè·å–é¢œè‰²ï¼‰å¹¶ç»è¿‡å¤šæ¬¡æ•£å°„ï¼Œè¿”å›å¹¶ä»è¿›å…¥ç‚¹å‘¨å›´çš„ 3D é‚»åŸŸå¤„
è¡¨é¢ç¦»å¼€ã€‚è€Œæœ‰æ—¶å…‰çº¿ä¼šå®Œå…¨ç©¿è¿‡åƒè€³æœµè¿™æ ·çš„è–„è–„åŒºåŸŸï¼Œå½¢æˆé€å°„ï¼ˆTransmittanceï¼‰ã€‚


Jensen åœ¨ 2001 å¹´çš„è®ºæ–‡ A Practical Model for Subsurface Light Transport æ¨å¯¼äº†è®¸å¤š
é‡è¦çš„ç‰©ç†å…¬å¼ï¼Œè®¡ç®—æ¨¡å‹ï¼Œæ¸²æŸ“æ—¶çš„å‚æ•°è½¬æ¢ï¼Œä»¥åŠæµ‹é‡äº†è®¸å¤šç”Ÿæ´»ä¸­å¸¸è§æè´¨çš„æ•£å°„ç³»æ•°ç­‰ç­‰ã€‚

æ¨¡æ‹ŸåŠé€æ˜ç‰©ä½“çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š

- Volumetric Path Tracing
- Volumetric Photon Mapping
- Bidirectional Scattering Distribution Function (BSDF)
    - Bidirectional Reflectance Distribution Function (BRDF)
    - Bidirectional Transmittance Distribution Function (BTDF)
    - Bidirectional Surface Scattering Reflectance Distribution Function (BSSRDF)

![BSDF BRDF BTDF BSSRDFå…³ç³»æ¼”ç¤º](https://pic2.zhimg.com/80/v2-715d6ac94c5775ad60a1570703d9921d_1440w.webp)

å…‰çº¿ä»ä¸€ç§ä»‹è´¨å°„å‘å¦å¤–ä¸€ç§ä»‹è´¨æ—¶ï¼Œå¯ä»¥æ ¹æ®å…‰çº¿è¡Œè¿›è·¯çº¿åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†å…‰çº¿åœ¨ä»‹è´¨äº¤ç•Œå¤„å‘ç”Ÿäº†åå°„ï¼Œ
å¹¶æœªè¿›å…¥å¦å¤–ä¸€ç§ä»‹è´¨ï¼›å¦å¤–ä¸€éƒ¨åˆ†å…‰çº¿åˆ™è¿›å…¥äº†å¦ä¸€ç§ä»‹è´¨ï¼Œå¯èƒ½å‘å±•ä¸ºæ¬¡è¡¨é¢åå°„æˆ–æŠ˜å°„ã€‚

åå°„å…‰å’Œå…¥å°„å…‰çš„è¾å°„ç…§åº¦ï¼Œradiance vs. irradianceï¼Œå…¶æ¯”ä¾‹æ˜¯ä¸€ä¸ªå’Œå…¥å°„è§’åº¦ã€å‡ºå°„è§’åº¦ç›¸å…³çš„å‡½æ•°ï¼Œ
è¿™ä¸ªå‡½æ•°å°±è¢«ç§°ä¹‹ä¸º**åŒå‘åå°„åˆ†å¸ƒå‡½æ•°** BRDFã€‚è€Œç©¿è¶Šä»‹è´¨éƒ¨åˆ†çš„å…‰ç…§æ¯”ä¾‹å°±ç§°ä¹‹ä¸º**åŒå‘é€å°„åˆ†å¸ƒå‡½æ•°** BTDFã€‚
åå°„å…‰ä¸é€å°„å…‰æ€»å’Œï¼Œä¸å…¥å°„å…‰çš„è¾å°„ç…§åº¦çš„æ¯”ä¾‹å°±å«åš**åŒå‘æ•£å°„åˆ†å¸ƒå‡½æ•°**ï¼Œä»èƒ½é‡å®ˆæ’è§’åº¦æ¥è¯´ï¼š

    BSDF = BRDF + BTDF

åŒå‘è¡¨é¢æ•£å°„åå°„åˆ†å¸ƒå‡½æ•° BSSRDF æ˜¯ç›®å‰çš„ä¸»æµæŠ€æœ¯ï¼Œç®€å•æ¥è¯´ï¼Œä¼ ç»Ÿçš„ BRDF æ¨¡å‹æ˜¯ä¸€ç§ç®€åŒ–è¡¨è¾¾ã€‚ä¸¤è€…
ä¸åŒä¹‹å¤„åœ¨äºï¼ŒBSSRDF å¯ä»¥æŒ‡å®šä¸åŒçš„å…‰çº¿å…¥å°„ä½ç½®å’Œå‡ºå°„çš„ä½ç½®ã€‚

- BRDF æ¨¡å‹ä¸­ï¼Œä¸€æ¬¡åå°„å…‰ç…§çš„è®¡ç®—æ˜¯åœ¨å…‰çº¿äº¤ç‚¹çš„æ³•çº¿åŠçƒä¸Šçš„çƒé¢ç§¯åˆ†ã€‚
- BSSRDF æ¨¡å‹ä¸­ï¼Œæ¯ä¸€æ¬¡åå°„åœ¨ç‰©ä½“è¡¨é¢ä¸Šæ¯ä¸€ä¸ªä½ç½®éƒ½è¦åšä¸€æ¬¡åŠçƒé¢ç§¯åˆ†ï¼Œæ˜¯ä¸€ä¸ªåµŒå¥—ç§¯åˆ†ã€‚






### ğŸŸ ğŸ”µ Environment & post-processing ç¯å¢ƒä¸åæœŸå¤„ç†
- [Environment and post-processing](https://docs.godotengine.org/en/latest/tutorials/3d/environment_and_post_processing.html)
- [Environment and post-processing](https://www.bilibili.com/video/BV1Km4y1X765/)
- [Godot 4.0 gets SDF based real-time global illumination](https://godotengine.org/article/godot-40-gets-sdf-based-real-time-global-illumination)
- [Volumetric fog and fog volumes](https://docs.godotengine.org/en/latest/tutorials/3d/volumetric_fog.html)

Godot 3.x é‡æ–°è®¾è®¡æä¾›äº† Environment èµ„æºï¼Œè¿™æ˜¯ä¸€ä¸ªåæœŸæ•ˆæœç³»ç»Ÿï¼Œæ¯ä¸ªåœºæ™¯ä¸­å¯ä»¥è®¾ç½®ä¸€ä¸ªä¸–ç•Œç¯å¢ƒ
èŠ‚ç‚¹ç”¨æ¥åŠ è½½ä¸€ä¸ªç¯å¢ƒé…ç½®èµ„æºï¼ŒWorldEnvironment åœ¨åœºæ™¯æ ‘ä¸­åªèƒ½æœ‰ä¸€ä¸ªï¼Œä½†å¯ä»¥åŠ è½½ä¸åŒçš„ç¯å¢ƒé…ç½®ã€‚

![project environment setting](https://docs.godotengine.org/en/3.5/_images/environment_default.png)

ç¯å¢ƒé…ç½®èµ„æºåŒ…æ‹¬ sky, ambient lighting, tone mapping, effects, adjustments ç­‰é…ç½®é€‰é¡¹ï¼Œ
å¯ä»¥å¯¹ç°æœ‰çš„åœºæ™¯æ•ˆæœè¿›è¡Œæ”¹å¤´æ¢è„¸èˆ¬çš„åæœŸå¤„ç†ã€‚åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­åˆ›å»ºçš„ç¯å¢ƒé…ç½®èµ„æºæœ¬èº«ä¸ä¼šèµ·ä½œç”¨ï¼Œé™¤éå°†å®ƒ
é€šè¿‡ä¸–ç•Œç¯å¢ƒèŠ‚ç‚¹åŠ è½½åˆ°åœºæ™¯æ ‘ä¸­ã€‚æˆ–è€…é€šè¿‡æ‘„åƒæœºçš„ç¯å¢ƒå±æ€§ä¸­æŒ‡å®šä¸€ä¸ªç¯å¢ƒé…ç½®ï¼Œè¿™ç§è®¾ç½®å¯ä»¥è¦†ç›–ä¸–ç•Œç¯å¢ƒã€‚
å¯ä»¥é€šè¿‡å·¥ç¨‹è®¾ç½®ï¼Œä¸ºå·¥ç¨‹æŒ‡å®šä¸€ä¸ªé»˜è®¤ç¯å¢ƒé…ç½®ï¼ŒProject Settings -> Rendering -> Environmentã€‚


ç¯å¢ƒé…ç½®ä¸­ï¼Œæä¾›äº†ä»¥ä¸‹å¤šç§å±æ€§ä»¥äº§ç”Ÿç›¸åº”çš„åæœŸæ•ˆæœï¼ŒåªæŒ‘é€‰é‡ç‚¹å†…å®¹è¯´æ˜ï¼š

|       å±æ€§      |                        è¯´æ˜                       |
|-----------------|---------------------------------------------------|
| Background      | èƒŒæ™¯è‰²å¡«å……                                        |
| Ambient         | Light ç¯å¢ƒå…‰                                      |
| Fog             | é›¾åŒ–æ•ˆæœ                                          |
| Tonemap         | è‰²è°ƒæ˜ å°„                                          |
| Auto Exposure   | è‡ªåŠ¨æ›å…‰                                          |
| SS Reflections  | å±å¹•ç©ºé—´åå°„å…‰ Screen-Space Reflections (SSR)     |
| SSAO            | Screen-Space Ambient Occlusion å±å¹•ç©ºé—´ç¯å¢ƒå…‰é®è”½ |
| DOF Far Blur    | åŸºäºæ·±åº¦åœºçš„è¿œæ™¯æ¨¡ç³Šï¼ŒDepth of Field (DoF)        |
| DOF Near Blun   | åŸºäºæ·±åº¦åœºçš„è¿‘æ™¯æ¨¡ç³Š                              |
| Glow            | è¾‰å…‰æ•ˆæœ                                          |
| Adjustments     | æ•´ä½“è°ƒæ•´                                          |
|-----------------|---------------------------------------------------|
| Reflected Light | åå°„å…‰                                            |
| SSIL            | Screen-Space Indirect Light                       |
| SDFGI           | Signed Distance Fields Global Illumination        |
| Volumetric Fog  | ä½“ç§¯é›¾                                            |

å…¶ä¸­ï¼Œå±å¹•ç©ºé—´åå°„å…‰åŠä»¥ä¸‹çš„é€‰é¡¹éƒ½å±äºä¸­åæœŸæ•ˆæœå¤„ç†ï¼Œæœ€åå››ç§ä¸º Godot 4.x å¢åŠ åŠŸèƒ½ã€‚

SDFGI è¿‘ä¼¼äºåŠ¨æ€å®æ—¶å…‰ç…§è´´å›¾ï¼ˆdynamic real-time lightmapï¼‰ï¼Œä½†ä¸éœ€è¦å±• UV ä¹Ÿä¸éœ€è¦ä½¿ç”¨è´´å›¾ã€‚
å¼€å¯ SDFGI å®ƒä¼šè‡ªåŠ¨å·¥ä½œï¼Œå¹¶å¯¹é™æ€ç‰©ä½“ç”Ÿæˆå…¨å±€å…‰ç…§ã€‚å®ƒä¸éœ€è¦å…‰çº¿è¿½è¸ªï¼Œå¯ä»¥åœ¨ç»å¤§å¤šæ•°æœ€æ–°çš„ GPU ä¸Š
ç”šè‡³å‡ å¹´å‰çš„ä¸­æ¡£å»‰ä»· CPU ä¸Šè¿è¡Œã€‚SDFGI çš„å¼€å‘å’Œæµ‹è¯•ä½¿ç”¨ Geforce 1060ï¼Œä¸€ç›´ä¿æŒç€ 60fps å¸§ç‡ã€‚
SDFGI ä¹Ÿæ”¯æŒåå°„ï¼Œæ— è®ºæ˜¯æ¼«åå°„è¿˜æ˜¯é•œé¢åå°„ï¼Œæ‰€ä»¥å…¨ PBR åœºæ™¯å°†ä¸æˆé—®é¢˜ã€‚


ğŸŸ¡**Background** å³ç”¨æ¥æŒ‡å®šåœºæ™¯ä¸­ç©ºç™½åŒºåŸŸçš„èƒŒæ™¯è‰²ï¼Œå¯ä»¥ä½¿ç”¨å›¾åƒã€é¢œè‰²ï¼Œæˆ–è€…ç¨‹åºåŒ–èƒŒæ™¯ï¼Œä¼šå½±å“ç‰©ä½“çš„
ç¯å¢ƒå…‰ä¸åå°„å…‰ï¼Œæœ‰å¤šç§æ¨¡å¼ï¼š

- **Clear Color** ä½¿ç”¨å·¥ç¨‹é»˜è®¤çš„æ¸…å±è‰²å¡«å……èƒŒæ™¯ï¼Œrendering/environment/default_clear_colorã€‚
- **Custom Color** ç±»ä¼¼ä»¥ä¸Šï¼Œä½†æ˜¯ç”±ç”¨æˆ·æŒ‡å®šé¢œè‰²ã€‚
- **Sky** ä½¿ç”¨ç¨‹åºåŒ–èƒŒæ™¯ï¼Œæä¾›ä¸€ä¸ª PanoramaSky 360Â° å¤©ç©ºçƒï¼Œæˆ–è€… ProceduralSky æ¢¯åº¦æ¸å˜å¤ªé˜³ï¼Œ
    æä¾›äº†å¤šç§å¤ªé˜³é€‰é¡¹è®¾ç½®ã€‚ç‰©ä½“å¯ä»¥åå°„æˆ–å¸æ”¶å¤©ç©ºçº¹ç†çš„ç¯å¢ƒå…‰ï¼Œåˆ›å»ºå¤©ç©ºçƒæ—¶éœ€è¦æŒ‡å®šçº¹ç†ã€‚
- **Color+Sky** å¯å®šä¹‰å¤©ç©ºï¼Œä½†ä½¿ç”¨çº¯é¢œè‰²å¡«å……èƒŒæ™¯ï¼Œå¤©ç©ºçƒä»…ä½œç”¨ä¸ºåå°„å…‰å’Œç¯å¢ƒå…‰ã€‚
- **Canvas** ç”»é¢æ¨¡å¼å¯ä»¥é…ç½® CanvasLayer çš„æ¸²æŸ“é¡ºåºä½¿ç”¨ã€‚
- **Keep** ä¿æŒæ®‹å½±ã€‚
- **Camera feed** 

![Environment Background](https://docs.godotengine.org/zh_CN/stable/_images/environment_background1.png)

ğŸŸ¡**Ambient Light** ç¯å¢ƒå…‰ï¼Œå³å‡ ä½•ä½“ä¸Šæ¯ä¸€å—çš„å…‰ç…§å¼ºåº¦éƒ½ä¸€æ ·çš„å…‰ï¼Œä¸åœºæ™¯ä¸­å…·ä½“çš„å…‰æºæ— å…³ã€‚

æ‰€è°“ç¯å¢ƒå…‰ ambient å³ç»è¿‡æ— æ•°æŠ˜å°„ååœ¨ç©ºé—´ä¸Šå‘ˆç°æåº¦å‡åŒ€çš„æŸ”å’Œå…‰ï¼Œæ— è®ºä»ä»€ä¹ˆè§’åº¦çœ‹ï¼Œç‰©ä½“çš„ç¯å¢ƒå…‰
éƒ½æ˜¯ä¸€è‡´çš„ã€‚æ‰€è°“æ¼«åå°„å…‰ diffuse å³å…‰çº¿æŠ˜å°„æ¬¡æ•°ä¸æ˜¯å¾ˆå¤šï¼Œå¹¶ä¸”å¯¹ä¸‹ä¸€ä¸ªç‰©ä½“çš„å—å…‰é¢æœ‰è¾ƒå¤§å½±å“ã€‚

![Ambient](https://docs.godotengine.org/en/latest/_images/environment_ambient2.png)

ç¯å¢ƒå…‰æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯æè´¨ä¸­çš„ Albedo çš„ç¯å¢ƒå…‰é¢œè‰² Ambient Colorï¼Œä»¥åŠä»å¤©ç©ºçƒè·å–åˆ°çš„ç¯å¢ƒèƒŒæ™¯è‰²ã€‚

å½“èƒŒæ™¯è®¾ç½®ä¸ºå¤©ç©º(Sky)æ—¶ï¼Œä½¿ç”¨å¤©ç©ºè´¡çŒ®åº¦(Sky Contribution) å±æ€§ï¼Œè®¾ç½®ç¯å¢ƒé¢œè‰²(ambient color)
å’Œå¤©ç©ºè‰²ä¹‹é—´çš„æ··åˆæ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º 1.0ï¼Œå› æ­¤åªæœ‰å¤©ç©ºè‰²ä¼šå½±å“å¯¹è±¡ã€‚

æœ€åï¼Œèƒ½é‡(Energy) å±æ€§æ˜¯ä¸€ä¸ªä¹˜æ•°ï¼Œåœ¨ä½¿ç”¨ HDR æ—¶éå¸¸æœ‰ç”¨ã€‚åœºæ™¯ä¸­è®¾ç½®çš„å…‰æºä¸ç¯å¢ƒå…‰å¯¹ç‰©ä½“çš„å½±å“æ˜¯
ä¸€ä¸ªæ··åˆè¿‡ç¨‹ï¼Œå…·ä½“æ•ˆæœä¸ä»…å–å†³äºèƒ½é‡çš„çº§åˆ«å¤§å°ï¼Œè¿˜å†³å®šäºç€è‰²å™¨çš„å®ç°ï¼Œé»˜è®¤ç€è‰²å™¨æ˜¯ä¸€ä¸ªé¢œè‰²å åŠ å…³ç³»ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œç¯å¢ƒå…‰åªç”¨äºç®€å•åœºæ™¯ã€å¤§å‹å¤–æ™¯ï¼Œæˆ–å‡ºäºæ€§èƒ½åŸå› ï¼Œå› ä¸ºç¯å¢ƒå…‰è¿ç®—é‡å°‘ï¼Œä¸èƒ½æä¾›æœ€ä½³çš„ç…§æ˜è´¨é‡ã€‚
é€šè¿‡ ReflectionProbe æˆ– GIProbe ç”Ÿæˆç¯å¢ƒå…‰æ˜¯æ›´å¥½çš„æ–¹æ¡ˆï¼Œè¿™æ ·å¯ä»¥æ›´çœŸå®åœ°æ¨¡æ‹Ÿé—´æ¥å…‰çš„ä¼ æ’­æ–¹å¼ã€‚


ğŸŸ¡**Fog** é›¾ï¼Œè¿™æ˜¯æ¨¡æ‹ŸçœŸå®æ„Ÿçš„ä¸€ä¸ªé‡è¦å› ç´ ï¼Œå°±åƒåœ¨ç°å®ç”Ÿæ´»ä¸­ä¸€æ ·ï¼Œä½¿è¿œå¤„çš„ç‰©ä½“é€æ¸æ¶ˆå¤±åœ¨å‡åŒ€çš„èƒŒæ™¯
é¢œè‰²ä¸­ã€‚ç‰©ç†æ•ˆæœå®é™…ä¸Šéå¸¸å¤æ‚, Godot æä¾›å¾ˆå¥½çš„è¿‘ä¼¼æ•ˆæœï¼Œæœ‰ä¸¤ç§é›¾ï¼š

- **Depth Fog** æ·±åº¦é›¾åŸºäºè·ç›¸æœºçš„è·ç¦»æ¥åº”ç”¨é›¾åŒ–æ•ˆæœã€‚
- **Height Fog** é«˜åº¦é›¾åº”ç”¨äºä»»ä½•é«˜åº¦ä½äº Height Min/Max ä¹‹é—´çš„ç‰©ä½“ï¼Œæ— è®ºè·ç¦»ç›¸æœºçš„è·ç¦»å¦‚ä½•ã€‚

![Depth Fog vs. Height Fog](https://docs.godotengine.org/en/3.5/_images/environment_fog_depth_height.png)

é›¾çš„æœ¬ä½“é¢œè‰²æ˜¯æ”¹å˜é›¾åŒ–æ•ˆæœçš„ç›´æ¥å› ç´ ï¼Œè¿™ä¸¤ç§é›¾ç±»å‹éƒ½å¯ä»¥è°ƒæ•´å®ƒä»¬çš„æ›²çº¿, ä½¿å®ƒä»¬çš„è¿‡æ¸¡æˆ–å¤šæˆ–å°‘å˜å¾—æ¸…æ™°ã€‚

å¯ä»¥è°ƒæ•´ä¸¤ä¸ªå±æ€§ä»¥ä½¿é›¾æ•ˆæœæ›´æœ‰è¶£:

- **Sun Amount**ï¼Œå®ƒåˆ©ç”¨ **Sun Color** é¢œè‰²ï¼Œåœ¨è§†è§’æœå‘å¹³è¡Œå…‰çš„å…¥å°„æ–¹å‘æ—¶ï¼Œæ¨¡æ‹Ÿç©¿è¿‡é›¾çš„é˜³å…‰ã€‚
- **Transmit Enabled** æ¨¡æ‹Ÿæ›´é€¼çœŸçš„é€å…‰ç‡ï¼Œåœ¨å®è·µä¸­ï¼Œå®ƒä½¿å…‰çº¿åœ¨é›¾ä¸­æ›´åŠ çªå‡ºã€‚

ğŸŸ¡**Tonemap** è‰²è°ƒæ˜ å°„é€‰é¡¹ä»…åœ¨ GLES3 é€‚ç”¨ã€‚

è‰²è°ƒæ˜ å°„é€‰æ‹©åº”ç”¨äºåœºæ™¯çš„è‰²è°ƒæ˜ å°„æ›²çº¿ï¼Œé€‰é¡¹ä¸ºç”µå½±å’Œæ¸¸æˆå·¥ä¸šä¸­æ‰€ä½¿ç”¨çš„æ ‡å‡†æ›²çº¿ã€‚é™¤çº¿æ€§æ¨¡å¼å¤–ï¼Œè‰²è°ƒæ˜ å°„
è¿ç®—å¯ä»¥ä½¿äº®éƒ¨å’Œæš—éƒ¨æ›´å‡åŒ€ï¼ŒåŒæ—¶é˜²æ­¢é«˜äº®åŒºåŸŸå—åˆ°è£å‰ªã€‚

**Mode** è‰²è°ƒæ˜ å°„ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼ï¼š

- **Linear** çº¿æ€§æ¨¡å¼æ˜¯é»˜è®¤å€¼ï¼Œæ˜¯æœ€å¿«ä¹Ÿæ˜¯æœ€ç®€å•çš„è‰²è°ƒæ˜ å°„è¿ç®—ï¼Œä¼šå¯¼è‡´é«˜äº®åŒºåŸŸè¿‡æ›ï¼Œæœ‰å¯è§çš„è£å‰ªã€‚
- **Reinhardt** é¢œè‰²å½±å°„ä¸º color = color / (1 + color)ï¼Œå¯ä»¥é˜²æ­¢è£å‰ªé«˜äº®åŒºåŸŸï¼Œä½†å¯èƒ½ä¼šæœ‰äº›æš—æ·¡ã€‚
- **Filmic** é˜²æ­¢è£å‰ªé«˜äº®åŒºåŸŸï¼Œæœ€ç»ˆçš„å›¾åƒé€šå¸¸æ¯”å‰è€…é²œè‰³ã€‚
- **ACES** å­¦é™¢è‰²å½©ç¼–ç ç³»ç»Ÿè‰²è°ƒæ˜ å°„å™¨ï¼ŒAcademy Color Encoding Systemã€‚å·²åºŸå¼ƒï¼ŒGodot 4.0 ä¸­ç§»é™¤ã€‚
- **ACES Fitted** æ›´è€—ç®—åŠ›ï¼Œä½†å¯¹äºé«˜äº®åŒºåŸŸçš„å¤„ç†æ–¹å¼æ›´çœŸå®ï¼Œå…‰çº¿è¶Šäº®é¥±å’Œåº¦è¶Šä½ï¼Œè¾“å‡ºçš„å›¾åƒå¯¹æ¯”åº¦æ›´é«˜ã€‚

è‰²è°ƒæ˜ å°„æ›å…‰ **Exposure** æ¨¡æ‹Ÿé•¿æ—¶é—´è·å–çš„å…‰ç…§é‡ï¼Œé»˜è®¤å€¼ 1.0ã€‚å€¼è¶Šé«˜ï¼Œæ•´ä½“æ›´äº®ã€‚ä¿®æ”¹è‰²è°ƒæ˜ å°„è¿ç®—å­
æˆ–ç™½ç‚¹åï¼Œå¦‚æœåœºæ™¯çœ‹ä¸Šå»å¤ªæš—ï¼Œè¯·å°è¯•å°†è¿™ä¸ªå€¼ç•¥å¾®è°ƒé«˜ã€‚

å…‰ç…§æ˜ å°„ç™½ç‚¹ **White** æ¨¡æ‹Ÿç™½è‰²åœ¨æ•´ä¸ªå°ºåº¦ä¸­æ‰€å¤„çš„ä½ç½®ï¼Œé»˜è®¤å€¼ 1.0ã€‚æ¨èå€¼ [6.0, 8.0]ï¼Œä»¥ä½¿å¾—
å…‰ç…§æ›´çœŸå®ã€‚å€¼è¶Šé«˜ï¼Œé«˜å…‰åŒºåŸŸæ›´å°‘è¿‡æ›ï¼Œä½†ä¼šè®©åœºæ™¯æ•´ä½“çœ‹èµ·æ¥æ›´æš—ã€‚


ğŸŸ¡**Auto Exposure (HDR)** è‡ªåŠ¨æ›å…‰é€‰é¡¹ä»…åœ¨ GLES3 é€‚ç”¨ã€‚

å°½ç®¡ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹è‰ºæœ¯å®¶ä¼šä¸¥æ ¼æ§åˆ¶ç…§æ˜å’Œçº¹ç†ï¼Œå‡ºäºçœŸå®æ€§æ•ˆæœï¼Œé€šè¿‡è‡ªåŠ¨æ›å…‰æœºåˆ¶å¯ä»¥ç®€å•åœ°æ”¯æŒé«˜åŠ¨æ€
èŒƒå›´å®ç°ï¼Œå¦‚ä½å…‰æˆ·å†…åŒºåŸŸå’Œé«˜å…‰æˆ·å¤–ç›¸ç»“åˆæ—¶çš„ç”»é¢ã€‚è‡ªåŠ¨æ›å…‰æ¨¡æ‹Ÿç›¸æœºæˆ–çœ¼ç›ï¼Œé€‚åº”æ˜æš—ä½ç½®å’Œä¸åŒå…‰é‡ã€‚

ä½¿ç”¨è‡ªåŠ¨æ›å…‰çš„æœ€ç®€å•æ–¹æ³•æ˜¯ï¼Œç¡®ä¿å®¤å¤–ç¯å…‰æˆ–å…¶ä»–å¼ºå…‰çš„èƒ½é‡è¶…è¿‡ 1.0ï¼Œé€šè¿‡è°ƒæ•´ç¯å…‰çš„ Energy ä¹˜æ•°å®ç°ã€‚
ä¸ºäº†ä½¿å…¶ä¿æŒä¸€è‡´ï¼ŒSky é€šå¸¸ä¹Ÿéœ€è¦ä½¿ç”¨èƒ½é‡ä¹˜æ•°ï¼Œä»¥é…åˆå¹³è¡Œå…‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•°å€¼åœ¨ 3.0 åˆ° 6.0 ä¹‹é—´ï¼Œ
å°±è¶³ä»¥æ¨¡æ‹Ÿå®¤å†…å®¤å¤–æ¡ä»¶ã€‚

é€šè¿‡å°†è‡ªåŠ¨æ›å…‰ä¸ Glow åå¤„ç†ç›¸ç»“åˆï¼Œè¶…è¿‡è‰²è°ƒæ˜ å°„ White çš„åƒç´ å°†ä¼šé€¸å‡ºè‡³è¾‰å…‰ç¼“å†²åŒºï¼Œä»è€Œåœ¨æ‘„å½±ä¸­
åˆ›é€ å…¸å‹çš„æ³›å…‰æ•ˆæœã€‚

è‡ªåŠ¨æ›å…‰éƒ¨åˆ†ä¸­çš„ç”¨æˆ·å¯æ§å€¼å…·æœ‰åˆç†çš„é»˜è®¤å€¼, ä½†ä»ç„¶å¯ä»¥è°ƒæ•´å®ƒä»¬ï¼š

- **Scale** ç”¨äºæ¯”ä¾‹ç¼©æ”¾ç…§æ˜ï¼Œè¾ƒå¤§çš„æ¯”ä¾‹å€¼ä¼šäº§ç”Ÿè¾ƒäº®çš„å›¾åƒï¼Œè¾ƒå°çš„å€¼ä¼šäº§ç”Ÿè¾ƒæš—çš„å›¾åƒã€‚
- **Min Luma** è‡ªåŠ¨æ›å…‰è°ƒæ•´çš„æœ€å°äº®åº¦ï¼Œäº®åº¦æ˜¯å±å¹•æ‰€æœ‰åƒç´ ä¸­å…‰çº¿çš„å¹³å‡å€¼ã€‚
- **Max Luma** è‡ªåŠ¨æ›å…‰è°ƒæ•´çš„æœ€å¤§äº®åº¦ã€‚
- **Spped** äº®åº¦æ ¡æ­£çš„é€Ÿåº¦ï¼Œå€¼è¶Šé«˜ï¼Œæ ¡æ­£æ•ˆæœå‡ºç°é€Ÿåº¦è¶Šå¿«ã€‚


ğŸŸ¡**Glow** è¾‰å…‰æ˜¯æŒ‡è¶…é¥±å’Œçš„é«˜å…‰å¯¹å‘¨å›´é¢œè‰²äº§ç”Ÿçš„å½±å“ï¼Œåœ¨æ‘„å½±å’Œèƒ¶ç‰‡ä¸­ï¼Œå½“å…‰é‡è¶…è¿‡ä»‹è´¨æ”¯æŒçš„æœ€å¤§å€¼æ—¶ï¼Œ
æ— è®ºæ˜¯æ¨¡æ‹Ÿè¿˜æ˜¯æ•°å­—æŠ€æœ¯ï¼Œè¿™äº›é«˜å…‰é€šå¸¸ä¼šå‘å›¾åƒå‘¨å›´è¾ƒæš—åŒºåŸŸæ¸—å‡ºã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå³ä½¿å¯ç”¨äº†æ•ˆæœï¼Œå¯èƒ½ä¹Ÿä¼šå˜å¼±æˆ–ä¸å¯è§ã€‚å®é™…è¾‰å…‰å‘ç”Ÿéœ€è¦ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ï¼šHDR é˜ˆå€¼å’Œ Bloomã€‚

åƒç´ ä¸­çš„å…‰çº¿è¶…è¿‡ HDR é˜ˆå€¼ï¼Œå…¶ä¸­ 0 è¡¨ç¤ºæ‰€æœ‰å…‰çº¿éƒ½è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œ1.0 è¡¨ç¤ºå…‰çº¿è¶…è¿‡è‰²è°ƒæ˜ å°„å™¨ç™½å€¼å³æº¢å‡ºã€‚
é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼åº”è¯¥åœ¨ 1.0ï¼Œä½†å®ƒå¯ä»¥è°ƒä½ä»¥å…è®¸æ›´å¤šçš„å…‰çº¿æ¸—å…¥ã€‚è¿˜æœ‰ï¼Œé¢å¤–çš„å‚æ•° HDR Scale å…è®¸
å¯¹è¶…è¿‡é˜ˆå€¼çš„å…‰çº¿è¿›è¡Œç¼©æ”¾ï¼Œä½¿å…¶æ›´äº®æˆ–æ›´æš—ã€‚

æ³›å…‰æ•ˆæœ Bloom effect å€¼è®¾ç½®å¤§äº 0ã€‚éšç€å®ƒçš„å¢åŠ ï¼Œå®ƒä¼šä»¥æ›´é«˜çš„æ•°é‡å°†æ•´ä¸ªå±å¹•å‘é€åˆ°è¾‰å…‰å¤„ç†å™¨ã€‚

ä»¥ä¸Šä¸¤è€…éƒ½ä¼šå¯¼è‡´å…‰ä»è¾ƒäº®çš„åŒºåŸŸå¼€å§‹é€¸å‡ºï¼Œä¸€æ—¦çœ‹åˆ°è¾‰å…‰ï¼Œå°±å¯ä»¥é€šè¿‡ä¸€äº›é¢å¤–çš„å‚æ•°æ¥æ§åˆ¶å®ƒï¼š

- **Intensity** å¼ºåº¦æ˜¯æ•ˆæœçš„æ•´ä½“æ¯”ä¾‹ï¼Œå¯ä»¥å°†å…¶å¢å¼ºæˆ–å‡å¼±ï¼Œ0.0 å¯ä»¥å°†å…¶åˆ é™¤ã€‚
- **Strength** è°ƒæ•´é«˜æ–¯æ»¤æ³¢å™¨å†…æ ¸çš„å¤„ç†å¼ºåº¦ï¼Œæ•°å€¼è¶Šå¤§ï¼Œæ»¤æ³¢å™¨è¶Šé¥±å’Œå¹¶å‘å¤–æ‰©å±•ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¿®æ”¹ Levels æ›´æœ‰æ•ˆåœ°è°ƒæ•´å¤§å°ã€‚

æ•ˆæœçš„æ··åˆæ¨¡å¼å¦‚ä¸‹ï¼š

- **Additive** æ·»åŠ æ˜¯æœ€å¼ºçš„ä¸€ç§ï¼Œå› ä¸ºå®ƒåªåœ¨å›¾åƒä¸Šæ·»åŠ è¾‰å…‰æ•ˆæœï¼Œä¸æ¶‰åŠæ··åˆã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒå¤ªå¼ºäº†ï¼Œä¸èƒ½ä½¿ç”¨ï¼Œä½†åœ¨ä½å¼ºåº¦çš„æ³›å…‰ä¸‹å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä¼šäº§ç”Ÿä¸€ç§æ¢¦å¹»èˆ¬çš„æ•ˆæœã€‚
- **Screen** ç¡®ä¿è¾‰å…‰æ°¸è¿œä¸ä¼šæ¯”è‡ªå·±æ›´äº®ï¼Œå®ƒä½œä¸ºä¸€ä¸ªå‘¨å›´çš„æ–¹å¼å°†éå¸¸å¥½ã€‚
- **Softlight** æ˜¯é»˜è®¤çš„ï¼Œä¹Ÿæ˜¯æœ€å¼±çš„ä¸€ç§ï¼Œåªåœ¨ç‰©ä½“å‘¨å›´äº§ç”Ÿç»†å¾®çš„é¢œè‰²æ‰°åŠ¨ï¼Œåœ¨é»‘æš—åœºæ™¯ä¸­æ•ˆæœæœ€å¥½ã€‚
- **Replace** ç”¨æ¥æ¨¡ç³Šæ•´ä¸ªå±å¹•æˆ–è°ƒè¯•è¾‰å…‰æ•ˆæœï¼Œå®ƒåªæ˜¾ç¤ºè¾‰å…‰çš„æ•ˆæœï¼Œæ²¡æœ‰åé¢çš„å›¾åƒã€‚

è¾‰å…‰ç­‰çº§ Levels æä¾›äº† 7 ä¸ªç”¨äºæ”¹å˜è¾‰å…‰æ•ˆæœçš„å¤§å°å’Œå½¢çŠ¶é…ç½®ï¼Œè¾ƒå°çš„çº§åˆ«åœ¨ç‰©ä½“å‘¨å›´å‡ºç°è¾ƒå¼ºçš„è¾‰å…‰ï¼Œ
è€Œå¤§çš„çº§åˆ«æ˜¯è¦†ç›–æ•´ä¸ªå±å¹•çš„æœ¦èƒ§è¾‰å…‰ã€‚ç„¶è€Œï¼Œè¿™ä¸ªç³»ç»Ÿçš„çœŸæ­£ä¼˜åŠ¿åœ¨äºç»“åˆ Levels æ¥åˆ›é€ æ›´æœ‰è¶£çš„è¾‰å…‰æ¨¡å¼ã€‚

æœ€åï¼Œéšç€æœ€é«˜çš„å›¾å±‚åœ¨å¯¹å¾®å°æ¨¡ç³Šå›¾åƒçš„æ‹‰ä¼¸ä¸­è¢«åˆ›å»ºï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›å—çŠ¶æ¨¡ç³Šã€‚å¯ç”¨ Bicubic Upscaling
å¯ä»¥ä»¥æœ€ä½çš„æ€§èƒ½æˆæœ¬å¤„ç†è¿™ç§é—®é¢˜ï¼Œæ³¨æ„è¿™åªåœ¨ GLES3 ä¸­æœ‰æ•ˆã€‚

![Bicubic Upscaling](https://docs.godotengine.org/zh_CN/stable/_images/environment_glow_bicubic.png)


ğŸŸ¡**Screen-Space Reflections (SSR)** å±å¹•ç©ºé—´åå°„åªåœ¨ GLES3 ä¸­æœ‰æ•ˆã€‚

![SSR effect](https://docs.godotengine.org/zh_CN/stable/_images/environment_ssr.png)

Godot æ”¯æŒä¸‰ç§åå°„æ•°æ®æºï¼ŒSkyã€ReflectionProbeã€GIProbeï¼Œä½†å®ƒä»¬å¯èƒ½æ— æ³•ä¸ºæ‰€æœ‰æƒ…å†µæä¾›è¶³å¤Ÿçš„ç»†èŠ‚ã€‚
SSR æœ€æœ‰æ„ä¹‰çš„åœºæ™¯æ˜¯ç‰©ä½“å½¼æ­¤æ¥è§¦ï¼Œä¾‹å¦‚åœ°æ¿ä¸Šçš„ç‰©ä½“ã€æ¡Œå­ä¸Šçš„ç‰©ä½“ã€æ¼‚æµ®åœ¨æ°´é¢ä¸Šçš„ç‰©ä½“å‘ˆç°çš„å€’å½±ç­‰ã€‚

SSR å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å®æ—¶å·¥ä½œï¼Œè€Œå…¶ä»–ç±»å‹çš„åå°„æ˜¯é¢„å…ˆè®¡ç®—ï¼Œå®æ—¶è¿ç®—çš„åå°„å…‰å¯ä»¥ç”¨æ¥ç”Ÿæˆäººç‰©ã€æ±½è½¦ç­‰ç§»åŠ¨
ç‰©ä½“çš„å®æ—¶åå°„å…‰åˆ°å‘¨å›´çš„ç‰©ä½“è¡¨é¢ä¸Šã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ç”¨æˆ·å¯ä»¥ç»†è°ƒçš„å‚æ•°ï¼š

- **Max Steps** ç¡®å®šåå°„çš„é•¿åº¦ï¼Œæœ€å°ä¸º 1ï¼Œè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œè®¡ç®—æˆæœ¬å°±è¶Šé«˜ï¼Œæ•ˆæœä¹Ÿè¶Šç²¾ç»†ã€‚
- **Fade In** è°ƒæ•´æ·¡å…¥æ›²çº¿ï¼Œè¿™æœ‰åŠ©äºä½¿æ¥è§¦åŒºåŸŸæ›´æŸ”å’Œã€‚
- **Fade Out** è°ƒæ•´æ·¡å‡ºæ›²çº¿ï¼Œå› æ­¤æ­¥é•¿é™åˆ¶ä¼šè½»å¾®æ·¡å‡ºã€‚
- **Depth Tolerance** å±å¹•ç©ºé—´å°„çº¿å¯¹é—´éš™çš„å®¹å·®ï¼Œå®¹å·®å€¼è¶Šå¤§ï¼Œå¿½ç•¥çš„é—´éš™å°±è¶Šå¤§ã€‚
- **Roughness** å‹¾é€‰æ—¶ SSR ä¼šè€ƒè™‘æè´¨çš„ç²—ç³™åº¦ä»¥äº§ç”Ÿæ¥è¿‘çš„ screen-space blur æ•ˆæœã€‚

è¯·è®°ä½, å±å¹•ç©ºé—´åå°„ä»…é€‚ç”¨äºåå°„ä¸é€æ˜å‡ ä½•ä½“ï¼Œé€æ˜å¯¹è±¡æ— æ³•åå°„å…‰çº¿ã€‚å› ä¸ºå®ƒä»¬ä¸ä¼šå†™å…¥æ·±åº¦ç¼“å†²åŒºï¼Œè¿™ä¹Ÿ
é€‚ç”¨äºä½¿ç”¨ SCREEN_TEXTURE æˆ– DEPTH_TEXTURE çš„ç€è‰²å™¨ã€‚


ğŸŸ¡**Screen-Space Ambient Occlusion (SSAO)** å±å¹•ç©ºé—´ç¯å¢ƒå…‰é®è”½åªåœ¨ GLES3 ä¸­æœ‰æ•ˆã€‚

ç¯å¢ƒå…‰éƒ¨åˆ†æåˆ°ï¼Œå…‰æºèŠ‚ç‚¹çš„å…‰çº¿æ— æ³•åˆ°è¾¾çš„åŒºåŸŸï¼Œè¦ä¹ˆæ˜¯é˜´å½±æˆ–æ˜¯åœ¨å…‰æºåŠå¾„ä¹‹å¤–ï¼Œè¿™äº›åŒºåŸŸä¼šè¢«ç¯å¢ƒå…‰ç…§äº®ã€‚
Godot å¯ä»¥ä½¿ç”¨ GIProbe, ReflectionProbe, Sky æˆ–æ’å®šçš„ç¯å¢ƒè‰²æ¥æ¨¡æ‹Ÿç¯å¢ƒå…‰ï¼Œä½†é—®é¢˜æ˜¯ï¼Œä¹‹å‰æå‡º
çš„æ‰€æœ‰æ–¹æ³•éƒ½æ›´å¤šåœ°ä½œç”¨äºè¾ƒå¤§çš„å°ºåº¦æˆ–å¤§åŒºåŸŸï¼Œè€Œä¸æ˜¯è¾ƒå°çš„å‡ ä½•ä½“å±‚é¢ã€‚

æ’å®šç¯å¢ƒè‰²å’Œ Sky åœ¨ä»»ä½•åœ°æ–¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè€Œ GI å’Œåå°„æ¢é’ˆçš„å±€éƒ¨ç»†èŠ‚è¾ƒå¤šï¼Œä½†ä¸è¶³ä»¥æ¨¡æ‹Ÿå…‰çº¿æ— æ³•å¡«å……åˆ°
ä¸­ç©ºæˆ–å‡¹é¢ç‰¹å¾å†…éƒ¨çš„æƒ…å†µã€‚

è¿™å¯ä»¥ç”¨å±å¹•ç©ºé—´ç¯å¢ƒé®æŒ¡æ¥æ¨¡æ‹Ÿï¼Œå®ƒçš„ç›®çš„æ˜¯ç¡®ä¿å‡ ä½•ä½“å‡¹é™·åŒºåŸŸæ›´æš—ï¼Œæ¨¡æ‹Ÿå…‰çº¿è¿›å…¥çš„è¾ƒçª„è·¯å¾„ã€‚

å¯ç”¨æ­¤æ•ˆæœï¼Œæ‰“å¼€ç¯å…‰å´æ— æ³•æ¬£èµåˆ°ç›¸åº”çš„æ•ˆæœæ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸º SSAO ä»…ä½œç”¨äº Ambient light
ç¯å¢ƒå…‰ï¼Œè€Œä¸æ˜¯ç›´æ¥å…‰ã€‚è¿™å°±æ˜¯åœ¨ä½¿ç”¨ç›´å°„å…‰çš„æ¡ä»¶ä¸‹ï¼Œæ•ˆæœä¸å¤ªæ˜æ˜¾çš„åŸå› ã€‚å¦‚æœæƒ³å¼ºåˆ¶ SSAO ä¹Ÿåœ¨ç›´å°„å…‰ä¸‹å·¥ä½œï¼Œ
è¯·ä½¿ç”¨ Light Affect å…‰çº¿å½±å“å‚æ•°ï¼Œå°½ç®¡å¹¶è¿™ä¸å¥½ï¼Œä½†æœ‰äº›è®¾è®¡å¸ˆå–œæ¬¢ã€‚

å½“ä¸çœŸæ­£çš„é—´æ¥å…‰æºç»“åˆæ—¶ï¼ŒSSAO æ•ˆæœçœ‹èµ·æ¥æœ€å¥½ï¼Œæ¯”å¦‚ GIProbeã€‚

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ªå‚æ•°è°ƒæ•´ SSAOï¼š

- **Radius/Intensity** æ§åˆ¶é®æŒ¡çš„åŠå¾„æˆ–å¼ºåº¦ï¼ŒåŠå¾„æ˜¯ä¸–ç•Œ(å…¬åˆ¶)å•ä½ï¼Œä»è§†å£å¼€å§‹è®¡ç®—è·ç¦»ã€‚
- **Radius2/Intensity2** è¾…åŠ©åŠå¾„å’Œå¼ºåº¦ï¼Œé€šå¸¸ç»“åˆå¤§åŠå¾„å’Œå°åŠå¾„ AO æ•ˆæœå¾ˆå¥½ã€‚
- **Bias** åç½®è°ƒæ•´å¯ä»¥è§£å†³è‡ªé®æŒ¡é—®é¢˜ï¼Œä½†é€šå¸¸é»˜è®¤æƒ…å†µä¸‹æ•ˆæœä¸é”™ã€‚
- **Light Affect** è®¾ç½®å¯¹ç›´å°„å…‰çº¿çš„å½±å“é‡ï¼Œè€Œä¸ä»…ä»…å¯¹ç¯å¢ƒå…‰ä½œç”¨ï¼Œæœ‰äº›è‰ºæœ¯å®¶å–œæ¬¢è¿™ç§æ•ˆæœã€‚
- **Ao Channel Affect** é›¶å€¼è¡¨ç¤ºä»…å°†æè´¨çš„ AO çº¹ç†ç”¨äºç¯å¢ƒå…‰é®æŒ¡ï¼ŒSSAO ä¸åº”ç”¨ã€‚å¤§äº 0 çš„å€¼ä¼š
    åœ¨ä¸åŒç¨‹åº¦ä¸Šå°† AO çº¹ç†ä¸ SSAO æ•ˆæœç›¸ä¹˜ï¼Œå¯¹æ²¡æœ‰ AO çº¹ç†çš„æè´¨æ— æ•ˆã€‚
- **Quality** SSAO å°†æ ¹æ®è´¨é‡é’ˆå¯¹æ¯ä¸ªåƒç´ å¯¹çƒä½“è¿›è¡Œæ›´å¤šé‡‡æ ·ï¼Œä»…é€‚ç”¨äºç°ä»£ GPUã€‚
- **Blur** æ¨¡ç³Šé‡‡æ ·æ ¸çš„å¤§å°ï¼Œ1x1 kernel æ˜¯æœ€ç²—ç³™çš„ï¼Œ3x3 æ¨¡ç³Šæœ€ç»†è‡´ï¼Œæ›´æŸ”åŒ–å›¾åƒï¼Œä½†ä¸ä¿ç•™å±€éƒ¨ç»†èŠ‚ã€‚
- **Edge Sharpness** ç”¨äºä¿æŒè¾¹ç¼˜çš„æ¸…æ™°åº¦ï¼Œé¿å…æŠ˜ç—•å¤„æ²¡æœ‰ AO çš„åŒºåŸŸã€‚



ğŸŸ¡**Adjustments** æ˜¯åœ¨å¤„ç†ç»“æŸæ—¶é˜¶æ®µçš„æ ‡å‡†å›¾åƒè°ƒæ•´åŠŸèƒ½ï¼ŒåŒ…å«ï¼š

- Brightness äº®åº¦è°ƒæ•´ï¼›
- Contrast å¯¹æ¯”åº¦è°ƒæ•´ï¼›
- Saturation é¥±å’Œåº¦è°ƒæ•´ï¼›
- Color Correction é¢œè‰²æ ¡æ­£ï¼›

ç¬¬ä¸€ä¸ªè°ƒæ•´åŠŸèƒ½æ˜¯èƒ½å¤Ÿæ”¹å˜å…¸å‹çš„äº®åº¦ã€å¯¹æ¯”åº¦å’Œé¥±å’Œåº¦ï¼š

![Brightness Contrast Saturation](https://docs.godotengine.org/en/3.5/_images/environment_adjustments_bcs.png)

ç¬¬äºŒç§æ˜¯é€šè¿‡æä¾›é¢œè‰²æ ¡æ­£æ¢¯åº¦æ˜ å°„æ¥æ”¹å˜è‰²å½©ï¼Œä½†æ˜¯å¸¸è§„é»‘è‰²åˆ°ç™½è‰²æ¸å˜å°†ä¸èµ·ä½œç”¨ï¼Œè¿™ç§æ˜ å°„å°±æ˜¯ä¿æŒåŸè‰²ã€‚
åˆ›å»ºè‡ªå®šä¹‰ **GradientTexture** å…è®¸å°†æ¯ä¸ªé€šé“æ˜ å°„åˆ°ä¸åŒçš„é¢œè‰²ï¼Œåœ¨æ˜ å°„çº¹ç†å›¾ä¸­ï¼Œä»å·¦å¾€å³å¯¹åº”åŸå›¾çš„
é»‘è‰²åˆ°ç™½è‰²çš„å˜åŒ–ã€‚ä½¿ç”¨å¸¸è§„é»‘è‰²åˆ°ç™½è‰²æ¸å˜ï¼Œåªå¯ä»¥è°ƒæ•´ä¸¤è€…çš„ä½ç½®æ¥æ”¹å˜åŸå›¾çš„äº®æš—å…³ç³»ã€‚é€šè¿‡æ”¹å˜æ˜ å°„è‰²å½©ï¼Œ
å°±å¯ä»¥å®ç°è°ƒæ•´ä¸ªåŸå›¾çš„è‰²å½©å…³ç³»ï¼ŒåŸå›¾åƒçš„ RGB æ˜ å°„åˆ°æ–°çš„ RGB é€šé“ä¸Šã€‚



## ğŸŸ¡ Chaos World æ··æ²Œä¸–ç•Œ
- [Fast Portable Noise Library](https://github.com/Auburn/FastNoiseLite)
- [Painting with Maths by Inigo Quilez](https://www.bilibili.com/video/BV1fU4y1273S/)
- [Raymarching distance fields - 2008 by Inigo Quilez](https://iquilezles.org/articles/raymarchingdf/)
- [Ray Marching and Signed Distance Functions](https://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/)
- [The Book of Shaders by Patricio Gonzalez Vivo & Jen Lowe](https://thebookofshaders.com/11/?lan=ch)
- [Voronoi diagrams â€“ inventor, method, applications](https://www.researchgate.net/publication/329444868_Voronoi_diagrams_-_inventor_method_applications)
- [Value noise derivatives - 2008](https://iquilezles.org/articles/morenoise/)
- [ç½‘æ ¼å™ªå£°ï¼ˆCellular Noiseï¼‰](https://thebookofshaders.com/12/?lan=ch)
- [Generating Noise for applications](https://learn.microsoft.com/en-us/archive/blogs/hemipteran/generating-noise-for-applications)
- [Voronoi Noise Worley and Chebyshev](https://catlikecoding.com/unity/tutorials/pseudorandom-noise/voronoi-noise/)
- [Simplex Noise, keeping it simple](https://catlikecoding.com/unity/tutorials/simplex-noise/)
- [Voronoi Noise](https://iquilezles.org/articles/voronoise/)
- [Voronoi edges - 2012 by Inigo Quilez](https://iquilezles.org/articles/voronoilines/)
- [Distance functions - by Inigo Quilez](https://iquilezles.org/articles/distfunctions/)
- [A GPU Approach to Voronoi Diagrams](https://nullprogram.com/blog/2014/06/01/)
- https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-8-pixel-displacement-mapping-distance-functions
- [Voronoi and Worley (cellular) noise - Godot Shaders](https://godotshaders.com/snippet/voronoi/)
- [Voronoi Texture ä½“ç§¯ç€è‰²å™¨é€ äº‘](https://www.bilibili.com/video/BV167411s7tt)
- An Image Synthesizer. Ken Perlin (1985)
- Texturing and Modeling, Third Edition: A Procedural Approach. David S. Ebert, F. Kenton Musgrave, Darwyn Peachey, Ken Perlin, Steve Worley (2002)
- The Science of Fractal Images, Heinz-Otto Peitgen (1988)
- Matlab Documentation - Symbolic Math Toolbox - Mathematics: Equation solving, formula simplification, calculus, linear algebra, and more
- [Random number generation](https://docs.godotengine.org/en/stable/tutorials/math/random_number_generation.html)

è®¡ç®—æœºå›¾å½¢å­¦å…¶ä¸­ä¸€ä¸ªé—®é¢˜æ˜¯å™ªå£°ï¼Œä¸–ç•Œéšå¤„éƒ½å¯è§çš„å™ªå£°çœ‹ä¼¼æ‚ä¹±æ— ç« ï¼Œå…¶å®æœ‰è¿¹å¯å¾ªã€‚æœ€ç®€å•çš„ç™½å™ªå£° White Noise
æ˜¯ä¸€äº›æ¯«æ— å…³è”çš„åƒç´ æ„æˆï¼Œè¿™äº›åƒç´ éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹éšæœºçš„ç‚¹ï¼Œè‡ªç„¶åŠå¤§é‡å­˜åœ¨ã€‚è€Œä¸€äº›æœ‰è§„å¾‹çš„å™ªå£°ï¼Œå¦‚ç»†èƒç»“æ„ã€æ ‘çš®
çº¹ç†ã€æ°´æ³¢ç­‰ç­‰ã€‚ç†è§£è¿™äº›ç°è±¡æ›´æ°çš„è§‚å¿µæ˜¯æ··æ²Œç³»ç»Ÿï¼Œæ··æ²Œä¸ç­‰äºéšæœºï¼Œéšæœºè¡¨ç¤ºå®Œå…¨æ— æ³•é¢„æµ‹ï¼Œè€Œæ··æ²Œåˆ™æ˜¯æ•´ä½“æœ‰è§„å¾‹ï¼Œ
å…·ä½“æ— æ³•æµ‹ã€‚å°±ç»†èƒç»“æ„æ¥è¯´ï¼Œæ•´ä½“ä¸Šæ¤ç‰©çš„ç»†èƒå¼€çŠ¶éƒ½åƒä¸€ä¸ªé•¿æ–¹å½¢ç›’å­ï¼Œè¿™æ˜¯å¯ä»¥é¢„æµ‹çš„ï¼Œä½†æ˜¯å…·ä½“æ¯ä¸ªç»†èƒçš„å¤§å°åˆ†å¸ƒ
è¿™äº›å…·ä½“çš„æ•°å€¼æ˜¯ä¸èƒ½é¢„æµ‹çš„ã€‚

åœ¨ç ”ç©¶å™ªå£°é—®é¢˜ä¹‹å‰ï¼Œå»ºè®®è§‚çœ‹ Inigo Quilez ä½œå“æ¼”ç¤º Raymarching distance fields - 2008ï¼Œ
ä»¥åŠå¯ä»¥æ‰“å¼€ä½ å¤©çµç›–çš„ã€Šç”¨æ•°å­¦ç»˜ç”»ã€‹ Painting with Maths ç³»åˆ—æ•™å­¦è§†é¢‘ã€‚

å°†å™ªå£°ä¸å‚…é‡Œå¶çº§æ•°ã€åˆ†å½¢ã€å¸ƒæœ—è¿åŠ¨ç­‰ç­‰æ•°å­¦å·¥å…·ç»„åˆï¼Œå¯ä»¥åˆ›é€ ä¸€åˆ‡å¯èƒ½ï¼Œè€Œä¸ä»…ä»…æ˜¯æ¸¸æˆåœ°å½¢æ™¯è§‚ã€‚ä¸€äº›æˆåŠŸ
çš„å™ªå£°ç ”ç©¶ä¸ºè½¯ä»¶å·¥ä¸šæä¾›äº†å¤§é‡å¯äº§å“åŒ–çš„ç®—æ³•ï¼ŒåŒ…æ‹¬ä½†ä¸ä»…é™äºä»¥ä¸‹è¿™äº›ï¼š

- Open Simplex å™ªå£°ç®—æ³•ï¼ŒGodot å°†å…¶å°è£…åœ¨ **OpenSimplexNoise** ç±»å‹ï¼›
- Voronoi ç®—æ³•ï¼Œç»´è¯ºå›¾ï¼ˆVoronoi Diagramï¼‰å¤šè¾¹å½¢ç»“æ„å¯ä»¥å¾ˆå¥½åœ°æ¨¡æ‹Ÿç”Ÿç‰©ç»†èƒçš„éšæœºç‰¹å¾ï¼›

Ken Perlin åœ¨å™ªå£°ç®—æ³•æœ‰å·¨å¤§è´¡çŒ®ï¼ŒPerlin Noise æŸæ—å™ªå£°æ˜¯ Ken Perlin 1983 å¹´æå‡ºï¼Œç”¨äºåˆ¶ä½œ
è¿ªå£«å°¼çš„åŠ¨ç”»ç”µå½± TRON ã€Šç”µå­ä¸–ç•Œäº‰éœ¸æˆ˜ã€‹ä¸­åˆ¶ä½œå…‰æ•ˆçš„ç®—æ³•ã€‚ä»–ä¸æ»¡è¶³äºå½“æ—¶è®¡ç®—æœºäº§ç”Ÿçš„é‚£ç§éå¸¸ä¸è‡ªç„¶çš„
çº¹ç†æ•ˆæœï¼Œå› æ­¤æå‡ºäº† Perlin å™ªå£°ã€‚Prelin ç”±äºå‡ºè‰²çš„å·¥ä½œï¼Œè·å¾—äº†å¥¥æ–¯å¡ç§‘æŠ€æˆæœå¥–ã€‚

å•å½¢å™ªå£° Simplex Value Noise æ˜¯ Ken Perlin åˆ›é€ äº†ä½©æ—å™ªå£°ä¹‹åå‘æ˜çš„å¦ä¸€ç§å™ªå£°æ¨¡å¼ã€‚è¿™ç§ç±»å‹çš„
å™ªå£°ä½¿ç”¨æ ¸æ±‚å’Œè€Œä¸æ˜¯æ’å€¼ï¼Œkernel summation instead of interpolationï¼Œå¹¶ä¸”åŸºäºå•çº¯å½¢ç½‘æ ¼è€Œ
ä¸æ˜¯è¶…ç«‹æ–¹ä½“æ™¶æ ¼ã€‚


ç¨‹åºå™ªå£° Pseudorandom Noise çš„ç”Ÿæˆæ–¹æ³•å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š

- åŸºäºæ™¶æ ¼çš„æ–¹æ³•ï¼ˆLattice basedï¼‰
    - ä¸€ç§æ˜¯å€¼å™ªå£°ï¼ˆValue noiseï¼‰ï¼Œæ˜¯æ‰¿ä¸Šå¯ä¸‹çš„ä¸€ç§ç®—æ³•ï¼Œæ˜¯ç™½å™ªå£°ä¸ Perlin Noise çš„ä¸­é—´é˜¶æ®µã€‚
    - å¦ä¸€ç§æ˜¯æ¢¯åº¦å™ªå£°ï¼ˆGradient noiseï¼‰ï¼ŒåŒ…æ‹¬ Perlinï¼ŒSimplexï¼ŒWavelet å™ªå£°ç­‰ç­‰ï¼›
- åŸºäºç‚¹çš„æ–¹æ³•ï¼ˆPoint basedï¼‰ Worley å™ªå£°å³ Voronoi ç®—æ³•ï¼Œç”¨äºæ¨¡ç³Šå¤„ç†çš„é«˜æ–¯å™ªå£°ï¼ˆGauss noiseï¼‰ï¼›

ç™½å™ªå£°çš„ä¸å¹³æ»‘ä¸åè°ƒæ˜¯å®ƒçš„æœ€å¤§é—®é¢˜ï¼Œè¦å¾—åˆ°å¹³æ»‘çš„è¿‡æ¸¡æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯æ¨¡ç³Šï¼Œæˆ–è€…è¯´åœ¨ä¸åŒç‚¹ä¹‹é—´è¿›è¡Œæ’å€¼ï¼Œ
Value nosie çš„åŸºæœ¬ç®—æ³•ç‰¹ç‚¹å°±æ˜¯åŸºäºæ™¶æ ¼æ–¹æ³•ï¼Œæ‰€è°“æ™¶æ ¼å°±æ˜¯å½¢çŠ¶è§„åˆ™çš„æ ¼å­ã€‚

Value noise å™ªå£°çš„åŸºæœ¬åŸç†å¦‚ä¸‹ï¼š

- æƒ³è¦åœ¨æ™¶æ ¼ä¸­è¿›è¡Œæ’å€¼è®¡ç®—ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰åœ¨å„æ™¶æ ¼é¡¶ç‚¹ä¸Šçš„å€¼ï¼›
- ç„¶åï¼Œæ ¹æ®è¾“å…¥ç‚¹åœ¨æ™¶æ ¼å†…çš„ä½ç½®ï¼Œè¿›è¡ŒäºŒæ¬¡çº¿æ€§æ’å€¼å¾—åˆ°æœ€åçš„å™ªå£°å›¾ï¼›

è™½ç„¶åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´è¿›è¡Œçº¿æ€§æ’å€¼çš„ç¡®å¯ä»¥è·å¾—å¾ˆå¹³æ»‘çš„è¿‡æ¸¡æ•ˆæœï¼Œä½†æ˜¯åˆ°ä¸‰ä¸ªå€¼ï¼Œä¹ƒè‡³æ›´å¤šå€¼çš„æ—¶å€™ï¼Œæ™¶æ ¼äº¤ç•Œå¤„
çš„è¿‡æ¸¡å¤ªç”Ÿç¡¬äº†ï¼Œé—®é¢˜å°±å‡ºæ¥äº†ã€‚

Perlin Noise åˆ™å°†æ™¶æ ¼æ¢¯åº¦åŒ–ï¼Œæ™¶æ ¼çš„å››é¡¶ç‚¹å…ˆå®šä¹‰éšæœºçš„ä¸€ä¸ªå‘é‡å€¼ï¼Œå„é¡¶ç‚¹åˆ°å†…éƒ¨ç‚¹çš„ä½ç½®å¯¹åº”åˆæœ‰ 4
ä¸ªå‘é‡å€¼ã€‚å™ªå£°å–å€¼åˆ™æ ¹æ®é¡¶ç‚¹å‘é‡ä¸é¡¶ç‚¹åˆ°å†…éƒ¨ç‚¹çš„å‘é‡ç‚¹ç§¯ï¼ˆdot product; scalar productï¼‰å¾—åˆ°ã€‚

Perlin Noise ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(2^n)ï¼Œç”Ÿæˆå™ªå£°ç»´åº¦è¶Šé«˜ï¼Œè®¡ç®—å¤æ‚æ€§å¢é•¿è¶Šå¿«ï¼ŒåŒæ—¶ï¼Œåœ¨å®ç°ç®—æ³•æ—¶
å¯¹æ’åˆ—ç»„åˆè¡¨ Permutation çš„æ“ä½œä¹Ÿè¶Šå¤æ‚ï¼Œæ’å€¼è¿ç®—ä¹Ÿè¶Šå¤šï¼Œä»£ç æ“ä½œæ—¶éš¾åº¦ä¹Ÿè¶Šæ¥è¶Šå¤§ã€‚æ­£å› å¦‚æ­¤ï¼Œ2001 å¹´ï¼Œ
Ken Perlin å¯¹ç®—æ³•è¿›è¡Œäº†æ”¹è¿›ï¼Œå¸Œæœ›å‡­å€Ÿæ–°çš„æ•°å­¦åŸºç¡€ç†è®ºï¼Œå•å½¢(Simplex)ç†è®ºï¼Œä»¥è§£å†³é«˜ç»´åº¦çš„å™ªå£°ç”Ÿæˆ
çš„è®¡ç®—é‡é—®é¢˜ï¼Œæ‰€ä»¥æœ€åçš„å™ªå£°å°±å«ä½œ Simplex Noiseã€‚


å•å½¢æ˜¯çº¿æ®µã€ä¸‰è§’å½¢ã€å››é¢ä½“ç›´è‡³ä»»æ„ç»´åº¦ç¬¦å·çš„ä¸€ç§æ¦‚è¿°ï¼Œæ˜¯ N-space çš„ä¸€ç§ç»†åˆ†ã€‚ç®€å•è¯´ï¼ŒN ç»´å•å½¢å°±æ˜¯èƒ½
é“ºæ»¡ N ç»´ç©ºé—´çš„æœ€ç®€å•å›¾å½¢ã€‚å¯¹ï¼‘D ç©ºé—´æ¥è¯´ï¼Œå•å½¢å°±æ˜¯ç­‰é•¿çš„çº¿æ®µï¼Œçº¿æ®µé¦–å°¾ç›¸è¿å¹³é“ºæ•´ä¸ªï¼‘D ç©ºé—´ï¼Œè€Œå¯¹äº
ï¼’D ç©ºé—´æ¥è¯´ï¼Œèƒ½å¹³é“ºæ•´ä¸ªç©ºé—´çš„æœ€ç®€å•å›¾å½¢æ˜¯ç­‰è¾¹ä¸‰è§’å½¢ï¼Œå¯¹ 3D ç©ºé—´æ¥è¯´ï¼Œèƒ½å¹³é“ºæ•´ä¸ªç©ºé—´çš„æœ€ç®€å•å›¾å½¢æ˜¯
å››é¢ä½“ï¼Œä¾æ­¤ç±»æ¨åº¦ã€‚å•å½¢æœ‰ä¸€ä¸ªç‰¹æ€§ï¼ŒN ç»´ç©ºé—´çš„å•å½¢æœ‰ N+ï¼‘ ä¸ªé¡¶ç‚¹ï¼ŒN! ä¸ªå•å½¢èƒ½ç»„æˆ N ç»´ç©ºé—´çš„è¶…æ™¶æ ¼ä½“ã€‚


Worley noise ä¹Ÿå« Cellular noiseï¼Œç®—æ³•æ˜¯ Steven Worley åœ¨ 1996 å¹´çš„è®ºæ–‡æå‡ºçš„ï¼Œ
A Cellular Texture Basis Functionï¼Œåœ¨è¿™ç¯‡è®ºæ–‡é‡Œï¼Œä»–æè¿°äº†è¿™ç§ç°åœ¨è¢«å¹¿æ³›ä½¿ç”¨çš„ç¨‹åºåŒ–çº¹ç†æŠ€æœ¯ã€‚
Voronoiï¼ˆCellular Noiseï¼‰ç½‘æ ¼å™ªå£°ç®—æ³•å®è´¨ä¸Šæ˜¯è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šè·ç¦»åœºè®¡ç®—é—®é¢˜ã€‚åœ¨ UV ç½‘æ ¼ä¸Šéšæœºé€‰
ä¸€ä¸ªç‚¹ Pï¼Œå¦‚ä½•åˆ¤æ–­å®ƒå¤„åœ¨å“ªä¸ªå¤šè¾¹å¼€åŒºå—å†…ï¼Ÿ

ç®—æ³•å¯ä»¥è¡¨è¿°ä¸ºï¼šæ¯ä¸ªç‰¹å¾ç‚¹å‘å¤–æ‰©å¼ ç”Ÿé•¿ï¼Œç›´åˆ°å®ƒç¢°åˆ°å…¶å®ƒæ‰©å¼ çš„åŒºåŸŸã€‚è¿™åæ˜ äº†è‡ªç„¶ç•Œçš„ç”Ÿé•¿è§„åˆ™ã€‚ç”Ÿå‘½çš„å½¢æ€
æ˜¯ç”±å†…éƒ¨æ‰©å¼ ã€ç”Ÿé•¿çš„åŠ›é‡å’Œé™åˆ¶æ€§çš„å¤–éƒ¨åŠ›é‡å…±åŒå†³å®šçš„ã€‚æ¨¡æ‹Ÿè¿™ç§è¡Œä¸ºçš„ç®—æ³•ä»¥ Georgy Voronoi å‘½åã€‚

![Monokot root (Georgy Voronoi algorithm)](https://thebookofshaders.com/12/monokot_root.jpg)

Voronoi å›¾éœ€è¦å¯¹å¹³é¢åˆ’åˆ†ï¼Œæ ¹æ®å¹³é¢ä¸Šè®¾ç½®çš„ç‰¹å¾ç‚¹ï¼ˆSiteï¼‰æŠŠå¹³é¢åˆ†æˆè‹¥å¹²åŒºåŸŸï¼ŒåŒä¸€ä¸ªåŒºåŸŸä¸­çš„æ‰€æœ‰ç‚¹
åˆ°æŸä¸€ç‚¹çš„è·ç¦»æœ€è¿‘ï¼Œè¿™äº›åŒºåŸŸç§°ä¸ºå•å…ƒï¼ˆCellï¼‰ï¼Œç›¸é‚»å•å…ƒä¹‹é—´çš„åˆ†ç•Œçº¿æˆä¸ºè¾¹ï¼ˆEdgeï¼‰ï¼Œç›¸é‚»ä¸¤ä¸ªæˆ–å¤šä¸ªæ¡
è¾¹çš„äº¤ç‚¹ç§°ä¸ºé¡¶ç‚¹ï¼ˆVerticeï¼‰ã€‚Voronoi è¾¹ä¸Šçš„ç‚¹åˆ°ä¸¤ä¸ª Site çš„è·ç¦»ç›¸ç­‰å¹¶å°äºåˆ°å…¶å®ƒ Site çš„è·ç¦»ï¼Œ
è€Œå…¶é¡¶ç‚¹åˆ°å¤šä¸ªï¼ˆâ‰¥3ï¼‰Site çš„è·ç¦»ç›¸ç­‰å¹¶å°äºåˆ°å…¶å®ƒ Site çš„è·ç¦»ã€‚

è¿™é‡Œè·ç¦»åœºçš„è·ç¦»æ˜¯æŒ‡ï¼Œåˆ°ä¸€ä¸ªç‰¹å¾ç‚¹é›†æœ€è¿‘çš„ç‚¹çš„è·ç¦»ã€‚æ¯”å¦‚è¯´è¦å†™ä¸€ä¸ª 4 ä¸ªç‰¹å¾ç‚¹çš„è·ç¦»åœºï¼Œå¯¹æ¯ä¸€ä¸ªåƒç´ ï¼Œ
è®¡ç®—å®ƒåˆ°æœ€è¿‘çš„ç‰¹å¾ç‚¹çš„è·ç¦»ã€‚æœ€ç²—æš´çš„åŠæ³•å°±æ˜¯éå†æ‰€æœ‰å…± 4 ä¸ªç‰¹å¾ç‚¹ï¼Œè®¡ç®—å‡ºä¸åˆ°å½“å‰åƒç´ ç‚¹çš„è·ç¦»ï¼Œå¹¶
è®°å½•ä¸‹æœ€è¿‘çš„é‚£ä¸ªè·ç¦»ï¼Œè¿™äº›è®°å½•ä¸‹æ¥çš„æ•°æ®å°±è¡¨ç¤ºä¸€ä¸ªè·ç¦»åœº Distance fieldã€‚è·ç¦»åœºæ—©æœŸåœ¨åŒ»ç–—è¡Œä¸šçš„
æ”¾å°„è®¾å¤‡æˆåƒä¸Šæœ‰åº”ç”¨ï¼Œåœ¨ç‰©ç†å¼•æ“ä¸­ï¼Œä¹Ÿä¼šé‡‡ç”¨æœ‰å‘è·ç¦»åœºæ¥å¤„ç†é—®é¢˜ Signed Distance Fieldã€‚

Inigo Quilez è¿˜ç”¨æ¥ä½œç”»ï¼Œå®Œå…¨ä½¿ç”¨ä»£ç ç”»ä¸€åªæœ‰è¡€æœ‰è‚‰çš„èœ—ç‰›ï¼Œå±•ç¤ºåœ¨ Raymarching distance fields - 2008ã€‚

Voronoi å›¾ç”Ÿæˆæ—¶ï¼Œéœ€è¦å…ˆç”Ÿæˆéšæœºé¡¶ç‚¹ä½œä¸ºç‰¹å¾ç‚¹ï¼Œå¹¶æ ¹æ®ç‰¹å¾ç‚¹ç”Ÿæˆå¤šè¾¹å½¢è¿›è¡Œåˆ†åŒºã€‚æ²¿ä¸¤é¡¶ç‚¹ç”»å‡ºå¹³åˆ†çº¿ï¼Œ
è¿™æ¡çº¿å³å¤šè¾¹å½¢çš„ä¸€ä¸ªè¾¹ï¼Œç„¶åæ ¹æ®å¤šè¾¹å½¢å¯¹åˆ†åŒºå†…çš„ç‚¹è¿›è¡Œæ’ä»¶å¤„ç†ã€‚ç”Ÿæˆç‰¹å¾ç‚¹è¶Šå¤šè®¡ç®—å¤æ‚åº¦è¶Šå¤§ï¼Œéšå
Steven Worley å¯¹ç®—æ³•è¿›è¡Œäº†å¤šæ¬¡ä¼˜åŒ–ã€‚


é€šè¿‡å°†ç©ºé—´åˆ†å‰²æˆç½‘æ ¼ï¼Œå¹¶ä¸éœ€è¦è®¡ç®—æ¯ä¸€ä¸ªåƒç´ ç‚¹åˆ°æ¯ä¸€ä¸ªç‰¹å¾ç‚¹çš„è·ç¦»ï¼Œä½¿ç”¨å¾—è®¡ç®—å¾—ä»¥ç®€åŒ–ã€‚å¹¶ä¸” GPU ä¸­
æ¯ä¸ªåƒç´ ç‚¹éƒ½åœ¨è‡ªå·±çš„çº¿ç¨‹ä¸­è¿è¡Œï¼ŒæŠŠç©ºé—´åˆ†å‰²æˆç½‘æ ¼ï¼ˆcellsï¼‰ï¼Œæ¯ä¸ªç½‘æ ¼å¯¹åº”ä¸€ä¸ªç‰¹å¾ç‚¹ã€‚å¦å¤–ï¼Œä¸ºé¿å…ç½‘æ ¼
äº¤ç•ŒåŒºåŸŸçš„åå·®ï¼Œéœ€è¦è®¡ç®—åƒç´ ç‚¹åˆ°ç›¸é‚»ç½‘æ ¼ä¸­çš„ç‰¹å¾ç‚¹çš„è·ç¦»ã€‚è¿™å°±æ˜¯ Steven Worley åœ¨è®ºæ–‡ä¸­çš„ä¸»è¦æ€æƒ³ã€‚
æœ€åï¼Œæ¯ä¸ªåƒç´ ç‚¹åªéœ€è¦è®¡ç®—åˆ°ä¹ä¸ªç‰¹å¾ç‚¹çš„è·ç¦»ï¼šä»–æ‰€åœ¨çš„ç½‘æ ¼çš„ç‰¹å¾ç‚¹å’Œç›¸é‚»çš„å…«ä¸ªç½‘æ ¼çš„ç‰¹å¾ç‚¹ã€‚

æ‰€ä»¥ï¼Œæ”¹è¿›åçš„ Voronoi ç®—æ³•ä¸ä»…åŸºäºç‚¹åˆåŸºäºæ™¶æ ¼ã€‚

åœ¨ 2011 å¹´, Stefan Gustavson ä¼˜åŒ–äº† Steven Worley çš„ç®—æ³•ï¼Œæå‡º 2x2 Worley å™ªå£°ä¼˜åŒ–ï¼Œä»…ä»…
å¯¹ä¸€ä¸ª 2x2 çš„çŸ©é˜µä½œéå†ï¼ˆè€Œä¸æ˜¯ 3x3 çš„çŸ©é˜µï¼‰ã€‚è¿™æ˜¾è‘—åœ°å‡å°‘äº†å·¥ä½œé‡ï¼Œä½†æ˜¯ä¼šåœ¨ç½‘æ ¼è¾¹ç¼˜åˆ¶é€ äººå·¥ç—•è¿¹ã€‚
äº‹å®ä¸Šè¿™ä¸ªé—®é¢˜åœ¨3x3ä¸Šä¹Ÿå­˜åœ¨ï¼Œåªæ˜¯ä¸æ˜æ˜¾ã€‚

Inigo Quile ä¹Ÿåœ¨ Voronoi edges - 2012 ä¸­æä¾›äº†ä¸€ä¸ªè¾¹çº¿æŸ¥æ‰¾ç®—æ³•ï¼Œç®—æ³•æä¾›äº†æ­£ç¡®çš„è·ç¦»åº¦é‡ã€‚

Voronoi å™ªå£°æ±‚è§£çš„å‡½æ•°ä¸­ï¼Œæ˜¾ç¤ºåˆ°æœ€è¿‘å•å…ƒæ ¼ç‚¹çš„è·ç¦»çš„å‡½æ•°è¢«å‘½åä¸º F1ï¼Œæ˜¾ç¤ºåˆ°ç¬¬äºŒä¸ªæœ€è¿‘ç‚¹çš„è·ç¦»çš„
å‡½æ•°è¢«å‘½åä¸º F2ï¼Œä¾æ­¤ç±»æ¨ã€‚ä¸å¿…é™åˆ¶è‡ªå·±åªä½¿ç”¨ F1 æˆ– F2ï¼Œä¹Ÿæœ‰å¯ä»¥ä½¿ç”¨ä»¥æŸç§æ–¹å¼ç»„åˆå®ƒä»¬çš„å‡½æ•°ã€‚
æœ€æœ‰è¶£çš„å˜ä½“æ˜¯ F2-F1 Voronoiã€‚


åœ¨æ¸¸æˆå·¥ä¸šä¸Šåˆ©ç”¨ç°ä»£ GPU ç¡¬ä»¶ç¼–ç¨‹ï¼Œå³ç¼–å†™ç€è‰²å™¨æ˜¯å®ç°å™ªå£°ç¨‹åºæ™®éåšæ³•ã€‚ç°åœ¨ï¼Œé€šè¿‡æµè§ˆå™¨å°±å¯ä»¥ç¼–å†™
ç€è‰²å™¨è¯­è¨€ç¨‹åºï¼ŒShadertoy å°±æ˜¯è¿™æ ·çš„å·¥å…·ï¼Œä½œè€… Inigo Quilez ä¹Ÿæ˜¯è®¡ç®—æœºå›¾å½¢é¢†åŸŸçš„å¤§ç‰›ã€‚

å¼€æºå…è´¹çš„åŠ¨ç”»å·¥å…· Blender ä¹Ÿä¸é”™ï¼Œä½¿ç”¨ OSLï¼ˆOpen Shading Languageï¼‰ç€è‰²å™¨è¯­è¨€ã€‚Godot ä¸Šä½¿ç”¨
OpenGL GLSL 2/3 ç€è‰²å™¨è¯­è¨€ç¼–ç¨‹ï¼Œåªéœ€è¦ç»™å¯¹è±¡åˆ›å»ºä¸€ä¸ª ShaderMaterial æè´¨å³å¯ã€‚ç¼–å†™ç€è‰²å™¨æ¶‰åŠ
æ•°å­¦æ–¹é¢çš„çŸ¥è¯†æ¯”è¾ƒå¤šï¼ŒåŒæ—¶è¦æ±‚æ›´é«˜çš„è‰ºæœ¯å®¡ç¾èƒ½åŠ›ï¼Œæ‰èƒ½åˆ¶ä½œå‡ºé«˜è´¨é‡çš„ä½œå“ã€‚

GLSL æœ¬èº«æ²¡æœ‰æä¾›éšæœºå‡½æ•°ï¼Œé™¤äº†æ—©æœŸç‰ˆæœ¬æä¾›ä¸€ç³»åˆ—å™ªå£°å‡½æ•° noise1 ~ noise4ï¼Œåœ¨æ–°çš„ OpenGL 4.4
å·²ç»å¼ƒç”¨ï¼Œæ‰€ä»¥è¿”å›å€¼æ€»æ˜¯ä¸º 0ã€‚è¦å®ç°ä¼ªéšæœºæ•°ï¼Œå¯ä»¥ç”¨å–å·§çš„æ–¹æ³•ï¼ŒShadertoy ä¸Šæä¾›äº†ä¸€ä¸ªå®ç°æ–¹æ³•ï¼Œ
åˆ©ç”¨ fract å‡½æ•°æˆªå–å°æ•°éƒ¨åˆ†ï¼š


```js
float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}
```

å‚è€ƒ [Noise - value - 3D by Inigo Quilez](https://www.shadertoy.com/view/4sfGzS)


ç€è‰²å™¨ä¸­æœ‰ä¸€ä¸ªç”¨äºå¹³æ»‘æ’å€¼çš„ smoothstep æ›²çº¿å…¬å¼ y = 3x^2 - 2x^3ï¼Œå®ƒå¯ä»¥ç”±äºŒæ¬¡æ–¹ç¨‹æ··åˆå¾—åˆ°ï¼Œ
è¿™ä»¶äº‹ç¡®å®è®©å¼€å§‹æ¥è§¦ç€è‰²å™¨ç¼–ç¨‹çš„æˆ‘è§‰å¾—ï¼Œæ•°å­¦ä¸Šçš„å‡½æ•°è¿™ä¸ªæ¦‚å¿µçœŸçš„å’Œè®¡ç®—æœºç»“åˆéå¸¸å¯†åˆ‡ã€‚

å‡è®¾æœ‰ä¸¤æ¡äºŒæ¬¡æ–¹ç¨‹æ›²çº¿ï¼š

    C: f(x) = x^2
    D: f(x) = 1 - (x-1)^2

å¹¶ä¸”æœ‰ä¸¤ä¸ªç”¨äºæ··åˆä»¥ä¸Šæ›²çº¿çš„å‡½æ•°ï¼š

    E: f(x) = x
    F: f(x) = 1 - x

å®ƒä»¬åˆ†åˆ«æ˜¯æ­£ä¾‹ã€åæ¯”ä¾‹å‡½æ•°ã€‚é‚£ä¹ˆ smoothstep æ›²çº¿å…¬å¼å°±å¯ä»¥æŒ‰ CF + DE æ··åˆï¼Œåœ¨ [0,1] åŒºé—´ä¸Šæ··åˆ
å¾—åˆ°ä¸¤æ¡æ›²çº¿çš„å¹³æ»‘è¿‡åº¦ï¼Œä½¿å¾—æ’å€¼å§‹ç»ˆå¯ä»¥å°†è¾“å…¥ x æ˜ å°„åˆ° [0,1] è¿™ä¸ªæ ‡å‡†åŒ–åŒºé—´å†…ï¼Œå¹¶å®ç°ä¸¤ç«¯çš„å¹³æ»‘ã€‚

```c
    // Hermite interpolate between ``edge0`` and ``edge1`` by ``x``.
    // vec_type smoothstep (vec_type edge0, vec_type edge1, vec_type x)
    // vec_type smoothstep (float edge0, float edge1, vec_type x)

    genFType t;
    t = clamp ((x - edge0) / (edge1 - edge0), 0, 1);
    return t * t * (3 - 2 * t);
```

å¹³æ»‘æ’å€¼ç»“æœè¿”å› 0.0 å¦‚æœ x â‰¤ edge0ï¼Œæˆ–è€…è¿”å› 1.0 if x â‰¥ edge1ï¼Œå½“ edge0 < x < edge1ï¼Œä½¿ç”¨
smooth Hermite interpolation å°†ç»“æœå¹³æ»‘åœ¨ [0, 1] åŒºé—´ã€‚æ³¨æ„ï¼Œedge0 â‰¥ edge1 æ—¶ï¼Œæ— å®šä¹‰ã€‚


Ken Perlin å¯¹ Simplex Noise ç®—æ³•çš„ä¸€ä¸ªä¼˜åŒ–æ˜¯å°†ä¸‰æ¬¡ Hermite å‡½æ•°å³ smoothstep() å‡½æ•°æ›¿æ¢
æˆäº†å››æ¬¡ Hermite å‡½æ•°ã€‚ä½¿å¾—å‡½æ•°æ›²çº¿ä¸¤ç«¯æ›´â€œå¹³â€ï¼Œæ‰€ä»¥å™ªå£°å›¾æ¯ä¸ªæ ¼çš„è¾¹ç¼˜æ›´åŠ ä¼˜é›…åœ°ä¸å¦ä¸€ä¸ªè¡”æ¥ã€‚

    Cubic Hermite Curveï¼š f(x) = 3x^2-2x^3
    Quartic Hermite Curveï¼š f(x) = 6x^5-15x^4+10x^3

è€Œè¿™ç§æ•°å­¦å·¥å…·çš„åº”ç”¨è¿œä¸åªæ˜¯åœ¨ç®—æ³•çš„æ•ˆç‡æå‡ä¸Šçš„åº”ç”¨ï¼Œç¨‹åºåŒ–å»ºæ¨¡çš„åŸºæœ¬å·¥å…·ä¹Ÿæ˜¯æ•°å­¦ã€‚ä¾‹å¦‚ï¼Œçƒå’Œåœ†æœ‰
ä»€ä¹ˆæœ¬è´¨å·®åˆ«å‘¢ï¼Œä¸€ä¸ªæ˜¯ x^2 + y^2 = r^2ï¼Œä¸€ä¸ªæ˜¯ x^2 + y^2 + z^2 = r^2ï¼Œå½“è¿›è¡Œæ¯”ä¾‹è¿ç®—åï¼Œ
å°±å¯ä»¥å°†ä¸€ä¸ªåœ†å˜æ¢ä¸ºæ¤­åœ†ï¼Œå°†ä¸€ä¸ªçƒå˜æˆä¸€ä¸ªé¥¼çŠ¶æ€ï¼Œè¿™æ˜¯ä¸æ˜¯å¤ªæœ‰è¶£äº†ã€‚

è€Œ Inigo Quilez å±•ç¤ºåœ¨ Raymarching distance fields - 2008 ä¸Šçš„æ•°å­¦ä½œç”»èƒ½åŠ›ç»å¯¹å¯ä»¥å¼€æ‹“
ä½ å¯¹äºæ•°å­¦çš„åŸæœ‰è®¤è¯†ï¼Œå®ƒå°±çœŸçš„åƒä¸Šå¸ï¼

è®¡ç®—æœºä¸èƒ½æœ‰äº§ç”ŸçœŸæ­£çš„éšæœºæ•°ï¼Œåªèƒ½é€šè¿‡ç®—æ³•ç”Ÿæˆä¼ªéšæœºæ•°åºåˆ—æ¥æ¨¡æ‹Ÿéšæœºæ€§è´¨ï¼Œpseudorandom number generators (PRNGs)ã€‚
Godot æä¾›å…¨å±€çš„éšæœºå‡½æ•°ï¼Œä»¥åŠ RandomNumberGenerator ç±»å‹ï¼Œåœ¨ä½¿ç”¨ rand æˆ– randi è·å–ä¼ªéšæœº
æ•°å€¼æ—¶ï¼Œéœ€è¦å…ˆåœ¨ ready ä¸­è°ƒç”¨ randomize() åˆå§‹åŒ–æ–¹æ³•ï¼Œä»¥äº§ç”Ÿä¸åŒçš„ä¼ªéšæœºæ•°åºåˆ—ï¼š 

```py
var _fruits = ["apple", "orange", "pear", "banana"]

func _ready():
    randomize()

    for i in range(100):
        # Pick 100 fruits randomly.
        print(get_fruit())


func get_fruit():
    var random_fruit = _fruits[randi() % _fruits.size()]
    # Returns "apple", "orange", "pear", or "banana" every time the code runs.
    # We may get the same fruit multiple times in a row.
    return random_fruit

```


Godot 3.x æä¾› OpenSimplexNoise ç±»å‹ä½œä¸ºå™ªå£°ç”Ÿæˆå™¨ï¼ŒGodot 4.x åˆ™ä½¿ç”¨ FastNoiseLite ç±»å‹
ç”Ÿæˆ 1D, 2D, 3D, 4D çš„å™ªå£°ï¼š

```py
# Godot 3.x
var _noise = OpenSimplexNoise.new()

func _ready():
    randomize()
    # Configure the OpenSimplexNoise instance.
    _noise.seed = randi()
    _noise.octaves = 4
    _noise.period = 20.0
    _noise.persistence = 0.8

    for i in 100:
        # Prints a slowly-changing series of floating-point numbers
        # between -1.0 and 1.0.
        print(_noise.get_noise_1d(i))

# Godot 4.x
var _noise = FastNoiseLite.new()

func _ready():
    randomize()
    # Configure the FastNoiseLite instance.
    _noise.seed = randi()
    _noise.fractal_octaves = 4
    _noise.frequency = 1.0 / 20.0

    for i in 100:
        # Prints a slowly-changing series of floating-point numbers
        # between -1.0 and 1.0.
        print(_noise.get_noise_1d(i))
```


## ğŸŸ¡ Shader Programming ç€è‰²å™¨ - GPU ç¼–ç¨‹
- [GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª](https://www.bilibili.com/video/BV1X7411F744/)
- [é¾šå¤§çš„ä¸Šå¸è§†è§’çœ‹GPUæ•™ç¨‹](https://www.bilibili.com/video/BV1P44y1V7bu/)
- [Real-Time Rendering 3rd æ¸²æŸ“ç®¡çº¿ä¼˜åŒ–æç‚¼æ€»ç»“](https://zhuanlan.zhihu.com/p/32928016)
- [Real-Time Rendering 3rd æ¸²æŸ“åŠ é€Ÿç®—æ³•æç‚¼æ€»ç»“](https://zhuanlan.zhihu.com/p/32300891)
- [The Book of Shaders by Patricio Gonzalez Vivo & Jen Lowe](https://thebookofshaders.com/?lan=ch)
- [OpenGL Wiki](https://www.khronos.org/opengl/wiki/Main_Page)
- [Real-Time Rendering, Fourth Edition](http://www.realtimerendering.com/)
- Computer Graphics: Principles and Practice 3rd Edition 2014
- Fundamentals of Computer Graphics 4/5th Edition
- OpenGL SuperBible: comprehensive tutorial and reference OpenGL 4.3 6th Edition
- OpenGL SuperBible: comprehensive tutorial and reference OpenGL 4.5 7th Edition
- OpenGL Programming Guide: The Official Guide to Learning OpenGL 4.3 8th Edition
- OpenGL Programming Guide: The Official Guide to Learning OpenGL 4.5 with SPIR-V 9th Edition
- GLSL Essentials: Enrich your 3D scenes with the power of GLSL! by Jacobo RodrÃ­guez
- [OpenGL Reference Cards](https://www.khronos.org/developers/reference-cards/)
- [VulkanÂ® Learning](https://vulkan.org/learn)
- [VulkanÂ® API Tutoria](https://vulkan-tutorial.com/Introduction)
- [Spine åŠ¨ç”»åˆ¶ä½œåŠ SFML Framework å…¥é—¨](https://github.com/jimboyeah/spine-sfml-demo/)
- [Vulkan: the essentials - NVIDIA by Tristan Lorach, March 17th 2016](https://developer.download.nvidia.cn/gameworks/events/GDC2016/Vulkan_Essentials_GDC16_tlorach.pdf)
- [The OpenGL Shading Language](https://www.khronos.org/opengl/wiki/OpenGL_Shading_Language)
- [Rendering Pipeline Overview - Vertex Specification](https://www.khronos.org/opengl/wiki/Vertex_Specification)
- [Leanr OpenGL - Hello Traiangle](https://learnopengl.com/Getting-started/Hello-Triangle)
- [Leanr OpenGL zh_CN](https://github.com/LearnOpenGL-CN/LearnOpenGL-CN/)

è¯´åˆ°è®¡ç®—æœºå›¾å½¢å­¦ï¼Œå°±ä¸å¾—ä¸è¯´ä» OpenGL åˆ° Vulkan è§„èŒƒçš„æ¼”åŒ–è¿‡ç¨‹ï¼Œä»¥åŠä» CPU åˆ° GPU ç»˜å›¾æ–¹å¼çš„è½¬å˜ã€‚

æ—©æœŸè®¡ç®—æœºå›¾å½¢å­¦è¿˜æ²¡æœ‰å¤§é‡åº”ç”¨ï¼Œå¤§å¤šåªæ˜¯å®éªŒå®¤ç ”ç©¶ï¼Œä¸€èˆ¬ç»˜å›¾èƒ½åŠ›ä¹Ÿæ˜¯é€šè¿‡ CPU å®ç°çš„ã€‚éšç€å¸‚åœºå’ŒæŠ€æœ¯å‘å±•ï¼Œ
è®¡ç®—æœºæ–°å¢äº† GPU è¿™ä¸ªä¸»è§’ï¼Œåœ¨è®¡ç®—æœºæ„æ¶ä¸Šï¼ŒGPU å¯ä»¥å’Œ CPU å…±äº«æˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„å†…å­˜ï¼Œå³å­˜åœ¨ä¸¤ç§æ¶æ„ï¼š
**è€¦åˆå¼æ¶æ„**ä¸*åˆ†ç¦»å¼æ¶æ„*ã€‚åˆ†ç¦»å¼æ„æ¶é€šè¿‡ PCI-e ç­‰æ€»çº¿é€šè®¯ï¼Œè€Œå…±äº«æ„æ¶åˆ™ä¸éœ€è¦ç»è¿‡å¤–éƒ¨æ€»çº¿ä¼ é€’æ•°æ®ã€‚
åˆ†ç¦»å¼æ„æ¶çš„ç¼ºç‚¹åœ¨äº PCI-e ç›¸å¯¹äºä¸¤è€…å…·æœ‰ä½å¸¦å®½å’Œé«˜å»¶è¿Ÿï¼Œæ•°æ®çš„ä¼ è¾“æˆäº†å…¶ä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚ä½†æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜æ˜¾ï¼Œ
å°±æ˜¯ä¸€æ—¦æ•°æ®å‡†å¤‡å¥½ï¼Œå°±ä¸éœ€è¦ CPU å†æä¾›æ•°æ®ï¼ŒGPU å†…éƒ¨æ›´é«˜æ•ˆåœ°æ‰§è¡Œç»˜å›¾æµç¨‹ï¼Œè¢«ç§» PCã€åŠ¨è®¾å¤‡å¤§é‡é‡‡ç”¨ã€‚

å…±äº«å¼æ„æ¶å…±äº«å†…å­˜å’Œç¼“å­˜ï¼ŒAMD çš„ APU é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ç»“æ„ï¼Œç›®å‰ä¸»è¦ä½¿ç”¨åœ¨ PS4 ç­‰æ¸¸æˆä¸»æœºä¸­ã€‚


è¯´åˆ° OpenGL å°±ç¦»ä¸å¼€ SGIï¼ˆç¾å›½ç¡…å›¾å…¬å¸ï¼‰è¿™å®¶å…¬å¸ï¼ŒOpenGL èµ·æºäº SGIï¼Œåœ¨ 1992 å¹´ 7 æœˆå‘å¸ƒ 
OpenGL 1.0 æˆä¸ºå·¥ä¸šæ ‡å‡†ã€‚å—æ§äº 1992 å¹´æˆç«‹çš„ç‹¬ç«‹è´¢å›¢ OpenGL Architecture Review Board (ARB)ã€‚
SGI ç­‰ ARB æˆå‘˜ä»¥æŠ•ç¥¨æ–¹å¼äº§ç”Ÿæ ‡å‡†ï¼Œå¹¶åˆ¶æˆè§„èŒƒæ–‡æ¡£(Specification)å…¬å¸ƒï¼Œå„è½¯ç¡¬ä»¶å‚å•†æ®æ­¤å¼€å‘è‡ªå·±
ç¡¬ä»¶ç³»ç»Ÿä¸Šçš„å®ç°ã€‚åªæœ‰é€šè¿‡äº† ARB è§„èŒƒå…¨éƒ¨æµ‹è¯•çš„å®ç°æ‰èƒ½ç§°ä¸º OpenGL è§„èŒƒã€‚

2006 å¹´ 08 æœˆ 10 æ—¥ï¼ŒKhronos é›†å›¢å®£å¸ƒè·å¾— OpenGL çš„æ§åˆ¶æƒï¼Œå‘å±•æ‰©å¼ åï¼ŒAppleã€Dellã€Google 
å’Œ S3 Graphics ç­‰å…¬å¸éƒ½å·²æˆä¸ºäº†å…¶ä¼šå‘˜ã€‚

ç§‘çº³æ–¯ç»„ç»‡ï¼ˆKhronos Groupï¼‰æ˜¯ä¸€ä¸ªç”±æˆå‘˜èµ„åŠ©ï¼Œä¸“æ³¨äºåˆ¶å®šå¼€æ”¾æ ‡å‡†ï¼ˆOpen standardï¼‰çš„è¡Œä¸šåä¼šï¼Œ
é‡ç‚¹åˆ¶å®šå…è´¹çš„ APIï¼Œä½¿åœ¨å„ç§å¹³å°å’Œè®¾å¤‡ä¸Šåˆ›ä½œæˆ–æ’­æ”¾çš„å¤šåª’ä½“å¯ä»¥å¾—åˆ°ç¡¬ä»¶åŠ é€Ÿã€‚

ç›®å‰ï¼ŒOpenGL Graphic API è¿˜åœ¨è¿›åŒ–ä¹‹ä¸­ï¼Œä½†æ˜¯å‡ºäºæ€§èƒ½ä¸æ„æ¶ä¼˜åŒ–ï¼Œä»¥åŠ Metalã€DirectX ç­‰å¯¹æ‰‹ç«äº‰éœ€è¦ï¼Œ
æ–°çš„æ¥æ£’è€… Vulkan GPU API å·²ç»å¼€å§‹æ™®åŠåº”ç”¨ã€‚è¿™ä¸ªæ–°çš„è§„èŒƒå°†å¼€æ”¾æ›´å¤šçš„ GPU èƒ½åŠ›ç»™å¼€å‘è€…ï¼Œä¸€æ–¹é¢
ç¡¬ä»¶æ€§èƒ½å¯ä»¥å¾—åˆ°æœ€å¤§åŒ–çš„å‘æ˜ï¼Œä½†å¦ä¸€æ–¹é¢ï¼Œå¯¹å¼€å‘è€…çš„æŠ€æœ¯è¦æ±‚ä¹Ÿæå‡å‡ ä¸ªçº§åˆ«ã€‚

æˆ‘æ¥è§¦ GPU æ¸²æŸ“ç®¡çº¿æ˜¯ä» OpenGL å¼€å§‹çš„ï¼Œè€Œæœ‰ä¸ªé‡‘ä¸»çˆ¸çˆ¸çš„ DirectX å¤šåª’ä½“æ¥å£åªæœ‰ä¸€ä¸ªæ¨¡ç³Šçš„è®¤è¯†ã€‚
åœ¨å›¾å½¢æ¥å£è§„èŒƒä¸­ï¼Œç¡®å®æ˜¯éå¸¸æ··ä¹±çš„ä¸€ä¸ªå¸‚åœºï¼Œåƒæ˜¯ä¸€ä¸ªå†›é˜€æ··æˆ˜çš„å¹´ä»£ã€‚Open Graphics Library æ•´ä½“
ä¸Šè¿˜æ˜¯æ¯”è¾ƒæ¥è¿‘å›¾å½¢å­¦çš„åŸºç¡€æ¦‚å¿µï¼Œé€‰æ‹© OpenGL çš„ç†ç”±å¾ˆç®€å•ï¼šé€šç”¨è·¨å¹³å°ã€‚

å¦‚æœæƒ³è¦æ›´æ·±å…¥ GPU çš„å¼€å‘ï¼Œkhronos ç»„ç»‡æœ€æ–°åˆ¶å®šçš„å›¾å½¢æ¥å£æ ‡å‡† VulkanÂ® API å¯ä»¥æ›´ç²¾ç»†çš„å¼€å‘èƒ½åŠ›ã€‚
Vulkan è™½ç„¶ç»™å¼€å‘è€…æä¾›äº†æ›´å¤šçš„è‡ªç”±åº¦ï¼Œå¦‚æœè¿™ä¸ªå¼€å‘è€…æœ¬èº«ä¸è‡ªç”±(éå¤§ç‰›)ï¼Œé‚£ç”¨å› OpenGL å°±å¾ˆå¥½ã€‚
åŸå› å°±åœ¨äºå¦‚æœå¼€å‘è€…å¯¹å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œå¯¹ç¨‹åºè¿è¡Œæœºåˆ¶æ²¡æœ‰åè¶³çš„ç†è§£ï¼Œé‚£å°±å¯èƒ½ä¼šè¯¯ç”¨ Vulkan 
å¯¼è‡´è¿è¡Œæ•ˆç‡ç”šè‡³ OpenGL è¿è¡Œæ•ˆç‡æ›´ä½ï¼Œé‚£è¿™æ ·å°±å¾—ä¸å¿å¤±ã€‚

ä¸ä½¿ç”¨ OpenGL çŠ¶æ€æœºæä¾›çš„å›ºå®šçŠ¶æ€å’Œæ“ä½œé›†ç›¸æ¯”ï¼ŒVulkan API ä¸ºç¨‹åºå‘˜æä¾›äº†å¯¹ç»˜å›¾è¿‡ç¨‹çš„æ›´å¤šæ§åˆ¶ï¼Œ
å¹¶ä¸”ä»¥æ›´çµæ´»ã€æ›´ç®€å•çš„æ–¹å¼ã€‚å€ŸåŠ©è¿™ä¸€é¢å¤–çš„çµæ´»æ€§ï¼Œç€è‰²å™¨å¯ç”¨äºåˆ›å»ºè¿‡äºå¤æ‚ï¼ˆå¦‚æœä¸æ˜¯ä¸å¯èƒ½çš„è¯ï¼‰çš„æ•ˆæœï¼Œ
ç”¨å¸¸è§„ OpenGL å‡½æ•°æ— æ³•æè¿°è¿™äº›æ•ˆæœï¼šæ¯åƒç´ ç…§æ˜ã€é˜´å½±ç­‰ã€‚ç°ä»£æ˜¾å¡å’Œæ–°çš„ OpenGL Core Profile 
å›¾å½¢æ¥å£å·²ç»å®Œå…¨åŸºäºç€è‰²å™¨ï¼Œç§°ä¸ºå›ºå®šç®¡é“çš„å›ºå®šçŠ¶æ€å’Œå‡½æ•°é›†å·²è¢«å¼ƒç”¨ï¼Œå°†æ¥å¯èƒ½ä¼šè¢«åˆ é™¤ã€‚

æ¯•ç«Ÿ Vulkan ç»†æ‚ä½“ç°åœ¨ï¼Œè¦å®ç°å›¾å½¢å­¦çš„ Hello World ç¨‹åºç»˜åˆ¶ä¸‰è§’å½¢ç»˜åˆ¶éœ€è¦ä¸Šåƒè¡Œä»£ç ï¼Œè¿™å¯¹äºç†Ÿæ‚‰
OpenGL ç¨‹åºçš„å¼€å‘äººå‘˜æ¥è®²æ˜¯ä¸å¯æƒ³è±¡çš„ï¼Œç”šè‡³æ¯”è‡ªå·±ç”¨ CPU å®ç°ä¸€å¥—è½¯å…‰æ …å™¨æ›´ä¸ºå¤æ‚ï¼åŒæ—¶éš¾åº¦ä¹Ÿä½“ç°åœ¨
å®ƒçš„ API å¤æ‚éš¾æ‡‚ï¼Œå¯¹äºå…¥é—¨å›¾å½¢å­¦çš„æ–°æ‰‹æ¥è®²å¹¶ä¸æ˜¯å¤ªç®€å•ã€‚æ‰€ä»¥ï¼Œæ— è®º OpenGL æˆ–è€… Vulkan è§„èŒƒï¼Œå…¶ç›®æ ‡
ç”¨æˆ·ä¸€èˆ¬æ˜¯å›¾å½¢å­¦é«˜çº§ç©å®¶ã€æˆ–æ¸¸æˆå¼•æ“å¼€å‘å›¢é˜Ÿã€‚

å­¦ä¹  OpenGL ç€è‰²å™¨ç¼–ç¨‹è¦ææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼ŒOpenGL API æ˜¯ä¸€ä¸ªæä¾›å›¾å½¢æ¥å£çš„è§„èŒƒï¼Œè€Œç¡¬ä»¶å‚å•†è´Ÿè´£å®ç°
è¿™å¥—è§„èŒƒï¼Œåº”ç”¨å¼€å‘è€…åˆ™æŒ‰è§„èŒƒè¿›è¡Œæ¸¸æˆæˆ–å¼•æ“ä¹‹ç±»è½¯ä»¶çš„å¼€å‘ï¼Œä¸‰æ–¹äº’ç›¸ç‹¬ç«‹åˆæœ‰è”ç³»ã€‚OpenGL è¿™å¥—æ¥å£ä¸‹ï¼Œ
æä¾›çš„ GPU ç¼–ç¨‹è¯­è¨€æ˜¯ The OpenGL Shading Languageï¼Œç®€ç§°ä¸º GLSLã€‚

ç›®å‰ï¼Œä¸‰å¤§ä¸»æµè§„èŒƒä½¿ç”¨çš„ Shader è¯­è¨€æ˜¯ï¼š

- HLSL - Direct3D High Level Shader Language
- GLSL - OpenGL Shader Language 
- CGSL - Nvidia C for Graphic

ç€è‰²å™¨ Shaders å°±æ˜¯åœ¨ GPU ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œä¹Ÿå°±æ˜¯å¯¹ GPU ç¼–ç¨‹çš„ä»£ç ç‰‡æ–­ï¼Œæ‰€è°“ç‰‡æ–­æ˜¯æŒ‡è¿™ç§ç¨‹åºä¸€èˆ¬å¾ˆå°ï¼Œ
å¯èƒ½æœ€å¤šå°±æ˜¯ä¸Šå‡ ç™¾è¡Œä»£ç ã€‚å‡ºäº OpenGL é€šç”¨æ€§è€ƒè™‘ï¼ŒGLSL (OpenGL Shading Language) è¯­æ³•ä¸Šç±»ä¼¼ C/C++ã€‚

åœ¨æ—©æœŸï¼ŒOpenGL å’Œ GLSL çš„ç‰ˆæœ¬å‘è¡Œå¹¶ä¸ä¸€è‡´ï¼Œç›´åˆ° OpenGL 2.0 å¼€å§‹ï¼Œæ‰å¯¹åº”å‘è¡Œä¸€ä¸ªç‰ˆæœ¬å·ã€‚ä½†ç‰ˆæœ¬å·
å¹¶ä¸æ€»æ˜¯ä¸€è‡´ï¼Œç›´åˆ° OpenGL 3.3 å¼€å§‹æ‰ä¸€è‡´ï¼Œæ‰€ä»¥ Godot ä½¿ç”¨çš„ GLSL 2/3 å¯¹åº” OpenGL 1.2 å’Œ 3.3ï¼š

|    æ—¶é—´    |     ç‰ˆæœ¬     | GLSL |                    ä¸»è¦ç‰¹æ€§å¢åŠ                     |
|------------|--------------|------|----------------------------------------------------|
| 1992/01    | OpenGL 1.0   | -    |                                                    |
| 1997/01    | OpenGL 1.1   | -    | Vertex arrays                                      |
| 1998/03/16 | OpenGL 1.2   | -    | Imaging subset (optional)                          |
| 1998/10/14 | OpenGL 1.2.1 | -    | Define ARB extensions concept                      |
| 2001/08/14 | OpenGL 1.3   | -    | Compressed texture format                          |
| 2002/07/24 | OpenGL 1.4   | -    | Automatic mipmap generation                        |
| 2003/07/29 | OpenGL 1.5   | -    | Buffer object                                      |
| 2004/09/07 | OpenGL 2.0   | 1.10 | OpenGL Shading Language 1.00                       |
| 2006/07/02 | OpenGL 2.1   | 1.20 |                                                    |
| 2008/08/11 | OpenGL 3.0   | 1.30 | Deprecation Model                                  |
| 2009/03/24 | OpenGL 3.1   | 1.40 |                                                    |
| 2009/08/03 | OpenGL 3.2   | 1.50 | Geometry shaders, in/out interface block           |
| 2010/03/11 | OpenGL 3.3   | 3.30 |                                                    |
| 2010/03/11 | OpenGL 4.0   | 4.00 | Tessellation Shader                                |
| 2010/07/26 | OpenGL 4.1   | 4.10 |                                                    |
| 2011/08/08 | OpenGL 4.2   | 4.20 |                                                    |
| 2012/08/06 | OpenGL 4.3   | 4.30 | Arbitrary Compute Shaders                          |
| 2013/07/23 | OpenGL 4.4   | 4.40 |                                                    |
| 2014       | OpenGL 4.5   | 4.50 |                                                    |
| 2017       | OpenGL 4.6   | 4.60 | The SPIR-V language can be used to define shaders. |

å…³é”®çš„ç‰ˆæœ¬æœ‰ï¼š

- OpenGL 2.0 å¼•å…¥ç€è‰²å™¨è¯­è¨€ï¼Œæ”¯æŒé¡¶ç‚¹ç€è‰²å™¨ã€ç‰‡æ®µç€è‰²å™¨ï¼›
- OpenGL 3.0 å¢åŠ äº†â€œå¼ƒç”¨â€æ¦‚å¿µï¼šDeprecation Modelï¼Œåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­å°†æŸäº›åŠŸèƒ½æ ‡è®°ä¸ºåˆ é™¤çŠ¶æ€ã€‚
- OpenGL 3.1 åŸºäºç°æœ‰çš„å¼ƒç”¨æ¨¡å‹ï¼Œå’Œåç»­å°†è¦å®ç°çš„ Core Profile é‡å¤§ä¿®æ”¹ï¼Œåˆ é™¤äº†å¤§å¤šæ•°ä¸æ¨èçš„åŠŸèƒ½ã€‚
- OpenGL 3.2 å¼•å…¥å‡ ä½•ç€è‰²å™¨ï¼›åˆ›å»ºäº†ä¸¤ä¸ªä¸Šä¸‹æ–‡æ¦‚å¿µï¼šCore Profile å’Œ Compatibility Profileã€‚
- OpenGL 4.0 å¼•å…¥ç»†åˆ†ç€è‰²å™¨ï¼›
- OpenGL 4.3 å¼•å…¥è®¡ç®—ç€è‰²å™¨ï¼›
- OpenGL 4.6 æ­£å¼å¼•å…¥ SPIR-V æ ‡å‡†å¯ç§»æ¤ä¸­é—´å±‚è¯­è¨€ï¼›

OpenGL ä¸ºäº†é€‚åº”ç°ä»£çš„ GPU å¼€å‘ï¼Œä½¿ç”¨ Core Profile ä¸Šä¸‹æ–‡é…ç½®ï¼Œä½¿å¼€å‘è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›æ›´åº•å±‚çš„åŠŸèƒ½ã€‚
2008 å¹´ 8 æœˆ 11 æ—¥å‘å¸ƒçš„ OpenGL 3.0 è¿™ä¸ªç‰ˆæœ¬ä»£å·å«åš Longs Peakï¼Œå¤§é‡æ”¹å˜åŸæœ‰å·¥ä½œæ–¹å¼ï¼Œæ ¹æœ¬æ€§
æ”¹å˜ API è°ƒç”¨æ–¹å¼ã€‚ä»æ­¤å¼€å§‹åˆ† *Core Profile* å’Œ *Compatibility Profile* ä¸¤ç§ä¸Šä¸‹æ–‡å·¥ä½œæ–¹å¼ï¼Œ
å¹¶ä¸” Khronos Group å¸Œæœ›åªæ”¯æŒ Core Profileã€‚ä½†è¿™ä¸ªé©æ–°æ€§çš„è§„èŒƒè¢«è®¸å¤šå‚å•†æ˜ç¡®è¡¨ç¤ºæ‹’ç»ï¼Œä»–ä»¬å¹¶è¡¨ç¤º
ä¼šç»§ç»­æ”¯æŒè®¸å¤šè¢«åˆ’å…¥ Compatibility Profile çš„æ‰©å±•ï¼Œæ‰€ä»¥æ”¹ä¸ºå¯é€‰é¡¹ã€‚

OpenGL 3.0 çš„å‡ºç°æ”¹å˜äº†è¿‡å» OpenGL å‘åå…¼å®¹çš„ç‰¹æ€§ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†åŸæœ‰ API çš„è‡ƒè‚¿å¢åŠ çµæ´»åº¦ã€‚
ä½†æ˜¯ï¼Œæ²¡æœ‰é‡‡ç”¨å‘åå…¼å®¹æ–¹å¼ï¼Œæ‰€ä»¥åŸæœ‰çš„å¼€å‘æµç¨‹è¢«æ‰“ç ´ï¼Œè®¸å¤šå¼€å‘è€…æ˜¯ä¸èƒ½æ¥å—çš„ã€‚

Core Profile åªåŒ…å«æœ€æ–°çš„ Shader ç›¸å…³çš„å‡½æ•°ï¼Œç¨‹åºå¿…é¡»ä½¿ç”¨ Shader ç¼–å†™ã€‚è€Œå…¼å®¹é…ç½®åˆ™å¯ä»¥å…¼å®¹åŸ
OpenGL å›ºå®šç®¡çº¿çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Core Profile ä¸­çš„å†…å®¹ã€‚

æ–°ç‰ˆæœ¬ OpenGL åçš„åŸºæœ¬å‚è€ƒæ–‡æ¡£ä¹Ÿå˜ä¸ºä¸‰ä¸ªï¼Œä¾‹å¦‚ OpenGL 3.3 ç›¸åº”çš„æ–‡æ¡£åŒ…æ‹¬ï¼š

- OpenGL è§„èŒƒæ–‡æ¡£ï¼šGLSLangSpec.3.30.pdf
- GLSL æ ¸å¿ƒæ¨¡å¼è§„èŒƒæ–‡æ¡£ï¼šglspec33.core.pdf
- GLSL å…¼å®¹æ¨¡å¼è§„èŒƒæ–‡æ¡£ï¼šglspec33.compatibility.pdf

å¦å¤–ï¼Œè¿˜å¼•å…¥äº†ä¸€ä¸ª Forward compatibility æ¨¡å¼ï¼Œå³å‘æœªæ¥å…¼å®¹ï¼ŒæŒ‰ Deprecation è¿‡æ—¶æ ‡è®°çš„å‡½æ•°éƒ½ä¸å¯ç”¨ã€‚

æ— è®ºè¿™äº› API è§„èŒƒå¦‚ä½•æ‰“æ¶ï¼Œç€è‰²å™¨å§‹ç»ˆå°±æ˜¯é«˜æ•ˆç»˜å›¾çš„ä»£åè¯ï¼Œé€šè¿‡å¯ç¼–ç¨‹ç€è‰²å™¨è¯­è¨€ Shader Language
åœ¨ GPU ä¸­æ‰§è¡Œé«˜æ•ˆçš„å›¾å½¢æ¸²æŸ“ä»£ç ã€‚å®˜æ–¹æä¾›çš„ OpenGL Wiki æ–‡æ¡£æ˜¯æœ€ä½³å…¥é—¨ææ–™ï¼Œä¸Šé¢æœ‰å…³äº Rendering pipelineï¼Œ
OpenGL Shading Language çš„åŸºæœ¬ä»‹ç»ã€‚å¦å¤–ï¼ŒShadertoy ç½‘ç«™ä¹Ÿæ˜¯ä¸€ä¸ªè†œæ‹œå¤§ç¥ç€è‰²å™¨æ¡ˆä¾‹çš„å¥½å»å¤„ã€‚


æ ¹æ® OpenGL æ–‡æ¡£ï¼ŒOpenGL Render Pipeline æ¸²æŸ“ç®¡çº¿çš„å·¥åºå¦‚ä¸‹ï¼š

- Vertex Specification
    - Vertex Rendering
    - Primitive
- Vertex Processing
    - Vertex Shader
    - Tessellation
    - Geometry Shader
- Vertex Post-Processing
    - Transform Feedback
    - Clipping
- Primitive Assembly
    - Face Culling
- Rasterization
- Fragment Shader
- Per-Sample Processing
    - Scissor Test
    - Stencil Test
    - Depth Test
    - Blending
    - Logical Operation
    - Write Mask

ç‰‡æ®µç€è‰²å™¨é˜¶æ®µä¹ŸåŸºæœ¬å°±æ˜¯æ¸²æŸ“ç®¡çº¿çš„æœ€åæµç¨‹ï¼Œç»è¿‡æœ€åçš„å¤„ç†å°±å¾—åˆ°äº†å±å¹•ä¸Šè¾“å‡ºçš„å›¾å½¢ã€‚

Mastering SFML game development by Pupius, Raimondas ä¹¦ä¸­æä¾›äº†ä¸€å¼ å¯ç¼–ç¨‹æ¸²æŸ“ç®¡çº¿ç¤ºæ„å›¾ï¼Œ
å¾ˆç®€æ˜åœ°è¡¨è¾¾äº†æ¸²æŸ“ç®¡çº¿å„ä¸ªå·¥åºçš„ä½œç”¨ï¼š

![Programmable pipeline - Mastering SFML game development by Pupius, Raimondas](https://github.com/jimboyeah/spine-sfml-demo/raw/master/images/Programmable%20pipeline%20-%20Mastering%20SFML%20game%20development%20by%20Pupius,%20Raimondas.jpg)

ä»¥ä¸‹æ˜¯æ ¹æ® OpenGL Programming Guide ç¬¬ 9 ç‰ˆæœ¬åˆ¶ä½œçš„ GPU æ¸²æŸ“æµç¨‹å›¾ï¼š

```sh
+========+      +========+      +==============+    +==============+
| Vertex |      | Vertex |      | Tessellation |    | Tessellation |
| Data   |  ->  | Shader |  ->  | Control      | -> | Evaluation   |
+========+      +========+      | Shader       |    | Shader       |
                                +==============+    +==============+
  +==========+                                                |
  | Culling  |      +===========+      +==========+           |
  |   and    |      | Primitive |      | Geometry |           |
  | Clipping |  <-  | Setup     |  <-  | Shader   |  <--------+
  +==========+      +===========+      +==========+
       |  
       V                              +=============+
+===============+    +==========+     | â–ˆâ–€â–€â–‘â–ˆâ–‘â–ˆâ–‘â–€â–ˆâ–€ |
| Rasterization | -> | Fragment | ->  | â–ˆâ–€â–€â–‘â–„â–€â–„â–‘â–‘â–ˆâ–‘ |
+===============+    | Shader   |     | â–€â–€â–€â–‘â–€â–‘â–€â–‘â–‘â–€â–‘ |
                     +==========+     +=============+

        Figure 1.2 OpenGL pipeline
```

è¿™é‡Œï¼Œæœ‰å‡ ä¸ªå…³é”®çš„é˜¶æ®µï¼Œå…¶ä¸­*é¡¶ç‚¹ç€è‰²å™¨*å’Œ**ç‰‡æ®µç€è‰²å™¨**æ˜¯å¿…éœ€å¤–éƒ¨æä¾›çš„ï¼Œå¼•æ“ä¸€èˆ¬æä¾›é»˜è®¤çš„å®ç°ã€‚
GPU ç»˜ç”»éœ€è¦çŸ¥é“å›¾å½¢çš„ç»“æ„ï¼Œå›¾å½¢ç»“æ„ä¾èµ–é¡¶ç‚¹æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®ä¸èƒ½å‡­ç©ºäº§ç”Ÿï¼Œåº”ç”¨ç”±å¼€å‘éƒ½æä¾›ï¼š

- âœ’ ä»é¡¶ç‚¹æ•°æ®è¾“å…¥åˆ° *Geometry Shader* å‡ ä½•ç€è‰²å™¨ä¸ºæ­¢ï¼Œè¿™éƒ¨åˆ†æ˜¯æ•´ä¸ªæ¸²æŸ“æµç¨‹çš„å‰ç«¯éƒ¨åˆ†ã€‚
- âœ’ å…¶æ¬¡ï¼Œæ˜¯å›ºå®šåŠŸèƒ½éƒ¨åˆ†ï¼ŒPrimitive Assembly, Clipping, Rasterization ç­‰é˜¶æ®µå°±æ˜¯å°†ä»£è¡¨
     åœºæ™¯çš„å›¾å…ƒè½¬åŒ–ä¸ºåƒç´ ï¼Œä¼šåº”ç”¨ Viewport Transformation è¿™ç±»æ“ä½œä»¥å°†è™šæ‹Ÿ 3D åœºæ™¯æ˜ å°„åˆ° 2D çš„å±å¹•ç©ºé—´ä¸Šã€‚ä¸»è¦æ˜¯å…‰æ …åŒ–ï¼Œå‡ ä½•ç©ºé—´ä¸Šçš„é¡¶ç‚¹é€šè¿‡æŠ•å°„å˜æ¢ï¼Œç¡®å®šäº†å¯¹åº”å±å¹•å…‰æ …çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯å‡ ä½•
     å›¾å½¢ç©ºé—´çš„ç‚¹ä¸åƒç´ åæ ‡çš„å¯¹åº”å…³ç³»ç¡®ç«‹ã€‚
- âœ’ æœ€åï¼Œæ˜¯ä»¥ *Fragment Shader* ä¸ºåˆ†ç•Œçš„æ¸²æŸ“åæœŸé˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µæœ€é‡è¦çš„å·¥ä½œå°±æ˜¯åœ¨å°†æ•°æ®å‘é€åˆ°
     å¸§ç¼“å†²åŒºå‰ç¡®å®šåƒç´ çš„é¢œè‰²ã€‚

ç‰‡æ®µç€è‰²å™¨é˜¶æ®µå¯¹äºå¼€å‘è€…æ¥è¯´ç›¸å½“é‡è¦ï¼Œå¼€å‘è€…å¯ä»¥å†³å®šè¿™äº›ç‰‡å…ƒè¯¥ç€ä¸Šä»€ä¹ˆæ ·çš„é¢œè‰²ï¼Œè¿™ä¸ªé˜¶æ®µä¹Ÿè¢«ç§°ä¸ºåƒç´ 
ç€è‰²å™¨ï¼Œå°½ç®¡è¿™ç§ç§°è°“ä¸æ˜¯å¤ªæ°å½“ã€‚å½“å‡ ä½•ä½“è£…é…ä¸ºå›¾å…ƒå¹¶é€å…¥å…‰æ …åŒ–é˜¶æ®µï¼Œè¿™é‡Œå°†è®¡ç®—å‡ºçª—å£ä¸­å“ªäº›åƒç´ å—åˆ°äº†
å‡ ä½•ä½“çš„å½±å“ã€‚å½“ OpenGL ç¡®å®šå½“å‰éœ€è¦ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ç‰‡å…ƒæ—¶ï¼Œå®ƒå°†æ‰§è¡Œç‰‡å…ƒç€è‰²å™¨çš„å†…å®¹ï¼Œç„¶åå°±è¿›å…¥é€ç‰‡å…ƒ
çš„ä¸€ç³»åˆ—æ“ä½œï¼Œç»è¿‡å‡ ä¸ªå¤„ç†é˜¶æ®µï¼Œåˆ¤æ–­ç‰‡å…ƒæ˜¯å¦å¯ä»¥ä½œä¸ºåƒç´ ç»˜åˆ¶åˆ°å¸§ç¼“å­˜ä¸­ï¼Œä»¥åŠæ§åˆ¶ç»˜åˆ¶çš„æ–¹å¼ã€‚åªæœ‰è¿›å…¥ 
frame buffer åæ‰æ„å‘³ç€ç›¸åº”çš„å›¾åƒåƒç´ å³å°†è¦ç”Ÿæˆã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç‰‡å…ƒè¶…å‡ºäº†å¸§ç¼“å­˜çš„çŸ©å½¢åŒºåŸŸï¼Œæˆ–è€…å®ƒä¸å½“å‰å¸§ç¼“å­˜ä¸­åŒä½ç½®çš„åƒç´ ç›¸æ¯”ï¼Œè·ç¦»è§†ç‚¹æ›´è¿œï¼Œé‚£ä¹ˆ
æ­£åœ¨å¤„ç†çš„è¿‡ç¨‹éƒ½ä¼šåœæ­¢ï¼Œç‰‡å…ƒä¹Ÿä¸ä¼šè¢«ç»˜åˆ¶è¿™äº›ç”¨æˆ·åœ¨å±å¹•ä¸Šçœ‹ä¸è§çš„åŒºåŸŸã€‚è€Œå¦ä¸€ä¸ªé˜¶æ®µå½“ä¸­ï¼Œç‰‡å…ƒçš„é¢œè‰²ä¼š
ä¸å½“å‰å¸§ç¼“å­˜ä¸­çš„åƒç´ é¢œè‰²è¿›è¡Œæ··åˆã€‚é€ç‰‡å…ƒæ“ä½œï¼ˆPer-Fragment Operationsï¼‰å¯¹æ¯ä¸ªç‰‡å…ƒè¿›è¡Œæ“ä½œï¼Œå°†
å®ƒä»¬çš„é¢œè‰²ä»¥æŸç§å½¢å¼åˆå¹¶ï¼Œå¾—åˆ°æœ€ç»ˆåœ¨å±å¹•ä¸Šåƒç´ æ˜¾ç¤ºçš„é¢œè‰²ï¼Œä¸»è¦å·¥ä½œæ˜¯ç‰‡å…ƒæµ‹è¯•ï¼ˆTestï¼‰ä¸åˆå¹¶ï¼ˆMergeï¼‰ã€‚

ç‰‡å…ƒè¿›å…¥åˆ°å¸§ç¼“å­˜ä¹‹å‰éœ€è¦ç»è¿‡å®Œæ•´æµ‹è¯•è¿‡ç¨‹ï¼Œç‰‡å…ƒå†™å…¥ frame buffer æ—¶å¯ä»¥æ‰§è¡Œä¸€äº›é«˜åº¦å¯é…ç½®çš„æ“ä½œã€‚
è¿™äº›æµ‹è¯•å’Œæ“ä½œå¤§éƒ¨åˆ†éƒ½å¯ä»¥é€šè¿‡ glEnable() å’Œ gIDisable() æ¥å¯ç”¨æˆ–åœç”¨ã€‚å¼•æ“ä¹Ÿä¼šé€šè¿‡ç•Œé¢æä¾›ç›¸åº”
åŠŸèƒ½é…ç½®é€‰é¡¹ï¼Œæ¯”å¦‚ Depth Testã€Depth Write ç­‰é…ç½®é€‰é¡¹ã€‚æ·±åº¦å†™å…¥æ˜¯åˆ¤æ–­è¯¥æè´¨æ˜¯å¦ä¼šå‰”é™¤åé¢çš„åƒç´ ï¼Œ
åªè¦å¼€å¯ Depth Write ä¸ç®¡æ˜¯å¦ä¸ºé€æ˜ç‰©ä½“ï¼Œéƒ½ä¼šæ ¹æ® Z æ¥é®æŒ¡åé¢çš„ç‰©ä½“ã€‚

å¦‚æœä¸€ä¸ªç‰‡å…ƒåœ¨æŸä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­ä¸¢å¼ƒï¼Œé‚£ä¹ˆä¹‹åæ‰€æœ‰çš„æµ‹è¯•æˆ–è€…æ“ä½œéƒ½ä¸ä¼šå†æ‰§è¡Œï¼Œè¿™äº›æµ‹è¯•å’Œæ“ä½œçš„é¡ºåºå¦‚ä¸‹ï¼š

1ï¼‰å‰ªåˆ‡æµ‹è¯•ï¼ˆscissor test)å°†æ‰€æœ‰ç»˜åˆ¶æ“ä½œéƒ½é™åˆ¶åœ¨å‰ªåˆ‡ç›’åŒºåŸŸå†…ã€‚
2ï¼‰å¤šé‡é‡‡æ ·çš„ç‰‡å…ƒæ“ä½œï¼ˆmultisamplingï¼‰å‡ ä½•å›¾å…ƒè¾¹ç¼˜å¹³æ»‘æŠ€æœ¯ï¼Œä¹Ÿå«åèµ°æ · antialiasingã€‚
3ï¼‰æ¨¡æ¿æµ‹è¯•ï¼ˆstencil test)æ¨¡æ¿å€¼ä¸æ¨¡æ¿ç¼“å†²åŒºçš„æ¨¡æ¿å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”è¾ƒé€šè¿‡ï¼Œç‰‡å…ƒæ‰è¢«ç»§ç»­å¤„ç†ã€‚
4ï¼‰æ·±åº¦æµ‹è¯•ï¼ˆdepth test)ç‰‡å…ƒçš„æ·±åº¦å€¼ï¼ˆZåæ ‡åˆ†é‡ï¼‰ä¸ç¼“å†²åŒºçš„æ·±åº¦å€¼è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®å®šç‰©ä½“çš„é®æŒ¡å…³ç³»ã€‚
5ï¼‰èæ··ï¼ˆblendingï¼‰å³æ ¹æ®å›¾åƒçš„ alpha åŠæ··åˆæ–¹ç¨‹è¿›è¡Œé€æ˜ç‰©çš„æ··åˆã€‚
6ï¼‰æŠ–åŠ¨ï¼ˆditheringï¼‰é€šè¿‡å¯¹é¢œè‰²è¾ƒå•è°ƒçš„å›¾åƒè¿›è¡ŒæŠ–åŠ¨æ¥æå‡é¢œè‰²çš„åˆ†è¾¨ç‡ï¼Œä¸æŠ¥çº¸å°åˆ·æ—¶å€™çš„åŠè°ƒæ–¹æ³•æœ‰ç‚¹ç±»ä¼¼ã€‚
7ï¼‰é€»è¾‘æ“ä½œï¼Œç‰‡å…ƒçš„æœ€åä¸€ä¸ªæ“ä½œï¼ŒåŒ…æ‹¬ ORã€XORã€INVERTï¼Œå¤„ç†å½“å‰è¾“å…¥ç‰‡å…ƒæ•°æ®ï¼ˆæºï¼‰ä»¥åŠå½“å‰é¢œè‰²ç¼“å­˜ä¸­çš„æ•°æ®ï¼ˆç›®æ ‡)ã€‚

ä½¿ç”¨å¤šé‡é‡‡æ ·æŠ€æœ¯ multi-samplingï¼Œå¯ä»¥åœ¨ä¸€ä¸ª framebuffer ä¸Šä¸ºæ¯ä¸ªåƒç´ ä¿å­˜å¤šä¸ª depth, stencil
æˆ–è€…é¢œè‰²å€¼ã€‚Depth buffer ä¸­ä¿å­˜çš„å€¼é€šå¸¸æ˜¯ [0, 1] èŒƒå›´çš„å€¼ï¼Œ0 è¡¨ç¤ºè·ç¦»æœ€è¿‘ï¼Œ1 è¡¨ç¤ºè·ç¦»æœ€è¿œã€‚å·²ç»
æ¸²æŸ“çš„ä½ç½®ï¼ŒOpenGL å¯ä»¥æ¯”è¾ƒç‰‡æ®µçš„çª—å£ç©ºé—´åæ ‡ä¸æ·±åº¦ç¼“å†²åŒºä¸­å·²ç»å­˜åœ¨çš„å€¼ã€‚å¦‚æœè¯¥å€¼å°äºå·²ç»å­˜åœ¨çš„å€¼ï¼Œ
åˆ™ç‰‡æ®µå¯è§ã€‚è¿™ç§æµ‹è¯•çš„æ„ä¹‰ä¹Ÿå¯ä»¥æ”¹å˜ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥è¦æ±‚ OpenGL å…è®¸å…·æœ‰å¤§äºã€ç­‰äºï¼Œæˆ–ä¸ç­‰äºæ·±åº¦ç¼“å†²åŒº
å†…å®¹çš„ z åæ ‡åˆ†é‡çš„ç‰‡æ®µé€šè¿‡ã€‚æ·±åº¦æµ‹è¯•çš„ç»“æœä¹Ÿä¼šå½±å“ OpenGL å¯¹ stencil ç¼“å†²åŒºçš„æ“ä½œã€‚


å›¾å½¢åº”ç”¨ä¸€èˆ¬ä¼šæ¶‰åŠå¤§é‡çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼Œç»˜åˆ¶ä¸€ä¸ªå¸¦çº¹ç†å›¾çš„æ­£æ–¹ä½“ï¼Œçº¹ç†æ–‡ä»¶çš„å¤§å°å†³å®šäº†å›¾å½¢çš„ç²¾ç»†åº¦ï¼Œä¸ºäº†
é«˜è´¨é‡ï¼Œä¸€å¼ çº¹ç†å¯èƒ½å°±æœ‰å‡  MBï¼Œç”šè‡³å‡ å MBã€‚æ­£æ–¹ä½“æœ¬èº«æ¨¡å‹ç»“æ„ç®€å•ï¼Œå¯èƒ½åªæœ‰ 8 ä¸ªé¡¶ç‚¹ï¼Œä½†æ˜¯åœ¨é¡¹ç›®ä¸­
ä¸€èˆ¬ä½¿ç”¨çš„æ¨¡å‹éƒ½æ˜¯æç²¾ç»†çš„ï¼Œå¹¶ä¸”è¿˜éœ€è¦ä»é«˜åº¦ç²¾ç»†çš„æ¨¡å‹åˆ¶ä½œå‡ºä½ç²¾åº¦çš„æ¨¡å‹ï¼Œä»¥æå‡ GPU å·¥ä½œæ•ˆç‡ï¼Œé¿å…
å› ä¸ºæ¨¡å‹é¢æ•°æå¤§å¯¼è‡´ GPU è¿‡è´Ÿè€Œä¸èƒ½è¾¾åˆ°è¦æ±‚çš„å¸§ç‡ã€‚

å¦å¤–ï¼Œé¡¶ç‚¹æ•°æ®ä¸ä»…ä»…æ˜¯åæ ‡æ•°æ®ï¼Œé™¤äº†ä½ç½®åæ ‡ä¿¡æ¯ï¼Œé¡¶ç‚¹è¿˜å¯ä»¥æœ‰é¢œè‰²ã€çº¹ç†è´´å›¾åæ ‡ç­‰ç­‰ã€‚ä¸ºäº†æé«˜æ•°æ®ä½¿ç”¨
æ•ˆç‡ï¼ŒOpenGL ä¸­ä½¿ç”¨ä»¥ä¸‹æ•°æ®å¯¹è±¡ï¼Œå‚è€ƒ Rendering Pipeline Overview - Vertex Specificationï¼š

- `VBO` - Vertex Buffer object åœ¨æ˜¾å¡å­˜å‚¨ç©ºé—´ä¸­å¼€è¾Ÿå‡ºçš„ä¸€å—å†…å­˜ç¼“å­˜åŒºç”¨æ¥å‚¨å­˜é¡¶ç‚¹æ•°æ®ï¼Œå¢åŠ 
        é¡¶ç‚¹è¿›å…¥ GPU æ•ˆç‡çš„æ–¹æ³•ã€‚å®ƒä»¬æ˜¯å¯ä»¥å­˜å‚¨åœ¨æ˜¾å­˜ä¸­çš„ç¼“å†²åŒºï¼Œä»¥æœ€å¿«çš„ GPU é€Ÿåº¦å»è®¿é—®æ•°æ®ã€‚
- `VAO` - Vertex Arrary Object é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼Œå®šä¹‰äº† VBO é¡¶ç‚¹å±æ€§ä¿¡æ¯ï¼Œå’Œç€è‰²å™¨å˜é‡èµ·è¿æ¥ä½œç”¨ã€‚
        è™½ç„¶ï¼ŒVBO å®ç°äº†æ•°æ®ç¼“å­˜çš„ç›®çš„ï¼Œä½†æ¯æ¬¡ç»˜åˆ¶æ¨¡å‹ä¹‹å‰éœ€è¦ç»‘å®šé¡¶ç‚¹çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œ
        é‡å¤è¿™æ ·çš„åŠ¨ä½œå˜å¾—éå¸¸éº»çƒ¦ã€‚VAO å¯ä»¥æŠŠè¿™äº›æ‰€æœ‰çš„é…ç½®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œæ¯æ¬¡ç»˜åˆ¶æ¨¡å‹æ—¶ï¼Œ
        åªéœ€è¦ç»‘å®šè¿™ä¸ª VAO å¯¹è±¡å°±å¯ä»¥äº†ã€‚ ç¼“å­˜é¡¶ç‚¹çš„æ–¹å¼ï¼Œæ¯”èµ·é›¶æ•£çš„é¡¶ç‚¹ä¼ è¾“æ•ˆç‡è¦é«˜ã€‚å¦å¤–ï¼Œé€šè¿‡ VAO
        å®šä¹‰çš„é¡¶ç‚¹å±æ€§ä¿¡æ¯ï¼Œå¯ä»¥æŒ‰ä¸åŒçš„æ–¹å¼æ¥ç»„ç»‡æ•°æ®ï¼Œæ¯”å¦‚ VBO ä¸­çš„æ•°æ®æ¯éš”å‡ ä¸ªå­—èŠ‚æ˜¯åæ ‡ã€
- `EBO` - Element Buffer Object ç´¢å¼•ç¼“å†²å¯¹è±¡ï¼Œæˆ–è€…ç§° `IBO` - Index Buffer Objectï¼Œ
        ç”¨äºç´¢å¼•é¡¶ç‚¹æ•°ç»„çš„æ•°æ®ï¼Œè§£å†³é¡¶ç‚¹é‡ç”¨é—®é¢˜ï¼Œå¯ä»¥å‡å°‘å†…å­˜ç©ºé—´æµªè´¹ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œç«‹æ–¹ä½“
        åªè¦å­˜å‚¨ 8 ä¸ªé¡¶ç‚¹ä¿¡æ¯ï¼Œé€šè¿‡ç´¢å¼•å¯¹è±¡å¼•ç”¨ä¸åŒçš„ç‚¹å°±å¯ä»¥ç”¨ä¸‰è§’å½¢ç»˜åˆ¶å‡ºæ•´ä¸ªæ¨¡å‹ã€‚å¦‚æœï¼Œç›´æ¥ä½¿ç”¨
        ä¸‰è§’å½¢çš„é¡¶ç‚¹æ¥ç»˜å›¾ï¼Œåˆ™ç«‹æ–¹ä½“ 6 ä¸ªé¢è‡³å°‘éœ€è¦ 12 ä¸ªä¸‰è§’å½¢å…± 36 ä¸ªé¡¶ç‚¹ã€‚è€Œé€šè¿‡ç´¢å¼•å¯¹è±¡ï¼Œ
        å½“éœ€è¦ä½¿ç”¨é‡å¤çš„é¡¶ç‚¹æ—¶ï¼Œå°±ä½¿ç”¨ä½ç½®ç´¢å¼•æ¥è°ƒç”¨é¡¶ç‚¹åæ ‡ä¿¡æ¯ï¼Œè€Œä¸éœ€è¦é‡å¤è®°å½•é¡¶ç‚¹åæ ‡ã€‚

æ ¹æ®å®˜æ–¹ Vertex Specification æ–‡æ¡£æè¿°ï¼ŒVBO æœ¬èº«å­˜å‚¨çš„æ˜¯é¡¶ç‚¹æ•°æ®ï¼Œè€Œ VAO æœ¬èº«å­˜å‚¨çš„æ˜¯çŠ¶æ€ä¿¡æ¯ï¼Œ
å³æŒ‡æ˜ VBO ä¸­å­˜å‚¨çš„æ•°æ®æ˜¯ä»€ä¹ˆã€‚OpenGL æ‰§è¡Œç»˜åˆ¶å‘½ä»¤æ—¶ï¼Œéœ€è¦çŸ¥é“é¡¶ç‚¹ä¿¡æ¯åŒ…æ‹¬ä½ç½®ã€é¢œè‰²ã€æ³•çº¿ç­‰ç­‰ï¼Œå®ƒä»¬
å¯ä»¥åœ¨å“ªé‡Œå–å¾—ï¼ˆSlotï¼‰ï¼Œæ€ä¹ˆå–å¾—ï¼ˆoffsetï¼Œstrideï¼‰ï¼Œè¿™äº›éƒ½æ˜¯ VAO å¯ä»¥æä¾›çš„æ•°æ®ã€‚VAO å‡ºç°ä»¥å‰ï¼Œ
è°ƒç”¨ Draw Command ç»˜åˆ¶ä¹‹å‰éœ€è¦è°ƒç”¨ glVertexAttribPointer(â€¦) å‡½æ•°è®¾ç½®è¿™äº›ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯ä¸€æ¬¡è°ƒç”¨
ç»˜åˆ¶å‘½ä»¤éƒ½éœ€è¦é‡æ–°è®¾ç½®é¡¶ç‚¹çŠ¶æ€ä¿¡æ¯ã€‚VAO å‡ºç°ä¹‹åï¼Œé¡¶ç‚¹çŠ¶æ€ä¿¡æ¯é›†ä¸­å­˜å‚¨èµ·æ¥ï¼Œåœ¨æ‰§è¡Œç»˜åˆ¶å‘½ä»¤å‰ï¼Œè°ƒç”¨
**glBindBuffer(GL_ARRAY_BUFFER, VBO)** ç»‘å®š VAO å¯¹è±¡å³å¯ã€‚

OpenGL ç»˜å›¾æµç¨‹åœ¨ä¸ä½¿ç”¨ VAO åªä½¿ç”¨ VBO çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è°ƒç”¨ `glVertexAttribPointer()` è®¾ç½®
é¡¶ç‚¹å±æ€§ï¼Œå±æ€§å†…å®¹åŒ…æ‹¬ï¼›

```c
    glVertexAttribPointer(
       0,                  // attribute 0. No particular reason for 0, but must match the layout in the shader.
       3,                  // size
       GL_FLOAT,           // type
       GL_FALSE,           // normalized?
       0,                  // stride
       (void*)0            // array buffer offset
    );
```

- `index` å‚æ•°æŒ‡å®šä»ç´¢å¼• 0 å¼€å§‹å–æ•°æ®ï¼Œä¸é¡¶ç‚¹ç€è‰²å™¨ä¸­ layout(location=0) å¯¹åº”ã€‚
- `size` å‚æ•°æŒ‡å®šé¡¶ç‚¹å±æ€§å¤§å°ä¸º 3 å­—èŠ‚ã€‚
- `type` å‚æ•°æŒ‡å®šæ•°æ®ç±»å‹ã€‚
- `normalized` å‚æ•°å®šä¹‰æ˜¯å¦å¸Œæœ›æ ‡å‡†åŒ–æ•°æ®ï¼Œåªè¡¨ç¤ºæ–¹å‘ä¸è¡¨ç¤ºå¤§å°ã€‚
- `stride` å‚æ•°æ˜¯æ­¥é•¿ï¼ŒæŒ‡å®šåœ¨è¿ç»­çš„é¡¶ç‚¹å±æ€§ä¹‹é—´çš„é—´éš”ã€‚ä¸Šé¢ä¼  0 å’Œä¼  3 æ•ˆæœç›¸åŒï¼Œå¦‚æœä¼  1 å–å€¼æ–¹å¼ä¸º 012ã€123ã€234â€¦â€¦
- `offset` å‚æ•°è¡¨ç¤ºé¡¶ç‚¹æ•°æ®åœ¨ç¼“å†²åŒºèµ·å§‹ä½ç½®çš„åç§»ï¼Œæ˜¯ä¸€ä¸ª GLvoid æŒ‡é’ˆã€‚


ä»¥ä¸‹æ˜¯æ‘˜è‡ª Learn OpenGL æ•™ç¨‹ä¸­çš„ VBOã€VAO ç”¨æ³•æ¼”ç¤ºä»£ç ï¼Œå•çº¯ VBO æ–¹å¼æ¯æ¬¡ç»˜å›¾éƒ½éœ€è¦è®¾ç½®å±æ€§ï¼š

```c
// 0. copy our vertices array in a buffer for OpenGL to use
glBindBuffer(GL_ARRAY_BUFFER, VBO);
glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);
// 1. then set the vertex attributes pointers
glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);
glEnableVertexAttribArray(0);  
// 2. use our shader program when we want to render an object
glUseProgram(shaderProgram);
// 3. now draw the object 
someOpenGLFunctionThatDrawsOurTriangle();   
```

ä½¿ç”¨ VAO ä¿å­˜é¡¶ç‚¹å±æ€§æ•°æ®çš„ä¼˜ç‚¹å°±æ˜¯åœ¨åç»­çš„ç»˜åˆ¶ä¸­ï¼Œä¸éœ€è¦å†æ¬¡å¤„ç†å±æ€§æ•°æ®ï¼Œåªéœ€è¦å…ˆç»‘å®š VAO å¯¹è±¡ï¼š

```c
// ..:: Initialization code (done once (unless your object frequently changes)) :: ..
// 1. bind Vertex Array Object
glBindVertexArray(VAO);
// 2. copy our vertices array in a buffer for OpenGL to use
glBindBuffer(GL_ARRAY_BUFFER, VBO);
glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);
// 3. then set our vertex attributes pointers
glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);
glEnableVertexAttribArray(0);  

  
[...]

// ..:: Drawing code (in render loop) :: ..
// 4. draw the object
glUseProgram(shaderProgram);
glBindVertexArray(VAO);
someOpenGLFunctionThatDrawsOurTriangle();  
```

å½“ç„¶ï¼Œä½¿ç”¨ Godot ç¼–å†™ GLSL ä»£ç æ—¶ï¼Œå¹¶ä¸éœ€è¦è‡ªå·±å¤„ç†è¿™äº›é€»è¾‘ï¼Œå¼•æ“å·²ç»å¤„ç†å¥½äº†ã€‚å¹¶ä¸” Godot 4.x
å¼€å§‹ï¼Œå·²ç»æ”¯æŒ Vulkan APIï¼Œè€Œ Godot 3.x å¯¹ OpenGL çš„æ”¯æŒè¿˜ä¼šæŒç»­ã€‚

ä»¥ä¸‹æ˜¯ NVIDIA åœ¨ 2016 å¹´æ¸¸æˆå¼€å‘è€…å¤§ä¼š GDCï¼ˆGame Developers Conferenceï¼‰ä¸ŠæŠ¥å‘Šæ–‡æ¡£ä¸­æä¾›çš„
OpenGL å’Œ Vulkan çš„æ„æ¶å¯¹æ¯”ï¼š

![Vulkan: the essentials - NVIDIA](https://github.com/jimboyeah/spine-sfml-demo/raw/master/images/vulkan_component.png)

ä»æ¶æ„å›¾å¯¹æ¯”ä¸Šå¯ä»¥ç›´è§‚çœ‹åˆ°ï¼ŒåŸæœ¬ OpenGL é©±åŠ¨å±‚å¼€å‘çš„å†…å®¹è¢«ç§»åˆ° Vulkna åº”ç”¨å±‚å¼€å‘äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ
ä¸€æ–¹é¢å¼€å‘ Vulkan åº”ç”¨çš„éš¾åº¦å¢åŠ äº†ï¼Œå› ä¸ºéœ€è¦å¤„ç†åŸæœ¬ç¡¬ä»¶å‚å•†éœ€è¦åšçš„å·¥ä½œã€‚å¦ä¸€æ–¹é¢ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§äº†ï¼Œ
å› ä¸ºé©±åŠ¨å±‚çš„éƒ¨åˆ†åŠŸèƒ½å¯ä»¥ç”±åº”ç”¨å±‚è¿›è¡Œé…ç½®å¼€å‘ã€‚


## ğŸŸ¡ ShaderMaterial Programming ç€è‰²å™¨æè´¨ç¼–ç¨‹
- [Matlab Help - Mathematical Functions](https://ww2.mathworks.cn/help/symbolic/mathematical-functions.html)
- [The OpenGL Shading Language](https://www.khronos.org/opengl/wiki/OpenGL_Shading_Language)
- [The Book of Shaders by Patricio Gonzalez Vivo & Jen Lowe](https://thebookofshaders.com/?lan=ch)
- [Shaders Programming](https://docs.godotengine.org/en/3.5/tutorials/shaders/index.html)
- [Shading language](https://docs.godotengine.org/en/3.5/tutorials/shaders/shader_reference/shading_language.html)
- [Godot Shaders](https://docs.godotengine.org/en/3.5/tutorials/shaders/index.html)
- [Particle shaders](https://docs.godotengine.org/en/3.5/tutorials/shaders/shader_reference/particle_shader.html)
- [Converting GLSL to Godot shaders](https://docs.godotengine.org/en/3.5/tutorials/shaders/converting_glsl_to_godot_shaders.html)
- [Sprite Shaders](https://github.com/godotengine/godot-demo-projects/tree/master/2d/sprite_shaders)
- [Screen Space Shaders](https://github.com/godotengine/godot-demo-projects/tree/master/2d/screen_space_shaders)
- [2.5D Demo Project with GDScript](https://godotengine.github.io/godot-demo-projects/misc/2.5d/)
- [Voronoi and Worley (cellular) noise - Godot Shaders](https://godotshaders.com/snippet/voronoi/)
- [smoothstep desmos](http://www.desmos.com/calculator/309w4rkmpe)
- [åŒæ›²å‡½æ•°åŸºç¡€çŸ¥è¯† by Coston](https://zhuanlan.zhihu.com/p/363616604)
- [å¯èƒ½æ˜¯æœ€å¥½çš„è®²è§£åŒæ›²å‡½æ•°çš„æ–‡ç«  - ç‹å¸Œ](https://zhuanlan.zhihu.com/p/20042215)
- [Painting with Maths by Inigo Quilez](https://www.bilibili.com/video/BV1fU4y1273S/)
- [Raymarching distance fields - 2008 by Inigo Quilez](https://iquilezles.org/articles/raymarchingdf/)
- [Inigo Quilez - 2D distance functions](https://iquilezles.org/articles/distfunctions2d/)
- [Inigo Quilez - 3D distance functions](https://iquilezles.org/articles/distfunctions)
- [Ray Marching and Signed Distance Functions](https://jamie-wong.com/2016/07/15/ray-marching-signed-distance-functions/)
- [å‚…é‡Œå¶çº§æ•°ã€å‚…é‡Œå¶å˜æ¢ä¸é¢‘è°± by Eugene Khutoryansky](https://www.bilibili.com/video/BV1sS4y1G7WF)
- [ä»€ä¹ˆæ˜¯å‚…ç«‹å¶çº§æ•°å‘¢ï¼Ÿ-ä»çƒ­æµåˆ°ç”»åœˆåœˆ by 3Blue1Brown](https://www.bilibili.com/video/BV1vt411N7Ti)
- [But what is the Fourier Transform? A visual introduction by 3Blue1Brown](https://www.bilibili.com/video/BV1pW411J7s8)
- [An Interactive Guide To The Fourier Transform](https://betterexplained.com/articles/an-interactive-guide-to-the-fourier-transform/)
- [Pitch Shifting Using The Fourier Transform](http://blogs.zynaptiq.com/bernsee/pitch-shifting-using-the-ft/)
- [Fourier Transform: maps image into spatial frequency domain](https://homepages.inf.ed.ac.uk/rbf/HIPR2/fourier.htm)
- [Fourier transforms of images by Rachel Thomas](https://plus.maths.org/content/fourier-transforms-images)
- [How to Use Blender's New Ultimate Shader - Principled BSDF](https://www.bilibili.com/video/av27998058/)
- [Spatial Material](https://docs.godotengine.org/en/3.5/tutorials/3d/spatial_material.html)
- [Principled BSDF](https://docs.blender.org/manual/en/latest/render/shader_nodes/shader/principled.html)
- [Physically Based Rendering: From Theory to Implementation, Third Edition](http://www.pbr-book.org/3ed-2018/contents.html)
- [åŸºäºç‰©ç†çš„æ¸²æŸ“ï¼ˆPBRï¼‰ç™½çš®ä¹¦ - æ¯›æ˜Ÿäº‘](https://zhuanlan.zhihu.com/p/53086060)

è™½ç„¶ï¼Œè¿™å°èŠ‚å†…å®¹æ˜¯è®²æè´¨ä¸ç€è‰²å™¨ç¼–ç¨‹ï¼Œä½†æœ¬è´¨ä¸Šï¼Œæ˜¯åœ¨è®²æ•°å­¦çš„åº”ç”¨ã€‚ç¼–ç¨‹åªæ˜¯ä½¿ç”¨æ•°å­¦å·¥å…·çš„æ‰‹æ®µï¼Œä½œå“æ•ˆæœ
å°±æ˜¯æœ€ç»ˆäº§å“ã€‚è¿™ä¸­é—´è¦ç»å†çš„å†…å®¹å¾ˆå¤šï¼Œæ ¹æ®ä¸åŒæ•°å­¦åŸºç¡€çš„äººè‡ªç„¶æœ‰ä¸åŒçš„ç†è§£æˆ–ä¸ç†è§£ï¼Œæˆ–è€…éš¾ä»¥ç†è§£ã€‚åˆ°ç›®å‰
ä¸ºæ­¢ï¼Œå‚…é‡Œå¶çº§æ•°åŠå…¶åº”ç”¨æ˜¯ç»™æˆ‘æœ€å¤§è§¦åŠ¨çš„æ•°å­¦å·¥å…·ï¼Œ3Blue1Brown åˆ¶ä½œçš„ä¸€ä¸ªå›¾å½¢åŒ–å‚…é‡Œå¶çº§æ•°æ•™å­¦è§†é¢‘
ä»¥ä¸€ç§éš¾ä»¥æƒ³è±¡çš„ç›´è§‚æ‰‹æ®µï¼Œå°†æåº¦æŠ½è±¡çš„æ•°å­¦å·¥å…·ï¼Œç”¨å½¢è±¡çš„åŠ¨ç”»å½¢å¼å±•ç¤ºåœ¨è§‚ä¼—é¢å‰ã€‚è¿™çœŸçš„å¤ªæ£’äº†ï¼Œå°½ç®¡ï¼Œ
æ•°å­¦çš„æ„ä¹‰è¿œä¸æ­¢å¦‚æ­¤ï¼Œä½†é€šè¿‡åŠ¨ç”»å½¢è±¡åœ°è¯´æ˜äº†æ•°å­¦åœ¨éŸ³ä¹ã€å›¾åƒã€ç”µå­ã€é€šä¿¡ç­‰ç­‰é¢†åŸŸçš„å…±é€šæ€§ã€‚

Godot æè´¨æœ‰ä¸‰ç±»ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä½¿ç”¨èŠ‚ç‚¹ç¼–è¾‘ç•Œé¢æ–¹å¼ã€æˆ–è€…ä½¿ç”¨ç€è‰²å™¨æ–¹å¼è¿›è¡Œç¼–è¾‘ï¼Œä¸ 4 ä¸ªèµ„æºç±»å‹å…³è”ï¼š

- **spatial**     - for 3D rendering.
- **canvas_item** - for 2D rendering.
- **particles**   - for particle systems.

|   Resource Type    |              Note             |
|--------------------|-------------------------------|
| SpatialMaterial    | for 3D rendering.             |
| CanvasItemMaterial | for 2D rendering.             |
| ParticlesMaterial  | for particle systems.         |
| ShaderMaterial     | uses a custom Shader program. |

Spatial Material æè´¨åŸºäºç‰©ç†çš„æ¸²æŸ“ PBR - Physically Based Rendering æŠ€æœ¯ï¼Œè‡ªè¿ªå£«å°¼åœ¨ 
SIGGRAPH 2012 ä¸Šæå‡ºäº†è‘—åçš„è¿ªå£«å°¼åŸåˆ™çš„ BRDFï¼ˆDisney Principled BRDFï¼‰ä¹‹åï¼Œç”±äºå…¶é«˜åº¦çš„
æ˜“ç”¨æ€§ä»¥åŠæ–¹ä¾¿çš„å·¥ä½œæµï¼Œå·²ç»è¢«ç”µå½±å’Œæ¸¸æˆä¸šç•Œå¹¿æ³›ä½¿ç”¨ã€‚

ä¸å…¶ä»–è½¯ä»¶å…¼å®¹ï¼Œå¦‚çš®å…‹æ–¯çš„ RendermanÂ® å’Œè™šå¹»å¼•æ“Â®ã€‚SubstancePainterÂ® ç­‰è½¯ä»¶ç»˜åˆ¶æˆ–çƒ˜ç„™çš„å›¾åƒ
çº¹ç†å¯ä»¥ç›´æ¥é“¾æ¥åˆ°æ­¤ç€è‰²å™¨ä¸­çš„ç›¸åº”å‚æ•°ã€‚

Blender åŠ¨ç”»è½¯ä»¶ä¸­ä¹ŸåŸºäº PBR æä¾›åŸç†åŒ– BSDF ç€è‰²å™¨èŠ‚ç‚¹ Principled BSDFï¼Œæ˜¯é»˜è®¤åŸºæœ¬æè´¨ã€‚
å‚è€ƒ Blender Guru çš„æ•™ç¨‹ How to Use Blender's New Ultimate Shader - Principled BSDFã€‚

åŸºäº PBR å¯ä»¥åˆ›å»ºå„ç§å„æ ·çš„æè´¨ï¼ŒåŸºç¡€å±‚ä¸ºæ¼«åå°„ï¼Œé‡‘å±åº¦ï¼Œæ¬¡è¡¨é¢æ•£å°„å’Œé€å°„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰é•œé¢å±‚ï¼Œ
å…‰æ³½å±‚å’Œé€æ˜æ¶‚å±‚ã€‚Godot å®˜æ–¹ç¤ºèŒƒä¸­ Material Testers å±•ç¤ºäº†è¿™ç§ç€è‰²å™¨å„å‚æ•°é—´çš„ç›¸äº’å½±å“æ‰€å‘ˆç°çš„
çœŸå®å›¾å½¢æ•ˆæœã€‚æ³¨æ„ï¼ŒAlbedo å°±æ˜¯æè´¨çš„åŸºæœ¬è‰²ã€‚

PBR æ¨¡å‹å°†ç‰©ä½“æŒ‰è¡¨é¢å…‰çš„åå°„ã€æŠ˜å°„ä¸å¸æ”¶ç­‰ç‰©ç†ç‰¹æ€§åˆ†æˆç”µä»‹è´¨ Dielectricsã€é‡‘å±ç‰©è´¨ Metalsï¼Œå¯¹
å…‰å­¦ç‰¹æ€§å½±å“ä¸Šè€ƒè™‘äº† Fresnel è²æ¶…å°”æ•ˆåº”ã€ ç²—ç³™åº¦ã€ é‡‘å±æ€§ã€‚

![Disney Principled BSDF](https://docs.blender.org/manual/en/latest/_images/render_shader-nodes_shader_principled_example-1a.jpg)

Fresnel æ•ˆåº”è§£æå…‰æ³¢é€šè¿‡ä¸åŒä»‹è´¨çš„åˆ†ç•Œé¢æ—¶å‘ç”Ÿåå°„å’ŒæŠ˜å°„ï¼Œå…¥å°„å…‰åˆ†ä¸ºåå°„å…‰ Reflection å’ŒæŠ˜å°„å…‰
Refraction ä¸¤éƒ¨åˆ†ã€‚æµ…å…¥å°„è§’è·å¾—çš„åå°„å…‰æ›´å¤šï¼Œæ¯”å¦‚çœ‹æ¹–é¢åå°„çš„æ™¯ç‰©å€’å½±ï¼Œè¿œå¤„æ¯”è¿‘å¤„çš„å€’å½±æ¸…æ™°æ˜äº®ï¼Œ
è¿˜æœ‰çœ‹ä¸€é¢—é‡‘å±çƒï¼Œçƒä½“çš„åœ†å‘¨æ›´æ˜äº®ã€‚ç‰©ä½“çš„ç²—ç³™åº¦å¯¹å…‰åå°„æœ‰å¾ˆå¤§çš„å½±å“ï¼Œä½†æ˜¯ Fresnel æ•ˆåº”ä¸€ç›´å­˜åœ¨ï¼Œ
å³ä½¿æ˜¯æ²¡æœ‰é•œé¢åå°„çš„æœ¨çƒä¹Ÿä¼šè¡¨ç°å‡ºå‘¨è¾¹æ›´äº®ã€‚

ç”µä»‹è´¨å¯¹å…‰çš„åå°„ã€æŠ˜å°„å’Œé‡‘å±åªå¯¹å…‰çº¿åå°„çš„ç‰¹æ€§æ˜¯æ˜æ˜¾çš„å·®åˆ«ï¼Œä¸€èˆ¬ Metallic é‡‘å±åº¦è®¾ç½®ä¸º 0 æˆ– 1 
å¯¹åº”ç”µä»‹è´¨å’Œé‡‘å±ä¸¤ç±»ææ–™ï¼Œä¸ä½¿ç”¨ä¸­é—´å€¼ï¼ŒåŸºæœ¬æ²¡æœ‰éé‡‘å±å’Œé‡‘å±ææ–™æ¨¡å‹ä¹‹é—´çš„æ··åˆææ–™ã€‚æ•°å€¼ä¸º 1.0 æ—¶ï¼Œ
è¡¨ç¤ºä½¿ç”¨åŸºç¡€è‰²ç€è‰²çš„å®Œå…¨é•œé¢åå°„ Specularï¼Œä¸”ä¸å«æœ‰æ¼«åå°„ Diffusion æˆ–é€å°„ Transmissionï¼Œ
é€å°„æ˜¯å…¥å°„å…‰ç»è¿‡æŠ˜å°„ç©¿è¿‡ç‰©ä½“ã€‚è€Œå¯¹äºé‡‘å±è¡¨å±‚çš„å¼‚ç‰©ï¼Œå¦‚é”ˆæ–‘ Rust çš„å¤„ç†ï¼Œå°±ç­‰ä»·ä¸ºç”µä»‹è´¨çš„è¦†ç›–ã€‚ 

è¡å°„ï¼ˆDiffractionï¼‰ï¼Œåˆç§°ç»•å°„ï¼Œæ˜¯æŒ‡æ³¢é‡åˆ°éšœç¢ç‰©æ—¶åç¦»åŸæ¥ç›´çº¿ä¼ æ’­çš„ç‰©ç†ç°è±¡ã€‚

æ¬¡è¡¨é¢æ•£å°„ Subsurface Scattering ç›¸å…³å±æ€§ä¸å…‰è·¯çš„æŠ˜å°„æœ‰å…³ï¼Œå¯¹äºé‡‘å±ææ–™æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼ŒåŒæ ·é€å°„
Transmission ç›¸å…³å±æ€§ä¹Ÿå¯¹é‡‘å±æ— æ•ˆã€‚å¯¹äºä¸é€æ˜çš„ææ–™ Transmission = 0ï¼Œé‚£ä¹ˆ IOR - Index of Refraction 
æŠ˜å°„ç‡å°±æ˜¯æ— æ•ˆå±æ€§ã€‚

å…‰æ³½ Sheen å±æ€§é€‚åˆ Fabric ç»‡ç‰©ç±»æ— é•œé¢åå°„çš„æè´¨ã€‚

æ¸…æ¼† Clearcoat é€‚åˆç‰©ä½“è¡¨å±‚çš„å…‰æ³½ï¼Œå¦‚ç”¨äºæ±½è½¦æ²¹æ¼†ç­‰æè´¨çš„æ¨¡æ‹Ÿã€‚

å„å‘å¼‚æ€§ Anisotropic é€šå¸¸æ­é… Tangent åˆ‡å‘ç”¨äºä¸çº¿ã€æ¡çº¹çš„æ¢³ç†ï¼Œå¦‚å¸ƒæ–™çš„çº¿æ¡å…‰å½±ã€ç…é”…åº•éƒ¨çš„åœ†åœˆæ¡çº¹ã€‚

é€šè¿‡æ³•å‘çš„æ§åˆ¶æ¥æ§åˆ¶ä¸åŒè§‚å¯Ÿè§’åº¦çš„å…‰å½±æ•ˆæœæ˜¯å¾ˆåŸºç¡€ä¸”é‡è¦çš„æŠ€æœ¯ï¼ŒNormal æ³•å‘æ§åˆ¶åŸºç¡€å›¾å±‚çš„æ³•çº¿æ–¹å‘ï¼Œ
Tangent åˆ‡å‘æ§åˆ¶å„å‘å¼‚æ€§å›¾å±‚çš„æ³•çº¿æ–¹å‘ã€‚

æ€»ç»“ä¸€ä¸‹é‡‘å±æè´¨çš„ 5 å¤§è¦ç´ ï¼š

- Base Color åŸºç¡€è‰²
- Metallic é‡‘å±åº¦
- Roughness ç³™åº¦
- Clearcoat æ¸…æ¼†
- Normal æ³•å‘

ç»ç’ƒæè´¨çš„ 4 å¤§è¦ç´ ï¼š

- Base Color åŸºç¡€è‰²
- Transmission é€å°„
- IOR æŠ˜å°„ç‡
- Specular é«˜å…‰
- Roughness ç³™åº¦
- Clearcoat æ¸…æ¼†

å…‰æ»‘ç™½é™¶ç“·æè´¨ï¼Œè®¾å®šå›ºæœ‰è‰²ä¸ºç™½ï¼Œç„¶åé™ä½ç²—ç³™åº¦å‚æ•°ï¼Œé…åˆæ¬¡è¡¨é¢ SSS å¢åŠ æè´¨çš„åŠé€æ˜ï¼Œå°±åƒçš®è‚¤ã€‚


ç€è‰²å™¨ç¨‹åºä½¿ç”¨ **ShaderMaterial** èµ„æºå¯¹è±¡åŒ…è£…ï¼Œè¦ç”¨ç€è‰²å™¨ç¼–ç¨‹å®ç°å„ç§æè´¨ï¼Œå°±éœ€è¦åˆ›å»ºç€è‰²å™¨æè´¨ã€‚
ç„¶åï¼Œç»™é¢œè‰²å™¨æè´¨çš„ Shader å±æ€§è®¾ç½®ä¸€ä¸ªç€è‰²å™¨ç¨‹åºå³å¯ã€‚åœ¨ç¼–è¾‘ç€è‰²å™¨ä»£ç æ—¶ï¼ŒGodot ä¼šè‡ªåŠ¨ç¼–è¯‘ç€è‰²å™¨ï¼Œ
å°±åƒ Shadertoy ä¸€æ ·ï¼Œç¼–è¾‘ä»£ç çš„è¿‡ç¨‹å°±å¯ä»¥çœ‹åˆ°è¾“å‡ºæ•ˆæœã€‚ä¸è¿‡ï¼Œæ³¨æ„ä¸€ç‚¹ï¼Œç€è‰²å™¨çš„ Uniform å˜é‡æ˜¯å¯ä»¥
åœ¨å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸­ä¿®æ”¹çš„ï¼Œå¹¶ä¸”ä¿®æ”¹åçš„å€¼ä¼šä¿ç•™ï¼Œä¸‹æ¬¡è¿è¡Œæ—¶è‡ªåŠ¨ä¼ å…¥ç€è‰²å™¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¿®æ”¹ç€è‰²å™¨ä¸­çš„å€¼
ä¼šè¢«è¦†ç›–ï¼Œå¯ä»¥å°†æè´¨å¯¹è±¡æ¸…ç†å¹²å‡€å†é‡æ–°è®¾ç½®ç€è‰²å™¨å³å¯ä»¥è§£é™¤ä¿ç•™çš„æ•°æ®ã€‚

æ­£å¦‚ä¸Šå°èŠ‚æ‰€è¯´ï¼ŒOpenGL å’Œ GLSL çš„ç‰ˆæœ¬å‘è¡Œå¹¶ä¸ä¸€è‡´ï¼Œç›´åˆ° OpenGL 2.0 å¼€å§‹ï¼Œæ‰å¯¹åº”å‘è¡Œä¸€ä¸ªç‰ˆæœ¬å·ã€‚
ä½†ç‰ˆæœ¬å·ç›´åˆ° OpenGL 3.3 å¼€å§‹æ‰ä¸€è‡´ï¼Œæ‰€ä»¥ Godot ä½¿ç”¨çš„ GLSL 2/3 å¯¹åº” OpenGL 1.2 å’Œ 3.3ã€‚
è€Œå­¦ä¹  Godot ç€è‰²å™¨ç¼–ç¨‹æœ€åŸºæœ¬çš„ä¸‰ä¸ªå‚è€ƒææ–™å°±æ˜¯å®˜æ–¹çš„è§„èŒƒæ‰‹å†Œï¼Œè¿˜æœ‰å¿«é€Ÿå‚è€ƒå¡ï¼š

- The OpenGLÂ® Graphics System: A Specification (Version 3.3 (Core Profile) - March 11, 2010)
- The OpenGLÂ® Graphics System: A Specification (Version 3.3 (Compatibility Profile) - March 11, 2010)
- The OpenGLÂ® Shading Language Language Version: 3.30 Document Revision: 6 11-Mar-2010
- OpenGL 3.2 API Quick Reference Card

å‰é¢ä¸¤ä¸ªç€é‡äº OpenGL è§„èŒƒæœ¬èº«ï¼Œå¦‚æœä¸æ˜¯åšå¼•æ“å¼€å‘ï¼Œå¯ä»¥ä¸çœ‹ï¼Œè€Œä¸”æœ‰æ›´æ–°çš„ Vulkan è§„èŒƒå¯ç”¨ã€‚
è€Œ GLSL ç€è‰²å™¨è¯­è¨€è§„èŒƒå‚è€ƒæ‰‹å†Œåˆ™æ˜¯å¿…éœ€çš„ï¼Œé‡Œé¢æœ‰å¤§é‡å‡½æ•°ã€å˜é‡å®šä¹‰ç­‰ä¿¡æ¯ã€‚

    git clone --depth=1 git@github.com:KhronosGroup/OpenGL-Registry

Godot æ˜¯åŸºäº OpenGL å¼€å‘çš„æ¸¸æˆå¼•æ“ï¼ŒGodot 4.x å·²ç»æ”¯æŒ Vulkanï¼Œæ‰€ä»¥å…¶ç€è‰²å™¨ç¨‹åºçš„ç¼–å†™éœ€è¦ç¬¦åˆ
åŸºæœ¬ GLSL ç€è‰²å™¨è¯­è¨€è§„èŒƒï¼Œè€Œåœ¨ç€è‰²å™¨ç¨‹åºä»£ç ç»„ç»‡ä¸Šæœ‰äº›è®¸å·®åˆ«ã€‚GLSL æºä»£ç ä¸­ï¼Œé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨
ä»£ç éƒ½æœ‰ **main()** å‡½æ•°ä½œä¸ºå…¥å£ï¼ŒGodot åˆ™å°†ç€è‰²å™¨ç¨‹åº Vertex & Fragment äºŒè€…åˆäºŒä¸ºä¸€ï¼Œåœ¨åŒ
ä¸€ä¸ªä»£ç æ–‡ä»¶å®šä¹‰ **vertex()** å’Œ **fragment()** ä¸¤ä¸ªå‡½æ•°å¯¹åº”ï¼Œå¤–åŠ ä¸€ä¸ªå…‰ç…§å‡½æ•° **light()**ã€‚
è¿™äº›å¤„ç†å™¨å‡½æ•°ï¼ŒProcessor functionsï¼Œçš„ä½¿ç”¨å–å†³äºç€è‰²å™¨çš„ç±»å‹ï¼Œå¯¹äº spatial å’Œ canvas_item
æ¥è¯´ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä½¿ç”¨ï¼Œè€Œå¯¹äºç²’å­ç€è‰²å™¨æ¥è¯´ï¼Œåªèƒ½ä½¿ç”¨ **vertex()**ã€‚

Godot ç€è‰²å™¨ç¼–ç¨‹ä¸æ ‡å‡† GLSL ç¼–ç¨‹è¿˜æœ‰ä¸€ä¸ªå·®åˆ«ï¼Œå°±æ˜¯ä¸åŒçš„ç€è‰²å™¨éœ€è¦è®¾ç½®æ¸²æŸ“æ¨¡å¼ï¼Œå¼•æ“éœ€è¦è¿™äº›è®¾ç½®ï¼Œ
æ¸²æŸ“æ¨¡å¼å†³å®šäº†å¦‚ä½•é…ç½® OpenGLï¼Œä¹Ÿå†³å®šäº†æ¸²æŸ“è¾“å‡ºæ•ˆæœã€‚ä½¿ç”¨å›¾å½¢ç•Œé¢æ—¶ï¼Œé€šè¿‡æè´¨å±æ€§æ§åˆ¶å™¨é¢æ¿å°±å¯ä»¥
ä¿®æ”¹éœ€è¦çš„å„ç§æ¸²æŸ“æ¨¡å¼ã€‚è€Œä½¿ç”¨è‰²å™¨ç¨‹åºæ—¶ï¼Œé»˜è®¤æ¸²æŸ“æ¨¡å¼ä¸º **blend_mix**ï¼Œå¯ç”¨ Alpha é€æ˜ï¼š

```c
shader_type spatial;
render_mode skip_vertex_transform;
// render_mode blend_mix  Mix blend mode (alpha is transparency), default.
// render_mode depth_draw_alpha_prepass, cull_disabled, world_vertex_coords;

void vertex() {
    VERTEX = (MODELVIEW_MATRIX * vec4(VERTEX, 1.0)).xyz;
    NORMAL = normalize((MODELVIEW_MATRIX * vec4(NORMAL, 0.0)).xyz);
    // same as above for binormal and tangent, if normal mapping is used
}
```

å…¶ä¸­ï¼Œå› ä¸º Sptial æ¶‰åŠå…‰ç…§å¤„ç†ï¼Œå¯é…ç½®çš„æ¸²æŸ“æ¨¡å¼æœ€å¤šï¼Œä¸æ¶‰åŠå…‰ç…§çš„ canvas_item å…¶æ¬¡ï¼Œparticle
ç²’å­ç€è‰²å™¨æ¸²æŸ“æ¨¡å¼æœ€å°‘ã€‚å› ä¸ºï¼Œç²’å­ç€è‰²å™¨æœ¬èº«ä¸ç»˜å›¾ï¼Œæ˜¯ vertext shader çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œåœ¨å¯¹è±¡ç»˜åˆ¶
å‰è¿è¡Œä»¥è®¡ç®—æè´¨å±æ€§ï¼Œå¦‚ color, position, rotation ç­‰ç­‰ã€‚ç„¶åï¼Œå†ä¼ é€’ç»™ CanvasItem æˆ– Spatial
ç­‰ç€è‰²å™¨ä½¿ç”¨ã€‚ç²’å­ç€è‰²å™¨ä¹‹æ‰€ä»¥å¯ä»¥è·å¾—å±æ€§æ•°æ®è¾“å‡ºï¼Œæ˜¯å› ä¸ºä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šçš„ç€è‰²å™¨ï¼šè½¬æ¢åé¦ˆç€è‰²å™¨ï¼Œ
transform feedback shaderï¼Œæ ¹æ® OpenGL 4.6 è§„èŒƒæ‰‹å†Œçš„å°é¢ï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§ç€è‰²å™¨ç»é¡¶ç‚¹ç€è‰²é˜¶æ®µï¼Œ
åˆ°å‡ ä½•ç€è‰²é˜¶æ®µï¼Œå†åé¦ˆå›æ•°æ®ã€‚åœ¨ç‰‡æ®µç€è‰²å™¨è¿è¡Œä¹‹å‰å°±å¾—åˆ°äº†æ•°æ®ï¼Œåç»­çš„ç‰‡æ®µç€è‰²å™¨å°±å¯ä»¥åˆ©ç”¨è¿™äº›æ•°æ®ã€‚

è½¬æ¢åé¦ˆç€è‰²å™¨æ˜¯ Shader Model 4.0 å¸¦æ¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä¸å…¶ä»–ç‰¹æ€§ä¸åŒï¼Œå®ƒæ”¹å˜äº† OpenGL æ¸²æŸ“ç®¡çº¿ã€‚
Transform Feedback åœ¨ DirectX ä¸­è¢«ç§°ä¸º Stream-Output Stageã€‚Godot å¼•æ“å†…éƒ¨å®ç°ä¸­ï¼Œæ‰§è¡Œ
ç€è‰²å™¨ç¼–è¯‘åï¼Œåˆ›å»ºä¸€ä¸ªç€è‰²ç¨‹åºå¹¶é™„åŠ ç€è‰²å™¨ä¹‹å‰ï¼Œå³åœ¨è°ƒç”¨ glLinkProgram() é“¾æ¥ç¨‹åºä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ 
glTransformFeedbackVaryings() å‘Šè¯‰ OpenGL è¦æ•è·åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­çš„è¾“å‡ºå±æ€§ã€‚

å¦å¤–ï¼Œæ¯ç§ç€è‰²å™¨è¿˜é…ç½®äº†ä¸åŒçš„é¢„å®šä¹‰å˜é‡ï¼Œå…·ä½“å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š

- shader_reference/shading_language.rst
- shader_reference/spatial_shader.rst
- shader_reference/canvas_item_shader.rst
- shader_reference/particle_shader.rst
- shaders/compute_shaders.rst
- shaders/converting_glsl_to_godot_shaders.rst
- shaders/using_viewport_as_texture.rst

Godot æä¾›äº† VisualShader å¯è§†èŠ‚ç‚¹ç¼–ç¨‹ï¼Œé€šè¿‡ Expression node èŠ‚ç‚¹ä¹Ÿå¯ä»¥ç¼–å†™ç€è‰²å™¨ä»£ç ã€‚
ä¸åƒ VisualScriptï¼Œå®ƒå·²ç»è¢« Godot 4.x ä¸¢å¼ƒï¼Œè€Œç€è‰²å™¨çš„å¯è§†åŒ–ç¼–ç¨‹è¿˜åœ¨ä½¿ç”¨ä¸­ã€‚

CanvasItem shaders render modes

+---------------------------+----------------------------------------------------------------------+
| Render mode               | Description                                                          |
+===========================+======================================================================+
| **blend_mix**             | Mix blend mode (alpha is transparency), default.                     |
| **blend_add**             | Additive blend mode.                                                 |
| **blend_sub**             | Subtractive blend mode.                                              |
| **blend_mul**             | Multiplicative blend mode.                                           |
| **unshaded**              | Result is just albedo. No lighting/shading happens in material.      |
| **skip_vertex_transform** | VERTEX/NORMAL/etc need to be transformed manually in vertex function.|
| **blend_premul_alpha**    | Pre-multiplied alpha blend mode.                                     |
| **blend_disabled**        | Disable blending, values (including alpha) are written as-is.        |
| **light_only**            | Only draw on light pass.                                             |
+---------------------------+----------------------------------------------------------------------+

å‰é¢ 6 ç§æ¨¡å¼å’Œ Spatial ç€è‰²å™¨é€šç”¨ï¼Œåé¢ 3 ç§åªå¯¹ CanvasItem ç€è‰²å™¨æœ‰æ•ˆæœã€‚


Particle shaders render modes

+-----------------------+----------------------------------------+
| Render mode           | Description                            |
+=======================+========================================+
| **keep_data**         | Do not clear previous data on restart. |
| **disable_force**     | Disable attractor force.               |
| **disable_velocity**  | Ignore **VELOCITY** value.             |
+-----------------------+----------------------------------------+


### ğŸŸ ğŸ”µ OSL ç€è‰²å™¨ç¼–ç¨‹
- [Open Shading Language](https://docs.blender.org/manual/en/latest/render/shader_nodes/osl.html)
- https://github.com/AcademySoftwareFoundation/OpenShadingLanguage/blob/master/src/doc/osl-languagespec.pdf
- [Real-Time Rendering 3rd éçœŸå®æ„Ÿæ¸²æŸ“(NPR)ç›¸å…³æŠ€æœ¯æç‚¼æ€»ç»“](https://zhuanlan.zhihu.com/p/31194204)

å¼€æ”¾å¼ç€è‰²è¯­è¨€ OSL æ˜¯ä¸€ç§å°å‹ä½†ä¸°å¯Œçš„ç€è‰²å™¨è¯­è¨€ï¼Œç”¨äºé«˜çº§æ¸²æŸ“å™¨å’Œå…¶ä»–åº”ç”¨ç¨‹åºä¸­çš„å¯ç¼–ç¨‹ç€è‰²ï¼Œéå¸¸
é€‚åˆæè¿°æè´¨ã€ç¯å…‰ã€ç½®æ¢å’Œå›¾æ¡ˆç”Ÿæˆã€‚æœ€åˆç”± Sony Pictures Imageworks å¼€å‘ï¼Œç”¨äºå…¶å†…éƒ¨æ¸²æŸ“å™¨ï¼Œ
ç”¨äºæ•…äº‹ç‰‡åŠ¨ç”»å’Œè§†è§‰æ•ˆæœï¼Œä½œä¸ºå¼€æºå‘å¸ƒï¼Œä»¥ä¾¿å…¶ä»–è§†è§‰æ•ˆæœã€åŠ¨ç”»å·¥ä½œå®¤å’Œæ¸²æŸ“è½¯ä»¶ä¾›åº”å•†ä½¿ç”¨ã€‚ç°åœ¨ï¼Œå®ƒæ˜¯
VFX å’ŒåŠ¨ç”»åŠŸèƒ½çš„äº‹å®ä¸Šçš„æ ‡å‡†ç€è‰²è¯­è¨€ï¼Œåœ¨è®¸å¤šå•†ä¸šå’Œå·¥ä½œå®¤ä¸“æœ‰æ¸²æŸ“å™¨ä¸­å¹¿æ³›ä½¿ç”¨ã€‚

Blender ä¸­æ”¯æŒåœ¨ Cycles æ¸²æŸ“å¼•æ“ä¸­è¿›è¡Œ OGL ç€è‰²å™¨ç¼–ç¨‹ï¼Œä½†åªèƒ½åœ¨ CPU æ¨¡å¼ä¸‹è¿è¡Œç€è‰²å™¨ã€‚åœ¨å±æ€§é¢æ¿
é€‰æ‹© Cycles æ¸²æŸ“å™¨ï¼Œä»¥åŠ CPU æ¨¡å¼ï¼Œå‹¾é€‰ Open Shading Language é€‰é¡¹ã€‚

åœ¨ç€è‰²å™¨ç¼–è¾‘å™¨ä¸­ï¼Œæ·»åŠ  Script èŠ‚ç‚¹ï¼Œå¹¶ä¸ºè„šæœ¬èŠ‚ç‚¹æŒ‡å®šç€è‰²å™¨æ–‡æœ¬ã€‚å³ä¾§æœ‰æŒ‰é”®å¯ä»¥é‡æ–°ç¼–è¯‘ç€è‰²å™¨ç¨‹åºï¼Œ
ç¼–è¯‘æˆåŠŸåä¼šæ˜¾ç¤ºå…¶è¾“å…¥å’Œè¾“å‡ºå‚æ•°ç›¸åº”ç«¯å£ã€‚è‹¥ç€è‰²å™¨ä¸ºæè´¨ï¼Œåˆ™ç›´æ¥ä¸æè´¨è¾“å‡ºèŠ‚ç‚¹çš„ Surface è¾“å…¥è¿æ¥ï¼Œ
å³ Surface è¾“å…¥ä½“ç§¯æˆ–çº¹ç†ã€‚

æ‰§è¡Œèœå• Window -> Toggle System Console æ‰“å¼€ç³»ç»Ÿæ§åˆ¶å°å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ç€è‰²å™¨äº§ç”Ÿçš„é”™è¯¯ä¿¡æ¯ã€‚åœ¨
è„šæœ¬ç¼–è¾‘å™¨ä¸­ï¼Œé€‰æ‹© Templates - Open Shading Language å¯ä»¥æ‰“å¼€ç¤ºèŒƒä»£ç ã€‚

OSL æ˜¯ä¸ªæ²¡æœ‰å…‰ç…§èƒ½åŠ›çš„ä¸å®Œå…¨ç€è‰²å™¨ï¼Œå…‰ç…§ä¾é æ¸²æŸ“å¼•æ“å®Œæˆï¼ŒOSL åªæä¾›å…‰ç…§éœ€è¦çš„ PBR ç­‰ä¿¡æ¯ã€‚è€Œä¸”ï¼Œ
OSL ç›®å‰æ˜¯ä¸ªè½¯ä»¶ç€è‰²å™¨ï¼Œåªèƒ½åœ¨ CPU ä¸Šè¿è¡Œï¼Œæ‰€ä»¥æ¢åˆ° GPU æ¨¡å¼å°±æ²¡ç”¨äº†ï¼Œæ˜¯ä¸ªå¾ˆé¸¡è‚‹çš„åŠŸèƒ½ã€‚OSL å¯¹äº
3dmax æ¥è¯´ï¼Œæ„ä¹‰è¿˜å¾ˆå¤§ï¼Œå› ä¸º 3dmax ä¼ ç»Ÿ shader çš„å°é—­æ€§å¾ˆéš¾å¼€å‘ï¼ŒOSL å®Œç¾çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ 

ä»¥ä¸‹ä»£ç åˆ›å»ºç®€å•çš„å¡é€šç€è‰²æ•ˆæœï¼Œä¼šåˆ›å»ºä¸‰ä¸ªé¢œè‰²è¾“å…¥ï¼Œå’Œä¸€ä¸ªå…‰çº¿å…¥å°„æ–¹å‘ï¼š

```c
#include "stdosl.h"

// OLS Toon Shading
shader BaseToon(
    color Albedo = color(1, 1, 1),
    color LightColor = color(1, 1, 1),
    color ShadowColor = color(0, 0, 0),
    vector LightDirection = vector(0, 0, 0),
    output color Final = 0
)
{
    // get light direction use toon kit object info node 
    // or use vector node dirver.
    vector L = LightDirection;
    
    // lambert NdotL
    float NdotL = dot(N, L);
    
    // use round
    float Cel = round(NdotL);
    
    // mix shadow and light color
    color celShading = mix(ShadowColor, LightColor, Cel);
    
    Final = Albedo * celShading;
}
```



### ğŸŸ ğŸ”µ from GLSL to Godot

ç”±äº Shadertoy è¿™ä¸ªåŸºäº Web å¼€å‘çš„ç€è‰²å™¨ç¨‹åºç¼–å†™ã€åˆ†äº«å¹³å°å®åœ¨æ˜¯å¥½ç”¨ï¼Œè¿˜æœ‰ The Book of Shaders
ç«™ç‚¹ï¼Œæ‰€ä»¥åœ¨ Godot å®ç°ç€è‰²å™¨å¯ä»¥è€ƒè™‘å®ƒä»¬çš„ä¸€äº›ä¹ æƒ¯çš„å˜é‡ç”¨æ³•ã€‚åªéœ€è¦å¾ˆå°çš„ä»£ç å˜åŒ–ï¼Œå°±å¯ä»¥ä» GLSL 
ç¼–ç¨‹è½¬æ¢åˆ° Godot shaders ç¼–ç¨‹ã€‚

GLSL å†…å»ºçš„å¸¸ç”¨å˜é‡ä¸ç­‰ä»· Godot å˜é‡å¯¹ç…§è¡¨å¦‚ä¸‹ï¼ŒVariable ä¸­ä¸ºåŸå˜é‡åï¼ŒEquivalent ä¸º Godot
ä¸­çš„ç­‰ä»·å®šä¹‰ã€‚å®ƒä»¬éƒ½ä¸æ˜¯ç”¨æ¥å‘ GLSL ä¼ é€’æ•°æ®çš„ Uniform å˜é‡ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨ä¸»ç¨‹åºä¸­ç¼–è¾‘ï¼š

+----------------+---------+---------------+-----------------------------------------------------+
|Variable        |Type     |Equivalent     |Description                                          |
+================+=========+===============+=====================================================+
|gl_FragColor    |out vec4 |COLOR          |Output color for each pixel.                         |
|gl_FragCoord    |vec4     |FRAGCOORD      |For full screen quads. For smaller quads, use UV.    |
|gl_Position     |vec4     |VERTEX         |Position of Vertex, output from Vertex Shader.       |
|gl_PointSize    |float    |POINT_SIZE     |Size of Point primitive.                             |
|gl_PointCoord   |vec2     |POINT_COORD    |Position on point when drawing Point primitives.     |
|gl_FrontFacing  |bool     |FRONT_FACING   |True if front face of primitive.                     |
+----------------+---------+---------------+-----------------------------------------------------+

æ³¨æ„ï¼Œ`Uniform` æ˜¯ä» CPU å‘ GPU ä¸­çš„ç€è‰²å™¨å‘é€æ•°æ®çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå®šä¹‰çš„å˜é‡æ˜¯å…¨å±€çš„ Globalï¼Œ
æ„å‘³ç€ uniform å˜é‡å¿…é¡»åœ¨æ¯ä¸ªç€è‰²å™¨ç¨‹åºå¯¹è±¡ä¸­éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè€Œä¸”å®ƒå¯ä»¥è¢«ç€è‰²å™¨ç¨‹åºçš„ä»»æ„ç€è‰²å™¨
åœ¨ä»»æ„é˜¶æ®µè®¿é—®ã€‚å…¶æ¬¡ï¼Œæ— è®º uniform è®¾ç½®æˆä»€ä¹ˆå€¼ï¼Œéƒ½ä¼šä¸€ç›´ä¿å­˜ç€å®ƒä»¬çš„æ•°æ®ï¼Œç›´åˆ°å®ƒä»¬è¢«é‡ç½®æˆ–æ›´æ–°ã€‚
è¦å‘ç€è‰²å™¨ä¼ é€’æ•°æ®ï¼Œå°±éœ€è¦ä½¿ç”¨ Uniform å˜é‡ï¼Œå¹¶é€šè¿‡ **set_shader_param()** è®¾ç½®æ•°æ®ï¼ŒGodot
å¼•æ“å†…éƒ¨ä¼šè°ƒç”¨ OpenGL APIï¼Œä¾‹å¦‚ç”¨ `glGetUniformLocation` æŸ¥è¯¢ï¼Œè°ƒç”¨ `glUniform4f` è®¾ç½®ã€‚
å‚è€ƒ Godot 3.x æºä»£ç çš„ ShaderGLES2 æˆ– ShaderGLES3 çš„å®ç°ã€‚

Godot ç€è‰²å™¨ä¸­è¿˜æœ‰äº›ç‰¹æ®Šçš„å˜é‡ï¼Œç”¨äºè®¿é—®å±å¹•å›¾åƒçš„ **SCREEN_TEXTURE**ï¼Œä»¥åŠå­˜å‚¨ 3D åœºæ™¯æ·±åº¦
ä¿¡æ¯çš„ **DEPTH_TEXTURE**ï¼Œä½¿ç”¨å½“å‰ç‰‡æ®µç€è‰²å™¨ä¸­çš„ **SCREEN_UV** åæ ‡è·å–å¯¹åº”çš„åƒç´ é¢œè‰²å€¼ï¼Œè¿™
æ˜¯ä¸€ä¸ª RGB é¢œè‰²å€¼ã€‚æ›´å¤šçš„è‡ªå®šä¹‰ç¬¦å·ï¼Œå¯ä»¥å‚è€ƒæºä»£ç  GLES3 é©±åŠ¨æ¨¡å—çš„ **ShaderCompilerGLES3**
ç±»å‹ä¸­å®šä¹‰çš„æ˜ å°„å…³ç³»ã€‚

```c
shader_type canvas_item;

// GLSL: you can assign a default value to uniforms
uniform float blue = 1.0; 

void fragment() {
    COLOR = textureLod(SCREEN_TEXTURE, SCREEN_UV, 0.0);
    COLOR.b = blue;
}

// GDScript:
// var blue_value = 1.0
// material.set_shader_param("blue", blue_value)
```

Godot ç€è‰²å™¨ç¼–ç¨‹ä¹Ÿæä¾›äº† GDScript ä¸­ä½¿ç”¨å±æ€§æç¤ºè¾…åŠ©åŠŸèƒ½ï¼Œåœ¨ç€è‰²å™¨å®šä¹‰å˜é‡æ—¶ï¼Œå¯ä»¥è®¾ç½®å±æ€§æç¤ºï¼Œ
ä»¥æ–¹ä¾¿ä½¿ç”¨è€…æˆ–å¼€å‘è€…åœ¨é¢æ¿ä¸­éšæ—¶äº†è§£å±æ€§çš„å–å€¼ã€‚ä¾‹å¦‚ï¼Œhint_range æç¤ºå–å€¼èŒƒå›´ï¼Œhint_albedo æç¤º
çº¹ç†è¾“å…¥ï¼š

```c
shader_type spatial;

uniform vec4 color : source_color;
uniform float amount : hint_range(0, 1);
uniform vec4 other_color : source_color = vec4(1.0);
```

+----------------------+------------------------------------------------+-----------------------------------------------------------------------------+
| Type                 | Hint                                           | Description                                                                 |
+======================+================================================+=============================================================================+
| **vec3, vec4**       | source_color                                   | Used as color.                                                              |
| **int, float**       | hint_range(min, max[, step])                   | Restricted to values in a range (with min/max/step).                        |
| **sampler2D**        | source_color                                   | Used as albedo color.                                                       |
| **sampler2D**        | hint_normal                                    | Used as normalmap.                                                          |
| **sampler2D**        | hint_default_white                             | As value or albedo color, default to opaque white.                          |
| **sampler2D**        | hint_default_black                             | As value or albedo color, default to opaque black.                          |
| **sampler2D**        | hint_default_transparent                       | As value or albedo color, default to transparent black.                     |
| **sampler2D**        | hint_anisotropy                                | As flowmap, default to right.                                               |
| **sampler2D**        |`hint_roughness[_r, _g, _b, _a, _normal, _gray]`| Used for roughness limiter on import (attempts reducing specular aliasing). |
| **sampler2D**        |`filter[_nearest, _linear][_mipmap][_aniso]`    | Enabled specified texture filtering.                                        |
| **sampler2D**        |`repeat[_enable, _disable]`                     | Enabled texture repeating.                                                  |
+----------------------+------------------------------------------------+-----------------------------------------------------------------------------+


Godot 4.x å¼€å§‹ä½¿ç”¨ Vulkanï¼Œç€è‰²å™¨åŠ è½½æµç¨‹å®Œå…¨ä¸åŒï¼ŒVkShaderModule æ˜¯ç€è‰²å™¨çš„ç»„ç»‡æ¨¡å—å¯¹è±¡ï¼Œ
åŠ è½½æµç¨‹è¿˜ä¼šä½¿ç”¨åˆ° VkPipelineShaderStageCreateInfo ä¸€ç±»å¯¹è±¡ã€‚å¹¶ä¸”ï¼ŒVulkan å¼•å…¥äº†ä¸€ç§ä¸­é—´
ä»£ç è¯­è¨€ SPIR-V æ¥å¤„ç†ç€è‰²å™¨ï¼ŒåŠ è½½çš„ç€è‰²å™¨æ˜¯å­—èŠ‚ç ã€‚

```py
# Load GLSL shader
var shader_file := load("res://compute_example.glsl")
var shader_spirv: RDShaderSPIRV = shader_file.get_spirv()
var shader := rd.shader_create_from_spirv(shader_spirv)
```

ä¸ºäº†ä½¿ç¼–å†™ç‰‡æ®µç€è‰²å™¨ç®€å•æ˜äº†ï¼ŒShadertoy ä¼šå¤„ç†ä»ä¸»ç¨‹åºå‘ç‰‡æ®µç€è‰²å™¨ä¼ é€’å¤§é‡æœ‰ç”¨ä¿¡æ¯ï¼š

- iChannelTime[4] å¯¹åº” Shadertoy æä¾›çš„å››ä¸ªå¤–éƒ¨åª’ä½“æ’­æ”¾æ—¶é—´ä¿¡æ¯ï¼›
- iChannelResolution[4] å¯¹åº” Shadertoy å››ä¸ªå¤–éƒ¨åª’ä½“åˆ†è¾¨ç‡ï¼›
- iChanneli å¯¹åº” Shadertoy å››ä¸ªå¤–éƒ¨åª’ä½“å½“å‰çš„å›¾åƒçº¹ç†ï¼Œi å€¼ä¸º [0, 3]ï¼›
- iMouse å¯¹åº”æµè§ˆå™¨ä¸­è·å–åˆ°çš„é¼ æ ‡è½åœ¨ Canvas åƒç´ ä½ç½®ä¿¡æ¯ï¼›

Godot é»˜è®¤åªå½“å‰èŠ‚ç‚¹çº¹ç†ä¼ å…¥ç€è‰²å™¨ï¼Œ**CanvasItem** ç±»å‹å¯¹è±¡å¯ä»¥ä½¿ç”¨ 2D æè´¨ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªçº¹ç†ã€‚

å…¶ä¸­æœ‰ä¸€äº›åœ¨ Godot ä¸­æ²¡æœ‰ç­‰ä»·è¡¨è¾¾ï¼Œå› æ­¤ Godot é€‰æ‹©äº†é»˜è®¤æƒ…å†µä¸‹ä¸æä¾›å®ƒä»¬ï¼Œä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åœ¨ Godot 
ä¸­æŒ‰åŒæ ·æ–¹å¼å¤„ç†å®ƒä»¬ï¼Œä¸‹é¢è¿™å¼ è¡¨ç»™å‡º Shadertoy è¿™äº›å˜é‡ å®šä¹‰ä¸ GLSL çš„ç­‰ä»·å…³ç³»ã€‚ä»¥ä¸‹å˜é‡æ ‡æ˜ä¸º 
â€œProvide with Uniformâ€ï¼Œè¡¨ç¤ºç”¨æˆ·è´Ÿè´£è‡ªå·±åˆ›å»º uniform ä»å¤–éƒ¨ä¼ é€’æ•°æ®åˆ°ç€è‰²å™¨ç¨‹åºã€‚

+---------------------+---------+------------------------+-----------------------------------------------------+
|Variable             |Type     |Equivalent              |Description                                          |
+=====================+=========+========================+=====================================================+
|fragColor            |out vec4 |COLOR                   |Output color for each pixel.                         |
|fragCoord            |vec2     |FRAGCOORD.xy            |For full screen quads. For smaller quads, use UV.    |
|iResolution          |vec3     |1.0 / SCREEN_PIXEL_SIZE |Can also pass in manually.                           |
|iTime                |float    |TIME                    |Time since shader started.                           |
|iTimeDelta           |float    |Provide with Uniform    |Time to render previous frame.                       |
|iFrame               |float    |Provide with Uniform    |Frame number.                                        |
|iChannelTime[4]      |float    |Provide with Uniform    |Time since that particular texture started.          |
|iMouse               |vec4     |Provide with Uniform    |Mouse position in pixel coordinates.                 |
|iDate                |vec4     |Provide with Uniform    |Current date, expressed in seconds.                  |
|iChannelResolution[4]|vec3     |1.0 / TEXTURE_PIXEL_SIZE|Resolution of particular texture.                    |
|iChanneli            |Sampler2D|TEXTURE                 |Godot provides only one built-in; user can make more.|
+---------------------+---------+------------------------+-----------------------------------------------------+

The Book of Shaders ä¸­ä½¿ç”¨çš„ç€è‰²å™¨ç¨‹åºå‡ ä¹æ˜¯ä¸¥æ ¼æŒ‰ GLSL ç¼–å†™çš„ï¼Œåªå®ç°å°‘é‡ uniforms å˜é‡ï¼š

+---------------------+---------+------------------------+-----------------------------------------------------+
|Variable             |Type     |Equivalent              |Description                                          |
+=====================+=========+========================+=====================================================+
|gl_FragColor         |out vec4 |COLOR                   |Output color for each pixel.                         |
|gl_FragCoord         |vec4     |FRAGCOORD               |For full screen quads. For smaller quads, use UV.    |
|u_resolution         |vec2     |1.0 / SCREEN_PIXEL_SIZE |Can also pass in manually.                           |
|u_time               |float    |TIME                    |Time since shader started.                           |
|u_mouse              |vec2     |Provide with Uniform    |Mouse position in pixel coordinates.                 |
+---------------------+---------+------------------------+-----------------------------------------------------+


OpenGL ä½¿ç”¨çš„åæ ‡æ˜¯ç¬›å¡å°”åæ ‡ç³»ç»Ÿï¼Œå³å±å¹•å‘å³ã€å‘ä¸Šåˆ†åˆ«ä¸º Xã€Y è½´æ­£æ–¹å‘ ï¼Œé¡¶ç‚¹çš„å€¼ç›´æ¥åæ˜ åœ¨å±å¹•ã€‚

å§‹ç»ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ OpenGL ä¸–ç•Œåæ ‡ç³»æ˜¯`å³æ‰‹åæ ‡ç³»` right-hand system ï¼Œåœ¨äºŒç»´å±å¹•ä¸Šï¼Œå±å¹•
æ°´å¹³æ–¹å‘æ˜¯ X è½´æ–¹å‘ï¼Œå‘å³ä¸ºæ­£ï¼Œå±å¹•ç«–èµ·æ–¹å‘æ˜¯ Y è½´æ–¹å‘ï¼Œå‘ä¸Šä¸ºæ­£ï¼Œå‚ç›´äºå±å¹•çš„æ–¹å‘æ˜¯ Z è½´æ–¹å‘ï¼Œ
ä»å±å¹•é‡Œå¾€å¤–ä¸ºæ­£ã€‚å³å³æ‰‹ä¸­æŒ‡å‘è‡ªå·±è¡¨ç¤º Z è½´ã€é£ŸæŒ‡ç«–èµ·å‘ä¸Šè¡¨ç¤º Y è½´ã€æ¯æŒ‡å‘å³è¡¨ç¤º X è½´ã€‚å³ä½¿æ‰‹è…•æ€ä¹ˆ
è½¬åŠ¨ï¼Œå³æ‰‹ç³»ç»Ÿè¿™ç§è½´å‘å…³ç³»æ˜¯ä¸»è¦çš„å‚è€ƒã€‚ä¸‹å›¾ä¸­ï¼ŒCamera æˆåƒçš„è§’åº¦å°±å¦‚çœ¼ç›çœ‹å±çš„å¹•å›¾åƒä¸€æ ·ï¼š

Perspective Projection vs. orthographic Projection:

![https://stackoverflow.com/questions/36573283/from-perspective-picture-to-orthographic-picture](https://github.com/jimboyeah/spine-sfml-demo/raw/master/images/From_perspective_picture_to_orthographic_picture.png)

ç¬¬ä¸€ä¸ªç€è‰²å™¨ï¼Œåœ¨ç¼–å†™ä»£ç å‰ï¼Œéœ€è¦äº†è§£ä»¥ä¸‹å‡½æ•°åŠå†…ç½®å˜é‡ï¼š

- gl_Position é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„é¡¶ç‚¹åæ ‡ï¼Œè¿™æ˜¯é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„æœ€ä¸»è¦çš„æ•°æ®ã€‚
- gl_FragColor ç‰‡æ®µç€è‰²å™¨è¾“å‡ºçš„é¢œè‰²ï¼Œç»è¿‡é¡¶ç‚¹ç€è‰²å™¨å¤„ç†åçš„çº¹ç†ã€é¡¶ç‚¹ç­‰æ•°æ®ä¼šè¿›å…¥ç‰‡æ®µç€è‰²å™¨ç»§ç»­å¤„ç†ã€‚
- texture() å‡½æ•°ç”¨æ¥è¯»å–çº¹ç†è¾“å…¥ï¼ŒGLSL å†…ç½®å‡½æ•°ï¼Œçº¹ç†åˆ™ Godot å¼•æ“è¾“å…¥ï¼Œç»™ Node2D è®¾ç½®çº¹ç†å›¾å³å¯ã€‚

```c
// Perform a texture read. 
gvec4_type texture (gsampler2D s, vec2 p [, float bias])
```

GLSL çš„å‡½æ•°å¤šæ•°éƒ½æœ‰é‡è½½ï¼Œå‚æ•°å¯ä»¥æ˜¯ 1Dã€2Dã€3Dã€4D çš„å½¢å¼ã€‚çº¹ç†è¯»å–å‡½æ•°ä¼šä½¿ç”¨çº¹ç†åæ ‡ P åœ¨å½“å‰ç»‘å®š
åˆ°é‡‡æ ·å™¨çš„çº¹ç†ä¸­è¿›è¡Œçº¹ç†æŸ¥æ‰¾ texture lookupã€‚GLSL ä¸­çš„çº¹ç†ç›¸å…³å‡½æ•°ä¼šæ ¹æ® OpenGL API è®¾ç½®çš„
çº¹ç†ç»„åˆé‡‡æ ·å™¨ï¼Œtexture-combined samplersï¼Œå¯¹çº¹ç†è¿›è¡Œè®¿é—®ã€‚çº¹ç†å±æ€§ï¼Œå¦‚å¤§å°ã€åƒç´ æ ¼å¼ã€ç»´åº¦æ•°ã€
è¿‡æ»¤æ–¹æ³•ã€mipmap çº§åˆ«æ•°ã€æ·±åº¦æ¯”è¾ƒç­‰ï¼Œä¹Ÿç”± OpenGL API è°ƒç”¨å®šä¹‰ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šå½±å“ GLSL çº¹ç†å‡½æ•°ã€‚
Sampler é€šå¸¸æ˜¯åœ¨ç‰‡å…ƒç€è‰²å™¨å†…å®šä¹‰çš„ï¼Œè¿™æ˜¯ä¸€ä¸ª uniform ç±»å‹å˜é‡ï¼Œå³å¤„ç†ä¸åŒçš„ç‰‡å…ƒæ—¶è¿™ä¸ªå˜é‡ä¸å˜ã€‚
ä¸€ä¸ª sampler å¯¹åº”ä¸€ä¸ª textureï¼Œç±»å‹ä¹Ÿæ˜¯å¯¹åº”çš„ï¼Œæ¯”å¦‚ sampler2D é‡‡æ ·å™¨å°±å¯¹åº” GL_TEXTURE_2D 
ç±»å‹çš„çº¹ç†å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ï¼Œåªè¦ä¼ é€’ä¸‰ä¸ªçº¹ç†åæ ‡ç»™é¡¶ç‚¹ç€è‰²å™¨ï¼Œç‰‡å…ƒç€è‰²å™¨ä¼šä¸ºæ¯ä¸ªåƒç´ ç”Ÿæˆçº¹ç†åæ ‡çš„æ’å€¼ï¼Œ
æ ¹æ®çº¹ç†åæ ‡å°±å¾—åˆ°äº†æ¯ä¸€ä¸ªåƒç´ çš„é¢œè‰²å€¼ã€‚Godot ä½¿ç”¨ **draw_circle()** æ–¹æ³•åœ¨ Node2D ç»˜å›¾ï¼Œ
ç”±äºåªæœ‰ä¸€ä¸ªåæ ‡ï¼Œå¯¹åº”çš„ UV ä¸º (0.0, 0.0)ï¼Œå°½ç®¡åœ†å‘¨æ˜¯å¤šæ¡çº¿æ®µç»˜åˆ¶æ¨¡æ‹Ÿå‡ºåœ†å½¢ï¼Œä½†é¡¶ç‚¹å´åªæœ‰ä¸€ä¸ªã€‚
è€Œåƒ **draw_polygon()** è¿™æ ·çš„æ–¹æ³•åˆ™éœ€è¦æŒ‡å®šï¼Œå› ä¸ºå®ƒéœ€è¦æŒ‡å®šå¤šä¸ªé¡¶ç‚¹ã€‚

çº¹ç†åæ ‡é€šå¸¸çš„èŒƒå›´æ˜¯ä»(0, 0)åˆ°(1, 1)ï¼Œå½“çº¹ç†åæ ‡è®¾ç½®ä¸ºèŒƒå›´ä»¥å¤–ï¼ŒOpenGL é»˜è®¤çš„è¡Œä¸ºæ˜¯æŠ˜å›é‡å¤è¿™ä¸ª
çº¹ç†å›¾åƒï¼ŒTexture Wrappingï¼Œå³å¿½ç•¥çº¹ç†åæ ‡æµ®ç‚¹å€¼çš„æ•´æ•°éƒ¨åˆ†ï¼Œå³å°æ•°éƒ¨åˆ†ï¼ŒOpenGL è¿˜æœ‰å…¶å®ƒé€‰æ‹©ï¼Œ
å…·ä½“å‚è€ƒè§„èŒƒæ‰‹å†Œã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ª Node2D èŠ‚ç‚¹çš„æ‰©å±•ç±»ï¼Œå¯ä»¥ç»˜åˆ¶åœ†å½¢ã€çŸ©å½¢åŠèƒŒæ™¯çº¹ç†å¡«å……ï¼Œå¯ä»¥ä½œä¸º Sprite ä½¿ç”¨ï¼Œå¹¶ä¸”å¯ä»¥
è®¾ç½®ç€è‰²å™¨æè´¨è¿›è¡Œç€è‰²å™¨ç¼–ç¨‹ï¼š

```py
tool
extends Node2D

class_name Circle
signal circle_hit(event)

export(Color, RGBA) var color = Color(.2,.2,.2,.5) setget _set_color
export(float, 0, 100, .1) var radius = 20.0 setget _set_radius
export(float) var detectionRadius = 20.0 setget _set_detectionRadius
export(bool) var rectangular = false setget _set_rectangular
export(Texture) var texture setget _set_texture

func _set_color(value):
    color = value
    update()

func _set_radius(value):
    radius = value
    update()

func _set_detectionRadius(value):
    detectionRadius = value
    update()

func _set_rectangular(value):
    rectangular = value
    update()

func _set_texture(value):
    texture = value
    update()


func _draw():
    var w = 1.4142135623730 * radius
    if rectangular:
        draw_rect(Rect2(-Vector2.ONE*w/2, Vector2(w, w)), color)
    else:
        draw_circle(Vector2.ZERO, radius, color)
    if texture:
        draw_texture_rect(texture, Rect2(Vector2.ONE*w/-2, Vector2(w, w)), false)

func _input(event):
    if event.is_pressed() and event is InputEventMouseButton:
        var mouse = event as InputEventMouseButton
        var distance = self.position.distance_to(event.position)
        var sd = self.position.distance_squared_to(event.position)
        if distance > detectionRadius:
            return
        print("detection distance %s - %s" % [distance, sd])
        emit_signal("circle_hit", mouse)
```

æ•°å­¦åœ¨ç€è‰²å™¨æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„å·¥å…·ï¼Œæ‰€æœ‰ç®—æ³•éƒ½ç¦»ä¸å¼€åŸºç¡€çš„å‡½æ•°ï¼Œè€Œå…¶ä¸­åˆä»¥çº¿æ€§ä»£æ•°çš„å‘é‡ã€å˜æ¢çŸ©é˜µ
ç­‰å†…å®¹ä¸ºä¸»ï¼Œä¸‰è§’å‡½æ•°ä¹Ÿæ˜¯æœ€ä¸ºå¸¸ç”¨çš„å‡½æ•°ï¼Œä»¥ä¸‹æ˜¯ä¸‰è§’å…¶ä¸­ä¸‰ä¸ªçš„æ›²çº¿ï¼Œåœ¨ç€è‰²å™¨ä¸­ç»˜å›¾ã€å˜æ¢æ•°å€¼ç­‰ç­‰æ“ä½œ
ç»å¸¸ä½¿ç”¨åˆ°ï¼Œç†Ÿæ‚‰å®ƒä»¬éå¸¸å¿…è¦ã€‚Matlab æä¾›çš„ç¬¦å·æ•°å­¦å·¥å…·ç®±æ–‡æ¡£æ˜¯ä¸é”™çš„å‚è€ƒææ–™ï¼š

[Symbolic Math Toolbox](https://ww2.mathworks.cn/help/symbolic/)

| Cosine Plot | Sine | Arctangent |
|-------------|------|------------|
| ![Cosine Plot](https://ww2.mathworks.cn/help/examples/symbolic/win64/CosPlotTheCosineFunctionExample_01.png) | ![Sine Plot](https://ww2.mathworks.cn/help/examples/symbolic/win64/SinPlotTheSineFunctionExample_01.png) | ![ArcTangent Plot](https://ww2.mathworks.cn/help/examples/symbolic/win64/AtanPlotTheInverseTangentFunction1Example_01.png)

- Sine å’Œ Cosine çš„å€¼åŸŸéƒ½æ˜¯ [-1, 1]ï¼Œå‘¨æœŸéƒ½æ˜¯ 2Ï€ã€‚
- Sine åœ¨ -Ï€/2 åˆ° Ï€/2 åŒºé—´æ˜¯é€’å¢ï¼Œè€Œ Cosine åœ¨ -Ï€ åˆ° 0 åŒºé—´æ˜¯é€’å¢ã€‚
- atan åæ­£åˆ‡å‡½æ•°ï¼Œå³æ­£åˆ‡å‡½æ•°çš„åå‡½æ•°ï¼Œinverse tangent (arctangent)ï¼Œå€¼åŸŸä¸º [-Ï€/2, Ï€/2]ã€‚

Tangent æ­£åˆ‡å‡½æ•°æ˜¯æ ¹æ®è§’åº¦ Î± æ±‚è§£å¯¹è¾¹ä¸é‚»è¾¹çš„æ¯”å€¼ï¼Œè€Œåå‘ä¸‰è§’å‡½æ•°åˆ™åè¿‡æ¥æ ¹æ®æ¯”å€¼æ±‚è§’åº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

    sin(Î±) = opposite side / hypotenuse    = a / h
    cos(Î±) = adjacent side / hypotenuse    = a / h
    tan(Î±) = opposite side / adjacent side = a / b

![Trigonometric Functions](https://ww2.mathworks.cn/help/symbolic/definition_sine.png)

åæ­£åˆ‡å‡½æ•°æ˜¯é€’å¢å‡½æ•°ï¼Œå¹¶ä¸”åœ¨ä¸¤è¾¹å‘ˆç°å¹³æ»‘çš„å˜åŒ–ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥ç”¨åœ¨å¹³æ»‘è¿‡æ¸¡ä¸Šã€‚

- For real values of Z, atan(Z) returns values in the interval [-pi/2, pi/2].
- For complex values of Z, atan(Z) returns complex values with the real parts in the interval [-pi/2, pi/2].


é¢œè‰²ä½¿ç”¨ RGBA å››åˆ†é‡ç»“æ„ï¼Œä½¿ç”¨ vec4 å››ç»´å‘é‡è¡¨ç¤ºï¼Œç€è‰²ä¸­åˆ›å»ºå‘é‡éå¸¸ä¾¿åˆ©ï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªè‰²å½©å›¾æ¡ˆ
ç›¸åº”çš„ä»£ç ï¼Œç¬¬ä¸€æ¡ä½¿ç”¨å­—é¢å¸¸é‡è®¾ç½®å›¾æ¡ˆä¸ºç»Ÿä¸€çš„è‰²å€¼ã€‚ç¬¬äºŒæ¡ä½¿ç”¨ UV åæ ‡ä½œä¸ºé¢œè‰²çš„ RG å‰ä¸¤ä¸ªåˆ†é‡ï¼Œ
Blue è“è‰²åˆ†é‡ä¸º 0.5ï¼ŒAlpha åˆ†é‡ä¸º 1.0 ä¸é€æ˜çŠ¶æ€ï¼Œæ‰€ä»¥ç¬¬äºŒå›¾å·¦ä¸Šè§’åº”è¯¥æ˜¯æ·¡è“ï¼Œåˆ°å³ä¸‹è§’è“è‰²ç›¸å¯¹
å˜å¼±ï¼Œä»¥çº¢ç»¿æ··åˆè‰²ä¸ºä¸»ï¼Œæ˜¾ç¤ºä¸ºåé»„è‰²ã€‚è€Œå³ä¸Šè§’ä»¥çº¢è‰²ä¸ºä¸»ï¼Œæ­é…åŠåˆ†è“ï¼Œæ˜¾ç¤ºä¸ºç´«è‰²ï¼Œè€Œå·¦ä¸‹è§’ä»¥ç»¿ä¸ºä¸»ï¼Œ
æ­é…è“è‰²åï¼Œæ˜¾ç¤ºé’ç»¿è‰²ã€‚å› ä¸ºç»¿è‰²æ¯”è¾ƒæ˜¾çœ¼ï¼Œäººç±»çœ¼ç›çš„ç»¿è‰²æ„Ÿå…‰å™¨å³è§†é”¥ç»†èƒè¾ƒå¤šï¼Œæ‰€ä»¥ç»¿è‰²è¾ƒæ˜¾è‘— ï¼š

![Blue Box](https://docs.godotengine.org/en/3.5/_images/blue-box.png)
![UV Box](https://docs.godotengine.org/en/3.5/_images/UV.png)

```c
void fragment() {
    COLOR = vec4(0.4, 0.6, 0.9, 1.0);
    COLOR = vec4(UV, 0.5, 1.0);
}
```

å‘é‡æä¾›äº†å„ç§åˆ†é‡çš„è®¿é—®ï¼Œå¹¶ä¸”å¯ä»¥æŒ‰åæ ‡å½¢å¼ã€æˆ–é¢œè‰²åˆ†é‡çš„å½¢å¼è®¿é—®ï¼Œå¦‚ COLOR.rgb ç­‰ä»· COLOR.xyzï¼Œ
ä½†æœ€å¥½æŒ‰è¯­è®®ä½¿ç”¨ã€‚é¢œè‰²å„åˆ†é‡å€¼ä¼šé€šè¿‡ clamp å‡½æ•°çº¦æŸåœ¨ [0.0, 1.0] èŒƒå›´ï¼Œè¶…å‡ºçš„å€¼ä¼šè¢«å›ºå®šè½¬æ¢åˆ°æ­£å¸¸
åŒºé—´ï¼Œè´Ÿå€¼æˆªæ–­å˜æˆ 0.0ï¼Œæ­£æ•°åˆ™ä¸è¶…è¿‡ 1.0ã€‚

å¯¹äº Alpha åˆ†é‡ï¼Œåˆ™ç‰¹æ®Šç‚¹ï¼Œæ ¹æ®å›¾åƒæ•°æ®æ— ç¬¦å·æ•°ã€æœ‰ç¬¦å·æ•°æ ¼å¼å·®åˆ«ï¼ŒAlpha å¯¹åº”å½’ä¸€åŒ–ä¸ºä¸¤ç§åŒºé—´è¡¨è¾¾
[0,1] æˆ–è€… [âˆ’1,1]ã€‚ä½† Alpha å€¼è¶…å‡ºè¿™ä¸ªèŒƒå›´æ—¶ï¼Œå¹¶ä¸ä¼šä½  RGB åˆ†é‡ä¸€æ ·è¢« clamp çº¦æŸåœ¨æ­£å¸¸å€¼åŒºé—´ï¼Œ
åœ¨ OpenGL å¯¹çº¹ç†è¿›è¡Œæ··åˆå¤„ç†æ—¶ï¼ŒAlph å€¼å°±ä¼šæŒ‰æ··åˆæ–¹ç¨‹å¼è¿›è¡Œå¤„ç†ã€‚

Godot åœ¨ç»˜åˆ¶é€æ˜å›¾åƒæ—¶ï¼Œé€æ˜ä¼šåŒºä¹Ÿä¼šä¸€å¹¶å¤„ç†ï¼Œè¿™å¯¹äºå¤§å°ºå¯¸çš„å›¾åƒæ¥è¯´å¹¶ä¸æ˜¯å¾ˆå¥½çš„åšæ³•ï¼Œé€šè¿‡è½¬æ¢å¸¦
é€æ˜çº¹ç†çš„ Sprite ä¸º MeshInatance2Dï¼Œå¯ä»¥é¿å…å¤§é‡é€æ˜åŒºçš„æ¸²æŸ“ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹è¿™æ£µå¸¦é€æ˜åŒºçš„æ ‘ï¼Œ
åœ¨åœºæ™¯ä¸­é€‰ä¸­ Spriteï¼Œåœ¨è§†å›¾ä¸­çš„å·¥å…·æ æ‰§è¡Œ "Convert to 2D Mesh" å³å¯ä»¥è¿›è¡Œè½¬æ¢ï¼Œå¦ä¸€ç§ç”Ÿæˆ 2D 
ç½‘æ ¼çš„æ–¹æ³•æ˜¯é€šè¿‡ OBJ å¯¼å…¥ã€‚

![2D meshes - Sprite to Mesh](https://docs.godotengine.org/en/3.5/_images/mesh2d1.png)


åœ¨ Godot é»˜è®¤ç€è‰²å™¨æ··åˆæ¨¡å¼ä¸‹ï¼Œè´Ÿå€¼çš„ Alpha å½±å“æœ€ç»ˆæ··åˆç»“æœï¼Œå¦‚ä¸‹ä¸¤ç»„çš„é¢œè‰²ï¼Œåˆ†åˆ«æ˜¯ç­‰æ•ˆçš„ï¼š

    COLOR = vec4(1.0, 1.0, 0.0, -1.0); // blue
    COLOR = vec4(0.0, 0.0, 0.72, 1.0); // blue

    COLOR = vec4(0.0, 1.0, 0.0, -1.0); // purple
    COLOR = vec4(0.72, 0.0, 0.72, 1.0);// purple

æ ¹æ®æ‰‹å†Œå†…å®¹ The OpenGL Graphics System: A Specification (Version 4.6 (Core Profile)
17.3 Per-Fragment Operations - Blending - Table 17.1: RGB and alpha blend equations
æ··åˆæ–¹ç¨‹å¼å¯ä»¥è¡¨è¾¾ä¸ºä»¥ä¸‹æ–¹å¼ï¼Œæ··åˆæ¶‰åŠåƒç´ æ¥æºæ–¹ä»¥åŠç›®æ ‡è¾“å‡ºæ–¹çš„ä¸¤ä¸ªå‚æ•°ï¼Œæ··åˆå› å­å’Œåƒç´ é¢œè‰²ï¼Œåˆ†åˆ«å‰ç¼€
f å’Œ C è¡¨ç¤ºï¼Œop ä¸ºæ“ä½œï¼Œå³è¿ç®—æ–¹å¼ï¼Œè¿ç®—ä¸­çš„å‚æ•°ä»¥åˆ†é‡å½¢å¼è¿›è¡Œï¼š

    C_final = f_source * C_source op f_destination * C_destination

æ··åˆè¿ç®—å¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ï¼Œå¦å¤– GL_MINã€GL_MAX ä¸¤ç§æ¯”è¾ƒç®€å•:

- **GL_FUNC_ADD** å‰åä¸¤é¡¹ç›¸åŠ 
- **GL_FUNC_SUBTRACT** å‰åä¸¤é¡¹ç›¸å‡
- **GL_FUNC_REVERSE_SUBTRACT** å‰åä¸¤é¡¹åé¡ºåºç›¸å‡

æ··åˆå‡½æ•° Blend Functions å¯ä»¥è®¾ç½®ä¸¤ä¸ªåˆ†é‡ç³»æ•°ï¼ŒRGB Blend Factors å’Œ Alpha Blend Factorï¼Œ
è¿™äº›ç³»æ•°çš„ä¼ å…¥æ–¹å¼ä¸åŒï¼Œä¼šå¤§å¤§æ”¹å˜ï¼Œè¾“å‡ºç»“æœã€‚é€šè¿‡ä»¥ä¸‹ OpenGL å‘½ä»¤å¯ç”¨ã€è®¾ç½®æ··åˆæ¨¡å¼ï¼š

```c
    glEnable(GL_BLEND);
    glBlendEquation(GL_FUNC_ADD);
    glBlendEquation(GL_FUNC_REVERSE_SUBTRACT);

    glBlendFunc(GL_SRC_ALPHA, GL_ONE);
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
    glBlendFunc(GL_ONE, GL_ONE); //use additive to accumulate one over the other
    glBlendFuncSeparate(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA, GL_ZERO, GL_ONE);
```

æ··åˆå‡½æ•°è®¾ç½®çš„æ··åˆæƒé‡ç³»æ•°æœ‰å››ä¸ªæ¥æºï¼Œæ˜¯é€šè¿‡ BlendColor å‘½ä»¤è®¾ç½®çš„ RGBA é¢œè‰²åˆ†é‡ï¼ŒåŒ…æ‹¬ç¬¬ä¸€æ¥æº
å’Œç¬¬äºŒæ¥æºçš„é¢œè‰²ï¼Œä»¥åŠ darw buffer ä¸­çš„ç›®æ ‡é¢œè‰²ã€‚å¦å¤–ï¼Œè¿˜æœ‰ç‰¹æ®Šçš„å¸¸é‡æƒé‡ GL_ZERO å’Œ GL_ONEï¼Œ
åˆ†åˆ«æ˜¯ (0,0,0,0) å’Œ (1,1,1,1) ä¸¤ä¸ªå››ç»´çŸ¢é‡ã€‚

ä¾‹å¦‚ï¼ŒglBlendFunc(GL_SRC_ALPHA, GL_ONE) æ–¹å¼ä¼ å…¥çš„ç³»æ•°ï¼Œæ­é… GL_FUNC_ADD è¿ç®—ï¼Œå‡è®¾æºåƒç´ 
vec4(1.0, 1.0, 0.0, -1.0)ï¼ŒAlpha è´Ÿå€¼åˆ†é‡å°±ä¼šå’Œæºåƒç´ çš„ RGB ç›¸ä¹˜ï¼Œå†ä¸åé¢çš„å¸¸é‡è¿ç®—ç»“æœç›¸åŠ ï¼Œ
æœ€åå½’ä¸€åŒ–ï¼Œå°† RGB è´Ÿå€¼å½’ 0.0ï¼Œå°† Alpha å½’ 1.0ï¼Œå¾—åˆ° vec4(0.0, 0.0, 0.3, 1.0)ã€‚

    C_final = (-1.0,-1.0,-1.0,-1.0) * (1.0, 1.0, 0.0, -1.0) 
            + (1.0,1.0,1.0,1.0) * (0.3, 0.3, 0.3, 1.0)
            = (-0.7,-0.7,0.3,2.0)

ä»¥ä¸Šç›¸ä¹˜æ˜¯å’Œåˆ†é‡çš„è¿ç®—ï¼Œå¹¶ä¸æ˜¯å‘é‡ä¹‹é—´çš„è¿ç®—ï¼Œä¸æ˜¯å‘é‡ç‚¹ç§¯ä¹Ÿä¸æ˜¯å‰ç§¯ï¼Œæ‰€ä»¥æ²¡ä½¿ç”¨å‘é‡è¡¨ç¤ºã€‚å¦å¤–ï¼Œé»˜è®¤
Godot å·¥ç¨‹ç¯å¢ƒèƒŒæ™¯è‰² Default Clear Color è®¾ç½®ä¸º 77 çš„ç°åº¦å€¼ï¼Œå³å„åˆ†é‡çº¦ä¸º 0.3ã€‚

æœ€åï¼Œå®˜æ–¹æ–‡æ¡£æ¨èä»¥ä¸‹é¡ºåºç¼–å†™ç€è‰²å™¨ä»£ç ï¼š

```c
01. shader type declaration
02. render mode declaration
03. // docstring

04. uniforms
05. constants
06. varyings

07. other functions
08. vertex() function
09. fragment() function
10. light() function
```


### ğŸŸ ğŸ”µ 3D SpatialShader ç©ºé—´æè´¨ç€è‰²å™¨
- [LenarOpenGL - Coordinate Systems](https://learnopengl.com/Getting-started/Coordinate-Systems)
- [Spatial shaders](https://docs.godotengine.org/en/3.5/tutorials/shaders/shader_reference/spatial_shader.html)
- [Your 1st 3D shader](https://docs.godotengine.org/en/latest/tutorials/shaders/your_first_shader/your_first_3d_shader.html)
- [Your 2nd 3D shader](https://docs.godotengine.org/en/latest/tutorials/shaders/your_first_shader/your_second_3d_shader.html)

3D ç€è‰²å™¨ä¸ 2D çš„ç€è‰²å™¨å·®åˆ«è¾ƒå¤šï¼Œä¾‹å¦‚ COLOR å…¨å±€å˜é‡ä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºæ­¤æ¨¡å¼ä¸‹å®ƒä¸æ˜¯ uniform å˜é‡ï¼Œ
è¿™äº›å·®åˆ«ä¸»è¦æ˜¯å› ä¸º Godot ä¸­çš„æä¾›çš„æè´¨æ”¯æŒï¼Œå³é€šè¿‡ 3D ç€è‰²å™¨å¯ä»¥è®¿é—®åˆ°é»˜è®¤çš„ 3D æè´¨æ¥å£ï¼Œå¦‚
ALBEDOã€NORMALMAP ç­‰å…¨å±€ç¬¦å·å¯ä»¥ä¿®æ”¹æè´¨è¡¨é¢è‰²(vec3)ã€æ³•çº¿è´´å›¾ç­‰è®¾ç½®ã€‚

æ³¨æ„ï¼ŒGodot 3.x ä¸ 4.x çš„ç‰ˆæœ¬å˜åŒ–è¾ƒå¤§ï¼Œå¾ˆå¤šå¯¹è±¡åŠç¬¦å·éƒ½åšäº†è°ƒï¼ŒNORMALMAP å°±å˜æ›´ä¸º NORMAL_MAPã€‚

```py
# called from the MeshInstance3D
mesh.material.set_shader_param("height_scale", 0.5)
mesh.material.set_shader_param("normalmap", sometexture)
```

è¦ç»™ 3D ç€è‰²å™¨ä¼ é€’æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æè´¨ç±»çš„æ–¹æ³•æ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç€è‰²å™¨ä¸­å®šä¹‰ uniform å˜é‡ç­‰å½¢å¼ä¼ é€’æ•°æ®ã€‚
æ³¨æ„ï¼Œå¦‚æœè¦åœ¨ fragment ä¸­ä½¿ç”¨ VERTEX ä¸­åŒ…å«çš„å½“å‰é¡¶ç‚¹åæ ‡ä¿¡æ¯ï¼Œéœ€è¦é€šè¿‡ varying å˜é‡ä¼ é€’æ•°æ®ã€‚
å°½ç®¡ï¼Œåœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è¿˜å¯ä»¥è®¿é—® VERTEX è¿™ä¸ªå…¨å±€å˜é‡ï¼Œä½†å…¶æœ¬èº«å·²ç»ä¸æ˜¯é¡¶ç‚¹ç€è‰²å™¨å¤„ç†è¿‡ç¨‹ä¸­çš„é‚£ä¸ªé¡¶ç‚¹
åæ ‡ï¼Œè€Œæ¸²æŸ“æµæ°´çº¿ä¸Šçš„å…¶å®ƒå‚è€ƒåæ ‡ï¼Œå³ OpenGL è§†å›¾åæ ‡ç³»ç»Ÿï¼Œä»¥å±å¹•ä¸­å¿ƒä¸ºåŸç‚¹ï¼Œå³ä¸Šè§’ä¸ºæ­£æ–¹å‘ã€‚è¿™ä¸ªåæ ‡
ä¼šéšç€è§†å›¾ä½ç½®çš„ç§»åŠ¨è€Œå˜åŒ–ï¼Œè€Œä¸ç®¡ç‰©ä½“æœ¬èº«çš„åæ ‡æ˜¯ä¸æ˜¯è¿˜åœ¨åŸä½ã€‚

å› ä¸ºï¼Œvertex ç€è‰²å™¨æ˜¯ä¸ºæ¯ä¸ªé¡¶ç‚¹è®¾ç½®å±æ€§ä½¿ç”¨çš„ï¼Œä¼šä¸ºæ¯ä¸ªé¡¶ç‚¹è°ƒç”¨ï¼Œè€Œ fragment ç€è‰²å™¨åˆ™ä¸ºæ¯ä¸ªåƒç´ è°ƒç”¨ã€‚


ä»¥ä¸‹ç€è‰²å™¨å®ç°æ³¢æµªç‰¹æ•ˆï¼Œåœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ª `MeshInstance3D` èŠ‚ç‚¹ï¼Œå†ç»™å®ƒèµ‹äºˆä¸€ä¸ª PlaneMesh ç½‘æ ¼ï¼Œ
è¿™æ˜¯ Godot å†…ç½®çš„ä¸€äº›æœ€ç®€å•çš„æ¨¡å‹ï¼Œç»™ Plane è®¾ç½®ç»†åˆ†åˆ° 100 æ ¼å·¦å³çš„æ–¹é˜µå³å¯ã€‚é€šè¿‡ 3D è§†å›¾çš„èœå•
åˆ‡æ¢ä¸º Display wireframe æ˜¾ç¤ºçº¿æ¡†ï¼Œå¯ä»¥çœ‹åˆ°ç½‘æ ¼ä¸­åŒ…å«äº†è®¸å¤šä¸‰è§’å½¢ï¼Œè¿™äº›éƒ½ PrimitiveMeshesï¼Œ
ä¹Ÿæ˜¯ OpenGL ç»˜å›¾ä¸­æœ€åŸºæœ¬çš„å›¾å…ƒï¼Œå°±åƒç‚¹ã€çº¿ã€å¤šè¾¹å½¢ä¸€æ ·ï¼Œéƒ½æ˜¯æœ€ç®€å•çš„å›¾å½¢ç»“æ„ã€‚

ç»™æè´¨åˆ›å»ºä¸€ä¸ª NoiseTexture çº¹ç†ï¼Œå¹¶ç»™å®ƒæŒ‡å®šå™ªå£°æ¥æº OpenSimplexNoise æˆ– FastNoiseLite 
ä»¥ç”Ÿæˆå¹³æ»‘å™ªå£°çº¹ç†ï¼Œå¸¸ç”¨æ¥ç”Ÿæˆåœ°å½¢ã€‚ç„¶åï¼Œé€šè¿‡ç€è‰²å™¨å°†å™ªå£°ç”¨äºæ”¹å˜ Plane çš„éšæœºé«˜åº¦ï¼Œä¸ºäº†æ›´çœŸå®ï¼Œ
å¯ä»¥æ·»åŠ ä¸åŒé¢‘ç‡çš„éšæœºå™ªå£°ã€‚å°±åƒå‚…é‡Œå¶å˜æ¢ä¸­é‚£æ ·ï¼Œä½¿ç”¨ä¸åŒçš„åŒæœŸçš„æ­£å¼¦å‡½æ•°ç»„åˆæ¥æ¨¡æ‹Ÿå…¶å®ƒä¿¡å·ã€‚

è™½ç„¶ï¼Œé€šè¿‡å™ªå£°çº¹ç†å¯ä»¥åˆ›å»ºåœ°å½¢æˆ–æ°´æ³¢ï¼Œä½†æ˜¯æ­¤æ—¶å…‰ç…§å¤„ç†ä¸­è¿˜æ˜¯å°†å®ƒå½“ä½œ Plane ç½‘æ ¼æ¥å¤„ç†ï¼Œæ³•çº¿æ²¡æœ‰æ”¹å˜ï¼Œ
å…‰ç…§ä¹Ÿå°±æ˜æ˜¾çœ‹ç€ä¸å¯¹ã€‚

æ³•çº¿å­˜å‚¨åœ¨ç½‘æ ¼ä¸­ï¼Œä½†ç€è‰²å™¨ä¼šä¸æ–­æ›´æ”¹ç½‘æ ¼çš„å½¢çŠ¶ï¼Œå› æ­¤æ³•çº¿æ€»ä¸æ­£ç¡®ã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥é‡æ–°è®¡ç®—ç€è‰²å™¨ä¸­
çš„æ³•çº¿æˆ–ä½¿ç”¨ä¸å™ªæ³¢ç›¸å¯¹åº”çš„æ³•çº¿çº¹ç†ã€‚Godot ä¸­å¾ˆå®¹æ˜“å®ç°ï¼Œå¯ä»¥åœ¨ vertex ç€è‰²å™¨ä¸­æ‰‹åŠ¨è®¡ç®—æ³•å‘é‡ï¼Œä¹Ÿ
å¯ä»¥ç›´æ¥ä½¿ç”¨ NoiseTexture åˆ›å»ºæ³•çº¿å™ªå£°çº¹ç†ï¼Œåªéœ€è¦å‹¾é€‰ As Normalmapï¼Œç”Ÿæˆçš„çº¹ç†å°±æ˜¯æ³•çº¿è´´å›¾ã€‚
ç„¶åï¼Œå°† uniform è¾“å…¥çš„æ³•çº¿è´´å›¾èµ‹å€¼åˆ° NORMALMAP è¾“å‡ºå˜é‡ä¸­ã€‚æ ¹æ®éœ€è¦è®¾ç½®å‡¹å‡¸å¼ºåº¦ Bump strenthï¼Œ
å¦‚æœçº¹ç†æ¥ç¼å¤ªæ˜æ˜¾ï¼Œå¯ä»¥å‹¾é€‰ Seamless å‡å°‘å½±å“ã€‚

æ³¨æ„ï¼Œæ³•çº¿è´´å›¾éœ€è¦ä½¿ç”¨ XZ åˆ†é‡ä½œä¸ºé‡‡æ ·åæ ‡ï¼Œå› ä¸º Godot çš„ Y è½´æ˜¯ç«–èµ·å‘ä¸Šçš„ã€‚è¿˜æœ‰ Plane å¯¹è±¡çš„
åæ ‡åŸç‚¹åœ¨ä¸­å¿ƒï¼Œåæ ‡èŒƒå›´ä¸º [-1, 1]ï¼Œéœ€è¦æ ¹æ®å®é™…ä½¿ç”¨è¿›è¡Œè½¬æ¢ã€‚

ç¯å¢ƒè®¾ç½®ä¸Šï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª WorldEnvironmentï¼Œå¹¶è®¾ç½®èƒŒæ™¯æ¨¡å¼ä¸º Skyï¼Œç„¶åï¼Œåˆ›å»ºä¸€ä¸ªç¨‹åºåŒ–å¤©ç©ºç›’ï¼Œ
ä½¿ç”¨ ProceduralSkyMaterial ç¨‹åºæè´¨ã€‚

è²æ¶…å°”æ•ˆåº”è¡¨ç°æ¯”è¾ƒå¥½ç†è§£ï¼Œè§†çº¿ä¸è¡¨é¢å¤¹è§’è¶Šå°ï¼Œæ•ˆåº”å°±è¶Šæ˜æ˜¾ï¼Œåå°„å…‰çœ‹èµ·æ¥ä¹Ÿè¶Šå¼ºï¼Œæ‰€ä»¥éœ€è¦è§†è§’å‘é‡å’Œ
ç‰©ä½“è¡¨é¢æ³•å‘é‡è¿›è¡Œç‚¹ç§¯è¿ç®—ï¼Œdot(NORMAL, VIEW)ã€‚å½“ä¸¤è€…å‚ç›´æ—¶ç‚¹ç§¯ç»“æœæœ€å°ï¼Œä¸º 0ï¼Œä½†æ˜¯è²æ¶…å°”æ•ˆåº”æ˜¯
æœ€å¼ºçš„ï¼Œæ‰€ä»¥æ˜¯åæ¯”ä¾‹å…³ç³»ã€‚


```c,ignore
shader_type spatial;
//render_mode unshaded;
render_mode diffuse_toon, specular_toon;

// Constants in Godot 4.x
//const float PI  = 3.14159265358979323846;
//const float TAU = 6.28318530717958647692;

uniform sampler2D normalmap;
uniform sampler2D noise;

varying vec3 tex_position;

float wave(vec2 position)
{
    position += texture(noise, position / 10.0).x * 2.0 - 1.0;
    vec2 wv = 1.0 - abs(sin(position));
//  return length(wv);
    return pow(1.0 - pow(wv.x * wv.y, 0.65), 4.0);
}

float height(vec2 position, float time)
{
    return wave((position - time) * 0.4 ) * 0.3 + 
           wave((position - time) * 0.3 ) * 0.3 +
           wave((position + time) * 0.5 ) * 0.2 +
           wave((position - time) * 0.6 ) * 0.2;
}

void vertex() {
    // save position for fragment, conver Plane coordinate from [-1, 1] to [0, 1]
    tex_position = (VERTEX.xyz + 1.0) / 2.0;
    
    float edge = 1.0 - smoothstep(0.0, 1.2, length(VERTEX.xz));
    VERTEX.y += height(VERTEX.xz, TIME) ;//* edge;
}

void fragment()  
{
    float fresnel = sqrt(1.0 - dot(NORMAL, VIEW));
    RIM = 0.2;
    METALLIC = 1.0;
    ROUGHNESS = 0.01 * (1.0 - fresnel);
    ALBEDO = vec3(0.1, 0.3, 0.5) + (0.8 * fresnel);
    NORMALMAP = texture(normalmap, tex_position.xz).xyz;
    
//  ALBEDO = vec3(VERTEX); // View space coordinate
}
```

æ¦‚æ‹¬åœ°çœ‹ï¼ŒGodot æ‰€åšçš„æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ç»„å¯ä»¥é€‰æ‹©è®¾ç½®çš„å‚æ•°ï¼ŒAOã€SSS_Strengthã€RIM ç­‰ç­‰å¯¹åº”å„ç§å¤æ‚æ•ˆæœï¼Œ
ç¯å¢ƒå…‰é®æŒ¡ Ambient Occlusion, äºšè¡¨é¢æ•£å°„ SubSurface Scattering, è¾¹ç¼˜ç…§æ˜ Rim Lightingã€‚
å½“è„šæœ¬ä¸ä½¿ç”¨è¿™äº›åŠŸèƒ½ä»£ç æ—¶ï¼Œç€è‰²å™¨ä¸ä¼šäº§ç”Ÿé¢å¤–åŠŸèƒ½çš„å¼€é”€ã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥è½»æ¾åœ°ä½¿ç”¨å¤æ‚ä¸”æ­£ç¡®çš„ PBR ç€è‰²ï¼Œ
è€Œæ— éœ€ç¼–å†™å¤æ‚çš„ç€è‰²å™¨ã€‚

å½“ç„¶ï¼ŒGodot è¿˜å…è®¸å¿½ç•¥æ‰€æœ‰è¿™äº›å‚æ•°å¹¶å®Œå…¨è‡ªå®šä¹‰ç€è‰²å™¨ã€‚ä¾‹å¦‚ unshaded æ¸²æŸ“æ¨¡å¼å°±å¯ä»¥å…³é—­å…‰ç…§ç³»ç»Ÿã€‚

    render_mode diffuse_toon, specular_toon;

å¤šä¸ªæ¸²æŸ“æ¨¡å¼å¯å †å ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å¡é€šç€è‰²è€Œé PBR ç€è‰²ï¼Œå°±å°†æ¼«åå°„æ¨¡å¼å’Œé•œé¢åå°„æ¨¡å¼è®¾ç½®ä¸ºå¡é€šã€‚

Godot 4.x ä¸­ï¼Œç»™ 3D ç€è‰²å™¨å¼•å…¥äº†å¤šä¸ªå¸¸é‡ï¼Œé™¤äº†åŸæœ‰çš„ TIMEï¼Œè¿˜æœ‰åœ†å‘¨ç‡ç­‰ Global built-ins:

+-------------------+----------------------------------------------------------------------------------------+
| Built-in          | Description                                                                            |
+===================+========================================================================================+
| in float **TIME** | Global time, in seconds.                                                               |
| in float **PI**   | A ``PI`` constant (``3.141592``).                                                      |
|                   | A ration of circle's circumference to its diameter and amount of radians in half turn. |
| in float **TAU**  | A ``TAU`` constant (``6.283185``).                                                     |
|                   | An equivalent of ``PI * 2`` and amount of radians in full turn.                        |
| in float **E**    | A ``E`` constant (``2.718281``). Euler's number and a base of the natural logarithm.   |
+-------------------+----------------------------------------------------------------------------------------+


å¦å¤–ï¼Œ3D ç€è‰²å™¨é™¤äº† vertex() å’Œ fragment()ï¼Œè¿˜å¤šäº†ä¸€ä¸ª light() ç€è‰²å¤„ç†å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå¤„ç†å‡½æ•°ä¸­ï¼Œ
å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å†…ç½®å˜é‡ Light built-insï¼š

+-----------------------------------+----------------------------------------------------+
| Built-in                          | Description                                        |
+===================================+====================================================+
| in vec2 **VIEWPORT_SIZE**         | Size of viewport (in pixels).                      |
| in vec4 **FRAGCOORD**             | Coordinate of pixel center in screen space.        |
| in mat4 **MODEL_MATRIX**          | Model space to world space transform.              |
| in mat4 **INV_VIEW_MATRIX**       | View space to world space transform.               |
| in mat4 **VIEW_MATRIX**           | World space to view space transform.               |
| in mat4 **PROJECTION_MATRIX**     | View space to clip space transform.                |
| in mat4 **INV_PROJECTION_MATRIX** | Clip space to view space transform.                |
| in vec3 **NORMAL**                | Normal vector, in view space.                      |
| in vec2 **UV**                    | UV that comes from vertex function.                |
| in vec2 **UV2**                   | UV2 that comes from vertex function.               |
| in vec3 **VIEW**                  | View vector, in view space.                        |
| in vec3 **LIGHT**                 | Light Vector, in view space.                       |
| in vec3 **LIGHT_COLOR**           | Color of light multiplied by energy.               |
| in float **ATTENUATION**          | Attenuation based on distance or shadow.           |
| in vec3 **ALBEDO**                | Base albedo.                                       |
| in vec3 **BACKLIGHT**             |                                                    |
| in float **METALLIC**             | Metallic.                                          |
| in float **ROUGHNESS**            | Roughness.                                         |
| in bool **OUTPUT_IS_SRGB**        | ``true`` when calculations happen in sRGB color    |
| out vec3 **DIFFUSE_LIGHT**        | Diffuse light result.                              |
| out vec3 **SPECULAR_LIGHT**       | Specular light result.                             |
| out float **ALPHA**               | Alpha (0..1); if written to, the material will go  |
+-----------------------------------+----------------------------------------------------+


### ğŸŸ ğŸ”µ Orbit Shader

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè½¨é“ç¯ç»•ç€è‰²å™¨ï¼Œåªæ˜¯ç®€å•åœ°ä½¿ç”¨ä¸‰è§’å‡½æ•°äº§ç”Ÿåœ†å½¢ã€æ¤­åœ†å½¢è½¨é“ï¼Œå¹¶å°†è½¨é“ä¸Šçš„ç‚¹çš„ä½ç½®è®¾ç½®åˆ°é¡¶ç‚¹
ç€è‰²å™¨çš„é¡¶ç‚¹åæ ‡ä¸Šï¼Œä½¿ç”¨é¡¶ç‚¹ä½ç½®åæ ‡æŒ‰è½¨é“ç§»åŠ¨ã€‚ç„¶åï¼Œå†æ ¹æ®é¡¶ç‚¹çš„åæ ‡å˜åŒ–ï¼Œä»¥ä½¿ç”¨é¡¶ç‚¹åæ ‡åœ¨ y è½´æ–¹å‘
ä¸Šäº§ç”Ÿæ‰°åŠ¨ï¼Œæ‰°åŠ¨æ¥æºäºåæ ‡çš„ XY ä¸¤è½´çš„å˜åŒ–å€¼ã€‚æ‰€ä»¥ï¼Œé¡¶ç‚¹æ— è®ºåœ¨å…¶ä¸­ä»»æ„ä¸€è½´ä¸Šçš„ç§»åŠ¨ï¼Œæ‰°åŠ¨éƒ½ä¼šæ‰€åæ˜ ã€‚
ç„¶åè¾“å‡ºç»™åç»­çš„ç€è‰²å™¨å¤„ç†ï¼Œå¦‚ç‰‡æ®µç€è‰²å™¨ã€‚

```c,ignore
shader_type canvas_item;
// Here are the available types:
//shader_type spatial;     // - for 3D rendering.
//shader_type canvas_item; // - for 2D rendering.
//shader_type particles;   // - for particle systems.

uniform vec2 orbit = vec2(1.0, 1.0);

void vertex() {
  // Animate Sprite moving in a orbit around its location
  VERTEX += vec2(cos(TIME)*orbit.x, sin(TIME)*orbit.y);
  VERTEX.y += 3.0*cos(VERTEX.x) * sin(VERTEX.y);
}

void fragment(){
  COLOR = texture(TEXTURE, UV); //read from texture
}
```

### ğŸŸ ğŸ”µ Pixlate Shader

ä»¥æ˜¯ä¸€ä¸ªå…·æœ‰å®ç”¨åŠŸèƒ½çš„ç€è‰²å™¨ Pixelate Shaderï¼ŒåŠŸèƒ½è¯´æ˜å¦‚ä¸‹ï¼š

Uniform å®šä¹‰äº†å¤–éƒ¨ä¼ å…¥å‚æ•° amountï¼Œå®ƒæŒ‡å®šäº†ä¸€ä¸ªåƒç´ é‡é‡‡æ ·é‡ã€‚æ ¹æ® p åæ ‡è®¡ç®—è¡¨è¾¾å¼ï¼Œamount å…ˆ
ä¼šå¯¹ UV è¿›è¡Œç¼©æ”¾å†å–æ•´åé™¤ä»¥è‡ªèº«ï¼Œå‚æ•°å€¼è¶Šå¤§ï¼ŒUV åæ ‡ç›¸å¯¹å°±æ˜¾å¾—å°ï¼Œå³ UV å˜åŒ–å°±æ›´ç²¾ç»†ï¼Œè¾“å‡ºåƒç´ 
å°±è¶Šæ¥è¿‘åŸå›¾ã€‚å½“ amount ç­‰äºåŸå›¾å¤§å°æ—¶ï¼Œå°±ç­‰äºæ²¡æœ‰åƒç´ åŒ–æ•ˆæœã€‚å½“ amount è¶Šå°ï¼ŒUV çš„å˜åŒ–å½±å“å°±æ˜¾å¾—
å¼ºçƒˆï¼Œä¹Ÿå°±æ˜¯æ¯æ‰«æä¸‹ä¸€ä¸ªåƒç´ æ—¶ï¼ŒUV åæ ‡çš„å˜åŒ–å°±å¯ä»¥å¯¼è‡´æ›´å¤šçš„åŸåƒç´ è¢«å¿½ç•¥äº†ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸€äº›é‡å¤çš„åƒç´ ï¼Œ
æœ€åï¼Œå›¾åƒæ•ˆæœå‡ºæ¥çš„å°±æ˜¯ç²—ç³™çš„åƒç´ åŒ–æ•ˆæœã€‚

```c
shader_type canvas_item;

uniform int amount = 9;

void fragment()
{
    vec2 p = round(UV * float(amount)) / float(amount);
    
    vec4 text = texture(TEXTURE, p);
    
    COLOR = text;
}
```

### ğŸŸ ğŸ”µ Circle Art Shader

ä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šè¿‡åœ†ç‚¹ç»˜ç”»å›¾å½¢çš„ç€è‰²å™¨ï¼Œé€šè¿‡è°ƒæ•´é£æ ¼å‚æ•° grid å°†æ•´ä¸ªå›¾å½¢åˆ†æˆæ–¹å—ï¼Œå†è®¾ç½®åœ†ç‚¹åŠå¾„ï¼Œä½¿
å›¾å½¢ä¸­ä½ç½®å¤„ç†åœ†å†…çš„éƒ¨åˆ†ç»˜ç”»å‡ºæ¥ï¼Œå°±åƒä¸€ä¸ªåœ†å½¢å›¾ç« åœ¨æ‰“ç‚¹ç»˜ç”»ã€‚

åˆ†å‰²å›¾å½¢åï¼Œä½¿ç”¨ **mod()** å‡½æ•°å¯¹ UV åæ ‡è¿›è¡Œåˆ†æ®µå¤„ç†ï¼Œåˆ†æ®µå UV åæ ‡é‡æ–°æ˜ å°„åˆ° [0.0, 1.0]
è¿™ä¸ªåŒºé—´ä¸Šï¼Œä»¥æ–¹ä¾¿åç»­çš„è®¡ç®—ã€‚åœ†ç‚¹åŠå¾„ radius æ˜¯ç›¸å¯¹äºåˆ†å—ä¸­å¿ƒçš„ä½ç½®ï¼Œæ‰€ä»¥åœ¨æ±‚å½“å‰ UV åæ ‡åˆ°åœ†å¿ƒ
è·ç¦»æ—¶ï¼Œå…ˆå‡å» 0.5 åç§»å¸¸é‡ã€‚

ä¸ºäº†æ·»åŠ é•‚ç©ºæ•ˆæœï¼Œå®šä¹‰ä¸ºå¸ƒå°”å€¼ stencil å˜é‡ï¼Œé€šè¿‡ç±»å‹è½¬æ¢å¯ä»¥å°† bool è½¬æ¢ä¸ºæ•´æ•°ï¼Œtrue false å€¼
åˆ†åˆ«å¯¹åº” 1 å’Œ 0ã€‚è¿™é‡Œå–å·§çš„ç‚¹åœ¨äºï¼Œé€šè¿‡ä¹˜æ•° -2 å’ŒåŠ æ•° 1 å°†å¸ƒå°”å€¼è½¬æ¢ä¸ºç”¨ä½œç¬¦å·çš„å€¼ï¼Œ1 å’Œ -1ã€‚

æœ€åï¼Œåˆ©ç”¨è·ç¦»å‡½æ•°çš„æ•°æ®è®¾ç½® Alpha é€šé“ï¼Œéšè—æ‰ä¸éœ€è¦æ˜¾ç¤ºçš„éƒ¨åˆ†ï¼Œå³å¾—åˆ°ç±»ä¼¼ Dot Plot çš„åœ†ç‚¹å›¾ã€‚

```c
shader_type canvas_item;
render_mode blend_mix;

uniform float radius:hint_range(0.0, 1.0, 0.01) = 0.4;
uniform float grid:hint_range(0.0, 100.0) = 10.0;
uniform float sharp:hint_range(0.0, 1.0, 0.01) = 0.50;
uniform bool stencil = false;
 
void fragment()
{
    COLOR = texture(TEXTURE, UV);
    // cast bool to 1.0 or -1.0
    float sign = float(int(stencil) * - 2 + 1);
    float circles = length(mod(UV, 1.0 / grid) * grid - 0.5) - radius;
    COLOR.a = 1.0 - float(stencil) - sign * clamp(sharp * 100.0 * circles, 0.0, 1.0);
}
```

æ³¨æ„ clamp å‡½æ•°çš„å‚æ•°é¡ºåºï¼Œå’Œ smoothstep çš„ä¸åŒï¼Œå®ƒå°†èŒƒå›´å€¼ [min, max] æ”¾åœ¨åé¢ï¼š

```c
// Clamp ``x`` between ``min`` and ``max`` (inclusive).
vec_type clamp (vec_type x, vec_type min, vec_type max)
```


### ğŸŸ ğŸ”µ Circle SDF Shader
- https://iquilezles.org/articles/distfunctions/
- https://iquilezles.org/articles/distfunctions2d/

Shadertoy ä½œè€… Inigo Quilez å¯¹æœ‰å‘è·ç¦»åœºå¾ˆæœ‰æ·±å…¥çš„ç ”ç©¶ï¼Œä½¿ç”¨ Raymarching distance fields
ç¨‹åºåŒ–å»ºæ¨¡åˆ©å®³å¾—ä¸è¡Œï¼Œä½œè€…ä¸»é¡µä¸Šæœ‰ä¸€å¥è¯ï¼šâ€œlearning computer graphics since 1994â€ã€‚

RayMarching çœ‹èµ·æ¥è·Ÿ RayTracing å…‰çº¿è¿½è¸ªå¾ˆåƒï¼Œæœ¬è´¨æ˜¯é€šè¿‡æ•°å­¦æ–¹æ³•æ¨¡æ‹Ÿå…‰çº¿çš„ä¼ æ’­ã€‚è¿™ç§æŠ€æœ¯ä¹Ÿæ˜¯
æœ‰å‘è·ç¦»åœº SDF(Signed Distance Functions) çš„åº”ç”¨ï¼Œä½¿ç”¨è·ç¦»æ–¹ç¨‹æ¥è¡¨ç¤ºå‡ ä½•ä½“çš„æ–¹å¼ï¼Œé…åˆç®—æ³•
ç›´æ¥ä»¥åƒç´ æ¸²æŸ“æ–¹å¼ pixel shader äº§ç”Ÿæœ€ç»ˆçš„å»ºæ¨¡æ•ˆæœç”»é¢ï¼Œè€Œä¸éœ€è¦ 3D æ¨¡å‹æ•°æ®è¾“å…¥ã€‚è¿™ä¹Ÿå°±æ˜¯ 
Shadertoy ç½‘ç«™ä¸Šå¤§éƒ¨åˆ†å»ºæ¨¡ä½œå“ä½¿ç”¨çš„æ–¹æ³•ã€‚

ç„¶è€Œ RayMarching æœ‰ä¸€ä¸ªç¡¬ä¼¤ï¼Œå³åƒç´ æ¸²æŸ“è¦å¯¹æ¯ä¸€ä¸ªåƒç´ ç‚¹åšè¿ç®—ï¼Œå½“ç”»å¸ƒè¾ƒå¤§æ—¶ï¼Œå…¶è®¡ç®—é‡å°±ä¼šå¾ˆå¤§ã€‚
è¿™ä¹Ÿæ˜¯ Shadertoy æ¼”ç¤ºçš„å¾ˆå¤šä½œå“æ‰“å¼€æ—¶å¾ˆå¡é¡¿ï¼Œç”šè‡³å¾ˆå¤šæ¡ˆä¾‹è¿˜æ²¡æ‰“å¼€ï¼Œæµè§ˆå™¨å°±ä¼šå´©æºƒã€‚

RayMarching è¯‘ä½œå…‰çº¿æ­¥è¿›ï¼Œæˆ–è€…å°„çº¿æ¨è¿›ï¼Œä¹Ÿç§°ä¸ºçƒä½“è¿½è¸ª(Sphere Tracing), ä»¥çƒä½“ä½œä¸ºæ£€æµ‹å•å…ƒã€‚
å…¶æ„æ€å°±æ˜¯è®©å°„çº¿çš„èµ·ç‚¹æ²¿ç€å°„çº¿æ–¹å‘é€æ­¥æ¨è¿›ï¼Œæ¯æ¬¡æ¨è¿›çš„è·ç¦»å°±æ˜¯å°„çº¿èµ·ç‚¹åˆ° SDF æ¨¡å‹çš„ä½œä¸ºåŠå¾„çš„è·ç¦»ã€‚
å…‰çº¿è¿½è¸ªæœ‰å‰å‘ã€åå‘ä¸¤ç§æ–¹å¼ï¼ŒForeward/Backward Tracingï¼ŒRayMarching é‡‡ç”¨åå‘æ–¹å¼ï¼Œç”±ç›¸æœº
ä½ç½®æŠ•å°„å…‰çº¿ï¼Œæ¨¡æ‹Ÿçœ¼ç›çš„è§†çº¿è·¯å¾„ã€‚


ä¸‹å›¾æ‘˜è‡ª GPU Gems 2 Chapter 8. Per-Pixel Displacement Mapping with Distance Functions

![Figure 8-5 Sphere Tracing - from GPU Gems 2](https://jamie-wong.com/images/16-07-11/spheretrace.jpg)

RayMarching å°†æ•´ä¸ªåœºæ™¯å®šä¹‰ä¸ºä¸€ä¸ªæœ‰å‘è·ç¦»åœºï¼Œä¸ºäº†æ‰¾åˆ°è§†çº¿å’Œåœºæ™¯ä¹‹é—´ç‰©ä½“çš„äº¤ç‚¹ï¼Œä»ç›¸æœºå¼€å§‹ï¼Œå³æ²¿ç€ Pâ‚€
è§†çº¿ä¸€ç‚¹ä¸€ç‚¹åœ°æ‰©å±•ï¼Œé€šè¿‡è·ç¦»å—æä¾›çš„è·ç¦»ä¿¡æ¯ï¼Œå¯ä»¥æ£€æµ‹åˆ°æ‰©å±•åŠå¾„æ˜¯å¦è§¦åŠåœºæ™¯ç‰©ä½“ï¼Œæˆ–è€…è¯´ï¼Œæ­¤æ—¶ SDF çš„
è®¡ç®—ç»“æœæ˜¯å¦ä¸ºè´Ÿæ•°ï¼Ÿã€‚ä¸€èˆ¬ï¼Œæœ‰å‘è·ç¦»åœºç”¨è´Ÿå€¼è¡¨ç¤ºç‰©ä½“å†…éƒ¨ï¼Œ0 å€¼è¡¨ç¤ºç‰©ä½“è¡¨é¢ï¼Œæ­£å€¼è¡¨ç¤ºå¤–éƒ¨ã€‚å¦‚æœ SDF è¿”å›
æ­£å€¼ï¼Œå°±ç»§ç»­æ²¿ç€å°„çº¿å‰è¿›åˆ°æœ€å¤§æ­¥æ•°ã€‚ç”±äºç¬¬ä¸€ä¸ªè§¦ç‚¹ä¸åœ¨è§†çº¿æ–¹å‘ä¸Šï¼Œæ‰€ä»¥ç»§ç»­æ¢æµ‹ï¼Œç›´åˆ°è§¦åŠ Pâ‚„ è¿™ç‚¹ã€‚
ç„¶åï¼Œæ ¹æ®è¡¨é¢çš„æ³•çº¿å‘é‡ï¼Œä»¥åŠå…‰æºä½ç½®å’Œå…‰çš„ç›´çº¿ä¼ æ’­ã€é€å°„ã€æŠ˜å°„ã€åå°„åŸç†ï¼Œå¯¹ç‰©ä½“è¿›è¡Œç€è‰²ã€‚


ä½œä¸ºä¸€ä¸ªå…¥é—¨å¯ç¤ºç»ƒä¹ ï¼Œä»¥ä¸‹å®ç°ä¸€ä¸ªå¸¦æœ‰ä¸€ç‚¹å…‰å±æ€§åœ°ç»˜åˆ¶åœ†å½¢çš„ç€è‰²å™¨ï¼Œåœºæ™¯ä¸­åªæœ‰ä¸€ä¸ªåœ†å½¢ï¼Œä½¿ç”¨ SDF 
æœ‰å‘è·ç¦»åœºæ¥å®šä¹‰å®ƒï¼Œè¿™æ˜¯ä¸€ç§ç”¨è·ç¦»æ–¹ç¨‹æ¥è¡¨ç¤ºå‡ ä½•ä½“çš„æ–¹å¼ã€‚ç©ºé—´ä¸­åˆ°åœ†å¿ƒçš„è·ç¦»ç­‰äºåŠå¾„çš„ç‚¹ï¼Œå°±æ˜¯åœ†å½¢è¡¨é¢ã€‚
åœ†å½¢å†…éƒ¨ï¼Œè·ç¦»å€¼ä¸ºè´Ÿï¼Œå¤–éƒ¨è·ç¦»å€¼ä¸ºæ­£ã€‚

ç»˜ç”»æ—¶ï¼Œåªéœ€è¦åœ¨åœ†å½¢å†…ä¸Šè‰²ï¼Œè€Œåœ†å½¢å¤–ä¸éœ€è¦é¢œè‰²ï¼Œé€šè¿‡ Alpha ç½®é›¶ï¼Œä½¿å…¶é€æ˜åŒ–ã€‚

åˆ©ç”¨ **min()** å’Œ **max()** å‡½æ•°å¯ä»¥è¿‡æ»¤æ•°æ®ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å€¼ï¼ŒæŒ‰å¤§ã€æˆ–å°çš„è§„åˆ™è¿‡æ»¤å‡ºæ¥ï¼Œä½¿ç”¨é’³åˆ¶
å‡½æ•° **clamp()** å¯ä»¥å®ç°å°†è¾“å…¥å€¼çº¦æŸåœ¨æŒ‡å®šåŒºé—´ã€‚

è¿™äº›å‡½æ•°æœ‰æ—¶å¯ä»¥æ¢ç€ä½¿ç”¨ï¼Œå¯ä»¥è¾¾åˆ°ç›¸ä¼¼çš„æ•ˆæœï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹ä½¿ç”¨ clamp å’Œå¹³æ»‘æ’å€¼å‡½æ•° smoothstep å°†
Alpha é€šé“çš„å€¼çº¦æŸåœ¨ [0.0, 1.0] åŒºé—´ã€‚å½“ç„¶ï¼Œå®ƒä»¬æœ‰æ‰€å·®åˆ«ï¼Œclamp ä¼šå°†è¶…å‡ºèŒƒå›´çš„å€¼å¤ä½åˆ°æœ‰æ•ˆåŒºé—´ã€‚

è€Œä¸‰æ¬¡å¹³æ»‘æ’å€¼å‡½æ•° smoothstepï¼Œç»“æœè¿”å› 0.0 if x â‰¤ edge0ï¼Œæˆ–è€…è¿”å› 1.0 if x â‰¥ edge1ï¼Œè€Œå½“
edge0 < x < edge1ï¼Œä½¿ç”¨ smooth Hermite interpolation å°†ç»“æœå¹³æ»‘åœ¨ [0.0, 1.0] åŒºé—´ã€‚

å¹³æ»‘æ’å€¼æ˜¯ä¸ clamp æœ€å¤§çš„å·®åˆ«æ‰€åœ¨ï¼Œæ’å€¼ä¼šæŒ‰æ¯”ä¾‹æ”¹å˜è¾“å…¥æ•°æ®ï¼Œä½¿å…¶å¹³æ»‘åˆ†å¸ƒåˆ° [0.0, 1.0] åŒºé—´ã€‚
è€Œ clamp åˆ™ä¸ä¼šï¼Œå®ƒåªå°†è¶…å‡ºèŒƒå›´çš„å€¼åˆ†åˆ«å½’ä½ä¸ºåŒºé—´ä¸¤ç«¯çš„å€¼ã€‚

æ³¨æ„ï¼Œedge0 â‰¥ edge1 æ—¶ï¼Œæ— å®šä¹‰ã€‚

```c
    // Hermite interpolate between ``edge0`` and ``edge1`` by ``x``.
    // vec_type smoothstep (vec_type edge0, vec_type edge1, vec_type x)
    // vec_type smoothstep (float edge0, float edge1, vec_type x)

    genFType t;
    t = clamp ((x - edge0) / (edge1 - edge0), 0, 1);
    return t * t * (3 - 2 * t);
```

ç€è‰²å™¨ä¸­ï¼Œæ ¹æ®åŠå¾„è®¾ç½®ï¼Œè·ç¦»åœºä¸­æœ€å¤§çš„è·ç¦»çš„ Â±0.5ï¼Œå°†å€¼ä½œä¸º RGBA ç›´æ¥èµ‹å€¼åˆ°ç‰‡æ®µç€è‰²å™¨çš„è¾“å‡ºï¼Œå¹¶æ²¡æœ‰
è¾¾åˆ° RGBA çš„æœ€å¤§åŠ¨æ€èŒƒå›´ã€‚é€šè¿‡ clamp æˆ– smoothstep å¯ä»¥é‡æ–°å°† [0.0, 0.5] çš„å€¼æ˜ å°„åˆ° [0.0, 1.0]ã€‚

è¿™ä¸ªç€è‰²å™¨ä¸­å¼•å…¥äº†ç‚¹å…‰æºï¼ˆPoint Lightï¼‰çš„æ¦‚å¿µï¼ŒåŸç†å¾ˆåƒä¸€ä¸ªç¯æ³¡ï¼Œä»ç¯æ³¡çš„é’¨ä¸å‘å››é¢å…«æ–¹å‘å‡ºå…‰ã€‚
ç„¶è€Œï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œç‚¹å…‰æºè¢«ç®€åŒ–ä¸ºä»ç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹å‡åŒ€åœ°å‘å„ä¸ªæ–¹å‘å‘å°„å…‰ã€‚å°½ç®¡è¿™é‡Œæœ‰å¤ªå¤šçš„ç¼ºé™·ï¼Œæ¯”å¦‚ï¼Œ
æ²¡æœ‰å¤„ç†å¥½å…‰çš„ä¼ æ’­è·¯å¾„ä¸å…‰å¼ºçš„å…³ç³»ï¼Œæ²¡æœ‰è€ƒè™‘è¡°å‡åŠå¾„ï¼ˆAttenuation Radiusï¼‰ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘ç‰©ä½“å‘ˆç°
çš„é¢œè‰²å—å…‰æºå’Œç‰©ä½“æœ¬èº«æè´¨çš„å½±å“ç­‰ç­‰ï¼Œä¹Ÿæ²¡æœ‰è€ƒè™‘å—å…‰ç‰©ä½“æ˜¯å¹³é¢æˆ–è€…æ˜¯çƒé¢ã€‚åªæ˜¯ç®€å•åœ°æ ¹æ®å…‰æºçš„è·ç¦»ï¼Œ
çº¿æ€§è®¡ç®—é¢œè‰²çš„äº®åº¦å€¼ï¼Œç„¶åå†å åŠ å…‰æºé¢œè‰²ã€‚

æ›´é«˜çº§çš„å…‰ç…§æ•ˆæœè¿˜æœ‰ï¼Œçš®è‚¤ä¸Šçš„æ¬¡è¡¨é¢æ•£å°„ï¼ˆSubsurface scattering)ï¼Œåˆ°å¤„å¯è§çš„ Fresnel è²æ¶…å°”æ•ˆåº”ã€‚

ä½†æ˜¯ï¼Œè¿™ä¸€åˆ‡éƒ½ä¸å½±å“è¿™ä¸ªç®€å•çš„ç€è‰²å™¨ä½œä¸ºä¸€ä¸ªåˆå­¦è€…çš„æœ€ç›´è§‚çš„å­¦ä¹ ææ–™ã€‚

```c
shader_type canvas_item;

uniform float radius = 0.5;
uniform vec2  center = vec2(0.5, 0.5);
uniform vec2  light_position  = vec2(0.5, 0.0);
uniform vec3  light_color  = vec3(0.9, 0.2, 0.2);
uniform float light_energy  = 0.85;

float sdf_circle(vec2 p, float r)
{
    return length(p - center) - r;
}

void fragment()
{
    float dis = sdf_circle(UV, radius);
    float circle = max(0.0, -min(0.0, dis));
    COLOR = vec4(0.0) + circle;
    COLOR.a = clamp(0.0, 1.0, COLOR.a * 100.0);
    //COLOR.a = smoothstep(0, 0.1, COLOR.a);
    
    float lsdf = 1.0 - length(light_position - UV);
    float light = smoothstep(0, 1.0, lsdf * light_energy);
    COLOR.rgb = light_color * light;
}
```

æ³¨æ„ï¼šGodot ä¸­ç€è‰²å™¨çš„ uniform å˜é‡æ˜¯å¯ä»¥åœ¨å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸­è®¾ç½®å€¼çš„ï¼Œå¹¶ä¸”ä¼šå°†å€¼ä¿ç•™åœ¨å·¥ç¨‹æ–‡ä»¶ä¸­ï¼Œ
å†æ¬¡åŠ è½½æ˜¯ä¼šç›´æ¥è¯»å–å·¥ç¨‹ä¸­çš„ä¿ç•™å€¼ï¼Œè€Œä¸èƒ½é€šè¿‡ä¿®æ”¹ä»£ç æ¥æ”¹å˜å–å€¼ã€‚è¿™æ—¶å¯èƒ½éœ€è¦å°†ç€è‰²å™¨æè´¨æ¸…ç†æ‰ï¼Œå†
é‡æ–°å…³è”ç€è‰²å™¨ï¼Œè¿™æ ·æ‰èƒ½ä½¿ç€è‰²å™¨ä¸­çš„ uniform åˆå§‹åŒ–èµ‹å€¼ç”Ÿæ•ˆã€‚




### ğŸŸ ğŸ”µ Convolution Shader å·ç§¯è¾¹ç¼˜æ£€æµ‹ç®—æ³•
- [ä»å›¾(Graph)åˆ°å›¾å·ç§¯(Graph Convolution)ï¼šæ¼«è°ˆå›¾ç¥ç»ç½‘ç»œæ¨¡å‹](https://www.cnblogs.com/SivilTaram/p/graph_neural_network_2.html)
- [å·ç§¯å˜ä½“](https://zhuanlan.zhihu.com/p/393200454)
- [ä»€ä¹ˆæ˜¯å·ç§¯ï¼ŸBut what is a convolution?](https://www.bilibili.com/video/BV1Vd4y1e7pj/)

å·ç§¯æ˜¯ä¸€ç§ç§¯åˆ†å˜æ¢çš„æ•°å­¦æ–¹æ³•ï¼Œä¸å‚…ç«‹å¶å˜æ¢æœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚åœ¨æ•°å­—ä¿¡å·å¤„ç†ã€é€šä¿¡ç³»ç»Ÿã€å…‰å­¦ç³»ç»Ÿã€ç¥ç»ç½‘ç»œ
è®¡ç®—è®¸å¤šæ–¹é¢å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ã€‚å·ç§¯ç®—æ³•å¯ä»¥åº”ç”¨äºè®¸å¤šåœºæ™¯ï¼Œè½»æ¾å®ç°æ¨¡ç³Šã€è¾¹ç¼˜æ£€æµ‹ã€æµ®é›•ç­‰æ»¤é•œæ•ˆæœã€‚

å¯ä»¥ç”¨å·ç§¯æ¥æ¼”ç¤º 314x159 ä¸¤ä¸ªæ•°çš„ä¹˜æ³•è¿ç®—ï¼Œå°†å„ä¸ªæ•°å­—åˆ†æ‹†è®¡ç®—å·ç§¯ï¼Œå†æŒ‰å¯¹è§’çº¿æ±‚å’Œå†ç®—æƒé‡ï¼š

      | 3    1    4
    --|-------------
    1 | 3    1    4
      |
    5 | 15   5    20     ==> 36 + (20+9)x10 + (4+5+27)x100 + (1+15)x1000 + 3x10000
      |
    9 | 27   9    36       = 49926

ä½¿ç”¨ Python numpy æ¨¡å—è®¡ç®—å·ç§¯ï¼Œå¦‚æœæ˜¯è®¡ç®—å·¨å¤§çš„æ•°æ®ï¼Œä½¿ç”¨ scipy æ¨¡å—æ•ˆç‡æ›´é«˜ï¼š

```py
    # pip install scipy numpy
    import numpy
    import scipy.signal

    res = numpy.convolve((3,1,4), (1,5,9))
    print(res) # [ 3 16 36 29 36]

    a1 = numpy.random.random(10000)
    a2 = numpy.random.random(10000)
    res = scipy.signal.fftconvolve(a1, a2)
    print(res)
```

å›¾åƒå¤„ç†ä¸­ï¼Œè¾¹ç¼˜æ£€æµ‹æ˜¯æœ€åŸºæœ¬çš„æŠ€æœ¯ï¼Œå›¾åƒå¯ä»¥é€šè¿‡è¾¹ç¼˜çš„åˆ†åŒºåï¼Œå†æ ¹æ®ä¸åŒåŒºåŸŸè¿›è¡Œå·®å¼‚åŒ–çš„å¤„ç†ã€‚è¾¹ç¼˜
å¯ä»¥è¢«æ£€æµ‹å‡ºæ¥ï¼Œå¹¶çªå‡ºæ˜¾ç¤ºï¼Œæ˜¯å› ä¸ºå®ƒä¸å››å‘¨å­˜åœ¨æ˜æ˜¾çš„å·®å¼‚ï¼Œå…³é”®å°±æ˜¯å›¾åƒçš„åƒç´ å·®å¼‚ã€‚

åˆ¤æ–­è¾¹ç¼˜çš„ä¾æ®å¯ä»¥æ˜¯é¢œè‰²ã€äº®åº¦ã€çº¹ç†ç­‰å˜åŒ–å·®å¼‚çš„å¤§å°ï¼Œæˆ–è€…è¯´å¼ºåº¦ï¼Œå°±æ˜¯åˆ¤æ–­ç›¸é‚»åƒç´ ä¹‹é—´çš„æ¢¯åº¦ gradientã€‚
ç®—æ³•ä¸­ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ä¹Ÿå¯ä»¥ä½¿ç”¨ç»å¯¹å€¼æ¥æ›¿ä»£å¼€æ ¹å·è¿ç®—ã€‚

æ ¹æ®åº”ç”¨åœºåˆä¸åŒï¼Œå›´ç»•å·®å¼‚çš„è¾¹ç¼˜æ£€æµ‹çš„æ–¹æ³•æœ‰å¤šç§ï¼š

- 2D å›¾åƒè¾¹ç¼˜æ£€æµ‹æŠ€æœ¯å¯ä»¥ä½¿ç”¨å·ç§¯ï¼ˆconvolutionï¼‰ï¼›
- 3D ç‰©ä½“çš„è¾¹ç¼˜æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨ 3D åœºæ™¯ä¸­çš„æ·±åº¦ä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨è¡¨é¢æ³•çº¿å‘é‡ï¼›

åœ¨æ•™ç§‘ä¹¦ä¸Šï¼Œå·ç§¯çš„å®šä¹‰é€šå¸¸æ˜¯ç”¨å‡½æ•°çš„ä¹˜ç§¯ç»„åˆå®šä¹‰çš„ï¼Œè€Œåœ¨å›¾å½¢å¤„ç†ä¸Šï¼Œå¯ä»¥ç”¨æ„å›¾å½¢è±¡ç›´è§‚åœ°å±•ç¤ºï¼š

![Visual 2D Convolution](https://images.cnblogs.com/cnblogs_com/SivilTaram/1510485/o_image-13-conv-cnn.gif)

å›¾ä¸­å·¦ä¾§å¯ä»¥çœ‹ä½œæ˜¯å›¾åƒçš„åƒç´ å€¼ï¼Œä¸­é—´æ˜¯ä¸€ä¸ªè®¡ç®—æ–¹æ³•ä¸­è®¾ç½®çš„æƒé‡å€¼ï¼Œå³ä¾§æ˜¯è®¡ç®—ç»“æœã€‚ä¸­é—´æ˜¯ä¸€ä¸ªé‡‡æ ·çŸ©é˜µï¼Œ
ä¹Ÿå«å·ç§¯æ ¸ kernelï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª NxN çš„çŸ©é˜µï¼Œå¹¶ä¸” N ä¸€èˆ¬ä¸ºå¥‡æ•°ï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸ªå€¼å°±æ˜¯æƒé‡**weight**ã€‚
è¿›è¡Œå·ç§¯å¤„ç†çš„è¿‡ç¨‹å°±æ˜¯ï¼Œå°†æ¯ä¸ªè¾“å…¥å€¼éƒ½å·ç§¯æ ¸ç›¸ä¹˜ï¼Œå¹¶å¾—åˆ°ä¸€å¯¹åº”çš„è¾“å‡ºå€¼ã€‚

å› ä¸ºï¼Œè¿™ç§å·ç§¯è¿ç®—çš„ç»“æœç›¸å½“å¯¹åŸå›¾åƒé‡æ–°é‡‡æ ·ï¼Œä½œç”¨åƒç”µè·¯ä¸­çš„æ»¤æ³¢å™¨ä¸€æ ·ï¼Œå¯ä»¥å®ç°å›¾åƒçš„æ¨¡ç³Šã€é”åŒ–æ•ˆæœï¼Œ
å³åˆ†åˆ«è¿‡æ»¤æ‰äº†é«˜é¢‘ã€ä½é¢‘çš„æ•°å€¼å˜åŒ–ï¼Œæ‰€ä»¥ä¹Ÿå«åš filterã€‚å›¾åƒçš„é«˜ä½é¢‘è¡¨ç°åœ¨è§†è§‰ä¸Šï¼Œå°±æ˜¯é¢œè‰²å˜åŒ–å·®åˆ«å¤§
å³ä¸ºé«˜é¢‘ï¼Œé”åŒ–çš„å›¾åƒå³ä¸ºå…¸å‹é«˜é¢‘ã€‚å˜åŒ–å·®åˆ«å°å³ä¸ºä½é¢‘ï¼Œçœ‹èµ·æ¥å¹³æ»‘ï¼Œæ¨¡ç³Šå°±æ˜¯å…¸å‹çš„ä½é¢‘ã€‚

ä»ä¿¡å·è§’åº¦ç†è§£ï¼Œå·ç§¯å¯ä»¥å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆè“è‰²å•ä½å“åº”æ–¹æ³¢ï¼‰åœ¨ä¸€ä¸ªè¾“å…¥ä¿¡å·ï¼ˆçº¢è‰²æ–¹æ³¢ï¼‰ä¸Šçš„åŠ æƒè¾“å‡ºï¼Œ
å³å°†è¾“å…¥ä¿¡å·ä»æ–¹æ³¢è½¬å˜ä¸ºä¸‰è§’æ³¢ï¼Œå·ç§¯ç»“æœå°±æ˜¯å°†æ–¹æ³¢è¾¹ç¼˜ï¼ˆé«˜é¢‘ï¼‰è½¬æ¢ä¸ºä¸‰è§’æ³¢çš„ç¼“æ…¢å˜åŒ–ï¼ˆä½é¢‘ï¼‰ã€‚

![Square to triangle](https://pic3.zhimg.com/v2-a5b5870ab0a4030684c7f5796e3b83a6_b.webp)

ä¾‹å¦‚ï¼Œé‡‡ç”¨ 3x3 çš„å¹³æ»‘è¿‡æ»¤å·ç§¯æ ¸å¯ä»¥å®ç°ä¸€å®šçš„æ¨¡ç³Šæ•ˆæœï¼Œè¾“å‡ºå€¼ä¸ºé‡‡æ ·åŒºåŸŸçš„å¹³å‡å€¼ï¼Œæ•ˆæœç±»ä¼¼é«˜æ–¯æ¨¡ç³Šã€‚
å·ç§¯æ ¸ä¸­å¿ƒæ ¼å­å¯¹åº”å½“å‰çš„åƒç´ ï¼Œå…¶å®ƒå‘¨è¾¹çš„æ¯ä¸ªæ ¼å¼éƒ½å¯¹åº”åç§»åˆ°è¾“å…¥åƒç´ çš„å‘¨è¾¹ï¼Œå¹¶æ ¹æ®å·ç§¯æ ¸ä¸­è®¾ç½®çš„æƒé‡
ä¸è¾“å…¥å€¼ç›¸ä¹˜ï¼Œå†æ±‚å’Œè·å–åˆ°çš„å€¼å³ä¸ºæ–°å›¾åƒåƒç´ å€¼ã€‚

ä½¿ç”¨å·ç§¯è¿›è¡Œè¾¹ç¼˜æ£€æµ‹æ—¶ï¼Œå·ç§¯æ ¸è®¾ç½®çš„æƒé‡å€¼ä¹Ÿç§°è¾¹ç¼˜æ£€æµ‹ç®—å­ã€‚å·ç§¯è™½ç„¶åå­—ä¸­æœ‰â€œå·â€çš„å«ä¹‰ï¼Œä½†æ˜¯å®ƒçš„å†…æ¶µ
ä¸»è¦åœ¨äºè¿ç»­ã€ç§¯çš„å±‚é¢ä¸Šã€‚


åœ¨ 3D åœºæ™¯ä¸­ï¼Œç‰©ä½“çš„æ¯ä¸ªåæ ‡éƒ½ä¼šæœ‰ä¸€ä¸ªç‰¹æ®Šçš„å€¼ Zï¼Œä¹Ÿå°±æ˜¯æ·±åº¦ã€‚æ·±åº¦ä¿¡æ¯å¯ä»¥ç”¨æ¥åŒºåˆ†ç‰©ä½“ä½ç½®å‰åå…³ç³»ï¼Œ
å³ç›¸äº’ä¹‹é—´çš„é®ç›–å…³ç³»ã€‚å¼•æ“ä¸€èˆ¬éƒ½æœ‰æä¾›æ·±åº¦ä¿¡æ¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ç‰©ä½“è¡¨é¢çš„åæ ‡è®¡ç®—åˆ°ç›¸å¯¹æŸç‚¹çš„è·ç¦»å¾—åˆ°ã€‚
å¦‚æœä¸€ä¸ªä½ç½®çš„æ·±åº¦å€¼å’Œå®ƒå››å‘¨çš„æ·±åº¦å€¼äº§ç”Ÿäº†å·®å¼‚ï¼Œé‚£è¯´æ˜è¿™ä¸ªä½ç½®å¯èƒ½å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ‰¾çš„è¾¹ç¼˜ã€‚


æ³•çº¿å°±æ˜¯å‚ç›´äºç‰©ä½“è¡¨é¢çš„å•ä½å‘é‡ï¼Œé€šè¿‡å®ƒå¯ä»¥åˆ¤æ–­è¡¨é¢æ˜¯å¦å‘ç”Ÿè¾ƒå¤§çš„å˜åŒ–ï¼Œå¦‚æœä¸¤ç‚¹æ³•çº¿çš„ç‚¹ç§¯ä¸º 0 å°±
è¡¨ç¤ºä¸¤ç‚¹æ‰€åœ¨çš„è¡¨é¢æ˜¯äº’ç›¸å‚ç›´çš„ï¼Œä¹‹é—´ç›¸å·®è¾ƒå¤§ï¼Œç›¸åï¼Œå€¼è¶Šå¤§è¡¨æ˜è¶Šå¹³å¦ï¼Œå‘é‡ç‚¹ç§¯çš„ç»“æœå¯ä»¥åˆ¤æ–­è¾¹ç¼˜ã€‚
è¿˜å¯ä»¥æœ‰å¦ä¸€ç§æ€è·¯ï¼šæ³•çº¿ä¸è§†è§’é—´çš„å¤¹è§’ã€‚è§†çº¿ä¸å…¶æ³•çº¿çš„å¤¹è§’æ›´æ¥è¿‘äºå‚ç›´ï¼Œå°±æ›´å¯èƒ½è¢«è®¤å®šä¸ºè¾¹ç¼˜çš„éƒ¨åˆ†ã€‚


### ğŸŸ ğŸ”µ Glass Broken ç ´ç¢çš„ç»ç’ƒ
- [Standard Material 3D and ORM Material 3D](https://docs.godotengine.org/en/latest/tutorials/3d/standard_material_3d.html)
- [Blender ESCN exporter](https://docs.godotengine.org/en/3.5/tutorials/assets_pipeline/escn_exporter/index.html)
- [Godot Blender Exporter](https://github.com/godotengine/godot-blender-exporter)
- [Better collada plugin for Blender](https://github.com/HungryProton/collada-exporter-2.8)

æŠ˜å°„ Refraction æ˜¯é€æ˜æè´¨çš„åŸºæœ¬å±æ€§ï¼ŒGodot ç€è‰²å™¨å¯ç”¨æŠ˜å°„åï¼Œå®ƒå°†å–ä»£ alpha æ··åˆï¼Œæ­¤æ—¶æ ‡å¿—ä½
Flags - Transparent å°†æ— æ³•ä½¿ç”¨ Albedo é¢œè‰²ä¸­çš„é€æ˜é€šé“ã€‚

Godot æŠ˜å°„å¤„ç†å°†å°è¯•ä»æ­£åœ¨æ¸²æŸ“çš„å¯¹è±¡åé¢è·å–ä¿¡æ¯ï¼Œè¿™å…è®¸ä»¥ä¸ç°å®ç”Ÿæ´»ä¸­çš„æŠ˜å°„ç±»ä¼¼çš„æ–¹å¼æ‰­æ›²é€æ˜åº¦ã€‚

é™¤äº†ä»¥ä¸Šä¸¤ç§æè´¨è®¾ç½®ï¼ŒParameters - Blend Mode è®¾ç½® Mix ä¹‹å¤–çš„æ··åˆæ¨¡å¼ä¹Ÿä¼šæœ‰ç±»ä¼¼é€æ˜çš„æ•ˆæœã€‚



### ğŸŸ ğŸ”µ Displacemnet & Terrain è½¬æ¢è´´å›¾ä¸åœ°å½¢
- [Your 1st 3D shader](https://docs.godotengine.org/en/latest/tutorials/shaders/your_first_shader/your_first_3d_shader.html)
- [Your 2nd 3D shader](https://docs.godotengine.org/en/latest/tutorials/shaders/your_first_shader/your_second_3d_shader.html)
- [Spatial shader](https://docs.godotengine.org/en/latest/tutorials/shaders/shader_reference/spatial_shader.html)
- [Multiple resolutions](https://docs.godotengine.org/en/latest/tutorials/rendering/multiple_resolutions.html)
- [Setting up the game area](https://docs.godotengine.org/en/stable/getting_started/first_3d_game/01.game_setup.html)
- [The OpenGLÂ® Shading Language, v4.60.7](https://github.com/KhronosGroup/OpenGL-Registry/tree/main/specs/gl/GLSLangSpec.4.60.html)
- [ã€Godotæ•™ç¨‹ã€‘é¡¶ç‚¹åŠ¨ç”»çº¹ç†](https://www.bilibili.com/video/BV14A411Z7gb/)
- [Houdini - Vertex Animation Textures (VAT)](https://www.vfxforce.cn/archives/16033)
- [Using VisualShaders](https://docs.godotengine.org/en/latest/tutorials/shaders/visual_shaders.html)
- [Using compute shaders](https://docs.godotengine.org/en/latest/tutorials/shaders/compute_shaders.html)
- [Heightmap terrain 1.6.1](https://godotengine.org/asset-library/asset/231)
- [HeightMap terrain for Godot](https://github.com/Zylann/godot_heightmap_plugin)
- [Heightmap terrain åœ°å½¢åˆ¶ä½œ](https://www.bilibili.com/video/BV1uf4y1k7LF/)
- [HTerrain plugin](https://hterrain-plugin.readthedocs.io/en/latest/)
- [HTerrain plugin demo project in Godot Engine 3](https://github.com/Zylann/godot_hterrain_demo)
- [Voxel Tools for Godot](https://github.com/Zylann/godot_voxel)
- [Voxel Tools docs](https://voxel-tools.readthedocs.io/en/latest/)
- [Game Demos for Voxel Tools for Godot](https://github.com/Zylann/voxelgame)
- [Solar System Game Demo](https://github.com/Zylann/solar_system_demo)
- [Tree generator plugin for Godot 3.2.4](https://github.com/Zylann/godot_tree_generator_plugin)
- https://github.com/TheGodojo/Massive-Terrain-LOD-And-Stitching-COMPLETE
- https://github.com/TheGodojo/Instant-Massive-Infinite-Terrain-Clipmap-Collisions-COMPLETE
- [Godot 4 ç€è‰²å™¨åœ°å½¢å®æ—¶ç”Ÿæˆï¼šLODå’Œç½‘æ ¼æ‹¼æ¥](https://www.bilibili.com/video/BV1iR4y1f76Q)
- https://github.com/Chevifier/Inifinte-Terrain-Generation
- https://github.com/clayjohn/godot-volumetric-cloud-demo
- https://godotengine.org/article/emulating-double-precision-gpu-render-large-worlds/

ç½®æ¢è´´å›¾æ˜¯åœ°å½¢åˆ¶ä½œçš„åŸºæœ¬å·¥å…·ï¼Œåœ¨ GPU æ¸²æŸ“ç®¡çº¿ä¸Šï¼Œé¡¶ç‚¹ç€è‰²å™¨æ˜¯å¤„ç†å‡ ä½•ä½“åŸå§‹ä¿¡æ¯çš„å·¥å…·ï¼Œé€šè¿‡ä¿®æ”¹é¡¶ç‚¹
åæ ‡ï¼Œä½¿ç”¨åŸå…ˆçš„å¹³é¢å‡ ä½•ä½“äº§ç”Ÿä»»ä½•å¸Œæœ›çš„æ•ˆæœã€‚ç»“åˆå™ªå£°çº¹ç†ï¼Œæ ¹æ®å…¶åƒç´ çš„ç°åº¦å€¼æ¥ä¿®æ”¹é¡¶ç‚¹çš„é«˜åº¦åæ ‡ï¼Œ
å°±å¯ä»¥ä½¿ç”¨å¹³é¢æŒ‰ç…§å™ªå£°çº¹ç†éš†èµ·ï¼Œæˆ–è€…å‡¹é™·ï¼Œå½¢æˆé€¼çœŸçš„åœ°å½¢ã€‚

é¡¶ç‚¹åŠ¨ç”»çº¹ç†ä¹Ÿæ˜¯è¿™ç§ç›´æ¥æ§åˆ¶é¡¶ç‚¹çš„å¼€å‘æŠ€æœ¯ï¼ŒVertex Animation Textures (VAT) å°±æ˜¯å°†æ›²é¢é¡¶ç‚¹
çš„è¿åŠ¨æ•°æ®ï¼šåæ ‡ã€æ³•çº¿ä¿å­˜åˆ°å›¾åƒæ–‡ä»¶ä¸­ï¼Œå¦‚æœä½¿ç”¨æ³•çº¿è´´å›¾æ ¼å¼åˆ™è¿˜éœ€è¦åˆ‡çº¿å‘é‡ï¼Œåœ¨å¼•æ“ä¸­é€šè¿‡ç€è‰²å™¨
å°†åˆ¶ä½œå¥½çš„åŠ¨ç”»çº¹ç†é‡ç°ä¸ºæ¨¡å‹åŠ¨ç”»ã€‚


Godot æè´¨ä¸­ Height ç”¨äºå¯ç”¨è§†å·®é«˜åº¦è´´å›¾ï¼Œç±»ä¼¼ Normal Mapping éƒ½æ˜¯ç”¨äºæ”¹å˜è¡¨é¢å…‰çº¿ç»†èŠ‚çš„è´´å›¾ã€‚
Godot 3.5 ä¸­ä½¿ç”¨ Depth å±æ€§è¡¨ç¤ºè§†å·®è´´å›¾ã€‚

å¦ä¸€ç§ç”¨äºåœ°å½¢åˆ¶ä½œçš„ç½®æ¢è´´å›¾ï¼ŒDisplacement Mappingï¼ŒGodot æ²¡æœ‰ç›´æ¥åœ¨æè´¨ä¸­æä¾›è®¾ç½®ï¼Œè€Œåªèƒ½
é€šè¿‡ç€è‰²å™¨æ¥å®ç°ï¼Œå³éœ€è¦åˆ›å»ºç€è‰²å™¨æè´¨ï¼Œå¯¹å‡ ä½•ä½“çš„é¡¶ç‚¹è¿›è¡Œç›´æ¥å¤„ç†ã€‚

ç»™åœºæ™¯æ·»åŠ  MeshInstance3D èŠ‚ç‚¹ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºä¸€ä¸ª PlaneMesh å¹³é¢å‡ ä½•ä½“ï¼Œç„¶åä¸ºå…¶åˆ›å»ºç€è‰²å™¨æè´¨ï¼Œ
ç‚¹å‡» ShaderMaterial æ‰“å¼€ç€è‰²å™¨è®¾ç½®ï¼Œåœ¨ Shader å±æ€§ä¸­åˆ›å»ºä¸€ä¸ª `Shader` å³ç€è‰²å™¨ç¨‹åºã€‚æˆ–è€…ï¼Œ
å¯ä»¥ä½¿ç”¨ `VisualShader` è¿›è¡Œå¯è§†åŒ–ç€è‰²å™¨ç¼–ç¨‹ã€‚

Godot æä¾›äº† GLSL ç¼–ç¨‹æ¥å£ï¼Œä¸æºå§‹çš„ OpenGL ç€è‰²å™¨ç¼–ç¨‹ä¸åŒçš„æ˜¯ï¼Œç›´æ¥åœ¨å•ä¸ªç€è‰²å™¨ç¨‹åºä¸­ç¼–å†™ï¼š

- Vertex Shader é¡¶ç‚¹ç€è‰²å™¨ï¼š`void vertex() { ... }`
- Fragment Shader ç‰‡æ®µç€è‰²å™¨ï¼š`void fragment() { ... }`
- Lighting å…‰ç…§å¤„ç†å‡½æ•°ï¼›ï¼š`void light() { ... }`

ä½¿ç”¨å¯è§†åŒ–ç€è‰²å™¨ç¼–ç¨‹çš„ä¸€ä¸ªå¥½å¤„æ˜¯æ›´ç›´è§‚ï¼Œç›´æ¥é€šè¿‡å›¾å½¢ç•Œé¢å°±å¯ä»¥ç”Ÿæˆç€è‰²å™¨ä»£ç ï¼Œé€šè¿‡èŠ‚ç‚¹è¿æ¥å®ç°å’Œå„ç§
ç€è‰²å™¨æ•°æ®çš„èµ‹å€¼ã€‚é€šè¿‡é€‰æ‹©è¦ç¼–å†™çš„ç€è‰²å™¨ï¼Œæ‰€æœ‰å¯ç”¨çš„è¾“å‡ºå˜é‡å°±ç›´æ¥æ˜¾ç¤ºåœ¨ Output èŠ‚ç‚¹ä¸­ã€‚

èŠ‚ç‚¹åŒ–ç¼–ç¨‹å’Œä»£ç ç¼–è¾‘æ–¹å¼æœ‰æ€è·¯å±‚é¢çš„å·®å¼‚ï¼Œæ¯”å¦‚ä»£ç ä¸­ä½¿ç”¨ uniform æ¥å®šä¹‰å…¨å±€å˜é‡æ¥è¾“å‡ºçº¹ç†èµ„æºï¼Œ
åœ¨å¯è§†ç¼–ç¨‹ä¸­ï¼Œåªéœ€è¦æ”¾ç½®ä¸€ä¸ª Texture èŠ‚ç‚¹ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»ºç›¸åº”çš„ uniform å˜é‡ã€‚ä½†æ˜¯èµ„æºæ•°æ®çš„ä½¿ç”¨
æ–¹å¼æ˜¯æœ‰å¾ˆå¤§å·®åˆ«çš„ã€‚å¯ä»¥ä½¿ç”¨ `Expression` æˆ–è€… `GlobalExpression` èŠ‚ç‚¹ç¼–å†™ GLSL ä»£ç ï¼Œå®ƒä»¬
åˆ†åˆ«ä¼šåœ¨ç€è‰²å™¨å…¨å±€ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸä¸­ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚

æœ€æ–°æ¨å‡ºçš„ compute shaders åˆ™éœ€è¦ä½¿ç”¨åº•å±‚çš„ `RenderingDevice` è®¿é—® Vulkan API æ¥å®ç°ã€‚


åœ¨åˆ›å»ºæè´¨æ—¶ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œå¯ä»¥ç»™ MeshInstance3D å‡ ä½•èŠ‚ç‚¹æˆ–è€… Mesh èµ„æºé™„åŠ æè´¨ï¼Œä¸¤è€…éƒ½é€šç”¨ã€‚

ç„¶åç‚¹å‡»ç€è‰²å™¨æ‰“å¼€å®ƒï¼Œåœ¨å…¶å±æ€§é¢æ¿ä¸­ï¼Œå¯ä»¥é€šè¿‡å·¥å…·èœå• Save å°†ç€è‰²å™¨ä¿å­˜åˆ°æ–‡ä»¶ä¸­è¿›è¡Œç¼–è¾‘ã€‚

ä¸ºäº†è®© PlaneMesh å¯ä»¥è¡¨ç°å‡¹å‡¸æ›²é¢ï¼Œéœ€è¦å¯¹å¹³é¢è¿›è¡Œç»†åˆ†ï¼Œè®©å®ƒæ‹¥æœ‰æ›´å¤šçš„é¡¶ç‚¹ï¼Œè€Œä¸æ˜¯åªæœ‰ 4 ä¸ªé¡¶ç‚¹ã€‚
Subdivision Width/Depth è®¾ç½®åˆé€‚çš„å€¼ï¼Œæ¯”å¦‚ 256ã€‚ä¸ºä½•æŸ¥çœ‹ç»†åˆ†çš„æ•ˆæœï¼Œå¯ä»¥æ‰“å¼€çº¿æ¡†è§†å›¾åŠŸèƒ½ï¼Œ
Perspective -> Display Wireframeï¼Œè¿™æ ·å°±ä¼šå°†ç»†åˆ†çš„è¾¹çº¿æ˜¾ç¤ºå‡ºæ¥ã€‚

ä»¥ä¸‹è¦å®ç°è¿™ä¸ªç®€å•çš„åœ°å½¢ç€è‰²å™¨åŒ…å«å†…å®¹ï¼š

- ä¸€ä¸ªå™ªå£°çº¹ç†ï¼Œé€šè¿‡ NoiseTexture åŠ è½½ OpenSimplexNoise æˆ–è€…æ–°ç‰ˆæœ¬çš„ FastNoiseLiteï¼›
- ä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨å¤„ç†å‡½æ•° `void vertex()`ï¼›
- ä½¿ç”¨ä¸€ä¸ª GLSL `texture()` çº¹ç†é‡‡æ ·å‡½æ•°ï¼›
- å®šä¹‰ä¸€äº›å…¨å±€çš„ç€è‰²å™¨å˜é‡ï¼Œç”¨äºåœ°å½¢çš„æµ·æ‹”é«˜åº¦åç§»ã€åœ°å½¢çº¹ç†ç¼©æ”¾ï¼Œé«˜åº¦å·®æ”¾å¤§ç­‰ç­‰ï¼›

ç€è‰²å™¨ä¸­éœ€è¦ä½¿ç”¨ GLSL `texture()` çº¹ç†é‡‡æ ·å‡½æ•°ï¼Œå…¶è¿”å›å€¼åŒ…å«æŒ‡å®šåæ ‡ä¸Šçš„åƒç´ å€¼ RGBAã€‚å¯¹äºç°åº¦
çº¹ç†æ¥è¯´ï¼ŒRGB ä¸‰åˆ†é‡æ˜¯ç­‰å€¼çš„ï¼Œè€Œé€æ˜åº¦åˆ†é‡ Alpha = 1ã€‚

éœ€è¦æ³¨æ„ï¼š

- æ–°åˆ›å»ºçš„ PlaneMesh é¡¶ç‚¹åæ ‡å€¼ä¸º [-1,1] èŒƒå›´ï¼Œå¹³é¢ä¸­å¿ƒä¸ºé›¶ç‚¹ï¼Œå¤§å°ä¸º 2x2ï¼Œè€Œ UV åæ ‡èŒƒå›´æ€»æ˜¯ [0,1]ã€‚
- Godot ä¸­çš„ XYZ ä¸‰è½´ï¼Œçº¢ç»¿è“ä¸‰è‰²å¯¹åº”ï¼ŒY æ˜¯å‚ç›´æ–¹å‘ï¼ŒXZ æ‰æ˜¯åœ°å¹³é¢ã€‚

3D ç¯å¢ƒä¸­ï¼Œå¹³ç§»ã€Size ç­‰ä½¿ç”¨ç±³åˆ¶å•ä½ï¼Œ1 è¡¨ç¤º 1 ç±³ï¼Œåˆ›å»ºå™ªå£°çº¹ç†ä½¿ç”¨çš„æ˜¯åƒç´ ã€‚å¯ä»¥ä½¿ç”¨ä¸‰è§’å‡½æ•°å»è§‚æµ‹
PlaneMesh ç»†åˆ†åçš„é¡¶ç‚¹åæ ‡å˜åŒ–ã€‚ä¸‰è§’å‡½æ•°çš„å‘¨æœŸæ˜¯ 2PIï¼Œå¯¹äºä¸€ä¸ª 20x20 å¤§å°çš„å¹³é¢ï¼Œå®ƒåœ¨ä¸¤ä¸ªç»´åº¦ä¸Š
å°±æœ‰ 3 ä¸ªå¤šçš„ä¸‰è§’å‡½æ•°å‘¨æœŸçš„å˜åŒ–ã€‚

åœ¨ç€è‰²å™¨ä¸­å®šä¹‰çš„ uniform å…¨å±€å˜é‡ï¼ŒGodot ä¼šè¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”åœ¨ ShaderMaterial é¢æ¿ä¸­æä¾›è®¾ç½®æ“ä½œï¼Œ
åˆ†ç»„åœ¨ Shader Paramsã€‚æ³¨æ„ï¼Œå¦‚æœç€è‰²å™¨ç¨‹åºæœ‰è¯­æ³•é”™è¯¯æ—¶ï¼Œå‚æ•°å°±ä¸ä¼šæ˜¾ç¤ºåœ¨å‘å±•é¢æ¿ä¸­ã€‚

```c
shader_type spatial;

uniform sampler2D height_map;
uniform float scale = 1.0;
uniform float multiply = 1.0;
uniform float offset = -0.5;
uniform vec2 translation = vec2(0,0);

float height(vec2 pos) {
    //return sin(pos.x) + cos(pos.y);
    return (length(texture(height_map, pos / scale + translation)) + offset) * multiply;
}

void vertex() {
    VERTEX.y += height(VERTEX.xz);
}
```

ç»è¿‡ä»¥ä¸Šæ“ä½œå¾—åˆ°çš„åœ°å½¢è¿˜åªæ˜¯åœç•™åœ¨æ›²é¢çš„é˜¶æ®µï¼Œå¯¹äºä¸€ä¸ªèƒ½åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„åœ°å½¢ï¼Œè¿˜ä¼šéœ€è¦æ›´å¤šçš„åŠŸèƒ½ã€‚
ç»¿æ¤è£…é¥°ã€å…‰ç…§æ•ˆæœç­‰ç­‰åŸºç¡€æè´¨å±æ€§ï¼Œè¿˜è¦æä¾›ç¢°æ’æ£€æµ‹ç­‰ç­‰åŠŸèƒ½ã€‚

å…‰ç…§å¤„ç†æ¶‰åŠåˆ°æ³•çº¿ï¼Œä¸­å­¦çš„ç‰©ç†å®šä¹‰ï¼Œå…‰çº¿æ˜¯ç›´çº¿ä¼ æ’­çš„ï¼Œåå°„å…‰åˆ™ä¸è¡¨é¢æ³•çº¿å‘é‡å½¢æˆå’Œå…¥å°„è§’ç›¸ç­‰çš„å¤¹è§’ã€‚
å½“å‰çš„åœ°å½¢è™½ç„¶ç»è¿‡åŸºæœ¬çš„é¡¶ç‚¹ç½®æ¢å¤„ç†ï¼Œå¾—åˆ°äº†ä¸åœ°é¢ä¸€æ ·èµ·ä¼çš„æ›²é¢ã€‚ä½†æ˜¯ï¼Œå…¶æ³•çº¿è¿˜æ˜¯å’ŒåŸæ¥æ–°åˆ›å»ºçš„
PlaneMesh ä¸€æ ·ï¼Œå³æ‰€æœ‰ç»†åˆ†å‡ºæ¥çš„ç‰‡é¢éƒ½æ‹¥æœ‰ä¸€æ ·çš„æ³•çº¿ã€‚å½“å…‰çº¿ç…§å°„åˆ°è¿™ä¸ªæ›²é¢æ—¶ï¼Œå…‰ç…§æ•ˆæœå’Œç…§åœ¨å¹³é¢ä¸Š
æ²¡æœ‰ä¸¤æ ·çš„ï¼

åœ¨åœºæ™¯ä¸Šæ·»åŠ ä¸€ä¸ªç¯å…‰èŠ‚ç‚¹ï¼Œæ•£å…‰ç¯æˆ–ç›´å°„å…‰éƒ½å¯ä»¥ï¼ŒDirectionalLightï¼ŒOmniLightã€‚ç„¶åæ‰“å¼€æ³•çº¿è§†å›¾
Perspective -> Display Normalï¼Œå°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªé—®é¢˜ï¼Œé¢æ²¡æœ‰æ˜æš—å·®å¼‚ã€‚å¦‚æœæ·»åŠ æ•£å…‰ç¯ï¼Œæ›²é¢çš„æ˜æš—
å˜åŒ–åªè·Ÿå…‰æºçš„è·ç¦»æœ‰å…³ï¼Œè€Œä¸æ›²é¢çš„æœå‘æ— å…³ã€‚

æ³•çº¿æ•°æ®ä¿å­˜åœ¨ Mesh èµ„æºä¸­ï¼Œå‰é¢çš„ç€è‰²å™¨åªæ˜¯ä¿®æ”¹äº†é¡¶ç‚¹åæ ‡ï¼Œè€Œæ²¡æœ‰å¤„ç†æ³•çº¿ä¿¡æ¯ï¼Œä½¿å¾—æ³•çº¿é”™è¯¯ã€‚
ä¿®å¤æ³•çº¿æœå‘æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

- ä¿®æ”¹ç€è‰²å™¨å†…ç½®çš„ `NORMAL` æˆ–è€… `NORMAL_MAP` å‘é‡ï¼›
- ä½¿ç”¨å‘é‡è´´å›¾ä¿®æ­£æ³•çº¿ï¼›

åœ¨å™ªå£°ç¨‹åºçº¹ç†å·¥å…·ä¸­ï¼Œå¯ä»¥æŒ‰åŒæ ·çš„æ–¹å¼ç”Ÿæˆæ³•çº¿è´´å›¾ï¼Œå³å’Œçº¹ç†è´´å›¾ä¸€è‡´çš„æ³•çº¿ä¿¡æ¯ï¼ŒNoise Texture
é¢æ¿ä¸­å‹¾é€‰ As Normal Map é€‰é¡¹å³ç”Ÿæˆæ³•çº¿è´´å›¾ã€‚

ç”±äºçº¹ç†ä½¿ç”¨çš„æ˜¯ 8-bit é¢œè‰²æ·±åº¦ï¼Œç²¾åº¦ä¸è¶³å¯¼è‡´â€œç­‰é«˜çº¿ç°è±¡â€ï¼Œå¯ä»¥é™ä½ Bump Strength å±æ€§å‡ç¼“ï¼Œ
æ›´å¥½çš„åŠæ³•æ˜¯ä½¿ç”¨ EXRã€TTFã€TGA ç­‰æ”¯æŒ 16-bit ä»¥ä¸Šçš„å›¾åƒæ ¼å¼ã€‚

åœ¨æ¸²æŸ“æµæ°´çº¿ä¸Šï¼Œé¡¶ç‚¹å¤„ç†å’Œæ³•çº¿å¤„ç†ä½¿ç”¨ä¸åŒçš„ç€è‰²å™¨ï¼Œé¡¶ç‚¹ç€è‰²å™¨ä¸€èˆ¬ä¸“ç”¨äºé¡¶ç‚¹å¤„ç†ã€‚æ³•çº¿å¤„ç†å¯ä»¥åœ¨ç‰‡æ®µ
ç€è‰²å™¨ä¸­å¤„ç†ã€‚å¦‚æœä½¿ç”¨ OpenGL APIï¼Œåˆ™éœ€è¦åŠ è½½ä¸¤ä¸ªç€è‰²å™¨ç¨‹åºã€‚åœ¨ Godot ä¸­å·²ç»å¤„ç†å¥½ç€è‰²å™¨çš„åŠ è½½ï¼Œ
åªéœ€è¦åœ¨åŒä¸€ç›¸ç€è‰²å™¨ç¨‹åºä¸­ç¼–å†™ `void fragment()` å‡½æ•°å³å¯ã€‚

OpenGL Shading Language æ‰‹å†Œç®€åŒ– GPU æ¸²æŸ“æµæ°´çº¿å¦‚ä¸‹ï¼Œå¼€å‘è€…ä¸»å‚ä¸ä¸¤ä¸ªé˜¶æ®µï¼š

1. **Vertex Processor**
2. Tessellation Control Processor
3. Tessellation Evaluation Processor
4. Geometry Processor
5. **Fragment Processor**
6. Compute Processor

GLSL ç€è‰²å™¨è¯­è¨€ä»è¯­æ³•ä¸Šè®²ï¼Œå’Œ C è¯­è¨€æ— å¼‚ï¼ŒåŸºæœ¬æ•°æ®ç±»ä¼¼ä¹Ÿä¸€æ ·ã€‚ä½†æ˜¯ä½œä¸º GPU ç€è‰²å™¨ï¼Œå®ƒæä¾›äº†å¤§é‡
å‘é‡ã€çŸ©é˜µã€çº¹ç†ç­‰æ•°æ®ç±»å‹ï¼Œå¹¶ä¸”åŸºäºå®ƒä»¬æä¾›äº†ä¸°å¯Œçš„ APIã€‚GLSL å®é™…ä¸Šæ˜¯å‡ ç§å¯†åˆ‡ç›¸å…³çš„è¯­è¨€ï¼Œè¿™äº›è¯­è¨€
ç”¨äºä¸º API å¤„ç†ç®¡é“ä¸­åŒ…å«çš„æ¯ä¸ªå¯ç¼–ç¨‹å¤„ç†å™¨åˆ›å»ºç€è‰²å™¨ã€‚å› æ­¤ï¼Œç¼–ç¨‹æ¨¡å‹å®Œå…¨ä¸ C è¯­è¨€ç¼–ç¨‹ä¸ä¸€æ ·ã€‚å®˜æ–¹
æ–‡æ¡£ä»“åº“ä¸­åŒ…å«ä¸€ä¸ªå•é¡µé¢çš„è¯­è¨€æ‰‹å†Œ GLSLangSpec.4.60.htmlã€‚

å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œ**é¡¶ç‚¹ç€è‰²å™¨**ä¸**ç‰‡æ–­ç€è‰²å™¨**æ˜¯ä¸¤ä¸ª GPU ç¨‹åºï¼Œè™½ç„¶åœ¨ Godot ä¸­ä½¿ç”¨åŒä¸€ä¸ªç€è‰²å™¨
ä»£ç æ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªç€è‰²å™¨ä¼šåœ¨ GPU æ¸²æŸ“æµæ°´çº¿ä¸Šä¾å·¥åºæ‰§è¡Œå¤„ç†ï¼Œä¸ºäº†å°†é¡¶ç‚¹ç€è‰²å™¨çš„æ•°æ®ä¼ é€’ç»™ç‰‡æ–­ç€è‰²å™¨ï¼Œ
GPU ç¼–ç¨‹ä¸­æä¾›äº† varying å˜é‡ï¼Œ

GLSL çš„ä¸€å¤§ç‰¹è‰²å°±æ˜¯æœ‰å„ç§ä¿®é¥°ç¬¦å·æ¥å†³å®šå˜é‡çš„ä½¿ç”¨è§„åˆ™ï¼Œå‚è€ƒä¿®é¥°ç¬¦è¯´æ˜ã€‚uniform ä¸ varying å¾ˆ
å¤§ä¸åŒåœ¨äºï¼Œå‰è€…åœ¨å¤„ç†ä¸€ä¸ªåŸºæœ¬ä½“çš„è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œç”¨æ¥é“¾æ¥ CPU è¿è¡Œçš„ç¨‹åºä¸ GPU è¿è¡Œçš„ç€è‰²å™¨ã€‚
åè€…åˆ™æ›´åƒæ˜¯ä¸€èˆ¬çš„ C è¯­è¨€å˜é‡ï¼Œå¯ä»¥åœ¨ç€è‰²å™¨ç¨‹åºä¸­æ”¹å˜å®ƒçš„å€¼ï¼Œå¹¶å®ç°ä¸åŒç€è‰²é˜¶æ®µä¸­çš„æ•°æ®ä¼ é€’ã€‚

å­˜å‚¨ä¿®é¥°ç¬¦ Storage Qualifiers [4.3]

- `none` (Default) local read/write memory, or input parameter.
- `const` Compile-time constant, or read-only function parameter.
- `attribute` Linkage between a vertex shader and OpenGL ES for per-vertex data.
- `uniform` Value does not change across the primitive being processed, uniforms form the linkage between a shader, OpenGL ES, and the application.
- `varying` Linkage between a vertex shader and fragment shader for interpolated data.

å‚æ•°ä¿®é¥°ç¬¦ Parameter Qualifiers [4.4]

- `none` (Default) same as `in`.
- `in` For function parameters passed into a function.
- `out` For function parameters passed back out of a function, but not initialized for use when passed in.
- `inout` For function parameters passed both into and out of a function.

è¾“å…¥å‚æ•°åœ¨è°ƒç”¨å‡½æ•°æ—¶å¤åˆ¶ä¼ å…¥ï¼Œè¾“å‡ºå‚æ•°åœ¨å‡½æ•°è¿”å›æ—¶å¤åˆ¶è¾“å‡ºå€¼ã€‚å…¶å®ƒä¿®é¥°ç¬¦å‚è€ƒå®˜æ–¹æ‰‹å†Œã€‚

æœ—ä¼¯ç…§æ˜ç†æƒ³é•œé¢æ•£å°„å…‰æ¨¡å‹ï¼Œè¡¨é¢ä¸å¸æ”¶ä»»ä½•å…¥å°„å…‰ï¼ŒLambertian lighting model å®ç°å¦‚ä¸‹ï¼ŒGodot
ç€è‰²å™¨ä¸­æä¾›äº†å…‰ç…§å‡½æ•°å®šä¹‰ï¼Œé€šè¿‡ä¿®æ”¹è¿™ä¸ªå‡½æ•°å¯ä»¥å®ç°è‡ªå·±çš„å…‰ç…§æ•ˆæœï¼š

```C++
void light() {
    DIFFUSE_LIGHT += clamp(dot(NORMAL, LIGHT), 0.0, 1.0) * ATTENUATION * ALBEDO;
}
```

åœ¨ä¸»å…‰æºå…‰å¼ºåº¦ä¸º 1.0 çš„æ¡ä»¶ä¸‹ï¼ŒALBEDO çº¹ç†ä¼šæŒ‰ä»¥ä¸Šç®—æ³•ä¸æ³•çº¿ã€å…¥å°„å…‰æ–¹å‘ï¼Œè¡°å‡ç³»æ•°ç­‰å› ç´ ä¸‹ç”Ÿæˆ
æ¨¡å‹è¡¨é¢çš„æ¼«å°„å…‰æ•ˆæœï¼Œé€šè¿‡è°ƒæ•´åŸºæœ¬è‰²è¾“å…¥æ¥è°ƒæ•´æœ€ç»ˆæ•ˆæœã€‚





## ğŸŸ¡ 2D Animation å¹³é¢åŠ¨ç”»
- [Animation Retargeting in Godot 4.0](https://godotengine.org/article/animation-retargeting-in-godot-4-0)
- [Movie Maker mode arrives in Godot 4.0](https://godotengine.org/article/movie-maker-mode-arrives-in-godot-4)
- [Creating movies](https://docs.godotengine.org/en/latest/tutorials/animation/creating_movies.html)
- [How to make your bullets look awesome in Godot - Advanced Trails](https://www.bilibili.com/video/BV1iA411A7gz/)


### ğŸŸ ğŸ”µ TileMap ç“¦ç‰‡åœ°å›¾
- [Abstract Platformer](https://kenney.nl/assets/abstract-platformer)
- [Godot Advanced Trails Examples](https://github.com/RPicster/Godot-Advanced-Trails-Examples)
- [Using TileMaps](https://docs.godotengine.org/en/3.6/tutorials/2d/using_tilemaps.html)
- [Using GridMaps](https://docs.godotengine.org/en/latest/tutorials/3d/using_gridmaps.html)

å®˜æ–¹æ–‡æ¡£æ¨èäº†ä¸€ä¸ªåŠ¨ç”»èµ„æº Abstract Platformerï¼Œè¿™ç»„èµ„æºå¯ä»¥ç”¨æ¥åš TileMapã€AnimatedSprite
ä¹‹ç±»çš„åŠ¨ç”»æ¼”ç¤ºã€‚æˆ–è€…ï¼Œä½¿ç”¨å®˜æ–‡å±•ç¤ºçš„ä¸€ç»„é’è›™ Spritesï¼š

![Frog Spritesheet](https://docs.godotengine.org/en/3.5/_images/2d_animation_frog_spritesheet.png)

TileMap ç“¦ç‰‡åœ°å›¾æ˜¯ 2D æ¸¸æˆå¸¸è§çš„æŠ€æœ¯ï¼Œé€šè¿‡å®šä¹‰ç“¦ç‰‡å›¾é›† TileSetï¼Œå°±æ˜¯å°†å›¾ç‰‡æŒ‰åŒºåŸŸåˆ’åˆ†æœ€å°çš„åŒºå—ï¼Œ
ç„¶åï¼Œå†ç”¨ç±»ä¼¼ç»˜ç”»çš„æ–¹å¼ä¸€æ ·ï¼Œå°†ç“¦ç‰‡å›¾ç»˜åˆ¶åˆ° TileMap ä¸Šï¼Œæœ€åå¾—åˆ°çš„ä¸€ä¸ªæ¸¸æˆå…³å¡åœ°å›¾ã€‚æŠ€æœ¯ä¸Šæ¥è®²ï¼Œ
TileMap å°±æ˜¯ä¸€ä¸ªæŒ‰æ ¼å­åˆ†å‰²çš„åŒºåŸŸï¼Œç”¨æ ¼å­çš„å½¢å¼æ¥è®°å½•ä»€ä¹ˆä½ç½®çš„æ ¼å­è¦ç»˜åˆ¶ä»€ä¹ˆå›¾åƒã€‚

TileMap ä¸­çš„å›¾åƒå¸¸é‡‡ç”¨æ–œè§’åœ°å›¾çš„å½¢å¼ï¼Œå³ Isometric Viewï¼Œå³ç­‰è·è§†è§’ä¸‹çš„åœ°å›¾ï¼Œå’Œé€è§†ç›¸å¯¹ï¼Œæ˜¯æŒ‡
è§†é‡å†…çš„ç‰©ä½“ï¼Œæ— è®ºè¿œè¿‘éƒ½ç”¨åŒä¸€å¤§å°æ¥è¡¨ç°ï¼Œè€Œç»˜ç”»ä¸­å¸¸ç”¨çš„é€è§† Perspective å´æ˜¯è¿œå°è¿‘å¤§ã€‚

ä½¿ç”¨å¤šä¸ª TileMap å¯ä»¥åœ¨åŒä¸€å—ä½ç½®æ·»åŠ å¤šå¼ å›¾åƒï¼Œä»¥å¾—åˆ°åˆé€‚çš„åœºæ™¯ã€‚

![TileMap Tool](https://docs.godotengine.org/en/3.6/_images/tilemap_tool.png)

ç‚¹å‡»æ‰“å¼€ç¼–è¾‘ç•Œé¢ï¼Œä¸º TileMap åˆ›å»ºæ–°çš„ç“¦ç‰‡é›†ï¼Œåœ¨ TileSet ä¸­å¯¼è‡´å›¾åƒç­‰èµ„æºï¼Œå¹¶å°†å…¶åˆ†å‰²æˆç“¦ç‰‡å›¾ã€‚
å¯ä»¥æ¯æ¬¡ä¸€å¼ å›¾åƒä½œä¸ºä¸€ä¸ªç“¦ç‰‡å¯¼å…¥ï¼Œä¹Ÿå¯ä»¥å°†ä¸€å¼ å›¾ç‰‡åˆ†å‰²æˆå¤šä¸ªç“¦ç‰‡ï¼Œæ–¹æ ¼åŒ–æ‰¹é‡æ–¹å¼ç§°ä¸º Atlas tilesã€‚

å…ˆå°†æºå›¾ç‰‡å¯¼å…¥ç“¦ç‰‡é›†ä¸­ï¼Œç„¶åç‚¹å‡» New Single Tile åˆ›å»ºç¬¬ä¸€ä¸ªç“¦ç‰‡ï¼Œé€šè¿‡æ‹–åŠ¨å‡ºä¸€ä¸ªçŸ©å½¢åŒº Region
å®šä¹‰å¥½è¿™ä¸ªç“¦ç‰‡æ‰€ä½¿ç”¨çš„å›¾åƒåŒºåŸŸã€‚è¦ç¼–è¾‘å·²æœ‰çš„ç“¦ç‰‡ï¼Œç‚¹å‡» Edit è¿›è¡Œç¼–è¾‘çŠ¶æ€ï¼Œç‚¹å‡»éœ€è¦ç¼–è¾‘çš„ç“¦ç‰‡ï¼Œç„¶å
æ‹–åŠ¨é¼ æ ‡é‡æ–°å®šä¹‰ç“¦ç‰‡åŒºåŸŸã€‚ç“¦ç‰‡çš„å…¶å®ƒå±æ€§ï¼Œå¦‚åç§°ç­‰ï¼Œå¯ä»¥åœ¨å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸­è®¾ç½®ã€‚

æœ‰äº†ç¬¬ä¸€å—ç“¦ç‰‡ï¼Œå°±å¯ä»¥å°†å®ƒç»˜åˆ¶åˆ° TileMap ä¸­çš„ç½‘æ ¼ä¸Šäº†ã€‚

å¯¹äºä»£è¡¨ç©å®¶ä¸èƒ½ç©¿è¶Šçš„åŒºåŸŸï¼Œå¯ä»¥ç»™ç“¦ç‰‡è®¾ç½®ç¢°æ’æ£€æµ‹åŒºï¼Œåœ¨ç“¦ç‰‡ç¼–è¾‘çŠ¶æ€ä¸‹ï¼Œç‚¹å‡» Collision å®šä¹‰ä¸€ä¸ª
çŸ©å½¢ï¼Œæˆ–è€…å¤šè¾¹å½¢ä½œä¸ºç¢°æ’æ£€æµ‹æ—¶çš„å‚è€ƒåŒºã€‚

é®æŒ¡ã€å¯¼èˆªå½¢çŠ¶åŒºåŸŸå®šä¹‰ç”¨äº AI å¯»è·¯å¯¼èˆªä½¿ç”¨ã€‚

CanvasItem èŠ‚ç‚¹é€šè¿‡ y_sort_enabled å¯ä»¥å¯ç”¨æ¸²æŸ“æ’åºï¼Œæ­£ç¡®è§£å†³ç‰©ä½“çš„å‰åé®æŒ¡å…³ç³»ã€‚æ—§ç‰ˆæœ¬ä¸­ä½¿ç”¨
TileMap.cell_y_sort å±æ€§ã€‚


é™¤äº†ä»¥ä¸Š Single Tile æ–¹å¼å•ä¸ªåœ°åˆ›å»ºç“¦ç‰‡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä¹‰ç“¦ç‰‡ï¼š

Atlas tilesï¼šå¯ä»¥ä¸ºå›¾é›†ä¸€æ¬¡å®šä¹‰ä¸€ç»„ç“¦ç‰‡ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼å¯ä»¥åœ¨ç»˜ç”»åˆ° TileMap
æ—¶æ‰“å¼€ Enabled Priority ä»¥éšæœºç”Ÿæˆç“¦ç‰‡ã€‚å¹¶ä¸”ï¼Œå¯ä»¥ä¸ºå…¶ä¸­ä»»æ„çš„ç“¦ç‰‡å®šä¹‰ç¢°æ’æ£€æµ‹åŒºã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œ
å¯ä»¥åœ¨ Icon Mode ä¸‹é€‰æ‹©ä¸€ä¸ªå›¾æ¡ˆä½œä¸ºåœ¨ TileMap ç»˜å›¾åˆ—è¡¨çš„å›¾æ ‡æ˜¾ç¤ºã€‚è€Œ Z-Index æ¨¡å¼åˆ™ç”¨æ¥å®šä¹‰
å„ä¸ªç“¦ç‰‡çš„ç»˜å›¾æ—¶çš„ Z æ·±åº¦å€¼ã€‚è¿˜æœ‰ä¼˜å…ˆçº§æ¨¡å¼ Priority Mode ç”¨æ¥è®¾ç½®ç“¦ç‰‡å‡ºç°çš„éšæœºæ¦‚ç‡å€¼ã€‚

Autotiles ç”¨äºåœ°å½¢ç¼–è¾‘ï¼Œå…è®¸ä¸€æ¬¡å®šä¹‰ä¸€ç»„å¹³é“ºï¼Œç„¶åæ ¹æ®ç›¸é‚»å•å…ƒæ ¼çš„å†…å®¹æ·»åŠ è§„åˆ™æ¥æ§åˆ¶ç”¨äºç»˜å›¾çš„å¹³é“ºï¼Œ
ç“¦ç‰‡é€‰æ‹©ç”±ä½æ©ç æ§åˆ¶ã€‚å•å‡» Bitmask è®¾ç½®ä½æ©ç ï¼Œç„¶åå•å‡»è¦æ·»åŠ æˆ–åˆ é™¤æ©ç çš„ç“¦ç‰‡è¿›è¡Œè®¾ç½®ï¼š

- å·¦é”®å•å‡»ç“¦ç‰‡çš„æŸä¸ªåŒºåŸŸå¯æ·»åŠ  â€œonâ€ æ ‡è®°ä½ï¼Œæ˜¾ç¤ºä¸ºçº¢è‰²ï¼›
- å³é”®ç‚¹å‡»è®¾ç½® â€œoffâ€ æ ‡è®°ä½ï¼Œæ­£å¸¸çŠ¶æ€ï¼›
- Shift + å·¦é”®å•å‡»å¯è®¾ç½® â€œignoreâ€ æ ‡è®°ä½ï¼Œæ˜¾ç¤ºä¸ºè“è‰²ï¼›

æ¯ä¸ªç“¦ç‰‡å¯è®¾ç½®çš„ Bitmask æ•°é‡é€šè¿‡å±æ€§é¢æ¿ Autotile bitmask mode è®¾ç½®ï¼Œå…è®¸è®¾ç½®ä¸ºï¼š

- â€œ2x2â€ æ¨¡å¼åŒ…å« 4 ä¸ªæ ‡è®°ä½ï¼Œå¯¹åº”ç“¦ç‰‡çš„å››ä¸ªè§’ï¼›
- â€œ3x3 (minimal)â€ æ¨¡å¼åŒ…å« 9 ä¸ªæ ‡è®°ä½ï¼Œå››ä¸ªè§’æ ‡è®°ä½åŠŸèƒ½åŒä¸Šï¼›
- â€œ3x3â€ã€‚

å¿…é¡»æ»¡è¶³æ‰€æœ‰ â€œopenâ€ å’Œ â€œoffâ€ çš„æ ‡è®°ä½ï¼Œæ‰èƒ½åŒ¹é…ä½æ©ç ï¼Œä½†å¿½ç•¥ â€œignoreâ€ æ ‡è®°ä½ã€‚

Godot ä½¿ç”¨ Autotiles æ›´æ–°å•å…ƒæ ¼æ—¶ï¼Œé¦–å…ˆä¼šæ ¹æ®å·²è®¾ç½®çš„ç›¸é‚»å•å…ƒæ ¼åˆ›å»ºå›¾æ¡ˆã€‚å®ƒåœ¨ Autotiles ä¸­æœç´¢
å…·æœ‰ä¸åˆ›å»ºçš„å›¾æ¡ˆåŒ¹é…çš„ä½æ©ç çš„ç“¦ç‰‡ï¼Œå¦‚æœæ‰¾ä¸åˆ°åŒ¹é…çš„ä½æ©ç ï¼Œå°†æ”¹ç”¨ â€œIconâ€ ç“¦ç‰‡ã€‚å¦‚æœæ‰¾åˆ°å¤šä¸ªåŒ¹é…ï¼Œ
å°†æ ¹æ®ä¼˜å…ˆçº§è®¾ç½®éšæœºé€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚

ä»¥æœ€ç®€å•çš„ 2x2 æ¨¡å¼ä¸ºä¾‹ï¼Œç“¦ç‰‡çš„å››ä¸ªè§’éƒ½æœ‰ä¸€ä¸ª bitmaskï¼š

- "on"ï¼ˆå›¾ä¸­çº¢è‰²ï¼‰çŠ¶æ€ä¸‹çš„è¾¹è§’è¦ä¸åŒç›¸çŠ¶æ€çš„ç“¦ç‰‡ç›¸è¿æ¥ï¼›
- "off"ï¼ˆå›¾ä¸­ç™½è‰²ï¼‰çŠ¶æ€ä¸‹çš„è¾¹è§’è¦ä¸è‡³å°‘æœ‰ä¸€ä¸ª "off" çŠ¶æ€è®¾ç½®çš„ç“¦ç‰‡ç›¸è¿ï¼›

![2x2 bistmask](https://docs.godotengine.org/en/3.6/_images/autotile_template_2x2.png)

å¦å¤–ï¼Œé€šè¿‡ç¼–ç¨‹ï¼Œå¯ä»¥æ‰¹é‡ä¿®æ”¹ TileMap çš„å†…å®¹ï¼ŒTileSet æä¾›äº†æ–¹æ³•æ ¹æ® tile åç§°è·å– IDï¼Œç„¶åå¯ä»¥
åœ¨ TileMap ä¸­å®šä½åˆ°å…¨éƒ¨ä½¿ç”¨äº† ID å¯¹åº”çš„å›¾åƒçš„æ ¼å­åæ ‡ï¼Œè¿™ä¸ªåæ ‡æ˜¯æ ¼å­çš„è¡Œåˆ—åæ ‡ï¼Œå’Œä¸–ç•Œåæ ‡ä¹‹é—´
å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ç»™ set_cell() ä¼ é€’ -1 ä½œä¸º tile ID åˆ™å¯ä»¥æ¸…ç©ºæ ¼å­å†…å®¹ã€‚ç¼–è¾‘ Tile æ—¶ï¼Œä¼šè‡ªåŠ¨è®¾ç½®
IDï¼Œå¹¶æ˜¾ç¤ºåœ¨ç“¦ç‰‡åç§°å‰ã€‚

é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ TileMap ç»˜åˆ¶å„ç§å¯¹è±¡çš„å ä½ç¬¦å·ï¼Œç„¶åç¼–ç¨‹æ›¿æ¢æˆéœ€è¦çš„èŠ‚ç‚¹å¯¹è±¡ã€‚Godot 4.x
ç‰ˆæœ¬ä¸­ï¼Œç›´æ¥å¯ä»¥åœ¨ TileMap ä¸­å°†åœºæ™¯å½“ä½œ tile ä½¿ç”¨ã€‚ 

```py
# TileSet
int find_tile_by_name(name: String) const

# TileMap
Array get_used_cells_by_id(id: int) const
Vector2 world_to_map(world_position: Vector2) const
Vector2 map_to_world(map_position: Vector2, ignore_half_ofs: bool = false) const

# Node2D
Vector2 to_global(local_point: Vector2) const
Vector2 to_local(global_point: Vector2) const
```

é€šè¿‡ get_used_cells è¿”å›çš„ä¸€ç³»åˆ—åæ ‡æŒ‡ç¤ºäº†ï¼ŒTileMap å“ªä¸ªæ ¼å­ä¸Šå·²ç»ç»˜åˆ¶äº†ç“¦ç‰‡å›¾ï¼Œåæ ‡å¯¹åº”å·¦ä¸Šè§’
ä¸ºåŸç‚¹ï¼Œå³ä¸‹è§’ä¸ºæ­£æ–¹å‘ã€‚

Godot 4.x ä½¿ç”¨äº†å…¨æ–°çš„ TileMap ç•Œé¢ï¼Œå¹¶ä¸”å¼•å…¥åœºæ™¯çš„æ”¯æŒï¼Œå¯ä»¥å°†åœºæ™¯ä½œä¸ºç“¦ç‰‡å›¾ä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œåº•éƒ¨å·¥å…·
é¢æ¿ä¸­ç›¸åº”æ˜¾ç¤ºä¸º TileSetã€TileMap ä¸¤ä¸ªé¢æ¿ã€‚æ—§ç‰ˆæœ¬ä¸­ï¼Œåœ¨ 2D åœºæ™¯é¢æ¿å·¥å…·æ ä¸­çš„åŠŸèƒ½ç§»åˆ°äº† TileMap
é¢æ¿ä¸­ï¼Œå¹¶ä¸”æ–°å¢äº† Lineã€Rect ä¸¤ç§ç»˜åˆ¶å·¥å…·ã€‚éƒ¨åˆ†å±æ€§é¢æ¿å†…å®¹ä¹Ÿç§»åŠ¨åˆ° TileSet é¢æ¿ä¸­ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å±æ€§ç»„ï¼š

- Animation
- Rendering
- Terrains

æ–°å¢äº† Atlas Merging Tool ç”¨äºåˆå¹¶ç“¦ç‰‡å›¾ï¼Œåœ¨ TileSet é¢æ¿ä¸­çš„å¼¹å‡ºèœæ‰¾åˆ°ã€‚

å¼•å…¥å›¾å±‚ç®¡ç†ç“¦ç‰‡ï¼Œåœ¨å±æ€§é¢æ¿ Layers æ·»åŠ å›¾å±‚ï¼Œç»˜åˆ¶æ—¶åœ¨ TileMap é¢æ¿å³ä¸Šè§’é€‰æ‹©æ‰€åœ¨å›¾å±‚ï¼Œç»˜åˆ¶åœ¨åŒ
ä¸€å›¾å±‚ä¸Šçš„ç“¦ç‰‡å›¾ä½¿ç”¨ç›¸åŒçš„å±‚è®¾ç½®ï¼Œå¦‚è‰²å½©è°ƒåˆ¶ã€‚æ–°æ—§ç‰ˆæœ¬çš„ API ä¸Šä¹Ÿæœ‰å·®åˆ«ï¼š

    void set_cell ( int x, int y, int tile, ...)
    void set_cellv ( Vector2 position, int tile, ... )

    void set_cell ( int layer, Vector2i coords, int source_id=-1, Vector2i atlas_coords=Vector2i(-1, -1), int alternative_tile=0 )
    void set_cells_terrain_connect ( int layer, Vector2i[] cells, int terrain_set, int terrain, bool ignore_empty_terrains=true )
    void set_cells_terrain_path ( int layer, Vector2i[] path, int terrain_set, int terrain, bool ignore_empty_terrains=true )

 å’Œæ—§ç‰ˆæœ¬çš„ç“¦ç‰‡ ID ä¸åŒï¼Œæ–°ç‰ˆæœ¬å¼•å…¥äº† source_id ä½œä¸ºç“¦ç‰‡é›†æ¥æºï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ atlas_coords æŒ‡å®š
 ç“¦ç‰‡å›¾çš„åæ ‡æ‰€åœ¨ã€‚æ‰€ä»¥ï¼Œå®˜æ–¹ç¤ºèŒƒå·¥ç¨‹ 2d navigation_astar éœ€è¦æŒ‰ä»¥ä¸‹ä»£ç è¿ç§»å‡çº§ï¼š

    #set_cell(point_start.x, point_start.y, 1)
    #set_cell(point_end.x, point_end.y, 2)

    set_cell(0, point_start, 1, Vector2i(0, 0))
    set_cell(0, point_end, 2, Vector2i(0, 0))


è¦å°†åœºæ™¯ä½œä¸ºç“¦ç‰‡ä½¿ç”¨ï¼Œåˆ™åœ¨ TileSet ä¸­æ·»åŠ ä¸€ä¸ª Scenes Collectionï¼Œå¹¶ä¸”å°†åœºæ™¯èµ„æºæ·»åŠ è¿›æ¥ã€‚

å°†å›¾åƒå¯¼å…¥ TileSet ä¸­ï¼Œä¼šè‡ªåŠ¨æç¤ºæ˜¯å¦éœ€è¦ä½¿ç”¨è‡ªåŠ¨åˆ›å»ºç“¦ç‰‡é›†ï¼Œå¯ä»¥æ¿€æ´» Eraser å·¥å…·ï¼Œé€šè¿‡ç‚¹å‡»æ“¦é™¤ç“¦ç‰‡åŒºã€‚
å¦‚æœæ‰‹åŠ¨åˆ›å»ºç“¦ç‰‡å®šä¹‰ï¼Œå°±éœ€è¦å–æ¶ˆ Eraser å·¥å…·ï¼Œå¹¶ç‚¹å‡»å›¾ç‰‡è¿›è¡Œå®šä¹‰ï¼Œé»˜è®¤ä¸º Tile Size è®¾ç½®çš„æ ¼å­åƒç´ å¤§å°ã€‚
å¯ä»¥åœ¨ Select é¢æ¿ä¸­ä¿®æ”¹ç“¦ç‰‡çš„å¤§å°ï¼Œåªéœ€è¦å‘¨è¾¹ä¿ç•™æœ‰è¶³å¤Ÿçš„ç©ºç™½åŒºã€‚åˆ›å»ºç“¦ç‰‡æ—¶ï¼ŒæŒ‰ä¸‹ Shift æ‹–åŠ¨åˆ›å»ºä»»æ„
æ ¼å­å¤§å°çš„ç“¦ç‰‡ã€‚

è¦å°†ç“¦ç‰‡ç»˜åˆ¶åˆ°åœºæ™¯æ—¶ï¼Œå°±åˆ‡æ¢åˆ° TileMap é¢æ¿ï¼Œå¹¶é€‰æ‹©å·²ç»å®šä¹‰å¥½çš„ç“¦ç‰‡è¿›è¡Œç»˜åˆ¶ï¼Œæœ‰ 4 ç§ç»˜åˆ¶å·¥å…·ï¼š

- Paint (D)
- Line (L)
- Rect (R)
- Bucket (B)

é€‰æ‹©å¤šä¸ªç“¦ç‰‡ï¼Œè¿˜å¯ä»¥é…åˆ Place Random Tile è¿›è¡Œéšæœºç»˜åˆ¶ï¼ŒæŠ•æ·å›¾æ ‡æŒ‰é”®æ‰“å¼€æ­¤åŠŸèƒ½ã€‚

åœ°å½¢æ˜¯ç“¦ç‰‡å›¾é›†éœ€è¦æä¾›çš„åŸºæœ¬åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œç»˜åˆ¶ä¸€ç‰‡è‰åœ°ï¼Œåœ¨æœªç»˜åˆ¶çš„åŒºåŸŸæ˜¾ç¤ºä¸ºæ°´å¡˜ï¼Œè¿™å°±æ˜¯åœ°å½¢çš„åŸºæœ¬è¡¨ç°ã€‚
ä¸åŒäºæ—§ç‰ˆçš„ bitmask è®¾ç½®æ–¹å¼ï¼ŒGodot 4.x å°†é¢æ¿æ‹†åˆ†åˆ°å±æ€§æ¢æµ‹å™¨é¢æ¿ï¼Œä»¥åŠ TileSet é¢æ¿ä¸¤éƒ¨åˆ†ã€‚
TileMap èŠ‚ç‚¹çš„å±æ€§é¡µé¢æ¿ä¸­ï¼Œå¼¹å¼€ Tile Set é¢æ¿ï¼Œå¯ä»¥åœ¨ Terain Set ä¸­åˆ›å»ºåœ°å½¢é›†å®šä¹‰ï¼Œå¹¶è®¾ç½®æ¨¡å¼
å’Œæ·»åŠ å¤šä¸ªåœ°å½¢åç§°å®šä¹‰ï¼Œæ¯ä¸ªåœ°å½¢å¯ä»¥ä¸€ä¸ªåå­—å’Œä¸€ä¸ªé¢œè‰²è¿›è¡Œæ ‡è®°ï¼Œæ¨¡å¼æœ‰å¯¹åº”æœ‰ 3 ç§ï¼š

- Match Corners and Sides (3x3)
- Match Corners (2x2)
- Match Sides

ç„¶åï¼Œåœ¨ä¸»ç•Œé¢åº•éƒ¨çš„ TileSet é¢æ¿ä¸­ï¼Œæ¿€æ´» Paint ç»˜åˆ¶å±æ€§ï¼Œé€‰æ‹©å±æ€§ Rendering - Terrainsï¼Œ
ç„¶åï¼Œé€šè¿‡ Painting åˆ—è¡¨ä¸­é€‰æ‹©çš„é¡¹ç›®è¿›è¡Œ bitmask æ•°æ®ç»˜åˆ¶ï¼š

- Terrain Set è®¾ç½®ç“¦ç‰‡å½’å±äºæŸä¸ªåœ°å½¢é›†ï¼Œ-1 è¡¨ç¤ºä¸å±äºä»»ä½•åœ°å½¢å›¾é›†ã€‚
- Terrain è®¾ç½®ç“¦ç‰‡å½’å±äºè¿™ä¸ªåœ°å½¢é›†çš„æŸä¸ªåœ°å½¢ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªåœ°å½¢é›†å¯èƒ½å®šä¹‰æœ‰è‰åœ°ã€æ£®æ—ä¸¤ç§åœ°å½¢ã€‚

ç»˜åˆ¶åœ°å½¢æ—¶ï¼Œå°±åˆ‡æ¢åˆ° TileMap é¢æ¿ï¼Œå¹¶é€‰æ‹© Terrains æ ç›®ä¸­åˆ—å‡ºçš„åœ°å½¢å®šä¹‰ã€‚


### ğŸŸ ğŸ”µ Tween & AnimationPlayer ç¼“åŠ¨æ›²çº¿åŠ¨ç”»
- [SceneTreeTween](https://docs.godotengine.org/en/stable/classes/class_scenetreetween.html)
- [Tween](https://docs.godotengine.org/en/stable/classes/class_tween.html)
- [Canvas layers](https://docs.godotengine.org/en/3.6/tutorials/2d/canvas_layers.html)
- [2D Sprite animation](https://docs.godotengine.org/en/3.5/tutorials/2d/2d_sprite_animation.html)

ç¼“åŠ¨æ›²çº¿æ˜¯ç”¨æ•°å­¦å…¬å¼è®¡ç®—ä¸€ä¸ªæ—¶é—´æ®µå†…æŸä¸€ä¸ªå˜é‡çš„å¹³æ»‘å˜åŒ–äº§ç”ŸåŠ¨ç”»çš„æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼Œåœ¨ 1s æ—¶é—´å†…å°†èŠ‚ç‚¹
çš„ x ä½ç½®åæ ‡ä» 0 æ…¢æ…¢å¢åŠ åˆ° 100ï¼Œè¿™ç§å¹³æ»‘çš„å˜åŒ–æœ‰ä¸åŒçš„å…¬å¼äº§ç”Ÿä¸åŒçš„åŠ¨ç”»æ•ˆæœï¼Œæ›²çº¿å‚è€ƒå›¾å¦‚ä¸‹ï¼š

![Tween easing and transition types cheatsheet](https://raw.githubusercontent.com/godotengine/godot-docs/master/img/tween_cheatsheet.png)

ä½¿ç”¨ SceneTreeTween å’Œæ—§å¼çš„ Tween å¯¹è±¡åˆ›å»ºç¼“åŠ¨æ›²çº¿åŠ¨ç”»å˜æ¢æ•ˆæœï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ 2D åŠ¨ç”»æŠ€æœ¯ã€‚

2D åŠ¨ç”»æ¶‰åŠåˆ°çš„èŠ‚ç‚¹ç±»å‹é™¤äº†ç¼“åŠ¨ç¨‹åºï¼Œè¿˜åŒ…æ‹¬ä½†ä¸ä»…é™å¦‚ä¸‹è¿™äº›ï¼š

|     Objects      |         Base Type          |
|------------------|----------------------------|
| SpriteFrames     | Resource                   |
| AnimatedTexture  | Texture < Resource         |
| Animation        | Resource                   |
| Sprite           | Node2D < CanvasItem < Node |
| AnimatedSprite   | Node2D < CanvasItem < Node |
| AnimatedSprite3D | Spatial < Node             |
| AnimationPlayer  | Node                       |
| AnimationTree    | Node                       |

å‰ä¸¤ä¸ªèµ„æºç±»å‹ç”¨äºåŒ…è£…åŠ¨ç”»å›¾åƒèµ„æºï¼Œè€Œ Animation åŠ¨ç”»èµ„æºåˆ™ä½œä¸ºåŠ¨ç”»è½¨é“è®°å½•åŠ¨ç”»å¸§å±æ€§ã€‚

SpriteFrames åŒ…è£…åŠ¨ç”»å¸§å›¾åƒèµ„æºï¼Œå¯ä»¥åŒ…å«å¤šä¸ªåŠ¨ç”»é…ç½®ã€‚

AnimatedTexture æ˜¯åŠ¨æ€çº¹ç†èµ„æºï¼Œæœ¬èº«å°±å…·æœ‰åŠ¨ç”»æ’­æ”¾èƒ½åŠ›ã€‚ä½œä¸ºä¸€ä¸ªèµ„æºç±»å‹ï¼Œç±»ä¼¼ä½¿ç”¨å›¾ç‰‡çº¹ç†å¯¹è±¡ã€‚
ä½†å¯ä»¥è®¾ç½®å¤šä¸ªå¸§ï¼Œè€Œä¸æ˜¯ä¸€å¼ é™æ€å›¾ç‰‡ï¼Œç„¶åå¯ä»¥æä¾›ç»™ AnimatedSpriteã€TileMap ç­‰éœ€è¦å›¾åƒèµ„æºçš„
èŠ‚ç‚¹ä½¿ç”¨ã€‚ç”¨æˆ·å¯ä»¥å¯¹å¸§ç‡ FPSã€æ¯å¸§å»¶æ—¶ï¼Œæˆ–è€…æš‚åœã€å•æ¬¡æ’­æ”¾ Oneshot ç­‰è¿›è¡Œè®¾ç½®ã€‚Godot å¼•æ“æ¶æ„ä¸­
è´Ÿè´£è§†è§‰å¤„ç†çš„ VisualServer ä»¥åŠ¨æ€çº¹ç†è§„å®šçš„é€Ÿç‡æŒ‰é¡ºåºç»˜åˆ¶åŒºåŸŸã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™ä¸æ¶‰åŠå¼•æ“çš„é¢å¤–é€»è¾‘ã€‚
åæ¶ˆæ¯æ˜¯ï¼Œç”¨æˆ·å‡ ä¹æ²¡æœ‰æ§åˆ¶æƒã€‚

ä¾‹å¦‚ï¼ŒAnimatedTexture + AnimatedSprite ç»„åˆï¼Œè¿™å°±æœ‰äº†åŒé‡åŠ¨ç”»ï¼Œä¸€è¾¹ AnimatedTexture æŒ‰è‡ªå·±
çš„åŠ¨ç”»èŠ‚å‡‘æ’­æ”¾å„å¸§å›¾åƒï¼Œæ¯ä¸€å¸§çš„å›¾åƒè¾“å‡ºåˆè¢« AnimatedSprite é‡æ–°åˆ¶ä½œçš„åŠ¨ç”»è¿›è¡Œæ’­æ”¾ã€‚ä¹Ÿå°±æ˜¯å‰è€…è´Ÿè´£
å˜æ¢å›¾ç‰‡ï¼Œåè€…è´Ÿè´£åˆ¶ä½œåŠ¨ç”»ï¼ŒäºŒè€…ç»„åˆå¾—åˆ°æœ€ç»ˆæ•ˆæœã€‚ç”¨åœ¨å¤§é‡çš„è‡ªåŠ¨åŠ¨ç”»èƒŒæ™¯ä¸­ï¼Œå•ä¸ªæ‰¹å¤„ç†ç»˜åˆ¶è°ƒç”¨å°±å¯å®Œæˆæ¸²æŸ“ã€‚


AnimatedSprite + SpriteFrames ç»„åˆåˆ¶ä½œå›¾ç‰‡å¸§åŠ¨ç”»ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªåŠ¨ç”»ã€‚å¯¹æ¯”å•ç‹¬ä½¿ç”¨ Sprite èŠ‚ç‚¹ï¼Œ
å®ƒåŠ è½½ä¸€å¼  Spritesheet å›¾åƒï¼Œåˆ™åªèƒ½åˆ›å»ºä¸€ä¸ªåŠ¨ç”»ï¼Œä½†å¦‚æœç”¨å¥½ **AnimationPlayer** æ¥æ§åˆ¶å…¶å±æ€§ï¼Œ
ä¹Ÿå¯ä»¥åˆ›å»ºå¤šä¸ªåŠ¨ç”»èµ„æºã€‚AnimatedSprite3D åˆ™æ˜¯åœ¨ 3D åœºæ™¯ä¸‹åˆ›å»ºçš„ä¸€ä¸ªèƒ½å±•ç¤ºå¸§åŠ¨ç”»çš„ 2D å¹³é¢ã€‚

åŠ¨ç”»èµ„æºç±»å‹ **Animation** ä¿å­˜çš„æ˜¯åŠ¨ç”»ç›¸å…³æ•°æ®ï¼Œåœ¨ AnimationPlayer ç¼–è¾‘ç•Œé¢ä¸­ä»¥è½¨é“çš„å½¢å¼å±•ç¤ºï¼Œ
ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼è®¾ç½®åŠ¨ç”»è½¨é“åŠå…³é”®å¸§æ•°æ®ï¼š

```py
# This creates an animation that makes the node "Enemy" move to the right by
# 100 pixels in 0.5 seconds.
var animation = Animation.new()
var track_index = animation.add_track(Animation.TYPE_VALUE)
animation.track_set_path(track_index, "Enemy:position:x")
animation.track_insert_key(track_index, 0.0, 0)
animation.track_insert_key(track_index, 0.5, 100)
```

AnimationPlayer èŠ‚ç‚¹ä½œä¸ºå…³é”®å¸§åŠ¨ç”»ï¼Œé€šè¿‡ Animation èµ„æºç±»å‹è®°å½•åœºæ™¯å†…å…¶å®ƒèŠ‚ç‚¹çš„å±æ€§å˜åŒ–æ¥ç”Ÿäº§åŠ¨ç”»ï¼Œ
å¯ä»¥åˆ›å»ºå¤šä¸ªåŠ¨ç”»ï¼Œä»¥å¯¹è±¡å±æ€§è½¨é“çš„æ–¹å¼ç¼–è¾‘ï¼Œå®ƒè¿˜å¯ä»¥ç”¨äºå„ç§åŠ¨ç”» 2D åŠ¨ç”»ï¼š

- Cut-Out animations: å‰ªå½±åŠ¨ç”»ï¼Œå¦‚çš®å½±æˆçš„æ•ˆæœï¼›
- 2D Mesh animations: ç»‘å®šéª¨éª¼æ§åˆ¶å›¾åƒçš„å˜å½¢ï¼›

Animation å¯ä»¥è®°å½• 6 ç§è½¨é“æ•°æ®ï¼ŒTrackType å®šä¹‰çš„å€¼å¦‚ä¸‹ï¼š

â— **TYPE_VALUE** å±æ€§è½¨é“ï¼Œåªè®°å½•å¯ä»¥æ’å€¼çš„å±æ€§ã€‚
â— **TYPE_TRANSFORM** å˜æ¢çŸ©é˜µè½¨é“ï¼Œç”¨äºæ”¹å˜èŠ‚ç‚¹å±€éƒ¨å˜æ¢ã€éª¨éª¼å§¿æ€ã€‚
â— **TYPE_METHOD** æ–¹æ³•è°ƒç”¨è½¨é“ï¼Œè®¾ç½®è¦åœ¨åŠ¨ç”»æ’­æ”¾æ—¶è§¦å‘çš„å‡½æ•°ï¼Œå¯ä»¥å¸¦å‚æ•°ã€‚
â— **TYPE_BEZIER** è´å¡å°”æ›²çº¿è‡ªå®šä¹‰æ’å€¼è½¨é“ï¼Œå¯ä»¥å¯¹å‘é‡ã€é¢œè‰²ç­‰å±æ€§çš„åˆ†é‡åšåŠ¨ç”»ã€‚
â— **TYPE_AUDIO** éŸ³é¢‘è½¨é“ï¼Œä½¿ç”¨ AudioStreamPlayer æ’­æ”¾éŸ³é¢‘æµï¼Œå¯ä»¥åœ¨åŠ¨ç”»ä¸­ä¿®å‰ªå’Œé¢„è§ˆè¯¥æµã€‚
â— **TYPE_ANIMATION** åŠ¨ç”»è½¨é“ï¼Œç”¨äºæ’­æ”¾å…¶å®ƒ AnimationPlayer èŠ‚ç‚¹çš„åŠ¨ç”»ã€‚

åŠ¨ç”»æ’­æ”¾å™¨å¯ä»¥é…åˆ Path2Dã€Path3D ä»¥åŠ PathFollw å¯ä»¥åˆ¶ä½œè¿åŠ¨è·¯å¾„è·Ÿéšï¼Œå†…åµŒ RemoteTransform
ä½œä¸ºå­èŠ‚ç‚¹ï¼Œå®ƒå¯ä»¥å°†è‡ªèº«çš„ä½ç½®ç­‰çŠ¶æ€ï¼ŒåŒ…å«è·¯å¾„è¿åŠ¨çš„äº§ç”Ÿçš„è¿åŠ¨ä¿¡æ¯ï¼Œå‘é€ç»™å…¶å®ƒå¯¹è±¡ä»¥å®ç°è·¯å¾„è·Ÿéšè¿åŠ¨ï¼Œ
ä¾‹å¦‚ç”¨è·¯å¾„æ§åˆ¶è¿åŠ¨å­¦åˆšä½“ KinematicBodyã€‚


è§†å·®ï¼Œå³è¿œæ…¢è¿‘å¿«çš„è§†è§‰ç°è±¡ï¼Œæ˜¯å¸¸è¢« 2D é‡‡ç”¨çš„ä¸€ç§åŠ¨ç”»æŠ€æœ¯ï¼Œæ¸¸æˆã€åŠ¨ç”»ç‰‡ä¸­éå¸¸å¤šåº”ç”¨ï¼Œä½¿ç”¨è§†å·®èƒŒæ™¯å›¾èŠ‚ç‚¹
ParallaxBackgroundï¼Œå°±å¯ä»¥å®ç°ï¼Œç»§æ‰¿è‡ª CanvasLayerã€‚å°†è§†å·®å›¾å±‚èŠ‚ç‚¹ ParallaxLayer æ”¾ç½®åˆ°è§†å·®
èƒŒå½±èŠ‚ç‚¹å†…ï¼Œè®¾ç½®è§†å·®å›¾å±‚çš„ Motion å±æ€§ä»¥ç¡®å®šè§†å·®æ•ˆæœã€‚

æœ€ä¸»è¦çš„ Scale å‚æ•°ï¼Œå†³å®šäº†è§†å·®å›¾å±‚ä¸ç›¸æœºè¿åŠ¨çš„é€Ÿåº¦æ¯”ä¾‹ï¼Œ0 è¡¨ç¤ºå›ºå®šä¸åŠ¨ï¼Œç±»ä¼¼ CanvasLayer å›¾å±‚
ä¸‹çš„èŠ‚ç‚¹ä¸€æ ·å›ºå®šä½ç½®ã€‚è®¾ç½® [0, 1] è¡¨ç¤ºæ¯”ç›¸æœºè¿åŠ¨é€Ÿåº¦æ…¢ï¼Œé€šå¸¸å°±æ˜¯è¿œæ™¯çš„è®¾ç½®ï¼Œå¤§äº 1 å°±æ˜¯è¿‘æ™¯çš„è®¾ç½®ã€‚

åœºæ™¯ä¸­æ€»æ˜¯å­˜åœ¨ Viewportï¼Œè‡³å°‘åœºæ™¯æ ‘çš„é¡¶çº§æœ‰ä¸€ä¸ªä¸å¯è§çš„ Viewportï¼Œå®ƒè®¾ç½®äº† canvas_transformï¼Œ
å…è®¸å¯¹å®ƒæ‰€åŒ…å«çš„ CanvasItem æ–½åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ Transform2D å˜æ¢. Camera2D çš„ä¸»è¦å·¥ä½œæ–¹å¼å°±æ˜¯
æ”¹å˜è¿™ä¸ª Transform2D å˜æ¢å®ç°ç”»å¸ƒå†…å®¹çš„å˜æ¢æ§åˆ¶ã€‚

![CanvasLayers](https://docs.godotengine.org/en/3.6/_images/canvaslayers.png)

åœ¨ 3D åœºæ™¯ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ **CanvasLayer** æ¥æ˜¾ç¤º 2D èŠ‚ç‚¹å†…å®¹ï¼Œé¿å…å—åˆ°ç”»å¸ƒå› ç›¸æœºè§†è§’å˜æ¢çš„å½±å“ï¼Œ
å¯ä»¥å®ç°çš„åŠŸèƒ½ä¸ä»…ä»¥ä¸‹åŠŸèƒ½ï¼š

- Parallax Backgrounds è§†å·®æ•ˆæœï¼Œé…åˆ ParallaxLayer èŠ‚ç‚¹è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®é•œåƒå»¶ä¼¸ã€‚
- UI: æ¸¸æˆä¸­çš„ç”¨æˆ·ç•Œé¢ï¼Œæˆ–è€… head-up display (HUD) ï¼Œå®ƒä»¬åº”è¯¥å›ºå®šåœ¨å±å¹•ä¸­ï¼Œä¸éšæ¸¸æˆä¸–ç•Œå˜æ¢ã€‚
- Transitions: è§†è§‰å˜æ¢ï¼Œå¦‚æ¸å˜ã€æ··åˆæ•ˆæœï¼Œè¿™äº›å†…å®¹ä¹Ÿå›ºå®šä½ç½®ã€‚

ç±»ä¼¼çš„ï¼ŒCanvasItem æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼Œ**set_as_toplevel()** å¯ä»¥å°† 2D èŠ‚ç‚¹æ·»åŠ é¡¶çº§çŠ¶æ€ï¼Œä»¥é¿å…
å—åˆ°çˆ¶çº§çš„å˜æ¢å½±å“ï¼ŒåŒæ—¶ç»˜å›¾æ—¶ä¼šè¦†ç›–åœ¨å…¶å®ƒæœªæ ‡è®°ä¸º Top Level çš„åŸºç‚¹ã€‚

åœºæ™¯ä¸­å¯ä»¥ä½¿ç”¨ä¸€ä¸ª **WorldEnvironment** èŠ‚ç‚¹ï¼ŒåŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªï¼ŒåŒ…æ‹¬ç»§æ‰¿çš„åœºæ™¯åœ¨å†…ã€‚ç„¶åä¸ºç¯å¢ƒèŠ‚ç‚¹
åˆ›å»ºä¸€ä¸ª **Environment** èµ„æºï¼Œç”¨äºé…ç½®ç¯å¢ƒï¼Œå¦‚è®¾ç½®èƒŒæ™¯å±æ€§ï¼š

- Background Mode è®¾ç½®ä¸º Canvas æ¨¡å¼ï¼›
- Canvas Max Layer è®¾ç½®ä¸€ä¸ªåºæ•°ï¼Œå±‚åºå°äºè¿™ä¸ªå€¼çš„ CanvasLayer å°±ä¼šå½“ä½œèƒŒæ™¯å±‚ï¼›

Layer åºå·è¶Šå¤§ï¼Œç»˜å›¾é¡ºåºè¶Šé åï¼Œå°±å¯ä»¥è¦†ç›–å…¶å®ƒ Layer æ›´å°çš„èŠ‚ç‚¹ã€‚2D åœºæ™¯é»˜è®¤å›¾å±‚ç»˜ç”»é¡ºåºä¸º 0ï¼Œå¦‚æœ
CanvasLayer åºå·è®¾ç½®ä¸ºæ›´å°çš„å€¼ï¼Œå¦‚ -1 åˆ™ä¼šå…ˆè¡Œç»˜åˆ¶ï¼Œä½œä¸ºèƒŒæ™¯ã€‚CanvasLayers æ‹¥æœ‰ç‹¬ç«‹çš„ç»˜å›¾é¡ºåºï¼Œ
ç”± Layer åºå·å†³å®šï¼Œå®ƒä»¬ç‹¬ç«‹äºåœºæ™¯æ ‘çš„èŠ‚ç‚¹é¡ºåºï¼Œå¯ä»¥åœ¨éœ€è¦æ—¶è°ƒæ•´ã€‚


åœºæ™¯ä¸­ç›¸æœºè¿åŠ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç‰‡æ®µï¼Œä½¿ç”¨é¼ æ ‡ç§»åŠ¨æ¥å†³å®šç›¸æœºä½ç½®ï¼š

```py
exetends Node2D

onready var camera_2d = $Camera2D

func _input(event):
    if event is InputEventMouseMotion:
        #camera_2d.anchor_mode = Camera2D.ANCHOR_MODE_FIXED_TOP_LEFT
        camera_2d.position = (event.position - get_viewport().size/2) / 2
```


åŠ¨ç”»çš„åŸºæœ¬åŸç†å°±æ˜¯è¿ç»­çš„ç›¸ä¼¼å›¾åƒåœ¨äººçœ¼çš„è§†è§‰æš‚ç•™äº§ç”Ÿçš„è¿åŠ¨æ„Ÿè§‰ï¼Œ2D Sprite animation å°±æ˜¯å°†ä¸€ç»„
ç›¸ä¼¼çš„ä½†åˆæœ‰å…³é”®åŒºåˆ«çš„å›¾åƒæŒ‰æŒ‡å®šæ—¶é—´é—´éš”æ’­æ”¾çš„åŠ¨ç”»æ•ˆæœï¼Œåœ¨åœºæ™¯ä¸­ä½¿ç”¨ **AnimatedSprite** èŠ‚ç‚¹ï¼Œ
åœ¨å±æ€§æ¢æµ‹å™¨ä¸­è®¾ç½®èŠ‚ç‚¹çš„ Frames å±æ€§ï¼Œå®ƒå…³è”ä¸€ä¸ª **SpriteFrames** åŠ¨ç”»å¸§èµ„æºï¼ŒåŒ…å«å¤šä¸ªåŠ¨ç”»é…ç½®ï¼Œ
å¯ä¾› AnimatedSprite æˆ– AnimatedSprite3D æ’­æ”¾ã€‚


æ‰“å¼€åŠ¨ç”»å¸§èµ„æºï¼Œåœ¨åŠ¨ç”»å¸§ç¼–è¾‘é¢æ¿ä¸­æœ‰ä¸€ä¸ªé»˜è®¤çš„ default åŠ¨ç”»ï¼Œæ ¹æ®éœ€è¦åˆ›å»ºæ›´å¤šçš„åŠ¨ç”»ï¼Œå¦‚è¡Œèµ°ã€è·³åŠ¨
ç­‰ç­‰ï¼Œç„¶åä¸ºæ¯ä¸ªåŠ¨ç”»å¯¼å…¥ç›¸å…³å›¾ç‰‡ï¼Œå¯ä»¥æ˜¯å•å¼ å•ä¸ªåŠ¨ä½œçš„å›¾åƒï¼Œæˆ–è€…ä¸€å¼ åŒ…å«æ‰€æœ‰åŠ¨ä½œçš„ Sprites å›¾åƒï¼Œ
å³ Sprites Sheet å›¾åƒï¼Œè¦æ±‚å„ä¸ªåŠ¨ä½œå›¾åƒå¤§å°ç›¸ç­‰ï¼Œå¯¼å…¥åéœ€è¦é€šè¿‡ç”»ç½‘æ ¼æ¥å®šä½ã€‚

ç„¶åï¼Œè®¾ç½®å¸§åŠ¨ç”»çš„æ’­æ”¾é€Ÿåº¦ Speedï¼Œé»˜è®¤ä¸º 5 FPSï¼Œå³æ¯ç§’ 5 å¸§ï¼Œè¿˜å¯ä»¥å‹¾é€‰ Loop è¡¨ç¤ºå¾ªç¯æ’­æ”¾ä¸ç»ˆæ­¢ã€‚
AnimatedSprite æ’­æ”¾å®Œæ¯ä¸€ä¸ªåŠ¨ç”»æ—¶ï¼Œä¼šå‘å¸ƒä¸€ä¸ª **animation_finished** ä¿¡å·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥åš
åŠ¨ç”»è½¬æ¢ä»¥å®ŒæˆåŠ¨ç”»ç»„åˆã€‚

```py
onready var animated_sprite = $ColorRect/AnimatedSprite


func _on_AnimatedSprite_animation_finished():
    print("AnimatedSprite finished ", animated_sprite.animation)


func _on_ColorRect_gui_input(event):
    if event is InputEventMouseButton and event.is_pressed():
        var ans = animated_sprite.frames.get_animation_names()
        var idx = ans.find(animated_sprite.animation)
        idx = (idx + 1) % ans.size()
        animated_sprite.play(ans[idx])
```

ä»¥ä¸‹æ˜¯å®šåˆ¶ Sprite å®ç°çš„ MyAnimatedSprite åŠ¨ç”»èŠ‚ç‚¹ï¼š

```py
extends Sprite
class_name MyAnimatedSprite

signal animation_finished

var timer:Timer = Timer.new()

export(int, 0, 120, 1) var FPS = 4
export(bool) var pause = false setget set_pause
export(bool) var loop = false
export(bool) var TextureMovtion = true setget set_TextureMovtion

func _enter_tree():
    timer.connect("timeout", self, "_on_Timer_timeout")
    add_child(timer)

func _ready():
    connect("animation_finished", self, "_on_animation_finished")
    set_animation()
    
func _input(event):
    if event.is_pressed() and event is InputEventMouseButton:
        var mouse = event as InputEventMouseButton
        var distance = position.distance_to(mouse.position)
        if distance > 32:
            return
        if mouse.button_index == BUTTON_LEFT:
            set_TextureMovtion(!TextureMovtion)
        else:
            set_pause(!pause)
    
    
func _on_Timer_timeout():
    var frames = hframes * vframes
    frame = (frame + 1) % frames 
    if frame == frames - 1:
        yield(get_tree(), "idle_frame") # wait next idle frame
        emit_signal("animation_finished")

func _on_animation_finished():
    if not loop:
        timer.stop()
    

func set_pause(state):
    pause = state
    set_animation()

func set_animation():
    if not pause and texture:
        timer.start(1.0 / FPS)
    else:
        timer.stop()

func set_TextureMovtion(state):
    TextureMovtion = state
    var at = texture as AnimatedTexture
    at.pause = !state
    property_list_changed_notify()
```


ä½¿ç”¨ **Sprite** å’Œ **AnimationPlayer** æ­é…ä¹Ÿå¯ä»¥å®ç° AnimatedSprite ä¸€æ ·çš„å¸§åŠ¨ç”»ï¼Œåªä¸è¿‡
AnimationPlayr æ˜¯è®°å½•èŠ‚ç‚¹çš„å±æ€§ä½œä¸ºå…³é”®å¸§ï¼Œä¸€ä¸ªåŠ¨ç”»åŒ…å«å¤šä¸ªå…³é”®å¸§ã€‚é¦–å…ˆï¼Œç»™ Sprite èŠ‚ç‚¹çš„çº¹ç†å±æ€§
æŒ‡å®šä¸€å¼  Spritesheet å›¾åƒï¼Œç„¶åé€šè¿‡ Hframes å’Œ Vframes ä¸¤ä¸ªå±æ€§å°†å›¾åƒæ‹†åˆ†ä½œå¤šä¸ªå¸§ã€‚ç„¶åï¼Œæ‰“å¼€
åº•éƒ¨ Animation åŠ¨ç”»æ’­æ”¾èŠ‚ç‚¹è®¾ç½®é¢æ¿ï¼Œåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ï¼Œä¸º Sprite èŠ‚ç‚¹çš„ Frames å±æ€§æ·»åŠ ä¸€æ¡è½¨é“ï¼Œ
å¹¶åœ¨è½¨é“ä¸­æ·»åŠ å…³é”®å¸§ã€‚å¯ä»¥é€šè¿‡å³é”®èœå•ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Sprite çš„å±æ€§é¢æ¿çš„ Key å›¾æ ‡è®¾ç½®ã€‚

æ³¨æ„ï¼ŒAnimationPlayer ä¸­çš„åŠ¨ç”»è½¨é“æ˜¯å’Œå±æ€§çš„è·¯å¾„å­—ç¬¦ä¸²å…³è”çš„ï¼Œå¦‚æœå¯¹åº”çš„èŠ‚ç‚¹ä½ç½®æœ‰å˜é‡ï¼Œè½¨é“ä¸­çš„
å±æ€§è·¯å¾„å¯èƒ½ä¹Ÿéœ€è¦æ›´æ–°ï¼Œå¦åˆ™å¯èƒ½å› æ‰¾ä¸åˆ°èŠ‚ç‚¹è€Œå¯¼è‡´åŸæœ‰çš„åŠ¨ç”»è®¾ç½®ä¸èƒ½ç”Ÿæ•ˆã€‚

```py
extends Sprite

onready var player:AnimationPlayer = $AnimationPlayer
onready var timer = $Timer
onready var sprite = $"."

enum Direction { Left = -1, Right = 1 }
export(Direction) var direction = Direction.Left

func _on_Timer_timeout():
    player.current_animation = "fog jump"
    #player.play("fog jump")


func _on_AnimationPlayer_animation_started(anim_name):
    var tween = get_tree().create_tween().set_trans(Tween.TRANS_QUART)
    var up = Vector2(direction * 50.0, -30.0)
    var dn = Vector2(direction * 40.0, 30.0)
    tween.tween_property(sprite, "position", up, 0.3).as_relative().set_ease(Tween.EASE_OUT)
    tween.tween_property(sprite, "position", dn, 0.15).as_relative().set_ease(Tween.EASE_IN)


func _on_AnimationPlayer_animation_finished(anim_name):
    var vs = get_viewport().size
    if sprite.position.x > vs.x:
        sprite.scale.x = direction
        direction *= -1
    elif sprite.position.x < 0:
        sprite.scale.x = direction
        direction *= -1
```

2D/3D åŠ¨ç”»æœ€é‡è¦çš„ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ **AnimationTree**ï¼Œæ—§çš„ AnimationTreePlayer ç”±äºå¤ªå¤æ‚å·²ç»ä¸¢å¼ƒã€‚
åŠ¨ç”»æ ‘å®ç°çš„åŠŸèƒ½æ˜¯åŠ¨ç”»æ··åˆæŠ€æœ¯ Animation Blendingï¼Œä½œä¸ºç‹¬ç«‹ä¸€å°èŠ‚è®²è§£ã€‚


## ğŸŸ¡ Animation Blending åŠ¨ç”»æ··åˆ
- [Using AnimationTree](https://docs.godotengine.org/en/3.5/tutorials/animation/animation_tree.html)
- [Adobe Mixamo](https://www.mixamo.com)
- [Third Person Shooter demo](https://github.com/godotengine/tps-demo)
- [Retargeting 3D Skeletons](https://docs.godotengine.org/en/latest/tutorials/assets_pipeline/retargeting_3d_skeletons.html)
- [Animation Retargeting in Godot 4.0](https://godotengine.org/article/animation-retargeting-in-godot-4-0)
- [09.é«˜çº§åŠ¨ç”»æŠ€æœ¯ï¼šåŠ¨ç”»æ ‘ã€IKå’Œè¡¨æƒ…åŠ¨ç”» | GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ](https://www.bilibili.com/video/BV1pY411F7pA)
- https://threejs.org/examples/#webgl_animation_skinning_additive_blending
- [spine-godot Runtime](http://esotericsoftware.com/spine-godot)
- [Spine Runtimes - spine-godot](https://github.com/EsotericSoftware/spine-runtimes)

å®˜æ–¹æ–‡æ¡£æä¾›çš„ç¬¬ä¸‰äººç§°å°„å‡»æ¸¸æˆç¤ºèŒƒé¡¹ç›® Third Person Shooter demo æ˜¯å­¦ä¹ åŠ¨ç”»æ··åˆçš„å¥½ä¾‹å­ã€‚

Adobe Mixamo æ˜¯å­¦ä¹  3D åŠ¨ç”»çš„ä¸€ä¸ªèµ„æºç½‘ç«™ï¼Œå®ƒç”¨è®¸å¤šç°æˆçš„æ¨¡å‹å’ŒåŠ¨ç”»é¢„è®¾ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„éª¨éª¼
ç»‘å®šåŠåŠ¨ç”»åˆ¶ä½œï¼Œåªè¦ä¸Šä¼ è‡ªå·±çš„è§’è‰²æ¨¡å‹ç¨ä½œæ ¡æ­£å°±å¯ä»¥å®ŒæˆåŠ¨ç”»åˆ¶ä½œï¼Œç°æœ‰çš„åŠ¨ç”»ç´ æä¹Ÿæ˜¯å¾ˆå¥½çš„å­¦ä¹ èµ„æºã€‚

åŠ¨ç”»æ··åˆæ˜¯ä¸€ç§é‡è¦çš„è®¡ç®—æœºåŠ¨ç”»æŠ€æœ¯ï¼ŒåŸºæœ¬çš„åŠ¨ç”»æŠ€æœ¯åœ¨ä½¿ç”¨ä¸Šå­˜åœ¨éš¾ä»¥ä½¿ç”¨çš„çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ¸¸æˆä¸­ç©å®¶è§’è‰²
åŒæ—¶å¯ä»¥ä¸åŒçš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„åŠ¨ç”»èåˆåœ¨ä¸€èµ·ã€‚æ¯”å¦‚ï¼Œç®€å•çš„åŠ¨ç”»å¯èƒ½æœ‰æ­¥è¡Œã€è·³è·ƒã€æ”»å‡»è¡Œä¸ºç­‰ï¼Œåœ¨ç®€å•
æ’­æ”¾åŠ¨ç”»çš„æŠ€æœ¯ä¸­ï¼Œå®ƒä»¬éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªæ’­æ”¾å®Œå°±è¿›è¡Œä¸‹ä¸€ä¸ªåŠ¨ç”»ã€‚

å…¸å‹çš„åŠ¨ç”»æ··åˆä¾‹å­ï¼Œå°±æ˜¯å°† 3D äººç‰©æ¨¡å‹ä»èµ°è·¯åŠ¨ç”»è¿‡æ»¤è¿‡æ¸¡åˆ°å¥”è·‘åŠ¨ç”»ã€‚ä½†æ˜¯ï¼Œåœ¨æ¸¸æˆäº¤äº’ä¸­è¦æ±‚è¿œä¸æ­¢å¦‚æ­¤ï¼Œ
å¯èƒ½ç©å®¶åœ¨åšè·³è·ƒåŠ¨ä½œæ—¶è¿˜çªç„¶æƒ³åšå‡ºæ”»å‡»åŠ¨ä½œï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„åŠ¨ç”»å°±æ— æ³•å¾ˆå¥½é€‚åº”è¿™ç§ä¸­é—´è½¬æ’­å…¶å®ƒåŠ¨ç”»çš„æ“ä½œã€‚


æ¸¸æˆã€åŠ¨ç”»å·¥ä¸šå¯¹åŠ¨ç”»æœ‰å¤§é‡çš„éœ€æ±‚ï¼ŒåŠ¨ç”»åˆ¶ä½œå®Œæˆåè¿˜æœ‰å¤ç”¨çš„éœ€è¦ï¼Œå³å°†åŒä¸€å¥—åŠ¨ç”»åº”ç”¨äºéª¨éª¼ç»“æ„ç›¸ä¼¼çš„
æ¨¡å‹ä¸Šã€‚è¿™é‡Œå°±å­˜åœ¨åŠ¨ç”»é‡å®šå‘çš„é—®é¢˜ï¼ŒAnimation Retargetingã€‚åŸºäºéª¨éª¼ç»‘å®šåˆ¶ä½œçš„åŠ¨ç”»ï¼Œæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œ
å°±æ˜¯æ¨¡å‹ä¸åŒçš„éƒ¨åˆ†ç»‘å®šä¸åŒçš„éª¨éª¼ï¼Œé€šè¿‡è°ƒæ•´éª¨éª¼å§¿æ€ä½¿ç”¨æ¨¡å‹äº§ç”Ÿç›¸åº”çš„å§¿æ€ï¼Œè®°å½•åˆ°å…³é”®å¸§åå°±å¾—åˆ°åŠ¨ç”»ã€‚
æ‰€ä»¥ï¼ŒåŠ¨ç”»é‡å®šå‘å°±éœ€è¦å°†åŠ¨ç”»æ¥æºçš„éª¨éª¼ä¸ç›®æ ‡æ¨¡å‹çš„éª¨éª¼åšæ ¡å¯¹ï¼Œä»¥ä½¿ç”¨åŸåŠ¨ç”»çš„æ•°æ®é€‚ç”¨äºæ–°çš„æ¨¡å‹ä¸Šã€‚

åŒæ ·ï¼Œ2D åŠ¨ç”»ä¹Ÿæœ‰ç±»ä¼¼çš„åŠ¨ç”»å¤ç”¨é—®é¢˜ï¼Œåœ¨ Godot ä¸­ä½¿ç”¨ AnimationPlayer èŠ‚ç‚¹åˆ¶ä½œçš„å…³é”®å¸§åŠ¨ç”»ï¼Œå…¶
ç›®æ ‡èŠ‚ç‚¹æ˜¯é€šè¿‡èŠ‚ç‚¹è·¯å¾„è¡¨ç¤ºçš„ï¼Œå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡æ”¹å˜è¿™ä¸ªèŠ‚ç‚¹è·¯å¾„ï¼Œå°±å¯ä»¥å°†åŠ¨ç”»åº”ç”¨äºä¸åŒçš„èŠ‚ç‚¹ä¸Šã€‚

Godot åŠ¨ç”»èŠ‚ç‚¹ä¸­æœ€é‡è¦çš„ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ **AnimationTree**ï¼Œæ—§ç‰ˆæœ¬çš„ AnimationTreePlayer ç”±äºå¤ª
å¤æ‚å·²ç»ä¸¢å¼ƒã€‚åŠ¨ç”»æ ‘å®ç°çš„åŠŸèƒ½æ˜¯åŠ¨ç”»æ··åˆæŠ€æœ¯ Animation Blendingï¼Œå®ƒçš„åŠŸèƒ½æ¶‰åŠå†…å®¹è¾ƒå¤šï¼Œä¹Ÿæ˜¯æ¯”è¾ƒ
å¤æ‚çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸€èˆ¬å®ƒå’Œ AnimationPlayer æ­é…ä½¿ç”¨ï¼Œç”¨äºç®¡ç†ä¸åŒåŠ¨ç”»çš„åˆ‡æ¢æ’­æ”¾ã€‚

AnimationTree åŠ¨ç”»æ··åˆä½¿ç”¨åˆ°ä¸‰å¤§ç±»å‹èŠ‚ç‚¹ï¼š

- **Animation** åŠ¨ç”»èµ„æºç±»å‹ï¼ŒåŠ¨ç”»æ ‘å¼•ç”¨é€šè¿‡ anim_player å±æ€§è¿æ¥åˆ° AnimationTree ä¸Šçš„åŠ¨ç”»ã€‚
- **AnimationRootNode** æ ¹èŠ‚ç‚¹ç”¨æ¥æ··åˆå­èŠ‚ç‚¹ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ Blend Tree æ··åˆæ ‘ã€‚
- **Blend Nodes** æ··åˆèŠ‚ç‚¹ç”¨äº Blend Tree æ··åˆæ ‘ï¼Œå¤šä¸ªè¾“å…¥ç«¯å£æ¥å…¥çš„æ··åˆèŠ‚ç‚¹ï¼Œæœ€ç»ˆæ··åˆæˆå•ä¸ªå›¾ã€‚

åŠ¨ç”»æ ‘éœ€è¦æŒ‡å®šä¸€ä¸ªåŠ¨ç”»æ’­æ”¾èŠ‚ç‚¹çš„è·¯å¾„ä»¥è°ƒç”¨å…¶åŠ¨ç”»é…ç½®ï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€ä¸ªé¡¶å±‚èµ„æºåŠ¨ç”»èŠ‚ç‚¹ï¼Œä»¥ä¸‹ 5 ä¸ªç»§æ‰¿è‡ª
AnimationRootNode < AnimationNode çš„ç±»å‹å¯¹åº”äº† 5 ç§ä¸åŒçš„åŠ¨ç”»æ··åˆæ–¹æ³•ï¼š

- **AnimationNodeAnimation**: åŠ¨ç”»èŠ‚ç‚¹ï¼Œåªæ˜¯ç®€å•åœ°ä»å·²ç»è¿æ¥çš„åŠ¨ç”»ä¸­é€‰æ‹©è¦æ’­æ”¾çš„åŠ¨ç”»ã€‚
- **AnimationNodeBlendTree**: æ··åˆæ ‘å¯ä»¥æ··åˆä¸åŒçš„æ ¹èŠ‚ç‚¹ï¼Œå¸¸å¸¸ç”¨å®ƒä½œä¸ºåŠ¨ç”»æ ‘çš„æ ¹èŠ‚ç‚¹ä½¿ç”¨ã€‚
- **AnimationNodeStateMachine**: çŠ¶æ€æœºå¯ä»¥åŒ…å«å¤šä¸ªæ ¹èŠ‚ç‚¹ï¼Œå®ƒä»¬éƒ½æ˜¯çŠ¶æ€ï¼Œä½¿ç”¨è½¬æ¢æ–¹æ³•åˆ‡æ¢çŠ¶æ€ã€‚
- **AnimationNodeBlendSpace2D**: 2D æ··åˆç©ºé—´ï¼Œæ··åˆç‚¹å¯ä»¥åœ¨äºŒç»´å¹³é¢è¿åŠ¨ï¼Œå¯ä»¥æ··åˆå¤šä¸ªåŠ¨ç”»ã€‚
- **AnimationNodeBlendSpace1D**: 1D æ··åˆç©ºé—´ï¼Œç®€åŒ–ç‰ˆæœ¬ï¼Œæ··åˆç‚¹åªèƒ½ä¸€ç»´æ–¹å‘å˜åŒ–ï¼Œæ··åˆä¸¤ä¸ªåŠ¨ç”»ã€‚

æ ¹è¿åŠ¨æŠ€æœ¯ **Root Motion** æ˜¯æŒ‡ï¼Œå³å› è§’è‰²åŠ¨ä½œå¯¼è‡´éœ€è¦ç§»åˆ°æ¨¡å‹ä½ç½®ï¼Œæ‹¼æ¥ä¸¤ä¸ªåŠ¨ç”»ï¼Œå°±éœ€è¦å¤„ç†å‰å
ä¸¤ä¸ªåŠ¨ç”»ä¸­çš„æ¨¡å‹ä½ç½®ï¼Œä½¿å…¶å‰åè¿æ¥æµç•…ã€‚å‡è®¾ï¼Œç°æˆçš„æ¨¡å‹åŠ¨ç”»åŸºäºåŸç‚¹å®šä½ï¼Œå½“ä¸€ä¸ªä½¿ç”¨ Root Motion 
çš„åŠ¨ç”»æ’­æ”¾åˆ°ç»“æŸæ—¶ï¼Œæ¨¡å‹å·²ç»åç§»åŸç‚¹ã€‚æ‰€ä»¥ï¼Œå½“ä¸‹ä¸€ä¸ªåŠ¨ç”»è·Ÿç€æ’­æ”¾æ—¶ï¼Œåˆç¬æ—¶å›åˆ°äº†åŸç‚¹ï¼Œè¿™é‡Œå°±æœ‰ä½ç§»å·®
è¦å¤„ç†å¥½æ‰èƒ½å°†ä¸¤ä¸ªåŠ¨ç”»æ— ç¼æ‹¼æ¥èµ·æ¥ã€‚3D åŠ¨ç”»æŠ€æœ¯ä¸­ï¼Œæ¨¡å‹ç½‘æ ¼çš„éª¨æ¶ç”¨äºä¸ºè§’è‰²æä¾›æ¨åŠ¨åŠ›ï¼ŒåŠ¨ç”»å¸ˆå¸¸ç”¨çš„
æŠ€æœ¯æ˜¯ä½¿ç”¨æ ¹éª¨éª¼ä¸ºå…¶ä½™éª¨éª¼æä¾›è¿åŠ¨ã€‚è¿™å…è®¸è§’è‰²çš„æ­¥è¡Œå¯ä»¥ç¨³è´´åœ°æ¿ï¼Œäº§ç”ŸçœŸå®çš„è§’è‰²åŠ¨ç”»ï¼Œè€Œä¸ä¼šå‡ºç°æ‘©æ“¦
åœ°æ¿çš„è„šæŒæ‹–åŠ¨ç°è±¡ã€‚

å¯¹äºä¸€ä¸ªåŠ¨ç”»è€Œè¨€ï¼Œåªæ˜¯è§’è‰²è¿åŠ¨ä¸­çš„ä¸€ä¸ªå‘¨æœŸè€Œå·²ï¼Œå½“åŠ¨ç”»æ’­æ”¾å®Œä¸€ä¸ªå‘¨æœŸï¼Œå®ƒåˆéœ€è¦è®©å›¾åƒæ¢å¤åŸä½ï¼Œå†ä»å¤´
æ¥è¿‡ï¼Œè¿™æ ·å‘¨è€Œå¤å§‹åœ°æ’­æ”¾ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒåŠ¨ç”»å¾ªç¯æ’­æ”¾åº”è¯¥äº§ç”Ÿè¿ç»­çš„ä½ç§»ï¼Œè€Œä¸æ˜¯æ¥å›è·³åŠ¨ã€‚


Godot ä¸­æ’­æ”¾åŠ¨ç”»æ—¶ï¼Œäº¦å¯ä»¥ä½¿ç”¨æ ¹éª¨éª¼ä½œä¸ºæ ¹è¿åŠ¨è½¨è¿¹ Root Motion Trackï¼Œè¿™æ ·å°†åœ¨è§†è§‰ä¸Šå–æ¶ˆéª¨éª¼å˜æ¢ï¼Œ
åŠ¨ç”»å°†ä¿æŒä½ç½®ä¸å˜ã€‚æ ¹è¿åŠ¨è½¨è¿¹å¯ä»¥é€šè¿‡ get_root_motion_track() è·å–å†ä¼ é€’ç»™ KinematicBody çš„
**move_and_slide()** æ–¹æ³•ä»¥æ§åˆ¶è§’è‰²è¿åŠ¨ã€‚

RootMotionView æ˜¯ä¸€ä¸ªå·¥å…·èŠ‚ç‚¹ï¼Œæ”¾ç½®åœ¨åœºæ™¯ä¸­å½“ä½œåœ°æ¿ï¼Œä¸ºè§’è‰²åŠ¨ç”»æä¾›å‚ç…§ï¼Œåœ¨æ¸¸æˆä¸­æ—¶é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚

ä½¿ç”¨å®˜æ–‡å±•ç¤ºçš„ä¸€ç»„é’è›™ Sprites ä¸ºä¾‹ï¼Œå®ƒå¯ä»¥åˆ¶ä½œä¸ºä¸€ä¸ªè·³è·ƒåŠ¨ç”»ï¼Œè¿™ä¸ªè·³è·ƒåŠ¨ä½œä¼šäº§ç”Ÿä½ç§»ï¼š

![Frog Spritesheet](https://docs.godotengine.org/en/3.5/_images/2d_animation_frog_spritesheet.png)

å‡å®šåˆ¶ä½œäº† jump_left å’Œ jump_right ä¸¤ä¸ªè·³è·ƒåŠ¨ç”»ï¼Œå› ä¸ºå›¾åƒçš„é’è›™æ˜¯å‘å·¦çš„ï¼Œå¦‚æœåœ¨ Sprte æ˜¾ç¤º
å›¾åƒï¼Œå¯ä»¥é€šè¿‡è®¾ç½® scale.x ä¸º -1 è¿›è¡Œå·¦å³åè½¬ï¼Œä»è€Œå¾—åˆ°å‘å³çš„å›¾åƒã€‚ä½¿ç”¨ AnimationPlayer åˆ¶ä½œ
åŠ¨ç”»æ—¶ï¼Œæ˜¯å¯ä»¥çŸ¥é“è§’è‰²ç§»åŠ¨è·ç¦»çš„ï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ’­æ”¾å®Œæˆæ—¶ï¼Œé€šè¿‡æ¥æ”¶ animation_finished ä¿¡å·ï¼Œå¹¶åœ¨
ä¿¡å·è§¦å‘æ—¶ä¸»åŠ¨ç§»åŠ¨ç›¸åº”çš„è·ç¦»ï¼Œç„¶åå†å¼€å§‹ä¸‹ä¸€è½®çš„åŠ¨ç”»æ’­æ”¾ï¼Œè¿™æ ·ç§»åŠ¨å°±å¯ä»¥è¡”æ¥èµ·æ¥ã€‚æ³¨æ„ Loop æ–¹å¼å¼€å¯
AnimationPlayer å°±ä¸ä¼šå‘å‡º animation_finished ä¿¡å·ã€‚å¦å¤–ï¼Œé€šè¿‡ AnimationTree è§¦å‘çš„åŠ¨ç”»
æ’­æ”¾è¡Œä¸ºä¹Ÿä¸ä¼šç”Ÿäº§ AnimationPlayer çš„è¿™äº›åŠ¨ç”»æ’­æ”¾çš„ç›¸å…³ä¿¡å·ï¼Œå› ä¸ºå®ƒä»¬å±äºä¸åŒçš„å¯¹è±¡ã€‚


ä»¥æœ€ç®€å•çš„ 1D æ··åˆç©ºé—´ä¸ºä¾‹ï¼Œç»™ AnimationTree æ·»åŠ ä¸Š **AnimationNodeBlendSpace1D** æ ¹èŠ‚ç‚¹ï¼Œ
æ‰“å¼€ Bottom Panel ä¸­çš„åŠ¨ç”»æ ‘é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°æ··åˆç¼–è¾‘å™¨ä¸­åªæ˜¯ä¸€ç»´çš„æ—¶é—´åæ ‡è½´ï¼Œå¯ä»¥å¾€ä¸åŒçš„ä½ç½®æ·»åŠ 
åŠ¨ç”»èŠ‚ç‚¹ï¼Œæˆ–è€…åµŒå¥—åœ°æ·»åŠ å…¶å®ƒ Animation Root æ ¹èŠ‚ç‚¹ç”¨æ¥æ··åˆæ›´å¤šçš„å­èŠ‚ç‚¹ã€‚

ç›´æ¥é€šè¿‡ Create Points -> Add Animation å°†ä¸¤ä¸ªé’è›™è·³è·ƒåŠ¨ç”»æ·»åŠ åˆ°è½´çº¿ä¸Šï¼Œç„¶åè®¾ç½® Blending 
Positionï¼Œåœ¨ä¸¤ä¸ªåŠ¨ç”»å®šä½ç‚¹ä¹‹é—´ç§»åŠ¨ï¼Œå³æ··åˆä¸¤ä¸ªåŠ¨ç”»çš„æ•°æ®ã€‚åœ¨æ­£ä¸­ä¸­é—´æ—¶ï¼Œå› ä¸ºåŠ¨ç”»ä½¿ç”¨çš„ scale.x
åˆ†åˆ«ä¸º 1 å’Œåè½¬æ—¶çš„ -1ï¼Œæ‰€ä»¥ç»“æœä¼šå°†é’è›™çš„å›¾å½¢çš„ scale.x æ··åˆä¸º 0ï¼Œä½¿ç”¨å¾—å›¾åƒä¸å¯è§ã€‚å°†æ··åˆç‚¹
ç§»åŠ¨åˆ°ä»»æ„ä¸€ä¾§ï¼Œåˆ™ç»“æœå°±æ˜¯å®Œå…¨è¾“å‡ºæœ€é è¿‘çš„è¿™ä¸ªåŠ¨ç”»ï¼Œå¦ä¸€ä¸ªåŠ¨ç”»å¯¹ç»“æœå®Œå…¨æ²¡æœ‰å½±å“ã€‚

2D æ··åˆç©ºé—´åˆ™å¯ä»¥åœ¨äºŒç»´ç©ºé—´ä¸­è®¾ç½®æ··åˆç‚¹ï¼Œåœ¨äºŒç»´ç©ºé—´ä¸­è‡³å°‘æ”¾ç½® 3 ä¸ªåŠ¨ç”»ç‚¹ï¼Œä»¥å½¢æˆä¸€ä¸ª 2D å›¾å½¢åŒºåŸŸï¼Œ
å½“æ··åˆç‚¹ä¸åŠ¨ç”»ç‚¹è¶Šæ¥è¿‘æ—¶å°±å¾—åˆ°è¿™ä¸ªåŠ¨ç”»ç‚¹çš„æ›´å¤šæ··åˆé‡ï¼Œç›´åˆ°å®Œå…¨è¾“å‡ºè¿™ä¸ªåŠ¨ç”»ç‚¹çš„åŠ¨ç”»ï¼š

![BlendSpace2D](https://docs.godotengine.org/en/3.5/_images/animtree8.gif)

2D æ··åˆæ¨¡å¼æœ‰ä¸‰ç§é€‰æ‹©ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒBlend Mode ä¸ºçº¿æ€§æ¨¡å¼ï¼Œé€šè¿‡åœ¨æœ€è¿‘çš„ä¸‰è§’å½¢å†…æ’å…¥ç‚¹è¿›è¡Œæ··åˆã€‚
å¤„ç† 2D åŠ¨ç”»ï¼ˆé€å¸§ï¼‰æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ‡æ¢åˆ°ç¦»æ•£æ¨¡å¼ Discrete modeï¼Œä¸‹æ‹‰èœå•ä¸­æ˜¾ç¤ºä¸º 3 ä¸ªç‚¹ã€‚æˆ–è€…ï¼Œ
å¦‚æœå¸Œæœ›åœ¨ç¦»æ•£åŠ¨ç”»ä¹‹é—´åˆ‡æ¢æ—¶ä¿æŒå½“å‰æ’­æ”¾ä½ç½®ï¼Œåˆ™ä½¿ç”¨æœ‰è¿›ä½æ¨¡å¼ Carry modeã€‚

åŒæ ·ä½¿ç”¨é’è›™çš„è·³è·ƒåŠ¨ç”»æ¥æ¼”ç¤ºçŠ¶æ€æœºçš„ä½¿ç”¨ï¼Œç»™åŠ¨ç”»æ ‘æ·»åŠ  StateMachine æ ¹èŠ‚ç‚¹ï¼Œç„¶ååœ¨åº•é¢æ¿çš„åŠ¨ç”»æ ‘
ç¼–è¾‘å™¨ä¸­ï¼Œç‚¹å‡»çŠ¶æ€æœºç®¡ç†ç•Œé¢ä¸­çš„ + å·å¢åŠ åŠ¨ç”»èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ·»åŠ  jump_leftã€jump_rightï¼Œè¿˜æœ‰åŠ¨ç”»æ ‘
é»˜è®¤æä¾›çš„ RESETï¼Œå³ä¼‘æ¯èŠ‚ç‚¹ï¼Œæ²¡æœ‰åŠ¨ç”»çš„é™æ­¢çŠ¶æ€ã€‚ç„¶åï¼Œç‚¹å‡»ç©¿çº¿ç®­å¤´å›¾æ ‡ï¼Œçœ‹èµ·æ¥åƒé£æœºï¼Œç»™ä¸‰ä¸ªçŠ¶æ€
æ·»åŠ è¿æ¥çº¿ï¼Œä½¿ç”¨ RESET ä¸å…¶å®ƒä¸¤ä¸ªåŠ¨ç”»å®ç°åŒå‘è¿æ¥ï¼Œè€Œä¸¤ä¸ªè·³è·ƒåŠ¨ç”»ç›¸äº’ä¸è¿æ¥ã€‚

ä¾‹å¦‚ï¼Œå½“å‰å¤„äº jump_left çŠ¶æ€ä¸­ï¼Œæ’­æ”¾çš„å°±æ˜¯å‘å·¦è·³è·ƒåŠ¨ç”»ã€‚ç„¶åï¼Œå†ç‚¹å‡» jump_right çŠ¶æ€çš„æ’­æ”¾å›¾æ ‡ï¼Œ
å¦‚æœ Play Mode è®¾ç½®ä¸ºéå†æ¨¡å¼ Travelï¼Œè¡¨ç¤ºçŠ¶æ€ä¸ä¼šç›´æ¥ä» jump_left åˆ‡æ¢åˆ° jump_rigth çŠ¶æ€ï¼Œ
è€Œæ˜¯æŒ‰è¿æ¥çº¿ï¼Œå…ˆåˆ‡æ¢åˆ° RESET çŠ¶æ€ï¼Œå†åˆ‡æ¢åˆ° jump_right åŠ¨ç”»çŠ¶æ€ã€‚

çŠ¶æ€æœºä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼Œå¯¹åº”çš„ä¸€ä¸ªåŠ¨ç”»ï¼Œç‚¹å‡»çŠ¶æ€èŠ‚ç‚¹ä¸Šçš„æ’­æ”¾å›¾æ ‡å°±å¯ä»¥åˆ‡æ¢åˆ°è¿™ä¸ªçŠ¶æ€ã€‚èŠ‚ç‚¹ä¸Š
æ˜¾ç¤ºçš„æ–‡å­—å°±æ˜¯çŠ¶æ€åç§°ï¼Œè°ƒç”¨ **start()** ç­‰æ–¹æ³•åšçŠ¶æ€è½¬æ¢æ—¶ï¼Œéœ€è¦ä½¿ç”¨è¿™ä¸ªåç§°ï¼Œä¸å› ä¸ºæœ‰ç©ºæ ¼å¯¼è‡´
çŠ¶æ€åç§°ä¸åŒ¹é…è€Œä¸èƒ½æ’­æ”¾åŠ¨ç”»ã€‚èŠ‚ç‚¹çŠ¶æ€ä¼šä¸€ç›´ä¿æŒæ’­æ”¾çŠ¶æ€ï¼Œé™¤éè°ƒç”¨ **stop()** æ–¹æ³•åœæ­¢ã€‚

æ³¨æ„ï¼Œé»˜è®¤çš„ **RESET** åŠ¨ç”»ç”¨äºæœ€åˆåŠ è½½å¯¹è±¡æ—¶çš„å§¿æ€ï¼Œåªæœ‰ä¸€ä¸ªå¸§ï¼Œå¹¶ä¸”ä¸æœŸå¾…è¢«ç”¨äºæ—¶é—´è½´çš„å›æ”¾ã€‚
ä¸ºäº†åŠ¨ç”»æ··åˆç»“æœå¯ä»¥é‡æ’­ä¿æŒä¸€è‡´ï¼Œè¦æ··åˆçš„å±æ€§éœ€è¦è®¾ç½®åˆå§‹å€¼ã€‚æ‰€ä»¥ï¼Œåœ¨çŠ¶æ€æœºä¸­æ‰§è¡Œäº† RESET åŠ¨ç”»
çŠ¶æ€æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå½±å“åˆ°å…¶å®ƒå’Œ RESET ç›¸å…³çš„åŠ¨ç”»ã€‚

å¯¹äº Skeleton3D éª¨éª¼ä½¿ç”¨ä½ç½®/æ—‹è½¬/ç¼©æ”¾ 3D è½¨è¿¹æ—¶ï¼Œåˆå§‹å€¼ä¸ºå¤ä½éª¨éª¼ Bone Restã€‚å¯¹äºå…¶ä»–å±æ€§ï¼Œ
åˆå§‹å€¼æ˜¯ 0ï¼Œå¦‚æœè½¨è¿¹å‡ºç°åœ¨ **RESET** åŠ¨ç”»ä¸­ï¼Œåˆ™ä½¿ç”¨å…¶ç¬¬ä¸€ä¸ªå…³é”®å¸§çš„å€¼ã€‚

2D æˆ–è€… 3D çš„æ—‹è½¬è½¨é“è®¾ç½®çš„æ’å€¼æ–¹å¼ä¸ºçº¿æ€§è§’æˆ–è€…ç«‹æ–¹ä½“è§’åº¦æ—¶ï¼ŒLinear Angle or Cubic Angleï¼Œ
å¯ä»¥ç”¨æ¥é™åˆ¶æ—‹è½¬è§’åº¦ä¿æŒåœ¨ä¸åˆå§‹è§’åº¦åˆ° 180 åº¦çš„èŒƒå›´ï¼Œè¿™å¯ä»¥ç”¨æ¥é¿å…è§’è‰²è‚¢ä½“å‘ç”Ÿè¿åç”Ÿç†ç°è±¡çš„æ—‹è½¬ã€‚
å¯ä»¥åœ¨æ··åˆåŠ¨ç”»æ—¶é˜²æ­¢éª¨éª¼ç©¿é€èº«ä½“ï¼Œå› æ­¤ï¼ŒSkeleton3D çš„ Bone Rest å€¼åº”å°½å¯èƒ½æ¥è¿‘å¯ç§»åŠ¨èŒƒå›´çš„ä¸­ç‚¹ã€‚
è¿™æ„å‘³ç€ï¼Œå¯¹äºäººå½¢æ¨¡å‹ï¼Œæœ€å¥½ä»¥ T å½¢å§¿åŠ¿å¯¼å…¥ã€‚åƒä¸Šé¢çš„è§’è‰²æ¼”ç¤ºåŠ¨ç”»è¿™æ ·ï¼Œå¯ä»¥çœ‹åˆ°åŠ¨ç”»æŒ‰ Bone Rests
ä½ç½®ä¼˜åŒ–æœ€çŸ­çš„æ—‹è½¬è·¯å¾„ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªåŠ¨ç”»ä¹‹é—´çš„æœ€çŸ­æ—‹è½¬è·¯å¾„ã€‚

éœ€è¦é€šè¿‡æ··åˆåŠ¨ç”»æ—‹è½¬ Skeleton3D è¶…è¿‡ 180 åº¦çš„æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Root Motion åŠŸèƒ½ã€‚é€šè¿‡åŠ¨ç”»æ ‘
è·å–åˆ°çš„ Root Motion æ˜¯ä¸€ä¸ªå˜æ¢çŸ©é˜µå¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ ¹éª¨éª¼çš„å®æ—¶è¿åŠ¨ï¼Œå¯ä»¥å°†è¿™ä¸ªå˜æ¢ä¿¡æ¯ä¼ é€’ç»™è§’è‰²
æ§åˆ¶ç±»å‹çš„è¿åŠ¨å¤„ç†æ–¹æ³•å°±å¯ä»¥è®©åŠ¨ç”»å‰åæµç•…åœ°æ‹¼æ¥èµ·æ¥ï¼š

```py
func _process(delta):
    var motion:Transform = animation_tree.get_root_motion_transform()
    # This can be fed to functions to control the character movement, such as 
    # KinematicBody.move_and_slide (Godot 3.x)
    # CharacterBody3D.move_and_slide (Godot 4.x) 
```

çŠ¶æ€è½¬æ¢æ¨¡å¼è®¾ç½®å†³å®šäº†çŠ¶æ€æœºå¦‚ä½•åˆ‡æ¢åŠ¨ç”»ï¼Œæœ‰ 3 ä¸ªåˆ‡æ¢æ¨¡å¼ï¼š

- Immediateï¼šç«‹å³æ¨¡å¼ï¼Œå°†ç«‹å³åˆ‡æ¢åˆ°ä¸‹ä¸€çŠ¶æ€ï¼Œå½“å‰çŠ¶æ€å°†ç»“æŸå¹¶èå…¥æ–°çŠ¶æ€çš„å¼€å§‹ã€‚
- Syncï¼šåŒæ­¥æ¨¡å¼ï¼Œå°†ç«‹å³åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä½†ä¼š seek å¯»æ‰¾åˆ°æ–°çŠ¶æ€åˆ°ä¸æ—§çŠ¶æ€ä¸€è‡´çš„å›æ”¾ä½ç½®ã€‚
- At Endï¼šç»“æŸæ—¶æ¨¡å¼ï¼Œå°†ç­‰å¾…å½“å‰çŠ¶æ€æ’­æ”¾ç»“æŸï¼Œç„¶ååˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€åŠ¨ç”»çš„å¼€å§‹ã€‚


A* ç®—æ³•å®ç°çš„éå†åŠŸèƒ½æ˜¯ Godot çš„ StateMachine å®ç°ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥æŒ‡ç¤ºä»å½“å‰çŠ¶æ€è½¬åˆ°
å¦ä¸€ä¸ªçŠ¶æ€å›¾ï¼ŒåŒæ—¶è®¿é—®æ‰€æœ‰ä¸­é—´çŠ¶æ€ã€‚è¦ä½¿ç”¨çŠ¶æ€éå†åŠŸèƒ½æˆ–è¿›è¡ŒçŠ¶æ€è½¬æ¢ï¼Œé¦–å…ˆï¼Œä»åŠ¨ç”»æ ‘èŠ‚ç‚¹æ£€ç´¢å‡ºçŠ¶æ€æœº
å›æ”¾å¯¹è±¡ **AnimationNodeStateMachinePlayback**ã€‚æ³¨æ„ï¼Œå®ƒé€šè¿‡å¯¼å‡ºçš„å±æ€§å¼•ç”¨ï¼Œå±æ€§å¯¼å‡ºè·¯å¾„å¯ä»¥
åœ¨åŠ¨ç”»æ ‘çš„å±æ€§é¢æ¿ä¸­æ‰¾ Parameters -> Playbackï¼Œæ‹–åŠ¨å±æ€§åˆ°è„šæœ¬ç¼–è¾‘å™¨ä¸­å³å¯ï¼Œç„¶åä½¿ç”¨ Object 
**get()** æ–¹æ³•è·å–ã€‚è°ƒç”¨ **get_travel_path()** å¯ä»¥è·å–éå†çš„è·¯å¾„ï¼š

```py
# AnimationNodeStateMachinePlayback
var playback_path = "parameters/playback" # or parameters/StateMachine/playback
var state_machine = $AnimationTree.get(playback_path)
state_machine.travel("jump_left")
state_machine.start("jump_right")
```

å¯¹äºå·²å¯¹é…ç½®å¥½çš„åŠ¨ç”»æ ‘æ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥åœ¨åŠ¨ç”»æ ‘çš„å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸­ç‚¹å‡» Tree Root å±æ€§å³ä¾§çš„ä¸‹æ‹‰èœå•ä¿å­˜
åˆ°åŠ¨ç”»æ ‘èµ„æºæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åç»­å†ä½¿ç”¨ã€‚Blend Tree ç¼–è¾‘å™¨ä¹Ÿå¯ä»¥ä¿å­˜èŠ‚ç‚¹èµ„æºé…ç½®ï¼Œæ“ä½œéº»çƒ¦ç‚¹ï¼š

- ç‚¹å‡» Blend Tree å±æ€§æ¢æµ‹å™¨é¢æ¿ä¸Šä¸‹æ‹‰èœå•ï¼Œç«–ç›´çš„ä¸‰ä¸ªç‚¹å›¾æ ‡ï¼Œæ‰§è¡Œ Make Resource Built-inï¼›
- ç‚¹å‡»ç£ç›˜å›¾æ ‡å¼¹å‡ºèœå•çš„ Save æ‰§è¡Œå…³è”å¼ä¿å­˜ï¼Œè¿™ç§æ–¹å¼ä¼šå°†èŠ‚ç‚¹å…³è”åˆ°ä¸€ä¸ªèµ„æºæ–‡ä»¶ï¼Œä¿å­˜é¡¹ç›®æ—¶ä¹Ÿä¼šå†™å…¥ï¼›
- æˆ–è€…ï¼Œç›´æ¥ç‚¹å‡» Save As... å¦å­˜èµ„æºæ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šæ‰§è¡Œå…³è”æ“ä½œï¼Œä¿å­˜é¡¹ç›®æ—¶ä¹Ÿä¸ä¼šä¸»åŠ¨å†™å…¥è¿™ä¸ªæ–‡ä»¶ï¼›
- å¯¹äºå·²ç»å…³è”ä¿å­˜çš„èŠ‚ç‚¹èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥å†æ¬¡æ‰§è¡Œ Make Resource Built-in å°†èµ„æºæ•°æ®å†…ç½®ï¼Œä¸å†ä½¿ç”¨æ–‡ä»¶ï¼›

ä¸ºäº†æ–¹ä¾¿å¤ç”¨å·²ç»é…ç½®å¥½çš„åŠ¨ç”»èŠ‚ç‚¹èµ„æºï¼Œæ ¹æ®éœ€è¦é€‰æ‹©è¿™ä¸¤ç§èµ„æºä¿å­˜æ–¹å¼ï¼Œå…³è”å¼ä¿å­˜å¯ä»¥åœ¨ä¿®æ”¹èŠ‚ç‚¹åè‡ªåŠ¨åœ¨
ä¿å­˜é¡¹ç›®æ—¶æ›´æ–°èµ„æºæ–‡ä»¶ï¼Œéå…³è”å¼ä¿å­˜åˆ™å¯ä»¥é¿å…è¿™ç§è‡ªåŠ¨æ›´æ–°ï¼Œå¯¹äºä¸éœ€è¦æˆ–å¾ˆå°‘æ›´æ–°èµ„æºï¼Œå°±ä¸éœ€è¦å…³è”ã€‚


**Blend Tree** æ··åˆæ ‘å¯ä»¥æ··åˆä¸åŒçš„æ ¹èŠ‚ç‚¹ï¼Œå®ƒæ€»æ˜¯æœ‰ä¸€ä¸ªé»˜è®¤è¾“å‡ºèŠ‚ç‚¹ï¼ŒAnimationNodeOutputï¼Œ
å¯ä»¥å°†å„ç§æ··åˆèŠ‚ç‚¹è¿æ¥åˆ°è¾“å‡ºèŠ‚ç‚¹ï¼Œä¹Ÿå¯æ·»åŠ ä¸åŒç±»å‹çš„æ··åˆèŠ‚ç‚¹ï¼Œä»¥æ··åˆå¤šä¸ªåŠ¨ç”»ï¼š

- **AnimationNodeAdd2** 2 ç«¯å£å åŠ æ··åˆï¼ŒAdd Amount æŒ‡å®šå åŠ æ¯”ä¾‹ï¼Œ0.0 è¡¨ç¤ºä¸å åŠ  add ç«¯å£ã€‚
- **AnimationNodeAdd3** 3 ç«¯å£å åŠ æ··åˆï¼ŒAdd Amount æŒ‡å®šå åŠ æ¯”ä¾‹ï¼Œ0.0 è¡¨ç¤ºä¸å åŠ  Â±add ç«¯å£ã€‚
- **AnimationNodeBlend2** 2 ç«¯å£æ··åˆï¼ŒBlend Amount æŒ‡å®šæ··åˆæ¯”ä¾‹ï¼Œ0.0 è¡¨ç¤ºä¸æ··åˆ bledn ç«¯å£ã€‚
- **AnimationNodeBlend3** 3 ç«¯å£æ··åˆï¼ŒBlend Amount æŒ‡å®šæ··åˆæ¯”ä¾‹ï¼Œ0.0 è¡¨ç¤ºä¸æ··åˆ Â±bledn ç«¯å£ã€‚
- **AnimationNodeOneShot** å•æ¬¡è§¦å‘ï¼ŒActive æ‰“å¼€æ—¶ï¼Œè¡¨ç¤ºè§¦å‘ shot è¾“å…¥ç«¯å£çš„åŠ¨ç”»ã€‚
- **AnimationNodeTimeScale** æ—¶é—´ç¼©æ”¾ï¼Œå¯¹è¾“å…¥ç«¯çš„åŠ¨ç”»è¿›è¡Œé€Ÿåº¦ç¼©æ”¾ï¼Œ0 è¡¨ç¤ºåŠ¨ç”»åœæ­¢ã€‚
- **AnimationNodeTimeSeek** åŠ¨ç”»æ—¶é—´å®šä½ï¼Œç”¨äºæ”¹å˜åŠ¨ç”»å›æ”¾æ—¶é—´ç‚¹ã€‚
- **AnimationNodeTransition** æ˜¯ä¸€ä¸ªç®€å•çŠ¶æ€æœºï¼Œé€‚ç”¨äºä¸éœ€è¦æ›´é«˜çº§çš„çŠ¶æ€æœºçš„æƒ…å†µã€‚

å…¶ä¸­ NodeAdd2ã€NodeAdd3ã€NodeBlend2ã€OneShot è¿™ä¸‰ç§æ··åˆæ–¹å¼éƒ½å¯ä»¥è®¾ç½®è¿‡æ»¤å™¨åŠ¨ç”»è½¨é“ï¼Œå³å¯ä»¥
å•ç‹¬æ§åˆ¶å“ªäº›è½¨è¿¹é€šè¿‡æ··åˆåŠŸèƒ½ï¼Œè¿™å¯¹äºå°†åŠ¨ç”»å±‚å åœ¨ä¸€èµ·éå¸¸æœ‰ç”¨ã€‚ç‚¹å‡» Edit Filtersï¼Œå‹¾é€‰æ¿€æ´»é€‰é¡¹ï¼Œ
å¹¶è®¾ç½®éœ€è¦ä½œä¸ºè¿‡æ»¤å™¨çš„åŠ¨ç”»è½¨é“ï¼Œä»¥æ··åˆä½¿ç”¨è¿™äº›è½¨é“æ§åˆ¶åŠ¨ç”»ã€‚

å åŠ ä¸æ··åˆä¸¤ç§æ–¹å¼çš„å·®åˆ«åœ¨äºï¼Œå åŠ æ–¹å¼æ˜¯åŠ æ³•å™¨ï¼ŒAdd Mount ä¸º 1.0 æ—¶ add ç«¯å£çš„åŠ¨ç”»ä¼šå®Œå…¨å åŠ åœ¨
in ç«¯å£è¾“å…¥çš„åŠ¨ç”»ä¸Šï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥ç»„ç»‡å¤šä¸ªè§’è‰²çš„åŠ¨ç”»ï¼Œä¸€ä¸ª Blend Tree å°±å¯ä»¥å®‰æ’å¤šä¸ªè§’è‰²çš„åŠ¨ç”»ã€‚
è€Œæ··åˆæ–¹å¼ Blend è¡¨ç¤º Mixture çš„æ„æ€ï¼Œæ…æ‹Œåœ¨ä¸€èµ·ï¼ŒBlend Amount è®¾ç½®ä¸º 1.0 è¡¨ç¤ºæ··åˆçš„ç»“æœåª
æœ‰ Blend ç«¯å£çš„åŠ¨ç”»ï¼Œin ç«¯å£çš„åŠ¨ç”»å®Œå…¨æ²¡æœ‰ã€‚åä¹‹ï¼Œ0.0 è¡¨ç¤ºåªä¼šæ’­æ”¾ in ç«¯å£çš„åŠ¨ç”»ï¼ŒBlend ç«¯å£çš„
åŠ¨ç”»å®Œå…¨ä¸è€ƒè™‘ã€‚å…¶å®ƒå€¼åˆ™è¡¨ç¤ºåœ¨è¾“å…¥åŠ¨ç”»ä¹‹é—´çš„æ··åˆçŠ¶æ€ã€‚Blend3 çš„æ··åˆæ¯”ä¾‹åœ¨ [-1.0, 1.0]ï¼Œ-1 å’Œ 1
åˆ†åˆ«è¡¨ç¤ºåªè¾“å‡º -blend å’Œ +blend ç«¯å£è¾“å…¥çš„åŠ¨ç”»ï¼Œè®¾ç½®ä¸º 0.0 è¡¨ç¤ºåªè¾“å‡º in ç«¯å£çš„åŠ¨ç”»ã€‚

ä»¥ä¸‹æ˜¯ Blend2 æ··åˆèŠ‚ç‚¹çš„æ•ˆæœæ¼”ç¤ºï¼š

![Blend2](https://docs.godotengine.org/en/latest/_images/blending5.webp)

æ‰€æœ‰æ··åˆèŠ‚ç‚¹éƒ½ä½œä¸ºå¯¼å‡ºå±æ€§ï¼Œå±æ€§è®¿é—®è·¯å¾„é€šè¿‡åŠ¨ç”»æ ‘çš„å±æ€§æ¢æµ‹å™¨é¢æ¿è·å–ï¼ŒParameters åŒ…å«æ‰€æœ‰å·²æ·»åŠ èŠ‚ç‚¹ã€‚

OneShot æ··åˆæ ¹æ®åŠ¨ç”»æ˜¯å¦å¯ç”¨ Loop å¾ªç¯æ’­æ”¾æœ‰ä¸åŒè¡¨ç°ï¼Œshot ç«¯å£è¾“å…¥çš„åŠ¨ç”»åœ¨ä¸å¯åŠ¨å¾ªç¯æ’­æ”¾çŠ¶æ€ä¸‹ï¼Œ
æ’­æ”¾å®Œæˆæ—¶å°±ä¼šè¿”å›åˆ° in ç«¯å£çš„åŠ¨ç”»çŠ¶æ€ã€‚é€šå¸¸ç”¨æ¥ç»™è§’è‰²æ·»åŠ å¼€ç«çš„åŠ¨ä½œï¼Œæ‰€ä»¥å«åšå•æ¬¡å°„å‡»ã€‚

Transition åšç®€å•çš„çŠ¶æ€è½¬æ¢ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªçŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´è½¬æ¢æ—¶é—´å¯ä»¥åœ¨ Xfade Time å±æ€§ä¸­è®¾ç½®ï¼Œ
è®¾ç½® Input Count ç¡®å®šå¥½è¾“å…¥ç«¯å£æ•°é‡ï¼Œå³çŠ¶æ€æ•°é‡ï¼Œç„¶åå°†åŠ¨ç”»è¿æ¥åˆ°è¾“å…¥ç«¯å£ã€‚ç„¶åé€šè¿‡å¯¼å‡ºçš„ current
å±æ€§è®¾ç½®å½“å‰çŠ¶æ€ï¼ŒçŠ¶æ€æœºå°±ä¼šä»ä¸Šä¸€ä¸ªçŠ¶æ€è½¬æ¢åˆ°æ–°çš„çŠ¶æ€ã€‚æ­¤åŠŸèƒ½åœ¨ Godot 3.x ä¸­è¿˜ä¸å®Œå–„ï¼Œåœ¨å±æ€§é¢æ¿ä¸­
æ·»åŠ è¾“å…¥ç«¯å£åï¼Œä¼šæç¤ºçŠ¶æ€ç«¯å£æ²¡æœ‰è¿æ¥ï¼Œç¼–è¾‘ç•Œé¢ä¹Ÿæ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¯ä»¥åœ¨æ·»åŠ ç«¯å£åå°† Transition è¿æ¥
åˆ°å…¶å®ƒç«¯å£å†æ–­å¼€è¯•è¯•ï¼Œä¸è¡Œå°±å¯èƒ½éœ€è¦é‡æ–°åŠ è½½åŠ¨ç”»æ ‘æˆ–åœºæ™¯ã€‚

Transition æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨æ¨è¿›é€‰é¡¹ Auto Advanceï¼Œæ¿€æ´»å®ƒï¼Œå½“å‰çŠ¶æ€è½¬æ¢å®Œæˆåï¼Œå³åŠ¨ç”»æ’­æ”¾å®Œæˆåï¼Œ
è‡ªåŠ¨æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å¦‚æœæ‰€æœ‰çŠ¶éƒ½æ¿€æ´»äº†è‡ªåŠ¨æ¨è¿›ï¼Œå°±ä¼šåƒ Loop æ¨¡å¼ä¸€æ ·å¾ªç¯æ’­æ”¾å„ä¸ªçŠ¶æ€çš„åŠ¨ç”»ã€‚

TimeSeek åšåŠ¨ç”»å›æ”¾æ—¶é—´å®šä½æ—¶ï¼Œåœ¨è®¾ç½®å¥½ seek_position æ—¶é—´ç‚¹åï¼Œä¼šè‡ªåŠ¨åœ¨ä¸‹ä¸€å¤„ç†å¸§è¿›å…¥ç¡çœ æ¨¡å¼ï¼Œ
é€šè¿‡è®¾ç½® seek_position å€¼ä¸º -1.0 ä½¿å…¶ä¸å†æœ‰ä½œç”¨ã€‚

```py
# Play child animation from the start.
animation_tree.set("parameters/Seek/seek_position", 0.0)
# Alternative syntax (same result as above).
animation_tree["parameters/Seek/seek_position"] = 0.0

# Play child animation from 12 second timestamp.
animation_tree.set("parameters/Seek/seek_position", 12.0)
# Alternative syntax (same result as above).
animation_tree["parameters/Seek/seek_position"] = 12.0
```

æ··åˆæ ‘çš„å¯è§†åŒ–èŠ‚ç‚¹ç¼–è¾‘ç›®å‰æ“ä½œä¸Šè¿˜ä¸æµç•…ï¼Œè€Œä¸”æ‰€æœ‰è¿æ¥åˆ° Output èŠ‚ç‚¹ï¼Œæ‰€æœ‰è¾“å…¥ç«¯å£å¿…éœ€æœ‰è¿æ¥ï¼Œå¦åˆ™
ä¸èƒ½æ­£å¸¸æ’­æ”¾åŠ¨ç”»ã€‚èŠ‚ç‚¹è¿æ¥æ“ä½œä¹Ÿä¸æ˜¯å¾ˆä¾¿åˆ©ï¼Œå¿…éœ€å…ˆæ–­å¼€åŸæœ‰è¿æ¥ï¼Œæ‰èƒ½è¿æ¥æ–°çš„èŠ‚ç‚¹ã€‚



## ğŸŸ¡ Physics ç‰©ç†ç³»ç»Ÿ
- https://docs.godotengine.org/en/latest/tutorials/physics/physics_introduction.html
- [GAMES201-é«˜çº§ç‰©ç†å¼•æ“å®æˆ˜æŒ‡å— - èƒ¡æ¸Šé¸£](https://www.bilibili.com/video/BV1ZK411H7Hc)
- [Godot å¹³å°è·³è·ƒæ¸¸æˆæ•™ç¨‹ - å¦‚ä½•å®ç°æ”»å‡»åˆ¤å®š](https://www.bilibili.com/video/BV1Nt4y1e7yd?p=9)
- [2D Physics Tests](https://github.com/godotengine/godot-demo-projects/tree/master/2d/physics_tests)
- [3D Physics Tests](https://github.com/godotengine/godot-demo-projects/tree/master/3d/physics_tests)

ç‰©ç†ç³»ç»Ÿæ˜¯æ¸¸æˆå¼•æ“ä¸­çš„ä¸€ä¸ªå¤§ç³»ç»Ÿï¼Œå›¾å½¢å­¦ä¸“é—¨å¼€è®¾æœ‰ç‰©ç†å¼•æ“è¯¾ç¨‹æ¥è®²è§£å®ƒã€‚ç‰©ç†ç³»ç»Ÿå®ç°çœŸå®ä¸–ç•Œçš„ç‰©ç†åŸç†ï¼Œ
ä¼šæ¶‰åŠä»¥ä¸‹åŸºæœ¬ç‰©ç†å¯¹è±¡æ¦‚å¿µï¼Œä¸»è¦å†…å®¹æ˜¯ 4 ç§ç¢°æ’ä½“çš„ç¢°æ’æ£€æµ‹ä¸å“åº”å¤„ç†ï¼š

- Area2D/3D ç‰©ç†æ¢æµ‹åŒºï¼Œå¯ä»¥æ£€æµ‹è¿›å…¥ã€ç¦»å¼€ç­‰è¡Œä¸ºï¼Œä¹Ÿå¯ç”¨äºè¦†ç›–å®šä¹‰åŒºåŸŸä¸­çš„ç‰©ç†å±æ€§ï¼Œä¾‹å¦‚é‡åŠ›æˆ–é˜»å°¼ã€‚
- RigidBody2D/3D åˆšä½“ï¼Œä¸ä¼šå˜å½¢çš„ç‰©ä½“ï¼Œç”¨æˆ·ä¸ç›´æ¥æ§åˆ¶ï¼Œè€Œæ˜¯åº”ç”¨åŠ›ï¼ˆgravity, impulsesï¼‰æ”¹å˜å…¶è¡Œä¸ºã€‚
- StaticBody2D/3D é™æ€ç‰©ç†ä½“ï¼Œå…·æœ‰ç‰©ç†æ€§è´¨ï¼Œå‚ä¸ç¢°æ’ï¼Œä½†ç‰©ç†å¼•æ“ä¸ä¼šç§»åŠ¨å®ƒä»¬ï¼›
- CharacterBody2D/3D è§’è‰²è¿åŠ¨å­¦å½¢ä½“ï¼Œæ—§ç‰ˆä¸º KinematicBodyã€‚åªæä¾›ç¢°æ’æ£€æµ‹ï¼Œä½†ç”¨æˆ·è¦å®ç°ç¢°æ’å“åº”ï¼ŒåŒ…å«é‡åŠ›ã€é˜»åŠ›ç­‰ç­‰ã€‚

é™¤äº†ç‰©ç†æ¢æµ‹åŒºï¼Œå…¶å®ƒä¸‰ç§ç‰©ç†å¯¹è±¡éƒ½ç»§æ‰¿è‡ª PhysicsBody2D/3Dï¼Œè€Œç‰©ç†ä½“åˆç»§æ‰¿è‡ª CollisionObjectã€‚

æ­¤å¤–ï¼Œè¿˜æœ‰å…¶å®ƒä¸€äº›ç‰©ç†æ¨¡å‹ï¼š

- SoftBody è½¯ä½“
- Ray-casting å°„çº¿æŠ•å°„
- Ragdoll system ç¢å¸ƒç©å¶ç³»ç»Ÿ

Godot 4.x æ·»åŠ äº†æ–°åŠŸèƒ½ï¼Œä¸æ—§ç‰ˆæœ¬æœ‰å·®åˆ«ã€‚

æ³¨æ„ï¼Œä¸è¦æ”¹å˜ç¼©æ”¾å±æ€§ï¼ŒScale å¿…éœ€ä¿æŒä¸º (1, 1)ï¼Œç‰©ç†å¼•æ“å¹¶ä¸ä½¿ç”¨ç¼©æ”¾å°ºå¯¸ã€‚å¦å¤–ï¼Œç‰©ç†å¼•æ“ä¸ºäº†æä¾›
è¿ç®—æ•ˆç‡ï¼Œä¼šä½¿ç”¨å¤šçº¿ç¨‹ï¼Œç‰©ä½“ä½ç½®æˆ–è€…çº¿æ€§é€Ÿåº¦ç­‰å±æ€§åœ¨å½“å‰å¸§ä¸­å¯èƒ½ä¸ç²¾ç¡®ï¼Œä¸ºäº†ä½¿ç”¨ç²¾ç¡®å€¼ï¼Œå°±éœ€è¦ä½¿ç”¨
`Node._physics_process()` å›è°ƒã€‚

Godot ä½¿ç”¨çš„ç‰©ç†å¼•æ“å¯åœ¨é¡¹ç›®é…ç½®ä¸­ä¿®æ”¹ï¼Œé»˜è®¤é›†æˆäº† Bullet å’Œå†…ç½®çš„ç‰©ç†å¼•æ“ï¼š

```py
enum PhysicsEngine {
    BULLET,
    GODOT_PHYSICS,
    OTHER,
}

var _engine = PhysicsEngine.OTHER


func _enter_tree():
    pause_mode = Node.PAUSE_MODE_PROCESS

    get_tree().debug_collisions_hint = true

    var engine_string = ProjectSettings.get_setting("physics/3d/physics_engine")
    match engine_string:
        "DEFAULT":
            _engine = PhysicsEngine.BULLET
        "Bullet":
            _engine = PhysicsEngine.BULLET
        "GodotPhysics":
            _engine = PhysicsEngine.GODOT_PHYSICS
        _:
            _engine = PhysicsEngine.OTHER
```


åœ¨æ¸¸æˆä¸­ï¼ŒNPC æˆ–æ•Œäººä¹‹ç±»çš„è¿åŠ¨å¯ä»¥é€šè¿‡ VisibilityEnabler æ¥æ§åˆ¶ï¼Œå®ƒä¼šåœ¨è¿›å…¥ç©å®¶è§†é‡åæ‰ä¼šè¿åŠ¨ï¼Œ
é€šè¿‡æ§åˆ¶ RigidBody æˆ– AnimationPlayer ç­‰çˆ¶èŠ‚ç‚¹çš„ disabled çŠ¶æ€æ¥å®ç°è¿™ä¸€æ•ˆæœï¼Œæˆ–è€…å†»ç»“çŠ¶æ€ï¼Œ
é€šè¿‡ç›‘å¬ screen_enterd æˆ– viewport_enterd ç­‰ä¿¡å·ï¼Œå¯ä»¥æ”¹å˜å…¶æœ¬èº«çš„è¡Œä¸ºã€‚

**VisibilityEnabler** åªèƒ½åœ¨åœºæ™¯åˆå§‹åŒ–ä¹‹å‰æ·»åŠ æ‰ä¼šç”Ÿæ•ˆï¼Œå¹¶ä¸”ä¿å¯¹åŒä¸€ä¸ªåœºæ™¯ä¸‹çš„èŠ‚ç‚¹æœ‰å½±å“ã€‚å¦‚æœï¼Œåª
éœ€è¦å¤„ç†ç›¸å…³é€šçŸ¥ï¼Œå¯ä»¥ä½¿ç”¨çˆ¶ç±»å‹ **VisibilityNotifier** æ›¿ä»£ã€‚



### ğŸŸ ğŸ”µ Collision & Shape
- https://docs.godotengine.org/en/latest/tutorials/physics/collision_shapes_2d.html
- https://docs.godotengine.org/en/latest/tutorials/physics/collision_shapes_3d.html
- godot-docs\classes\class_collisionshape2d.rst
- godot-docs\classes\class_collisionpolygon2d.rst
- godot-docs\classes\class_shape2d.rst


ç¢°æ’å¯¹è±¡å¯ä»¥åˆ†å±‚ç®¡ç†ï¼Œå®ƒä¸è¢«é®ç½©çš„å±‚ä¸­çš„å¯¹è±¡æ‰ç›¸äº’å‘ç”Ÿç¢°æ’ï¼Œç¢°æ’å¯¹è±¡å¯ä»¥æ‰«æå¤šè¾¾ 32 ä¸ªç¢°æ’å±‚ï¼Œé€šè¿‡
é®ç½©å±æ€§è®¾ç½®é®ç½©å±‚ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ˜¯åˆ†å±‚ç¢°æ’ç³»ç»Ÿä¸­ä½¿ç”¨å±æ€§ï¼š

- collision_layer è®¾ç½®ç‰©ç†å¯¹è±¡æ‰€åœ¨å±‚ï¼Œé»˜è®¤ä¸º layer 1ã€‚
- collision_mask  è®¾ç½®ç‰©ä½“éœ€è¦æ‰«æå“ªäº›å±‚ä»¥è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œå¦‚æœå¯¹è±¡ä¸åœ¨å…¶ä¸­é®ç½©å±‚ä¸­ï¼Œå°†å¿½ç•¥å®ƒã€‚

å±‚çš„åç§°å¯ä»¥é€šè¿‡ Project Settings -> Layer Names ä¿®æ”¹ã€‚

PhysicsBody2D/3D ç¢°æ’å¯¹è±¡æœ¬èº«åªæä¾›ç¢°æ’æ£€æµ‹é€»è¾‘ï¼Œéœ€è¦åœ¨å­çº§èŠ‚ç‚¹ä¸­ç»™å‡ºä¸€ä¸ªç¢°æ’æ£€æµ‹è¾¹ç•ŒèŒƒå›´å®šä¹‰ã€‚
æœ‰ä¸¤ç§æ–¹å¼å®šä¹‰ç¢°æ’å½¢çŠ¶ï¼š

- CollisionPolygon æ­¤ç›´æ¥åœ¨ç¼–è¾‘å™¨ç»˜ç”»å¤šè¾¹å½¢ï¼Œæä¾›å›¾å½¢ç”¨äºç¡®å®šç¢°æ’æ£€æµ‹çš„è¾¹ç•ŒèŒƒå›´ã€‚
- CollisionShape ç¢°æ’å›¾å½¢æ–¹å¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŸºç¡€ç¢°æ’å½¢çŠ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Mesh æ¥ç”Ÿæˆ Shapeã€‚

ç¢°æ’å½¢çŠ¶çš„å…·ä½“å®šä¹‰ä¿å­˜åœ¨ Shape2D/3D èµ„æºä¸­ï¼Œç¢°æ’å½¢çŠ¶å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œåœ¨ç¢°æ’æ£€æµ‹æ—¶é€ä¸ªè¿›è¡Œæ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ
åœ¨ Area2D/3D ä¿¡å·äº‹ä»¶ä¸­å¯ä»¥è·å–åˆ°ç›¸åº”çš„ Shape èŠ‚ç‚¹åºå·ã€‚

ä»¥ä¸‹æ˜¯ Godot 4 æä¾›çš„å„ç§åŸºæœ¬ç¢°æ’å½¢çŠ¶ç±»å‹ï¼Œæ‰€æœ‰ç‰©ç†ç¢°æ’ä¸­éƒ½å¯ç”¨ï¼ŒDebug - Visible Collision Shapes
é€‰é¡¹æ‰“å¼€åï¼Œå¯ä»¥åœ¨è°ƒç”¨è¿è¡Œè¿‡ç¨‹ä¸­æ˜¾ç¤ºç¢°æ’å½¢çŠ¶ï¼š

|        Shape2D        |        Shape3D        |
|-----------------------|-----------------------|
| CapsuleShape2D        | BoxShape3D            |
| CircleShape2D         | CapsuleShape3D        |
| ConcavePolygonShape2D | ConcavePolygonShape3D |
| ConvexPolygonShape2D  | ConvexPolygonShape3D  |
| RectangleShape2D      | CylinderShape3D       |
| SegmentShape2D        | HeightMapShape3D      |
| SeparationRayShape2D  | SeparationRayShape3D  |
| WorldBoundaryShape2D  | SphereShape3D         |
|                       | WorldBoundaryShape3D  |

ä¸åŒ Godot ç‰ˆæœ¬ä¹‹é—´çš„ç¢°æ’å½¢çŠ¶å¯¹è±¡å…³ç³»ï¼š

|  Godot 3.x  |      Godot 4.x       |
|-------------|----------------------|
| LineShape2D | SegmentShape2D       |
| RayShape2D  | SeparationRayShape2D |
|             | CylinderShape3D      |
|             | HeightMapShape3D     |
|             | WorldBoundaryShape3D |

å…¶ä¸­ï¼ŒConcave å‡¹é¢çš„å’Œ Convex å‡¸é¢çš„ä¸¤ç§å¤šè¾¹å½¢éœ€è¦è®¾ç½® 2 çš„æ•´æ•°å€çš„é¡¶ç‚¹æ¥å®šä¹‰å¤šè¾¹å½¢ã€‚
å‡¸ç¢°æ’å½¢çŠ¶æ˜¯åŸºæœ¬ç¢°æ’å½¢çŠ¶å’Œå‡¹ç¢°æ’å½¢çŠ¶ä¹‹é—´çš„æŠ˜è¡·ï¼Œå¦‚åå­—æ‰€æç¤ºï¼Œå®ƒæ— æ³•è¡¨è¾¾æœ‰å‡¹é™·çš„å½¢çŠ¶çš„ç¢°æ’ã€‚

è™½ç„¶å¯ä»¥é€šè¿‡è®¾ç½®åŸºç‚¹æ•°æ®æ¥å®šä¹‰å½¢çŠ¶ï¼Œä½†å¯ä»¥é€šè¿‡ Sprite æˆ– MeshInstance3D ç½‘æ ¼è‡ªåŠ¨ç”Ÿæˆã€‚

é€‰æ‹© Sprite èŠ‚ç‚¹ï¼Œå¯ä»¥åœ¨ä¸»è§†å›¾çš„ Sprite - Create CollisionPolygon2D Sibling èœå•æ‰§è¡Œ
ç¢°æ’å½¢çŠ¶çš„ç”Ÿæˆï¼Œæ‰§è¡Œå®ƒä¼šå¼¹å‡ºä¸€ä¸ªå¯¹è¯æ¡†ï¼ŒåŒ…å«ä»¥ä¸‹è®¾ç½®ï¼š

- Simplification: ç®€åŒ–çº§åˆ«ï¼Œå€¼è¶Šå¤§å¿½ç•¥è¶Šå¤šç»†èŠ‚ï¼›
- Shrink (Pixels): æ”¶ç¼©çº§åˆ«ï¼Œå€¼è¶Šå¤§ç›¸å¯¹äºç²¾çµçš„è¾¹æ”¶ç¼©ç”Ÿæˆçš„ç¢°æ’å¤šè¾¹å½¢ã€‚
- Grow (Pixels): ç”Ÿé•¿çº§åˆ«ï¼Œå€¼è¶Šå¤§å€¼ç”Ÿæˆçš„ç¢°æ’å¤šè¾¹å½¢ç›¸å¯¹äºç²¾çµçš„è¾¹å¢é•¿ã€‚

è¯·æ³¨æ„ï¼Œå°†â€œå¢é•¿â€å’Œâ€œæ”¶ç¼©â€è®¾ç½®ä¸ºç›¸ç­‰çš„å€¼å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœï¼Œè€Œä¸æ˜¯å°†ä¸¤è€…éƒ½è®¾ç½®ä¸º 0ã€‚è¿˜å¯ä»¥å°† Sprite
è½¬æ¢ä¸º Polygon2D èŠ‚ç‚¹ï¼Œè¿™ä¸ªåŠŸèƒ½ç›¸å½“äºç®€åŒ–çš„ä½å›¾è½¬çŸ¢é‡å›¾åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æ£€æµ‹å›¾åƒçš„é€æ˜åŒºã€‚è¿˜ä¸èƒ½ç”¨å®ƒæ¥
ç”Ÿæˆå¯¼èˆªé£æ ¼ä¸­ä½¿ç”¨çš„ NavigationPolygonï¼Œåªèƒ½ç”Ÿæˆå¤–è½®å»“å›¾å½¢ç”¨äºç¢°æ’æ£€æµ‹ã€‚


é€‰æ‹© MeshInstance3D èŠ‚ç‚¹åï¼Œåœ¨ä¸»è§†å›¾çš„ Mesh èœå•ä¸­æä¾›å¤šç§ç”Ÿæˆæ¨¡å¼ï¼š

- Create Single Convex Collision Sibling - ä½¿ç”¨ Quickhull ç®—æ³•ç”Ÿæˆå•ä¸ªå‡¸å½¢ï¼›
- Create Multiple Convex Collision Siblings - ä½¿ç”¨ V-HACD ç®—æ³•ç”Ÿæˆå¤šä¸ªå‡¸å½¢ï¼Œæ¯”å‡¹é¢é€Ÿåº¦æ›´å¿«ï¼›

å¯¹äºç‰¹åˆ«å¤æ‚çš„ç¢°æ’ä½“ï¼Œå°±éœ€è¦ä½¿ç”¨å‡¹é¢æˆ–ä¸‰è§’é¢æ„é€ çš„ç¢°æ’ä½“ï¼ŒMesh èœå•å¯¹åº”æœ‰ï¼š

- Create Trimesh Static Body
- Create Trimesh Collision Sibling

å…¶å®ƒå½¢çŠ¶ä»‹ç»ï¼Œè¿™äº›éƒ½æ˜¯ç®€å•å½¢çŠ¶ï¼Œéå¸¸æ–¹ä¾¿äºç¢°æ’ç®—æ³•å¤„ç†ï¼š

- RectangleShape çŸ©å½¢ç¢°æ’æ£€æµ‹ï¼›
- CircleShape åœ†å½¢ç¢°æ’æ£€æµ‹ï¼›
- CapsuleShape èƒ¶å›Šå½¢ç¢°æ’æ£€æµ‹ï¼›
- SegmentShape çº¿æ®µå½¢ç¢°æ’æ£€æµ‹ï¼›
- SeparationRayShape (designed for characters)
- WorldBoundaryShape (infinite plane)

https://docs.godotengine.org/en/latest/classes/class_worldboundaryshape3d.html
`WorldBoundaryShape` æ˜¯ä¸€ä¸ªæ— å°½çš„å¹³é¢ï¼Œå¯ä»¥é˜»æŒ¡ç‰©ç†ä½“è¿›å…¥è´Ÿå‘ç©ºé—´ï¼Œå…¶æ³•å‘çš„åæ–¹å‘éƒ¨åˆ†ä¸ºè´Ÿå‘ç©ºé—´ã€‚
åœ¨ PhysicsBody ä¸­ä½¿ç”¨å®ƒï¼Œä¼šå¯¼è‡´æ”¾ç½®åœ¨å®ƒâ€œä¸‹æ–¹â€çš„ç¢°æ’ç‰©ä½“ä¼ é€åˆ°â€œä¸Šæ–¹â€å¹³é¢ã€‚

WorldBoundaryShape3D ä¸æ”¯æŒé™æ€æ¨¡å¼ä»¥å¤–çš„ RigidBody3D

åˆ†ç¦»å°„çº¿å¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„ç¢°æ’å½¢çŠ¶ï¼Œå®ƒæ˜¯å°è¯•ç”¨å°„çº¿æ¥åˆ†ç¦»å°„çº¿ç¢°æ’åˆ°çš„ç«¯ç‚¹ä½ç½®ï¼Œç”¨åœ¨è§’è‰²æ§åˆ¶ä¸­ã€‚

ç¢°æ’æ£€æµ‹åªæ˜¯ç¢°æ’å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œç¢°æ’ç®—æ˜¯æœ‰ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

- ç¢°æ’æ£€æµ‹ (collision detection)
- ç¢°æ’åˆ¤å®š (collision determination)
- ç¢°æ’å“åº” (collision response)

è€Œç®—æ³•æ¶ˆè€—ä¸»è¦åœ¨å‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥è®¾ç½®ç¢°æ’å½¢çŠ¶æ—¶åº”è¯¥å°½é‡ç®€å•ï¼Œå°½ç®¡ PhysicsBody æ²¡é™åˆ¶ç¢°æ’å½¢çŠ¶çš„æ•°é‡ï¼Œ
ä½†å°½é‡ä¸å¤šç”¨ç¢°æ’å½¢çŠ¶ï¼Œé¿å…å‡ºç°æ€§èƒ½é—®é¢˜ã€‚åŒæ—¶ï¼Œé¿å…å¯¹ç¢°æ’å½¢çŠ¶åšçº¿ç¨‹å˜æ¢æ“ä½œï¼Œtranslating, rotating, 
æˆ–è€… scaling éƒ½åº”è¯¥é¿å…ï¼Œä»¥å°½å¯èƒ½åˆ©ç”¨ç‰©ç†å¼•æ“çš„ä¼˜åŒ–ã€‚

ç¢°æ’æ£€æµ‹ç®—æ³•ä¸€èˆ¬åˆ† 2 ä¸ªé˜¶æ®µï¼Œéœ€è¦ä½¿ç”¨ç©ºé—´åˆ†å‰²ç®—æ³•æ¥åŠ é€Ÿç‰©ä½“çš„æ£€æµ‹è¿‡ç¨‹ï¼š

- broad phase ç²—ç­›é˜¶æ®µå¿«é€Ÿæ‰¾å‡ºæ½œåœ¨çš„ç¢°æ’ç‰©ä½“å¯¹åˆ—è¡¨ï¼Œä¸åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œçš„æ˜¯ç»å¯¹æ²¡å¯èƒ½ç¢°æ’çš„ã€‚
- narrow phase ç»†ç­›é˜¶æ®µå‡†ç¡®æ‰¾å‡ºå‘ç”Ÿç¢°æ’çš„ç‰©ä½“å¯¹åˆ—è¡¨ï¼Œå¹¶è¿›è¡Œç¢°æ’åˆ¤å®šã€‚

å¯¹äºåªæœ‰å•ä¸ªç¢°æ’å½¢çŠ¶çš„ StaticBodyï¼Œç¢°æ’ç®—æ³•çš„ broad phase å°±å¯ä»¥å¿½ç•¥éæ´»åŠ¨çš„ PhysicsBody å¯¹è±¡ã€‚
ä½†æ˜¯ä½¿ç”¨å¤šä¸ªç¢°æ’å½¢çŠ¶çš„æƒ…å†µä¸‹ï¼Œåˆ™ä¸èƒ½è¿™æ ·ä¼˜åŒ–ã€‚ç¢°æ’ç®—æ³• narrow phase éœ€è¦å¯¹æ¯ä¸ªç¢°æ’å½¢çŠ¶é€ä¸ªè¿›è¡Œæ£€æµ‹ã€‚



### ğŸŸ ğŸ”µ Area2D/3D
- https://docs.godotengine.org/en/latest/tutorials/physics/using_area_2d.html
- [2D Dodge The Creeps Demo](https://godotengine.org/asset-library/asset/515)
- [2D Pong Demo](https://godotengine.org/asset-library/asset/121)
- [2D Platformer Demo](https://godotengine.org/asset-library/asset/120)
- [3D Platformer Demo](https://godotengine.org/asset-library/asset/125)
- [GUI in 3D Demo](https://godotengine.org/asset-library/asset/127)
- [2D Pong Demo](https://godotengine.org/asset-library/asset/121)
- [2D Kinematic Character Demo](https://godotengine.org/asset-library/asset/113)
- godot-docs\tutorials\physics\using_area_2d.rst
- godot-docs\classes\class_area2d.rst
- godot-docs\classes\class_area3d.rst

There are three main uses for Area2D/3D:

- Overriding physics parameters (such as gravity) in a given region.
- Detecting when other bodies enter or exit a region or what bodies are currently in a region.
- Checking other areas for overlap.

Area2D/3D ç»§æ‰¿è‡ª CollisionObject2D/3Dï¼Œå’Œ PhysicsBody2D/3D æ˜¯åŒçº§çš„å…·æœ‰ç¢°æ’åŠŸèƒ½çš„å¯¹è±¡ã€‚

Area2D/3D çš„ä¸€å¤§åŠŸèƒ½æ˜¯ç›‘è§†å…¶å®ƒ Areaï¼Œç‰©ç†ä½“ Body æˆ–ç¢°æ’ Shape è¿›å…¥ä¸ç¦»å¼€å½“å‰åŒºåŸŸï¼Œé€šè¿‡
ä¿¡å·è¿”å›ç›¸å…³å‚æ•°ï¼š

- area_entered (`Area2D` area )
- area_exited (`Area2D` area )
- area_sape_entered (`RID` area_rid, `Area2D` area, `int` area_shape_index, `int` local_shape_index )
- area_sape_exited (`RID` area_rid, `Area2D` area, `int` area_shape_index, `int` local_shape_index )
- body_entered (`Node2D` body )
- body_exited (`Node2D` body )
- body_sape_entered (`RID` body_rid, `Node2D` body, `int` body_shape_index, `int` local_shape_index )
- body_sape_exited (`RID` body_rid, `Node2D` body, `int` body_shape_index, `int` local_shape_index )

Shape ç¢°æ’è§¦å‘çš„ä¿¡å·è¦åœ¨ Area çš„ä¿¡å·åé¢ï¼Œå³å…ˆå‘ç”Ÿ Area äº¤å è¡Œä¸ºï¼Œå…¶å®ƒç¢°æ’å¯¹è±¡ä¹Ÿä¸€æ ·ï¼š

- å…ˆè§¦å‘ area_entered å† area_shape_enteredã€‚
- å…ˆè§¦å‘ area_exited å† area_shape_exitedã€‚

è®¾ç½®ä»¥ä¸‹ä¸¤ä¸ªå±æ€§æ§åˆ¶ Area æ˜¯å¦å¤„ç†ç›‘æ§ã€æˆ–å¯ä»¥è¢«ç›‘æ§çŠ¶æ€ï¼š

- Monitoring å¯ç”¨å³ç›‘æ§å…¶å®ƒå½¢çŠ¶çš„ç¢°æ’äº‹ä»¶ï¼Œæ‰ä¼šè§¦å‘ä»¥ä¸Šå„ä¸ªä¿¡å·ï¼›
- Monitorable å¯ç”¨å¯ä»¥è¢«ç›‘æ§ï¼›

Area æœ¬èº«åªæä¾›ç¢°æ’æ£€æµ‹é€»è¾‘ï¼Œéœ€è¦åœ¨å­çº§èŠ‚ç‚¹ä¸­ç»™å‡ºä¸€ä¸ªç¢°æ’æ£€æµ‹è¾¹ç•ŒèŒƒå›´å®šä¹‰ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

- CollisionPolygon æ­¤ç›´æ¥åœ¨ç¼–è¾‘å™¨ç»˜ç”»å¤šè¾¹å½¢ï¼Œæä¾›å›¾å½¢ç”¨äºç¡®å®šç¢°æ’æ£€æµ‹çš„è¾¹ç•ŒèŒƒå›´ã€‚
- CollisionShape ç¢°æ’å›¾å½¢æ–¹å¼å¯ä»¥ä½¿ç”¨ä»¥ä¸‹åŸºç¡€ç¢°æ’å½¢çŠ¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Mesh æ¥ç”Ÿæˆ Shapeã€‚

ç¢°æ’å½¢çŠ¶å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œåœ¨ç¢°æ’æ£€æµ‹æ—¶é€ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œåœ¨ä¿¡å·äº‹ä»¶ä¸­å¯ä»¥è·å–åˆ°ç›¸åº”çš„ Shape èŠ‚ç‚¹åºå·ã€‚

Area2D/3D çš„ç¬¬äºŒä¸ªä¸»è¦åŠŸèƒ½æ˜¯é€šè¿‡å‚æ•°è¦†ç›–ä¿®æ”¹ç‰©ç†å¼•æ“çš„é»˜è®¤è¡Œä¸ºï¼Œéœ€è¦å¼€å¯ Space Overrideï¼š

- Combine - The area adds its values to what has been calculated so far.
- Replace - The area replaces physics properties, and lower priority areas are ignored.
- Combine-Replace - The area adds its gravity/damping values to whatever has been calculated so far (in priority order), ignoring any lower priority areas.
- Replace-Combine - The area replaces any gravity/damping calculated so far, but keeps calculating the rest of the areas.

è¦†ç›–å°†æ ¹æ® Priority æŒ‡å®šçš„ä¼˜å…ˆçº§ã€è¦†ç›–æ¨¡å¼æ¥å†³å®šå“ªäº›å€¼è¢«è¦†ç›–ï¼Œé«˜ä¼˜å…ˆçº§çš„ä¼šå…ˆå¤„ç†ã€‚

å¯ä»¥è¦†ç›–çš„ç‰©ç†å±æ€§åŒ…æ‹¬ï¼š

- Gravity - Gravity's strength inside the area.
- Gravity Vec - Gravity's direction. This vector does not need to be normalized.
- Linear Damp - How quickly objects stop moving - linear velocity lost per second.
- Angular Damp - How quickly objects stop spinning - angular velocity lost per second.
- Point gravity - The Gravity Point property allows you to create an "attractor".

Point gravity ç‚¹é‡åŠ›åœºå…è®¸åˆ›å»ºâ€œå¸é™„å™¨â€ï¼Œå¯ç”¨å Area åŒºåŸŸçš„é‡åŠ›å°†æ ¹æ®é‡åŠ›çŸ¢é‡å±æ€§è®¡ç®—å‡ºä¸€ä¸ªç‚¹ï¼Œ
å€¼æ˜¯ç›¸å¯¹äº Area2D çš„ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ï¼ˆ0ï¼Œ0ï¼‰ä¼šå°†å¯¹è±¡å¸å¼•åˆ°åŒºåŸŸçš„ä¸­å¿ƒã€‚

![Area2D Override](https://docs.godotengine.org/en/latest/_images/area2d_override.gif)



### ğŸŸ ğŸ”µ RigidBody & StaticBody
- https://docs.godotengine.org/en/latest/tutorials/physics/rigid_body.html
- https://kidscancode.org/godot_recipes/3.x/kyn/rigidbody2d/

åˆšä½“å’Œé™æ€ç‰©ä½“æ˜¯ç›¸ä¼¼çš„ä¸¤ç±»ï¼Œå®ƒä»¬éƒ½ç”±ç‰©ç†å¼•æ“ç›´æ¥æ§åˆ¶ï¼Œåªæ˜¯åè€…ä¸éœ€è¦ç§»åŠ¨ï¼Œåªå‚è€ƒç¢°æ’è®¡ç®—ã€‚

Example uses for StaticBody2D/3D:

- Platforms (including moving platforms)
- Conveyor belts
- Walls and other obstacles

å¯¹äºåˆšä½“ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥æ§åˆ¶å®ƒï¼Œç‰©ç†å¼•æ“éœ€è¦é€šè¿‡ä¸æ–­çš„è®¡ç®—ï¼Œå®æ—¶åæ˜ åˆšä½“åœ¨è™šæ‹Ÿä¸–ç•Œä¸­çš„è¡Œä¸ºã€‚éœ€è¦é€šè¿‡æ–½åŠ åŠ›ï¼Œ
ä½¿ç”¨ apply_impulse() æ–¹æ³•ï¼Œæ¥é—´æ¥æ§åˆ¶ï¼š

```py
void _integrate_forces(state: PhysicsDirectBodyState3D)
virtual void apply_central_impulse(impulse: Vector3)
void apply_impulse(impulse: Vector3, position: Vector3 = Vector3(0, 0, 0) ) 
int get_bone_id()
const bool get_simulate_physics()
bool is_simulating_physics()
```

è¿˜å¯ä»¥é€šè¿‡ `_integrate_forces()` å›è°ƒï¼Œå®ƒä¼šåœ¨ç‰©ç†å¤„ç†æœŸé—´è°ƒç”¨ã€‚ä½¿ç”¨ `custom_integrator` å±æ€§
è®¾ç½®è‡ªå®šä¹‰çš„ç§¯åˆ†å™¨ï¼Œå…è®¸ç¦ç”¨é»˜è®¤è¡Œä¸ºï¼Œå¹¶ä¸ºå®ä½“æ‰§è¡Œå®Œå…¨è‡ªå®šä¹‰çš„åŠ›ç§¯åˆ†ã€‚åœ¨åŠ›ç§¯åˆ†å›è°ƒæ–¹æ³•è¿™é‡Œï¼Œå¯ä»¥é€šè¿‡ 
PhysicsDirectBodyState å®‰å…¨åœ°ä¿®æ”¹ç‰©ç†ç›¸å…³çš„å±æ€§ï¼Œå®ƒä¼šå¤„ç†å¥½ç‰©ç†å¼•æ“çš„å¤šçº¿ç¨‹è®¡ç®—åŒæ­¥é—®é¢˜ï¼š

```py
extends RigidBody2D

var thrust = Vector2(0, -250)
var torque = 20000

func _integrate_forces(state):
    if Input.is_action_pressed("ui_up"):
        state.apply_force(thrust.rotated(rotation))
    else:
        state.apply_force(Vector2())
    var rotation_direction = 0
    if Input.is_action_pressed("ui_right"):
        rotation_direction += 1
    if Input.is_action_pressed("ui_left"):
        rotation_direction -= 1
    state.apply_torque(rotation_direction * torque)
```

åƒ Node3D ä¸­çš„ ``set_global_transform()`` æˆ–è€… ``look_at()`` éƒ½ä¸èƒ½ç›´æ¥åœ¨åˆšä½“ä¸­ä½¿ç”¨ï¼Œ
ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆšä½“çš„ â€look_at" æ–¹æ³•å®ç°ï¼Œé—´æ¥é€šè¿‡åˆšä½“ ``angular_velocity`` æ—‹è½¬è§’é€Ÿåº¦æ¥å®ç°ï¼š

```py
extends RigidBody

func look_follow(state, current_transform, target_position):
    var up_dir = Vector3(0, 1, 0)
    var cur_dir = current_transform.basis * Vector3(0, 0, 1)
    var target_dir = (target_position - current_transform.origin).normalized()
    var rotation_angle = acos(cur_dir.x) - acos(target_dir.x)

    state.angular_velocity = up_dir * (rotation_angle / state.step)

func _integrate_forces(state):
    var target_position = $my_target_node3d_node.global_transform.origin
    look_follow(state, global_transform, target_position)
```


### ğŸŸ ğŸ”µ CharacterBody è¿åŠ¨è§’è§’è‰²
- https://docs.godotengine.org/en/latest/tutorials/physics/kinematic_character_2d.html
- [Physics Platformer](https://github.com/godotengine/godot-demo-projects/tree/master/2d/physics_platformer)
- [Platformer 3D](https://github.com/godotengine/godot-demo-projects/tree/master/2d/kinematic_character)
- [Kinematic Character 3D](https://github.com/godotengine/godot-demo-projects/tree/master/3d/kinematic_character)
- [RigidBody Character 3D](https://github.com/godotengine/godot-demo-projects/tree/master/3d/rigidbody_character)

ç‰©ç†å¼•æ“æœ‰ä¸¤ç±»è§’è‰²æ§åˆ¶æ–¹æ³•ï¼š

- **dynamic character controller** 
- **kinematic character controller**

ä¸€äº›ç‰©ç†å¼•æ“ï¼Œå¦‚ Havokï¼Œå°†åŠ¨æ€è§’è‰²æ§åˆ¶å™¨è§†ä¸ºæœ€ä½³é€‰é¡¹ï¼Œè€Œå…¶ä»–ç‰©ç†å¼•æ“ï¼ˆPhysXï¼‰åˆ™æ›´å€¾å‘äºæ¨å¹¿è¿åŠ¨å­¦å¼•æ“ã€‚

åŠ¨æ€è§’è‰²æ§åˆ¶å™¨ä½¿ç”¨å…·æœ‰æ— é™æƒ¯æ€§å¼ é‡çš„åˆšä½“ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸èƒ½æ—‹è½¬çš„åˆšä½“ã€‚ç‰©ç†å¼•æ“æ€»æ˜¯è®©ç‰©ä½“ç§»åŠ¨å’Œç¢°æ’ï¼Œç„¶å
ä¸€èµ·è§£å†³å®ƒä»¬çš„ç¢°æ’ã€‚è¿™ä½¿å¾—åŠ¨æ€è§’è‰²æ§åˆ¶å™¨èƒ½å¤Ÿä¸å…¶ä»–ç‰©ç†å¯¹è±¡æ— ç¼äº¤äº’ï¼Œå¦‚å¹³å°æ¼”ç¤ºä¸­æ‰€ç¤ºã€‚ç„¶è€Œï¼Œè¿™äº›äº’åŠ¨
å¹¶ä¸æ€»æ˜¯å¯é¢„æµ‹çš„ã€‚ç¢°æ’å¯èƒ½éœ€è¦ä¸€å¸§ä»¥ä¸Šçš„æ—¶é—´æ‰èƒ½è§£å†³ï¼Œå› æ­¤å‡ æ¬¡ç¢°æ’å¯èƒ½ä¼šäº§ç”Ÿå¾®å°çš„ä½ç§»ã€‚è¿™äº›é—®é¢˜å¯ä»¥è§£å†³ï¼Œ
ä½†éœ€è¦ä¸€å®šçš„æŠ€èƒ½ã€‚

è¿åŠ¨å­¦è§’è‰²æ§åˆ¶å™¨å§‹ç»ˆå‡è®¾ä»¥éç¢°æ’çŠ¶æ€å¼€å§‹ï¼Œå¹¶å§‹ç»ˆç§»åŠ¨åˆ°éç¢°æ’çŠ¶æ€ã€‚å¦‚æœå®ƒå¼€å§‹æ—¶å¤„äºç¢°æ’çŠ¶æ€ï¼Œå®ƒä¼šåƒ
åˆšä½“ä¸€æ ·è¯•å›¾é‡Šè¿›å…¥è‡ªç”±æ€ï¼Œä½†è¿™æ˜¯ä¾‹å¤–ï¼Œè€Œä¸æ˜¯è§„åˆ™ã€‚è¿™ä½¿å¾—å®ƒä»¬çš„æ§åˆ¶å’Œè¿åŠ¨æ›´åŠ å¯é¢„æµ‹ï¼Œæ›´æ˜“äºç¼–ç¨‹ã€‚ç„¶è€Œï¼Œ
ä½œä¸ºä¸€ä¸ªç¼ºç‚¹ï¼Œå®ƒä»¬ä¸èƒ½ç›´æ¥ä¸å…¶ä»–ç‰©ç†å¯¹è±¡äº¤äº’ï¼Œé™¤éé€šè¿‡æ‰‹å·¥ç¼–å†™ä»£ç å®Œæˆã€‚

ä½¿ç”¨è¿åŠ¨å­¦è§’è‰²èŠ‚ç‚¹æ—¶ï¼Œå»ºè®®ä½¿ç”¨ physics process å›è°ƒï¼Œå› ä¸ºå®ƒä¼šåœ¨ç‰©ç†å¼•æ“å¼€å§‹ä¸€è½®è®¡ç®—ä¹‹å‰è°ƒç”¨ï¼Œåœ¨
äº›è¿›è¡Œçš„å±æ€§ä¿®æ”¹ä¼šè¢«åŒæ­¥åˆ°ç‰©ç†å¼•ç”¨æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”ä»¥å›ºå®šçš„å‘¨æœŸè°ƒç”¨ï¼Œå³ä¼ å…¥çš„ `delta` å€¼å§‹ç»ˆæ’å®šã€‚è¿™ä¹Ÿ
ä½¿å¾—ç‰©ç†ã€è¿åŠ¨è®¡ç®—å·¥ä½œæ›´å¯é¢„æµ‹ã€‚

è¿åŠ¨è§’è§’è‰²æœ¬èº«æ”¯æŒç¢°æ’ï¼Œä½†æ˜¯éœ€è¦ä½¿ç”¨ CollisionShapes æä¾›æ£€æµ‹è¾¹ç•Œå®šä¹‰ï¼Œæ‰€ä»¥ KinematicBody2D
ç»å¸¸å°† CollisionShapes ä½œä¸ºå­èŠ‚ç‚¹æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚ç¢°æ’ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®ç”± KinematicCollision2D/3D
ç±»å‹ä¸­ä¿å­˜ã€‚

![KinematicBody2D](https://docs.godotengine.org/en/latest/_images/kbscene.png)


CharacterBody æ˜¯ KinematicBody çš„æ–°ç‰ˆæœ¬ç§°è°“ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ç”¨äºæ‰§è¡Œç§»åŠ¨å’Œç¢°æ’çš„å“åº”ï¼š

- move_and_collide() ç§»åŠ¨å¹¶åœ¨ç¢°æ’æ—¶åœæ­¢ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«ç¢°æ’ä¿¡æ¯çš„ KinematicCollision å¯¹è±¡ï¼›
- move_and_slide() ç§»åŠ¨å¹¶ä»¥æ»‘åŠ¨æ–¹å¼å“åº”ç¢°æ’ï¼Œè¿”å›æ»‘åŠ¨é€Ÿåº¦ï¼Œé€šè¿‡ get_slide_collision() è·å–ç¢°æ’ä¿¡æ¯ã€‚

```py
extends PhysicsBody2D

var velocity = Vector2(250, 250)

# Get the gravity from the project settings to be synced with RigidDynamicBody nodes.
var gravity = ProjectSettings.get_setting("physics/2d/default_gravity")

func _physics_process(delta):

    velocity = move_and_slide(velocity, Vector2(0, -1))
    
    var collision_info = move_and_collide(velocity * delta)
    if collision_info:
        var collision_point = collision_info.position
        velocity = velocity.bounce(collision_info.normal)
```

è¿åŠ¨å­¦è§’è‰²é€šå¸¸æ˜¯ç”±ç©å®¶ç›´æ¥æ§åˆ¶çš„ï¼Œé™¤äº†ç¢°æ’æ£€æµ‹ï¼Œä¸èƒ½åƒåˆšä½“é‚£æ ·æ›´çœŸå®åœ°æ¨¡æ‹Ÿè‡ªç„¶ç¯å¢ƒä¸­ç‰©ä½“çš„åŠ›å­¦è¡¨ç°ã€‚
æ¯”å¦‚ï¼Œåˆšä½“åœ¨è½åˆ°æ–œå¡æ—¶ï¼Œä¼šæ—‹è½¬å¿ƒä½¿ç”¨å…¶è¡¨é¢ç´§è´´æ–œå¡ï¼Œè€Œè¿åŠ¨è§’è§’è‰²å°±æ²¡æœ‰è¿™æ ·çš„ç‰©ç†æ¨¡æ‹Ÿæ•ˆæœã€‚


### ğŸŸ ğŸ”µ SoftBody è½¯ä»¶
- https://docs.godotengine.org/en/latest/tutorials/physics/soft_body.html


### ğŸŸ ğŸ”µ Skeleton éª¨æ¶åŠ¨ç”»
- [Godot 4 IKç¨‹åºåŒ–éª¨éª¼åŠ¨ç”»](https://www.bilibili.com/video/BV1Me411L7vN/)


### ğŸŸ ğŸ”µ Particles ç²’å­ç‰¹æ•ˆ
- https://docs.godotengine.org/en/latest/tutorials/performance/vertex_animation/controlling_thousands_of_fish.html
- https://docs.godotengine.org/en/latest/tutorials/shaders/shader_reference/particle_shader.html
- https://docs.godotengine.org/en/latest/classes/class_particleprocessmaterial.html
- https://docs.godotengine.org/en/latest/classes/class_renderingserver.html
- [New improvements for GPUParticles in Godot 4.0](https://godotengine.org/article/improvements-gpuparticles-godot-40/)
- [Mesh level of detail (LOD)](https://docs.godotengine.org/en/latest/tutorials/3d/mesh_lod.html)
- [Particle systems (2D)](https://docs.godotengine.org/en/latest/tutorials/2d/particle_systems_2d.html)
- [Godot 3's renderer design explained](https://godotengine.org/article/godot-3-renderer-design-explained/)
- [Turbulence/Noise for ParticleMaterial (2D / 3D)](https://github.com/godotengine/godot/pull/55387)
- [Godot 4.x - 2D+3D ç²’å­æ‰°åŠ¨é¢„è§ˆ](https://www.bilibili.com/video/BV1zS4y117g9/)
- godot\servers\rendering\renderer_rd\shaders\particles.glsl

æŒ‰åæ ‡ç»´åº¦ï¼ŒGodot ç²’å­ç‰¹æ•ˆå¯ä»¥åˆ†ä¸º 2D å’Œ 3D ä¸¤ç±»ã€‚æŒ‰è¿ç®—æ–¹å¼ä¸åŒåˆ†ä¸º CPU å’Œ GPU ä¸¤ç±»ï¼Œåè€…èƒ½
åˆ©ç”¨å¤šæµæ°´çº¿å¹¶è¡Œè®¡ç®—çš„ GPU èµ„æºï¼Œåˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹© GLES3 å°±å¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„ GUP APIï¼ŒGodot æä¾›
é»˜è®¤çš„ç²’å­ç€è‰²å™¨ä¸º particles.glslï¼Œç²’å­èŠ‚ç‚¹çš„å‡ ä¹æ‰€æœ‰å±æ€§éƒ½æ˜¯æŒ‰æ­¤ç€è‰²ç¨‹åºæ¥è¿›è¡Œè®¾ç½®çš„ã€‚å¦å¤–ï¼Œ
ä½¿ç”¨ GLES2 åç«¯çš„é¡¹ç›®åˆ™ä¼šä½¿ç”¨ CPU ç²’å­ç‰¹æ•ˆã€‚

ç²’å­æ˜¯è®¡ç®—æœºå›¾å½¢å¤„ç†ä¸­ç”¨äºå¤§é‡ç‰©ä½“çš„ä¸€å¤„è®¡ç®—å¤„ç†æ–¹å¼ï¼Œåƒçˆ†ç ´ã€çƒŸç«ã€çƒŸé›¾ç­‰ç­‰ï¼Œè¿™äº›éš¾ä»¥ç”¨å•ç‹¬ç½‘æ ¼æ¨¡å‹
å®ç°çš„æ•ˆæœéƒ½æ˜¯ç²’å­ç³»ç»Ÿçš„ç”¨æ­¦ä¹‹åœ°ã€‚

ç²’å­ç³»ç»ŸåŸºæœ¬çš„å·¥ä½œæ¨¡å‹æ˜¯ï¼Œå›´ç»•ç²’å­å‘å°„å™¨ï¼Œå¤§é‡çš„ç²’å­ç”±å‘å°„å™¨æŒ‰å‚æ•°é‡Šæ”¾å‡ºæ¥ã€‚ä¸ºäº†ç³»ç»Ÿé«˜æ•ˆï¼Œç²’å­è¢«è®¾è®¡
æˆæœ‰ç”Ÿå‘½å‘¨æœŸçš„ç‰©ä½“ï¼Œè¶…è¿‡æ—¶é—´å°±å¯ä»¥å›æ”¶å ç”¨çš„èµ„æºã€‚ç²’å­å‚æ ¹æ®å…·ä½“å®ç°æ¨¡å‹ä¸åŒï¼ŒåŸºæœ¬ä¸Šæœ‰éšæœºæ€§å±æ€§ã€é¢œè‰²ã€
å¤§å°ã€ä½ç½®ã€é€Ÿåº¦ã€æ—‹è½¬ã€å‘æ•£ç­‰ç­‰ã€‚äºŒç»´ç²’å­å¯ä»¥æŒ‡å®šå½¢çŠ¶ï¼Œç”¨äºå‘å°„ç²’å­ã€‚

ä¸‰ç»´ç©ºé—´ä¸‹å¯ä»¥è®¾ç½®ç²’å­ç¢°æ’å½¢çŠ¶è¿˜æœ‰æ‰°åŠ¨èŠ‚ç‚¹ GPUParticlesAttractor3Dï¼Œè°ƒæ•´å…¶ä½ç½®ã€å¼ºåº¦ç­‰å‚æ•°ï¼Œå°±
å¯ä»¥å¯¹ç²’å­ç³»ç»Ÿäº§ç”Ÿæ‰°åŠ¨æ•ˆæœï¼Œå¢åŠ éšæœºæ€§ã€‚

3D ç²’å­æè´¨æœ‰ Draw Passesï¼Œæ¯ä¸ª Pass å¯ä»¥æŒ‡å®šä¸€ä¸ª Mesh èµ„æºè¿›è¡Œæ¸²æŸ“ï¼Œç›¸å½“äº 2D ç²’å­ä¸­è®¾ç½®çº¹ç†ã€‚
æ¯ä¸ªç½‘æ ¼ä½“éƒ½å¯ä»¥æŒ‡å®šæè´¨ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå››è¾¹é¢ **QuadMesh**ï¼Œè¿™æ˜¯æ²¡æœ‰åšåº¦çš„å‡ ä½•ä½“ï¼Œå½“ç›¸æœºä½åœ¨å…¶ä¾§é¢æ—¶ï¼Œ
å°±ä¼šçœ‹ä¸åˆ°è¿™ä¸ªé¢ï¼Œå¯ä»¥åœ¨æè´¨å‚æ•°ä¸­æ‰“å¼€ **Billboard** å…¬å‘Šæ¿åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯ç”¨æ¥å°†ä¸€ä¸ªæ—¶åˆ»æœå‘ç›¸æœºï¼Œ
ä»¥é¿å…ä¾§é¢çœ‹ä¸è§çš„æƒ…å†µã€‚

æ‰€æœ‰ç‰©ç†ç³»ç»Ÿå‚æ•°éƒ½å¯ä»¥éšæœºåŒ–ï¼š

    initial_value = param_value + param_value * randomness

åˆ¶ä½œç²’å­ç‰¹æ•ˆæ—¶ï¼Œå¯ä»¥æ‰“å¼€ Emitting å’Œå…³é—­ One Shotï¼Œè¿™æ ·åªå¯ä»¥é‡å¤æ’­æ”¾æ•ˆæœæ–¹ä¾¿å®æ—¶ç›‘æµ‹ã€‚

å¯¼å…¥å¤–éƒ¨æ—¶ï¼Œå¯ä»¥ç”Ÿæˆ mesh LODï¼Œé€šè¿‡ MultiMesh å’Œç²’å­ç³»ç»Ÿï¼Œå¯ä»¥å®ç°ä¸°å¯Œçš„ç‰¹æ•ˆã€‚

|     Godot 3.5     |               Godot 4.0               |
|-------------------|---------------------------------------|
| CPUParticles2D    | CPUParticles2D                        |
| GPUParticles2D    | GPUParticles2D                        |
| CPUParticles      | CPUParticles3D                        |
| GPUParticles      | GPUParticles3D                        |
| ParticlesMaterial | ParticleProcessMaterial               |
|                   | GPUParticlesAttractor3D               |
|                   | -->GPUParticlesAttractorBox3D         |
|                   | -->GPUParticlesAttractorSphere3D      |
|                   | -->GPUParticlesAttractorVectorField3D |
|                   | GPUParticlesCollision3D               |
|                   | -->GPUParticlesCollisionBox3D         |
|                   | -->GPUParticlesCollisionHeightField3D |
|                   | -->GPUParticlesCollisionSDF3D         |
|                   | -->GPUParticlesCollisionSphere3D      |

ParticleProcessMaterial å’Œæ—§ç‰ˆæœ¬çš„ ParticlesMaterial æè´¨æ˜¯ç”¨æ¥å¤„ç† GPU ç²’å­å±æ€§çš„èµ„æºå¯¹è±¡ã€‚
å¯ä»¥ä½¿ç”¨ç€è‰²å™¨çš„æ–¹å¼å®ç°ç²’å­æè´¨ï¼Œå®šä¹‰ç²’å­å±æ€§ä¸è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®ç¢°æ’æ¨¡å¼ï¼ŒCOLLISION_RIGID æ¨¡å¼
ä¸åˆšä½“å¯ä»¥ç¢°æ’ã€‚HIDE_ON_CONTACT æ¨¡å¼åœ¨ç¢°æ’æ—¶éšè—ç²’å­ã€‚

æè´¨ä¸­ Next Pass è®¾ç½®è¦ç”¨äºä¸‹ä¸€ä¸ªè¿‡ç¨‹çš„æè´¨ï¼Œå°†ä½¿ç”¨ä¸åŒçš„æè´¨å†æ¬¡æ¸²æŸ“å¯¹è±¡ã€‚ä½†æ˜¯è¿™ä¸ªå±æ€§æŒ‡å®šçš„æè´¨
åªé€‚ç”¨äº Spatial èŠ‚ç‚¹ï¼Œä»¥åŠä½¿ç”¨ SpatialMaterials å’Œ ShaderMaterials ç€è‰²å™¨ã€‚

æ³¨æ„ç²’å­ç¢°æ’ä½¿ç”¨ GPUParticlesCollision3D èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ PhysicsBody3D èŠ‚ç‚¹ï¼Œä½†ç²’å­ä½œä¸ºå­èŠ‚ç‚¹ã€‚
å¯¹äº 2D ç²’å­ï¼Œåªä½¿ç”¨ LightOccluder2D èŠ‚ç‚¹è¿›è¡Œç¢°æ’ã€‚è¿™ä¸ªèŠ‚ç‚¹ç”¨äºé®æŒ¡ Light2D æŠ•å°„çš„å…‰ï¼ŒæŠ•å°„é˜´å½±ã€‚


Godot 4.0 çš„ç²’å­ç³»ç»ŸæŒ‰ `RenderingServer` æ¥å£å®ç°ï¼Œè¿™æ˜¯æ‰€æœ‰å¯è§†å…ƒç´ çš„åº•å±‚å¤„ç†æœåŠ¡å™¨ã€‚ä½œä¸ºæœ€
å¸¸ç”¨çš„æ¥å£ï¼Œå¼•æ“ä¸ºå®ƒå®šä¹‰äº†ä¸€ä¸ªå…¨å±€ç¬¦å· `RS` æ¥å¼•ç”¨å®ƒçš„ singletonã€‚è¿™ä¸ªæ¥å£æä¾›äº†ç›´æ¥åˆ›å»ºç€è‰²å™¨
èµ„æºçš„ APIï¼Œä¹Ÿæä¾›äº†ç»™å‡ ä½•ä½“è®¾ç½®ç€è‰²å™¨ï¼Œæˆ–ç»™ç€è‰²å™¨å…¨å±€å˜é‡èµ‹å€¼çš„ APIã€‚æ­¤å¤–ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªå…¨å±€ç¬¦å·
`RSG` å¼•ç”¨ `RenderingServerGlobals`ï¼Œè¿™ä¸ªç±»å‹å¯¹è±¡åªåŒ…å«å…¨å±€é™æ€æˆå‘˜ï¼Œå¼•ç”¨å„ç§åº•å±‚æœåŠ¡å™¨å¯¹è±¡ï¼Œ
åŒ…æ‹¬çº¿ç¨‹å¯ç”¨æ ‡å¿— threadedã€‚

å…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„å…¨å±€ç±» `RendererSceneCull`ï¼Œå®ƒä»£è¡¨äº†å…¨å±€åœºæ™¯å¤„ç†å™¨ï¼Œé‡Œé¢åŒ…å«äº†å¤§é‡å›¾å½¢å­¦æ¦‚å¿µã€‚
æ˜¯æ¸²æŸ“æ–¹æ³•æ¥å£ `RenderingMethod` çš„å…·ä½“å®ç°ã€‚å…·ä½“è¿˜æœ‰ `RendererSceneRender` æ¥å£ï¼Œå¾…æ·±ç©¶ã€‚

```C++,ignore
// godot\servers\rendering\renderer_scene_cull.h
// godot\servers\rendering\renderer_scene_render.h
void RendererSceneCull::update() {
    //optimize bvhs

    uint32_t rid_count = scenario_owner.get_rid_count();
    RID *rids = (RID *)alloca(sizeof(RID) * rid_count);
    scenario_owner.fill_owned_buffer(rids);
    for (uint32_t i = 0; i < rid_count; i++) {
        Scenario *s = scenario_owner.get_or_null(rids[i]);
        s->indexers[Scenario::INDEXER_GEOMETRY].optimize_incremental(indexer_update_iterations);
        s->indexers[Scenario::INDEXER_VOLUMES].optimize_incremental(indexer_update_iterations);
    }
    scene_render->update();
    update_dirty_instances();
    render_particle_colliders();
}
```

æ¸²æŸ“æœåŠ¡å™¨çš„é»˜è®¤å®ç°ä¸º`RenderingServerDefault`ï¼Œå…¶æ„é€ å™¨ä¸­ä¼šåˆå§‹åŒ– RSG å¼•ç”¨çš„å„ç§å…¨å±€æœåŠ¡å™¨ã€‚

```C++,ignore
// godot\servers\rendering_server.h
    Dictionary[]    get_shader_parameter_list ( RID shader ) const
    void            global_shader_parameter_add ( StringName name, GlobalShaderParameterType type, Variant default_value )
    Variant         global_shader_parameter_get ( StringName name ) const
    PackedStringArray   global_shader_parameter_get_list ( ) const
    GlobalShaderParameterType   global_shader_parameter_get_type ( StringName name ) const
    void    global_shader_parameter_remove ( StringName name )
    void    global_shader_parameter_set ( StringName name, Variant value )
    void    global_shader_parameter_set_override ( StringName name, Variant value )

    Variant instance_geometry_get_shader_parameter ( RID instance, StringName parameter ) const
    Variant instance_geometry_get_shader_parameter_default_value ( RID instance, StringName parameter ) const
    Dictionary[] instance_geometry_get_shader_parameter_list ( RID instance ) const
    void    instance_geometry_set_shader_parameter ( RID instance, StringName parameter, Variant value )

    void material_set_shader ( RID shader_material, RID shader )

    RID     shader_create ( )
    String  shader_get_code ( RID shader ) const
    RID     shader_get_default_texture_parameter ( RID shader, StringName name, int index=0 ) const
    Variant shader_get_parameter_default ( RID shader, StringName name ) const
    void    shader_set_code ( RID shader, String code )
    void    shader_set_default_texture_parameter ( RID shader, StringName name, RID texture, int index=0 )
    void    shader_set_path_hint ( RID shader, String path )
```

åº•å±‚ç³»ç»Ÿä¸­ä½¿ç”¨å¤§é‡å®ç¼–ç¨‹ï¼Œæ¯”å¦‚ `PhysicsServer3D` ç»è¿‡å®ç¼–ç¨‹åŒ…è£…æˆ `PhysicsServer3DWrapMT`ï¼Œ
æºä»£ç é˜…è¯»å™¨å¯èƒ½éš¾ä»¥ç›´æ¥å®šä½ç›¸å…³ APIã€‚

å®ç¼–ç¨‹ä¸­ä½¿ç”¨äº† `FUNC$VER` è¿™æ ·çš„æ ¼å¼ï¼Œç‰ˆæœ¬å·ä»£è¡¨è¦å®šä¹‰çš„æ–¹æ³•ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ã€‚å¦å¤–ï¼Œåç¼€ R è¡¨ç¤ºæ‰€
å®šä¹‰æ–¹æ³•çš„è¿”å›ç±»å‹ï¼ŒC è¡¨ç¤º const overrideï¼ŒS ä»£è¡¨ä½¿ç”¨ SYNC_DEBUGã€‚å®å‡½æ•°æœ€å¤§ç‰ˆæœ¬ä¸º FUNC15ï¼Œ
å³å®šä¹‰ä¸€ä¸ªä½¿ç”¨ 15 ä¸ªå‚æ•°çš„æ–¹æ³•ã€‚

æ¯”å¦‚ï¼Œä»¥ä¸‹ä½¿ç”¨ `FUNC1RC` å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç”¨äºè·å–ç€è‰²å™¨çš„å…¨å±€å‚æ•°ï¼Œæ–¹æ³•è¿”å›å€¼ç±»å‹ä¸º Variantï¼Œè€Œå”¯ä¸€
çš„ä¸€ä¸ªå‚æ•°æ˜¯ const StringName &ï¼Œå‡½æ•°ç­¾ååç¼€ä¸º const overrideã€‚

```C++,ignore
// FUNC1RC(Variant, global_shader_parameter_get, const StringName &)
// virtual Variant global_shader_parameter_get( const String& p1) const override

// godot\core\templates\command_queue_mt.h
// godot\servers\server_wrap_mt_common.h
#define FUNC1RC(m_r, m_type, m_arg1)                                                \
    virtual m_r m_type(m_arg1 p1) const override {                                  \
        if (Thread::get_caller_id() != server_thread) {                             \
            m_r ret;                                                                \
            command_queue.push_and_ret(server_name, &ServerName::m_type, p1, &ret); \
            SYNC_DEBUG                                                              \
            return ret;                                                             \
        } else {                                                                    \
            command_queue.flush_if_pending();                                       \
            return server_name->m_type(p1);                                         \
        }                                                                           \
    }
```

åº•å±‚æœåŠ¡å™¨ç»å¸¸ä¼šä½¿ç”¨åˆ° ServerName æˆ–è€… server_nameï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªå…¨å±€ç¬¦å·ï¼Œå¯ä»¥å¼•ç”¨ä¸åŒçš„æœåŠ¡ç³»ç»Ÿã€‚
ç‰©ç†ç³»ç»Ÿä¸­ï¼Œå¼•ç”¨çš„æ˜¯ç‰©ç†æœåŠ¡å™¨ï¼›åœ¨æ¸²æŸ“æœåŠ¡å™¨ä¸­ï¼Œå¦‚ä»¥ä¸Šä½¿ç”¨å‘½ä»¤é˜Ÿåˆ—çš„å®å®šä¹‰ä¸­ï¼Œå°±æ˜¯ç²’å­æ¸²æŸ“æè´¨å­˜å‚¨æœåŠ¡ï¼š

```C++,ignore
// godot\servers\rendering\rendering_server_default.h
#define ServerName RendererMaterialStorage
#define server_name RSG::material_storage

    FUNC3(global_shader_parameter_add, const StringName &, GlobalShaderParameterType, const Variant &)
    FUNC1(global_shader_parameter_remove, const StringName &)
    FUNC0RC(Vector<StringName>, global_shader_parameter_get_list)
    FUNC2(global_shader_parameter_set, const StringName &, const Variant &)
    FUNC2(global_shader_parameter_set_override, const StringName &, const Variant &)
    FUNC1RC(GlobalShaderParameterType, global_shader_parameter_get_type, const StringName &)
    FUNC1RC(Variant, global_shader_parameter_get, const StringName &)

    FUNC1(global_shader_parameters_load_settings, bool)
    FUNC0(global_shader_parameters_clear)

// godot\servers\physics_server_2d_wrap_mt.h
   #define ServerName PhysicsServer2D
   #define ServerNameWrapMT PhysicsServer2DWrapMT
   #define server_name physics_server_2d

// godot\servers\physics_server_3d_wrap_mt.h
// godot\ervers/physics_server_3d.h
   #define ServerName PhysicsServer3D
   #define ServerNameWrapMT PhysicsServer3DWrapMT
   #define server_name physics_server_3d
```

åº•å±‚æœåŠ¡å™¨ä½¿ç”¨å¤šçº¿ç¨‹å‘½ä»¤é˜Ÿåˆ—æ¥ç®¡ç†å„ç§æ“ä½œï¼Œæ¯ä¸ªæœåŠ¡å™¨å¯¹è±¡éƒ½æœ‰å‘½ä»¤é˜Ÿåˆ— `CommandQueueMT`ï¼Œæ‰€æœ‰
å‘½ä»¤éƒ½é€šè¿‡å…¥æ ˆçš„å½¢å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚ pushã€ push_and_retã€ push_and_sync åˆ†åˆ«ä»£è¡¨æ— åå›å€¼çš„å‘½ä»¤ã€
æœ‰è¿”å›å€¼çš„å‘½ä»¤ï¼Œå’ŒåŒæ­¥å‘½ä»¤æ“ä½œç­‰ç­‰ï¼Œå†å¦å¤–ä½œæ·±å…¥æ¢ç´¢ã€‚


ç²’å­æ¸²æŸ“æè´¨å­˜å‚¨æœåŠ¡å®šä¹‰åœ¨ `RendererParticlesStorage` æ¥å£ï¼Œ`ParticlesStorage` æä¾›å®ç°ï¼Œ
è´Ÿè´£å¼•æ“çš„æ¸²æŸ“æœåŠ¡ä¸ç€è‰²å™¨çš„æ•°æ®äº¤æµã€‚

```C++
// godot\servers\rendering\storage\particles_storage.h
// godot\servers\rendering\renderer_rd\storage_rd\particles_storage.h
// godot\drivers\gles3\storage\texture_storage.h
// godot\drivers\gles3\storage\material_storage.h
// godot\drivers\gles3\storage\particles_storage.h
// godot\servers\rendering\rendering_device.h
// godot\servers\rendering\renderer_rd\shaders\particles.glsl
```

ä»¥ä¸‹æ˜¯é»˜è®¤çš„æ¸²æŸ“æœåŠ¡å™¨çš„ draw() æ–¹æ³•ç®€è¦æµç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†æ›´æ–°ç²’å­ç³»ç»Ÿï¼Œæœ€ä¸»è¦çš„æ˜¯è°ƒç”¨ç²’å­å¤„ç†æ–¹æ³•ï¼š

    +=================================+    +=================================+
    | RenderingServerDefault          |    | ParticlesStorage                |
    |---------------------------------|    |---------------------------------|
    | ======================== draw() |    | ========== _particles_process() |
    | ---------------v--------------  |    | TextureStorage ...              |
    | command_queue:                  |    | MaterialStorage ...             |
    |            ->push(_thread_draw) |    | ParticlesStorage ...            |
    | ---------------v--------------  |    | RenderingDevice ...             |
    | ======================= _draw() |    | ->compute_list_begin()          |
    |   emit_signal("frame_pre_draw") |    | ->compute_list_bind_compute_pipeline() |
    | ---------------v--------------  |    | ->compute_list_bind_uniform_set()  |
    | RendererCompositor:             |    | ->compute_list_set_push_constant() |
    |                 ->begin_frame() |    | ->compute_list_add_barrier()    |
    | RendererSceneRender:            |    | ->compute_list_end()            |
    |                      ->update() |    |                                 |
    | RendererParticlesStorage:       |    |                                 |
    |            ->update_particles() | -> |                                 |
    | RenderingMethod:                |    +=================================+
    |               ->render_probes() |
    | RendererViewport:               |
    |              ->draw_viewports() |
    | RendererCanvasRender:           |
    |                      ->update() |
    | RendererCompositor:             |
    |                   ->end_frame() |
    | RenderingMethod:                |
    | ->update_visibility_notifiers() |
    | RendererCanvasRender:           |
    | ->update_visibility_notifiers() |
    | ---------------v--------------  |
    |  emit_signal("frame_post_draw") |
    +=================================+


ç²’å­å±æ€§é¢æ¿å†…å®¹å‚è€ƒï¼š

- Texture åœ¨ç²’å­ä¸Šæ˜¾ç¤ºçš„çº¹ç†ã€‚
- Time ç”Ÿå­˜å‘¨æœŸå‚æ•°ã€‚
    - Lifetime ç”Ÿå‘½å‘¨æœŸï¼Œç²’å­åœ¨åœºæ™¯ä¸­å­˜æ´»çš„æ—¶é—´ã€‚
    - One Shot å•æ¬¡è§¦å‘ç²’å­é‡Šæ”¾ï¼Œä¸ä¼šå¾ªç¯è¿›è¡Œã€‚
    - Preprocess é¢„è®¡ç®—å¯ä»¥è®©ç²’å­è®¡ç®—ç›´æ¥è¿›å…¥è®¡ç®—è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç­‰åˆ°åŠ è½½ç²’å­åˆ°åœºæ™¯åä»åˆå§‹çŠ¶æ€å¼€å§‹ã€‚
    - Speed Scale ç²’å­è¿åŠ¨é€Ÿåº¦ç¼©æ”¾ã€‚
    - Explosiveness çˆ†å‘åº¦ï¼Œ1 è¡¨ç¤ºå®Œå…¨æš´å‘ï¼Œ0 ä¸ºå¹³å‡å‘å°„ç²’å­ã€‚
    - Randomness è®¾ç½®ç”Ÿå­˜å‘¨æœŸçš„éšæœºæ€§ã€‚
    - Fixed FPS è®¾ç½®ç²’å­æ¸²æŸ“å¸§ç‡ï¼Œä½†ä¸å½±å“ç²’å­ç³»ç»Ÿçš„è¿ç®—å¸§ç‡ã€‚
    - Fract Delta æ˜¯å¦å¯ç”¨åˆ†æ•°å¢é‡ï¼Œç²’å­ç€è‰²å™¨å˜æ¢çŸ©é˜µå¯ä»¥å¢å€¼ PARTICLE.velocity * local_deltaã€‚
- Drawing ç»˜å›¾å‚æ•°
    - Visibility Rect å¯è§†çŸ©å½¢åŒºï¼Œéœ€è¦è¶…å‡ºå±å¹•æ—¶ä¿æŒç²’å­æ—¶ï¼Œè®¾ç½®å¤§ä¸€ç‚¹çš„å¯è§†åŒºã€‚
    - Local Coords ç²’å­æ˜¯å¦ä½¿ç”¨çˆ¶èŠ‚ç‚¹çš„å±€éƒ¨åæ ‡ç©ºé—´ã€‚false è¡¨ç¤ºä½¿ç”¨å…¨å±€åæ ‡ã€‚
    - Draw Order ç²’å­ç»˜åˆ¶é¡ºåºï¼Œç¼ºçœå€¼ï¼šDRAW_ORDER_INDEXï¼Œå¯ä»¥æŒ‰ç”Ÿæˆåºï¼Œæˆ–è€…ååºã€‚

ParticleProcessMaterial ç²’å­æè´¨å‚æ•°å‚è€ƒï¼š

- Direction è®¾ç½®ä¸€ä¸ªçŸ¢é‡æŒ‡ç¤ºç²’å­é€Ÿåº¦æ–¹å‘ï¼Œä¸åˆå§‹é€Ÿåº¦å†³å®šè¿åŠ¨é€Ÿåº¦ã€‚
    - Spread æ•£å°„è§’åº¦ï¼Œç²’å­å‘å°„æ–¹å‘èŒƒå›´ä» +spread åˆ° -spreadã€‚
    - Flatness å¹³æ»‘åº¦è®¾ç½®ä¸º 1 ç›¸å½“äºæ²¡æœ‰æ•£å°„ã€‚
- Gravity è®¾ç½®ä¸€ä¸ªçŸ¢é‡æŒ‡ç¤ºé‡åŠ›å¤§å°çš„æ–¹å‘ã€‚
- Initial Velocity åˆå§‹é€Ÿåº¦ï¼Œå‡†ç¡®åœ°è®²æ˜¯é€Ÿç‡ speedï¼Œè€Œé velocityã€‚
- Angular Velocity ç²’å­è‡ªè½¬è§’é€Ÿåº¦ï¼ŒSpin Velocityï¼Œå¯ä½¿ç”¨æ›²çº¿æ§åˆ¶ï¼Œæ›²çº¿å·¦ä¾§æ§åˆ¶æœ€å¼€å§‹å‘å°„çš„ç²’å­ã€‚
- Orbit Velocity è½¨é“é€Ÿåº¦ï¼Œä¼šç»è¿‡å‘å°„ç‚¹å½¢æˆåœ†å½¢è¿åŠ¨è½¨é“ï¼Œé€Ÿåº¦æ˜¯æ¯ç§’ç»•è¡Œå‘¨æ•°ï¼Œæ›²çº¿æ°´å¹³è½´è¡¨ç¤ºç”Ÿå­˜æ—¶é—´ã€‚
- Linear Acceleration çº¿æ€§åŠ é€Ÿåº¦ã€‚
- Radial Acceleration å¾„å‘åŠ é€Ÿåº¦ï¼Œæ­£å€¼æŒ‰åŸæ–¹å‘åŠ é€Ÿã€‚ç”Ÿå­˜æ—¶é—´å¤Ÿé•¿ï¼Œè´Ÿå€¼å¯ä»¥å®ç°åå‘è¿åŠ¨ã€‚
- Tangential Acceleration åˆ‡å‘åŠ é€Ÿåº¦ï¼Œä¸å½“å‰é€Ÿåº¦å‚ç›´çš„åŠ é€Ÿåº¦ã€‚æ›²çº¿æ–¹å¼ä¸‹ï¼Œæ°´å¹³è½´è¡¨ç¤ºç²’å­ç”Ÿå­˜æ—¶é—´ã€‚
- Damping é€Ÿåº¦é˜»å°¼ï¼Œå¯¹è§’åº¦ã€è½¨é“ç­‰æ—‹è½¬è¿åŠ¨æ— æ•ˆã€‚æ›²çº¿æ§åˆ¶æ—¶ï¼Œæ°´å¹³è½´è¡¨ç¤ºç²’å­ç”Ÿå­˜æ—¶é—´ã€‚
- Angle ç²’å­æ—‹è½¬è§’åº¦ï¼Œä½¿ç”¨æ›²çº¿æ§åˆ¶æ—¶ï¼Œæ°´å¹³è½´è¡¨ç¤ºç²’å­ç”Ÿå­˜æ—¶é—´ã€‚
- Scale ç²’å­ç¼©æ”¾ï¼Œå¯ä»¥ç”¨æ›²çº¿æ§åˆ¶ï¼Œæ›²çº¿ä»å·¦åˆ°å³è¡¨ç¤ºç²’å­çš„å‘å°„æ—¶é—´ï¼Œå€æ•°å–æ›²çº¿å€¼ä¸ scale ä¹˜ç§¯ã€‚
- Color é¢œè‰²è°ƒåˆ¶ï¼Œç™½è‰²æ— æ•ˆæœã€‚
    - Color æˆ– Color Ramp æ¸å˜å·¦ä¾§è¡¨ç¤ºæ¯ä¸ªç²’å­çš„åˆå§‹é¢œè‰²ã€‚é¢œè‰²ä¼šå’Œ Particle2D çš„çº¹ç†ç›¸ä¹˜ã€‚
    - Color Random æŒ‡å®šæ¸å˜ï¼Œç²’å­çš„é¢œè‰²å°†æŒ‰å‘å°„é¡ºåºæ²¿ç€ GradientTexture å˜åŒ–ã€‚
- Hue variation ç²’å­è‰²è°ƒã€‚
    - Variation ç²’å­çš„åˆå§‹è‰²è°ƒï¼Œå¯ä»¥ç»“åˆéšæœºæ€§ä½¿ç”¨ã€‚
    - Variation Curve ç²’å­æ²¿ç€ CurveTexture æ”¹å˜è‰²è°ƒã€‚

é™¤äº†ä»¥ä¸ŠåŸºæœ¬çš„ç²’å­å±æ€§ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªé‡è¦çš„ç²’å­æ•ˆæœè®¾ç½®ï¼ŒåŒ…æ‹¬ï¼š

- Trail å°¾è¿¹ã€æ®‹å½±æ•ˆæœ
- Particles Animation ç²’å­åŠ¨ç”»
- Emission Shapes & Emission Mask å‘å°„å½¢çŠ¶ä¸é®æŒ¡åŠŸèƒ½


Flags æ ‡å¿—ä½è®¾ç½®ï¼Œè½¨é“è¿åŠ¨åªåœ¨ Disable Z æ¿€æ´»æ—¶æœ‰æ•ˆï¼Œå¦‚æœä¸ç¦æ­¢ Z è½´ç§»åŠ¨ï¼Œæ–¹å‘ spread æœ‰å‰¯ä½œç”¨ã€‚
å…¶ä»– particle_flags å‚è€ƒ `ParticleProcessMaterial::_update_shader()` çš„ç€è‰²å™¨é…ç½®æµç¨‹ã€‚


Animation ç²’å­åŠ¨ç”»ï¼Œå¦‚æœç›´æ¥è®¾ç½®æ­¤å±æ€§ï¼Œç‚¹å‡»ç²’å­æè´¨åˆ‡æ¢é¢æ¿æ—¶ï¼Œå¯èƒ½ä¼šåœ¨èŠ‚ç‚¹æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼šç²’å­åŠ¨ç”»
éœ€è¦å’Œ `CanvasItemMaterial` ä¸­çš„åŠ¨ç”»é€‰é¡¹ç»“åˆä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¦ä¸º 2D èŠ‚ç‚¹åˆ›å»ºæè´¨ï¼Œå¹¶ä¸”è®¾ç½®ç²’å­åŠ¨ç”»ä¸º
æ¿€æ´»çŠ¶æ€ï¼ŒParticles Animation å‹¾é€‰çŠ¶æ€ã€‚å³å°† CanvasItem å½“ä½œ Sprite Animation æ¥ä½¿ç”¨ï¼Œå¯¹å…¶
è¿›è¡ŒçŸ©å½¢åˆ‡å‰²æˆæ ¼å­ï¼Œå°±åƒ `AnimatedSprite` èŠ‚ç‚¹é‚£æ ·ã€‚

æ­¤æ—¶ï¼Œæè´¨é¢æ¿å‡ºç°ç›¸åº”çš„ä¸‰ä¸ªé€‰é¡¹ï¼Œåˆ†åˆ«ç”¨äºæŒ‡å®šæ ¼å­åˆ—æ•°ã€è¡Œæ•°å’Œå¾ªç¯ï¼š

- Particles Anim H Frames
- Particles Anim V Frames
- Particles Anim loop

å›åˆ°ç²’å­æè´¨é¢æ¿ï¼Œå¯ä»¥æŒ‡å®šç²’å­åŠ¨ç”»æ’­æ”¾å¸§ç‡ï¼Œé€Ÿåº¦ä¸º 0 å°±æ˜¯é™æ€å¸§ã€‚è®¾ç½®ç²’å­åŠ¨ç”»åç§»ï¼ŒOffset æŒ‡å®šçš„
æ˜¯æ‰€æœ‰ Sprites çš„ç™¾åˆ†æ¯”åç§»ä½ç½®ã€‚ä½¿ç”¨æ›²çº¿è®¾ç½® Speed æˆ– Offsetï¼Œæ›²çº¿æ°´å¹³è½´ä¸ºç²’å­ç”Ÿå­˜æ—¶é—´ã€‚



2D ç²’å­å¯ä»¥åœ¨ **Emission Shapes** æŒ‡å®šä¸€ä¸ªå½¢çŠ¶ï¼Œç‚¹ã€çŸ©å½¢ã€åœ†å½¢ç­‰ï¼Œç”¨æ¥ç¡®å®ç²’å­å‘å°„çš„èµ·å§‹ç‚¹ã€åŒºåŸŸã€‚
ParticlesMaterial æä¾›äº† Emission Mask å‘å°„é®æŒ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥æŒ‰çº¹ç†èµ„æºæ¥ç”Ÿæˆç²’å­å‘å°„åŒºåŸŸã€æ–¹å‘ã€‚
åˆ›å»ºç²’å­èŠ‚ç‚¹åï¼Œåœ¨å·¥å…·æ ä¸­åº”æ˜¾ç¤º "Particles" ç²’å­èœå•ï¼Œé€‰æ‹© Load Emission Maskã€‚

![Load Emission Mask](https://docs.godotengine.org/zh_CN/latest/_images/emission_shapes2.png)

Emission Mask å¯¹è¯æ¡†æä¾›ä¸‰ç§å‘å°„é®æŒ¡ç±»å‹ä»¥åŠä¸€ä¸ªå–è‰²é€‰é¡¹ï¼Œçº¹ç†å›¾åƒä¸­çš„è‰²å½©ã€é€æ˜åŒºéƒ½ä¼šå½±å“ç»“æœ:

- Solid Pixels å®å¿ƒåƒç´ ï¼šçº¹ç†ä»»ä½•åŒºåŸŸéƒ½å¯ä»¥äº§ç”Ÿç²’å­ï¼Œé€æ˜åŒºåŸŸé™¤å¤–ã€‚
- Border Pixels è¾¹ç•Œåƒç´ ï¼šä»å›¾åƒä¸­æ£€æµ‹è¾¹ç¼˜ï¼Œç²’å­å°†ä»çº¹ç†çš„å¤–è¾¹ç¼˜äº§ç”Ÿã€‚
- Directed Border Pixels æœ‰å‘è¾¹ç•Œåƒç´ ï¼šç±»ä¼¼äºè¾¹ç•Œåƒç´ ï¼Œä½†æŒ‰åˆå§‹é€Ÿåº¦ä»è¾¹ç•Œå‘å¤–å‘å°„ç²’å­ã€‚
- Capture from Pixel å‘å°„è‰²å½©ï¼Œä¼šä½¿ç²’å­åœ¨å…¶äº§ç”Ÿç‚¹å¤„ç»§æ‰¿é®æŒ¡æè´¨çš„é¢œè‰².

ç¡®å®šç”Ÿæˆé®æŒ¡åï¼Œç¨‹åºå°±ä¼šä¸ºç²’å­è®¾ç½®å¥½æè´¨ï¼Œå¯ä»¥å›åˆ°ç²’å­å±æ€§é¢æ¿ Emission Shape ä¸­æŸ¥çœ‹ã€‚éœ€è¦æ³¨æ„ï¼Œ
ä¸åº”è¯¥ç›´æ¥åœ¨å±æ€§é¢æ¿ä¸­æ·»åŠ å›¾åƒ Point Texture æˆ– Color Textureï¼Œç¨‹åºéœ€è¦é€šè¿‡ Load Emisson Mask
èœå•æ‰§è¡Œæ•°æ®å¤„ç†å·¥ä½œï¼Œæ‰èƒ½æ­£ç¡®ä½¿ç”¨ Emisson Maskã€‚


Trail å°¾è¿¹ã€æ®‹å½±æ•ˆæœï¼Œç²’å­æ•°é‡ä¸é™¤æ•° Divisor ç›¸é™¤å– ceiling å€¼ä¸ºå‘å°„çš„ç²’å­æ•°é‡ï¼Œä½™ä¸‹å…¨éƒ¨ç²’å­
å°†ä½œä¸ºå°¾è¿¹æ•ˆæœç²’å­ã€‚

æ¯”å¦‚ï¼Œç²’å­å‘å°„æ•°é‡ Amount = 10ï¼Œè€Œ Divisor = 7ï¼Œå³å‘å°„ 2 ä¸ªç²’å­ï¼Œå…¶ä½™ç²’å­å°†ä½œä¸ºå‘è¿¹æ•ˆæœä½¿ç”¨ã€‚
å°¾è¿¹ä¹Ÿå—åˆ°çˆ†å‘å±æ€§çš„å½±å“ï¼Œå¦‚æœ Explosiveness = 1ï¼Œé‚£ä¹ˆå°¾è¿¹ä¹Ÿä¼šéšå…¶å®ƒç²’å­ä¸€èµ·å‘å°„ã€‚

- **Size Modifile** æŒ‡å®š CurveTexture è®¾ç½®æ§åˆ¶è½¨è¿¹ç²’å­çš„å¤§å°å˜åŒ–çš„æ›²çº¿ã€‚
- **Color Modifile** æŒ‡å®š GradientTexture æ§åˆ¶è½¨è¿¹ç²’å­çš„é¢œè‰²å˜åŒ–ã€‚

ä»¥ä¸Šæ˜¯ Godot 3.5 çš„æ“ä½œï¼ŒGodot 4.0 ç‰ˆæœ¬ä¸­çš„ 2D ç²’å­å°¾è¿¹ä½¿ç”¨ç½‘æ ¼è’™çš®çš„æ–¹å¼ã€‚æ–°ç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡è®¾ç½®
Section æ¥æ§åˆ¶å°¾è¿¹çš„ç²¾ç»†åº¦ï¼Œå¦å¤–ç»†åˆ† Subdivisions æ•°å€¼è¶Šå¤§ä¹Ÿè¶Šç²¾ç»†ã€‚é€šè¿‡ Lifetime æ§åˆ¶å°¾è¿¹çš„
é•¿åº¦ï¼Œæ—¶é—´è¶Šé•¿ï¼Œå°¾è¿¹è¶Šé•¿ï¼Œè¿™ä¸æ—§ç‰ˆæœ¬å•ç‹¬ç»˜åˆ¶ä¸€è¿ä¸²çš„å°¾è¿¹ç²’å­çš„æ–¹å¼æœ‰å¾ˆå¤§çš„ä¸åŒã€‚

å¦å¤–ï¼ŒGodot 4.0 è¿˜å¢åŠ å¤šä¸ªç²’å­æè´¨åŠŸèƒ½ï¼ŒåŒæ—¶æ”¯æŒ `emit_particle()` æ‰‹åŠ¨å‘å°„ï¼š

- Turbulence æ¹æµæ‰°åŠ¨
- Sub Emitter å­å‘å°„å™¨ç³»ç»Ÿï¼ŒæŒ‡å®šä¸€ä¸ªå­å‘å°„å™¨åœ¨ç€è‰²å™¨ä¸­å‘å°„ç²’å­ã€‚
- Collision ç¢°æ’ï¼ŒRigid æˆ– Hide on Contact ä¸¤ç§ç¢°æ’å“åº”ï¼Œå‰è€…ç¢°æ’ååå¼¹ï¼Œåè€…ä¼šéšè—ç²’å­ã€‚
- Attrator Interaction å¸æ”¶å™¨äº¤äº’ï¼Œä½¿ç‰©ä½“å‘ Sphere æˆ– Box ä¸­å¿ƒç§»åŠ¨ã€‚

å­å‘å°„å™¨æœ‰ä¸‰ç§è§¦å‘æ–¹å¼ï¼šAt Constantã€At Endã€At Collisionã€‚ä»¥åè€…ä¸ºä¾‹ï¼Œåœ¨ç²’å­ç¢°æ’æ—¶è§¦å‘å­å‘å°„å™¨ã€‚
åœ¨ç²’å­æè´¨ä¸­ï¼Œç»™ Sub Emitter å±æ€§æŒ‡å®šä¸€ä¸ªå‘å°„å™¨ï¼Œåœ¨ç²’å­ç¢°æ’äº‹ï¼Œå°±ä¼šè§¦å‘å®ƒå‘å°„ç²’å­ã€‚æ¯”å¦‚ï¼Œæœºæªæ‰«å°„
çš„å­æ‰“ä¸­ç»ç’ƒç“¶ï¼Œç“¶çš„ç¢ç‰‡å››å°„ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸€çº§å‘å°„å™¨åŠ å­å‘å°„å™¨çš„æ•ˆæœã€‚


Baked SDF Collision
Still, for complex interiors, creating all the collisions with boxes and spheres can be a hassle. Additionally, you may want collider objects with more complex shapes to interact with particles.

To solve this, the SDF collider was added. It bakes an area of a custom resolution as a signed distance field. This allows approximate complex collisions with geometry (without having to test the actual geometry, which is expensive).
çƒ˜ç„™SDFç¢°æ’

å°½ç®¡å¦‚æ­¤ï¼Œå¯¹äºå¤æ‚çš„å†…éƒ¨ï¼Œç”¨ç›’å­å’Œçƒä½“åˆ¶é€ æ‰€æœ‰çš„ç¢°æ’å¯èƒ½ä¼šå¾ˆéº»çƒ¦ã€‚æ­¤å¤–ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å…·æœ‰æ›´å¤æ‚å½¢çŠ¶çš„ç¢°æ’å™¨å¯¹è±¡ä¸ç²’å­äº¤äº’ã€‚
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ·»åŠ äº†SDFå¯¹æ’æœºã€‚å®ƒå°†è‡ªå®šä¹‰åˆ†è¾¨ç‡çš„åŒºåŸŸçƒ˜ç„™ä¸ºå¸¦ç¬¦å·çš„è·ç¦»å­—æ®µã€‚è¿™å…è®¸ä¸å‡ ä½•ä½“å‘ç”Ÿè¿‘ä¼¼å¤æ‚çš„ç¢°æ’ï¼ˆæ— éœ€æµ‹è¯•å®é™…å‡ ä½•ä½“ï¼Œè¿™å¾ˆæ˜‚è´µï¼‰ã€‚

Heightfield Collision
While SDF collision works great for certain objects and interiors, it would require too much memory to be used in exteriors. For this, heightfield collision has more advantages.

ä½œä¸ºç²’å­çš„åŸºæœ¬ä¸­æœ‰å‡ ä¸ªç‰¹åˆ«çš„èµ„æºç±»å‹ primitive_meshes.h ï¼š

- **ArrayMesh** è¿™æ˜¯ Godot ç½‘æ ¼èµ„æºå¤„ç†ç±»ï¼Œæœ¬èº«ä¸æ˜¯åŸºæœ¬ä½“ï¼Œå¸¸ç”¨äºå‡ ä½•ä½“çš„ä»£ç å¤„ç†æ–¹å¼ã€‚
- **TextMesh** æ–‡å­—ç½‘æ ¼ï¼Œåªæ”¯æŒä» DynamicFont çŸ¢é‡å­—ä½“çš„è½®å»“ç”Ÿæˆï¼Œéœ€è¦è®¾ç½® Text å±æ€§åŠå­—ä½“ï¼›
- **QuadMesh** å››è¾¹é¢åŸºæœ¬ä½“ï¼Œæ²¡æœ‰åšåº¦ã€ç»†åˆ†ï¼Œé€‚åˆäºå¸ƒå‘Šæ¿æè´¨ï¼Œæ–°ç‰ˆæœ¬ä¸­ä½œä¸º PlaneMesh å­ç±»å½¢ï¼›
- **PointMesh** å•é¡¶ç‚¹åŸºæœ¬ä½“ï¼›

PointMesh æ˜¯åªæœ‰å•ä¸ªé¡¶ç‚¹çš„åŸºæœ¬ä½“ï¼Œå®ƒå¯ä»¥ç”¨äºç²’å­ç³»ç»Ÿã€‚å®ƒç”šè‡³éƒ½ä¸èƒ½å«åš Meshï¼Œä½†æ˜¯å…‰æ …åŒ–æ—¶å®ƒå°±æ˜¯
ä¸€ä¸ªå›ºå®šå¤§å°çš„æ–¹å—ï¼Œå³ä¸è®ºè¿œè¿‘åœ°çœ‹ï¼Œå®ƒåœ¨å±å¹•ä¸Šçš„å¤§å°æ˜¯æ’å®šçš„ï¼ŒæŒ‰ Point Size æŒ‡å®šå¤§å°æ˜¾ç¤ºã€‚è¿™ç§æ–¹å—
ä¸æ˜¯å››ä¸ªé¡¶ç‚¹çš„é‚£ç§çŸ©å½¢ã€‚å®ƒæ›´æ¶‰åŠçš„åŠŸèƒ½å°‘ï¼Œæ›´èŠ‚çœèµ„æºã€‚è¦ä½¿ç”¨ç²’å­ç€è‰²å™¨çš„é¢œè‰²ï¼Œå°±è¦åœ¨ç²’å­æè´¨ä¸­å‹¾é€‰
Vertex Color - Use As Albedoï¼Œå³è¡¨ç¤ºä½¿ç”¨ç²’å­ç€è‰²å™¨ Color å±æ€§ã€‚

PointMeshe ä½œä¸ºç²’å­ä½¿ç”¨æ—¶ï¼Œå¿…éœ€æ¿€æ´» SpatialMaterial æè´¨çš„ `flags_use_point_size` æ ‡å¿—ã€‚
åŒæ—¶è®¾ç½®æè´¨å‚æ•°ä¸­çš„ `params_point_size`ï¼Œç²’å­å°ºå¯¸å¯ä»¥ä½¿ç”¨ç€è‰²å™¨çš„ `POINT_SIZE` ç¬¦å·è®¿é—®ã€‚
æ­¤å¤–ï¼Œä¸€äº›é¡¶ç‚¹æ“ä½œçš„å¸¸è§„åŠŸèƒ½ä¼šå¤±æ•ˆï¼ŒåŒ…æ‹¬å¸ƒå‘Šç‰Œæ¨¡å¼ã€å¢æ®–å’Œå‰”é™¤é¢ï¼Œbillboard, grow, cull faceã€‚

QuadMesh åŸºæœ¬ä½“ä¸€èˆ¬åŒéœ€è¦å¯ç”¨ Parameters - Billboard Modeï¼Œå¦åˆ™åœ¨èƒŒé¢æ˜¯çœ‹ä¸è§çš„ï¼Œä»å…¶æ„é€ å™¨
å¯ä»¥äº†è§£åˆ°ï¼Œé»˜è®¤çš„é¢æœå‘æ˜¯ `set_orientation(FACE_Z)`ï¼Œå¯ç”¨å¸ƒå‘Šæ¿æ¨¡å¼åï¼Œå°±ä¸€ç›´æœå‘é•œå¤´ã€‚å¦å¤–ï¼Œ
è®¾ç½® Flip Faces ä¼šåè½¬ç»˜åˆ¶ä¸‰è§’å½¢çš„é¡¶ç‚¹é¡ºåºï¼Œä¼šå½±å“ Cull Backã€‚

è™½ç„¶å¯ä»¥ç»™ç²’å­æè´¨è®¾ç½®å‘å…‰ Emissionï¼Œä½†è¿™åªæ˜¯ä¸€ç§é¢œè‰²ï¼Œéå…‰ç…§æ¨¡æ‹Ÿï¼Œæ‰€ä»¥ä¸ä¼šç»™å‘¨å›´ç¯å¢ƒå¸¦æ¥å…‰æ•ˆã€‚


### ğŸŸ ğŸ”µ Ray-casting å°„çº¿æŠ•å°„å·¥å…·
- https://docs.godotengine.org/en/latest/tutorials/physics/ray-casting.html
- https://docs.godotengine.org/en/latest/classes/class_physicsserver2d.html
- https://docs.godotengine.org/en/latest/classes/class_physicsserver3d.html
- https://docs.godotengine.org/en/stable/classes/class_physics2dserver.html
- https://docs.godotengine.org/en/stable/classes/class_physicsserver.html
- https://kidscancode.org/godot_recipes/3.x/kyn/raycast2d/

å°„çº¿æŠ•å°„æ˜¯æ¸¸æˆå¼€å‘çš„ä¸€ä¸ªå¸¸ç”¨å·¥å…·ï¼Œé€šè¿‡æŠ•å°„è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œå¯ä»¥è·å–åˆ°ç¢°æ’ç‰©ä½“çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¢°æ’ç‚¹åæ ‡ã€‚
Godot ç³»ç»Ÿæ¶æ„ä¸­ï¼Œé€šè¿‡åº•å±‚çš„ PhysicsServer ç®¡ç†ç‰©ç†ç©ºé—´ï¼Œè¿™ä¸ªç©ºé—´è®°å½•äº†æ‰€æœ‰åº•å±‚çš„ä¿¡æ¯ï¼Œè€Œåœºæ™¯æ ‘
åªæ˜¯å‰ç«¯å¯è§†éƒ¨åˆ†ã€‚ç®€å•çš„æŠ•å°„å·¥å…· `RayCast2D` æˆ–è€… `RayCast3D` èŠ‚ç‚¹ï¼Œéœ€è¦æŸ¥è¯¢è¿™ä¸ªç©ºé—´æä¾›çš„åº•å±‚
æ•°æ®æ¥å®ç°ç¢°æ’æ£€æµ‹ï¼Œå¹¶åœ¨æ¯ä¸€å¸§éƒ½è¿”å›æ£€æµ‹ç»“æœã€‚

æ­¤å¤–ï¼ŒGodot 4 è¿˜æ–°å¢äº† ShapeCast2D/3D å½¢çŠ¶æŠ•å°„å·¥å…·ã€‚

ç‰©ç†ç³»ç»Ÿçš„æ¨¡æ‹Ÿè®¡ç®—æ˜¯æ¯ä¸€å¸§éƒ½åœ¨æŒç»­è¿›è¡Œçš„ï¼Œç¢°æ’æ£€æµ‹ä¸­è¦ä½¿ç”¨æœ€æ–°çš„ç¢°æ’ä¿¡æ¯ï¼Œå¯ä»¥å¼ºåˆ¶æ‰§è¡Œæ›´æ–°æ–¹æ³•ï¼š

- force_raycast_update()
- force_shapecast_update()

ä¸¤ç±»æŠ•å°„å·¥å…·éƒ½æœ‰å¼ºåˆ¶æ›´æ–°ç¢°æ’ä¿¡æ¯çš„æ–¹æ³•ï¼Œæ‰§è¡Œå®ƒä»¬å°±å¯ä»¥åœ¨å½“å‰å¸§è·å–åˆ°æœ€æ–°ç¢°æ’æ£€æµ‹æ•°æ®ï¼Œè€Œä¸å¿…ç­‰å¾…
ä¸‹ä¸€ä¸ª physics process è°ƒç”¨ã€‚æ¯”å¦‚ï¼Œå°„çº¿çš„çˆ¶èŠ‚ç‚¹æ”¹å˜äº†çŠ¶æ€ï¼Œå°±å¯ä»¥åŠæ—¶è·å–åˆ°è¿™ä¹ˆå˜åŒ–ã€‚

ç‰©ç†å¼•æ“çš„è¿ç®—å‘¨æœŸå¯ä»¥åœ¨å·¥ç¨‹é…ç½®ä¸­è®¾ç½®ï¼ŒPhysics Commonï¼ŒæŒ‡å®š Physics FPSã€‚

ç‰©ç†ç©ºé—´å¯¹è±¡å½’å±äºä¸€ä¸ª World å¯¹è±¡ï¼Œé€šè¿‡èŠ‚ç‚¹çš„ get_world æ–¹æ³•å¯ä»¥è·å–åˆ°ä¸–ç•Œå¯¹è±¡ï¼Œä¸–ç•Œå¯¹è±¡éƒ½æœ‰ç‰©ç†
ç©ºé—´èµ„æºçš„ RID å¼•ç”¨åœ¨ space å±æ€§ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ Physics2DServer æˆ–è€… PhysicsServer3D è¿™äº›
åº•å±‚æœåŠ¡å™¨å¯¹è±¡çš„ space_get_direct_state ( RID space ) æ–¹æ³•ç›´æ¥ä½¿ç”¨ç‰©ç†ç©ºé—´èµ„æºã€‚

```py
    func _physics_process(delta):
        var space_rid = get_world_2d().space

        var space_state = PhysicsServer.space_get_direct_state(space_rid)
        var space_state = Physics2DServer.space_get_direct_state(space_rid)

        var space_state = PhysicsServer2D.space_get_direct_state(space_rid)
        var space_state = PhysicsServer3D.space_get_direct_state(space_rid)

        var space_state = get_world_2d().direct_space_state
        var space_state = get_world_3d().direct_space_state
```

Space å¯¹è±¡å’Œå°„çº¿æ±‚äº¤ç›¸å…³çš„æ–¹æ³•æ˜¯ `intersect_ray()`ï¼Œå°„çº¿æŒ‰çº¿æ®µçš„æ–¹å¼ç»™å‡ºä¼ æ’­æ–¹å‘ä¸Šçš„ä¸¤ç‚¹åæ ‡ï¼Œ
é€šè¿‡ QueryParameters ä¼ å…¥æŸ¥è¯¢æœåŠ¡ APIï¼Œå°„çº¿åœ¨è¿™æ®µè¡Œç¨‹ä¸­ç¢°æ’åˆ°çš„å¯¹è±¡ä¿¡æ¯ï¼Œä½œä¸ºæŸ¥è¯¢ç»“æœä¿å­˜åœ¨
å­—å…¸å¯¹è±¡ä¸­è¿”å›ã€‚

Godot 3.5 ä¸­åªå®šä¹‰äº†ä¸¤ä¸ª QueryParameters ç±»å‹ï¼Œå°„çº¿ç¢°æ’æ£€æµ‹ä¸éœ€è¦ä½¿ç”¨æŸ¥è¯¢å‚æ•°å¯¹è±¡ï¼š

- Physics2DShapeQueryParameters
- PhysicsShapeQueryParameters

Godot 4.x æ–°å¢ NavigationPath å’Œ Pointã€Ray ä¸‰ç±»æŸ¥è¯¢å‚æ•°ç±»å‹ï¼Œå°„çº¿ç¢°æ’éœ€è¦ä½¿ç”¨æŸ¥è¯¢å‚æ•°ç±»å‹ï¼š

- NavigationPathQueryParameters2D
- NavigationPathQueryParameters3D
- PhysicsPointQueryParameters2D
- PhysicsPointQueryParameters3D
- PhysicsRayQueryParameters2D
- PhysicsRayQueryParameters3D
- PhysicsShapeQueryParameters2D
- PhysicsShapeQueryParameters3D 

ç‰©ç†ç©ºé—´å¯¹è±¡æ ¹æ®è¿™äº›æŸ¥è¯¢å‚æ•°æ¥æ‰§è¡Œç›¸åº”çš„ç¢°æ’æµ‹è¯•ï¼Œå¹¶è¿”å›ç›¸åº”çš„æ•°æ®ï¼Œå®ƒä»¬å…±é€šçš„å±æ€§å¦‚ä¸‹ï¼ŒåŒ…æ‹¬ç¢°æ’
å¯¹è±¡çš„åŒºåŸŸé¢ç§¯ã€ç‰©ä½“ï¼Œè¿˜æœ‰é®ç½©å±‚ã€‚è¢«æµ‹è¯•å¯¹è±¡çš„ collision_layer å’Œæ­£åœ¨ç¢°æ’æ£€æµ‹çš„å¯¹è±¡é®ç½©å±‚ä¸€è‡´æ—¶ï¼Œ
ç¢°æ’æ‰å¯èƒ½å‘ç”Ÿã€‚æ­¤å¤–ï¼Œå¯ä»¥åœ¨ exclude æ•°ç»„ä¸­æ˜¾å¼æŒ‡å®šä¸€ä¸ªåˆ—è¡¨ï¼Œä¸éœ€è¿›è¡Œç¢°æ’æµ‹è¯•çš„å¯¹è±¡éƒ½å¯ä»¥åŠ å…¥ï¼š

```py
    bool collide_with_areas = false
    bool collide_with_bodies = true
    int collision_mask = 0xFFFFFFFF
    Array[RID] exclude = []
```

å…¶ä¸­ï¼Œå¯¼èˆªè·¯å¾„æŸ¥è¯¢å‚æ•°æ¯”è¾ƒç‰¹åˆ«ï¼Œåœ¨å¯¼èˆªç›¸å…³æ•™ç¨‹ä¸­è¯´æ˜ã€‚

é™¤äº†è¿™äº›å…±é€šçš„å±æ€§ï¼Œæ ¹æ®ä¸åŒç‰©ç†ç±»å‹çš„ç¢°æ’ï¼Œå…·ä½“çš„æŸ¥è¯¢å‚æ•°è¿˜åŒ…æ‹¬ä¸€äº›ä¸“ç”¨çš„å‚æ•°ã€‚æ¯”å¦‚ï¼Œæœ€ç®€å•çš„ç‚¹æŸ¥è¯¢
PhysicsPointQueryParameters2D åªåŒ…å«ä¸€ä¸ªäºŒç»´åæ ‡ `position` å‚æ•°ç”¨äº `intersect_point()
`è¿›è¡ŒäºŒç»´ç©ºé—´çš„ç¢°æ’æ£€æµ‹ã€‚æ£€æµ‹ç»“æœè¿”å›çš„å­—å…¸æ•°æ®ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- **collider**: The colliding object.
- **collider_id**: The colliding object's ID.
- **rid**: The intersecting object's RID.
- **shape**: The shape index of the colliding shape.

å¯¹äºå°„çº¿ç¢°æ’æ£€æµ‹ï¼Œ`intersect_ray()` éœ€è¦ç»™å‡º `from` å’Œ `to` ä¸¤ä¸ªåæ ‡è¡¨ç¤ºçº¿æ®µï¼Œåœ¨è¿™åŒºé—´è¿›è¡Œ
ç¢°æ’æ£€æµ‹ï¼Œå¦å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®š hit_from_inside æ¥æ£€æµ‹ç‰©ä½“å†…éƒ¨çš„ç¢°æ’ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›å­—å…¸ä¸­çš„æ³•å‘é‡
ä¸ºé›¶å€¼ï¼Œè¡¨ç¤ºæ²¡æœ‰æ–¹å‘ã€‚æ²¡æœ‰å‘ç”Ÿç¢°æ’æ—¶ï¼Œè¿”å›ä¸€ä¸ªç©ºå€¼å­—å…¸ã€‚

- **collider**: The colliding object.
- **collider_id**: The colliding object's ID.
- **normal**: The object's surface normal at the intersection point.
- **position**: The intersection point.
- **rid**: The intersecting object's RID.
- **shape**: The shape index of the colliding shape.

ç”¨äºå½¢çŠ¶ç¢°æ’æ£€æµ‹çš„ PhysicsShapeQueryParameters æ˜¯æ‰€æœ‰æŸ¥è¯¢å‚æ•°ä¸­æœ€å¤šä¸“ç”¨å‚æ•°çš„ç±»å‹ï¼Œè¿™ä¹Ÿæ˜¯æœ€
å¸¸ç”¨çš„ç¢°æ’æ£€æµ‹æŸ¥è¯¢å‚æ•°ï¼š

```py
    float margin = 0.0
    Vector3 motion = Vector2(0, 0)]
    Resource shape
    RID shape_rid
    Transform3D transform = Transform2D(1, 0, 0, 1, 0, 0)
```

å½¢çŠ¶ç¢°æ’æ£€æµ‹è¿”å›çš„æ˜¯ä¸€ä¸ªå­—å…¸æ•°ç»„ï¼Œintersect_shape() æ–¹æ³•çš„å‚æ•° max_results æ§åˆ¶æ±‚äº¤ç»“æœæ•°é‡ï¼š

- **collider**: The colliding object.
- **collider_id**: The colliding object's ID.
- **rid**: The intersecting object's RID.
- **shape**: The shape index of the colliding shape.


ç‰©ç†ç©ºé—´æä¾›ç¢°æ’æ£€æµ‹æ–¹æ³•å¦‚ä¸‹ï¼ŒPhysicsDirectSpaceState2D/3D å®šä¹‰äº†ç±»ä¼¼çš„ APIã€‚å…¶ä¸­ï¼Œå‰ç¼€ä¸º
intersect çš„æ˜¯ç¢°æ’æ£€æµ‹æ–¹æ³•ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•éƒ½ä¸å½¢çŠ¶ç¢°æ’æ£€æµ‹æˆ–æ±‚äº¤ç›¸å…³ã€‚

è€Œ `cast_motion()` æ£€æŸ¥ Shape3D åœ¨ä¸å‘ç”Ÿç¢°æ’çš„æƒ…å†µä¸‹å¯ä»¥ç§»åŠ¨å¤šè¿œã€‚è¿”å›çš„æ•°ç»„è¡¨ç¤ºè¿åŠ¨çš„å®‰å…¨å’Œ
ä¸å®‰å…¨æ¯”ä¾‹ï¼Œæ•°ç»„å…ƒç´ å€¼ä»‹äº 0 å’Œ 1 ä¹‹é—´ã€‚å®‰å…¨æ¯”ä¾‹æ˜¯åœ¨æ²¡æœ‰ç¢°æ’çš„æƒ…å†µä¸‹å¯ä»¥è¿›è¡Œçš„è¿åŠ¨çš„æœ€å¤§æ¯”ä¾‹ã€‚
ä¸å®‰å…¨æ¯”ä¾‹æ˜¯ç¢°æ’æ—¶å¿…é¡»ç§»åŠ¨çš„è·ç¦»çš„æœ€å°æ¯”ä¾‹ã€‚å¦‚æœæœªæ£€æµ‹åˆ°ç¢°æ’ï¼Œè¿”å› [1.0ï¼Œ1.0]ã€‚

æ³¨æ„ï¼šæ£€æµ‹å¼€å§‹å‰ï¼Œå·²ç»ä¸ä¹‹å‘ç”Ÿç¢°æ’çš„ä»»ä½• Shape éƒ½å°†è¢«å¿½ç•¥ï¼Œä¾‹å¦‚åœ¨å†…éƒ¨çš„ç¢°æ’ã€‚ä½¿ç”¨ `collide_shape()`
æ–¹æ³•å¯ä»¥ç¡®å®šå·²ç»ä¸ä¹‹ç¢°æ’å½¢çŠ¶ã€‚

`collide_shape()` æ–¹æ³•æ£€æŸ¥ç»™å®šçš„å½¢çŠ¶ä¸ç©ºé—´çš„äº¤ç‚¹ï¼Œç»“æœæ•°ç»„åŒ…å«å½¢çŠ¶ä¸å¦ä¸€å½¢çŠ¶ç›¸äº¤çš„ç‚¹åˆ—è¡¨ã€‚è¿”å›
çš„ç‚¹æ˜¯ä¸€å¯¹æ¥è§¦ç‚¹çš„åˆ—è¡¨ã€‚æ¯ä¸€å¯¹çš„ç¬¬ä¸€ä¸ªä½äº PhysicsShapeQueryParameters3D å¯¹è±¡ä¸­ä¼ é€’çš„å½¢çŠ¶ä¸­ï¼Œ
ç¬¬äºŒä¸ªä½äºç‰©ç†ç©ºé—´ä¸­çš„ç¢°æ’å½¢çŠ¶ä¸­ã€‚

`get_rest_info()` æ£€æŸ¥æŒ‡å®šå½¢çŠ¶ä¸ç©ºé—´ä¸­å½¢çŠ¶çš„äº¤ç‚¹ï¼Œå¦‚æœå®ƒä¸å¤šä¸ªå½¢çŠ¶ç¢°æ’ï¼Œå°†é€‰æ‹©æœ€è¿‘çš„ä¸€ä¸ªã€‚è¿”å›
çš„å­—å…¸å¯¹è±¡åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

- **collider_id**: The colliding object's ID.
- **linear_velocity**: The colliding object's velocity Vector3. If the object is an Area3D, the result is (0, 0, 0).
- **normal**: The object's surface normal at the intersection point.
- **point**: The intersection point.
- **rid**: The intersecting object's RID.
- **shape**: The shape index of the colliding shape.

æ³¨æ„ï¼š`collide_shape()` å’Œ `get_rest_info()` ä¸¤ä¸ªæ–¹æ³•ä¸è€ƒè™‘å¯¹è±¡çš„è¿åŠ¨ç‰¹æ€§ã€‚


Space ä¸æŠ•å°„ç›¸å…³ API å‚è€ƒï¼š

```py
# Godot 3.5 stable

    # godot-docs\stable\classes\class_canvasitem.rst
    World2D get_world_2d ( ) const

    # godot-docs\stable\classes\class_spatial.rst
    World get_world( )  const

    # godot-docs\stable\classes\class_world2d.rst
    Physics2DDirectSpaceState direct_space_state

    # godot-docs\stable\classes\class_world.rst
    PhysicsDirectSpaceState direct_space_state

# Godot 4.x beta

    # godot-docs\docs\classes\class_node3d.rst
    World3D get_world_3d ( ) const

    # godot-docs\docs\classes\class_world2d.rst
    PhysicsDirectSpaceState2D direct_space_state

    # godot-docs\docs\classes\class_world3d.rst
    PhysicsDirectSpaceState3D direct_space_state

# Space objects 

    # godot-docs\stable\classes\class_physics2ddirectspacestate.rst
         Array  cast_motion ( Physics2DShapeQueryParameters shape )
         Array  collide_shape ( Physics2DShapeQueryParameters shape, int max_results=32 )
    Dictionary  get_rest_info ( Physics2DShapeQueryParameters shape )
         Array  intersect_point ( Vector2 point, int max_results=32, Array exclude=[  ], int collision_layer=2147483647, bool collide_with_bodies=true, bool collide_with_areas=false )
         Array  intersect_point_on_canvas ( Vector2 point, int canvas_instance_id, int max_results=32, Array exclude=[  ], int collision_layer=2147483647, bool collide_with_bodies=true, bool collide_with_areas=false )
    Dictionary  intersect_ray ( Vector2 from, Vector2 to, Array exclude=[  ], int collision_layer=2147483647, bool collide_with_bodies=true, bool collide_with_areas=false )
         Array  intersect_shape ( Physics2DShapeQueryParameters shape, int max_results=32 )

    # godot-docs\stable\classes\class_physicsdirectspacestate.rst
         Array  cast_motion ( PhysicsShapeQueryParameters shape, Vector3 motion )
         Array  collide_shape ( PhysicsShapeQueryParameters shape, int max_results=32 )
    Dictionary  get_rest_info ( PhysicsShapeQueryParameters shape )
         Array  intersect_point ( Vector3 point, int max_results=32, Array exclude=[  ], int collision_layer=2147483647, bool collide_with_bodies=true, bool collide_with_areas=false )
    Dictionary  intersect_ray ( Vector3 from, Vector3 to, Array exclude=[  ], int collision_mask=2147483647, bool collide_with_bodies=true, bool collide_with_areas=false )
         Array  intersect_shape ( PhysicsShapeQueryParameters shape, int max_results=32 )

    # godot-docs\docs\classes\class_physicsdirectspacestate2d.rst
    PackedFloat32Array      cast_motion ( PhysicsShapeQueryParameters2D parameters )
    PackedVector2Array[]    collide_shape ( PhysicsShapeQueryParameters2D parameters, int max_results=32 )
            Dictionary      get_rest_info ( PhysicsShapeQueryParameters2D parameters )
            Dictionary[]    intersect_point ( PhysicsPointQueryParameters2D parameters, int max_results=32 )
            Dictionary      intersect_ray ( PhysicsRayQueryParameters2D parameters )
            Dictionary[]    intersect_shape ( PhysicsShapeQueryParameters2D parameters, int max_results=32 )

    # godot-docs\docs\classes\class_physicsdirectspacestate3d.rst
    PackedFloat32Array      cast_motion ( PhysicsShapeQueryParameters3D parameters )
    PackedVector2Array[]    collide_shape ( PhysicsShapeQueryParameters3Dint max_results=32 )
            Dictionary      get_rest_info ( PhysicsShapeQueryParameters3 parameters )
            Dictionary[]    intersect_point ( PhysicsPointQueryParameters3D parameters, int max_results=32 )
            Dictionary      intersect_ray ( PhysicsRayQueryParameters3D parameters )
            Dictionary[]    intersect_shape ( PhysicsShapeQueryParameters3D parameters, int max_results=32 )
```




## ğŸŸ¡ Godot AI æœ‰æ€æƒ³çš„ç²¾çµ
- [17.æ¸¸æˆå¼•æ“Gameplayç©æ³•ç³»ç»Ÿï¼šé«˜çº§AI | GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ](https://www.bilibili.com/video/BV1iG4y1i78Q/)
- [Godot Recipes 3.x AI/Behavior](https://kidscancode.org/godot_recipes/3.x/ai/)

![Steering behavior](https://kidscancode.org/godot_recipes/3.x/img/ai_context_10.gif)


### ğŸŸ ğŸ”µ GridMap ç½‘æ ¼å…³å¡åœ°å›¾
- [Using GridMaps](https://docs.godotengine.org/en/latest/tutorials/3d/using_gridmaps.html)
- [3D Platformer Demo](https://godotengine.org/asset-library/asset/125)
- [3D Kinematic Character Demo](https://godotengine.org/asset-library/asset/126)
- https://docs.godotengine.org/en/latest/classes/class_gridmap.html
- https://docs.godotengine.org/en/latest/tutorials/physics/collision_shapes_3d.html
- https://docs.godotengine.org/en/latest/tutorials/navigation/navigation_using_navigationmeshes.html

Gridmaps æ˜¯ç”¨äºåˆ›å»º 3D å…³å¡çš„èŠ‚ç‚¹ï¼Œç›¸å½“äº 2D å…³å¡ä¸­ä½¿ç”¨ TileMapï¼Œå…ˆç”¨å®šä¹‰å¥½ä¸€ç»„ 3D ç½‘æ ¼ï¼Œç”¨äº
ç”Ÿæˆ MeshLibraryï¼Œåç»­ç”¨äºå…³å¡åœ°å›¾çš„ç»˜åˆ¶ã€‚

æ‰§è¡Œèœå• Scene - Convert To - MeshLibrary... å°†å½“å‰åœºæ™¯è½¬æ¢ä¸º MeshLibrary èµ„æºã€‚

ç”¨äºç”Ÿæˆ MeshLibrary çš„åœºæ™¯å¯ä»¥æŒ‰è¿™æ ·çš„èŠ‚ç‚¹ç»“æ„ç»„ç»‡ï¼š

- é¡¶ç‚¹ä½¿ç”¨ä¸€ä¸ª Node3D èŠ‚ç‚¹ï¼›
- å­èŠ‚ç‚¹å¯ä»¥æ·»åŠ å¤šä¸ª MeshInstance3D ä½œä¸ºæ¨¡å‹ç½‘æ ¼ï¼Œè¿™äº›å­èŠ‚ç‚¹ç›¸å½“äº 3D åœ°å›¾çš„ç“¦ç‰‡ï¼›

å¦‚æœéœ€è¦ä½¿ç”¨ç‰©ç†ç³»ç»Ÿï¼Œè¿˜å¯ä»¥æ·»åŠ ç¢°æ’ä½“ï¼Œæ‰‹åŠ¨ç»™é£æ ¼æ·»åŠ  `StaticBody3D` å’Œ `CollisionShape3D`ã€‚
å¯ä»¥é€šè¿‡ç½‘æ ¼ç”Ÿæˆç¢°æ’ä½“ï¼Œä½¿ç”¨èœå• Mesh ç”Ÿæˆå•ä¸ª "Convex" å‡¸å£³åŒ…å›´éœ€è¦ç¢°æ’æ£€æµ‹ç‰©ä½“å³å¯ã€‚åº”ä»˜å¤æ‚å½¢çŠ¶
çš„ç¢°æ’å¯ä»¥ä½¿ç”¨ "Trimesh Static Body"ï¼Œå®ƒä¼šç”Ÿæˆç´§è´´æ¨¡å‹å„ä¸ªéƒ¨åˆ†çš„ç¢°æ’ä½“ã€‚

ç”Ÿæˆ MeshLibrary åï¼Œå°±å¯ä»¥åœ¨åœºæ™¯ä¸­é€šè¿‡ GridMap ä½¿ç”¨å®ƒæ¥ç»˜åˆ¶ 3D å…³å¡åœ°å›¾ã€‚ä½¿ç”¨ä¸»è§†å›¾ä¸­ GridMap
èœå•ï¼Œè¿˜å¯ä»¥æ—‹è½¬ç“¦ç‰‡çš„æ¨¡å‹ï¼Œæˆ–è€…ç»˜åˆ¶å¹³é¢æ‰€åœ¨çš„è½´å‘æˆ–æ¥¼å±‚ã€‚æŒ‰ä¸‹ `Shift` æ‹–åŠ¨é€‰åŒºï¼Œä½¿ç”¨èœå•è¿›è¡ŒåŒºåŸŸ
æ“ä½œï¼Œå¤åˆ¶ã€æ¸…é™¤ç­‰ç­‰ã€‚



### ğŸŸ ğŸ”µ Navigation å¤šè¾¹å½¢å¯¼èˆªå¯»è·¯ç®—æ³•
- https://docs.godotengine.org/en/latest/tutorials/navigation/navigation_introduction_2d.html
- https://docs.godotengine.org/en/latest/tutorials/navigation/navigation_using_navigationservers.html
- https://docs.godotengine.org/en/latest/tutorials/navigation/navigation_using_navigationagents.htm
- https://docs.godotengine.org/en/latest/tutorials/navigation/navigation_using_agent_avoidance.html
- https://docs.godotengine.org/en/stable/tutorials/physics/ray-casting.html
- [Real Time Navigation (3D)](https://docs.godotengine.org/en/3.6/tutorials/navigation/real_time_navigation_3d.html)
- [Navigation Polygon 2D](https://github.com/godotengine/godot-demo-projects/tree/master/2d/navigation)
- [3D Navigation Mesh](https://github.com/godotengine/godot-demo-projects/tree/master/3d/navmesh/)
- [Real Time Navigation (3D)](https://docs.godotengine.org/en/3.6/tutorials/navigation/real_time_navigation_3d.html)
- [Godotå¯¼èˆªç³»ç»Ÿè¯¦è§£:å¯¼èˆªåŸºç¡€](https://www.bilibili.com/video/BV1CG411g7P9/)

Godot ä¸­çš„ AI å¯»è·¯æ–¹æ¡ˆå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š

- AStar å¯»è·¯ç®—æ³•ï¼Œå¯¹äºè‡ªåŠ¨ç”Ÿæˆçš„ç½‘æ ¼åœ°å›¾éå¸¸æœ‰ç”¨ï¼Œç»“åˆå¤šçº¿ç¨‹æ•ˆç‡ä¹Ÿé«˜ï¼›
- Navigation2D å¯¼èˆªç±»ï¼ŒåŸºäºå¤šè¾¹å½¢ï¼Œæ¯”è¾ƒæ–¹ä¾¿ä¸”å®ç”¨ï¼Œä½†æ˜¯æœ‰è¾ƒå¤§çš„å±€é™ï¼›
- RayCast2D å°„çº¿æ£€æµ‹ï¼Œå¯¹è·¯å¾„è¿›è¡Œåˆ¤æ–­ï¼Œæœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯ç®—æ³•å¤æ‚ï¼›
- ä½¿ç”¨å¤§é‡çš„ Area2D å¯¹åœ°å›¾å¯è¡Œè·¯å¾„è¿›è¡Œåˆ¤æ–­ï¼›

|           2D           |           3D           |   Type   |
|------------------------|------------------------|----------|
| Astar2D                | Astar3D                | Object   |
| NavigationServer2D     | NavigationServer3D     | Node     |
| NavigationRegion2D     | NavigationRegion3D     | Node     |
| - NavigationAgent2D    | - NavigationAgent3D    | Node     |
| - NavigationObstacle2D | - NavigationObstacle3D | Node     |
| NavigationPolygon      | NavigationMesh         | Resource |

Godot 4.x ç‰ˆæœ¬åèŠ‚ç‚¹åŠå¯¹è±¡åç§°çš„ç‰ˆæœ¬å˜åŒ–ï¼š

+------------------------------+-----------------------------+
| Old name (Godot 3.x)         | New name (Godot 4)          |
+==============================+=============================+
| NavigationMeshInstance       | NavigationRegion3D          |
| NavigationPolygonInstance    | NavigationRegion2D          |
| Navigation2DServer           | NavigationServer2D          |
| Navigation2D                 | Node2D                      |
| Navigation3D                 | Node3D                      |

æ–°ç‰ˆæœ¬ä¸‹çš„å„ç§å¯¼èˆªç›¸å…³å¯¹è±¡ç”¨é€”ä»‹ç»ï¼š

- NavigationServer å¯¼èˆªæœåŠ¡å®ç°å¯»è·¯ç®—æ³•ï¼Œç”¨äºè®¡ç®—å¯¼èˆªè·¯å¾„ï¼›
- NavigationMap ä¸ºå¯¼èˆªæœåŠ¡æä¾›æ•°æ®ï¼Œå°†å¯¼èˆªç½‘æ ¼ä¿¡æ¯è½¬æ¢ä¸ºç”¨äºè·¯å¾„æŸ¥æ‰¾çš„ç»„åˆå¯¼èˆªåœ°å›¾ï¼›
- NavigationRegion2D äºŒç»´å¯¼èˆªç½‘æ ¼ï¼Œé€šè¿‡ NavigationPolygon ç»˜åˆ¶å¤šè¾¹å½¢ä¸ºåœ°å›¾æä¾› 2D å¯é€šè¡ŒåŒºåŸŸå®šä¹‰ï¼›
- NavigationRegion3D ä¸‰ç»´å¯¼èˆªç½‘æ ¼ï¼Œé€šè¿‡ NavigationMesh ä¸º 3D å¯¼èˆªä¸­ä½¿ç”¨çš„å¤šè¾¹å½¢åŒºåŸŸå®šä¹‰ï¼›
- NavigationPathQueryObject å¯¼èˆªè·¯å¾„æŸ¥è¯¢å¯¹è±¡å¯ä»¥é…åˆ NavigationPathQueryParameters æ¥å®šåˆ¶å¯¼èˆªï¼›  
- NavigationAgent å¯¼èˆªä»£ç†ä½¿ç”¨å¯¼èˆªæœåŠ¡è®¡ç®—å‡ºæ¥çš„è·¯å¾„ï¼Œä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œä¾‹å¦‚æŒ‰å¯¼èˆªè·¯å¾„ç§»åŠ¨ã€é¿éšœï¼›
- NavigationObstacle ç”±äºéšœç¢ç‰©ä¸æ–­ç§»åŠ¨è€Œæ— æ³•æœ‰æ•ˆçƒ˜ç„™åˆ°å¯¼èˆªç½‘æ ¼ï¼Œæ­¤èŠ‚ç‚¹ç”¨äºç»™è¿åŠ¨éšœç¢ç‰©è®¾ç½®å›é¿åŠå¾„ã€‚
- NavigationLink ç”¨äºåœ¨å¯¼èˆªä¸è¿é€šçš„ä¸¤ç‚¹ä¹‹é—´åˆ›å»ºè·¯å¾„é“¾æ¥ï¼Œè€Œä¸ä»…ä»…æ˜¯æ²¿ç€å¯¼èˆªç½‘æ ¼çš„è¡¨é¢è¡Œè¿›ï¼Œæ¯”å¦‚è·¨è¶Šé—´éš™ï¼Œzip-lines, teleportersã€‚


åœ¨ Godot 3.x ä¸­ï¼ŒNavigation2D èŠ‚ç‚¹ä¸‹éœ€è¦è®¾ç½®ä¸€ä¸ª NavigationPolygonInstance èŠ‚ç‚¹ä½œä¸ºå¯¼èˆª
ç½‘æ ¼çš„æ•°æ®æ¥æºï¼Œå…¶å±æ€§ navpoly ä¿å­˜çš„æ˜¯ **NavigationPolygon** èµ„æºï¼Œå³å¯¼èˆªç”¨çš„ç½‘æ ¼æ•°æ®ï¼Œè¿™äº›æ•°æ®
ä¼šè¢«å¯¼èˆªèŠ‚ç‚¹è¯»å–ã€‚æ–°ç‰ˆæœ¬ç›´æ¥ä½¿ç”¨ map_get_path() å³å¯ä»¥è®¡ç®—å‡ºç½‘æ ¼ä¸¤ç‚¹ä¹‹é—´çš„è·¯å¾„ï¼Œè¿”å›çš„æ˜¯åæ ‡æ•°é‡ç”±è·¯å¾„
çš„æ›²æŠ˜åº¦å†³å®šã€‚ä¸¤ç‚¹ä¹‹é—´æ²¡æœ‰éšœç¢ç‰©ï¼Œå°±åªæœ‰ä¸€ä¸ªç‚¹åæ ‡ã€‚

Navigation2D èŠ‚ç‚¹çš„ get_simple_path() æ–¹æ³•æ›¿ä»£ä¸º Navigation2DServer.map_get_path()ã€‚

```py
# Navigation2D node
PoolVector2Array get_simple_path(start: Vector2, end: Vector2, optimize: bool = true) const
# Navigation2DServer.map_get_path()
PoolVector2Array map_get_path(map: RID, origin: Vector2, destination: Vector2, optimize: bool, navigation_layers: int = 1) const

# NavigationServer2D.map_get_path()
PackedVector2Array map_get_path(map: RID, origin: Vector2, destination: Vector2, optimize: bool, navigation_layers: int = 1) const
```

åœ¨ 3D ç¯å¢ƒä¸‹ä¹Ÿç±»ä¼¼ï¼ŒNavigation3D èŠ‚ç‚¹ä¸‹éœ€è¦è®¾ç½®ä¸€ä¸ª NavigationMeshInstance èŠ‚ç‚¹ä½œä¸ºå¯¼èˆª
ç½‘æ ¼çš„æ•°æ®æ¥æºï¼Œä¿å­˜åœ¨ navmesh å±æ€§ä¸­çš„ **NavigationMesh** èµ„æºä¸­ã€‚å¯¼èˆªç½‘æ ¼èŠ‚ç‚¹ä¸‹å¯ä»¥è®¾ç½®
MeshInstance ä½œä¸ºé“è·¯æ¨¡å‹çš„ç½‘æ ¼ï¼Œè¿™ä¸å¯¼èˆªæ— å…³ï¼Œä½†å¯ä»¥ç”¨å®ƒæ¥çƒ˜ç„™å‡ºå¯¼èˆªç½‘æ ¼æ•°æ®ã€‚


2D å¤šè¾¹å¯¼èˆªç½‘æ ¼ä¸åƒ NavigationMesh å¯ä»¥çƒ˜ç„™ç”Ÿæˆï¼Œéœ€è¦æ‰‹åŠ¨ç»˜åˆ¶å¤šè¾¹å½¢å°†é€šé“åŒ…å«åœ¨å¤šè¾¹å½¢å†…éƒ¨ã€‚å…ˆç»˜åˆ¶
æœ€å¤–éƒ¨çš„å¤šè¾¹å½¢ä»¥åŒ…å«æ‰€æœ‰è·¯å¾„åŒºåŸŸï¼Œç„¶åå†ç»˜åˆ¶å†…éƒ¨çš„å¤šè¾¹å½¢ï¼Œå°†éšœç¢åŒºåŸŸåŒ…è£¹èµ·æ¥ã€‚å¹¶ä¸”ç›®å‰ Godot 4 Beta
ç‰ˆæœ¬ä¸­å›¾å½¢æ“ä½œç•Œé¢è¿˜æœ‰ä¸å°‘é—®é¢˜ï¼š

- NavigationRegion2D èŠ‚ç‚¹ç»˜åˆ¶å¤šè¾¹å½¢æ“ä½œå‘½ä»¤ä¸èƒ½å®Œå…¨æ­£ç¡®æ‰§è¡Œã€‚
- ç»˜åˆ¶å¥½å¤šè¾¹å½¢åï¼Œå¯¼èˆªç½‘æ ¼åœ°å›¾æ•°æ®æ²¡æœ‰ç›¸åº”æ›´æ–°ï¼Œå¹¶ä¸”å¯èƒ½åœ¨åŒä¸€ç‚¹ä½ç½®ç»˜åˆ¶é‡å çš„å¤šä¸ªé¡¶ç‚¹ã€‚
- ç‚¹å‡»å¯¼èˆªç½‘æ ¼èŠ‚ç‚¹æ—¶ï¼Œå±æ€§é¢æ¿å¯èƒ½ä¼šéšè—ä¸æ˜¾ç¤ºï¼Œéœ€è¦å°†çˆ¶èŠ‚ç‚¹éšè—åæ‰èƒ½æ˜¾ç¤ºå±æ€§é¢æ¿ã€‚
- ç›®å‰è¿˜ä¸èƒ½å¯¹å¤šè¾¹å½¢è¿›è¡Œæ›´ä¸°å¯Œçš„æ“ä½œï¼Œä¾‹å¦‚å¤šä¸ªåŸºç‚¹çš„é€‰æ‹©ã€å¤åˆ¶ã€ç²˜è´´ç­‰ã€‚

ä¸ºäº†åˆ©ç”¨å¤šè¾¹å½¢æ•°æ®ï¼Œå¯ä»¥å°†å¤šè¾¹å½¢é¡¶ç‚¹æ•°æ®ä¿å­˜åˆ°ç‹¬ç«‹çš„ NavigationPolygon èµ„æºæ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯æ–‡æœ¬
æ ¼å¼ï¼Œæ‰€æœ‰é¡¶ç‚¹åæ ‡ä¼šæ— åºåœ°è®°å½•åˆ° vertices = PackedVector2Array() åˆ—è¡¨ä¸­ã€‚å®šä¹‰åœ¨ polygons å±æ€§
ä¸­çš„å¤šè¾¹å½¢ç”±è¿™äº›åæ ‡åºå·è¡¨ç¤ºï¼Œä½†è¿™éƒ¨åˆ†çš„å¤šè¾¹å½¢æ˜¯è®¡ç®—å‡ºæ¥çš„ï¼Œå¹¶ä¸æ˜¯ç»˜åˆ¶çš„å¤šè¾¹å½¢ã€‚

ç”¨æˆ·ç»˜åˆ¶çš„æœ€å¤–å±‚çš„å¤šè¾¹å½¢åˆ™ä¿å­˜åœ¨ outlines å±æ€§ä¸­ç¬¬ä¸€ä¸ª PackedVector2Arrayï¼Œå®ƒåŒ…å«å¤–å±‚å¤šè¾¹å½¢çš„
é¡¶ç‚¹åæ ‡ï¼Œæ•°æ®å¯èƒ½å­˜åœ¨é‡å¤ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰å¼•ç”¨ vertices å®šä¹‰çš„åæ ‡åºå·ã€‚åç»­çš„ PackedVector2Array é¡¶ç‚¹
è¡¨ç¤ºå…¶å®ƒå†…éƒ¨çš„å¤šè¾¹å½¢ã€‚

ç”¨æˆ·ç»˜åˆ¶çš„å¤šè¾¹å½¢è½®å»“åç»­ä¼šè½¬æ¢æˆ NavigationMesh èµ„æºï¼Œå³å’Œ 3D å¯¼èˆªç½‘æ ¼ä¸€æ ·çš„å¤„ç†æµç¨‹ï¼Œä½œä¸ºå®šä¹‰
NavigationServer åœ°å›¾çš„åŒºåŸŸä½¿ç”¨ã€‚ç»˜åˆ¶è½®å»“å¤šè¾¹å½¢ä¸èƒ½æœ‰äº¤å ï¼Œå¦åˆ™ä¸èƒ½æ­£ç¡®è®¡ç®—å‡ºå¯¼èˆªç½‘æ ¼ã€‚æ¨èä½¿ç”¨
3D å¯¼èˆªç½‘æ ¼ï¼ŒGodot æä¾›äº† NavigationMeshGenerator å¯ä»¥ç›´æ¥å°†æ¨¡å‹ç½‘æ ¼çƒ˜ç„™å¾—åˆ°å¯¼èˆªç½‘æ ¼ã€‚

åœ¨ç»˜åˆ¶å¤šè¾¹å½¢æ—¶ï¼Œé¡¶ç‚¹ä¼šæ˜¾ç¤ºç›¸åº”çš„åºå·ï¼Œå¦‚æœåºå·ä¸è¿ç»­åˆ™å¯èƒ½æœ‰é¡¶ç‚¹é‡åˆï¼Œåºå·ä» 0 å¼€å§‹ã€‚å¤šä¸ªé¡¶ç‚¹é‡å ï¼Œ
ç»“æœçœ‹èµ·æ¥åƒä¸€ä¸ªé¡¶ç‚¹ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯å¯¼è‡´é¡¶ç‚¹ç§»åŠ¨ç­‰ç»˜åˆ¶å‘½ä»¤ä¸æ­£å¸¸ã€åœ°å›¾æ•°æ®ä¸æ›´æ–°ã€NavigationPolygon
èµ„æºæ–‡ä»¶æ•°æ®é‡å¤çš„åŸå› ã€‚

ä¸ºäº†ææ¸…æ¥šè¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å°ºç»˜åˆ¶ä¸€ä¸ªå¤šè¾¹å½¢ï¼Œå¹¶åˆ†æä¿å­˜åˆ°èµ„æºæ–‡ä»¶ä¸­é¡¶ç‚¹æ•°æ®ã€‚åˆ¤æ–­é¡¶ç‚¹æ˜¯å¦é‡å ï¼Œ
å¯ä»¥ç›´æ¥æ£€æŸ¥ polygons ä¸­åŒä¸€ä¸ª PackedInt32Array å¼•ç”¨çš„é¡¶ç‚¹åºå·æ˜¯å¦æœ‰é‡å¤å³å¯ã€‚å¦‚æœé¡¶ç‚¹é‡å ï¼Œ
é‚£ä¹ˆåŒä¸€ä¸ªå¤šè¾¹å½¢å°±ä¼šæœ‰å¤šäººé¡¶ç‚¹å¼•ç”¨ç›¸åŒåæ ‡ã€‚


é€‰æ‹©å¯¼èˆªèŠ‚ç‚¹åï¼Œåœ¨ 3D è§†å›¾ä¸­ä¼šå‡ºç° Bake NavMesh æŒ‰é’®ï¼Œå®ƒå¯ä»¥å°†å­çº§çš„ç½‘æ ¼çƒ˜ç„™æˆå¯¼èˆªç½‘æ ¼ã€‚ä¹Ÿå¯ä»¥
è°ƒç”¨ bake_navigation_mesh æ–¹æ³•è¿›è¡ŒåŠ¨æ€çƒ˜ç„™ã€‚æ³¨æ„ï¼ŒNavigationMesh è¦è®¾ç½® Source Geometry Modeï¼š

- NaviMesh Children æ­¤æ¨¡å¼å¯ä»¥å°†å­çº§ MeshInstance ç½‘æ ¼çƒ˜ç„™æˆå¯¼èˆªç½‘æ ¼ã€‚
- Group with Children
- Group Explicit

åä¸¤ç§æ¨¡å¼é…åˆ Node - Groups é¢æ¿ä½¿ç”¨ï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹ç»„åç§°ï¼Œä¸åŒçš„æ˜¯åè€…ç›´æ¥å°†èŠ‚ç‚¹ç»„åç§°å…³è”
çš„èŠ‚ç‚¹ä½œä¸ºå‡ ä½•ç½‘æ ¼æ•°æ®æ¥æºï¼Œè€Œ Group with Children åˆ™å°†èŠ‚ç‚¹ç»„çš„å­çº§ä½œä¸ºå‡ ä½•ç½‘æ ¼æ¥æºã€‚

NavigationMesh çš„ä¸€äº›å±æ€§è¯´æ˜ï¼š

- Cell size/height è®¾ç½®å¯¼èˆªç½‘æ ¼çš„å ç”¨ç©ºé—´å¤§å°ã€åç§»é«˜åº¦ï¼›
- Agents ä»£ç†è®¾ç½®ï¼š
    - agent_height ä»£ç†å¯¹è±¡å¯ä»¥é€šè¿‡çš„çš„åœ°æ¿åˆ°å¤©èŠ±æ¿çš„é«˜åº¦ï¼Œçƒ˜ç„™æ—¶æŒ‰ cell_height å€æ•°å–å€¼ï¼›
    - agent_radius ä»£ç†ä½¿ç”¨çš„ç¢°æ’æ£€æµ‹åŠå¾„ï¼Œå€¼è¶Šå¤§å¯¼èˆªåŒºè¢«å ç”¨ç©ºé—´è¶Šå¤šï¼Œçƒ˜ç„™æ—¶æŒ‰ cell_size å€æ•°å–å€¼ï¼›
    - agent_max_climb ä»£ç†å¯¹è±¡å¯ä»¥çˆ¬çš„æœ€å¤§å°é˜¶é«˜åº¦ï¼Œçƒ˜ç„™æ—¶æŒ‰ cell_height å€æ•°å–å€¼ï¼›
    - agent_max_slope ä»£ç†å¯¹è±¡å¯ä»¥çˆ¬å¡çš„æœ€å¤§è§’åº¦ï¼Œè§’åº¦å•ä½ï¼›

NavigationAgent èŠ‚ç‚¹å¯ä»¥æ›¿ä»£å¯¼èˆªèŠ‚ç‚¹ä½¿ç”¨ï¼Œå®ƒç”¨äºå¯¼èˆªä»¥é¿å…ç¢°æ’ã€‚ç”¨äºå¯¼èˆªä»¥åˆ°è¾¾æŸä¸ªä½ç½®ï¼ŒåŒæ—¶é¿å…
é™æ€ã€åŠ¨æ€éšœç‰©ã€‚ä½¿ç”¨å¾€å¤é€Ÿåº¦éšœç¢ç‰© Reciprocal Velocity Obstacles (RVO) æ¥é¿å…åŠ¨æ€éšœç¢ç‰©ã€‚
ä»£ç†éœ€è¦å¯¼èˆªæ•°æ®æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤èŠ‚ç‚¹å°†æ³¨å†Œåˆ°é»˜è®¤çš„ä¸–ç•Œå¯¼èˆªåœ°å›¾ã€‚å¦‚æœæ­¤èŠ‚ç‚¹æ˜¯å¯¼èˆªèŠ‚ç‚¹çš„
å­èŠ‚ç‚¹ï¼Œå®ƒå°†æ³¨å†Œåˆ°å¯¼èˆªèŠ‚ç‚¹çš„å¯¼èˆªåœ°å›¾ï¼Œå¯ä»¥ä½¿ç”¨ set_navigation() è®¾ç½®å¯¼èˆªèŠ‚ç‚¹ã€‚

é€šè¿‡ get_world() æ–¹æ³•å–å¾— World2D/3D å¯¹è±¡ï¼Œå…¶ navigation_map å±æ€§å°±æ˜¯å½“å‰ä¸–ç•Œçš„é»˜è®¤å¯¼èˆªåœ°å›¾ã€‚

æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨äºé¿å…ç¢°æ’çš„æ˜‚è´µè®¡ç®—æ˜¯åœ¨çº¿ç¨‹ä¸­å®Œæˆçš„ã€‚åœ¨æ²¡æœ‰çº¿ç¨‹æ”¯æŒçš„ HTML5 å¯¼å‡ºä¸­ï¼Œå®ƒä»¬å°†åœ¨
ä¸»çº¿ç¨‹ä¸Šå®Œæˆï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

NavigationAgent èŠ‚ç‚¹çš„å±æ€§è¯´æ˜ï¼š

- path_desired_distance ç‰©ä½“åˆ°ç›®æ ‡ä½çš„è·ç¦»å°äºè¿™ä¸ªå€¼å°±è®¤ä¸ºå·²ç»åˆ°è¾¾è·¯å¾„ä¸­çš„ä½ç½®ï¼Œå¯ä»¥ç»§æ‰¿åˆ°å¯¼èˆªè·¯å¾„çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼›
- agent_height_offset ç”¨äºä¿®æ­£ NavigationMesh ä¸­ agent_height è®¾ç½®äº§ç”Ÿçš„åœ°æ¿é«˜åº¦åç§»ï¼›
- path_max_distance å…è®¸ä»£ç†ç¦»å¼€ç†æƒ³å¯¼èˆªè·¯å¾„çš„æœ€å¤§è·ç¦»ï¼Œå› ä¸ºè¦è¯•å›¾é¿å…ç¢°æ’ï¼Œè¶…è¿‡è¿™ä¸ªå€¼å°†é‡æ–°è®¡ç®—ç†æƒ³è·¯å¾„ï¼›
- target_desired_distance å¯¼èˆªåˆ°è¾¾æ­¤è·ç¦»å€¼å°±å¯ä»¥è®¤ä¸ºå·²ç»åˆ°è¾¾æœ€ç»ˆç›®æ ‡åŒºåŸŸï¼Œè€Œä¸å¿…ç²¾ç¡®åˆ°è¾¾ä½ç½®ï¼›
- navigation_layers å¯¼èˆªå±‚è®¾ç½®ï¼Œå’Œå¯¼èˆªèŠ‚ç‚¹çš„ Navigation Layers è®¾ç½®é…åˆä½¿ç”¨ï¼›

NavigationAgent æ–¹æ³•ç®€è¦è¯´æ˜ï¼š

- set_navigation_map(navigation_map: RID) æ‰‹åŠ¨æŒ‡å®šå¯¼èˆªç½‘æ ¼åœ°å›¾ï¼›
- set_velocity(velocity: Vector3) ç»™å¯¼èˆªè¿åŠ¨é¿éšœç®—æ³•ä¼ å…¥ä¸€ä¸ªé€Ÿåº¦ï¼›
- set_target_location(location: Vector3) è®¾ç½®å¯¼èˆªç›®æ ‡ä½ç½®ï¼›
- is_navigation_finished() åˆ¤æ–­å¯¼èˆªæ˜¯å¦å·²ç»åˆ°è¾¾ä½ç½®ï¼›
- get_next_location() è·å–å¯¼èˆªè·¯å¾„ä¸­çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œæ–°ç‰ˆæœ¬ä¸­ä½¿ç”¨ get_next_path_position()ï¼›

è®¾ç½®é¿éšœé€Ÿåº¦åï¼Œåœ¨å¯ç”¨é¿éšœåŠŸèƒ½åä¼šç›¸åº”äº§ç”Ÿ velocity_computed(safe_velocity: Vector3) ä¿¡å·ï¼Œ
ç”±é¿éšœç®—æ³•è®¡ç®—åˆé€‚çš„è¿åŠ¨é€Ÿåº¦ï¼Œå¹¶é€šè¿‡ä¿¡å·çš„æ–¹å¼ä¼ é€’ç»™ç”¨æˆ·ã€‚


åœ¨ Godot 4.x ä¸­ï¼Œä½¿ç”¨ NavigationServer å¯¹è±¡æ¥è®¡ç®—ç½‘æ ¼è·¯å¾„ï¼Œè¿™æ˜¯æŠ½è±¡ç±»ï¼Œä¸èƒ½å®ä¾‹åŒ–ï¼Œä½¿ç”¨å…¶æä¾›
çš„é™æ€æ–¹æ³•æ¥è·å–å¯¼èˆªè·¯å¾„æ•°æ®ã€‚

2D ä¸ 3D ç½‘æ ¼å¯¼èˆªåŸç†æ˜¯ç›¸åŒçš„ï¼ŒNavigationServer2D æ˜¯ä¸€ä¸ªå‰ç«¯ï¼Œç”¨äºå¸®åŠ©å°† Vector2(xï¼Œy) è½¬æ¢
Vector3(xï¼Œ0.0ï¼Œz)ï¼Œç„¶åè¿”å› NavigationServer3D APIã€‚

```py
func _unhandled_input(event: InputEvent):
    if event is InputEventMouseButton and event.button_index == MOUSE_BUTTON_LEFT and event.pressed:
        var map := get_world_3d().navigation_map
        var from := camera.project_ray_origin(event.position)
        var to := from + camera.project_ray_normal(event.position) * 1000
        var target_point := NavigationServer3D.map_get_closest_point_to_segment(map, from, to)

        # Set the path between the robot's current location and our target.
        path = NavigationServer3D.map_get_path(map, robot.position, target_point, true)
```

å¯¼èˆªæœåŠ¡å™¨ä¸­å¯ä»¥ä½¿ç”¨å¤šä¸ªå¯¼èˆªåœ°å›¾ï¼Œé€šè¿‡ map_set_active() æ–¹æ³•æ¿€æ´»å¹¶ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªã€‚åœ°å›¾å¯¹è±¡å¯ä»¥å…³è”
å¤šä¸ªå¯¼èˆªç½‘æ ¼ NavigationRegionï¼Œå¯¼èˆªç½‘æ ¼åˆå¯ä»¥è®¾ç½®å›¾å±‚ï¼Œå›¾å±‚æ˜¯ä¸€ä¸ª 32-bit bitmaskã€‚ä¾‹å¦‚ï¼Œè®¾ç½®
ä¸ºå›¾å±‚ 1 é®ç½©å€¼å°±ä¸º 1ï¼Œè®¾ç½®ä¸ºå›¾å±‚ 4ï¼Œç¬¬å››ä¸ªæ¯”ç‰¹çš„å€¼å¯¹åº”ä¸º 8ã€‚å›¾å±‚å¯ä»¥æ¨¡æ‹Ÿä¸€æŠŠé’¥åŒ™ï¼Œæ‹¥æœ‰é’¥åŒ™çš„ç©å®¶
å¯ä»¥é€šè¿‡ä¸€æ‰‡é—¨ï¼Œåªéœ€è¦åœ¨ map_get_path æŸ¥è¯¢å¯¼èˆªè·¯å¾„æ—¶ä¼ å…¥ä¸€ä¸ªå¯ä»¥é€šè¿‡çš„ç½‘æ ¼å›¾å±‚ã€‚

æ³¨æ„ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªäº¤å çš„å¯¼èˆªç½‘æ ¼å¯èƒ½å¯¼è‡´å¯»è·¯å‡ºç°â€œç©¿é€â€éšœç¢çš„ç°è±¡ï¼Œå¹¶ä¸”å¯¼èˆªç½‘ç»œæ˜¯å¦æ˜¾ç¤ºéƒ½æœ‰æ•ˆï¼š

```py
    var map := get_world_2d().navigation_map
    var regions := NavigationServer2D.map_get_regions(map)
    var layer := NavigationServer2D.region_get_navigation_layers(regions[0])
    print("Navigation region layer: ", layer, regions)
```

æ‘„åƒæœºå¯¹è±¡æä¾›å‡ ä¸ªå…‰çº¿æŠ•å°„æ–¹æ³•ï¼ŒRay-castingï¼Œå¯ä»¥è·å–å°„çº¿æ–¹å‘ä¸Šçš„ç›®æ ‡ä½ç½®åæ ‡ï¼Œæ¸¸æˆå¼€å‘è€…å¯ä»¥ç”¨
å…‰çº¿æŠ•å°„æ¥åšç„å‡†ã€ç¡®å®šè§†çº¿ã€æµ‹é‡è·ç¦»ä¹‹ç±»çš„åŠŸèƒ½ã€‚è¿™äº›æ–¹æ³•éƒ½éœ€è¦æä¾›ä¸€ä¸ªå±å¹•åƒç´ åæ ‡ä½œä¸ºå°„çº¿çš„æŠ•å°„èµ·ç‚¹ï¼š

```py
Vector3 project_local_ray_normal(screen_point: Vector2) const
# Returns a normal vector from the screen point location directed along the camera.
# Orthogonal cameras are normalized. Perspective cameras account for perspective, 
# screen width/height, etc.
Vector3 project_position(screen_point: Vector2, z_depth: float) const
# Returns the 3D point in world space that maps to the given 2D coordinate in the 
# Viewport rectangle on a plane that is the given z_depth distance into the scene 
# away from the camera.
Vector3 project_ray_normal(screen_point: Vector2) const
# Returns a normal vector in world space, that is the result of projecting a point 
# on the Viewport rectangle by the inverse camera projection. This is useful for 
# casting rays in the form of (origin, normal) for object intersection or picking.
Vector3 project_ray_origin(screen_point: Vector2) const
# Returns a 3D position in world space, that is the result of projecting a point 
# on the Viewport rectangle by the inverse camera projection. This is useful for 
# casting rays in the form of (origin, normal) for object intersection or picking.
```

ä¾‹å¦‚ï¼Œåœ¨è¾“å…¥äº‹ä»¶ä¸­ï¼Œå°†é¼ æ ‡ç‚¹å‡»çš„äºŒç»´åæ ‡ä½ç½®æ˜ å°„ä¸ºä¸‰ç»´çš„æŠ•å°„èµ·ç‚¹ fromï¼Œç„¶åç»™å®šä¸€ä¸ªæŠ•å°„è·ç¦»ä½œä¸ºå°„çº¿
çš„æœ‰æ•ˆèŒƒå›´ï¼Œä»¥æ‘„åƒæœºæœå‘å³æ³•å‘ä¸ºæŠ•å°„æ–¹å‘ï¼Œåœ¨å°„çº¿çš„æœ‰æ•ˆèŒƒå›´ from - to ä¸¤ä¸ªåæ ‡è¿çº¿ä¹‹å†…æ£€æµ‹å¯¼èˆªåœ°å›¾ä¸­
çš„æœ€è¿‘ç‚¹ã€‚project_ray_normal è¿”å›ä¸–ç•Œç©ºé—´ä¸­çš„æ³•å‘é‡ï¼Œæ˜¯é€šè¿‡æ‘„å½±æœºåå‘æŠ•å½±åœ¨è§†å£çŸ©å½¢ä¸ŠæŠ•å½±ç‚¹çš„ç»“æœï¼Œ
è¿™å¯¹äºä»¥ï¼ˆåŸç‚¹ã€æ³•çº¿ï¼‰å½¢å¼æŠ•å°„å…‰çº¿ä»¥è¿›è¡Œå¯¹è±¡ç›¸äº¤æˆ–æ‹¾å–éå¸¸æœ‰ç”¨ã€‚äº¦å¯ç›´æ¥ä½¿ç”¨ä¸–ç•Œç©ºé—´ intersect_ray
æ–¹æ³•æ¥æ¢æµ‹ç‰©ç†åˆšä½“ç¢°æ’ç‚¹ï¼š

```py
extends Spatial

onready var camera = $"../CameraBase/Camera"
onready var navigation_agent = $NavigationAgent
onready var robot = $"../RobotBase2"

var SPEED = 10

func _physics_process(delta):
    if not navigation_agent.is_navigation_finished():
        var step_size = delta * SPEED
        var nextpoint = navigation_agent.get_next_location()
        var direction = nextpoint - robot.translation
        robot.translation += direction.normalized() * step_size

func _unhandled_input(event):
    if event is InputEventMouseButton and event.button_index == BUTTON_LEFT and event.pressed:
        var from = camera.project_ray_origin(event.position)
        var to = from + camera.project_ray_normal(event.position) * 100
        #var target_point = get_closest_point_to_segment(from, to)
        var collision = get_world().direct_space_state.intersect_ray(from, to)
        print({"from":from, "to":to, "collision":collision, "robot":robot.translation})
        if collision:
            navigation_agent.set_target_location(collision.position)
            print("next ", navigation_agent.get_nav_path(), navigation_agent.get_next_location(), collision.position)
```

å¯ä»¥ä½¿ç”¨ ImmediateGeometry èŠ‚ç‚¹å°†å¯¼èˆªè·¯å¾„ç»˜åˆ¶å‡ºæ¥ï¼ŒGodot 4.x ä½¿ç”¨ ImmediateMesh æ›¿ä»£ï¼Œ
PRIMITIVE_LINE_STRIP ç»˜å›¾æ–¹å¼è¡¨ç¤ºç‚¹ä¸ç‚¹ä¹‹é—´è¿›è¡Œè¿çº¿ï¼Œå’Œ OpenGL çš„å›¾å…ƒå®šä¹‰ä¸€è‡´ï¼š

```py
func draw_path(path_array):
    var im = get_node("ImmediateGeometry")
    # im.set_material_override(spatialmaterial)
    im.clear()

    im.begin(Mesh.PRIMITIVE_POINTS, null)
    im.add_vertex(path_array[0])
    im.add_vertex(path_array[path_array.size() - 1])
    im.end()
    
    im.begin(Mesh.PRIMITIVE_LINE_STRIP, null)
    for x in path:
        im.add_vertex(x)
    im.end()
```

### ğŸŸ ğŸ”µ Astart å¯¼èˆªå¯»è·¯ç®—æ³•
- https://docs.godotengine.org/en/latest/classes/class_astar3d.html
- [Grid-based Navigation with Astar](https://github.com/godotengine/godot-demo-projects/tree/master/2d/navigation_astar)
- [Amit è®² A* å¯»è·¯ç®—æ³•](https://blog.csdn.net/denghecsdn/article/details/78778769)
- [Amitâ€™s A* Pages](http://theory.stanford.edu/~amitp/GameProgramming/)
- godot-docs\tutorials\navigation\navigation_introduction_2d.rst
- godot-docs\tutorials\navigation\navigation_introduction_3d.rst

å¯»è·¯æ˜¯åŸºç¡€çš„æ¸¸æˆç®—æ³•ï¼Œæ˜¯ AI æ¨¡æ‹Ÿäººç±»å¯¼èˆªæ¢ç´¢èƒ½åŠ›çš„æ–¹å¼ã€‚

æåˆ°æ¸¸æˆ AI å°±ä¸å¾—ä¸è¯´ Pacman ç»å…¸åƒè±†äººæ¸¸æˆï¼Œä½œä¸ºç»å…¸æ¸¸æˆï¼Œå…¶æœ€æœ‰ç‰¹è‰²çš„éƒ¨åˆ†å°±æ˜¯å¸¦æœ‰ AI åŸå‹çš„å››ä¸ªå¹½çµå¯¹æ‰‹ï¼š

- çº¢è‰²çš„å¹½çµ Blinky ä»£è¡¨æ‰§ç€ï¼Œå®ƒä¼šä¸€ç›´è·Ÿç€ç©å®¶èµ°ï¼Œå¹¶ä¸”éšç€ç©å®¶åƒçš„è±†è¶Šå¤šç§»åŠ¨é€Ÿåº¦ä¼šå˜çš„è¶Šå¿«ã€‚
- ç²‰è‰²çš„å¹½çµ Clyde ä»£è¡¨é¢„çŸ¥ï¼Œå®ƒä¼šä»¥ç©å®¶è·¯å¾„çš„å‰æ–¹ä¸ºç›®çš„åœ°ï¼Œç»å¸¸ä¼šå›´å µç©å®¶ï¼Œå®˜æ–¹çš„åç§°å«åšâ€œåŸ‹ä¼è€…â€ã€‚
- é’è‰²çš„å¹½çµ Linky ä»£è¡¨å˜åŒ–ï¼Œå®ƒæœ‰æ—¶å€™ä¼šè¿½ç€ç©å®¶èµ°ï¼Œæœ‰æ—¶å€™åˆä¼šæå‰å µåœ¨ç©å®¶å¿…ç»çš„è·¯ä¸Šï¼Œå–„äºå˜åŒ–ã€‚
- é»„è‰²çš„å¹½çµ Pinky ä»£è¡¨éšæ„ï¼Œå®ƒçš„è¡ŒåŠ¨è·¯çº¿å®Œå…¨éšæœºï¼Œç”šè‡³å¤§å¤šæ•°æ—¶é—´å®ƒä¼šå®Œå…¨ä¸ç†ä¼šç©å®¶ï¼Œä¸€ä¸ªäººè‡ªå·±åœ¨åœ°å›¾ä¸Šæ¼«æ¸¸ã€‚

- [Play Pacman Online](https://jimboyeah.github.io/pacman/)

ç»å…¸å¯»è·¯ç®—æ³•æ˜¯ `Dijkstra` ç®—æ³•ï¼Œæ˜¯ç®—æ³•åç§°ä¹Ÿæ˜¯ä½œè€…åç§°ã€‚ç®—æ³•åŸºäºæ ¼å­ Gridï¼Œæ ¼å­æœ‰å…«ä¸ªç§»åŠ¨æ–¹å‘ï¼Œ
ä½†æ˜¯æ•ˆç‡ä½ä¸‹ï¼ŒçœŸæ­£åœ¨é¡¹ç›®ä¸­å®ç”¨çš„æ˜¯ç»è¿‡ä¼˜åŒ–çš„ `A*` å¯»è·¯ç®—æ³•ã€‚ç›¸å¯¹äºè¿ªæ°æ–¯ç‰¹æ‹‰çš„ç®—æ³•ï¼Œä¸åŒç‚¹åœ¨äºï¼Œ
åŠ äº†ä¸€ä¸ªå¯å‘ç³»æ•°ï¼Œæå¤§é™ä½äº†æœç´¢ç©ºé—´ï¼Œæé«˜ç®—æ³•æ•ˆç‡ï¼Œæ²¡æœ‰è¿™ä¸ªç®—æ³•ä¼°è®¡å¾ˆå¤šæ¸¸æˆçš„ NPC å¯»è·¯éƒ½è·‘ä¸åŠ¨ã€‚

æˆ´å…‹æ–¯ç‰¹æ‹‰ç®—æ³• Dijkstraâ€™s algorithm æ˜¯ç”±è·å…°è®¡ç®—æœºç§‘å­¦å®¶è‰¾å…¹èµ«å°”Â·æˆ´å…‹æ–¯ç‰¹æ‹‰æå‡ºçš„æœ€çŸ­å¯»è·¯ç®—æ³•ï¼Œ
ä½¿ç”¨äº†å¹¿åº¦ä¼˜å…ˆæœç´¢è§£å†³éè´Ÿæƒæœ‰å‘å›¾çš„å•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œç®—æ³•æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæœ€çŸ­è·¯å¾„æ ‘ã€‚

åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œå¦‚æœå¯ä»¥é¢„å…ˆè®¡ç®—å‡ºæ¯ä¸ªèŠ‚ç‚¹åˆ°ç»ˆç‚¹çš„ç›´çº¿è·ç¦»ï¼Œåˆ™å¯ä»¥åˆ©ç”¨è¿™ä¸ªä¿¡æ¯æ›´å¿«çš„åˆ°è¾¾ç»ˆç‚¹ã€‚è™½ç„¶ï¼Œ
ç»™å®šä¸€å¼ å¸¦æœ‰é˜»ç¢ç‰©çš„æ ¼å­åœ°å›¾ï¼Œäººè„‘å¯ä»¥ç¬é—´å°±é€šè¿‡çœ¼ç›è§‚å¯Ÿåˆ°çš„å›¾åƒå¾—åˆ°èµ·ç‚¹åˆ°ç›®æ ‡ç‚¹çš„æœ€ä½³è·¯å¾„ã€‚ä½†æ˜¯
ç¨‹åºéœ€è¦æ•°æ®ï¼Œè¦å¾—åˆ°è¿™ä¸ªæœ€ä½³æ•°æ®ï¼Œå°±éœ€è¦å¯¹å…¨éƒ¨è¾“å…¥çš„æ ¼å­è¿›è¡Œå¤„ç†ï¼Œä¼˜åŒ–ç®—æ³•æ¥æé«˜å·¥ä½œæ•ˆç‡ã€‚

ä¸ Dijkstra ç®—æ³•ç±»ä¼¼ï¼Œä¹Ÿä½¿ç”¨ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼Œä½†æ­¤æ—¶ä»¥æ¯ä¸ªèŠ‚ç‚¹åˆ°è¾¾ç»ˆç‚¹çš„è·ç¦»ä½œä¸ºä¼˜å…ˆçº§ï¼Œæ¯æ¬¡å§‹ç»ˆé€‰å–
åˆ°ç»ˆç‚¹ç§»åŠ¨ä»£ä»·æœ€å°ï¼ˆç¦»ç»ˆç‚¹æœ€è¿‘ï¼‰çš„èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªéå†çš„èŠ‚ç‚¹ï¼Œè¿™ç§ç®—æ³•ç§°ä¹‹ä¸º `Best First` BFS 
æœ€ä½³ä¼˜å…ˆç®—æ³•ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆæˆ–è´ªå¿ƒç­–ç•¥çš„å¯»è·¯ç®—æ³•ã€‚

Dijkstra ç®—æ³•æ˜¯ä¸€ç§å¹¿åº¦ä¼˜å…ˆéå†çš„ç®—æ³•ï¼Œåœ¨æ²¡æœ‰éšœç¢çš„æƒ…å†µä¸‹å°±åƒæ³¢æµªæ‰©æ•£ä¸€æ ·å»æœç´¢ç›®æ ‡ã€‚è€Œæ”¹è‰¯çš„ 
Best First çš„é€Ÿåº¦å¾ˆå¿«ï¼Œä»¥æœ€é è¿‘ç›®æ ‡ç‚¹çš„ä¼˜å…ˆå»æ‰¾åˆ°è¾¾ç›®æ ‡ç‚¹çš„è·¯å¾„ã€‚

ä½†æ˜¯ï¼Œå½“é‡åˆ°éšœç¢æ—¶ï¼Œæœ€ä½³ä¼˜å…ˆç®—æ³•ä¸ä¸€å®šå¯ä»¥è·å–æœ€ä½³ç»“æœï¼Œå®ƒå¤§ä½“è¶‹åŠ¿ä¼šæ²¿ç€èµ·ç‚¹åˆ°ç»ˆç‚¹çš„ç›´çº¿ä¸ºå¯¹ç§°è½´ï¼Œ
å·¦å³æ¥å›å¯»ç‚¹ã€‚å°±å¦‚çŸ¥é“å‰é¢æœ‰ä¸€æ¡æ¡¥å¯ä»¥è¿‡æ²³ï¼Œç»“æœç›´åˆ°æ¡¥å¤´å‘ç°å½“...å½“...å½“...åœ¨æ–½å·¥ï¼Œå°æ¡¥ä¸ç»™è¿‡äº†ï¼Œ
æœ€åè¿˜å¾—å›åˆ°ç å¤´æ­èˆ¹è¿‡æ¸¡ã€‚

å‡è®¾ï¼Œåœ¨èµ·ç‚¹å’Œç›®æ ‡ç‚¹ä¹‹é—´æœ‰ä¸€ä¸ªå·¨å¤§çš„å‡¹å£å½¢é˜»ç¢ç‰©ï¼Œä¸”å¼€å£å‘ç€èµ·ç‚¹ï¼Œé‚£ä¹ˆä»¥ä¸Šä¸¤ç§å¯»è·¯ç®—æ³•çš„ç»“æœå¯èƒ½æ˜¯ï¼š

-  `Dijkstra` ç®—æ³•æ‘¸ç´¢äº†å¤§é¢ç§¯åŒºåŸŸï¼Œå³ç»è¿‡å¤§é‡è¿ç®—ï¼Œå¹¶æœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªé¿å¼€äº†å‡¹å£å†…éƒ¨çš„æœ€ä½³è·¯å¾„ï¼›
-  `Best First` åˆ™å¿«é€Ÿæ‰¾åˆ°ä¸€æ¡ç›´æ¥å¾€å‡¹å£å†…éƒ¨èµ°ï¼Œå¹¶ä¸”é‡åˆ°é˜»ç¢åå†æŠ˜å›çš„ä¸€æ¡æ¯”è¾ƒé•¿çš„è·¯å¾„ï¼›

æ‰€ä»¥ï¼Œè¿™é‡Œå°±æœ‰ä¸€ä¸ªç®—æ³•æ€§èƒ½å’Œè·¯å¾„æœ€ä¼˜çš„å¹³è¡¡æ€§é—®é¢˜ï¼Œæ‰¾åˆ°ä¸€ç§æ—¢æœ‰æ•ˆç‡ï¼Œåˆèƒ½æ‰¾åˆ°æ·å¾„çš„ç®—æ³•æ˜¯æœ€ä½³ç­”æ¡ˆã€‚

åœ¨ `Dijkstra` ç®—æ³•å’Œ `Best First` ç®—æ³•çš„åŸºç¡€ä¸Šï¼Œ`A*` ç®—æ³•æä¾›çš„è§£å†³æ–¹æ³•æ˜¯æ ¹æ®èµ·ç‚¹åˆ°å‚è€ƒç‚¹çš„
è·ç¦» + å‚è€ƒç‚¹åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»ä¹‹å’Œæ¥å¯»è·¯ã€‚

å¯ä»¥ç”¨ f(n)=g(n)+h(n) è¡¨è¾¾ï¼Œå…¶ä¸­ï¼š

- f(n) æ˜¯èŠ‚ç‚¹ n çš„ç»¼åˆä¼˜å…ˆçº§ã€‚é€‰æ‹©ä¸‹ä¸€ä¸ªè¦éå†çš„èŠ‚ç‚¹æ—¶ï¼Œæ€»ä¼šé€‰å–ç»¼åˆä¼˜å…ˆçº§æœ€é«˜ï¼ˆå€¼æœ€å°ï¼‰çš„èŠ‚ç‚¹ã€‚
- g(n) æ˜¯èŠ‚ç‚¹ n è·ç¦»èµ·ç‚¹çš„ä»£ä»·ã€‚
- h(n) æ˜¯èŠ‚ç‚¹ n è·ç¦»ç»ˆç‚¹çš„é¢„è®¡ä»£ä»·ï¼Œè¿™ä¹Ÿå°±æ˜¯ `A*` ç®—æ³•çš„å¯å‘å‡½æ•° Heuristic Functionã€‚

è¿™æ˜¯è¿ªæ°æ–¯ç‰¹æ‹‰ç®—æ³•å’Œæœ€ä½³ä¼˜å…ˆç®—æ³•çš„ç»“åˆä½“ï¼Œå¯ä»¥åŠ ä¸ªæƒé‡å‚æ•° K æ¥è°ƒèŠ‚è¿™ä¸¤ç§ç®—æ³•çš„å½±å“ç¨‹åº¦

    f(n)= k * g(n) + (1-k) * h(n) ï¼› k å–å€¼ ä¸º [0,1]

- å½“ k=0 æ—¶ï¼Œf(n)= h(n) ï¼Œå°±å˜æˆäº†æœ€ä½³ä¼˜å…ˆç®—æ³•ï¼›
- å½“ k=1 æ—¶ï¼Œf(n)= g(n) ï¼Œå°±å˜æˆäº†è¿ªæ°æ–¯ç‰¹æ‹‰ç®—æ³•ï¼›
- å½“ k=0.5 æ—¶ï¼Œf(n)=g(n)+h(n) ï¼Œå°±å˜æˆ `A*` ç®—æ³•ï¼›

AI ç³»ç»Ÿçš„å¼•å…¥ï¼Œå¯ä»¥è§£å†³ Steering Behaviors è¡Œä¸ºæ§åˆ¶éœ€æ±‚ï¼Œè¿™æ˜¯ä½¿ç”¨åŠ¨åŠ›å­¦çš„æ•°æ®ç»“æ„ï¼ŒåŠ é€Ÿåº¦å’Œ
è§’é€Ÿåº¦å‚æ•°ç­‰æ¨¡æ‹ŸçœŸå®æœ‰ç”Ÿå‘½çš„æ´»åŠ¨ï¼Œå¦‚ï¼š

- æ•Œäººçš„æ¸¸èµ°è¡Œä¸º wandering behaviorï¼›
- Seeking åœ°å›¾æ¢ç´¢ï¼›
- Arriving åˆ°è¾¾æŒ‡å®šç‚¹ï¼›
- Pursuit åŒ…æŠ„å¯¹æ‰‹ï¼›
- Evade è§„é¿å¯¹æ‰‹ï¼›
- Flee è·³è·‘ï¼›
- Separate åˆ†æ•£è¡Œä¸ºï¼›
- Align é˜Ÿåˆ—è¡Œä¸ºï¼› F
- Patrol å·¡é€»è¡Œä¸ºï¼Œå¯ä»¥é€‚å½“è®¾ç½®å·¡é€»ç‚¹ PatrolPointã€‚

AStar2D æˆ– AStar3D å®ç°äº† A* å¯»è·¯ï¼Œéœ€è¦ä¸ºå®ƒæ·»åŠ å…·æœ‰è¿æ¥å±æ€§çš„ç©ºé—´ç‚¹ï¼Œç®—æ³•ä¼šè®¡ç®—å‡ºä¸¤ä¸ªæŒ‡å®šç‚¹çš„
æœ€è¿‘è·¯å¾„æ‰€åŒ…å«çš„ç‚¹ï¼š

    PackedInt64Array   get_id_path(from_id: int, to_id: int)
    PackedVector2Array get_point_path(from_id: int, to_id: int)

    void add_point(id: int, position: Vector3, weight_scale: float = 1.0)
    bool are_points_connected(id: int, to_id: int, bidirectional: bool = true) 
    void connect_points(id: int, to_id: int, bidirectional: bool = true)
    bool has_point(id: int) const
    void set_point_disabled(id: int, disabled: bool = true)

æ–¹æ³•ä»‹ç»ï¼š

- add_point() æ·»åŠ æ•°æ®ç‚¹ï¼Œå°†ä¸€ä¸ª ID ä¸åæ ‡æ•°æ®å…³è”ï¼›
- are_points_connected() æŸ¥è¯¢ä¸¤ç‚¹æ˜¯å¦æœ‰é€šè·¯ï¼›
- connect_points() ä¸¤ç‚¹ä¹‹é—´æ·»åŠ è¿æ¥å±æ€§ï¼›
- has_point() åˆ¤æ–­æŒ‡å®š ID æ˜¯å¦æœ‰å¯¹åº”çš„ç‚¹ï¼›
- set_point_disabled() ç¦ç”¨æŸä¸ªç‚¹ï¼Œç›¸å½“äºè®¾ç½®ä¸€ä¸ªéšœç¢ç‚¹ï¼›

```py
    var astar = AStar2D.new()
    astar.add_point(1, Vector2(0, 0))
    astar.add_point(2, Vector2(0, 1))
    astar.add_point(3, Vector2(1, 1))
    astar.add_point(4, Vector2(2, 0))

    astar.connect_points(1, 2, true)
    astar.connect_points(1, 3, true)

    var neighbors = astar.get_point_connections(1) # Returns [2, 3]


    var astar = AStar3D.new()
    astar.add_point(1, Vector3(0, 0, 0))
    astar.add_point(2, Vector3(0, 1, 0), 1) # Default weight is 1
    astar.add_point(3, Vector3(1, 1, 0))
    astar.add_point(4, Vector3(2, 0, 0))

    astar.connect_points(1, 2, false)
    astar.connect_points(2, 3, false)
    astar.connect_points(4, 3, false)
    astar.connect_points(1, 4, false)

    var res = astar.get_id_path(1, 3) # Returns [1, 2, 3]
```

Godot ä¸­çš„ TileMap èŠ‚ç‚¹å¯ä»¥ä¸º AStart æä¾›ç½‘æ ¼æ•°æ®ï¼Œæ³¨æ„ TileMap API è·å–çš„ç½‘æ ¼åæ ‡æ•°æ®ç±»å‹
æœ‰å˜åŒ–ï¼Œåœ¨åšåˆ¤æ–­æ—¶å¯èƒ½ä¼šè¯¯ç”¨å¯¼è‡´é€»è¾‘é—®é¢˜ï¼Œä¸èƒ½æ­£ç¡®åˆ¤æ–­éšœç¢ç‰©æ‰€åœ¨çš„ç½‘æ ¼ä½ç½®ã€‚

Godot 4.x è¿”å›çš„æ˜¯æ•´å½¢åæ ‡å€¼ï¼Œè€Œ AStart æ·»åŠ æ•°æ®ç‚¹æ—¶ä½¿ç”¨çš„æµ®ç‚¹åæ ‡å€¼ï¼š

```py
# Godot 3.x
Array[Vector2] get_used_cells() const

# Godot 4.x
Array[Vector2i] get_used_cells(layer: int) const
```

ä»¥ä¸‹æ˜¯æ ¹æ®å®˜æ–¹ 2d/navigation_astar ç¤ºèŒƒå·¥ç¨‹æ›´æ–°åˆ° Godot 4.x çš„ä»£ç ï¼š

```py
extends TileMap

const BASE_LINE_WIDTH = 3.0
const DRAW_COLOR = Color.WHITE

# The Tilemap node doesn't have clear bounds so we're defining the map's limits here.
@export var map_size: Vector2 = Vector2.ONE * 16

# The path start and end variables use setter methods.
# You can find them at the bottom of the script.
var path_start_position = Vector2():
    set = _set_path_start_position
#   set(value):
#       # TODO: Manually copy the code from this method.
#       _set_path_start_position(value)

var path_end_position = Vector2():
    set = _set_path_end_position
#   set(value):
#       # TODO: Manually copy the code from this method.
#       _set_path_end_position(value)


var _point_path = []

# You can only create an AStar3D node from code, not from the Scene tab.
@onready var astar_node = AStar3D.new()
# get_used_cells is a method from the TileMap node.
# Here the id 0 corresponds to the grey tile, the obstacles.
@onready var obstacles = get_used_cells(0)
#@onready var _half_cell_size = cell_size / 2
#@onready var _half_cell_size = Vector2(tile_set.tile_size / 2)

func _ready():
    var walkable_cells_list = astar_add_walkable_cells(obstacles)
    astar_connect_walkable_cells(walkable_cells_list)

func _draw():
    #if not _point_path:
    if _point_path.size() == 0:
        return
    var point_start = _point_path[0]
    var point_end = _point_path[len(_point_path) - 1]

    #set_cell(point_start.x, point_start.y, 1)
    #set_cell(point_end.x, point_end.y, 2)
    set_cell(0, Vector2(point_start.x, point_start.y), 1, Vector2i(0, 0))
    set_cell(0, Vector2(point_end.x, point_end.y), 2, Vector2i(0, 0))
    
    var last_point = map_to_local(Vector2(point_start.x, point_start.y)) # + _half_cell_size
    for index in range(1, len(_point_path)):
        var current_point = map_to_local(Vector2(_point_path[index].x, _point_path[index].y)) # + _half_cell_size
        draw_line(last_point,current_point,DRAW_COLOR,BASE_LINE_WIDTH)
        draw_circle(current_point, BASE_LINE_WIDTH * 2.0, DRAW_COLOR)
        last_point = current_point


# Loops through all cells within the map's bounds and
# adds all points to the astar_node, except the obstacles.
func astar_add_walkable_cells(obstacle_list = []):
    var points_array = []
    for y in range(map_size.y):
        for x in range(map_size.x):
            var point = Vector2i(x, y)
            if point in obstacle_list:
                continue

            points_array.append(point)
            # The AStar3D class references points with indices.
            # Using a function to calculate the index from a point's coordinates
            # ensures we always get the same index with the same input point.
            var point_index = calculate_point_index(point)
            # AStar3D works for both 2d and 3d, so we have to convert the point
            # coordinates from and to Vector3s.
            astar_node.add_point(point_index, Vector3(point.x, point.y, 0.0))
    return points_array


# Once you added all points to the AStar3D node, you've got to connect them.
# The points don't have to be checked a grid: you can use this class
# to create walkable graphs however you'd like.
# It's a little harder to code at first, but works for 2d, 3d,
# orthogonal grids, hex grids, tower defense games...
func astar_connect_walkable_cells(points_array):
    for point in points_array:
        var point_index = calculate_point_index(point)
        # For every cell in the map, we check the one to the top, right.
        # left and bottom of it. If it's in the map and not an obstalce.
        # We connect the current point with it.
        var points_relative = PackedVector2Array([
            point + Vector2i.RIGHT,
            point + Vector2i.LEFT,
            point + Vector2i.DOWN,
            point + Vector2i.UP,
        ])
        for point_relative in points_relative:
            var point_relative_index = calculate_point_index(point_relative)
            if is_outside_map_bounds(point_relative):
                continue
            if not astar_node.has_point(point_relative_index):
                continue
            # Note the 3rd argument. It tells the astar_node that we want the
            # connection to be bilateral: from point A to B and B to A.
            # If you set this value to false, it becomes a one-way path.
            # As we loop through all points we can set it to false.
            astar_node.connect_points(point_index, point_relative_index, false)


# This is a variation of the method above.
# It connects cells horizontally, vertically AND diagonally.
func astar_connect_walkable_cells_diagonal(points_array):
    for point in points_array:
        var point_index = calculate_point_index(point)
        for local_y in range(3):
            for local_x in range(3):
                var point_relative = Vector2(point.x + local_x - 1, point.y + local_y - 1)
                var point_relative_index = calculate_point_index(point_relative)
                if point_relative == point or is_outside_map_bounds(point_relative):
                    continue
                if not astar_node.has_point(point_relative_index):
                    continue
                astar_node.connect_points(point_index, point_relative_index, true)


func calculate_point_index(point):
    return point.x + map_size.x * point.y


func clear_previous_path_drawing():
    #if not _point_path:
    if _point_path.size() == 0:
        return
    var point_start = _point_path[0]
    var point_end = _point_path[len(_point_path) - 1]
    #set_cell(point_start.x, point_start.y, -1)
    #set_cell(point_end.x, point_end.y, -1)
    set_cell(0, Vector2(point_start.x, point_start.y), -1)
    set_cell(0, Vector2(point_end.x, point_end.y), -1)


func is_outside_map_bounds(point):
    return point.x < 0 or point.y < 0 or point.x >= map_size.x or point.y >= map_size.y


func get_astar_path(world_start, world_end):
    self.path_start_position = local_to_map(world_start)
    self.path_end_position = local_to_map(world_end)
    _recalculate_path()
    var path_world = []
    for point in _point_path:
        var point_world = map_to_local(Vector2(point.x, point.y)) # + _half_cell_size
        path_world.append(point_world)
    return path_world


func _recalculate_path():
    clear_previous_path_drawing()
    var start_point_index = calculate_point_index(path_start_position)
    var end_point_index = calculate_point_index(path_end_position)
    # This method gives us an array of points. Note you need the start and
    # end points' indices as input.
    _point_path = astar_node.get_point_path(start_point_index, end_point_index)
    # Redraw the lines and circles from the start to the end point.
    queue_redraw()  # update()


# Setters for the start and end path values.
func _set_path_start_position(value):
    if value in obstacles:
        return
    if is_outside_map_bounds(value):
        return

    #set_cell(path_start_position.x, path_start_position.y, -1)
    #set_cell(value.x, value.y, 1)
    set_cell(0, path_start_position, -1)
    set_cell(0, value, 1)
    path_start_position = value
    if path_end_position and path_end_position != path_start_position:
        _recalculate_path()


func _set_path_end_position(value):
    if value in obstacles:
        return
    if is_outside_map_bounds(value):
        return

    #set_cell(path_start_position.x, path_start_position.y, -1)
    #set_cell(value.x, value.y, 2)
    set_cell(0, path_start_position, -1)
    set_cell(0, value, 2)
    path_end_position = value
    if path_start_position != value:
        _recalculate_path()
```

### ğŸŸ ğŸ”µ Behavior Tree è¡Œä¸ºæ ‘
- [Godot State Machine](https://gdscript.com/solutions/godot-state-machine/)
- [Godot Behavior Tree](https://gdscript.com/solutions/godot-behaviour-tree/)
- [Godot Behavior Tree](https://github.com/andrew-wilkes/godot-behaviour-tree)
- https://github.com/libgdx/gdx-ai/wiki/Behavior-Trees
- https://www.behaviortree.dev/docs/Intro
- https://docs.unrealengine.com/4.26/zh-CN/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/
- [Naive Behavior Tree by Raiix](https://github.com/rayxuln/Behavior-Tree-Syntax-Compiler)
- [Naive Behavior Tree æ’ä»¶æ•™ç¨‹](https://www.bilibili.com/video/BV1gv411g7p4/)
- [Naive Behavior Tree ç¤ºèŒƒæ¡ˆä¾‹](https://github.com/rayxuln/MyDogIsACat)
- [Naive Behavior Tree åœ¨çº¿æ¼”ç¤º](http://github.raiix.com/gamelib/feed_it/)
- [Raiix State Machine](https://github.com/rayxuln/RaiixStateMachinePlugin)
- [Behavior Tree Editor](https://github.com/rayxuln/behavior_tree_plugin)
- [Behavior Tree Editor æ•™ç¨‹](https://www.bilibili.com/video/BV1KV411k7t9/)
- [GDScript progress report: Writing a new parser](https://godotengine.org/article/gdscript-progress-report-writing-new-parser/)

è¡Œä¸ºæ ‘ Behaviour Tree å¦‚å…¶åï¼Œæ˜¯ä¸€ä¸ªæ ‘çŠ¶æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§æµè¡Œçš„ AI (Artificial Intelligence)
ç¼–ç ç»„ç»‡æ–¹æ³•ï¼Œå¸¸ç”¨äºæ¸¸æˆä¸­çš„ NPC (Non Player Controlled) è§’è‰²æ‰§è¡Œä¸åŒçš„åŠ¨ä½œã€‚

è¡Œä¸ºæ ‘æ˜¯ä¸€ç§ç”¨æ¥è¡¨ç¤ºé€»è¾‘å†³ç­–çš„æ–¹æ³•ï¼Œä¸»è¦ Decision Making æ–¹æ³•æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š

- State Machine
- Behavior Trees

è¡Œä¸ºæ ‘ä¸æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼ŒFinite State Machineï¼‰ã€å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰ç­‰å¸¸è¢«å¯¹æ¯”ï¼Œç»å¤§å¤šæ•°
æƒ…å†µä¸‹ä»–ä»¬å¯ä»¥å‘æŒ¥åŒæ ·çš„ä½œç”¨ï¼Œå¹¶ä¸”å¯ä»¥ç›¸äº’è½¬æ¢ã€‚

å½“éœ€è¦åšå†³ç­–æ—¶ï¼Œå…ˆä»è¡Œä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹æ ‘å¼€å§‹æŸ¥è¯¢ï¼Œä»¥æ ‘çŠ¶æ–¹å¼å‘ä¸‹å±‚ä¼ æ’­ï¼Œç›´åˆ°å¶èŠ‚ç‚¹ï¼Œå®ƒåŒ…å«æœ€ç»ˆè¦æ‰§è¡Œæˆ–è€…
å®ç°çš„æ¸¸æˆåŠŸèƒ½ã€‚è¡Œä¸ºæ ‘çš„éå†æ“ä½œåœ¨æ¸¸æˆä¸­çš„æ¯ä¸ª tick ä¸­éƒ½ä¼šå‘ç”Ÿï¼Œæ¸¸æˆä¸­çš„æ¯ä¸€å¸§éƒ½å¯èƒ½æœ‰è¡Œä¸ºå†³ç­–ã€‚

![Behavior Trees](https://docs.unrealengine.com/4.26/Images/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreesOverview/BT_Overview_Intro.png)

å‡è®¾ï¼Œä¸ºä¸€ä¸ªè§’è‰²å®šä¹‰çš„ä¸€é¢—è¡Œä¸ºæ ‘ï¼Œå¤§ä½“ä¸Šä¸ºè¿™ä¸ªè§’è‰²è®¾è®¡äº†ä¸‰å¥—è¡Œä¸ºï¼Œåˆ†åˆ«æ˜¯ï¼š

- å·¡é€»ï¼ˆPatrolï¼‰
- æ”»å‡»ï¼ˆAttackï¼‰
- é€ƒè·‘ï¼ˆRetreatï¼‰

è€Œè¿™äº›è¡Œä¸ºåˆå¯ä»¥ç»†åŒ–ï¼Œæ¯”å¦‚ç‹¼ç‹ˆåœ°è·‘ï¼Œç‹ ç‹ åœ°æ”»å‡»ï¼Œä¼˜å“‰æ¸¸å“‰åœ°å·¡é€»ï¼Œæ–°å¢åŠ çš„è¿™äº›ç»†åŒ–çš„è¡Œä¸ºåˆå¯ä»¥æŒ‚åˆ°è¡Œä¸ºæ ‘
çš„å­å±‚ï¼Œå…·ä½“èŠ‚ç‚¹æ•°æ®å¯ä»¥æ ¹æ®éœ€è¦æ¥å†³å®šã€‚å½“æ¸¸æˆä¸­éœ€è¦å†³ç­–å½“å‰è¿™ä¸ªè§’è‰²è¦æ‰§è¡Œä»€ä¹ˆè¡Œä¸ºæ—¶ï¼Œå°±éœ€è¦è‡ªé¡¶å‘ä¸‹ï¼Œ
å¹¶ç»“åˆä¸€äº›æ¡ä»¶æ¥æœç´¢è¿™é¢—æ ‘ï¼Œæœ€ç»ˆåŒ¹é…åˆ°å¶èŠ‚ç‚¹ï¼Œå³ç¡®å®šä¸‹æ¥è¦æ‰§è¡Œçš„è¡Œä¸ºï¼Œå¹¶ä¸”æ‰§è¡Œå®ƒï¼Œè¿™å°±æ˜¯è¡Œä¸ºæ ‘çš„åŸºæœ¬åŸç†ã€‚
å¶èŠ‚ç‚¹ä¸Šä¸€èˆ¬åŒ…å«è¡Œä¸ºï¼Œç§°ä¹‹ä¸ºè¡Œä¸ºèŠ‚ç‚¹ï¼ˆAction Nodeï¼‰ï¼Œå…¶ä½™èŠ‚ç‚¹ä¸€èˆ¬ç§°ä¹‹ä¸ºæ§åˆ¶èŠ‚ç‚¹ï¼ˆControl Nodeï¼‰ã€‚
æ§åˆ¶èŠ‚ç‚¹å…¶å®æ˜¯è¡Œä¸ºæ ‘çš„ç²¾é«“æ‰€åœ¨ï¼Œå†³ç­–è¿‡ç¨‹å—æ§åˆ¶èŠ‚ç‚¹çº¦æŸã€‚

ç»„ç»‡èµ·è¿™äº›è¡Œä¸ºå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–¹å¼ï¼Œæœ‰äº›è¡Œä¸ºå¯ä»¥ç»„åˆï¼Œæ¯”å¦‚å‡ºæ‹³ä¸æ‰­è…°ï¼Œæœ‰äº›è¡Œä¸ºæ˜¯å•ä¸€çš„ï¼Œè¿™å°±è¦ä¸ºè¡Œä¸ºæ ‘
è®¾è®¡ä¸åŒç±»å‹çš„èŠ‚ç‚¹æ¥è¡¨è¾¾ç›¸åº”çš„è¡Œä¸ºæ€§è´¨ï¼Œå¹¶ä¸”åˆå¯ä»¥æŒ‰ä¸åŒçš„æ–¹å¼æ‰§è¡Œï¼Œè¿™å°±éœ€è¦åˆæˆèŠ‚ç‚¹ï¼ˆCompositeï¼‰
æ¥ç»„ç»‡å®ƒä»¬ï¼š

1. Sequeneceï¼šå„ç§è¡Œä¸ºä¸€ä¸ªæ¥ç€ä¸€ä¸ªè¿›è¡Œã€‚
2. Parallelï¼šå¤šä¸ªè¡Œä¸ºåŒæ—¶è¿›è¡Œã€‚
3. Selectorï¼šä»å¤šä¸ªå€™é€‰è¡Œä¸ºä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œã€‚

è¡Œä¸ºèŠ‚ç‚¹å¯èƒ½æœ‰å¤šç§è¿è¡ŒçŠ¶æ€ï¼š

- Executing è¿è¡Œä¸­ï¼šè¯¥è¡Œä¸ºè¿˜åœ¨å¤„ç†ä¸­ã€‚
- Completed å·²å®Œæˆï¼šè¯¥è¡Œä¸ºå¤„ç†å®Œæˆï¼ŒæˆåŠŸæˆ–è€…å¤±è´¥ã€‚

è¿è¡Œç»“æœå¯ä»¥åŒ…å«ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š

- Succeeded æˆåŠŸç»“æŸè¿è¡Œã€‚
- Failed è¿è¡Œå¤±è´¥ã€‚
- Aborted ç»ˆæ­¢è¿è¡Œã€‚
- In Progress æ­£åœ¨è¿è¡Œè¿›ç¨‹ä¸­ã€‚

æ ¹æ® Behavior Trees in Robotics and AI ä¸€ä¹¦æè¿°ï¼Œè¡Œä¸ºæ ‘ä¸€èˆ¬æœ‰ï¼š

- 4 ç§æ§åˆ¶èŠ‚ç‚¹ Sequence, Fallback, Parallel, Decoratorã€‚
- 2 ç§æ‰§è¡ŒèŠ‚ç‚¹ï¼ŒAction å’Œ Conditionï¼Œåªæœ‰æ‰§è¡ŒèŠ‚ç‚¹æ‰èƒ½æˆä¸ºå¶å­èŠ‚ç‚¹ã€‚

è£…é¥°èŠ‚ç‚¹åœ¨è¡Œä¸ºæ ‘ç³»ç»Ÿä¸­èµ·æ¡ä»¶è®¾ç½®ä½œç”¨ï¼Œå…¶åŠŸèƒ½ç›¸å½“äºæ¡ä»¶è¯­å¥ã€‚è®¸å¤šè¡Œä¸ºæ ‘å®ç°æ–¹æ¡ˆä¸­ï¼Œéƒ½æœ‰ Blackboard
æ¦‚å¿µï¼Œå®ƒç”¨æ¥å­˜å‚¨è¡Œä¸ºæ ‘çš„çŠ¶æ€æ•°æ®ã€‚

è¡Œä¸ºæ ‘çš„è®¾è®¡ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªåŸºç±» `BT_Node`ï¼š

- BT_Node ä½œä¸ºå…¶å®ƒå­èŠ‚ç‚¹çš„åŸºç±»ï¼Œéœ€è¦æœ‰ä¸€ä¸ªè°ƒç”¨å­èŠ‚ç‚¹ä»»åŠ¡çš„æ–¹æ³•ï¼›
- æ¯ä¸ªèŠ‚ç‚¹æœ¬èº«å®šä¹‰ä¸€ä¸ªä»»åŠ¡æ–¹æ³• Task()ï¼Œå®šä¹‰èŠ‚ç‚¹æœ¬èº«æ‰€æ‹¥æœ‰çš„è¡Œä¸ºã€åŠŸèƒ½ï¼Œç”±çˆ¶èŠ‚ç‚¹æ‰§è¡Œï¼›
- å¯ä»¥è€ƒè™‘è®¾ç½®ä¸€ä¸ª Abort() æ–¹æ³•ç”¨äºä¸»åŠ¨ç»“æŸä»»åŠ¡çš„æ‰§è¡Œï¼›

å®šä¹‰ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹ï¼Œ`BT_Control` å¹¶æ´¾ç”Ÿå„ç§å…·ä½“æ§åˆ¶èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼š

- BT_Sequenecer
- BT_Paralleler
- BT_Selector
- BT_Condition
- BT_Repeater
- BT_Randomizer
- BT_Decorator
    - BT_AlwaysFail
    - BT_AlwaysSuccess
    - BT_UntilFail
    - BT_UntilSuccess

å®šä¹‰ä¸€ä¸ªè¡Œä¸ºèŠ‚ç‚¹ï¼Œ`BT_Action` å¹¶æ´¾ç”Ÿå„ç§å…·ä½“è¡Œä¸ºèŠ‚ç‚¹ï¼Œè¿™äº›å­ç±»å‹ä½œä¸ºè¡Œä¸ºæ ‘ä¸­çš„å¶èŠ‚ç‚¹ï¼Œä¾‹å¦‚ï¼š

- BT_Wait
- BT_Jump
- BT_Run
- BT_Patrol
- BT_Retarget

è¡Œä¸ºèŠ‚ç‚¹åº”è¯¥æ ¹æ®éœ€è¦æ·»åŠ ï¼Œå¹¶é€šè¿‡æ§åˆ¶èŠ‚ç‚¹æ¥ç»„ç»‡ï¼Œæœ€ç»ˆæ„é€ æˆä¸ºä¸€ä¸ªå®Œæ•´çš„è¡Œä¸ºæ ‘ã€‚

Andrew Wilkes ä¸­æä¾›çš„è¡Œä¸ºæ ‘å®ç°ä¸­ï¼Œä½¿ç”¨ `Task` ä½œä¸ºåŸºç±»ï¼Œè¡Œä¸ºèŠ‚ç‚¹ç±»å‹å®šä¹‰ä¸º Leafã€‚å…¶è®¾è®¡æ€è·¯ï¼š

- å®šä¹‰ä¸€å¥— Final methods ä¿®æ”¹å¯¹åº”çš„æ‰§è¡ŒçŠ¶æ€ï¼Œrunning() success() fail() cancel()ï¼›
- å®šä¹‰ä¸€å¥—æŠ½è±¡æ–¹æ³•ç”¨äºä¸åŒçš„ä»»åŠ¡æ‰§è¡Œæ–¹å¼ï¼Œrun() child_running() child_success() child_fail()ï¼›
- å¦å¤–ä¸¤ä¸ªæ–¹æ³• start() reset() åˆ†åˆ«ç”¨äºé…ç½®ä»»åŠ¡èŠ‚ç‚¹å’Œå¤ä½ï¼›

å…¶ä¸­ï¼Œstart() è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯è¡Œä¸ºæ ‘èŠ‚ç‚¹çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œåç§°æœ‰ç‚¹ä¸æ°å½“ï¼Œè€Œ run() æ‰æ˜¯ä»»åŠ¡å¯åŠ¨æ–¹æ³•ã€‚
å¶å­èŠ‚ç‚¹ Leaf åªå®šä¹‰äº† run()ï¼Œé»˜è®¤éœ€è¦ç”¨æˆ·åœ¨ç»§æ‰¿å­ç±»ä¸­çš„å…·ä½“é€»è¾‘ä¸­ä¸»åŠ¨è°ƒç”¨ã€‚

Final methods æ–¹æ³•è¿˜ä¼šè°ƒç”¨æŠ½è±¡æ–¹æ³•ä¸­å’Œå­èŠ‚ç‚¹çŠ¶æ€ç›¸å…³æ–¹æ³•ï¼Œæ ¹æ®å­èŠ‚ç‚¹è¿è¡ŒçŠ¶æ€æ¥è®¾ç½®çˆ¶èŠ‚ç‚¹çš„çŠ¶æ€ã€‚
`Task` åŸºç±»ä¸­ï¼Œé™¤äº†å®šä¹‰ State æšä¸¾è¡¨ç¤ºè¿ä»»åŠ¡çš„çŠ¶æ€ï¼Œè¿˜å®šä¹‰äº†ä¸è¡Œä¸ºæ ‘ç»“æ„ç›¸å…³çš„ controlã€tree
ä¸¤ä¸ªå±æ€§ã€‚

- `control` è¡¨ç¤ºæ§åˆ¶èŠ‚ç‚¹ï¼Œé»˜è®¤åœ¨ start() æ–¹æ³•åˆå§‹ä¸ºçˆ¶èŠ‚ç‚¹ï¼Œå®ƒè°ƒç”¨å’Œå­èŠ‚ç‚¹çŠ¶æ€ç›¸å…³çš„ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•ï¼›
- `tree` è¡¨ç¤ºè¡Œä¸ºæ ‘æœ¬èº«ï¼Œæ‰€æœ‰å­èŠ‚ç‚¹éƒ½æœ‰è¡Œä¸ºæ ‘çš„ä¸€ä¸ªå¼•ç”¨ï¼Œé€šè¿‡å®ƒå¯ä»¥æšä¸¾æ‰€æœ‰å­èŠ‚ç‚¹ã€‚

ä»¥ä¸‹ä»£ç é€‚ç”¨äº Godot 3.5ï¼Œæ–°ç‰ˆæœ¬ Godot 4 ä¸­æä¾›äº† super å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸€ä¸ªç‚¹å·ï¼š

```py
extends Node

class_name Task

# States
enum {
    FRESH,
    RUNNING,
    FAILED,
    SUCCEEDED,
    CANCELLED
}

var control = null
var tree = null
# var guard = null
var status = FRESH

# Final methods
func running():
    status = RUNNING
    if control != null:
        control.child_running()

func success():
    status = SUCCEEDED
    if control != null:
        control.child_success()

func fail():
    status = FAILED
    if control != null:
        control.child_fail()

func cancel():
    if status == RUNNING:
        status = CANCELLED
        # Cancel child tasks
        for child in get_children():
            child.cancel()

# Abstract methods
func run():
    # Process the task and call running(), success(), or fail()
    pass

func child_success():
    success()

func child_fail():
    fail()

func child_running():
    running()

# Non-final non-abstact methods
func start():
    status = FRESH
    for child in get_children():
        child.control = self
        child.tree = self.tree
        child.start()

func reset():
    cancel()
    status = FRESH
```

AlwaysFail è£…é¥°å™¨èŠ‚ç‚¹ï¼šå®ƒæ€»æ˜¯è¿”å› FAILED çŠ¶æ€ï¼Œæ‰€ä»¥ä¸ç”¨ç®¡ child_success() child_fail()ï¼š

```py
extends Task

class_name AlwaysFail

func run():
  if get_child_count() > 0:
    get_child(0).run()
  fail()

# Ignore child success
func child_success():
  pass

# Ignore child failure
func child_fail():
  pass
```


ä»¥å¹¶è¡Œæ§åˆ¶èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå¹¶è¡Œä»»åŠ¡é¢å¤–è®¾ç½®äº†ä¸€ä¸ª policy æ¥æ§åˆ¶å¹¶è¡Œæ–¹å¼ã€‚

```py
extends Task

# Run all child Tasks together in SEQUENCE or SELECTOR policy mode

class_name Parallel, "res://icons/parallel.png"

enum Policy { SEQUENCE, SELECTOR }

#export(bool) var policy = bool(SEQUENCE)
export(Policy) var policy = Policy.SEQUENCE

var num_results = 0

func run():
    for child in get_children():
        child.run()
    running()

func child_success():
    num_results += 1
    #if policy == bool(SEQUENCE):
    if policy == (Policy.SEQUENCE):
        if num_results >= get_child_count():
            num_results = 0
            success()
    else:
        success()

func child_fail():
    num_results += 1
    #if policy == bool(SELECTOR):
    if policy == (Policy.SELECTOR):
        if num_results >= get_child_count():
            num_results = 0
            fail()
    else:
        fail()

func cancel():
    num_results = 0
    .cancel()

func start():
    num_results = 0
    .start()
```

Andrew Wilkes æä¾›çš„ä»£ç ä¸­åŒ…å«äº†ä¸€ä¸ªæµ‹è¯•ï¼Œè¿™é‡Œä¹Ÿæä¾›ä¸€ä¸ªç®€åŒ–çš„ç‰ˆæœ¬æ¼”ç¤ºä»»åŠ¡è¿è¡Œã€‚æ³¨æ„ï¼šåœ¨å¤„ç†ä»»åŠ¡
æ—¶ï¼Œä½¿ç”¨å½“å‰ä»»åŠ¡èŠ‚ç‚¹çš„ idx ç´¢å¼•æ¥æ‰§è¡Œå½“å‰çš„ä»»åŠ¡ï¼Œrun() ä¹‹åä¼šä¿®æ”¹ç´¢å¼•å€¼ï¼Œåœ¨ process å¤„ç†æ—¶ï¼Œè¦
é¿å…å› ä¸º idx çš„å˜åŒ–å¯¼è‡´ get_child() å¼•ç”¨èŠ‚ç‚¹é”™è¯¯ã€‚

ä»çŠ¶æ€è½¬æ¢è§’åº¦æ¥çœ‹ï¼Œæ§åˆ¶èŠ‚ç‚¹çš„çŠ¶æ€é™¤äº†ç›´æ¥é€šè¿‡ `Task` çš„ Final æ–¹æ³•æ§åˆ¶ï¼Œè¿˜åŒæ ·å—åˆ°å­èŠ‚ç‚¹çš„çŠ¶æ€
é€šçŸ¥æ–¹æ³•ä¿®æ”¹ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°å¤šä¸ªå­èŠ‚ç‚¹ä¿®æ”¹çˆ¶èŠ‚ç‚¹çŠ¶æ€çš„å¯èƒ½ã€‚ä»¥ä¸‹ä»£ç ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªæ–°çŠ¶æ€ FINISHEDï¼Œ
ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªä»»åŠ¡çš„å®ŒæˆçŠ¶æ€ï¼Œä¸ç®¡å®ƒæ˜¯æˆåŠŸæ‰§è¡Œè¿˜æ˜¯å¤±è´¥ã€‚

å¦å¤–ï¼Œå› ä¸º Godot åœºæ™¯æ ‘æ˜¯å¤šçº¿ç¨‹å¤„ç†çš„ï¼Œä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨åœ°æ‰§è¡ŒèŠ‚ç‚¹çŠ¶æ€çš„è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨å»¶åè°ƒç”¨æ–¹æ³•ï¼š
`call_deferred("finished")` å¯ä»¥ç¡®ä¿å…¶å®ƒçº¿ç¨‹å®Œæˆè®¡ç®—åï¼Œå†æ‰§è¡Œå®ŒæˆçŠ¶æ€çš„è®¾ç½®ã€‚å¦‚æœä¸é€šè¿‡å»¶åè°ƒç”¨ï¼Œ
é‚£ä¹ˆè¿™ä¸ªå®ŒæˆçŠ¶æ€è®¾ç½®åï¼Œå°±å¯èƒ½è¢«å­çº¿ç¨‹ç´§æ¥ç€ä¿®æ”¹äº†ã€‚

```py
extends Task

var list
var idx = 0

func _ready():
    list = get_node("/root/Test/Results") as ItemList
    add_result("TEST", "RESULT")
    tree = self
    start()
    status = States.RUNNING

func child_running():
    status = States.RUNNING

func child_success():
    status = States.SUCCEEDED
    log_result()

func child_fail():
    status = States.FAILED
    log_result()

func _process(_delta):
    if status == States.RUNNING and idx < tree.get_children().size():
        var task = tree.get_child(idx)
        task.run()

func add_result(description, result):
    list.add_item(description)
    list.add_item(result)

func log_result():
    add_result(get_child(idx).to_string(), enum2str(status))
    
    idx += 1
    if idx == tree.get_children().size():
        status = States.FINISHED
        idx = 0
        call_deferred("finished")
        add_result("--", enum2str(status))
    else:
        status = States.RUNNING

func finished():
    status = States.FINISHED

enum States {FRESH, RUNNING, FAILED, SUCCEEDED, CANCELLED, FINISHED }

func enum2str(status):
    # enum like a Dictionary
    return States.keys()[status].capitalize()
#   match status:
#       FRESH:
#           return "Fresh"
#       RUNNING:
#           return "Running"
#       FAILED:
#           return "Failed"
#       SUCCEEDED:
#           return "Succeeded"
#       CANCELLED:
#           return "Cancelled"
#       FINISHED:
#           return "Finished"
```

Godot ä¸­çš„æšä¸¾ç±»å‹ enum å’Œå­—å…¸å¯¹è±¡åŒæºï¼Œå¯ä»¥ä½¿ç”¨ keys() æ–¹æ³•è·å–æšä¸¾é‡çš„åç§°æ¥å®ç°åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚
å‚è€ƒ global_constants.cpp æºä»£ç æ–‡ä»¶ï¼Œå…¶ä¸­æ³¨å†Œäº†å…¨å±€ç±»å‹å¸¸é‡ã€‚GDScript è§£é‡Šå™¨ä¹Ÿæ²¡æœ‰ä¸“é—¨è®¾ç½®ä¸€ä¸ª
Token ç”¨äºè¡¨ç¤ºæšä¸¾ç±»å‹ï¼Œè€Œæ˜¯å’Œå­—å…¸ç±»å‹ä¸€æ ·ï¼Œç›´æ¥é€šè¿‡æ£€æµ‹ä»£ç ä¸­çš„èŠ±æ‹¬å·æ¥è¯†åˆ«æšä¸¾ç±»å‹ã€‚



## ğŸŸ¡ Network Multiplayer è”ç½‘æ¸¸æˆ
- [High-level multiplayer](https://docs.godotengine.org/en/3.5/tutorials/networking/high_level_multiplayer.html)
- [High-level multiplayer](https://docs.godotengine.org/en/stable/tutorials/networking/high_level_multiplayer.html)
- [18.ç½‘ç»œæ¸¸æˆçš„æ¶æ„åŸºç¡€ | GAMES104-ç°ä»£æ¸¸æˆå¼•æ“ï¼šä»å…¥é—¨åˆ°å®è·µ](https://www.bilibili.com/video/BV1La411o7kG/)
- [Exporting for dedicated servers](https://docs.godotengine.org/en/latest/tutorials/export/exporting_for_dedicated_servers.html)
- [Making HTTP requests](https://docs.godotengine.org/en/stable/tutorials/networking/http_request_class.html)
- [HTML5 and WebSocket](https://docs.godotengine.org/en/stable/tutorials/networking/websocket.html)
- [HTML5, WebSocket, WebRTC](https://docs.godotengine.org/en/stable/tutorials/networking/webrtc.html)
- [GodotSteam tutorials - Initializing](https://godotsteam.com/tutorials/initializing/)
- [Godot 4 MultiplayerSpawner MultiplayerSynchronizer](https://www.bilibili.com/video/BV1he4y1W7cV/)
- [Multiplayer in Godot 4.0: RPC syntax, channels, ordering](https://godotengine.org/article/multiplayer-changes-godot-4-0-report-2/)
- [[Net] New @rpc annotation](https://github.com/godotengine/godot/pull/49882)
- [Add a multiplayer interface and visual nodes for SceneTree replication](https://github.com/godotengine/godot-proposals/issues/3459)
- [Godot Multiplayer Networking Cheatsheet](https://blog.iancolwell.ca/godot-multiplayer-networking-cheatsheet)
- [StreamPeerTCP client blocked on STATUS_CONNECTING](https://github.com/godotengine/godot/issues/61197)
- godot\thirdparty\enet\enet\enet.h
- godot\3.5.1-stable\core\io\multiplayer_api.h
- godot\scene\main\multiplayer_api.h

![gRPC framework](https://grpc.io/img/landing-2.svg)

è¿ç½‘åœ¨çº¿æ¸¸æˆå¼€å‘éœ€è¦è§£å†³çš„ä¸¤ä¸ªé¦–è¦é—®é¢˜å°±æ˜¯ï¼šå¤šä¸ªç»ˆç«¯çš„åŒæ­¥é—®é¢˜ï¼Œç½‘ç»œå®‰å…¨é—®é¢˜ï¼Œå…¶æ¬¡æ˜¯å¹¶å‘æ€§èƒ½é—®é¢˜ã€‚
Massive Multiplayer Online Game (MMO) æœ€èƒ½ä½“ç°è¿™å‡ ä¸ªé—®é¢˜ã€‚

åœ¨æ¸¸æˆä¸­åŠ å…¥ç¤¾äº¤ç½‘ç»œéœ€è¦æ‰¿æ‹…ä¸€å®šçš„è´£ä»»ï¼Œå¦‚æœç¨‹åºåšé”™äº†ï¼Œä¼šä½¿åº”ç”¨ç¨‹åºå¾ˆå®¹æ˜“å—åˆ°æ”»å‡»ï¼Œå¹¶å¯èƒ½å¯¼è‡´æ¬ºè¯ˆï¼Œ
ç”šè‡³æ˜¯ä¸Šå‡ä¸ºåˆ‘äº‹æ¡ˆä»¶ã€‚å®ƒç”šè‡³å¯èƒ½å…è®¸æ”»å‡»è€…ç ´åè¿è¡Œåº”ç”¨ç¨‹åºè¿è¡Œçš„æœºå™¨ï¼Œå¹¶ä½¿ç”¨æ¸¸æˆæœåŠ¡å™¨å‘é€åƒåœ¾é‚®ä»¶ï¼Œ
æ”»å‡»ä»–äººæˆ–çªƒå–ç”¨æˆ·æ•°æ®ã€‚

è”ç½‘åŒæ­¥è¿‡ç¨‹æ¶‰åŠä¸¤ä¸ªåŸºæœ¬æ¦‚å¿µï¼š

- Spawn ç”Ÿæˆï¼šæœ¬åœ°åˆ›å»ºæˆ–è¿œç¨‹è¯·æ±‚åˆ›å»ºæ–°å¯¹è±¡ã€‚
- Sync åŒæ­¥ï¼šæœ¬åœ°æ›´æ–°æˆ–è¿œç¨‹è¯·æ±‚æ›´æ–°å¯¹è±¡çš„çŠ¶æ€ã€‚

æ¯”å¦‚ï¼Œæœ‰ä¸¤ä¸ªç©å®¶åœ¨åŒä¸€åœºæ™¯ä¸‹é‡åˆ°ä¸€ä¸ªéšæœºç”Ÿæˆçš„ NPCï¼Œé‚£ä¹ˆå‡è®¾è¿™ä¸ª NPC æ˜¯åœ¨æœåŠ¡å™¨ç”Ÿæˆï¼Œæ¥ä¸‹æ¥å°±éœ€è¦
å°†å…¶çŠ¶æ€åŒæ­¥åˆ°ä¸¤ä¸ªç©å®¶çš„ç½‘ç»œèŠ‚ç‚¹ä¸Šã€‚

ç¨‹åºè”ç½‘å¿…ä¸å¯ä»¥å°‘è¦ä½¿ç”¨äº’è”ç½‘ç»œé€šä¿¡åè®®ï¼Œåˆä»¥ TCP/IP åè®®æ ˆä¸ºæœ€åŸºç¡€ï¼š

- UDP (User Datagram Protocol)
- TCP (Transmission Control Protocol)
- HTTP (Hypertext Transfer Protocol)`
- SSL (Secure Sockets Layer)

![Multiplayer](https://godotengine.org/storage/app/uploads/public/610/918/f3e/610918f3ec53b713518837.png)

Godot å§‹ç»ˆæ”¯æŒé€šè¿‡ UDP æˆ– TCP åè®®ï¼Œè¿˜æœ‰ä¸€äº›æ›´é«˜çº§åˆ«çš„åè®®ï¼Œå¦‚ SSLã€HTTPï¼Œè¿›è¡Œæ ‡å‡†çš„ä½çº§ç½‘ç»œè¿æ¥ã€‚
è¿™äº›åè®®éå¸¸çµæ´»ï¼Œå‡ ä¹å¯ä»¥ç”¨äºä»»ä½•äº‹æƒ…ã€‚ç„¶è€Œï¼Œæ¸¸æˆå¼€å‘ä¸­ä½¿ç”¨å®ƒä»¬æ¥æ‰‹åŠ¨åŒæ­¥æ¸¸æˆçŠ¶æ€å¯èƒ½éœ€è¦å¤§é‡çš„å·¥ä½œï¼Œ
å› æ­¤éœ€è¦ä¸€ç§ High-level multiplayer æœºåˆ¶ç®€åŒ–è¿™éƒ¨åˆ†æµç¨‹ï¼Œå…¶ä¸­ Remote Procedure Calls (RPC)
å°±æ˜¯æµè¡ŒæŠ€æœ¯ï¼Œé€šè¿‡ RPCï¼Œå¯ä»¥åœ¨æœ¬åœ°ä¸»æœºå‘è¿œç¨‹ä¸»æœºå‘èµ·ä»£ç è°ƒç”¨ã€‚

Godot å®šä¹‰äº† StreamPeer æµå¼ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”±å…¶å­å®ç°å…·ä½“éœ€æ±‚ï¼Œä¾‹å¦‚æä¾› TCP è¿™ç±»æµå¼æ•°æ®
åè®®çš„æ”¯æŒï¼Œè¿™ä¸ªç±»å‹æ´¾ç”Ÿçš„å­ç±»ï¼š

- StreamPeerBuffer 
- StreamPeerExtension 
- StreamPeerGZIP 
- StreamPeerTCP 
- StreamPeerTLS 

åœ¨é¡¹ç›®å¯¼å‡ºåˆ° Android å¹³å°è¿è¡Œæ—¶ï¼Œéœ€è¦å¯ç”¨ INTERNET æˆæƒè®¾ç½®ï¼Œä»¥å…è®¸ç½‘ç»œè®¿é—®ã€‚

ä½¿ç”¨ StreamPeerTCP å»ºç«‹ TCP è¿æ¥æ—¶ï¼Œæ³¨æ„ï¼Œ`StreamPeerTCP` çš„ status éœ€è¦æ›´æ–°çŠ¶æ€å†è¿æ¥ï¼Œå…ˆ
æ‰§è¡Œ `poll()` è½®è¯¢å¹¶å¤„ç†æ•°æ®é˜»å¡ï¼Œè½¬æ¢çŠ¶æ€åå†è¿æ¥ã€‚å¦åˆ™ï¼Œget_status() æ€»æ˜¯ `STATUS_CONNECTING`ã€‚
ä½¿ç”¨ `TCPServer` å¯¹è±¡åˆ›å»º TCP æœåŠ¡å™¨å¹¶è·å–æ•°æ®æµï¼š

```py
      int get_local_port() const
     bool is_connection_available() const
     bool is_listening() const
    Error listen(port: int, bind_address: String = "*")
     void stop()
    StreamPeerTCP take_connection()
```

æ‰§è¡Œ Listen åŠ¨ä½œæ—¶ï¼Œæ”¯æŒç»‘å®š IPv4/IPv6 åœ°å€æ ¼å¼ï¼š

- `bind_address = "*"` é»˜è®¤å€¼ï¼ŒæœåŠ¡å™¨ä¼šåŒæ—¶ä¾¦å¬ IPv4/IPv6 åœ°å€ï¼›
- `bind_address = "0.0.0.0"` IPv4 æ ¼å¼ï¼Œæˆ–è€… "::" IPv6 æ ¼å¼ï¼›
- `bind_address` ç»‘å®šå…¶å®ƒæœ‰æ•ˆåœ°å€ï¼Œå¦‚ "192.168.1.101", "::1"ï¼ŒæœåŠ¡å™¨åªå“åº”è¿™ä¸ªåœ°å€ï¼›


Godot æä¾› ENet æ”¯æŒï¼ŒåŸºäºä¸å¯é  UDP è¿æ¥æä¾›ä¸€ä¸ªç›¸å¯¹è½»é‡ã€ç®€å•ã€ç¨³å®šçš„ç½‘ç»œé€šä¿¡ï¼Œæ¯” UDP å¯é ï¼Œ
åŒæ—¶åˆæ¯”åŸºäºè¿æ¥ TCP åè®®æ›´å¿«é€Ÿã€‚UDP ç¼ºå°‘æ’åºï¼Œè¿æ¥ç®¡ç†ï¼Œå¸¦å®½ç®¡ç†ï¼ŒåŒ…å¤§å°é™åˆ¶ç­‰ã€‚TCP ä¸èƒ½åŒæ—¶
æ‰“å¼€å¤šä¸ªå¥—æ¥å­—æ•…ç¼ºå°‘å¤šæµçš„é€šä¿¡ï¼Œå¹¶ä¸”ç”±äºå…¶ç¼“å†²ç‰¹æ€§ï¼Œå…¶åŒ…ç®¡ç†æœºåˆ¶è¿‡äºå¤æ‚ã€‚

æ ¹æ®æœåŠ¡å™¨çš„è®¾ç½®æ–¹å¼ï¼Œè”ç½‘æ¸¸æˆæœ‰ä¸¤ç§åŸºæœ¬çš„è¿è¡Œæ–¹å¼ï¼š

- Server: Use this one for running dedicated servers.
- Headless (no rendering): This binary contains editor functionality and is intended to be used for exporting projects.

æ‰€è°“æ— å¤´æ˜¾ç¤º Headless å³æ— æ¸²æŸ“åŠŸèƒ½çš„æœåŠ¡ç«¯ï¼Œå¯ä»¥é€šè¿‡ --display-driver headless å‚æ•°å¯åŠ¨ã€‚
ä¸“ç”¨æœåŠ¡å™¨æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡ç«¯ç¨‹åºç§»é™¤äº† Godot ç¼–è¾‘å™¨çš„åŠŸèƒ½ï¼ŒåªåŒ…å«æ¸¸æˆé€»è¾‘ï¼Œç¨‹åºæ˜¯ä¼˜åŒ–ç²¾ç®€çš„ã€‚Godot 
ç›®å‰åªæä¾› Linux å¹³å°ä¸‹çš„ä¸“ç”¨æœåŠ¡ç«¯ä»¥åŠ Headless æœåŠ¡å™¨ã€‚

å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä½çº§ç½‘ç»œ API æ¥å®ç°æœ€å¤§é™åº¦çš„æ§åˆ¶ï¼Œå¹¶åœ¨å®Œå…¨è£¸éœ²çš„ç½‘ç»œåè®®ä¹‹ä¸Šå®ç°æ‰€æœ‰åŠŸèƒ½, æˆ–è€…ä½¿ç”¨
åŸºäº SceneTree å®ç°çš„é«˜çº§ç½‘ç»œåŒæ­¥ API, åè€…ä»¥ä¸€ç§ä¼˜åŒ–çš„æ–¹å¼åœ¨åå°å®Œæˆå¤§éƒ¨åˆ†ç¹é‡çš„å·¥ä½œï¼Œä»è€Œå¤§å¤§
å‡å°‘å¼€å‘è€…çš„å·¥ä½œé‡ã€‚

Godot æ”¯æŒçš„å¤§å¤šæ•°å¹³å°éƒ½æä¾›æ‰€æœ‰æˆ–å¤§éƒ¨åˆ†ä¸Šè¿°çš„é«˜ã€ä½ç½‘ç»œåŠŸèƒ½ã€‚ä½†æ˜¯ï¼Œç”±äºç½‘ç»œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºç¡¬ä»¶
å’Œæ“ä½œç³»ç»Ÿï¼Œåœ¨æŸäº›ç›®æ ‡å¹³å°ä¸Šä¸€äº›ç‰¹æ€§å¯èƒ½ä¼šæ”¹å˜æˆ–è€…ä¸å¯ç”¨ã€‚æ³¨æ„ï¼ŒHTML5 å¹³å°ç›®å‰åªæä¾› WebSocket
å’Œ WebRTC ä¸¤ç§åè®®æ”¯æŒï¼Œç¼ºä¹ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œä»¥åŠå¯¹ TCP å’Œ UDP ç­‰ä½çº§åè®®çš„åŸå§‹è®¿é—®ã€‚

Godot 3.5 çš„å…³é”®å­—åˆ—è¡¨ä¸­æä¾›äº†ä»¥ä¸‹è¿™ç»„ç”¨äºæ ‡æ³¨ RPC æ–¹æ³•çš„å…³é”®å­—ï¼Œåç¼€ sync è¡¨ç¤ºåŒæ­¥ã€‚API è°ƒç”¨
æ–¹å¼å¯¹åº”å…³é”®å­—æœ‰ 6 ä¸ªï¼Œåˆ†åˆ«æ˜¯æœ‰ sync åç¼€å’Œæ²¡åç¼€çš„ä¸¤ç§ã€‚æ¯”å¦‚ï¼Œæœ‰åç¼€ `sync` å°±å¸¦æœ‰æœ¬åœ°åŒæ­¥è°ƒç”¨ï¼Œ
æ¯”å¦‚ `remotesync` è°ƒç”¨ï¼ŒåŒäººå¯¹æˆ˜ä¸­ä¸€æ–¹å‘å‡ºæ”»å‡»åŠ¨ä½œï¼ŒåŒæ–¹éƒ½åŒæ­¥çœ‹åˆ°æ•ˆæœã€‚

- `remote` ç”±è¿œç¨‹ç«¯è€Œä¸æ˜¯æœ¬åœ°è°ƒç”¨çš„æ–¹æ³•æˆ–æ›´æ”¹çš„å±æ€§ï¼Œæ— è®ºå®ƒä»¬æ˜¯èŠ‚ç‚¹çš„ä¸»æ§è¿˜æ˜¯å‚€å„¡ã€‚
- `master` ä»…æ¥å—æ¥è‡ªå‚€å„¡ç½‘ç»œèŠ‚ç‚¹çš„è°ƒç”¨æˆ–å±æ€§æ›´æ”¹ï¼Œè¯·å‚è§ node.set_network_master()ã€‚
- `puppet` ä»…æ¥å—æ¥è‡ªä¸»æ§ç½‘ç»œèŠ‚ç‚¹çš„è°ƒç”¨æˆ–å±æ€§æ›´æ”¹ï¼Œè¯·å‚è§ node.set_network_master()ã€‚

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª `sync` å…³é”®å­—ï¼Œä»æºä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¸ remotesync æ˜¯ç­‰ä»·çš„ï¼š

```C++
        case GDScriptTokenizer::TK_PR_REMOTESYNC:
        case GDScriptTokenizer::TK_PR_SYNC: {
            //may be fallthrough from export, ignore if so
            tokenizer->advance();
            if (tokenizer->get_token() != GDScriptTokenizer::TK_PR_VAR 
                && tokenizer->get_token() != GDScriptTokenizer::TK_PR_FUNCTION) {
                // ...
                return;
            }

            rpc_mode = MultiplayerAPI::RPC_MODE_REMOTESYNC;
            continue;
        } break;
```

ä¸€ä¸ªè”ç½‘æ¸¸æˆçš„ API è°ƒç”¨ï¼Œå‘ç”Ÿçš„åœºæ‰€ï¼šæœåŠ¡å™¨ã€ä¸»æ§èŠ‚ç‚¹ï¼ˆmasterï¼‰ã€ä»»æ„å‚€å„¡èŠ‚ç‚¹ï¼ˆslave/puppetï¼‰ã€‚
å¯¹äºåŒäººè”ç½‘æ¸¸æˆï¼Œå…¶ä¸­ä¸€æ–¹å°†å……å½“æœåŠ¡å™¨å³ä¸»æ§èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¦ä¸€æ–¹å°±æ˜¯å‚€å„¡èŠ‚ç‚¹ã€‚å¯¹äºå½“å‰ç©å®¶æ¥è¯´ï¼Œè‡ªå·±å½“å‰
æ§åˆ¶çš„ä¸»æœºå°±æ˜¯ network master ä¸»æ§èŠ‚ç‚¹ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªè§¦å‘æœºåˆ¶å¯¹ç…§è¡¨ï¼Œåœºæ™¯ä¸­çš„è§’è‰²åˆ†ä¸ºä¸¤ç±»ï¼Œå…¶ä¸­ **Player** èŠ‚ç‚¹ä»£è¡¨æµ‹è¯•è€…ï¼Œå…¶å®ƒè§’è‰²ä¸º **NPC**ã€‚
ç©å®¶æ‰€åœ¨ä¸»æœºä¸º Player Hostï¼Œå…¶å®ƒè§’è‰²æ‰€åœ¨æ‰€åœ¨ä¸»æœºä¸º NPC Hostã€‚ç©å®¶æˆ– NPC åœ¨è‡ªå·±ä¸»æœºä»¥å¤–çš„å‰¯æœ¬å¯¹è±¡
ç§°ä¸º **Shadow**ã€‚åœ¨ç©å®¶çš„ä¸»æœºä¸Šè¿›è¡Œæµ‹è¯•æ“ä½œï¼Œåˆ†åˆ«åœ¨ç©å®¶å’Œ NPC ä¸¤ç§å¯¹è±¡èŠ‚ç‚¹ä¸Šè¿›è¡Œè§¦å‘ RPC è°ƒç”¨çš„
æµ‹è¯•æ“ä½œï¼š

|    RPC     |   Trigger    | Player Host |  NPC Host | Player Shadow | NPC Shadow |
|------------|--------------|-------------|-----------|---------------|------------|
| remote     | Player/NPC   | -           | -         | exec          | exec       |
| remotesync | Both[exec]   | exec        | exec      | exec          | exec       |
|------------|--------------|-------------|-----------|---------------|------------|
| master     | Player[exec] | exec        | not-allow | not-allow     | not-allow  |
| master     | NPC          | not-allow   | exec      | not-allow     | not-allow  |
| mastersync | Player[exec] | exec        | -         | -             | -          |
| mastersync | NPC[exec]    | -           | exec      | -             | not-allow  |
|------------|--------------|-------------|-----------|---------------|------------|
| puppet     | Player       | -           | -         | exec          | -          |
| puppet     | NPC[exec]    | -           | not-allow | -             | not-allow  |
| puppetsync | Player       | exec        | -         | exec          | -          |
| puppetsync | NPC[exec]    | -           | not-allow | -             | not-allow  |

æ€»ç»“ï¼Œremote å’Œ remotesync æ˜¯æœ€å®¹æ˜“ç†è§£çš„ä¸¤ä¸ªï¼Œ`remote` å°±æ˜¯ç”±æœ¬åœ°ä»»ä½•å¯¹è±¡å‘æ‰€æœ‰è¿œç«¯å‘é€ RPC
è°ƒç”¨ï¼Œåœ¨æ‰€æœ‰è¿œç«¯æ‰§è¡Œçš„å‡½æ•°ã€‚åç¼€ sync åï¼Œå°±åŒ…æ‹¬äº†æœ¬åœ°ä¹Ÿä¼šæ‰§è¡Œ RPC è°ƒç”¨ï¼Œå³åŒ…å«è”ç½‘ä¸­çš„æ‰€æœ‰ä¸»æœºã€‚

ç„¶åæ˜¯ï¼Œ`master`ï¼Œå®ƒä»£è¡¨ä¸»æ§ RPC è°ƒç”¨ï¼Œå³åœ¨èŠ‚ç‚¹çš„ä¸»æ§ç«¯æ‰§è¡Œ RPC è°ƒç”¨ï¼Œå¯ä»¥åœ¨ä¸»æ§æˆ–å‚€å„¡ç«¯å‘èµ·è°ƒç”¨ã€‚
æ³¨æ„ï¼Œéä¸»æ§èŠ‚ç‚¹éœ€è¦åšæƒé™åˆ¤æ–­ï¼Œä¸Šè¡¨ä¸­å‡ºç° not-allow çš„æƒ…å†µéƒ½éœ€è¦åš peer ID åˆ¤æƒã€‚ç„¶åæ˜¯å¸¦åç¼€çš„
`mastersync`ï¼Œè¿™é‡Œçš„é€»è¾‘æœ‰ç‚¹å¤æ‚ï¼Œå°±æ˜¯åœ¨å‚€å„¡èŠ‚ç‚¹ä¸Šæ“ä½œæ—¶ï¼Œæœ‰ä¸¤ä¸ªä¸»æœºå¯ä»¥å“åº” RPC è°ƒç”¨ï¼Œè€Œå…¶å®ƒçš„
å‚€å„¡éœ€è¦åšé‰´æƒã€‚è¡¨ä¸­çš„ NPC èŠ‚ç‚¹è§¦å‘ä¸»æ§è°ƒç”¨æ—¶ï¼Œå…¶æœ¬èº«ä»¥åŠ NPC ä¸»æœºä¹Ÿå“åº” RPC è°ƒç”¨ï¼Œä½†å…¶å®ƒé™¤å¤–ã€‚

å‚€å„¡èŠ‚ç‚¹ï¼ˆslave/puppetï¼‰æ˜¯ç›¸å¯¹ä¸»æ§çš„æ¦‚å¿µï¼Œæ‰€è¡Œä¸ºä¹Ÿæœ‰ç±»ä¼¼çš„åœ°æ–¹ï¼Œæ˜¯æŒ‡åœ¨å‚€å„¡èŠ‚ç‚¹ä¸Šå“åº” RPC è°ƒç”¨ã€‚
å¯¹äº Player æ¥è¯´ï¼Œå‚€å„¡å°±æ˜¯ Player Shadowï¼Œå¯¹äº NPC æ¥è¯´ï¼Œå‚€å„¡å°±æ˜¯ Player Shadowã€‚å› ä¸ºæµ‹è¯•
æ“ä½œåœ¨ Player Hostï¼Œæ­¤ä¸»æœºä¸Šçš„æ‰€æœ‰ NPC éƒ½å‚€å„¡èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œæ— è®º `puppet` è¿˜æ˜¯ `puppetsync`ï¼Œ
åœ¨ NPC ä¸Šæ€»èƒ½è§¦å‘ RPC å¹¶å“åº”è¿™ä¸ªè¿œç¨‹è°ƒç”¨ï¼Œä½†æ˜¯åœ¨ NPC Host ä¸Šä¸ä¼šå“åº”ã€‚

è‡³äº Player æ¥è¯´ï¼Œå› ä¸ºæ˜¯ä¸»æ§ï¼Œåœ¨ä½¿ç”¨ `puppetsync` æ‰ä¼šå“åº” RPC è¿œç¨‹è°ƒç”¨ï¼Œå…¶ Shadow ä¹Ÿä¼šå“åº”ã€‚

è¿™äº›å…³é”®å­—é™¤äº†ä¿®é¥°å‡½æ•°ï¼Œè¿˜å¯ä»¥ç”¨æ¥ä¿®é¥°å˜é‡ï¼Œæ­£å¸¸å®šä¹‰çš„å˜é‡åªåœ¨æœ¬æœºä¸Šè¯»å†™ï¼š

    remote var somevar
    remotesync var somevar

    master var somevar
    mastersync var somevar

    puppet var somevar
    puppetsync var somevar

å†æ¥è¯´è¯´é‰´æƒï¼Œä»¥ä¸‹ä¸¤ç§æ¡ä»¶åˆ¤æ–­æ˜¯æœ‰æ‰€å·®åˆ«çš„ï¼Œä¹Ÿæ˜¯å¸¸ç”¨çš„ä¸¤ç§é‰´æƒï¼š

    is_network_master()
    get_network_master() == multiplayer.get_rpc_sender_id()

å‰è€…æ ¹æ®èŠ‚ç‚¹ç»‘å®šçš„ peer IDï¼Œå³ set_network_master() æŒ‡å®šçš„ IDï¼Œä¸å½“å‰ä¸»æœºä¸Šåˆ†é…åˆ°çš„ ID æ¯”è¾ƒï¼Œ
è€Œåè€…åˆ™æ˜¯ä¸ RPC çš„å‘èµ·æ–¹åˆ†é…åˆ°çš„ ID è¿›è¡Œæ¯”è¾ƒã€‚ä½†æ˜¯ï¼ŒGodot 3.5 ä¸­ï¼Œè¿”å›çš„ ID æ€»ä¸º 0ã€‚

é™¤äº†è¿™äº›æ ‡æ³¨ API ç”¨æ³•å…³é”®å­—å¤–ï¼Œè”ç½‘æ¸¸æˆä¸­è¿˜ä½¿ç”¨ peer ID ç”¨äºæ ‡è¯†å¯¹ç­‰ç½‘ç»œä¸­çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªç©å®¶å¯¹åº”
ä¸€ä¸ª IDï¼ŒæœåŠ¡ç«¯ ID = 1ã€‚å¯ä»¥é€šè¿‡å‘æ¸¸æˆä¼ é€’å‚æ•°æ¥å¯åŠ¨æœåŠ¡å™¨åŠŸèƒ½ï¼Œé€šè¿‡ OS.get_cmdline_args()
è·å–å‘½ä»¤è¡Œå‚æ•°ï¼Œæ¯”å¦‚ --server ç”¨äºå¯åŠ¨æœåŠ¡å™¨ã€‚

åœºæ™¯ä¸­çš„èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ set_network_master() æ–¹æ³•æŒ‡å®šå…¶å½’å± master çš„ IDï¼Œé€šè¿‡æ¯”è¾ƒ peer IDï¼Œ
ä½¿ç”¨èŠ‚ç‚¹çš„ is_network_master()ï¼Œå°±å¯ä»¥ç¡®å®šç¨‹åºé€»è¾‘ä¸­æ˜¯å¦åº”è¯¥ä¿®æ”¹èŠ‚ç‚¹æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾å½“å‰
ç©å®¶ä½œä¸ºæœåŠ¡å™¨ç«¯è¿è¡Œï¼Œæ˜¾ç¤ºåœ¨å·¦ä¾§èŠ‚ç‚¹åˆ—è¡¨ä¸­ã€‚å…¶ä¸­å½’å±äºå¯¹æ‰‹çš„èŠ‚ç‚¹ä½¿ç”¨çº¢è‰²è¡¨ç¤ºï¼Œå¯¹äºä¸»æ§èŠ‚ç‚¹æ¥è¯´ï¼Œè¿™ä¸ª
çº¢è‰²èŠ‚ç‚¹å±äºç½‘ç»œä¸­çš„å‚€å„¡èŠ‚ç‚¹ï¼Œå½“å‰ç©å®¶çš„ç¨‹åºé€»è¾‘ä¸åº”ä¸»åŠ¨ä¿®æ”¹è¿™èŠ‚ç‚¹çš„æ•°æ®ã€‚

![Network multiplayers](https://docs.godotengine.org/en/latest/_images/nmms.png)

ä¸»æ§èŠ‚ç‚¹çš„æ¦‚å¿µåœ¨ Godot 4 ä¸­æ›´æ–°ä¸ºå¤šç«¯æˆæƒ multiplayer authorityï¼Œç¼–ç¨‹ä¸­ä¾ç„¶å¯ä»¥ä½¿ç”¨å¯¹ç­‰ç½‘ç»œ
èŠ‚ç‚¹çš„ ID æ¥åšåˆ¤æ–­ã€‚é»˜è®¤çŠ¶æ€ä¸‹ï¼Œåœºæ™¯æ ‘ä¸­çš„çš„èŠ‚ç‚¹éƒ½ä¸ºæœåŠ¡å™¨ç«¯æˆæƒã€‚å³ä¸è°ƒç”¨ set_network_master æˆ–
set_multiplayer_authority çš„æ¡ä»¶ä¸‹ï¼Œè·å– Node çš„æˆæƒ peer ID å€¼éƒ½æ˜¯ 1ï¼Œå­èŠ‚ç‚¹ç»§æ‰¿çˆ¶èŠ‚ç‚¹çš„å€¼ã€‚

è¿™ä¸ª ID åœ¨ peer è¿æ¥åˆ°æœåŠ¡å™¨ç«¯æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œè¿æ¥ä¿¡å·æˆ– multiplayer.get_unique_id() éƒ½å¯ä»¥è·å–ã€‚

ä»¥ä¸Š RPC å…³é”®å­—ä¸ MultiplayerAPI.RPCMode æŒ‡ç¤ºçš„çŠ¶æ€ç›¸å¯¹åº”ï¼š

|       RPCMode       | Value |                            Notes                            |  Keywords  |
|---------------------|-------|-------------------------------------------------------------|------------|
| RPC_MODE_DISABLED   |     0 | to disable a method or property for all RPC calls.          |            |
| RPC_MODE_REMOTE     |     1 | method/property only on the remote end, not locally.        | remote     |
| RPC_MODE_MASTER     |     2 | method/property only on the network master.                 | master     |
| RPC_MODE_PUPPET     |     3 | method/property only on puppets for this node.              | puppet     |
| RPC_MODE_REMOTESYNC |     4 | RPC_MODE_REMOTE + make the call or property change locally. | remotesync |
| RPC_MODE_MASTERSYNC |     5 | RPC_MODE_MASTER + make the call or property change locally. | mastersync |
| RPC_MODE_PUPPETSYNC |     6 | RPC_MODE_PUPPET + make the call or property change locally. | puppetsync |
| RPC_MODE_SLAVE      |     3 | Deprecated. Use RPC_MODE_PUPPET instead.                    | slave      |
| RPC_MODE_SYNC       |     4 | Deprecated. Use RPC_MODE_REMOTESYNC instead.                | sync       |


å‡çº§åˆ° Godot 4.x åï¼ŒRPC æœºåˆ¶ç²¾ç®€å¹¶å¼•ç”¨æ ‡æ³¨ï¼Œè¿™äº›å…³é”®å­—ä¸å†ä½¿ç”¨ï¼ŒMultiplayerAPI.RPCMode æ¨¡å¼
ä¹Ÿåªå‰©ä¸‹ 3 ç§ï¼Œç»Ÿä¸€ä½¿ç”¨åŒä¸€ä¸ª rpc_config() é…ç½®æ–¹æ³•è¿›è¡Œé…ç½®ï¼š

- *RPC_MODE_DISABLED* = 0ï¼Œæ‰€æœ‰æ–¹æ³•çš„é»˜è®¤ RPC æ¨¡å¼ã€‚
- *RPC_MODE_ANY_PEER* = 1ï¼Œä¾›ä¸€åˆ‡è¿œç«¯è°ƒç”¨ï¼Œä¸ç®¡æ˜¯å¦æˆæƒï¼Œ`@rpc("any_peer")` æ ‡æ³¨ï¼Œç›¸å½“äº `remotesync`ã€‚
- *RPC_MODE_AUTHORITY* = 2ï¼ŒMultiplayer authority æˆæƒè¿œç¨‹è°ƒç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºæœåŠ¡å™¨ï¼Œ`@rpc("authority")` æ ‡æ³¨ï¼Œç›¸å½“äº `master` æˆ– `mastersync`ã€‚

Godot 4.x RPC é…ç½®æ–¹æ³• Node.rpc_config() å‚æ•°åŒ…æ‹¬å››ä¸ªå±æ€§ä¸ @rpc æ ‡æ³¨ä¸€è‡´ï¼š

```py
{
    rpc_mode = MultiplayerAPI.RPCMode,
    transfer_mode = MultiplayerPeer.TranferMode,
    call_local = false,
    channel = 0,
}
```

æ–°ç‰ˆæœ¬ä¸­ @rpc å‚æ•°è¯´æ˜ï¼š

    @rpc(mode: String = "", sync: String = "", transfer_mode: String = "", transfer_channel: int = 0, ...) vararg

- `mode` - RPC mode ("any_peer", "authority").
- `sync` - calls the function locally too when RPCing ("call_local", "call_remote").
- `transfer_mode` - Transfer mode (one of reliable, unreliable, unreliable_ordered).
- `transfer_channel` - Transfer channel (not used by the MultiplayerAPI for now, need implementation).

è§£é‡Šä¸€ä¸‹å…¶ä¸­å‰ä¸¤ä¸ªå‚æ•°ï¼š

- RPCMode æŒ‡ç¤º RPC æ–¹æ³•èƒ½ä¸èƒ½è¢«è°ƒç”¨ï¼Œæ ‡æ³¨ä¸º "any_peer" åœ¨æ‰€æœ‰å¯¹ç­‰ç«¯éƒ½ä¼šè°ƒç”¨ï¼Œ"authority" åˆ™æ˜¯åœ¨ä¸»æ§ç«¯è°ƒç”¨ï¼›
- call_local æŒ‡ç¤º RPC æ–¹æ³•çš„åŒæ­¥æ–¹å¼ï¼Œ"call_local" æœ¬åœ°å’Œè¿œç«¯ä¸€å¹¶åŒæ­¥ï¼Œ"call_remote" åªåŒæ­¥è¿œç«¯ï¼›

å¦å¤–ï¼Œunreliable è¿™ç±»æ§åˆ¶ç½‘ç»œåè®®çš„æ³¨è§£å‚æ•°å¯¹åº” Godot 3.5 ä¸­çš„ rpc_unreliable() ç­‰æ–¹æ³•ã€‚
æ—§ç‰ˆæœ¬ä¸­ï¼Œmaster å’Œ remote ä¸èƒ½åŒæ—¶ç”¨æ¥æ³¨è§£ä¸€ä¸ª RPC æ–¹æ³•ï¼Œä¸åƒ Godot 4.x å¯ä»¥é€šè¿‡ @rpc æ ‡æ³¨
æ‰€æœ‰ RPC æ–¹æ³•çš„é…ç½®å‚æ•°ã€‚

ä½¿ç”¨ Node.set_multiplayer_authority() æ–¹æ³•ç»™èŠ‚ç‚¹æˆæƒï¼ŒæŒ‡å®š ID å¯¹ç­‰ç«¯ä½œä¸ºä¸»æ§æˆæƒï¼Œå¤šç«¯æˆæƒ
æ˜¯å¯¹ç½‘ç»œä¸Šçš„æ‹¥æœ‰æœ‰èŠ‚ç‚¹æƒé™çš„å¯¹ç­‰æ–¹ã€‚ç»“åˆ rpc_config() å’Œ MultiplayerAPI ç»“åˆä½¿ç”¨éå¸¸æœ‰ç”¨ã€‚é»˜è®¤
æƒ…å†µä¸‹ä»çˆ¶èŠ‚ç‚¹ç»§æ‰¿ï¼Œæœ€ç»ˆé»˜è®¤ä¸ºå¯¹ç­‰ç«¯ ID 1 ä¸ºæœåŠ¡å™¨ã€‚å¦‚æœæ˜¯é€’å½’çš„ï¼Œåˆ™å°†ç»™å®šçš„å¯¹ç­‰ç«¯é€’å½’åœ°è®¾ç½®ä¸ºè¯¥
èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹çš„æƒé™ã€‚


Godot 3 å…³é”®å­—ä¸ Godot 4 æ ‡æ³¨çš„ç­‰ä»·å…³ç³»å‚è€ƒï¼š

|      Godot 3.5 keywords     |                 Godot 4 @rpc annotations                |
|-----------------------------|---------------------------------------------------------|
| remote                      | @rpc("any_peer", "call_remote")                         |
| remotesync                  | @rpc("any_peer", "call_local")                          |
| master                      | @rpc("authority", "call_remote")                        |
| mastersync                  | @rpc("authority", "call_local")                         |
| rpc_unreliable()            | @rpc("unreliable")                                      |
| rpc_unreliable(master func) | @rpc or @rpc("authority", "call_remote", "reliable", 1) |

è¿™ä¸ªè¡¨å¯ä»¥ä½œä¸º Godot 3.5 ä¸ Godot 4.x Multiplayer RPC å¼€å‘å‚è€ƒã€‚

æ ‡æ³¨ä½¿ç”¨ç¤ºèŒƒå¦‚ä¸‹ï¼Œå‡è®¾é€šè¿‡ä¸€ä¸ª Area3D çš„è¾“å…¥äº‹ä»¶è§¦å‘ RPC è°ƒç”¨ï¼š

- shake_me() æ–¹æ³•ä½¿ç”¨é»˜è®¤æ ‡æ³¨ï¼Œå³åœ¨ä¸»æ§æ‰§è¡Œè¿œç«¯åŒæ­¥ï¼Œç­‰åŒæ—§ç‰ˆæœ¬çš„ `master` å…³é”®å­—ï¼›
- shake_all() æ–¹æ³•æ‰€æœ‰å¯¹ç­‰ç«¯éƒ½æ‰§è¡Œï¼Œå¹¶ä¸”æ‰§è¡Œè¿œç«¯åŒæ­¥ï¼Œç­‰åŒæ—§ç‰ˆæœ¬çš„ `remote` å…³é”®å­—ï¼›
- clicked_all() æ–¹æ³•åœ¨æ‰€æœ‰å¯¹ç­‰ç«¯æ‰§è¡Œï¼Œå¹¶ä¸”æ‰§è¡Œæœ¬åœ°ä¸è¿œç«¯åŒæ­¥ï¼Œç­‰åŒæ—§ç‰ˆæœ¬çš„ `remotesync` å…³é”®å­—ã€‚

```py
@rpc
#@rpc("authority", "call_remote", "reliable", 1)
func shake_me():
    $Message.text = "Shake me!"

@rpc("any_peer", "call_remote", "reliable", 1)
func shake_all():
    $Message.text = "Shake all!"

@rpc("any_peer", "call_local", "reliable", 1)
func clicked_all():
    $Message.text = "%d clicked on me!" % [multiplayer.get_remote_sender_id()]


func _on_Area3D_input_event(camera, event, position, normal, shape_idx):
    if not event is InputEventMouseButton:
        return
    match event.button_index:
        MOUSE_BUTTON_LEFT:
            rpc("clicked_by_player")
        MOUSE_BUTTON_RIGHT:
            rpc("shake_me")
        MOUSE_BUTTON_MIDDLE:
            rpc("shake_all")
```

æ€»ç»“æ¥çœ‹ï¼Œnetwork master ä¹Ÿå¥½ï¼Œmultiplayer authority ä¹Ÿå¥½ï¼Œå°±æ˜¯ä¸€ä¸ªä¸»æ§æ¦‚å¿µã€‚åœºæ™¯æ ‘ä¸­æ‰€æœ‰
èŠ‚ç‚¹éƒ½å¯ä»¥å½’å±ç»™å¯¹ç­‰ç½‘ç»œè¿æ¥ä¸­çš„ä¸€ä¸ªå¯¹ç­‰ç«¯ï¼Œè€Œé»˜è®¤å½’å±ä¸ºæœåŠ¡å™¨ç«¯ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ Playerï¼Œé»˜è®¤
çŠ¶æ€ä¸‹å°±å½’å±äºæœåŠ¡å™¨ï¼Œåœ¨æ‰€æœ‰è”ç½‘ä¸»æœºä¸­å®ƒåº”è¯¥éƒ½æœ‰ä¸€ä¸ªåŒæ ·çš„å‰¯æœ¬ï¼Œé‚£ä¹ˆï¼šè¿™ä¸ªèŠ‚ç‚¹å®šä¹‰ä¸º "authority"
çš„æ–¹æ³•ï¼Œåœ¨æœåŠ¡å™¨æ‰§è¡Œæ—¶ï¼Œé€šè¿‡æŸ¥è¯¢å½“ä¸‹ MultiplayerPeer æ‰€å…³è”çš„ IDï¼Œå³å¯ä»¥çŸ¥é“å½“ä¸‹çš„ peer ID 
ä¸ Player å½’å±ä¸€è‡´ï¼Œæ‰€ä»¥æ–¹æ³•å¯ä»¥æ‰§è¡Œã€‚åœ¨å…¶å®ƒå®¢æˆ·ç«¯ï¼ŒåŒä¸€ Player æ–¹æ³•å°±ä¼šå› ä¸ºä¸»æœºæ‰€åˆ†é…çš„ peer ID
å€¼ä¸ Player èŠ‚ç‚¹å½’å±ä¸ä¸€è‡´ï¼Œè€Œä¸ä¼šè¢«æ‰§è¡Œã€‚

è€Œå¯¹äºæ ‡æ³¨ä¸º "any_peer" çš„æ–¹æ³•ï¼Œç›¸å½“äºå¹¿æ’­æ–¹æ³•ï¼Œå‡è®¾åœ¨æŸä¸€ä¸ªå®¢æˆ·ä¸­æ‰§è¡Œï¼Œä¼šå‘æ‰€æœ‰è¿ç½‘ä¸»æœºé€šæŠ¥ï¼š
ç°åœ¨è¦æ‰§è¡Œè¿™ä¸ª "any_peer" æ ‡æ³¨è¿‡çš„æ–¹æ³•ã€‚å¦‚æœè¿˜é…åˆ "call_local"ï¼Œé‚£ä¹ˆä¸»åŠ¨å‘èµ·è°ƒç”¨çš„è¿™ä¸ªå®¢æˆ·æœº
ä¸Šä¹Ÿä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œè€Œä¸æ˜¯å•çº¯å‘å…¶å®ƒè¿ç½‘ä¸»æœºå‘å‡º RPC è°ƒç”¨ã€‚

å…·ä½“å‚æ•°ä½¿ç”¨å¯ä»¥å‚è€ƒæºä»£ç  GDScriptParser::rpc_annotation() æ–¹æ³•ä¸­çš„å®šä¹‰ï¼š

```cpp
    // godot\master\modules\gdscript\gdscript_parser.cpp:3905
    for (int i = last; i >= 0; i--) {
        String mode = p_annotation->resolved_arguments[i].operator String();
        if (mode == "any_peer") {
            rpc_config["rpc_mode"] = MultiplayerAPI::RPC_MODE_ANY_PEER;
        } else if (mode == "authority") {
            rpc_config["rpc_mode"] = MultiplayerAPI::RPC_MODE_AUTHORITY;
        } else if (mode == "call_local") {
            rpc_config["call_local"] = true;
        } else if (mode == "call_remote") {
            rpc_config["call_local"] = false;
        } else if (mode == "reliable") {
            rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_RELIABLE;
        } else if (mode == "unreliable") {
            rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_UNRELIABLE;
        } else if (mode == "unreliable_ordered") {
            rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_UNRELIABLE_ORDERED;
        } else {
            push_error(R"(Invalid RPC argument. Must be one of: 'call_local'/'call_remote' (local calls), 'any_peer'/'authority' (permission), 'reliable'/'unreliable'/'unreliable_ordered' (transfer mode).)", p_annotation);
        }
    }
```

ä¸åŒ Godot ç‰ˆæœ¬ä¸‹çš„ SceneTree è¿ç½‘ç›¸å…³æ–¹æ³•åŠå±æ€§ï¼ŒGodot 3 ä¸æ–°ç‰ˆæœ¬æœ€å¤§çš„å·®åˆ«åœ¨äºï¼Œåœºæ™¯æ ‘åŒ…è£…äº†
å®Œæ•´çš„ MultiplayerAPI ä¿¡å·ï¼Œå¹¶ä¸”ç›´æ¥å¼•ç”¨ MultiplayerPeerã€‚ä¸ºäº†åŒæ­¥æ¸¸æˆå¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨åœºæ™¯æ ‘çš„
set_pause() æ–¹æ³•ã€‚

```py
# Godot 3
# https://docs.godotengine.org/en/3.5/classes/class_scenetree.html
MultiplayerAPI multiplayer
    Setter set_multiplayer(value)
    Getter get_multiplayer()

NetworkedMultiplayerPeer network_peer
    Setter set_network_peer(value)
    Getter get_network_peer()

bool multiplayer_poll = true
    Setter set_multiplayer_poll_enabled(value)
    Getter is_multiplayer_poll_enabled()

bool refuse_new_network_connections = false
    Setter set_refuse_new_network_connections(value)
    Getter is_refusing_new_network_connections()

PoolIntArray get_network_connected_peers ( ) const
int get_network_unique_id ( ) const
int get_rpc_sender_id ( ) const
bool has_network_peer ( ) const
bool is_network_server ( ) const

# Godot 4
# https://docs.godotengine.org/en/latest/classes/class_scenetree.html
bool multiplayer_poll [default: true]
    set_multiplayer_poll_enabled(value) setter
    is_multiplayer_poll_enabled() getter

MultiplayerAPI get_multiplayer ( NodePath for_path=NodePath("") ) const
void set_multiplayer ( MultiplayerAPI multiplayer, NodePath root_path=NodePath("") )
```


ä¸åŒ Godot ç‰ˆæœ¬ä¸‹çš„ Node èŠ‚ç‚¹å’Œ RPC ç›¸å…³çš„å±æ€§ã€æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š

```py
# Godot 3
# https://docs.godotengine.org/en/3.5/classes/class_node.html
MultiplayerAPI custom_multiplayer
    Setter set_custom_multiplayer(value)
    Getter get_custom_multiplayer()

MultiplayerAPI multiplayer
    Getter get_multiplayer()

int get_network_master() const
bool is_network_master() const
void set_network_master(id: int, recursive: bool = true)


void rpc_config(method: String, mode: RPCMode å’Œ call_local æ–¹å¼çš„ç”¨é€”ï¼š)
void rset_config(property: String, mode: RPCMode)

Variant rpc(method: String, ...) vararg
Variant rpc_unreliable(method: String, ...) vararg
Variant rpc_id(peer_id: int, method: String, ...) vararg
Variant rpc_unreliable_id(peer_id: int, method: String, ...) vararg

void rset(property: String, value: Variant)
void rset_id(peer_id: int, property: String, value: Variant)
void rset_unreliable(property: String, value: Variant)
void rset_unreliable_id(peer_id: int, property: String, value: Variant)

# Godot 4
# https://docs.godotengine.org/en/latest/classes/class_node.html
MultiplayerAPI multiplayer
    Getter get_multiplayer()

Error rpc ( StringName method, ... ) vararg
void  rpc_config ( StringName method, Variant config )
Error rpc_id ( int peer_id, StringName method, ... ) vararg

void  set_multiplayer_authority ( int id, bool recursive=true )
int get_multiplayer_authority() const
bool is_multiplayer_authority() const
```

Godot 3.5 ä¸­æä¾›çš„ remote, master, puppet, remotesync, mastersync, puppetsync è¿™äº›
å…³é”®å­—ç”¨äºæ ‡æ³¨ RPC æ–¹æ³•ï¼Œå¯ä»¥å½“ä½œ rpc_config() æˆ– reset_config() æ–¹æ³•ä½¿ç”¨ã€‚é»˜è®¤åœ°ï¼Œæ‰€æœ‰å±æ€§
éƒ½ä¸å‘ RPC ç½‘ç»œå…¬å¼€ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™å¥— API æœ‰ä¸‰ç±»ï¼šä»¥ rpc ä¸ºå‰ç¼€çš„ä¸æ–¹æ³•è®¾ç½®ç›¸å…³ï¼Œä»¥ rset ä¸ºå‰ç¼€çš„
ä¸å±æ€§åŒæ­¥ç›¸å…³ï¼Œå¸¦æœ‰ unreliable åç§°çš„åŸºäº UDP åè®®ã€‚æˆ–è€…ä»å¦ä¸€ä¸ªè§’åº¦åˆ†ç±»ï¼šä¸€ç±» RPC API æ‰§è¡Œ
é…ç½®ï¼Œå’Œä½¿ç”¨ remote è¿™äº›å…³é”®å­—ä¸€æ ·ï¼›å¦å¤–ä¸€ç±» RPC API ç”¨äºæ‰§è¡ŒèŠ‚ç‚¹æ–¹æ³•ï¼›æœ€åä¸€ç±»ä¿®æ”¹èŠ‚ç‚¹å±æ€§å€¼ã€‚

- `rpc_config()` æ‰§è¡Œ RPC æœåŠ¡é…ç½®ï¼Œè®¾ç½®æŒ‡å®š method çš„ RPCMode æ¨¡å¼ã€‚
- `rset_config()` æ‰§è¡Œ RPC æœåŠ¡é…ç½®ï¼Œè®¾ç½®æŒ‡å®š property çš„ RPCMode æ¨¡å¼ã€‚
- `rpc()` å‘è¿œç¨‹ä¸»æœºå‘é€ RPC è°ƒç”¨ï¼Œåªç”±è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œçš„ç¨‹åºä¸­ç›¸åŒ NodePath èŠ‚ç‚¹å“åº”ï¼Œå¹¶ä¸¥æ ¼åŒ¹é…èŠ‚ç‚¹åç§°ã€‚
- `rpc_id()` å‘æŒ‡å®šè¿œç¨‹ç«¯ ID çš„ä¸»æœºå‘é€ RPC è°ƒç”¨ã€‚
- `rset()` è¿œç¨‹æ›´æ”¹å…¶ä»–å¯¹ç­‰æ–¹ï¼ˆå’Œæœ¬åœ°ï¼‰ä¸Šçš„å±æ€§å€¼ï¼Œremotely setã€‚
- `rset_id()` è¿œç¨‹æ›´æ”¹æŒ‡å®šè¿œç¨‹ç«¯ ID çš„ä¸»æœºçš„å±æ€§å€¼ï¼Œremotely set by peer IDã€‚
- `rpc_unreliable()` ä½¿ç”¨ UDP åè®®çš„ `rpc()`ã€‚
- `rpc_unreliable_id()` ä½¿ç”¨ UDP åè®®çš„ `rpc_id()`ã€‚
- `rset_unreliable()` ä½¿ç”¨ UDP åè®®çš„ `rset()`ã€‚
- `rset_unreliable_id()` ä½¿ç”¨ UDP åè®®çš„ `rset_id()`ã€‚

Godot 4 ç²¾ç®€äº† RPC APIï¼Œç§»é™¤äº†å±æ€§è®¾ç½®çš„ RPC APIã€‚

Godot è”ç½‘ä¸­é—´å±‚æŠ½è±¡ä¸º `MultiplayerPeer`ï¼Œå¯¹åº” Godot 3 çš„ç±»å‹ NetworkedMultiplayerPeerï¼Œ
ç»§æ‰¿è‡ª `PacketPeer`ï¼Œè¿™æ˜¯ä»ç«¯ç‚¹æ•°æ®åŒ…ä¼ è¾“çš„è§’åº¦è¿›è¡ŒæŠ½è±¡ã€‚

|          Godot 3.5           |         Godot 4.0          |
|------------------------------|----------------------------|
|                              | ENetPacketPeer             |
| PacketPeerDTLS               | PacketPeerDTLS             |
| PacketPeerGDNative           | PacketPeerExtension        |
| PacketPeerStream             | PacketPeerStream           |
| PacketPeerUDP                | PacketPeerUDP              |
| WebRTCDataChannel            | WebRTCDataChannel          |
| WebSocketPeer                | WebSocketPeer              |
| NetworkedMultiplayerPeer     | MultiplayerPeer            |
| - MultiplayerPeerGDNative    | - MultiplayerPeerExtension |
| - NetworkedMultiplayerCustom | - OfflineMultiplayerPeer   |
| - NetworkedMultiplayerENet   | - ENetMultiplayerPeer      |
| - WebRTCMultiplayer          | - WebRTCMultiplayerPeer    |
| - WebSocketMultiplayerPeer   | - WebSocketMultiplayerPeer |

MultiplayerAPI ç±»å‹æ˜¯ High-level multiplayer API æ¥å£çš„å®ç°è€…ï¼Œé€šè¿‡ Node èŠ‚ç‚¹ç›¸åº”æ–¹æ³•æä¾›æœåŠ¡ï¼Œ
é»˜è®¤åœ°ï¼ŒSceneTree åŒ…å«äº† MultiplayerAPI çš„å¼•ç”¨ï¼Œé€šè¿‡ `get_multiplayer()` æ–¹æ³•è·å–ã€‚

Godot 4 ä¸­ç»†åŒ–äº† MultiplayerAPIï¼Œæ–°å¢å­ `SceneMultiplayer` æ˜¯è¿™å¥— API çš„é»˜è®¤å®ç°ï¼Œä¸ºèŠ‚ç‚¹
Node.rpc() æˆ– Node.rpc_id() ç­‰æ–¹æ³•æä¾›æ”¯æŒï¼Œå®ƒä»¬éƒ½éœ€è¦ MultiplayerAPI.rpc() æ–¹æ³•ã€‚é€šè¿‡
å¦ä¸€ä¸ªå­ç±» `MultiplayerAPIExtension` å¯ä»¥è¿›è¡Œ API æ‰©å±•ã€‚

MultiplayerAPI æä¾›äº†è”ç½‘ç›¸å…³çš„ä¿¡å·ï¼Œåœ¨ä¸åŒ Godot ç‰ˆæœ¬ä¸‹åç§°æœ‰æ‰€å·®åˆ«ã€‚ä¿¡å·å‚æ•°ä¸­çš„ id æ ‡è®°äº†
æ–°è¿æ¥æˆ–æ–­å¼€è¿æ¥çš„ multiplayer_peerï¼ŒæœåŠ¡ç«¯ ID å€¼ä¸º 1ã€‚å»ºç«‹è¿æ¥æˆ–æ–­å¼€è¿æ¥ä¼šå‘æ‰€æœ‰ clients 
å‘å‡ºä¿¡å·ï¼Œé€šè¿‡ id åˆ¤æ–­å‘ç”Ÿè¿æ¥æˆ–æ–­å¼€è¿æ¥çš„å¯¹ç­‰ç«¯ã€‚

|              Godot 3               |          Godot 4           |          Notes           |
|------------------------------------|----------------------------|--------------------------|
| connected_to_server()              | connected_to_server()      | Only emitted on clients. |
| connection_failed()                | connection_failed()        | Only emitted on clients. |
| server_disconnected()              | server_disconnected()      | Only emitted on clients. |
| network_peer_connected(id: int)    | peer_connected(id: int)    | Emiited on any peer.     |
| network_peer_disconnected(id: int) | peer_disconnected(id: int) | Emiited on any peer.     |

è¿˜æœ‰ä¸€ä¸ªæ•°æ®æ¥æ”¶æ—¶è§¦å‘çš„ä¿¡å·ï¼Œæ–°ç‰ˆæœ¬ä¸­ç±»ç»“æ„æœ‰è°ƒæ•´ï¼Œè¿™ä¸ªä¿¡å·æ•´åˆåˆ°çš„æ–°å¢çš„ SceneMultiplayer ç±»å‹ä¸Šã€‚
å¯¹æ–¹é€šè¿‡ MultiplayerAPI æˆ– SceneMultiplayer æ¥å£ send_bytes() å‘é€æ•°æ®ï¼Œid ä¸ºå…¶æ ‡è¯†ç¬¦ã€‚

- Godot 3.5 MultiplayerAPI: network_peer_packet(id: int, packet: PoolByteArray)
- Godot 4.0 SceneMultiplayer: peer_packet(id: int, packet: PackedByteArray)

å‰ä¸€ä¸ªæ–¹æ³•éœ€è¦åœ¨ network_peer æ¥æ”¶åˆ°æ¥è‡ª `send_bytes()` æ–¹æ³•å‘é€çš„æ•°æ®æ—¶è§¦å‘ã€‚

å¦å¤–ï¼ŒNetworkedMultiplayerPeerï¼Œå¯¹åº”æ–°ç‰ˆæœ¬çš„ MultiplayerPeer åªä¿ç•™äº†ä¸¤ä¸ªè¿æ¥ä¿¡å·ï¼š

|          Godot 3.4           |          Godot 4.x          |
|------------------------------|-----------------------------|
| NetworkedMultiplayerPeer     | MultiplayerPeer             |
| - connection_failed()        |                             |
| - connection_succeeded()     |                             |
| - peer_connected(id: int)    | -peer_connected(id: int)    |
| - peer_disconnected(id: int) | -peer_disconnected(id: int) |
| - server_disconnected()      |                             |

åœ¨æ—§ç‰ˆæœ¬æ–‡æ¡£ä¸­ï¼Œåªæ˜¯è¯´ peer_connected(id: int) åœ¨æœåŠ¡ç«¯è§¦å‘ï¼Œä½†åœ¨å®¢æˆ·ç«¯ä¹Ÿä¸€æ ·ä¼šè§¦å‘ï¼Œåªæœ‰æ–­å¼€
è¿æ¥æ—¶ peer_disconnected(id: int) æ‰åªå‘ç”Ÿåœ¨æœåŠ¡å™¨ã€‚å¦å¤–ï¼Œåœ¨ Goodt 3.5.1 ä¸­ï¼ŒæœåŠ¡å™¨æ–­å¼€è¿æ¥
ä¿¡å·å¯ä»¥é€šè¿‡ NetworkedMultiplayerENet è§¦å‘ï¼Œä½†æ˜¯ MultiplayerAPI.server_disconnected()
å¯èƒ½å¹¶ä¸ä¼šè§¦å‘ï¼Œå¦‚æœæ”¹å˜äº†å…¶é»˜è®¤ç»‘å®šçš„ä¿¡å·å¤„ç†å‡½æ•°ã€‚

æ— è®ºå¦‚ä½•ï¼Œpeer_disconnected æ˜¯ä¸€å®šä¼šè§¦å‘çš„ï¼Œå› ä¸ºåœ¨ `poll()` æ£€æµ‹åˆ°å¯¹ç«¯æ–­å¼€è¿æ¥å°±è§¦å‘æ­¤ä¿¡å·ã€‚

åœ¨è¿™äº›ä¿¡å·ä¸­ï¼Œä¸»è¦å…³å¿ƒçš„æ˜¯ peer çš„è¿æ¥ä¸æ–­å¼€ä¿¡å·ï¼Œå¦å¤–ä¸‰ä¸ªä¿¡å·åªä¼šåœ¨å®¢æˆ·ç«¯è§¦å‘ï¼Œå¯ä»¥åæ˜ ç½‘ç»œçš„çŠ¶æ€ã€‚
è€Œ peer ç›¸å…³çš„ä¸¤ä¿¡å·æ‰æ˜¯æ¸¸æˆè”ç½‘ä¸­é‡ç‚¹å¤„ç†çš„ã€‚åœ¨æ¥æ”¶åˆ°è¿æ¥ä¿¡å·æ—¶ï¼Œæ‰å¯ä»¥å®‰å…¨åœ°è¿›è¡Œ RPC æ“ä½œï¼Œéœ€è¦
éšæ—¶è·Ÿè¸ªä¸æœåŠ¡å™¨çš„è¿æ¥çŠ¶æ€ï¼Œæˆ–è€… server_disconnected ä¿¡å·ï¼š

```py
    # Godot 3
    SceneTree.network_peer.get_connection_status() == CONNECTION_CONNECTED ...
    Node.is_network_master()
    MultiplayerAPI.is_network_server()

    # Godot 4
    MultiplayerAPI mp_api = SceneTree.get_multiplayer()
    MultiplayerPeer mp_peer = mpapi.get_multiplayer_peer()
    if mp_pert.get_connection_status() == CONNECTION_CONNECTED ...
    MultiplayerAPI.is_server()
```

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é”™è¯¯ä¿¡æ¯ï¼Œå› ä¸º client/server ç«¯åœºæ™¯æ ‘èŠ‚ç‚¹ç»“æ„ä¸ä¸€è‡´å¯¼è‡´çš„ï¼š

    get_node: Node not found: "Main/1" (relative to "/root").
    process_simplify_path: Condition "node == nullptr" is true.
    _process_get_node: Failed to get path from RPC: Main/1.
    process_rpc: Invalid packet received. Requested node was not found.

æœåŠ¡å™¨æ–­å¼€è¿æ¥åè¿˜åœ¨è°ƒç”¨ is_multiplayer_authority() è¿™äº› RPC API äº§ç”Ÿçš„é”™è¯¯ï¼š

    The multiplayer instance isn't currently active.
    No multiplayer peer is assigned. Unable to get unique ID.

è¿æ¥è¶…æ—¶åå†å°è¯•è¿æ¥æ—¶å‡ºç°çš„é”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰è°ƒç”¨ close_connection() å°±å°è¯•é‡æ–°è¿æ¥ï¼š

    ERROR: The multiplayer instance is already active.
       at: (modules/enet/networked_multiplayer_enet.cpp:118)

å› ä¸ºèŠ‚ç‚¹å…³é—­åå†å¯¹å…¶è°ƒç”¨ RPC API å¯¼è‡´çš„é”™è¯¯ï¼š

    ERROR: Condition "peer == nullptr" is true. Returning: -1
    at: send (modules/enet/enet_packet_peer.cpp:60)

æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ° peer_disconnected ä¿¡å·æ—¶ï¼Œåº”è¯¥ç­‰å¾…ä¸€ä¸‹å†å‘é€å¹¿æ’­å¼è°ƒç”¨ï¼Œé¿å…å¯¹å·²ç»æ–­å¼€è¿æ¥çš„å®¢æˆ·
å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨ï¼š

```py
func peer_disconnected(peer_id):
    print_debug("peer disconnected: %d." % [peer_id])
    # Disconnect peer specific from host.
    # multiplayer_peer.disconnect_peer(peer_id)
    # 
    # Wait ENet for less seconds to keep clean
    # Destroy player node on other clients peers
    call_deferred("rpc", "destroy_peer_broadcast", peer_id)
    #rpc("destroy_peer_broadcast", peer_id)
```


    ERROR: Condition "!is_inside_tree()" is true. Returning: false
       at: is_multiplayer_authority (scene/main/node.cpp:575)

å¼€å‘ TCP åè®®ï¼Œå¯ä»¥è®¾ç½®å·¥ç¨‹ä¸­è®¾ç½®è¶…æ—¶ç­‰å¾…æ—¶é—´ï¼š

    ProjectSettings.set_setting("network/limits/tcp/connect_timeout_seconds", 9)


### ğŸŸ ğŸ”µ DNS & IP Address åŸŸåä¸åœ°å€åˆ†ç±»
- [RFC 791 - IP(Internet Protocol)](https://www.rfc-editor.org/info/rfc791)
- [RFC 793 - TCP(Transmission Control Protocol)](https://www.rfc-editor.org/info/rfc793)
- [RFC3986 - Uniform Resource Identifier (URI)](https://www.rfc-editor.org/rfc/rfc3986)

IP åœ°å€åŒ…å«ç½‘ç»œæ ‡è¯†ï¼ˆç½‘ç»œå·ï¼‰å’Œä¸»æœºæ ‡è¯†ï¼ˆä¸»æœºå·ï¼‰ä¸¤éƒ¨åˆ†ï¼Œç”¨æ©ç æ¥åˆ†å‰²ï¼Œæ©ç ä¸º 1 çš„æ¯”ç‰¹ä½å¯¹åº”ç½‘ç»œå·ã€‚

IP åè®®æ–‡æ¡£ RFC 791 ä¸­å°† 32-bit å¾— IP åœ°å€åˆ’åˆ†æˆä¸‰ä¸ªç±»å‹ï¼š

      High Order Bits   Format                           Class
      ---------------   -------------------------------  -----
            0            7 bits of net, 24 bits of host    A
            10          14 bits of net, 16 bits of host    B
            110         21 bits of net,  8 bits of host    C
            111         escape to extended addressing mode

A ç±»åœ°å€æœ€é«˜ä½ä¸º 0ï¼Œç½‘ç»œå·å  7-bit network numberï¼Œä¸»æœºåœ°å€å  24-bitï¼Œå…±æœ‰ 128 ä¸ª A ç±»ç½‘ç»œã€‚

       0                 1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |0|   NETWORK   |                Local Address                  |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

             Class A Address 0.0.0.0~127.255.255.255

B ç±»åœ°å€æœ€é«˜ä½ä¸º 10ï¼Œç½‘ç»œå·å  14-bitï¼Œä¸»æœºåœ°å€å  16-bitï¼Œå¯ä»¥åˆ†é… 16,384 ä¸ª B ç±»ç½‘ç»œã€‚

       0                 1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1 0|           NETWORK         |          Local Address        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

             Class B Address 128.0.0.0~191.255.255.255

C ç±»åœ°å€æœ€é«˜ä½ä¸º 110ï¼Œç½‘ç»œå·å  21-bitï¼Œä¸»æœºåœ°å€å  8-bitï¼Œå¯ä»¥åˆ†é… 2,097,152 ä¸ª C ç±»ç½‘ç»œã€‚

       0                 1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |1 1 0|                    NETWORK              | Local Address |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

             Class C Address 192.0.0.0~224.255.255.255

äº’è”ç½‘æ•°å­—åˆ†é…æœºæ„ IANA - The Internet Assigned Numbers Authority åœ¨ RFC 1918 æ–‡æ¡£ä¸­
è¯´æ˜ä¸ºç§æœ‰ç½‘ç»œé¢„ç•™å‡ºäº†ä¸‰ä¸ª IP åœ°å€å—ï¼š

     10.0.0.0        -   10.255.255.255  (10/8 prefix)
     172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
     192.168.0.0     -   192.168.255.255 (192.168/16 prefix)


é™¤åœ°å€ Aã€Bã€C åˆ†ç±»å¤–ï¼Œè¿˜å¯æ ¹æ®ä¼ è¾“çš„æ¶ˆæ¯ç‰¹å¾å°† IP åœ°å€åˆ†ä¸ºå•æ’­ã€å¹¿æ’­æˆ–å¤šæ’­ã€‚ä¸»æœºä½¿ç”¨IPåœ°å€è¿›è¡Œå•æ’­
ä¸€å¯¹ä¸€ä¼ è¾“ã€å¤šæ’­ä¸€å¯¹å¤šä¼ è¾“ï¼Œæˆ–ä¸€å¯¹å…¨ç½‘ä¸»æœºå¹¿æ’­çš„é€šä¿¡ã€‚


å•æ’­åœ°å€æ˜¯ IP ç½‘ç»œä¸­æœ€å¸¸è§çš„ï¼ŒåŒ…å«å•æ’­ç›®æ ‡åœ°å€çš„åˆ†ç»„å‘é€ç»™ç‰¹å®šä¸»æœºï¼Œä¾‹å¦‚ 192.168.1.5 ä¸»æœºå‘åœ°å€
ä¸º 192.168.1.200 çš„æœåŠ¡å™¨è¯·æ±‚ç½‘é¡µã€‚

è¦å‘é€å’Œæ¥æ”¶å•æ’­åˆ†ç»„ Packet æ•°æ®æŠ¥ï¼ŒIP åˆ†ç»„æŠ¥å¤´éƒ¨ä¸­å¿…é¡»æœ‰ä¸€ä¸ªç›®æ ‡ IP åœ°å€ï¼Œè€Œä»¥å¤ªç½‘å¸§æŠ¥å¤´ä¸­å¿…é¡»
æœ‰ç›¸åº”çš„ç›®æ ‡ MAC åœ°å€ã€‚IP åœ°å€å’Œ MAC åœ°å€ä¸€èµ·å°†æ•°æ®ä¼ è¾“åˆ°ç‰¹å®šçš„ç›®æ ‡ä¸»æœºã€‚

å¦‚æœç›®æ ‡ IP åœ°å€å±äºå¦ä¸€ä¸ªç½‘ç»œï¼Œåˆ™åœ¨å¸§ä¸­ä½¿ç”¨çš„ç›®æ ‡ MAC åœ°å€å°†æ”¹ä¸ºä¸æº IP åœ°å€ä½äºåŒä¸€ä¸ªç½‘ç»œä¸­çš„
è·¯ç”±å™¨æ¥å£çš„ MAC åœ°å€ã€‚


å¹¿æ’­åˆ†ç»„çš„ç›®æ ‡ IP åœ°å€çš„ä¸»æœºéƒ¨åˆ†å…¨ä¸º 1ï¼Œè¿™æ„å‘³ç€æœ¬åœ°ç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœºéƒ½å°†æ¥æ”¶å¹¶æŸ¥çœ‹è¯¥åˆ†ç»„æ•°æ®æŠ¥ã€‚
è¯¸å¦‚ ARP å’Œ DHCP ç­‰å¾ˆå¤šç½‘ç»œåè®®éƒ½ä½¿ç”¨å¹¿æ’­ã€‚ä¾‹å¦‚ï¼Œå¯¹äº C ç±» IP åœ°å€ï¼Œå‰ 24-bit ä¸ºç½‘ç»œå·ï¼Œæœ€å
8-bit ä¸ºä¸»æœºå·ï¼Œå…¶å¯¹åº”å¹¿æ’­åœ°å€ä¸º 192.168.1.255ï¼Œä¸»æœºéƒ¨åˆ†ä¸ºåè¿›åˆ¶æ•° 255 æˆ–äºŒè¿›åˆ¶æ•° 11111111ï¼š

    ç±»å‹  IP å•æ’­åœ°å€   å­ç½‘æ©ç          IP å¹¿æ’­åœ°å€
       A  10.0.0.0     255.0.0.0      10.255.255.255
       B  172.16.0.0   255.255.0.0    172.16.255.255
       C  192.168.1.0  255.255.255.0  192.168.1.255

åœ¨ä»¥å¤ªç½‘å¸§ä¸­ï¼Œå¿…é¡»åŒ…å«ä¸ IP å¹¿æ’­åœ°å€å¯¹åº”çš„ MAC å¹¿æ’­åœ°å€ã€‚åœ¨ä»¥å¤ªç½‘ä¸­ï¼ŒMAC å¹¿æ’­åœ°å€é•¿48ä½ï¼Œå…¶åå…­
è¿›åˆ¶è¡¨ç¤ºä¸º FF-FF-FF-FF-FF-FFï¼Œå…¨ 1 ä¸º MAC å¹¿æ’­åœ°å€ï¼Œä¸»æœºåœ°å€ä¸ºå…¨ 1 å³ IP å¹¿æ’­åœ°å€ã€‚


å¤šæ’­åœ°å€è®©æºè®¾å¤‡èƒ½å¤Ÿå°†åˆ†ç»„æŠ¥æ–‡ Packet å‘é€ç»™ä¸€ç»„è®¾å¤‡ã€‚å±äºå¤šæ’­ç»„çš„è®¾å¤‡å°†è¢«åˆ†é…ä¸€ä¸ªå¤šæ’­ç»„ IP åœ°å€ï¼Œ
å¤šæ’­åœ°å€èŒƒå›´ä¸º 224.0.0.0ï½239.255.255.255ã€‚ç”±äºå¤šæ’­åœ°å€è¡¨ç¤ºä¸€ç»„è®¾å¤‡ï¼Œæœ‰æ—¶è¢«ç§°ä¸ºä¸»æœºç»„ï¼Œå› æ­¤åªèƒ½
ç”¨ä½œåˆ†ç»„çš„ç›®æ ‡åœ°å€ï¼Œæºåœ°å€æ€»æ˜¯ä¸ºå•æ’­åœ°å€ã€‚

è¿œç¨‹æ¸¸æˆå°±æ˜¯ä¸€ä¸ªä½¿ç”¨å¤šæ’­åœ°å€çš„ä¾‹å­ï¼Œå¾ˆå¤šç©å®¶é€šè¿‡è¿œç¨‹è¿æ¥ç©åŒä¸€ä¸ªæ¸¸æˆï¼›å¦ä¸€ä¾‹å­æ˜¯é€šè¿‡è§†é¢‘ä¼šè®®è¿›è¡Œè¿œç¨‹
æ•™å­¦ï¼Œå…¶ä¸­å¾ˆå¤šå­¦ç”Ÿè¿æ¥åˆ°åŒä¸€ä¸ªæ•™å®¤ã€‚

åŒå•æ’­åœ°å€ã€å¹¿æ’­åœ°å€ä¸€æ ·ï¼ŒIP å¤šæ’­åœ°å€ä¹Ÿéœ€è¦ç›¸åº”çš„å¤šæ’­ MAC åœ°å€åœ¨æœ¬åœ°ç½‘ç»œä¸­å®é™…ä¼ é€å¸§ã€‚MAC å¤šæ’­åœ°å€
ä»¥åå…­è¿›åˆ¶å€¼ `01-00-5E` æ‰“å¤´ï¼Œä½™ä¸‹çš„ 6 ä¸ªåå…­è¿›åˆ¶ä½æ˜¯æ ¹æ® IP å¤šæ’­ç»„åœ°å€çš„æœ€å 23 ä½è½¬æ¢å¾—åˆ°çš„ã€‚
ä¾‹å¦‚ä¸€ä¸ª MAC å¤šæ’­åœ°å€å¯ä»¥æ˜¯ 01-00-5E-0F-64-C5ã€‚

ç”±äºå¹¿æ’­æ–¹å¼æ— è®ºè¿æ¥åˆ°å±€åŸŸç½‘çš„å®¢æˆ·ç«¯æƒ³ä¸æƒ³æ¥æ”¶è¯¥æ•°æ®ï¼ŒServer éƒ½ä¼šç»™å®¢æˆ·ç«¯å‘é€è¯¥æ•°æ®ã€‚è¿›è€Œé€ æˆå®¢æˆ·ç«¯
æ•°æ®æ‹¥å¡ï¼Œå› æ­¤å¼•å…¥ç»„æ’­ï¼šServer æ•°æ®åŒ…åªå‘é€ç»™æŒ‡å®šç»„å†…çš„å®¢æˆ·ç«¯ï¼Œè€Œä¸å‘é€ç»™æŒ‡å®šç»„å¤–çš„å®¢æˆ·ç«¯ã€‚


äº’è”ç½‘ç»œä¸­æœ‰ä¸¤ç§ç»å…¸æ¨¡å‹ï¼Œè½¯ä»¶å¼€å‘å¸¸ç”¨ TCP/IP ä¸ºæ ¸å¿ƒçš„å››å±‚æ¨¡å‹ï¼ŒIP åœ°å€æ˜¯æ ¸å¿ƒå…ƒç´ ï¼š

|    OSI ä¸ƒå±‚ç½‘ç»œæ¨¡å‹   | å››å±‚æ¦‚å¿µæ¨¡å‹  |               å¯¹åº”ç½‘ç»œåè®®               |
|---------------------|-------------|---------------------------------------|
| åº”ç”¨å±‚ Application   | åº”ç”¨å±‚       | HTTPã€TFTP, FTP, NFS, WAISã€SMTP        |
| è¡¨ç¤ºå±‚ Presentation  | -           | Telnet, Rlogin, SNMP, Gopher           |
| ä¼šè¯å±‚ Session       | -           | SMTP, DNS                              |
| ä¼ è¾“å±‚ Transport     | ä¼ è¾“å±‚       | TCP, UDP                               |
| ç½‘ç»œå±‚ Network       | ç½‘ç»œå±‚       | IP, ICMP, ARP, RARP, AKP, UUCP         |
| æ•°æ®é“¾è·¯å±‚ Data Link  | æ•°æ®é“¾è·¯å±‚   | FDDI, Ethernet, Arpanet, PDN, SLIP, PPP |
| ç‰©ç†å±‚ Physical      | -           | IEEE 802.1A, IEEE 802.2...IEEE 802.11    |

ä¼ è¾“å±‚åŠä»¥ä¸‹ï¼Œéƒ½æ¶‰åŠç›¸å…³çš„ç¡¬ä»¶è¿›è¡Œå·¥ä½œï¼Œå¦‚ï¼š

- ä¼ è¾“å±‚ï¼šå››å±‚äº¤æ¢æœºã€å››å±‚è·¯ç”±å™¨ï¼›
- ç½‘ç»œå±‚ï¼šä¸‰å±‚äº¤æ¢æœºã€è·¯ç”±å™¨ï¼›
- é“¾è·¯å±‚ï¼šç½‘å¡ã€ç½‘æ¡¥ã€ä»¥å¤ªç½‘äº¤æ¢æœºï¼›
- ç‰©ç†å±‚ï¼šä¸­ç»§å™¨ã€é›†çº¿å™¨ï¼Œç½‘çº¿ã€‚

é™¤ç›´æ¥ä½¿ç”¨ IP åœ°å€å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ›´äººæ€§åŒ–çš„ IP ä½¿ç”¨æ–¹å¼ï¼Œå°±æ˜¯ä½¿ç”¨åŸŸåæŒ‡ä»£ IPã€‚é€šè¿‡å›½é™…åŸŸåæ£®æ—æ„æ¶å’Œ
åŸºç¡€ç½‘ç»œåè®® Domain Name System (DNS) çš„æ”¯æŒï¼Œç”¨æˆ·åªéœ€è¦æä¾›ä¸€ä¸ªåŸŸåï¼Œå°±å¯ä»¥é€šè¿‡åŸŸåæœåŠ¡ç³»ç»Ÿ
æŸ¥è¯¢åˆ°ç›¸åº”çš„ IP åœ°å€ï¼Œè¿™æ¯”ç›´æ¥è®°ä½ IP çš„æ–¹å¼å¥½å¤ªå¤šäº†ã€‚


DNS åŸŸåç©ºé—´ä½¿ç”¨åˆ†å¸ƒå¼çš„è§£ææ–¹æ¡ˆï¼Œæ•´ä¸ª DNS æ¶æ„æ˜¯ä¸€ç§å±‚æ¬¡æ ‘çŠ¶ç»“æ„ï¼Œè¿™ä¸ªæ ‘çŠ¶ç»“æ„ç§°ä¸º DNS åŸŸåç©ºé—´ã€‚

- æ ¹åŸŸ Root Domain ä½äºåŸŸåç©ºé—´æœ€é¡¶å±‚ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ª â€œ.â€ è¡¨ç¤ºã€‚
- é¡¶çº§åŸŸ Top Level Domain (TLD)ï¼Œä»£è¡¨ç»„ç»‡æœºæ„æˆ–å›½å®¶åœ°åŒºï¼Œå¦‚ netã€comã€orgã€eduã€govã€milã€cnã€jpã€hkã€‚
- äºŒçº§åŸŸï¼Œç”¨æ¥æ ‡æ˜é¡¶çº§åŸŸå†…çš„ä¸€ä¸ªç‰¹å®šçš„ç»„ç»‡ï¼Œå¦‚ .com.cn .net.cn .edu.cn ç­‰ç­‰ã€‚
- å­åŸŸ Sub-Domainï¼ŒäºŒçº§åŸŸä¸‹æ‰€åˆ›å»ºçš„å„çº§åŸŸç»Ÿç§°ä¸ºå­åŸŸï¼Œå¦‚ fanyi.baidu.com å‰å¤´çš„"ç¿»è¯‘"ã€‚
- ä¸»æœº Hostï¼Œä¸»æœºä½äºåŸŸåç©ºé—´æœ€ä¸‹å±‚ï¼Œå°±æ˜¯ä¸€å°å…·ä½“çš„è®¡ç®—æœºï¼Œå¦‚ wwwã€mail éƒ½æ˜¯å…·ä½“çš„è®¡ç®—æœºåå­—ã€‚

Fully Qualified Domain Name (FQDN) å®Œå…¨åˆæ ¼åŸŸåæ˜¯æŒ‡åŒ…å«æ‰€æœ‰åŸŸåå…ƒç´ çš„åŸŸåè¡¨ç¤ºæ–¹å¼ï¼Œä¹Ÿæ˜¯è¿™
å°ä¸»æœºåœ¨åŸŸåä¸­çš„å…¨åï¼Œæ¯”è¾ƒå°‘ç”¨ï¼Œæ¯”å¦‚ www.fanyi.baidu.comã€‚è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„åŸŸåï¼Œæ¯”å¦‚æœ¬åœ°ä¸»æœºç”¨
loalhost è¡¨ç¤º 127.0.0.1ã€‚

URI's are transferred as strings. The URI's format is defined in 
[http://tools.ietf.org/html/rfc3986](http://tools.ietf.org/html/rfc3986)

    3.  Syntax Components

      foo://example.com:8042/over/there?name=ferret#nose
      \_/   \______________/\_________/ \_________/ \__/
       |           |            |            |        |
    scheme     authority       path        query   fragment
       |   _____________________|__
      / \ /                        \
      urn:example:animal:ferret:nose


æ•´ä¸ª DNS åŸŸåæŸ¥è¯¢è¿‡ç¨‹æ˜¯é€’å½’æŸ¥è¯¢è¿‡ç¨‹ï¼Œä»å®¢æˆ·ç«¯å¼€å§‹ï¼Œå…ˆå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢è¯·æ±‚å¤–ï¼Œå³æœ¬æœºæ“ä½œç³»ç»Ÿ
æä¾›çš„æœåŠ¡ï¼Œç„¶åï¼Œå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œç›´åˆ°æ ¹åŸŸæœåŠ¡å™¨é€çº§æŸ¥è¯¢ï¼Œç›´åˆ°è·å–æœ€ç»ˆç»“æœã€‚

IPv6 çš„æ¨å‡ºï¼Œç›¸åº”å‡ºç°äº† inet_pton() å’Œ inet_ntop() ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬æ”¯æŒ IPv4 å’Œ IPv6 åœ°å€
çš„æ ¼å¼è½¬æ¢ï¼Œå³ "ddd.ddd.ddd.ddd" æ ¼å¼ä¸æ•°å€¼çš„è½¬æ¢ï¼Œpresentation å’Œ numeric ä¹‹é—´çš„è½¬æ¢ã€‚

Godot ä¸­ç”¨ `IP` ç±»å‹æ¥åšåŸŸåã€IP åœ°å€è½¬æ¢ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿå·®åˆ«ï¼Œä¼šåœ¨å†…éƒ¨æ–¹æ³•ä¸­è°ƒç”¨ç›¸åº”çš„ APIï¼š

```C++
// godot\core\io\ip.cpp
IPAddress IP::resolve_hostnam(const String &p_hostname, IP::Type p_type) {
    const PackedStringArray addresses = resolve_hostname_addresses(p_hostname, p_type);
    return addresses.size() ? (IPAddress)addresses[0] : IPAddress();
}

PackedStringArray IP::resolve_hostname_addresse(const String &p_hostname, Type p_type) {
    List<IPAddress> res;
    String key = _IP_ResolverPrivate::get_cache_key(p_hostname, p_type);

    resolver->mutex.lock();
    if (resolver->cache.has(key)) {
        res = resolver->cache[key];
    } else {
        // This should be run unlocked so the resolver thread can keep resolving
        // other requests.
        resolver->mutex.unlock();
        _resolve_hostname(res, p_hostname, p_type);
        resolver->mutex.lock();
        // We might be overriding another result, but we don't care as long as the result is valid.
        if (res.size()) {
            resolver->cache[key] = res;
        }
    }
    resolver->mutex.unlock();

    PackedStringArray result;
    for (int i = 0; i < res.size(); ++i) {
        result.push_back(String(res[i]));
    }
    return result;
}
```


### ğŸŸ ğŸ”µ RPC APIs over ENet
- [Godot history in images!](https://godotengine.org/article/godot-history-images/)
- [ENet with DTLS encryption in 4.0](https://godotengine.org/article/enet-dtls-encryption/)
- [å†—ä½™ä¼ è¾“æœºåˆ¶çš„ç½‘ç»œåº“](https://github.com/Uyouii/Redundancy-Transmission-Protocol)
- [Enetå®ç°åŸç†](https://blog.csdn.net/gamekit/article/details/107092176)
- [ENet Reliable UDP networking library](https://github.com/lsalzman/enet)
- [Lee Salzman's Page of Random Stuff](http://sauerbraten.org/lee/)
- [ENet v1.3.17 Reliable UDP networking library](http://enet.bespin.org/Features.html)
- [What Every Programmer Needs To Know About Game Networking](https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/)
- [UDP vs. TCP by Glenn Fiedler](https://gafferongames.com/post/udp_vs_tcp/)
- [User Datagram Protocol (UDP)](https://www.khanacademy.org/a/transmission-control-protocol--tcp)
- [Transmission Control Protocol (TCP)](https://www.khanacademy.org/a/user-datagram-protocol-udp)
- [TCP å›¾è§£åƒç™¾é—®](https://mp.weixin.qq.com/s/tH8RFmjrveOmgLvk9hmrkw)
- [gRPC Docs](https://grpc.io/docs/)
- [Protocol Buffers](https://github.com/protocolbuffers/protobuf)
- [Protocol Buffers Documentation](https://protobuf.dev)
- [Protobuf in GDScript](https://github.com/oniksan/godobuf)
- godot-docs\classes\class_multiplayerapi.rst
- godot-docs\classes\class_multiplayerpeer.rst
- godot-docs\classes\class_networkedmultiplayerenet.rst
- godot-docs\classes\class_enetmultiplayer.rst
- godot\core\io\multiplayer_api.cpp:260
- godot\core\io\networked_multiplayer_peer.h
- godot\modules\enet\enet_connection.h
- godot\modules\enet\networked_multiplayer_enet.cpp
- godot\scene\main\multiplayer_api.h
- godot\scene\main\multiplayer_peer.h
- [Multiplayer RPC APIs over ENet ã€Godot æºä»£ç é˜…è¯»ã€‘](https://www.bilibili.com/read/cv21810824)

é¦–å…ˆï¼Œè¿™é‡Œæ¶‰åŠåˆ°æºä»£ç é˜…è¯»ï¼Œè¿™å°±éœ€è¦è®¨è®ºä¸€ä¸‹é˜…è¯»ä»£ç çš„æ–¹æ³•è®ºã€‚é˜…è¯»æºä»£ç çš„èƒ½åŠ›ç®—æ˜¯ç¨‹åºå‘˜çš„ä¸€ç§åº•å±‚
åŸºç¡€èƒ½åŠ›ä¹‹ä¸€ï¼Œè¿™ä¸ªèƒ½åŠ›çš„é‡è¦æ€§ä¸ç ”ç©¶æ•°æ®ç»“æ„ä¸ç®—æ³•åŒç­‰é‡è¦ã€‚è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­å¿…ä¸é¿å…æ¥è§¦åˆ°å…¶ä»–äººçš„
å·¥ä½œæˆæœï¼Œè€Œé˜…è¯»æºä»£ç å¯èƒ½æ˜¯å‡ºäºå­¦ä¹ è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥æ˜¯å‡ºäºé¡¹ç›®éœ€æ±‚é—®é¢˜çš„è§£å†³ã€‚

è¿™é‡Œå°±é˜…è¯»æºä»£ç ç»™å‡ºå‡ ç‚¹å‚è€ƒæ„è§ï¼š

- æºä»£ç æ˜¯äººç±»çš„æ€æƒ³è¡¨è¾¾å½¢å¼ä¹‹ä¸€ï¼Œé˜…è¯»æºä»£ç ç›¸å½“äºåœ¨åšä¸€ä¸ªæ€ç»´é€†å‘å·¥ç¨‹ï¼Œä¸è½¯ä»¶ç ´è§£é€†å‘ç¨‹æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚
- æ¯ä¸ªäººçš„ä»£ç ç»„ç»‡ä¼šæœ‰æ‰€å·®å¼‚ï¼Œä¸å„äººçš„æ€ç»´æ–¹å¼ç›´æ¥ç›¸å…³ï¼Œåº”è¯¥å°½é‡å°è¯•ä»£å…¥ä½œè€…çš„æ€ç»´çœ‹å¾…é—®é¢˜ã€‚
- ä¸è¦æƒ³ç€é€šé€æ‰€æœ‰ä»£ç ï¼Œåº”è¯¥è½»é‡åˆ†æ˜ï¼ŒæŠŠæ¡ä¸»çº¿ã€‚é˜…è¯»æºä»£ç å‰å…ˆå»ºç«‹ç›®æ ‡ï¼Œé¿å…è¿‡å¤šå…³æ³¨ä¸ç›¸å…³ä»£ç ã€‚
- é˜…è¯»è¿‡ç¨‹é™·å…¥åœæ»ï¼Œå°±åº”è¯¥æš‚åœä¸€ä¸‹ï¼Œå¯èƒ½æ˜¯æŸäº›ç›¸å…³çš„åŸºç¡€ç¼ºå¤±å¯¼è‡´è¿™ç§ç»“æœï¼Œåº”è¯¥å°†æ—¶é—´ç”¨åœ¨æ‰“åŸºç¡€ä¸Šã€‚
- ä¸è¦å®Œç¾ä¸»ä¹‰ï¼Œä½†å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå…³æ³¨ä¸€æ¯ä¸ªå°é—®é¢˜çš„è§£å†³ã€‚ä¸è¦çº ç»“ç¼ºå¤±ï¼Œå®ƒæ˜¯æä¾›ä¸€ä¸ªæœªæ¥è¿›æ­¥çš„ç©ºé—´ã€‚
- ä¿æŒä½¿ç”¨ç¬”è®°çš„ä¹ æƒ¯ï¼Œç‰¹åˆ«æ˜¯æ–¹ä¾¿å¿«é€Ÿæ£€ç´¢å’ŒåŠ æŸ¥çš„å·¥å…·ã€‚æˆ‘æ¨èå…·æœ‰å¼ºå¤§è·³è½¬åŠŸèƒ½çš„ Sublime Textã€‚
- å°†é˜…è¯»ç»“æœæ•´ç†æˆæµç¨‹å›¾ï¼Œåƒä»¥ä¸‹è¿™ç§ç®€æ´é£æ ¼ ASCII æµç¨‹å›¾æœ€çˆ±ï¼Œå®ƒä¹Ÿæ˜¯ RFC æ–‡æ¡£çš„å›¾è¡¨å·¥å…·ã€‚
- æœ€åï¼Œä»¥å²ä¸ºé•œï¼Œå¯ä»¥çŸ¥å…´è¡°ï¼›ä»¥äººä¸ºé•œï¼Œå¯ä»¥çŸ¥å¾—å¤±ã€‚é‡äº‹ä¸å†³é—®å†å²ã€‚

è®°å¾—ç¬¬ä¸€æ¬¡å°è¯•é˜…è¯»çš„æºä»£ç æ˜¯ Wordpressï¼Œè¿™æ˜¯ä¸€ä¸ª Web å†…å®¹ç®¡ç†å·¥å…·ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯å…ˆè¿‡ä¸€éå®˜æ–¹æ–‡æ¡£ã€‚
å­¦ä¹  Pythonã€Luaã€Vim æˆ–è€… Rust ç­‰ç­‰ï¼Œåœ¨ä¹Ÿä¿æŒåŒæ ·çš„ä¹ æƒ¯ï¼Œå½“ç„¶ï¼Œè¿™å¯èƒ½è¦æ¶ˆè€—å¤§é‡æ—¶é—´ã€‚

ç‰¹åˆ«æ˜¯ä¸€ç‚¹ï¼Œå½“è¿‡ç¨‹è¿›è¡Œä¸ä¸‹å»çš„æ—¶å€™ï¼Œå‡ ä¹å¯ä»¥ç›´æ¥ä¸‹å®šè®ºï¼šä½ å¯èƒ½é‡åˆ°ä¸€ä¸ªå…¨æ–°é¢†åŸŸï¼Œå¯¹æ­¤ï¼Œå¼€å¯ä¸€ä¸ªå­¦ä¹ 
ä¸“é¢˜ï¼Œè¿›è¡Œæ·±å…¥çš„æ¢ç´¢æ‰æ˜¯å‡ºè·¯ã€‚æ²¡æœ‰ä¸€ä¸ªå·¥ç¨‹å¯ä»¥å•é å•ä¸€çš„æŠ€æœ¯å®ç°çš„ï¼Œæ¶‰åŠé¢å¹¿æ³›æ˜¯ä¸€ä¸ªæˆåŠŸé¡¹ç›®çš„æ ‡å¿—ï¼Œ
æ¢ç´¢è¿‡ç¨‹å¸¦æ¥çš„è®¤è¯†æå‡ï¼Œä¹Ÿå°±æ˜¯é˜…è¯»æºä»£ç æ‰€å¸¦æ¥çš„ç»ˆææ•ˆæœã€‚


åœ¨ Godot RPC API ç³»ç»Ÿä¸­ï¼Œ`MultiplayerAPI` å’Œ `MultiplayerPeer` æ˜¯ä¸¤ç§æœ€é‡è¦çš„ç±»å‹ï¼Œå‰è€…
ç”¨æ¥ç®¡ç† RPC åè®®çš„è§„åˆ™ä¸é…ç½®ï¼Œåè€…é€šè¿‡å…·ä½“ç½‘ç»œä¼ è¾“åè®®æä¾›ç½‘ç»œé€šä¿¡æ”¯æŒï¼Œå…¶ä¸­åˆä»¥ ENet åè®®çš„å®ç°
ç±»å‹ `NetworkedMultiplayerENet` æˆ–è€…æ–°ç‰ˆæœ¬ä¸­çš„ `ENetMultiplayerPeer` ä¸ºåŸºç¡€ã€‚


    +================+     +======+             +======+     +================+
    | MultiplayerAPI | --> | Peer | --> UDP --> | Peer | --> | MultiplayerAPI |
    +================+     +======+             +======+     +================+
           â†‘              -------------------------------            â†“
     +============+                                            +============+
     | RPC Client |               ENet Protocol                | RPC Server |
     +============+                                            +============+

<!-- ![RPC](http://waylau.com/images/post/20160630-rpc.png) -->

é€šè¿‡åç»­çš„åˆ†æï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¿™æ ·çš„ä¸€ä¸ª RPC API æ‰§è¡Œé€»è¾‘å›¾ï¼Œè¿™é‡Œå…ˆå±•ç¤ºå‡ºæ¥ã€‚æ­¤å›¾ç®€åŒ–äº†ç½‘ç»œä¼ é€’ï¼Œ
ç€é‡ RPC æ‰§è¡Œè¿‡ç¨‹ã€‚å‘èµ· RPC API è°ƒç”¨è¿‡ç¨‹æ˜¯å·¦ä¾§ ENet Peer Hostï¼Œä»¥ `rpc()` æ–¹æ³•æ‰§è¡Œä¸ºçº¿ç´¢ï¼Œ
å…¶å® `rset()` æœ€åä¹Ÿä¼šæ‰§è¡Œåˆ° `_send_rpc()`ï¼Œç»Ÿä¸€ç”± ENetPeer è¿›è¡Œç½‘ç»œä¼ è¾“ï¼š


              ENet Peer Host                            ENet Peer Host
    +=================================+         +============================+
    |   Nodes in SceneTree            |         |   Nodes in SceneTree       |
    |---------------------------------|         |                            |
    |            rpc() ->  rpcp()     |         |   +===================+    |
    |           get_multiplayer()     |         |   | MultiplayerAPI    |    |
    |----------------v----------------|         |   |-------------------|    |
    |   +=========================+   |         |   |            poll() |-+  |
    |   | MultiplayerAPI          |   |         |   |---------v---------| |  |
    |   |                  rpcp() |   |         |   | _process_packet() | |  |
    |   |------------v------------|   |         |   |---------v---------| |  |
    |   | network_peer            |   |         |   |_process_get_node()| |  |
    |   |       ->get_unique_id() |   |         |   |    _process_rpc() | |  |
    |   | p_node                  |   |         |   |   _process_rset() | |  |
    |   |   ->is_network_master() |   |         |   |---------v---------| |  |
    |   |   ->get_node_rpc_mode() |   |         |   +=========v=========+ |  |
    |   | ->get_script_instance() |   |         |             v           |  |
    |   |        ->get_rpc_mode() |   |         |   ->get_node_rpc_mode() |  |
    |   |------------v------------|   |         | ->get_script_instance() |  |
    |   |             _send_rpc() |   |         |  script->get_rpc_mode() |  |
    |   | network_peer            |   |         |        _can_call_mode() |  |
    |   |   ->set_transfer_mode() |   |         |                ->call() |  |
    |   |  ->_send_confirm_path() |   |         |                         |  |
    |   | =====all_peers_or====== |   |         |   +===================+ |  |
    |   | ======one_by_one======= |   |         |   |   MultiplayerENet | |  |
    |   |     ->set_target_peer() |   |         |   |-------------------| |  |
    |   |          ->put_packet() |>>>>>==ENet  |   |            poll() <-+  |
    |   | ========server========= |   | Socket=>>>>>|          ENetPeer |    |
    |   | ->enet_host_broadcast() |   |         |   +===================+    |
    |   | ========client========= |   |         |                            |
    |   |      ->enet_peer_send() |   |         +============================+
    |   |------------v------------|   |
    |   |    _should_call_local() |   |
    |   | get_network_unique_id() |   |
    |   |------------v------------|   |
    |   | ===call_local_native=== |   |
    |   | p_node                  |   |
    |   |                ->call() |   |
    |   |------------v------------|   |
    |   | ===call_local_script=== |   |
    |   | p_node                  |   |
    |   | ->get_script_instance() |   |
    |   |                ->call() |   |
    |   +=========================+   |
    +=================================+


Birrell å’Œ Nelson åœ¨ 1984 å‘è¡¨äº ACM Transactions on Computer Systems çš„è®ºæ–‡ 
Implementing remote procedure calls å¯¹ Remote Procedure Call Protocol (RPC) 
è¿œç¨‹è¿‡ç¨‹è°ƒç”¨åè®®åšäº†ç»å…¸çš„è¯ é‡Šã€‚å®¢æˆ·ç«¯ç¨‹åºé€è¿‡ç½‘ç»œè°ƒç”¨è¿œç¨‹è®¡ç®—æœºä¸Šçš„å¯¹è±¡ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°åº”ç”¨ç¨‹åºä¸€æ ·ã€‚

ç¬¬ä¸€ä»£ RPC æ˜¯ ONC RPCï¼Œä»¥å‰ç§°ä¸º Sun RPCï¼Œå®ƒæä¾›ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œéœ€è¦ç”¨æˆ·å®šä¹‰ä¸€ä¸ªè¿œç¨‹è¿‡ç¨‹æ¥å£æ¥ç”Ÿæˆ
å®¢æˆ·æœºå’ŒæœåŠ¡å™¨çš„å­˜æ ¹å‡½æ•°ï¼Œclient stubï¼Œè¿™ä¸ªç¼–è¯‘å™¨å«åš rpcgenï¼Œè°·æ­Œçš„ protobuf æ„æ¶ä¹Ÿæ˜¯è¿™ç§ã€‚

ç¬¬äºŒä»£ RPC æ”¯æŒå¯¹è±¡ï¼Œä»¥å¾®è½¯ DCOM(COM+) ä¸ºä»£è¡¨ã€‚é¢å‘å¯¹è±¡çš„è¯­è¨€å¼€å§‹åœ¨ 1980 å¹´ä»£æœ«å…´èµ·ï¼Œå¾ˆæ˜æ˜¾ï¼Œ
å½“æ—¶çš„ Sun ONC å’Œ DCE RPC ç³»ç»Ÿéƒ½æ²¡æœ‰æä¾›ä»»ä½•æ”¯æŒè¯¸å¦‚ä»è¿œç¨‹ç±»å®ä¾‹åŒ–è¿œç¨‹å¯¹è±¡ã€è·Ÿè¸ªå¯¹è±¡çš„å®ä¾‹æˆ–
æä¾›æ”¯æŒå¤šæ€æ€§ã€‚

ç¬¬ä¸‰ä»£ RPC ä»¥ Web Servicesï¼ŒSimple Object Access Protoco (SOAP) ç®€å•å¯¹è±¡è®¿é—®åè®®ä¸ºä»£è¡¨ï¼Œ
æ˜¯ Web å¹³å°ç¼–ç¨‹æµè¡Œçš„äº§ç‰©ã€‚

Enet çœç•¥äº†æŸäº›æ›´é«˜çº§åˆ«çš„ç½‘ç»œåŠŸèƒ½ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ï¼ŒæœåŠ¡å‘ç°ï¼ŒåŠ å¯†æˆ–å…¶ä»–ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„ç±»ä¼¼ä»»åŠ¡ï¼Œ
å› æ­¤è¯¥åº“ä¿æŒçµæ´»ï¼Œå¯ç§»æ¤ä¸”æ˜“äºåµŒå…¥ï¼Œå¹¶å…·ä»¥ä¸‹ä¼˜ç‚¹ï¼š

01. å…‹æœ TCP ä¸æ”¯æŒå¤šä¿¡é“é—®é¢˜ï¼›
02. å…‹æœ TCP éœ€è¦ç”¨æˆ·è‡ªå·±å¤„ç†ç²˜åŒ…é—®é¢˜ï¼ŒUPD æ•°æ®åŒ…åˆ™å…ˆå¤©æœ‰è¾¹ç•Œä¿æŠ¤ï¼›
03. å…‹æœ UDP ä¸æ”¯æŒæ’åºï¼Œè¿æ¥ç®¡ç†ï¼Œå¸¦å®½èµ„æºç®¡ç†ï¼Œæ•°æ®åŒ…çš„å¤§å°æœ‰é™åˆ¶ï¼›
04. Enet åŸºäºå•ä¸€ UDP åè®®å®ç°äº†å…·æœ‰ UDP å’Œ TCP ç­‰ä»·åŠŸèƒ½ï¼Œä½†æ¯”åŒæ—¶é›†æˆä¸¤è€…æ›´å¹²å‡€ã€ç»Ÿä¸€ã€‚

TCP åè®®ç‰¹ç‚¹ï¼š

- TCP åŸºäºè¿æ¥å®ç°å¯é æ€§ä¼ è¾“ï¼Œä½¿å¼€å‘æ›´ä¸ºç®€å•ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥æ•ˆç‡æ…¢çš„ç‰¹ç‚¹ã€‚
- TCP ä¸ºæµé‡è®¾è®¡ï¼Œå¯ä½¿ç”¨æ»‘åŠ¨çª—å£æ§åˆ¶æ¯ç§’å†…å¯ä»¥ä¼ è¾“å¤šå°‘KBçš„æ•°æ®ï¼Œè®²ç©¶çš„æ˜¯å……åˆ†åˆ©ç”¨å¸¦å®½ã€‚
- TCP ä¸ºäº†å¯é æ€§ä½¿ç”¨å¤æ‚çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œ3 æ¬¡æ¡æ‰‹ 4 æ¬¡æŒ¥æ‰‹å»ºç«‹å’Œæ–­å¼€è¿æ¥ã€é‡ä¼ ç­–ç•¥ã€‚
- TCP å†…ç½®åœ¨ç³»ç»Ÿåè®®æ ˆä¸­ï¼Œæéš¾å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚ 

æ»‘åŠ¨çª—å£æ˜¯ä¸€ç§åŸºäºåŒæŒ‡é’ˆçš„ä¸€ç§ç®—æ³•æ€æƒ³ï¼Œä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ ä¹‹é—´å½¢æˆä¸€ä¸ªçª—å£ï¼Œé€šè¿‡è°ƒæ•´çª—å£å¤§å°æ¥æ§åˆ¶
æ•°æ®åŒ…çš„æ•°é‡ï¼Œä»¥å®ç°æµé‡æ§åˆ¶ã€‚çª—å£æœ‰ä¸¤ç±»ï¼Œä¸€ç§æ˜¯å›ºå®šå¤§å°ç±»çš„çª—å£ï¼Œä¸€ç±»æ˜¯å¤§å°åŠ¨æ€å˜åŒ–çš„çª—å£ã€‚

UDP åè®®ç‰¹ç‚¹ï¼š

- UDP åè®®åŸºäº**æ— è¿æ¥**è¿›è¡Œé«˜æ•ˆçš„**ä¸å¯é **æ•°æ®ä¼ è¾“ï¼Œä½†åŒæ—¶åº”ç”¨å±‚æ”¶åˆ°çš„æ•°æ®æœ‰ç¼ºå¤±ã€ä¹±åºç­‰é—®é¢˜ã€‚
- UDP åè®®å¤´å¼€é”€å°ï¼Œä½¿ç”¨ 8 ä¸ªå­—èŠ‚ï¼Œç›¸æ¯” TCP è¦å ç”¨ 20 ä¸ªå­—èŠ‚ã€‚
- UDP é¢å‘æŠ¥æ–‡ï¼Œæœ‰æ•°æ®åŒ…è¾¹ç•Œä¿æŠ¤ã€‚
- UDP æ”¯æŒä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹ä¸€å’Œå¤šå¯¹å¤šçš„äº¤äº’é€šä¿¡ç­‰ã€‚

UDP åè®®ä»¥å…¶ç®€å•ã€ä¼ è¾“å¿«çš„ä¼˜åŠ¿ï¼Œåœ¨è¶Šæ¥è¶Šå¤šåœºæ™¯ä¸‹å–ä»£ TCPï¼Œå¦‚ç½‘é¡µæµè§ˆã€æµåª’ä½“ã€å®æ—¶æ¸¸æˆã€ç‰©è”ç½‘ã€‚

ä»æ•°æ®ç±»å‹å®šä¹‰çš„è§’åº¦æ¥çœ‹ï¼ŒGodot é›†æˆ ENet æºä»£ç ä¸­ï¼š

- æ¯ä¸ªä¸»æœºå¯¹åº” `ENetHost`ï¼šAn ENet host for communicating with peers.
- æ¯ä¸ªè¿æ¥ç«¯å¯¹åº”çš„æ˜¯ `ENetPeer`ï¼š An ENet peer which data packets may be sent or received from. 
- æ¯ä¸ªæ•°æ®åŒ…å¯¹åº” `ENetPacket`ï¼šENet packet structure.
- æ¯ä¸ªæ•°æ®ä¿¡é“å¯¹åº” `ENetChannel`ï¼šENet packet structure.

ENet èµ·æºè‡ª Lee Salzman å¼€å‘çš„ä¸€ä¸ªå…è´¹è”ç½‘ FSP æ¸¸æˆï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯ Cube 2: Sauerbratenï¼Œ
ä¸ºå…¶ç¼–å†™çš„ç½‘ç»œåº“å°±æ˜¯ ENetã€‚

åŸºäº ENet å®ç°çš„å„ç§ RPC API æœ‰ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š

- Reliable å¯é ï¼šå½“å‡½æ•°è°ƒç”¨åˆ°è¾¾æ—¶ï¼Œå°†è¿”å›ç¡®è®¤ï¼›ä¸€å®šæ—¶é—´åæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œåˆ™é‡æ–°å‘é€å‡½æ•°è°ƒç”¨ã€‚
- Unreliable ä¸å¯é ï¼šå‡½æ•°è°ƒç”¨åªå‘é€ä¸€æ¬¡ï¼Œä¸æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ï¼Œæ²¡æœ‰é¢å¤–å¼€é”€ï¼Œå…¸å‹çš„ UPD åè®®é£æ ¼ã€‚

![Client/Server vs. P2P Network](https://cdn.ttgtmedia.com/rms/onlineimages/client_server_vs_p2p_network-f.png)

æœåŠ¡å™¨/å®¢æˆ·ç«¯ç½‘ç»œæ¨¡å‹ Peer-to-Peer æ˜¯ä¸¤ç§å¸¸è§çš„ç½‘ç»œæ¨¡å‹ï¼Œè€Œ P2P åˆ™æ˜¯å»ä¸­å¿ƒåŒ–çš„ç½‘ç»œæ¨¡å‹ã€‚

ENet å¯¹ç­‰ç½‘ä¸­æ‰€æœ‰ä¸»æœºåœ¨åˆ›å»ºè¿æ¥æ—¶éƒ½ä¼šç›¸äº’ç¡®è®¤è¿æ¥ï¼Œè™½ç„¶å»ºç«‹è¿æ¥æ—¶ä¹Ÿéœ€è¦æœåŠ¡å™¨ï¼Œä½†å’Œä¼ ç»Ÿçš„ C/S ç½‘ç»œ
æ„æ¶ä¸åŒï¼ŒENet ä¸­æ˜¯å¯¹ç­‰ç½‘ç»œæ¨¡å‹ã€‚Peer to Peer (P2P) æ‰“ç ´äº†ä¼ ç»Ÿçš„ Client/Server (C/S) æ¨¡å¼ï¼Œ
åœ¨ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹çš„åœ°ä½éƒ½æ˜¯å¯¹ç­‰çš„ã€‚æ¯ä¸ªèŠ‚ç‚¹æ—¢å……å½“æœåŠ¡å™¨ï¼Œä¸ºå…¶ä»–èŠ‚ç‚¹æä¾›æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿäº«ç”¨å…¶ä»–èŠ‚ç‚¹æä¾›
çš„æœåŠ¡ã€‚â€œPeerâ€åœ¨è‹±è¯­é‡Œæœ‰â€œå¯¹ç­‰è€…ã€ä¼™ä¼´ã€å¯¹ç«¯â€çš„æ„ä¹‰ã€‚

æ ¹æ® ENet æ–‡æ¡£æè¿°ï¼Œå…¶åŠŸèƒ½åŒ…æ‹¬ï¼š

- **è¿æ¥ç®¡ç†** Connection Managementï¼šæä¾›ä¸å¤–éƒ¨ä¸»æœºé€šä¿¡çš„æ¥å£ï¼ŒåŠ¨æ€ç›‘ç®¡å¤–éƒ¨ä¸»æœºåŠç½‘ç»œçŠ¶å†µã€‚
- **æ’åº** Sequencingï¼šæä¾›å¤šä¸ªåˆç†æ’åºçš„ç½‘ç»œåŒ…æµè€Œéå•ä¸€æ¯”ç‰¹æµï¼Œä»è€Œç®€åŒ–ä¸åŒç±»å‹æ•°æ®çš„ä¼ è¾“ã€‚
- **é€šé“** Channelsï¼šè¿æ¥å¯ç”¨å¤šä¸ªå…·æœ‰ç½‘ç»œåŒ…ç‹¬ç«‹æ’åºçš„æ•°æ®é€šé“ï¼Œè§£å†³å› æ¨è¿Ÿå¯é ç½‘ç»œåŒ…çš„ä¹±åºæ’åºé—®é¢˜ã€‚
- **å¯é æ€§** Reliabilityï¼šå¯é æ€§æ˜¯å¯é€‰é¡¹ï¼Œå¤–éƒ¨ä¸»æœºåœ¨ç‰¹å®šæ—¶é—´å†…æ²¡æœ‰ç¡®è®¤æ”¶åˆ°ç½‘ç»œåŒ…å°±è§¦å‘é‡ä¼ ã€‚
- **æ‹†åˆ†å’Œé‡ç»„** Fragmentation & Reassemblyï¼šå¤§æ•°æ®åŒ…æ‹†è§£å‘é€ï¼Œåœ¨æ¥æ”¶ç«¯é‡ç»„ï¼Œæ­¤è¿‡ç¨‹è‡ªåŠ¨å®Œæˆã€‚
- **èšåˆ** Aggregationï¼šé›†åˆå¤šä¸ªåè®®æŒ‡ä»¤ï¼Œackï¼Œpacket transfer ç­‰ï¼Œç¡®ä¿å¯ç”¨æ€§ï¼Œå‡å°‘ä¸¢åŒ…åŠå»¶æ—¶ç­‰ã€‚
- **é€‚åº”æ€§** Adaptabilityï¼šä½¿ç”¨åŠ¨æ€é€‚åº”çš„æ•°æ®çª—å£ï¼Œå’Œé™æ€çš„å¸¦å®½åˆ†é…æœºåˆ¶ï¼Œè§£å†³ç½‘ç»œæ‹¥å¡é—®é¢˜ã€‚

ENet ä½œä¸ºä¸€ç§æœ‰ä¼ è¾“ä¿¡é“çš„åè®®ï¼ŒENetHost ä»¥ channelLimit æŒ‡ç¤ºä¿¡é“æ•°é‡ï¼Œå–å€¼èŒƒå›´ [1, 255]ï¼Œ
é»˜è®¤å®šä¹‰äº†ä¸‰ç§ä¸“ç”¨ä¿¡é“ï¼š

- **SYSCH_CONFIG** ç³»ç»Ÿé…ç½®å˜æ›´é€šçŸ¥
- **SYSCH_RELIABLE** å¯é æ¨¡å¼ä¸“ç”¨é€šé“
- **SYSCH_UNRELIABLE** éå¯é æ¨¡å¼é€šé“

ENet åè®®å®šä¹‰äº† 12 æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½ç›¸åº”å®šä¹‰äº†å…¶æ•°æ®ç»“æ„ä½“ï¼Œå…¶ä¸­çš„ï¼š

- Acknowledge ç¡®è®¤æŒ‡ä»¤ï¼Œåœ¨æ”¶åˆ°å¯é åŒ…åç”¨æ¥ç­”å¤å‘é€æ–¹ï¼Œè¡¨æ˜å·²ç»æ”¶åˆ°äº†ç›¸åº”çš„æ•°æ®åŒ…ï¼›
- Ping æŒ‡ä»¤ç”¨äºç›‘æµ‹å¤–éƒ¨ä¸»æœºçš„è¿æ¥çŠ¶æ€ç­‰ç­‰ï¼Œä¸å¿ƒè·³åŒ…å‘é€æ—¶æœºç›¸å…³ï¼›
- connect æŒ‡ä»¤ç”¨äºä¸»åŠ¨å‘èµ·è¿æ¥çš„ä¸€ç«¯è¿›è¡Œä¸»åŠ¨è¿æ¥æ“ä½œ
- Verify Connect å»ºç«‹è¿æ¥æ—¶ï¼Œåœ¨ç¬¬äºŒæ¬¡æ¡æ‰‹ç”¨äºç­”å¤ï¼ŒåŒæ—¶ç”¨äºä¸»åŠ¨è¿æ¥æ–¹åŒæ­¥è¢«åŠ¨è¿æ¥æ–¹çš„ç›¸å…³ä¿¡æ¯ã€‚
- Bandwidth Limit æµé‡é™åˆ¶æŒ‡ä»¤ï¼Œè°ƒèŠ‚å¯¹ç«¯å¯¹åº”æœ¬åœ°çš„ peer çš„å¸¦å®½çš„ç›¸åº”çš„æ•°å€¼ã€‚
- Throttle Configure æµé‡æ§åˆ¶è°ƒæ•´æŒ‡ä»¤ï¼Œç”¨äºè°ƒèŠ‚ç”± RTT æ§åˆ¶çš„ packetThrottle ç›¸å…³è®¾ç½®ã€‚
- Send Reliable å¯é åŒ…å‘é€æŒ‡ä»¤ï¼Œç”¨äºå‘é€ä¸ç”¨åˆ†ç‰‡çš„å¯é åŒ…ï¼Œç›¸åº”çš„æ•°æ®è·Ÿåœ¨æŒ‡ä»¤çš„åé¢ã€‚
- Send Unreliable ä¸å¯é åŒ…å‘é€æŒ‡ä»¤ï¼Œå‘é€ä¸ç”¨åˆ†ç‰‡çš„ä¸å¯é åŒ…ï¼Œä¸ unrealiable åŒ…çš„å®ç°æœºåˆ¶ç›¸å…³ã€‚
- Send Unsequenced æŒ‡ä»¤å‘é€ä¸éœ€è¦åˆ†ç‰‡çš„ Unsequencedï¼Œç”¨ç›¸åº”çš„ unsequencedGroup æ ‡è®°åºå·ã€‚
- Send Fragment æŒ‡ä»¤ç”¨äºå‘é€æ‰€æœ‰éœ€è¦åˆ†ç‰‡çš„æ•°æ®åŒ…ï¼Œé€šè¿‡ flag æ ‡è®° reliable å’Œ unreliable ç­‰ç±»å‹ã€‚

```C++,ignore
    typedef enum _ENetProtocolCommand
    {
       ENET_PROTOCOL_COMMAND_NONE               = 0,
       ENET_PROTOCOL_COMMAND_ACKNOWLEDGE        = 1,
       ENET_PROTOCOL_COMMAND_CONNECT            = 2,
       ENET_PROTOCOL_COMMAND_VERIFY_CONNECT     = 3,
       ENET_PROTOCOL_COMMAND_DISCONNECT         = 4,
       ENET_PROTOCOL_COMMAND_PING               = 5,
       ENET_PROTOCOL_COMMAND_SEND_RELIABLE      = 6,
       ENET_PROTOCOL_COMMAND_SEND_UNRELIABLE    = 7,
       ENET_PROTOCOL_COMMAND_SEND_FRAGMENT      = 8,
       ENET_PROTOCOL_COMMAND_SEND_UNSEQUENCED   = 9,
       ENET_PROTOCOL_COMMAND_BANDWIDTH_LIMIT    = 10,
       ENET_PROTOCOL_COMMAND_THROTTLE_CONFIGURE = 11,
       ENET_PROTOCOL_COMMAND_SEND_UNRELIABLE_FRAGMENT = 12,
       ENET_PROTOCOL_COMMAND_COUNT              = 13,

       ENET_PROTOCOL_COMMAND_MASK               = 0x0F
    } ENetProtocolCommand;

    typedef union _ENetProtocol
    {
       ENetProtocolCommandHeader header;
       ENetProtocolAcknowledge acknowledge;
       ENetProtocolConnect connect;
       ENetProtocolVerifyConnect verifyConnect;
       ENetProtocolDisconnect disconnect;
       ENetProtocolPing ping;
       ENetProtocolSendReliable sendReliable;
       ENetProtocolSendUnreliable sendUnreliable;
       ENetProtocolSendUnsequenced sendUnsequenced;
       ENetProtocolSendFragment sendFragment;
       ENetProtocolBandwidthLimit bandwidthLimit;
       ENetProtocolThrottleConfigure throttleConfigure;
    } ENET_PACKED ENetProtocol;
```

åœ¨åˆ›å»ºæ—¶ï¼ŒENet ä¼šå»ºç«‹ä¸€ä¸ª `ENetHost` ä½œä¸ºé€šä¿¡çš„å®¢æˆ·ç«¯ï¼ŒåŒ…å«ä¸ peer è¿›è¡Œé€šä¿¡çš„ socketã€‚ä½¿ç”¨ä¸€ä¸ª
ENetList dispatchQueue é˜Ÿåˆ—å­˜æ”¾æœ‰äº‹ä»¶äº§ç”Ÿçš„ peersï¼Œè¿˜ä½¿ç”¨ä¸€ä¸ª ENetPeer* peers æ•°ç»„ç”¨äº
å­˜æ”¾ä¸å¤–éƒ¨å®¢æˆ·ç«¯é€šä¿¡çš„ peer æ•°æ®ç»“æ„ã€‚

ENet ä½¿ç”¨æ¯” TCP æ›´è½»é‡çš„ä¸‰æ¬¡æ¡æ‰‹è¿æ¥çš„äºŒæ¬¡æ¡æ‰‹æ–­è¿ï¼Œä½¿ç”¨ verify Connect æŒ‡ä»¤ç¡®è®¤ï¼ŒåŒæ—¶å®ƒç”¨äº
ä¸»åŠ¨è¿æ¥æ–¹åŒæ­¥è¢«åŠ¨è¿æ¥æ–¹çš„ç›¸å…³ä¿¡æ¯ã€‚

ENet åœ¨è¿æ¥å»ºç«‹è¿‡ç¨‹ä¸­å¯ä»¥æ”¹å˜ peer çš„çŠ¶æ€ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

- é¦–å…ˆï¼Œä¸¤ä¸ª host å»ºç«‹è¿æ¥å‰éœ€è¦ä¿è¯ peers æ•°ç»„å†…æœ‰ç©ºé—²çš„ peerï¼Œå…¶çŠ¶æ€ä¸º `disconnected`ã€‚
- ä¸»åŠ¨è¿æ¥æ–¹ä½¿ç”¨ç©ºé—² peer å‘å¯¹ç«¯å‘é€ `connect` æŒ‡ä»¤ï¼ŒçŠ¶æ€å˜ä¸º `connecting`ã€‚
- å¯¹ç«¯æ¥æ”¶åˆ° `connect` æŒ‡ä»¤åï¼Œè¿”å› `verify connect` æŒ‡ä»¤ä½œä¸ºç­”å¤ï¼ŒçŠ¶æ€å˜ä¸º ack connectã€‚
- ä¸»åŠ¨è¿æ¥æ–¹æ”¶åˆ° `verify connect` æŒ‡ä»¤åï¼Œå¹¶ç­”å¤ä¸€ä¸ª ack æŒ‡ä»¤ï¼Œå…¶çŠ¶æ€å˜ä¸º `connected`ï¼Œè¿æ¥å»ºç«‹ã€‚
- å¹¶ä¸”ï¼Œå‘ç”¨æˆ· dispatch ä¸€ä¸ª **connect event** äº‹ä»¶ã€‚
- å¯¹ç«¯æ¥æ”¶åˆ° ack å‘½ä»¤åï¼ŒçŠ¶æ€å˜ä¸º `connnected`ï¼ŒåŒæ–¹è¿æ¥å»ºç«‹å®Œæˆã€‚
- å¹¶ä¸”ï¼ŒåŒæ ·å‘ç”¨æˆ· dispatch ä¸€ä¸ª **connect event** äº‹ä»¶ã€‚

è‡³æ­¤ï¼ŒåŒæ–¹è¿æ¥å»ºç«‹å®Œæˆã€‚

ENet æä¾›äº†ä¸‰ç§æ–­å¼€è¿æ¥çš„æ–¹å¼ï¼šdisconnect, disconneted now å’Œ disconnect laterã€‚

åœ¨æ–­å¼€è¿æ¥å†å‘èµ·æ—¶ï¼Œå‡ºç°æ–°æ—§ä¸¤ä¸ªè¿æ¥çš„ç«¯å£å·ç›¸åŒçš„æƒ…å†µï¼Œä¼šè¢«åˆ¤å®šä¸ºç›¸åŒçš„è¿æ¥ï¼ŒENet ä½¿ç”¨ SessionID
é˜²æ­¢ä¸¤ä¸ªå…·æœ‰ç›¸åŒ IP åœ°å€å’Œç«¯å£å·çš„å‰åä¸¤æ¬¡è¿æ¥å‘é€çš„æ•°æ®å‘ç”Ÿæ··æ·†ã€‚è€Œ TCP åè®®ä¼šä½¿ä¸»åŠ¨æ–­å¼€è¿æ¥çš„ä¸€æ–¹
å¤„äº TIME_WAIT çš„çŠ¶æ€æ¥é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚

ä½†æ˜¯ï¼Œè¿™åªæ˜¯ç®€å•çš„ ID åŒ¹é…ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½åƒ TCP 100% é˜²æ­¢ä¸¤æ¬¡è¿æ¥ä¸­æ•°æ®åŒ…æ··æ·†è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œä½†æ˜¯
å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»æ˜¯æœ‰æ•ˆçš„ã€‚

ENet é‡‡ç”¨çš„æ˜¯é€‰æ‹©é‡ä¼ çš„æ–¹å¼ï¼Œä¸ºä¿è¯æ–°æ—§çª—å£çš„åºå·æ²¡æœ‰é‡å ï¼Œçª—å£çš„æœ€å¤§å°ºå¯¸ä¸åº”è¯¥è¶…è¿‡åºå·ç©ºé—´çš„ä¸€åŠã€‚
ENet åœ¨å‘é€æ–°çš„æ•°æ®åŒ…æ—¶ä¼šé€šè¿‡**usedReliableWindows**åˆ¤æ–­å½“å‰çª—å£å ç”¨æ˜¯å¦ä¸ç©ºé—²çª—å£é‡å ï¼Œå¦‚æœ
é‡å åˆ™æš‚åœæ•°æ®åŒ…çš„å‘é€ã€‚reliableWindows ä¼šè®°å½•å„ä¸ªçª—å£ä¸­ç›®å‰åœ¨ä¼ è¾“ä¸­çš„åŒ…çš„ä¸ªæ•°ã€‚

æ›´è¿›ä¸€æ­¥ï¼ŒENet æä¾›äº†ä¸€ä¸ªåŠ¨æ€çš„é˜€é—¨ï¼Œpacket throttleï¼Œæ¥å“åº”ç½‘ç»œè¿æ¥æ—¶å¸¦æ¥çš„åå·®ï¼Œé€šè¿‡é™åˆ¶åŒ…çš„
å‘é€æ•°é‡æ¥åº”å¯¹å„ç§ç±»å‹çš„ç½‘ç»œæ‹¥å¡é—®é¢˜ã€‚

ç½‘ç»œçŠ¶å†µè¯„ä¼°æŒ‡æ ‡ï¼š

    RTTV[n] = RTTV[n-1]* 3/4 + (RTT[n] - RTTS[n-1])1/4
    RTTS[n] = RTTS[n-1] * 7/8 +RTT[n]* 1/8
    RTO Limitï¼š Min(30, Max(5, RTO * 32))

- Round-Trip Time (RTT) å¾€è¿”æ—¶å»¶ï¼Œæ˜¯æŒ‡æ•°æ®ä»ç½‘ç»œä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´ã€‚
- RTT smoothed (RTTs) å•ä½æ—¶é—´å†… RTT åŠ æƒå¹³å‡å€¼ã€‚
- RTT variance (RTTv) å•ä½æ—¶é—´å†… RTT åå·®åŠ æƒå¹³å‡å€¼ã€‚
- Retransmission TimeOut (RTO) é‡ä¼ è¶…æ—¶æ—¶é—´ã€‚åˆå§‹ RTO = RTTs + 4RTTv

åˆå§‹è¶…æ—¶é‡ä¼ æ—¶é—´ RTO = RTTs+4RTTvï¼Œä¸‹æ¬¡è¶…æ—¶é‡ä¼ æ—¶é—´æ˜¯ä¸Šä¸€æ¬¡é‡ä¼ æ—¶é—´çš„ä¸¤å€ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡ 500msã€‚
è¶…æ—¶æ–­å¼€åˆ¤å®šä½¿ç”¨å¿ƒè·³ä¿¡å·ï¼Œå³åœ¨æ²¡æœ‰å‘é€æ•°æ®åŒ…çš„çŠ¶æ€ï¼Œè¶…è¿‡ 500ms å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³åŒ…ã€‚

æ–­å¼€è¿æ¥åˆ¤å®šæ¡ä»¶ï¼š currentTime-earliestTimeout > RTO Limitã€‚


ä¸ºäº†å¯¹ ENet çš„æºä»£ç ä½œä¸€ç®¡ä¸­çª¥è±¹ä¹‹ä¸¾ï¼Œè¿™é‡Œä»¥ Unique ID ä»¥åŠå®ƒåœ¨æ¥æ”¶ç«¯çš„èº«ä»½ Sender ID ä½œä¸º
Godot é›†æˆçš„ ENet æºä»£ç é˜…è¯»çº¿ç´¢ï¼Œå¯¹æ¶‰åŠçš„å…³é”®å†…å®¹è¿›è¡Œæ¢³ç†ã€‚

Godot ä½¿ç”¨ C++ å°è£…äº†åŸºäº C è¯­è¨€çš„ ENetï¼Œæ•´ä¸ªæ„æ¶å°è£…åœ¨ NetworkedMultiplayerENet ç±»å‹ä¸­ã€‚
è€Œ ENet æºä»£ç å­˜æ”¾åœ¨ç¬¬ä¸‰æ–¹ç›®å½•ä¸‹ã€‚

ENet å®šä¹‰äº†å››ç§äº‹ä»¶ï¼Œä½¿ç”¨ I/O äº‹ä»¶è½®è¯¢æ¨¡å‹ï¼Œå°è£…åœ¨ NetworkedMultiplayerENet::poll()ã€‚å½“æ–°
è¿æ¥è¯·æ±‚åˆ°æ¥ï¼Œæ ¹æ®è¯»å–åˆ°çš„ peer idï¼Œåˆ†åˆ«è§¦å‘è¿æ¥çŠ¶æ€ä¿¡å·ã€‚åœ¨æœåŠ¡å™¨ç«¯ä¸è§¦å‘è¿æ¥æˆåŠŸä¿¡å·ï¼Œä½†ä¼šå‘å½“å‰
æ‰€æœ‰å·²è¿æ¥çš„ peers å‘é€é€šå‘Šã€‚å°†æ–°åŠ å…¥ peer é€šå‘Šç»™å·²æœ‰çš„ peersï¼Œåè¿‡æ¥åˆå°†å·²æœ‰çš„ peers é€šå‘Šç»™
æ–°åŠ å…¥çš„ peerï¼Œè¿™ç§åŒå‘çš„æ“ä½œä½“ç°äº†å¯¹ç­‰ç½‘çš„åŸºæœ¬ç‰¹å¾ï¼š

```C++,ignore
    // godot\modules\enet\networked_multiplayer_enet.h
    void NetworkedMultiplayerENet::poll() {
        // ...
        ENetEvent event;
        int ret = enet_host_service(host, &event, 0);
        // ...
        /* Keep servicing until there are no available events left in the queue. */
        do {
            if (!host || !active) { // Check again after every event
                return;
            }
            switch (event.type) {
                case ENET_EVENT_TYPE_CONNECT: {
                    // ...
                    int *new_id = memnew(int);
                    *new_id = event.data;

                    // Data zero is sent by server. Server is always 1.
                    if (*new_id == 0) { 
                        *new_id = 1;
                    }

                    event.peer->data = new_id;

                    peer_map[*new_id] = event.peer;

                    // If connecting, this means it connected to something!
                    connection_status = CONNECTION_CONNECTED; 
                    emit_signal("peer_connected", *new_id);
                    // ...
                    if (server) {
                        for (Map<int, ENetPeer *>::Element *E = peer_map.front(); E; E = E->next()) {
                            if (E->key() == *new_id) {
                                continue;
                            }
                            // Someone connected, notify all the peers available
                            // 1. Send existing peers to new peer
                            // 2. Send the new peer to existing peers
                            // ...
                            packet = enet_packet_create(nullptr, 8, ENET_PACKET_FLAG_RELIABLE);
                            encode_uint32(SYSMSG_ADD_PEER, &packet->data[0]);
                            //encode_uint32(E->key(), &packet->data[4]);
                            encode_uint32(*new_id, &packet->data[4]);
                            enet_peer_send(E->get(), SYSCH_CONFIG, packet);
                        }
                    } else {
                        emit_signal("connection_succeeded");
                    }
                } break;
                case ENET_EVENT_TYPE_DISCONNECT: {
                    // ...
                    if (!server) {
                        emit_signal("connection_failed");
                    }
                    // ...
                    if (!server) {
                        // Client just disconnected from server.
                        emit_signal("server_disconnected");
                        close_connection();
                        return;
                    } else if (server_relay) {
                        // Server just received a client disconnect and is in 
                        // relay mode, notify everyone else.
                    }
                    emit_signal("peer_disconnected", *id);

                } break;
                case ENET_EVENT_TYPE_RECEIVE: {
                    if (event.channelID == SYSCH_CONFIG) {
                        // Some config message
                        // ...
                        switch (msg) {
                            case SYSMSG_ADD_PEER: {
                                peer_map[id] = NULL;
                                emit_signal("peer_connected", id);

                            } break;
                            case SYSMSG_REMOVE_PEER: {
                                peer_map.erase(id);
                                emit_signal("peer_disconnected", id);
                            } break;
                        }

                        enet_packet_destroy(event.packet);
                    }
                } break;
                case ENET_EVENT_TYPE_NONE: {
                    // Do nothing
                } break;
            }
        } while (enet_host_check_events(host, &event) > 0);
    }
```

åœ¨æ¥æ”¶æ•°æ®é˜¶æ®µï¼Œä¹Ÿä¼šè§¦å‘ peer çš„è¿æ¥ä¸æ–­å¼€ä¿¡å·ï¼Œå¯¹åº” SYSCH_CONFIG ä¿¡é“å‘é€çš„ SYSMSG_ADD_PEER
å’Œ SYSMSG_REMOVE_PEER ä¸¤ç§é…ç½®æ¶ˆæ¯ã€‚æ¥æ”¶çš„æ•°æ®ä¿å­˜åˆ° **incoming_packets**ï¼Œç¨åå°±å¯ä»¥ä½¿ç”¨å®ƒã€‚


NetworkedMultiplayerPeer ä¸­å®šä¹‰çš„ get_unique_id() æ–¹æ³•æ˜¯ä¸€ä¸ªçº¯è™šå‡½æ•°ï¼Œå®ƒéœ€è¦ç”±å­ç±»æ ¹æ®å…·ä½“
åè®®æ¥å®ç°ï¼Œä¾‹å¦‚ NetworkedMultiplayerENet çš„å®ç°ä¸­ï¼Œå°±ä½¿ç”¨ 1 ä»£è¡¨æœåŠ¡å™¨ã€‚è€Œåˆ›å»ºæœåŠ¡å™¨æ—¶ï¼Œå°±æ ¹æ®
æ—¶é’ŸåŠ ç”¨æˆ·ç›®å½•ã€æ•°æ®æŒ‡é’ˆåœ°å€ç­‰ç”Ÿæˆä¸€ä¸ª IDï¼Œä½¿ç”¨çš„ç®—æ³•æ˜¯ Hash Djb 2ï¼š

```C++,ignore
    // godot\core\io\networked_multiplayer_peer.h

    virtual int get_unique_id() const = 0;

    // godot\modules\enet\networked_multiplayer_enet.h

    int NetworkedMultiplayerENet::get_unique_id() const {
        return unique_id;
    }

    Error NetworkedMultiplayerENet::create_client(
        const String &p_address, int p_port, 
        int p_in_bandwidth, int p_out_bandwidth, int p_client_port) {
        // ...
        unique_id = _gen_unique_id();
    }

    uint32_t NetworkedMultiplayerENet::_gen_unique_id() const {
        uint32_t hash = 0;

        while (hash == 0 || hash == 1) {
            hash = hash_djb2_one_32(
                    (uint32_t)OS::get_singleton()->get_ticks_usec());
            hash = hash_djb2_one_32(
                    (uint32_t)OS::get_singleton()->get_unix_time(), hash);
            hash = hash_djb2_one_32(
                    (uint32_t)OS::get_singleton()->get_user_data_dir().hash64(), hash);
            hash = hash_djb2_one_32(
                    (uint32_t)((uint64_t)this), hash); // Rely on ASLR heap
            hash = hash_djb2_one_32(
                    (uint32_t)((uint64_t)&hash), hash); // Rely on ASLR stack

            // Make it compatible with unsigned, since negative ID is used for exclusion
            hash = hash & 0x7FFFFFFF; 
        }

        return hash;
    }

    static inline uint32_t hash_djb2_one_32(uint32_t p_in, uint32_t p_prev = 5381) {
        return ((p_prev << 5) + p_prev) + p_in;
    }
```

è§¦å‘ `peer_connected` ä¿¡å·æ—¶ï¼Œæˆ–è€…è‡ªå·±ç»™è‡ªå·±å‘é€ RPC è°ƒç”¨æ—¶ï¼Œget_rpc_sender_id() è¿”å›å€¼ä¸º 0ã€‚
Godot 3.5 ä¸­å¦‚æœé…ç½®é”™è¯¯ä¼šå¯¼è‡´ ScreenTree è·å–åˆ°çš„å‘é€æ–¹ ID æ€»æ˜¯ä¸º 0ï¼Œå®ƒåˆç›´æ¥åŒ…è£…è°ƒç”¨ MultiplayerAPI çš„
get_rpc_sender_id() æ–¹æ³•è·å– peer IDï¼Œè€Œåè€…ç›´æ¥è¿”å›æ•°æ®æˆå‘˜ `rpc_sender_id`ã€‚è¿™ä¸ªå€¼ä¼šåœ¨
MultiplayerAPI æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ä¸º 0ã€‚


MultiplayerAPI æœ‰å¤šä¸ªä½ç½®æ¶‰åŠ rpc_sender_id çš„è¯»å†™ï¼š

- **MultiplayerAPI::MultiplayerAPI()** æ„é€ å™¨ä¸­åˆå§‹åŒ–ä¸º 0 å€¼ï¼›
- æ‰§è¡Œ `poll()` æ–¹æ³•è½®è¯¢æ•°æ®æ—¶ï¼Œ`get_packet_peer()` è·å– IDï¼›
- **MultiplayerAPI::rpcp()** æ‰§è¡Œè¿œç¨‹è°ƒç”¨ï¼›
- **MultiplayerAPI::rsetp()** æ‰§è¡Œè¿œç¨‹å±æ€§è®¾ç½®ï¼›

ä¸€èˆ¬åŒä¸ç›´æ¥è°ƒç”¨ NetworkPeer `poll()` æ–¹æ³•ï¼Œè€Œæ˜¯é€šè¿‡ MultiplayerAPI æ ¹æ®å½“å‰è”æ¥çŠ¶æ€è°ƒç”¨å®ƒã€‚

ENet æ¥æ”¶åˆ°çš„æ•°æ®ä¼šä¿å­˜åˆ° **incoming_packets**ï¼Œå…¶ä¸­å°±åŒ…å« sender idï¼Œ`get_packet_peer()` 
å°±å¯ä»¥æŸ¥è¯¢æ•°æ®åŒ…ä¸­çš„è¿™ä¸ª IDï¼Œåœ¨è½®è¯¢æ—¶ï¼Œè¿™ä¸ª ID ä¼šåœ¨ `_process_packet()` æœŸé—´ç”Ÿæ•ˆã€‚æ ¹æ®æ•°æ®åŒ…
æŒ‡å®šçš„å‘½ä»¤ï¼Œæ•°æ®åŒ…å¤„ç†å‡½æ•°ä¼šè¿›è¡Œç›¸åº”æ“ä½œï¼ŒGodot å°†è¿™äº›å‘½ä»¤å®šä¹‰åœ¨æšä¸¾ç±»å‹ `NetworkCommands`ï¼Œå¯¹åº”
å„ç§ RPC è¡Œä¸ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦è¯»å– sender idï¼Œå°±åº”è¯¥åœ¨æ‰§è¡Œ REMOTE_CALL å’Œ REMOTE_SET ä¸¤ä¸ªå‘½ä»¤
æœŸé—´è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯è¿œç«¯ RPC è¿œç¨‹è°ƒç”¨æ–¹æ³•æ‰§è¡Œæ—¶ã€‚

å…¶ä¸­çš„ RAW å‘½ä»¤æ˜¯æ›´ä½å±‚çš„æ•°æ®æ¥æ”¶å¤„ç†ï¼Œä¼šè§¦å‘ **network_peer_packet** ä¿¡å·ï¼Œè®©ç”¨æˆ·æœ‰æœºä¼šå‚ä¸ã€‚


```C++,ignore
    // godot\modules\multiplayer\scene_multiplayer.h
    // godot-3.5.1-stable\core\io\multiplayer_api.h:113
    enum NetworkCommands {
        NETWORK_COMMAND_REMOTE_CALL,
        NETWORK_COMMAND_REMOTE_SET,
        NETWORK_COMMAND_SIMPLIFY_PATH,
        NETWORK_COMMAND_CONFIRM_PATH,
        NETWORK_COMMAND_RAW,
    };

    // godot\modules\multiplayer\scene_multiplayer.cpp
    // godot-3.5.1-stable\core\io\multiplayer_api.cpp
    void MultiplayerAPI::poll() {
        // ...
        network_peer->poll();
        // ...
        while (network_peer->get_available_packet_count()) {
            int sender = network_peer->get_packet_peer();
            // ...
            Error err = network_peer->get_packet(&packet, len);
            // ...
            rpc_sender_id = sender;
            _process_packet(sender, packet, len);
            rpc_sender_id = 0;
            // ...
        }
    }

    void MultiplayerAPI::_process_raw(int p_from, const uint8_t *p_packet, int p_packet_len) {
        PoolVector<uint8_t> out;
        int len = p_packet_len - 1;
        out.resize(len);
        {
            PoolVector<uint8_t>::Write w = out.write();
            memcpy(&w[0], &p_packet[1], len);
        }
        emit_signal("network_peer_packet", p_from, out);
    }
```

å°†å…³æ³¨ç‚¹è½¬åˆ° process packet çš„éƒ¨åˆ†æ¥ï¼Œå®ƒæ‰æ˜¯ Godot 3.x RPC è¿œç¨‹è°ƒç”¨çš„ç»ˆç‚¹ç«™ã€‚åœ¨è¿™é‡Œï¼Œä¼šè§¦å‘
Godot 3.x ä¸¤ç±»è¿œç¨‹è°ƒç”¨çš„å“åº”æ–¹æ³•ï¼Œå³ `rpc()` å’Œ `rset()` ä¸¤è€…è°ƒç”¨çš„è¿œç¨‹æ–¹æ³•ã€‚

RPC æ‰§è¡Œåˆ° `_process_rpc()` æˆ–è€… `_process_rset()` å°±è¦è¿›è¡Œé‰´æƒï¼Œå¦‚æœèŠ‚ç‚¹æ²¡æœ‰ç›¸åº”çš„æƒé™ï¼Œ
åˆ™ä¸ç»™äºˆæ‰§è¡Œï¼Œè¿˜è¦æ£€æµ‹æ•°æ®åŒ…æ˜¯å¦æœ‰é—®é¢˜ç­‰ç­‰ï¼Œå¹¶æç¤ºé”™è¯¯ä¿¡æ¯ã€‚`_can_call_mode()` æ–¹æ³•éªŒè¯ RPC
é…ç½®ä¸èŠ‚ç‚¹è®¾ç½®æ˜¯å¦å¯¹åº”ï¼š

```C++,ignore
void MultiplayerAPI::_process_packet(int p_from, const uint8_t *p_packet, int p_packet_len) {
    // ...
    uint8_t packet_type = p_packet[0];

    switch (packet_type) {
        // ...
        case NETWORK_COMMAND_REMOTE_CALL:
        case NETWORK_COMMAND_REMOTE_SET: {

            Node *node = _process_get_node(p_from, p_packet, p_packet_len);
            // ...
            StringName name = String::utf8((const char *)&p_packet[5]);

            if (packet_type == NETWORK_COMMAND_REMOTE_CALL) {
                _process_rpc(node, name, p_from, p_packet, p_packet_len, len_end + 1);
                // --> bool can_call = _can_call_mode(p_node, rpc_mode, p_from);
            } else {
                _process_rset(node, name, p_from, p_packet, p_packet_len, len_end + 1);
            }
        } break;
        // ...
    }
}

void MultiplayerAPI::_process_rpc(Node *p_node, const StringName &p_name, int p_from, const uint8_t *p_packet, int p_packet_len, int p_offset) {

    // Check that remote can call the RPC on this node.
    RPCMode rpc_mode = RPC_MODE_DISABLED;
    const Map<StringName, RPCMode>::Element *E = p_node->get_node_rpc_mode(p_name);
    if (E) {
        rpc_mode = E->get();
    } else if (p_node->get_script_instance()) {
        rpc_mode = p_node->get_script_instance()->get_rpc_mode(p_name);
    }

    bool can_call = _can_call_mode(p_node, rpc_mode, p_from);

    int argc = p_packet[p_offset];
    // ...
    p_offset++;

    for (int i = 0; i < argc; i++) {

        int vlen;
        Error err = decode_variant(args.write[i], &p_packet[p_offset], p_packet_len - p_offset, &vlen, allow_object_decoding || network_peer->is_object_decoding_allowed());
        ERR_FAIL_COND_MSG(err != OK, "Invalid packet received. Unable to decode RPC argument.");

        argp.write[i] = &args[i];
        p_offset += vlen;
    }
    // ...
    p_node->call(p_name, (const Variant **)argp.ptr(), argc, ce);
    // ...
}

_FORCE_INLINE_ bool _can_call_mode(Node *p_node, MultiplayerAPI::RPCMode mode, int p_remote_id) {
    switch (mode) {
        case MultiplayerAPI::RPC_MODE_DISABLED: {
            return false;
        } break;
        case MultiplayerAPI::RPC_MODE_REMOTE:
        case MultiplayerAPI::RPC_MODE_REMOTESYNC: {
            return true;
        } break;
        case MultiplayerAPI::RPC_MODE_MASTERSYNC:
        case MultiplayerAPI::RPC_MODE_MASTER: {
            return p_node->is_network_master();
        } break;
        case MultiplayerAPI::RPC_MODE_PUPPETSYNC:
        case MultiplayerAPI::RPC_MODE_PUPPET: {
            return !p_node->is_network_master() && p_remote_id == p_node->get_network_master();
        } break;
    }

    return false;
}
```

é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°å¼€å§‹å±•ç¤ºçš„ RPC API æ‰§è¡Œé€»è¾‘å›¾ï¼Œç®€åŒ–äº†ç½‘ç»œä¼ é€’ï¼Œç€é‡ RPC æ‰§è¡Œè¿‡ç¨‹ã€‚
ä»å‘èµ· RPC API è°ƒç”¨ `rpc()` æ–¹æ³•ï¼Œåˆ°è¿œç«¯æ‰§è¡Œä¸ºçº¿ç´¢ï¼Œ`rset()` æœ€åä¹Ÿä¼šæ‰§è¡Œåˆ° `_send_rpc()`ï¼Œ
ä¸€ç”± ENetPeer è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚


æ‰§è¡Œåˆ° MultiplayerEnet çš„ `put_packet()` æ–¹æ³•åï¼Œå°±å³å°†è¿›å…¥ ENet æºä»£ç çš„ C APIï¼Œå…¶ä¸­æœ‰
`enet_peer_send()` å’Œ `enet_host_broadcast()`ï¼Œåˆ†åˆ«ç”¨äºå•ç«¯æ¶ˆæ¯å’Œå¹¿æ’­æ¶ˆæ¯çš„å‘é€ã€‚

å¦å¤–ä¸€ä¸ªè·¯çº¿æ˜¯ rset() -> rsetp()ï¼Œå¤§ä½“ä¸Šæµç¨‹ä¸€è‡´ã€‚

åœ¨æ•°æ®ç»ç½‘ç»œä¼ è¾“ä¹‹å‰æˆ–æ¥æ”¶åˆ°æ•°æ®ï¼Œéœ€è¦ç›¸åº”è°ƒç”¨ `encode_variant()` å’Œ `decode_variant()` 
è¿›è¡Œç±»å‹è¿›åˆ¶åˆ¶è¡¨è¾¾è½¬æ¢ï¼Œæ¶‰åŠåˆ°å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ŒSerialization vs. Deserializationã€‚
Go è¯­è¨€ä¸­åˆç§°ä¸º marshalling å’Œ unmarshallingã€‚è¿™æ˜¯ä¸€ä¸ªæ–°çš„é¢†åŸŸï¼Œå¯ä»¥å¼€å¯å¦ä¸€ä¸ªä¸“é¢˜è¿›è¡Œæ¢ç´¢ã€‚

æºä»£ç æ–‡ä»¶å‚è€ƒï¼š

- godot-3.5.1-stable\core\io\marshalls.h
- godot-3.5.1-stable\scene\main\node.cpp
- godot-3.5.1-stable\core\io\multiplayer_api.cpp@_send_rpc
- godot-3.5.1-stable\modules\enet\networked_multiplayer_enet.cpp@put_packet
- godot-3.5.1-stable\thirdparty\enet\peer.c@enet_peer_send
- godot-3.5.1-stable\thirdparty\enet\host.c@enet_host_broadcast
- godot-3.5.1-stable\core\io\packet_peer.h
- godot-3.5.1-stable\core\io\packet_peer_udp.cpp
- godot\core\io\net_socket.h
- godot\core\io\marshalls.cpp
- godot\scene\main\multiplayer_api.cpp
- godot\modules\multiplayer\scene_multiplayer.h
- godot\modules\multiplayer\scene_rpc_interface.h
- godot\core\io\packet_peer.h
- godot\modules\multiplayer\scene_cache_interface.h


### ğŸŸ ğŸ”µ Custom MultiplayerAPI 3.x
- https://godotforums.org/d/32791-invalid-packet-received-tries-to-confirm-a-path-which-was-not-found-in-cache
- https://github.com/godotengine/godot/issues/73194

Node èŠ‚ç‚¹æä¾› `set_custom_multiplayer()` ç”¨æ¥æŒ‡å®šç”¨æˆ·è‡ªå®šä¹‰çš„ MultiplayerAPI å¯¹è±¡ï¼Œä¸ºå…¶
è®¾ç½®æ ¹èŠ‚ç‚¹èƒ½æœ‰æ•ˆåœ°ä½¿ç”¨ä¸åŒçš„ MultiplayerAPI ç®¡ç†åœºæ™¯æ ‘çš„ä¸åŒåˆ†æ”¯ï¼Œä¾‹å¦‚ï¼Œå…è®¸åœ¨åŒä¸€åœºæ™¯ä¸­è¿è¡Œ
å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚

æ³¨æ„ `set_root_node()` æŒ‡å®šçš„æ ¹èŠ‚ç‚¹ï¼ŒRPC æœºåˆ¶å°†ä½¿ç”¨ç›¸å¯¹å®ƒçš„è·¯å¾„è€Œä¸æ˜¯ç»å¯¹è·¯å¾„æ¥æŸ¥æ‰¾åº”è¯¥åœ¨å…¶ä¸Š
æ‰§è¡Œ RPC çš„èŠ‚ç‚¹ã€‚æ¯”å¦‚ï¼Œæœ‰è¿™æ ·çš„èŠ‚ç‚¹è·¯å¾„ï¼Œ/main/testï¼Œå¹¶ä¸” RPC æ–¹æ³•å®šä¹‰åœ¨ test èŠ‚ç‚¹ä¸Šã€‚é‚£ä¹ˆè®¾ç½®
æ ¹èŠ‚ç‚¹æ—¶ï¼Œå°±è¦æŒ‡å®š main èŠ‚ç‚¹ï¼Œè€Œä¸èƒ½æŒ‡å®š test ä¸ºæ ¹èŠ‚ç‚¹ï¼Œè¿™æ ·ä¼šå¯¼è‡´å®šä½ä¸åˆ°ã€‚

æ³¨æ„ï¼Œä½¿ç”¨è½®è¯¢æ–¹æ³•åº”è¯¥å¯¹ multiplayer_poll å±æ€§åšåˆ¤æ–­ï¼Œå½“ ScreenTree ç¦æ­¢æ•°æ®è½®è¯¢å°±åº”è¯¥åœä¸‹æ¥ã€‚

è§¦å‘ `peer_connected` ä¿¡å·æ—¶ï¼Œæˆ–è€…è‡ªå·±ç»™è‡ªå·±å‘é€ RPC è°ƒç”¨æ—¶ï¼Œget_rpc_sender_id() è¿”å›å€¼ä¸º 0ã€‚
ä½†æ˜¯ Godot 3.5 ä¸­ ScreenTree è·å–åˆ°çš„å‘é€æ–¹ ID æ€»æ˜¯ä¸º 0ã€‚ä»€ä¹ˆæƒ…å†µç®—æ˜¯è‡ªå·±ç»™è‡ªå·±å‘ RPC è°ƒç”¨å‘¢ï¼Ÿ

æ¯”å¦‚è¯´ï¼Œå®šä¹‰ä¸€ä¸ª `sync func test()` æ–¹æ³•ï¼Œsync ç­‰ä»·äº remotesyncï¼Œä¼šåœ¨è§¦å‘ RPC è°ƒç”¨çš„ä¸»æœº
ä¸Šæ‰§è¡Œï¼Œä¹Ÿä¼šåœ¨æ‰€æœ‰è¿œç¨‹ç«¯æ‰§è¡Œã€‚é‚£ä¹ˆå¯¹äºè°ƒç”¨ `rpc("test")` çš„ä¸»æœºï¼Œæ‰§è¡Œè¿™ä¸ªå‡½æ•°æ—¶ï¼Œå°±æ˜¯è‡ªå·±ç»™è‡ªå·±
å‘é€ RPC è°ƒç”¨ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ**SceneTree** get_rpc_sender_id() æ€»æ˜¯è¿”å› 0 å€¼ã€‚å…¶å®ƒä¸»æœºä¸Šåˆ™ç›¸åï¼Œ
**MultiplayerAPI** get_rpc_sender_id() æ€»æ˜¯è¿”å› 0 å€¼ã€‚

å¯¹äº sender id è¿™ä¸ªè·å–æ–¹æ³•ï¼Œæ–‡æ¡£ä¸­çš„æè¿°ï¼Œè‚¯å®šæ˜¯è¦åœ¨ RPC è°ƒç”¨æ—¶æ‰æœ‰æ•ˆï¼š

- **SceneTree**: Returns the sender's peer ID for the most recently received RPC call.
- **MultiplayerAPI** Returns the sender's peer ID for the RPC currently being executed.

ScreenTree è·å–å‘é€æ–¹ peer ID çš„æ–¹æ³•ç›´æ¥åŒ…è£…è°ƒç”¨ MultiplayerAPI çš„ get_rpc_sender_id() 
æ–¹æ³•ï¼Œè€Œåè€…ç›´æ¥è¿”å›æ•°æ®æˆå‘˜ `rpc_sender_id`ã€‚è¿™ä¸ªå€¼ä¼šåœ¨ MultiplayerAPI æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ä¸º 0ï¼Œ
åœ¨ MultiplayerAPI æ‰§è¡Œ `poll()` æ–¹æ³•è½®è¯¢æ•°æ®æ—¶ï¼Œä¸´æ—¶ç”¨ `get_packet_peer()` å»è·å–å½“å‰æ­£åœ¨
æ“ä½œä¸­çš„ä¸»æœº IDã€‚

ä½†æ˜¯ç”¨æ¥è·å–å½“å‰ä¸»æœº ID æ–¹æ³•é€»è¾‘ä¸åŒï¼Œget_network_unique_id() ç­‰ä»·äº get_unique_id()ï¼Œæ— è®ºæ˜¯
ScreenTree åŒ…è£… MultiplayerAPIï¼Œè¿˜å†åŒ…è£… NetworkPeerï¼Œå› ä¸ºåªæ˜¯è·å–å½“æœˆå‰ä¸»æœºçš„ IDï¼Œæ‰€ä»¥è¿”å›çš„
å€¼éƒ¨æ˜¯åˆ›å»º ENetPeer æ—¶ç”Ÿæˆçš„å€¼ï¼š

```C++,ignore
    // void MultiplayerAPI::_bind_methods() {
    ClassDB::bind_method(D_METHOD("get_rpc_sender_id"), &MultiplayerAPI::get_rpc_sender_id);

    int get_rpc_sender_id() const { return rpc_sender_id; }

    MultiplayerAPI::MultiplayerAPI() : allow_object_decoding(false) {
        rpc_sender_id = 0;
        root_node = nullptr;
        clear();
    }

    int MultiplayerAPI::get_network_unique_id() const {
        return network_peer->get_unique_id();
    }

    int SceneTree::get_network_unique_id() const {
        return multiplayer->get_network_unique_id();
    }
```

ç”±äº ENet æ˜¯å¯¹å¾…ç½‘ç»œæ¨¡å‹ï¼Œå…¶ä¸­çš„ `peer_connected` ä¿¡å·ä¼šåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯æ‰§è¡Œï¼Œå¹¶ä¸”ï¼Œæ¯å½“æœ‰æ–°
çš„å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨éƒ½ä¼šå°†è¿™ä¸ªæ–°è¿æ¥ä¿¡æ¯å¹¿æ’­ç»™å…¶å®ƒå·²è¿æ¥çš„å®¢æˆ·ç«¯ï¼ŒåŒæ—¶åˆå°†åŸæœ‰è¿æ¥çš„å®¢æˆ·ç«¯
é€šè¡Œç»™è¿™ä¸ªæ–°åŠ å…¥çš„å®¢æˆ·ç«¯ã€‚éšç€å®¢æˆ·æ•°é‡å¢åŠ ï¼Œåé¢åŠ å…¥çš„å®¢æˆ·ç«¯å°±ä¼šåœ¨åˆšå»ºç«‹è¿æ¥æ—¶æ¥æ”¶åˆ°è¶Šå¤šçš„è¿æ¥ä¿¡å·ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªçº¯è„šæœ¬ç¼–å†™çš„ Godot ç¨‹åºï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå·¥å…·æ¥è¿è¡Œå®ƒï¼Œåœ¨ Powershell ä¸­å¯ä»¥ç»™ Godot
æŒ‡å®šä¸åŒçš„å‚æ•°æ–¹ä¾¿è°ƒè¯•ï¼Œå¦‚çª—å£ä½ç½®ã€å¤§å°ï¼ŒGPU æŒ‡å®šï¼Œè¿˜æœ‰è„šæœ¬è·¯å¾„ï¼Œæˆ–è€…æ— çª—å£ç­‰ç­‰ï¼š

```sh
cls; cd C:\download\games\mainloop;
$base = "C:\download\games"
$gd = "$base\mainloop\scenetree3.gd"
$gd3 = "$base\Godot_v3.5.1-stable_win64.exe"
$gd4 = "$base\Godot_v4.0-rc1_win64.exe"
$gd3m = "$base\Godot_v3.5.1-stable_mono_win64\Godot_v3.5.1-stable_mono_win64.exe"
$gd4m = "$base\Godot_v4.0-rc1_mono_win64\Godot_v4.0-rc1_mono_win64.exe"
&$gd3 --script $gd --client --gpu-index 0 -t --resolution 180x240 --position 200,640 --no-window --headless
#&$gd4 --path . --client --gpu-index 0 -t --resolution 180x240 --position 800,400
```

```py

```

æµ‹è¯•ä¸­å‘ç° Godot 3.5.1 æ— æ³•è§¦å‘ `send_bytes()` æˆåŠŸå‘é€æ•°æ®ï¼Œå€’æ˜¯äº§ç”Ÿä¸€æ¡é”™è¯¯ä¿¡æ¯ï¼š

    ERROR: Condition "incoming_packets.size() == 0" is true. Returned: 1
       at: get_packet_peer (modules/enet/networked_multiplayer_enet.cpp:49)

ä»¥ä¸‹æœ‰ä¸€äº›å¸¸è§é”™è¯¯ã€‚RPC é…ç½®æˆ–è€…èŠ‚ç‚¹æƒé™ä¸åŒ¹é…å¯¼è‡´ RPC ä¸èƒ½è¿œç¨‹è°ƒç”¨çš„é—®é¢˜ï¼š

    ERROR: RPC 'test' is not allowed on node /root from: 1399276778. Mode is 0, master is 1.
       at: (core/io/multiplayer_api.cpp:285)

é”™è¯¯æç¤º RPC_MODE_DISABLED = 0 ç¦ç”¨äº† RPC è¡Œä¸ºï¼Œæˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰ MultiplayerAPI é…ç½®é”™è¯¯ã€‚


å› ä¸ºæ²¡æœ‰åœºæ™¯æ ¹èŠ‚ç‚¹äº§ç”Ÿçš„é”™è¯¯ï¼Œåªè¦ç»™ SceneTree.root èŠ‚ç‚¹ä¸‹æ·»åŠ ä¸€ä¸ªåä¸º "Main" çš„æ ¹èŠ‚ç‚¹å³å¯ï¼š

    ERROR: (Node not found: "Main" (relative to "/root").)
       at: (scene/main/node.cpp:1465)
    ERROR: Failed to get path from RPC: Main.
       at: _process_get_node (core/io/multiplayer_api.cpp:251)

æœ‰äº›æ›´æ€ªå¼‚çš„é—®é¢˜ä¼šéšç€ RPC è°ƒç”¨çš„æ—¶é—´ä¸åŒè€Œäº§ç”Ÿï¼Œç´§æ¥åœ¨ peer_connected ä¿¡å·è§¦å‘æ—¶è°ƒç”¨ rpc() 
å°±å¯èƒ½äº§ç”Ÿä»¥ä¸‹é—®é¢˜ï¼Œä½†åªéœ€è¦ç­‰å¾…å°‘è®¸æ—¶é—´å°±æ²¡æœ‰é—®é¢˜ï¼š

    https://github.com/godotengine/godot/issues/34676

    ERROR: Invalid packet received. Unabled to find requested cached node.
       at: (core/io/multiplayer_api.cpp:260)
    ERROR: Invalid packet received. Requested node was not found.
       at: (core/io/multiplayer_api.cpp:203)

æç¤ºä¿¡æ¯è¡¨ç¤ºï¼Œç¼“å­˜èŠ‚ç‚¹ä¸­æ‰¾ä¸åˆ°ä¸è¯·æ±‚ä¸€è‡´çš„èŠ‚ç‚¹ï¼Œå‘ç”Ÿåœ¨ `_process_packet()`ï¼Œè¿™é‡Œï¼Œè¿™ä¸ªå‡½æ•°ä¸èƒ½
é€šè¿‡ `_process_get_node()` æ–¹æ³•æ‰¾åˆ° **path_get_cache** ç¼“å­˜æœ‰ä¸€è‡´çš„èŠ‚ç‚¹ã€‚

ä»¥ä¸‹é”™è¯¯å‘ç”Ÿåœ¨ `_process_confirm_path()`ï¼Œç¡®è®¤åˆ° **path_send_cache** æ²¡æœ‰ç¼“å­˜ä¸€è‡´çš„èŠ‚ç‚¹ã€‚
è¿™ä¸ªé—®é¢˜ä¼šåœ¨é¦–æ¬¡ `rpc()` æ‰§è¡Œå®Œæˆåè§¦å‘ã€‚

    ERROR: Invalid packet received. Tries to confirm a path which was not found in cache.
       at: (core/io/multiplayer_api.cpp:404)

å‘ç”Ÿåœ¨ `_process_packet()` çš„è·¯å¾„ç¡®è®¤è¡Œä¸ºç”± NETWORK_COMMAND_CONFIRM_PATH å‘½ä»¤è§¦å‘ã€‚è¿™æ˜¯
`rpc()` æ‰§è¡Œå‘¨æœŸç»“æŸåçš„å¦ä¸€è½®æ•°æ®å¤„ç†æµç¨‹ï¼Œæ–°æ•°æ®åŒ…çš„é¦–å­—èŠ‚åŒ…å«ä¸€ä¸ª RPC å‘½ä»¤ï¼Œã€‚

ä»¥ä¸Šè¿™äº›é—®é¢˜éƒ½æŒ‡å‘èŠ‚ç‚¹è·¯å¾„ç¼“å­˜ï¼Œåœ¨æ¥æ”¶ç«¯è§¦å‘çš„é—®é¢˜è¡Œä¸ºã€‚

```C++,ignore
    // godot\modules\multiplayer\scene_multiplayer.h
    // godot-3.5.1-stable\core\io\multiplayer_api.h:113
    enum NetworkCommands {
        NETWORK_COMMAND_REMOTE_CALL,
        NETWORK_COMMAND_REMOTE_SET,
        NETWORK_COMMAND_SIMPLIFY_PATH,
        NETWORK_COMMAND_CONFIRM_PATH,
        NETWORK_COMMAND_RAW,
    };

    // godot-3.5.1-stable\core\io\multiplayer_api.cpp:188
    // Extract the `packet_type` from the LSB three bits:
    uint8_t packet_type = p_packet[0] & CMD_MASK;

    switch (packet_type) {
        case NETWORK_COMMAND_SIMPLIFY_PATH: {
            _process_simplify_path(p_from, p_packet, p_packet_len);
        } break;

        case NETWORK_COMMAND_CONFIRM_PATH: {
            _process_confirm_path(p_from, p_packet, p_packet_len);
        } break;

        case NETWORK_COMMAND_REMOTE_CALL:
        case NETWORK_COMMAND_REMOTE_SET: { 
            // ...
            Node *node = _process_get_node(p_from, p_packet, p_packet_len);
            // ...
            if (packet_type == NETWORK_COMMAND_REMOTE_CALL) {
                _process_rpc(node, name, p_from, p_packet, p_packet_len, len_end + 1);
            } else {
                _process_rset(node, name, p_from, p_packet, p_packet_len, len_end + 1);
            }
        } break;
        case NETWORK_COMMAND_RAW: {
            _process_raw(p_from, p_packet, p_packet_len);
        } break;
        // ...
    }
```

Godot 3.5 ä½¿ç”¨äº†èŠ‚ç‚¹è·¯å¾„ç¼“å­˜ï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹åˆ†å¼€ä¸¤ä¸ª HashMap å­˜å‚¨ï¼Œpeer ID ä½œä¸º key ä½¿ç”¨ã€‚
åœ¨ ENet ç½‘ç»œä¸­ï¼Œæœ‰è¿æ¥æˆ–æ–­å¼€æ—¶ä¼šç›¸åº”å¯¹ path_get_cache è¿›è¡Œä¿®æ”¹ï¼Œæ–­å¼€è¿æ¥åˆ™ä¸¤å¤„éƒ½éœ€è¦æ›´æ–°ã€‚
æœ‰å¤šä¸ªä½ç½®ä¼šä¿®æ”¹è¿™äº› HashMapï¼š

- `MultiplayerAPI::_send_rpc()`ï¼Œå‘é€ RPC è°ƒç”¨æ—¶æ‰§è¡Œã€‚
- `MultiplayerAPI::_add_peer()`ï¼Œé»˜è®¤çš„ peer_connected ä¿¡å·çš„å¤„ç†å‡½æ•°ã€‚
- `MultiplayerAPI::_del_peer()`ï¼Œé»˜è®¤çš„ peer_disconnected ä¿¡å·çš„å¤„ç†å‡½æ•°ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ `set_network_peer()` æ–¹æ³•ï¼Œè°ƒç”¨å®ƒè®¾ç½®ä¸åŒå€¼ä¼šæ‰§è¡Œé‡ç½®è¡Œä¸ºï¼Œ`clear()` æ‰åŸæ¥çš„
ç¼“å­˜æ•°æ®ã€‚å¦‚æœæ˜¯æŒ‡å®šæ–°çš„ NetworkPeerï¼Œè¿˜ä¼šè¿æ¥é»˜è®¤çš„ä¿¡å·å¤„ç†æ–¹æ³•ã€‚MultiplayerAPI æ„é€ å’Œè§£æ„æ—¶
éƒ½ä¼šæ¸…ç†ç¼“å­˜æ•°æ®ã€‚

```C++,ignore
    //path sent caches
    struct PathSentCache {
        Map<int, bool> confirmed_peers;
        int id;
    };

    //path get caches
    struct PathGetCache {
        struct NodeInfo {
            NodePath path;
            ObjectID instance;
        };

        Map<int, NodeInfo> nodes;
    };

    HashMap<NodePath, PathSentCache> path_send_cache;
    Map<int, PathGetCache> path_get_cache;


    void MultiplayerAPI::_send_rpc(Node *p_from, int p_to, bool p_unreliable, bool p_set, const StringName &p_name, const Variant **p_arg, int p_argcount) {
        // ...
        // See if the path is cached.
        PathSentCache *psc = path_send_cache.getptr(from_path);
        if (!psc) {
            // Path is not cached, create.
            path_send_cache[from_path] = PathSentCache();
            psc = path_send_cache.getptr(from_path);
            psc->id = last_send_cache_id++;
        }
        // ...
    }

    void MultiplayerAPI::_add_peer(int p_id) {
        connected_peers.insert(p_id);
        path_get_cache.insert(p_id, PathGetCache());
        emit_signal("network_peer_connected", p_id);
    }

    void MultiplayerAPI::_del_peer(int p_id) {
        connected_peers.erase(p_id);
        // Cleanup get cache.
        path_get_cache.erase(p_id);
        // Cleanup sent cache.
        // Some refactoring is needed to make this faster and do paths GC.
        List<NodePath> keys;
        path_send_cache.get_key_list(&keys);
        for (List<NodePath>::Element *E = keys.front(); E; E = E->next()) {
            PathSentCache *psc = path_send_cache.getptr(E->get());
            psc->confirmed_peers.erase(p_id);
        }
        emit_signal("network_peer_disconnected", p_id);
    }

    void MultiplayerAPI::clear() {
        connected_peers.clear();
        path_get_cache.clear();
        path_send_cache.clear();
        packet_cache.clear();
        last_send_cache_id = 1;
    }
```


### ğŸŸ ğŸ”µ Custom MultiplayerAPI 4.x
- [Npcap](https://nmap.org/npcap/#download)
- [Add peer authentication support](https://github.com/godotengine/godot/pull/67917)
- https://docs.godotengine.org/en/latest/classes/class_scenemultiplayer.html
- https://github.com/Faless/gd-mp-password-auth


æµ‹è¯•ç”¨å‘½ä»¤è¡Œï¼š

```sh
cls; cd C:\download\games\mainloop;
$base = "C:\download\games"
$gd = "$base\mainloop\mainloop.gd"
$gd3 = "$base\Godot_v3.5.1-stable_win64.exe"
$gd4 = "$base\Godot_v4.0-rc1_win64.exe"
$gd3m = "$base\Godot_v3.5.1-stable_mono_win64\Godot_v3.5.1-stable_mono_win64.exe"
$gd4m = "$base\Godot_v4.0-rc1_mono_win64\Godot_v4.0-rc1_mono_win64.exe"
$gd4c = "$base\godot\godot\bin\godot.windows.editor.x86_64.exe"
#$gd4 --script $gd --client --no-window --headless
&$gd4 --script $gd --server --gpu-index 0 -t --resolution 180x240 --position 900,640
```

Godot 4.x ä¸­ç§»é™¤äº† SceneTree è·å– sender id æ–¹æ³•ã€‚å¦å¤–ï¼ŒMultiplayerAPI ä¸­çš„æ–¹æ³•åç§°æ›´æ–°ï¼Œ
`get_remote_sender_id()` ä¸ºæ–°æ–¹æ³•åç§°ï¼Œè¿˜æœ‰ `get_network_unique_id()` å˜æ›´ä¸ºæ›´ä¸€è‡´çš„
`get_unique_id()`ã€‚

Godot 4.x æŒ‡å®šè‡ªå®šä¹‰ MultiplayerAPI çš„å·®å¼‚ä¸é…ç½®è¦ç‚¹ï¼š

- è®¾ç½®è‡ªå®šä¹‰ä½¿ç”¨ SceneTree `set_multiplayer()` æ–¹æ³•ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®š root path (NodePath)ï¼›
- ç”¨æˆ·ä¸å†éœ€è¦å¤„ç† pollï¼Œåªéœ€è¦è®¾ç½®ç›¸åº”çš„ SceneTree.multiplayer_poll çŠ¶æ€å³å¯ï¼›
- Node èŠ‚ç‚¹ä¸å†æä¾› `set_custom_multiplayer()`ï¼ŒåŒæ—¶ï¼Œmultiplayer ä¹Ÿæˆä¸ºåªè¯»å±æ€§ï¼›
- æ–°ç‰ˆæœ¬ä¸­ MultiplayerAPI å˜ä¸ºæ¥å£ï¼Œæä¾› SceneMultiplayer ä½œä¸ºå…·ä½“å®ç°ï¼›
- æä¾›æœåŠ¡å™¨è”æ¥åï¼Œè¦é‡ç½® MultiplayerAPIï¼Œmultiplayer_peer = nullï¼Œå¹¶ä¸”ç¦æ­¢ lollã€‚


è¿æ¥äº‹ä»¶å¤„ç†æ³¨æ„ï¼Œå®ƒä»¬çš„è§¦å‘æ¨¡å‹ä¸ä¸€æ ·ï¼š

- `ENetMultiplayerPeer` peer_connected ä¼šåœ¨ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶è§¦å‘ã€‚
- `MultiplayerAPI` peer_connected ä¼šåœ¨ä¸ä¸å¯¹ç­‰ç«¯å»ºç«‹è¿æ¥æ—¶è§¦å‘ï¼ŒæœåŠ¡å™¨ä¹Ÿç®—å¯¹å¾…ç«¯ã€‚
- åœ¨æ–­å¼€è¿æ¥æ—¶ï¼Œä»¥ä¸Šä¸¤ä¸ªå¯¹è±¡ä¸Šæ³¨å†Œçš„ **peer_disconnected** éƒ½ä¼šè§¦å‘ã€‚

è™½ç„¶æ–‡æ¡£ä¸­è¯´ MultiplayerPeer **set_target_peer()** å¯ä»¥æŒ‡å®šæ•°æ®åŒ…è¦å‘å‘å“ªä¸ªå¯¹ç«¯ï¼Œæˆ–æ˜¯å¹¿æ’­ã€‚
ä½†æµ‹è¯• Godot 4.0 RC1 åªæœ‰åœ¨ `send_bytes()` æ–¹æ³•ä¸­æŒ‡å®šæ‰æœ‰æ•ˆã€‚

å¦å¤–ï¼Œ`set_multiplayer()` æ–¹æ³•æŒ‰ root path æ¥è®¾ç½®è‡ªå®šä¹‰ MultiplayerAPI å®ä¾‹ï¼Œå¯ä»¥ç»™ä¸åŒçš„
èŠ‚ç‚¹è·¯å¾„æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„å¯¹è±¡ã€‚æ—§ç‰ˆæœ¬çš„æ“ä½œåˆ™æ˜¯ç›´æ¥è°ƒç”¨èŠ‚ç‚¹çš„ `set_custom_multiplayer()` è®¾ç½®ã€‚


Godot 4.0 RC1 SceneMultiplayer å¢åŠ äº†ä¸¤ä¸ªæˆæƒç›¸å…³ä¿¡å·ï¼Œå¹¶ä¸”æœ‰é…å¥—çš„å±æ€§ä¸æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œè¿æ¥çš„
åŒæ—¶è¿›è¡Œæƒé™é…ç½®ï¼š

```py
# Properties
Callable auth_callback
float auth_timeout

# Methods
Error send_auth(id: int, data: PackedByteArray)
Error send_bytes(bytes: PackedByteArray, id: int = 0, mode: TransferMode = 2, channel: int = 0)
Error complete_auth(id: int)
PackedInt32Array get_authenticating_peers()

# Signals
peer_authenticating(id: int) # used id with send_auth()
peer_authentication_failed(id: int)
peer_packet(id: int, packet: PackedByteArray) # used with send_bytes()
```

ä¼ å…¥ `send_auth()` çš„æ•°æ®ä½œä¸ºèº«ä»½éªŒè¯æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†å‘é€åˆ° id å¯¹åº”çš„è¿œç«¯ï¼Œå¯ç”¨äºéªŒè¯ï¼Œå¹¶æ§åˆ¶ä½•æ—¶
å‘å‡º MultiplayerAPI **peer_connected** ä¿¡å·ï¼Œé€šå¸¸æ˜¯è¿œç¨‹å¯¹ç­‰ç«¯è¢«æ¥å—ä¸ºå·²è¿æ¥æ—¶ã€‚

æ–°ç‰ˆæœ¬é‰´æƒ API ä½¿ç”¨æµç¨‹ï¼š

- è®¾ç½®æœ‰æ•ˆçš„ auth_callback (int, PackedByteArray) ä»¥è§¦å‘å®¡æ ¸ä¿¡å·ï¼Œç­‰å¾…å¯¹ç«¯è¿æ¥è¯·æ±‚ï¼›
- è§¦å‘å®¡æ ¸ä¿¡å·åï¼Œå¯ä»¥æ¥æ”¶åˆ°å¯¹ç«¯ IDï¼Œå’Œå…¶å®ƒæ•°æ®ä¸€èµ·é€šè¿‡ send_auth() å‘é€åˆ°å¯¹ç«¯ï¼›
- å¯¹ç«¯çš„ auth_callback å°†è¢«è°ƒç”¨ï¼Œå¹¶ä¸”ï¼Œè°ƒç”¨ `complete_auth()` åå‘å‡º peer_connected ä¿¡å·ã€‚

åœ¨æœªå»ºç«‹å¯¹ç­‰è¿æ¥çš„çŠ¶æ€ä¸‹ï¼Œå¯¹ç­‰ä½“åªåŒ…å«åœ¨ `get_authenticating_peers()`ï¼Œè€Œä¸åœ¨ MultiplayerAPI
`get_peers()` è¿”å›çš„è¡¨ä¸­ï¼Œå¹¶ä¸”åªä¼šå‘é€æˆ–æ¥æ”¶èº«ä»½éªŒè¯æ•°æ®ã€‚

é»˜è®¤å®¡æ ¸è¶…æ—¶ 3sï¼Œæ­¤æ—¶é—´å†…æ²¡æœ‰å®Œæˆå®¡æ ¸å³è§¦å‘å®¡æ ¸å¤±è´¥ä¿¡å·ã€‚



    ERROR: Invalid packet received. Tries to confirm a path which was not found in cache.
       at: (modules/multiplayer/scene_cache_interface.cpp:122)



    ERROR: Invalid target peer: 1
       at: (modules/enet/enet_multiplayer_peer.cpp:339)

    ERROR: Invalid target peer: 793682958
       at: (modules/enet/enet_multiplayer_peer.cpp:339)


è°ƒç”¨ send_bytes() å‘é€æ•°æ®æ—¶è§¦å‘ï¼Œæ‰§è¡Œ `get_packet_peer()` æŸ¥è¯¢æ•°æ®åŒ…æ¥æºæ–¹ ID æ—¶ï¼š

    ERROR: Condition "incoming_packets.size() == 0" is true. Returning: 1
       at: get_packet_peer (modules/enet/enet_multiplayer_peer.cpp:42)


ä»¥ä¸Šé”™è¯¯å…·ä½“è§¦å‘æ—¶æœºä¹Ÿåœ¨ poll() è½®è¯¢å…¥ç«™æ•°æ®æ—¶ï¼ŒENet æ¥æ”¶åˆ°çš„å…¥ç«™æ•°æ®ä¿å­˜åœ¨ `incoming_packets`
è¿™å‘é‡åˆ—è¡¨ä¸­ï¼ŒæŒ‰ä»£ç é€»è¾‘ï¼Œåœ¨æœ‰æ•°æ®åŒ…å…¥ç«™å¹¶ä¸”æ•°æ®é•¿åº¦ä¸º 0 æ—¶å°±è§¦å‘è¿™æ ·çš„é”™è¯¯ã€‚

```C++
Error SceneMultiplayer::poll() {
    // ...
    multiplayer_peer->poll();
    // ...
    while (multiplayer_peer->get_available_packet_count()) {
        int sender = multiplayer_peer->get_packet_peer();
        // ...
}
```

Godot 4.0 ä¸º ENet æ–°å¢ MODE_MESH è”ç½‘æ¨¡å¼ï¼ŒåŸæœ‰ MODE_SERVERï¼ŒMODE_CLIENTï¼Œä¸åŒçš„æ´»åŠ¨æ¨¡å¼
åŸºæœ¬éƒ½ä¸ peer è¿æ¥ä¸æ–­å¼€ä¿¡å·ç›¸å…³ã€‚Mesh åŸæŒ‡æ— çº¿ç½‘æ ¼ç½‘ç»œç»„ç½‘æ–¹å¼ï¼Œå–é—´å…¶è‡ªç»„ç»‡èƒ½åŠ›ï¼Œç½‘ç»œèŠ‚ç‚¹å’Œæˆæƒ
æœ€ç»ˆç”¨æˆ·å¯å³æ—¶åŠ å…¥ç½‘ç»œã€‚

```C++
void ENetMultiplayerPeer::poll() {

    switch (active_mode) {

        case MODE_MESH: {
            HashSet<int> to_drop;
            for (KeyValue<int, Ref<ENetConnection>> &E : hosts) {
                ENetConnection::Event event;
                ENetConnection::EventType ret = E.value->service(0, event);
                do {
                    if (ret == ENetConnection::EVENT_CONNECT) {
                        event.peer->reset();
                    } else if (ret == ENetConnection::EVENT_RECEIVE) {
                        _store_packet(E.key, event);
                    } else if (ret == ENetConnection::EVENT_NONE) {
                        break; // Keep polling the others.
                    } else {
                        to_drop.insert(E.key); // Error or disconnect.
                        break; // Keep polling the others.
                    }
                } while (E.value->check_events(ret, event) > 0);
            }
            for (const int &P : to_drop) {
                if (peers.has(P)) {
                    emit_signal(SNAME("peer_disconnected"), P);
                    peers.erase(P);
                }
                hosts.erase(P);
            }
        } break;
    }
}
```

Godot 4.0 æ–°å¢äº†ç”¨äº Scene Replication API çš„å‘½ä»¤ï¼Œä¸»è¦æ˜¯ SPAWN å’Œ DESPAWNã€‚å®šä¹‰äº†æ¯ä¸ª
RPC å‘½ä»¤è‡³å°‘æœ‰ 6 ä¸ªå­—èŠ‚ï¼Œå¤–åŠ ç”¨æˆ·æ•°æ®ï¼Œé€šè¿‡ SceneMultiplayer::send_command() å‘é€ï¼š
æ”¹é€ çš„ MultiplayerAPI å‘èŠ‚ç‚¹æä¾› `rpc()` å’Œ  `rpc_id()` æ–¹æ³•æ”¯æŒï¼ŒåŒæ—¶ä¹Ÿä¸º SceneTree
è‡ªåŠ¨åŒæ­¥å¤åˆ¶æä¾›æ”¯æŒï¼Œé€šè¿‡ `MultiplayerSpawner` å’Œ `MultiplayerSynchronizer` èŠ‚ç‚¹ã€‚
è¿˜æœ‰ç›¸åº”çš„é…ç½®èµ„æºç±»å‹ `SceneReplicationConfig`ã€‚

```C++
    enum NetworkCommands {
        NETWORK_COMMAND_REMOTE_CALL = 0,
        NETWORK_COMMAND_SIMPLIFY_PATH,
        NETWORK_COMMAND_CONFIRM_PATH,
        NETWORK_COMMAND_RAW,
        NETWORK_COMMAND_SPAWN,
        NETWORK_COMMAND_DESPAWN,
        NETWORK_COMMAND_SYNC,
        NETWORK_COMMAND_SYS,
    };

    enum SysCommands {
        SYS_COMMAND_AUTH,
        SYS_COMMAND_ADD_PEER,
        SYS_COMMAND_DEL_PEER,
        SYS_COMMAND_RELAY,
    };

    enum {
        // Command + sys command + peer_id (+ optional payload).
        SYS_CMD_SIZE = 6,
    };
```

Wireshark æŠ“åŒ…å·¥å…·å¯ä»¥è°ƒè¯•å„ç§ç½‘ç»œåè®®ï¼Œè¦ç›‘å¬ 127.0.0.1 æœ¬åœ°å›ç¯ç½‘ç»œé€šä¿¡ï¼Œåªéœ€è¦å®‰è£… Npcapã€‚
å®‰è£…å®Œåï¼Œåœ¨ Wireshark ä¸»ç•Œé¢é€‰æ‹©ç½‘å¡æ¥å£æ—¶ï¼Œä½¿ç”¨ Adapter for loopback traffic captureã€‚
æ½å…¥æŠ“åŒ…çŠ¶æ€ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨ï¼Œåœ¨è¿‡æ»¤å™¨è¾“å…¥æ¡†å½•å…¥ udp å³å¯ä»¥å°†æ‰€æœ‰ UDP æµé‡è¿‡æ»¤å‡ºæ¥ã€‚

ç‚¹å‡»æŠ“åŒ…åˆ—è¡¨ä¸­çš„ä»»æ„æµé‡è®°å½•ï¼Œåœ¨è§£ç å†…å®¹çª—å£ä¸­ä¼šç›´æ¥æ˜¾ç¤º IPã€UDP ç­‰åè®®å¤´æ•°æ®ï¼Œå’Œç”¨æˆ·æ•°æ®ã€‚



ç”¨æˆ·æ•°æ®å‘é€é€»è¾‘ï¼Œè¿›è¡Œåˆ° `put_packet()` å°±æ˜¯å±äº ENet éƒ¨åˆ†ï¼š

    +===============================+
    |         SceneMultiplayer      |
    |-------------------------------|
    | ===============> send_bytes() |
    |                               |
    | multiplayer_peer:             |
    |                  ->is_valid() |
    |     ->get_connection_status() |
    |      ->set_transfer_channel() |
    |         ->set_transfer_mode() |
    |----------------v--------------|
    | =============> send_command() |
    |               get_unique_id() |
    | multiplayer_peer:             |
    | ->is_server_relay_supported() |
    |           ->set_target_peer() |
    |----------------v--------------|
    | ====================> _send() |
    |          _profile_bandwidth() |
    | multiplayer_peer:             |
    |                ->put_packet() |
    +===============================+


éè¿æ¥çŠ¶æ€ä¸‹è°ƒç”¨ RPC APIï¼Œå¦‚ poll(), get_unique_id() è§¦å‘ä»¥ä¸‹é”™è¯¯ã€‚æ–­å¼€è¿æ¥åï¼Œéœ€è¦é‡ç½® peerï¼š

    ERROR: The multiplayer instance isn't currently active.
       at: (modules/enet/enet_multiplayer_peer.cpp:439)


ObjectDB ä½¿ç”¨ **slot_count** è®°å½•æ‰€åˆ›å»ºçš„å®ä¾‹ï¼Œadd_instance å’Œ remove_instance å¯¹å…¶æ›´æ–°ï¼Œ
ç¨‹åºé€€å‡ºæ‰§è¡Œæ¸…ç†æ–¹æ³• cleanup()ï¼Œå‘ç° slot_count æ²¡æœ‰å½’é›¶ï¼Œå°±è­¦å‘Šæœ‰å®ä¾‹æ³„éœ²ï¼š

    WARNING: ObjectDB instances leaked at exit (run with --verbose for details).
         at: cleanup (core/object/object.cpp:1982)
    Leaked instance: SceneTreeTimer:-9222500124133949013
    Hint: Leaked instances typically happen when nodes are removed from the scene tree (with `remove_child()`) but not freed (with `free()` or `queue_free()`).
    Orphan StringName: SceneMultiplayer
    Orphan StringName: FileAccess
    Orphan StringName: timeout
    Orphan StringName: SceneTreeTimer
    StringName: 4 unclaimed string names at exit.

åœºæ™¯æ ‘çš„èŠ‚ç‚¹ä¼šåœ¨é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†ï¼Œä½†æ˜¯å¯¹äºæ²¡æœ‰é€šè¿‡ add_child() é™„åŠ åˆ°åœºæ™¯æ ‘ä¸Šçš„èŠ‚ç‚¹ï¼Œåˆ™ä¸ä¼šè¢«æ¸…ç†ï¼Œ
å®ƒä»¬æ˜¯æ¸¸ç¦»èŠ‚ç‚¹ï¼ŒOrphansï¼Œå¯ä»¥åœ¨è°ƒè¯•é¢æ¿ä¸­æŸ¥çœ‹å½“å‰çš„å­¤å„¿èŠ‚ç‚¹ã€‚å¦å¤–ï¼ŒReference æˆ–è€… RefCounted
ä½¿ç”¨å¼•ç”¨è®¡æ•°ç³»ç»Ÿï¼Œä¼šåœ¨ä¸ä»€ä¹ˆæ—¶è‡ªåŠ¨æ¸…ç†ã€‚

ä½¿ç”¨ `--verbose` å¯åŠ¨ Godot å¯ä»¥æ‰“å°å‡ºç»†èŠ‚ä¿¡æ¯ï¼Œå¦‚ä¸Šé¢æ‰€ç¤ºï¼šå¯¼è‡´æ³„éœ²çš„æ˜¯ SceneTreeTimer å®ä¾‹ï¼Œ
å› ä¸ºå®šæ—¶å™¨è¿˜åœ¨è¿è¡Œï¼Œåœ¨ä¸»åŠ¨é€€å‡ºæ—¶å¯¼è‡´è¿™ä¸ªè­¦å‘Šã€‚



### ğŸŸ ğŸ”µ Marshalling vs unmarshalling
- [Binary serialization API](https://docs.godotengine.org/en/stable/tutorials/io/binary_serialization_api.html)

å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ŒSerialization vs. Deserializationã€‚ 
Go è¯­è¨€ä¸­åˆç§°ä¸º marshalling å’Œ unmarshallingã€‚



### ğŸŸ ğŸ”µ Multiplayer: Scene Replication
- [Mitchell Reid - MitchMakesThings](https://github.com/MitchMakesThings/Godot-Things/tree/main/Networking)
- [Godot 4 Multiplayer - RPC æ•™ç¨‹](https://www.bilibili.com/video/BV17P411c75s/)
- [Godot 4 Multiplayer - RPC](https://github.com/TheGodojo/Godot-4-Networking-Demonstration-Complete)
- [Godot 4 Multiplayer - Spawner/Synchronizer æ•™ç¨‹](https://www.bilibili.com/video/BV1VY411o793/)
- [Godot 4 Multiplayer - Spawner/Synchronizer](https://github.com/TheGodojo/Multiplayer-Nodes-Complete)
- [Multiplayer in Godot 4.0: Scene Replication](https://godotengine.org/article/multiplayer-in-godot-4-0-scene-replication/)
- [Multiplayer in Godot 4.0: Scene Replication (part 1)](https://godotengine.org/article/multiplayer-changes-godot-4-0-report-4/)
- [Add a multiplayer interface and visual nodes for SceneTree replication](https://github.com/godotengine/godot-proposals/issues/3459)
- [Visual Nodes for multiplayer scene replication](https://github.com/godotengine/godot-proposals/issues/3359)
- godot\master\modules\multiplayer\multiplayer_synchronizer.h
- godot\master\modules\multiplayer\multiplayer_synchronizer.cpp

ä½¿ç”¨ Godot 4 æ–°å¢ä¸¤ä¸ªè”ç½‘ä¸“ç”¨èŠ‚ç‚¹å¯èƒ½æ˜¯æœ€ç®€å•çš„è”ç½‘æ¸¸æˆå¼€å‘å·¥å…·äº†ï¼š

- `MultiplayerSpawner` å­µåŒ–å™¨èŠ‚ç‚¹ï¼Œè‡ªåŠ¨åŒæ­¥å¤åˆ¶èŠ‚ç‚¹ï¼Œè‡ªåŠ¨ä»æˆæƒç«¯å°† spawn èŠ‚ç‚¹å¤åˆ¶åˆ°å…¶è¿œç«¯ã€‚
- `MultiplayerSynchronizer` åŒæ­¥èŠ‚ç‚¹ï¼Œæ•°æ®è‡ªåŠ¨åŒæ­¥å¤åˆ¶èŠ‚ç‚¹ï¼Œè‡ªåŠ¨å°†æœ¬åœ°èŠ‚ç‚¹çš„å±æ€§åŒæ­¥åˆ°è¿œç«¯ã€‚
- SceneReplicationConfig æ•°æ®è‡ªåŠ¨åŒæ­¥å¤åˆ¶èŠ‚ç‚¹çš„é…ç½®å¯¹è±¡ã€‚

è¿™ä¸¤ä¸ªè‡ªåŠ¨åŒ–åŒæ­¥èŠ‚ç‚¹åŒ…è£…äº† RPC APIï¼Œç®€åŒ–äº†æ¸¸æˆåŒæ­¥åŠŸèƒ½çš„å®ç°ï¼Œç›®æ ‡æ˜¯æ— ä»£ç åœ°å®ç°å¿«é€Ÿå¼€å‘åŸå‹äº§å“ã€‚

Godot 4 æœ€æ–°æä¾›çš„è¿™å¥— Scene Replication API è®¾è®¡ç›®çš„å°±æ˜¯å¼€ç®±å³ç”¨ï¼Œèƒ½å¿«é€Ÿåœ°å¼€å‘åŸå‹ï¼š

- Provide an out-of-the-box solution for scene state replication across the network.
- Allow for (almost) no-code prototyping.
- Be extensible with game-specific behaviours (custom reconciliation, interpolation, interest management, etc).
- Allow ex-post (incremental) optimizations of network code.
- Be easy to use for game developers, of course :)

è®¾ç½®åŒæ­¥å±æ€§ä¸­ä¼šé‡åˆ°ä¸¤ä¸ªé€‰é¡¹é…ç½®ï¼š

- **Spawn**: Creating, or requesting remotely to create a new Object.
- **Sync**: Updating, or requesting remotely to update the state of an Object.

åœ¨åœºæ™¯ä¸­æ·»åŠ  `MultiplayerSpawner` èŠ‚ç‚¹ï¼Œåœ¨æ·»åŠ è¦åŒæ­¥çš„å¯¹è±¡åŠå±æ€§ï¼Œåœ¨åˆ—è¡¨ä¸­æä¾›ç›¸åº”çš„è®¾ç½®ã€‚åœ¨å±æ€§
é¢æ¿ä¸­ï¼Œè¿˜å¯ä»¥è®¾ç½®ï¼š

- Spawn Limit å¯ä»¥è‡ªåŠ¨å­µåŒ–çš„èŠ‚ç‚¹æ•°é‡é™åˆ¶å€¼ï¼›
- Spawn Path æŒ‡å®šè¦æ£€æµ‹çš„èŠ‚ç‚¹è·¯å¾„ï¼Œè¿™ä¸ªèŠ‚ç‚¹è·¯å¾„ä¸‹å¯èƒ½åŒ…å«è¦è‡ªåŠ¨åŒæ­¥å¤åˆ¶çš„åœºæ™¯èŠ‚ç‚¹å®ä¾‹ï¼›
- Auto Spawn List åˆ—è¡¨ä¸­å’Œ Spawn Path èŠ‚ç‚¹ä¸‹åŒ¹é…çš„åœºæ™¯èŠ‚ç‚¹ä¼šè¢«åŒæ­¥å¤åˆ¶ï¼›

Spawner å¯ä»¥è®¾ç½®ä¸€ä¸ª `spawn_function` å­µåŒ–å‡½æ•°ï¼Œå½“ authority è°ƒç”¨ `spawn()` æ–¹æ³•æ—¶ï¼Œå°±ä¼š
å‘åˆ°è¿œç¨‹è°ƒç”¨ï¼Œåœ¨æ‰€æœ‰ peer ä¸»æœºä¸Šæ‰§è¡Œå®ƒï¼Œå¯ä»¥é€šè¿‡ `spawn()` å‘å­µåŒ–å‡½æ•°ä¼ é€’æ•°æ®ã€‚å­µåŒ–å‡½æ•°åº”è¯¥è¿”å›
ä¸€ä¸ª Nodeï¼Œå¼•æ“ä¼šè‡ªåŠ¨å°†è¿™ä¸ªæ–°ç”ŸèŠ‚ç‚¹æ·»åŠ åˆ°åœºæ™¯æ ‘ä¸Šã€‚

ä¸€ä¸ªå°ç¼ºç‚¹æ˜¯ï¼Œæ‰€æœ‰è¿™äº›éƒ½æ˜¯ç”¨èŠ‚ç‚¹æŒ‡å®šçš„ï¼Œä¼šé™„åŠ è¿™äº›é¢å¤–ç”Ÿæˆçš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰å¤ªå¤šç†è®ºä¸Šçš„è¿è¡Œæ—¶é€»è¾‘ã€‚

æœ‰ä¸¤ä¸ªèŠ‚ç‚¹å­µåŒ–ç›¸å…³ä¿¡å·ï¼š

- `despawned(node: Node)` å­µåŒ–èŠ‚ç‚¹è¢« authority æ’¤æ¶ˆä¹‹åè§¦å‘ï¼Œåªåœ¨ puppets ç«¯è§¦å‘ã€‚
- `spawned(node: Node)` å¯å­µåŒ–èŠ‚ç‚¹è¢« authority ç”Ÿæˆåè§¦å‘ï¼Œåªåœ¨ puppets ç«¯è§¦å‘ã€‚



å‡è®¾è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šç©å®¶æ§åˆ¶ Player.tscn åœºæ™¯èŠ‚ç‚¹ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚æ—¶ï¼Œå°±å®ä¾‹åŒ–ä¸€ä¸ª
æ–°çš„ Player èŠ‚ç‚¹ã€‚è€Œè¿™ä¸ªæ–°çš„èŠ‚ç‚¹å½“ä¸‹åªåœ¨æœåŠ¡å™¨ç«¯ç”Ÿæˆï¼Œè¿˜æ²¡æœ‰åœ¨åˆšåˆšå»ºç«‹è¿æ¥çš„å®¢æˆ·ç«¯åˆ›å»ºã€‚Spawner
èŠ‚ç‚¹çš„ä½œç”¨å°±æ˜¯åœ¨æ£€æµ‹åˆ°æ–°å¢çš„ Player åœºæ™¯èŠ‚ç‚¹æ—¶ï¼Œè‡ªåŠ¨åŒæ­¥å¤åˆ¶åˆ°å®¢æˆ·ç«¯ã€‚ä¸ºäº†æ–¹ä¾¿ç®¡ç†åŒæ­¥å¤åˆ¶çš„èŠ‚ç‚¹ï¼Œ
å°±éœ€è¦ç»™ Spawner è®¾ç½®ä¸€ä¸ª Spawn Path è·¯å¾„ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹è·¯å¾„ä¸‹æŒ‚è½½æ–°åˆ›å»ºçš„ Player åœºæ™¯èŠ‚ç‚¹ã€‚

ç©å®¶èŠ‚ç‚¹åŒæ­¥å¤åˆ¶æˆåŠŸåï¼Œæ‰€æœ‰ç½‘ç»œèŠ‚ç‚¹ä¸Šéƒ½ä¼šæ‹¥æœ‰ç›¸åŒçš„åœºæ™¯æ ‘ç»“æ„ï¼Œè€Œä¸åŒçš„ç©å®¶æ§åˆ¶ç€ä¸åŒçš„ Playerã€‚
åœ¨æ¸¸æˆçš„è¿‡ç¨‹ä¸­ï¼Œä¼šäº§ç”Ÿæ–°çš„ Player çŠ¶æ€æ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®åˆéœ€è¦å‘å…¶å®ƒå¯¹ç­‰ç«¯å¹¿æ’­ï¼Œä»¥å®ç°å…¨åœºçš„ç©å®¶
è§‚çœ‹åˆ°çš„æ¸¸æˆç”»é¢æ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯ Synchronizer èŠ‚ç‚¹çš„ä½œç”¨ã€‚

SceneMultiplayer ä½œä¸º MultiplayerAPI çš„å­ç±»ï¼Œå…¶ä¸­ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯é€šè¿‡ä»¥ä¸Š Scene Replication
ç›¸å…³èŠ‚ç‚¹æä¾›æ— ä»£ç åŒ–çš„åŒæ­¥å¤åˆ¶åŠŸèƒ½ã€‚åœ¨é€‰ä¸­ `MultiplayerSynchronizer` èŠ‚ç‚¹æ—¶ï¼Œåº•éƒ¨é¢æ¿åŒºä¼šå‡ºç°
Replication é¢æ¿ï¼Œè¿™é‡Œç”¨æ¥é…ç½®éœ€è¦è‡ªåŠ¨åŒæ­¥å¤åˆ¶çš„å±æ€§ã€‚

é…ç½® replication_interval å±æ€§å¯ä»¥æ”¹å˜åŒæ­¥é¢‘ç‡ï¼Œé»˜è®¤å€¼ä¸º 0.0 è¡¨ç¤ºåœ¨æ¯ä¸ªç½‘ç»œå¤„ç†å¸§éƒ½ä¼šåŒæ­¥ã€‚
æ ¹èŠ‚ç‚¹è·¯å¾„ç”¨äº RPC å’Œ Scene Replication APIï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„æ¥æŸ¥æ‰¾åº”è¯¥åœ¨å…¶ä¸Šæ‰§è¡Œ RPC çš„èŠ‚ç‚¹ã€‚
æ•°æ®åŒæ­¥èŠ‚ç‚¹å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ¥æ”¹å˜è‡ªåŠ¨åŒæ­¥çš„è¡Œä¸ºï¼Œé€šå¸¸ç”± SceneTree å†…éƒ¨é…ç½® MultiplayerAPIã€‚
åœ¨å±æ€§é¢æ¿ä¸­ï¼Œæä¾›äº†ä¸€ä¸ª Root Path å±æ€§ï¼ŒæŒ‡ç¤º Synchronizer è¦åŒæ­¥çš„æ•°æ®æ¥æºèŠ‚ç‚¹ç›¸å¯¹äºæ­¤è·¯å¾„ã€‚

æ•°æ®åŒæ­¥çš„é€»è¾‘æ¯”èŠ‚ç‚¹åŒæ­¥è¦å¤æ‚ä¸€ç‚¹ï¼Œå‡è®¾å½“å‰æœ‰ 3 ä¸ªç©å®¶ï¼Œé‚£ä¹ˆå…¶ä¸­ä¸€ä¸ªç©å®¶ Player èŠ‚ç‚¹æœ‰æ›´æ–°ï¼Œé‚£ä¹ˆ
Synchronizer å°±è¦è´Ÿè´£è´£å°†æœ€æ–°çš„èŠ‚ç‚¹æ•°æ®åŒæ­¥åˆ°å…¶å®ƒä¸¤ä¸ªç©å®¶çš„ç½‘ç»œèŠ‚ç‚¹ä¸Šã€‚Scene Replication API
è®¾è®¡ç›®çš„å°±æ˜¯å¼€ç®±å³ç”¨ï¼Œæ— ä»£ç åŒ–ï¼Œæ‰€ä»¥é…ç½®å¥½è¦åŒæ­¥çš„èŠ‚ç‚¹æ ¹è·¯å¾„ï¼Œå’Œè¦åŒæ­¥çš„å±æ€§åï¼ŒSynchronizer å°±ä¼š
æ ¹æ® `replication_interval` å±æ€§è®¾ç½®åŒæ­¥é¢‘ç‡ï¼Œä»¥æœ€å¿«é€Ÿåº¦å°†èŠ‚ç‚¹å±æ€§æ•°æ®å‘é€å‡ºå»ã€‚

è€Œå¼€å‘è€…è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼ŒæŒ‰æ­£å¸¸é€»è¾‘ä¿®æ”¹åŒæ­¥ä¸­çš„å±æ€§ï¼ŒSynchronizer ä¼šè´Ÿè´£è¯»å–å¹¶åœ¨ç½‘ç»œä¸Šå¹¿æ’­ã€‚


```py
Error object_configuration_add(object: Object, configuration: Variant)
Error object_configuration_remove(object: Object, configuration: Variant)
```



### ğŸŸ ğŸ”µ Multiplayer RPC å®ä¾‹æ¼”ç¤º
- [Multiplayer Bomber Demo](https://godotengine.org/asset-library/asset/139)
- [Pong Multiplayer](https://godotengine.org/asset-library/asset/138)
- [Pong Non-Multiplayer](https://github.com/godotengine/godot-demo-projects/tree/master/2d/pong)
- [Godot Multiplayer Networking Cheatsheet](https://blog.iancolwell.ca/godot-multiplayer-networking-cheatsheet)
- [Godot 4.x Multiplayer RPC](https://github.com/jeangowhy/godot-tour/tree/4.x/multiplayer_rpc)
- [Godot 3.5 Multiplayer RPC](https://github.com/jeangowhy/godot-tour/tree/main/multiplayer_rpc)

ä½¿ç”¨ Godot 4.x RPC API è¿›è¡Œç½‘ç»œæ¸¸æˆå¼€å‘çš„å·¥ä½œæµç¨‹æ¦‚è¦ï¼š

- é…ç½® MultiplayerPeer å¯åŠ¨ç›¸åº”çš„æœåŠ¡å™¨/å®¢æˆ·ç«¯ï¼›
- å»ºç«‹è¿æ¥ï¼Œè®°å½• peer ID å¹¶ç»™ç›¸åº”çš„èŠ‚ç‚¹è®¾ç½®ä¸»æ§ç«¯ IDï¼›
- é…ç½® RPC APIï¼Œæ ¹æ®éœ€è¦è®¾ç½® RPC çš„è°ƒç”¨æ–¹å¼ï¼Œä¸»è¦æ˜¯ï¼šany_peer authority call_local call_remoteï¼›
- é€šè¿‡ is_network_master() æˆ– is_multiplayer_authority() ä¸»åŠ¨åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦å½’å±äºä¸»æ§ï¼›
- æ‰§è¡Œ rpc() æˆ– rpc_id() ç­‰æ–¹æ³•æ‰§è¡Œ RPC è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œè¿›è¡Œæ•°æ®åŒæ­¥ï¼›
- å¤„ç†ç½‘ç»œè¿æ¥ï¼Œä»¥ä¸‹ç»“æŸè¿æ¥ï¼›

ä½¿ç”¨ RPC API æ¶‰åŠåˆ°çš„æ•°æ®åŒæ­¥ï¼Œéœ€è¦é€šè¿‡å®šä¹‰å„ç§ RPC æ–¹æ³•æ¥å®ç°ï¼Œæ¯”å¦‚ï¼Œä»¥ä¸‹ä¾‹å­ä¸­ç”¨äºè®°å½•æ‰€æœ‰å®¢æˆ·
è¿æ¥æ ‡å¿—çš„ connected_peer_idsï¼Œåœ¨æœåŠ¡å™¨ç«¯æ€»èƒ½è®°å½•åˆ°æ‰€æœ‰å®¢æˆ·ç«¯çš„ IDã€‚ä½†æ˜¯æ–°åŠ å…¥çš„å®¢æˆ·ç«¯ï¼ŒåªçŸ¥é“
è‡ªå·±ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼Œå…¶å®ƒå®¢æˆ·ç«¯çš„è¿æ¥éœ€è¦é€šè¿‡æŸ¥è¯¢ï¼ˆåŒæ­¥ï¼‰æœåŠ¡å™¨ä¸­çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œæ¯å½“æœ‰æ–°å®¢æˆ·ç«¯å‘å‡ºè¿æ¥
è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯éƒ½éœ€è¦æ‰§è¡Œä¸€ä¸ª new_peer_broadcast å¹¿æ’­ï¼Œè¿œç¨‹è°ƒç”¨æ‰€æœ‰å®¢æˆ·ç«¯çš„æ–¹æ³•ï¼Œä»¥åˆ›å»ºç›¸åº”çš„æ–°
ç©å®¶èŠ‚ç‚¹ã€‚åŒæ—¶ï¼Œå¯¹äºåŸæœ‰ç©å®¶ï¼Œéœ€è¦é€šè¿‡ rpc_id() æŒ‡å®š ID è°ƒç”¨æ–°ç©å®¶ä¸»æœºä¸Šçš„ APIï¼ŒåŒæ­¥åˆ›å»ºä¸æœåŠ¡
åœºæ™¯æ ‘ä¸€è‡´çš„èŠ‚ç‚¹ç»“æ„ï¼š

```py
var connected_peer_ids = []

func new_peer_connected(peer_id):
    await get_tree().create_timer(0.5).timeout
    # create player on all clients side.
    rpc("new_peer_broadcast", peer_id)
    rpc_id(peer_id, "old_peer_replication", connected_peer_ids)
    # create player on server side for client.
    create_player(peer_id)

func create_player(peer_id = 1):
    connected_peer_ids.append(peer_id)
    var player = preload("res://player.tscn").instantiate()
    player.set_multiplayer_authority(peer_id)
    add_child(player)
    rpc("refresh_peer_node_inf")
    if peer_id == multiplayer.get_unique_id():
        local_player = player

@rpc 
#@rpc("authority", "call_remote", "reliable", 1)
func new_peer_broadcast(new_peer_id):
    create_player(new_peer_id)

@rpc
#@rpc("authority", "call_remote", "reliable", 1)
func old_peer_replication(peer_ids):
    for peer_id in peer_ids:
        create_player(peer_id)
```

æ³¨æ„ï¼Œé»˜è®¤çš„ @rpc æ ‡æ³¨æ˜¯ call_remote æ–¹å¼è°ƒç”¨ï¼Œä¸ä¼šåœ¨ä¸»æ§ç«¯è¿è¡Œï¼Œåªåœ¨å…¶å®ƒæ‰€æœ‰è¿œç¨‹ç«¯æ‰§è¡Œæ•°æ®åŒæ­¥ã€‚
å› ä¸ºè¿æ¥ä¿¡å·æ˜¯æœåŠ¡å™¨ç«¯çš„è¡Œä¸ºï¼Œæ‰€ä»¥ @rpc æ–¹å¼è°ƒç”¨å°±æ˜¯åœ¨æ‰€æœ‰å®¢æˆ·ç«¯æ‰§è¡Œï¼Œç”±æœåŠ¡å™¨å‘èµ· RPC è°ƒç”¨ï¼Œä½†æ˜¯
ä¸åŒ…æ‹¬æœåŠ¡å™¨ã€‚

ä½¿ç”¨ RPC API æœ€åé˜¶æ®µåŒ…å«ç»“æŸè¿æ¥å¤„ç†ï¼Œå½“å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥ï¼Œå°±åº”è¯¥åšç›¸å½“çš„å¤„ç†ã€‚å®¢æˆ·ç«¯ç»“æŸï¼Œ
æ•´ä¸ªè¿ç½‘ç³»ç»Ÿè¿˜åœ¨è¿è¡Œï¼Œåªæ˜¯å…¶ä¸­ä¸€ä¸ªå¯¹ç­‰ç«¯çš„é€€å‡ºï¼Œéœ€è¦å°†å…¶å ç”¨çš„èµ„æºæ¸…ç†æ‰ã€‚è€Œå¯¹äºæœåŠ¡å™¨ç»“æŸï¼Œæ‰€ä»¥å®¢æˆ·
ç«¯éƒ½ä¼šå¤±å»è¿ç½‘åŠŸèƒ½ï¼Œè¦ä¹ˆç­‰å¾…æœåŠ¡å™¨é‡æ–°å¯åŠ¨å†å°è¯•è¿æ¥ï¼Œè¦ä¹ˆæ¸…ç†æ‰€æœ‰å®¢æˆ·ç«¯ç›¸å…³èµ„æºã€‚MultiplayerPeer
éœ€è¦å…³é—­ï¼Œå¹¶ä¸”é‡Šæ”¾ multiplayer_peer = nullï¼ŒåŒæ—¶åœºæ™¯ä¸­ä¹Ÿä¸èƒ½å†è°ƒç”¨ç›¸å…³çš„ RPC APIã€‚

é€šè¿‡ MultiplayerAPI.has_multiplayer_peer() å¯ä»¥æŸ¥è¯¢å½“å‰çš„è¿æ¥çŠ¶æ€ï¼Œä½œä¸ºæ‰§è¡Œ RPC çš„ä¾æ®ã€‚

æœåŠ¡å™¨ç«¯å¼€å¯åå°±ä¼šè¿›è¡Œä¾¦å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚è€Œå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åˆ™éœ€è¦æ ¹æ®ç½‘ç»œçŠ¶æ€è€Œå®šï¼Œæœ‰æ—¶å¯èƒ½
å› ä¸ºç½‘ç»œä¸ç¨³å®šï¼Œéœ€è¦è¶Šé•¿æ—¶é—´çš„æ‰èƒ½å»ºç«‹è¿æ¥ã€‚æ›´åçš„æƒ…å†µæ˜¯ï¼Œæ ¹æœ¬ä¸èƒ½æ­£å¸¸å»ºç«‹è¿æ¥ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´å°è¯•è¿˜
ä¸èƒ½å»ºç«‹è¿æ¥ï¼Œå°±ä¼šå› ä¸ºè¿æ¥è¶…æ—¶ï¼Œè¿›è€Œè§¦å‘ connetion_failed ä¿¡å·ã€‚å¯ä»¥è¯´ï¼Œconnected_to_server
æ˜¯æœ€ä¸é‡è¦çš„è¿æ¥ä¿¡å·ä¹‹ä¸€ã€‚

å·¥ç¨‹è®¾ç½® Network Limits å¯ä»¥é…ç½® TCP è¿æ¥è¶…æ—¶ç§’æ•° connect_timeout_secondsï¼Œé»˜è®¤å€¼ 30ã€‚

æœåŠ¡å™¨ä¿¡å·ä½¿ç”¨ä¸æ°å½“å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç«¯åœ¨é¦–ä¸ªå®¢æˆ·ç«¯è¿æ¥æ—¶ï¼Œé‡å¤å‡ºç° ID = 1 çš„ peer è¿æ¥ã€‚ä¸€èˆ¬åª
éœ€è¦å°†å®¢æˆ·ç«¯çš„ä¿¡å·ï¼Œä¸æœåŠ¡å™¨ç«¯çš„ä¿¡å·åˆ†å¼€è¿æ¥ä½¿ç”¨ã€‚

|              Godot 3               |          Godot 4           |          Notes           |
|------------------------------------|----------------------------|--------------------------|
| connected_to_server()              | connected_to_server()      | Only emitted on clients. |
| connection_failed()                | connection_failed()        | Only emitted on clients. |
| server_disconnected()              | server_disconnected()      | Only emitted on clients. |
| network_peer_connected(id: int)    | peer_connected(id: int)    | Emiited on any peer.     |
| network_peer_disconnected(id: int) | peer_disconnected(id: int) | Emiited on any peer.     |

æ³¨æ„ï¼Œè™½ç„¶æ–‡æ¡£ä¸­è¡¨ç¤ºå®¢æˆ·ç«¯ä¹Ÿä¼šè§¦å‘ peer_disconnected ä¿¡å·ï¼Œä½†æµ‹è¯•ä¸­å‘ç° peer_connected æ‰ä¼š
åœ¨å®¢æˆ·ç«¯è§¦å‘ï¼Œéœ€è¦é€šè¿‡ server_disconnected æ¥æ£€æµ‹æœåŠ¡å™¨æ˜¯å¦æ–­å¼€ã€‚

åœ¨æ—§ç‰ˆæœ¬æ–‡æ¡£ä¸­ï¼Œåªæ˜¯è¯´ peer_connected(id: int) åœ¨æœåŠ¡ç«¯è§¦å‘ï¼Œä½†åœ¨å®¢æˆ·ç«¯ä¹Ÿä¸€æ ·ä¼šè§¦å‘ï¼Œåªæœ‰æ–­å¼€
è¿æ¥æ—¶ peer_disconnected(id: int) æ‰åªå‘ç”Ÿåœ¨æœåŠ¡å™¨ã€‚å¦å¤–ï¼Œåœ¨ Goodt 3.5.1 ä¸­ï¼ŒæœåŠ¡å™¨æ–­å¼€è¿æ¥
ä¿¡å·å¯ä»¥é€šè¿‡ NetworkedMultiplayerENet è§¦å‘ï¼Œä½†æ˜¯ MultiplayerAPI.server_disconnected()
å¹¶ä¸ä¼šè§¦å‘ã€‚

ä»¥ä¸‹ç¤ºèŒƒå·¥ç¨‹ä¸º Godot 4.x ç‰ˆæœ¬ï¼ŒåªåŒ…å«ä¸¤ä¸ªåœºæ™¯ï¼š

- player.tscn ç©å®¶åœºæ™¯èŠ‚ç‚¹ï¼Œæä¾›ç©å®¶çš„åŸºæœ¬è§’è‰²è¡Œä¸ºå’Œå¤–è§‚ï¼›
- main.tscn ä¸»åœºæ™¯ï¼Œæä¾›è¿æ¥ç±»å‹é€‰æ‹©ç•Œé¢ï¼Œå’Œè¿æ¥ä¿¡å·çš„ç®¡ç†ï¼›

Godot 3.5 çš„ä¸€äº› API å·®åˆ«ï¼Œå¦å¤– Godot 4.x æ–°å¢äº† Signl ç±»å‹ï¼ŒObject åŸæœ‰çš„ä¿¡æ¯ç›¸å…³ API ä¿ç•™ï¼š

|               Godot 3.5               |           Godot 4.x           |
|---------------------------------------|-------------------------------|
| ENetMultiplayerPeer                   | MultiplayerPeer               |
| - -                                   | - close()                     |
| NetworkedMultiplayerENet              | ENetMultiplayerPeer           |
| - close_connection()                  | - -                           |
| MultiplayerAPI                        | MultiplayerAPI                |
| - network_peer                        | - multiplayer_peer            |
| - get_rpc_sender_id()                 | - get_remote_sender_id()      |
| - set_network_peer()                  | - set_multiplayer_peer()      |
| - get_network_unique_id()             | - get_unique_id()             |
|---------------------------------------|-------------------------------|
| Array                                 |                               |
| - remove(position: int)               | - remove_at()                 |
|---------------------------------------|-------------------------------|
| LineEdit                              |                               |
| - text_entered                        | - text_submitted              |
|---------------------------------------|-------------------------------|
| Spatial                               | Node3D                        |
| - global_translation                  | - global_position             |
|---------------------------------------|-------------------------------|
| Node                                  |                               |
| - is_network_master()                 | - is_multiplayer_authority()  |
| - set_network_master()                | - set_multiplayer_authority() |
|---------------------------------------|-------------------------------|
| InputEventMouseButton                 |                               |
| - doubleclick                         | - double_click                |
|---------------------------------------|-------------------------------|
| InputEventKey                         |                               |
| - scancode                            | - key_code                    |
|---------------------------------------|-------------------------------|
| Signal                                |                               |
| - Object.get_signal_connection_list() | - Signal.get_connections()    |
| - Object.disconnect()                 | - Signal.disconnect()         |
|---------------------------------------|-------------------------------|
| yield                                 | await                         |
| - yield( object, "completed" )        | - await object                |
| - yield( object, "signal" )           | - await object.signal         |


Godot 3.5 ä¸­ï¼ŒMultiplayerAPI è¿˜ç»‘å®šäº†é»˜è®¤çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå¹¶ä¸”è·å–ä¿¡å·ç»‘å®šåˆ—è¡¨è¿”å›çš„å­—å…¸åŒ…å«çš„
å­—æ®µæ¯” Godot 4.x ä¸­çš„æ›´å¤šï¼š

```py
    object.get_signal_connection_list("signal"):
    return array of dictionary:
    { 
        binds:[], flags:0, 
        method:_server_disconnected, 
        signal:server_disconnected, 
        source:[MultiplayerAPI:1249], 
        target:[SceneTree:1242]
    }

    signal.get_connections() 
    return array of dict: {signal, callable}
```


ä»¥ä¸‹ç¤ºèŒƒå·¥ç¨‹ä¸º Godot 4.x ç‰ˆæœ¬ï¼ŒåªåŒ…å«ä¸¤ä¸ªåœºæ™¯ï¼š

- player.tscn ç©å®¶åœºæ™¯èŠ‚ç‚¹ï¼Œæä¾›ç©å®¶çš„åŸºæœ¬è§’è‰²è¡Œä¸ºå’Œå¤–è§‚ï¼›
- main.tscn ä¸»åœºæ™¯ï¼Œæä¾›è¿æ¥ç±»å‹é€‰æ‹©ç•Œé¢ï¼Œå’Œè¿æ¥ä¿¡å·çš„ç®¡ç†ï¼›

ä¸»åœºæ™¯ä½¿ç”¨çš„ main_rpc.gd è„šæœ¬å‚è€ƒå¦‚ä¸‹ï¼š

```py
    extends Node3D


    const PORT = 4567
    const HOST = "127.0.0.1"

    var multiplayer_peer = ENetMultiplayerPeer.new()
    var connected_peer_ids = []
    var local_player

    @onready var message_input = $MessageInput
    @onready var menu = $Menu
    @onready var host = $Menu/bg/vbox/Host
    @onready var join = $Menu/bg/vbox/Join
    @onready var network_side = $NetworkInfo/NetworkSide
    @onready var peer_node_inf = $NetworkInfo/PeerNodeInfo


    func _ready():
        # Start the server/client by pass "--server" or "--client" argument.
        if "--server" in OS.get_cmdline_args():
            start_server()
        elif "--client" in OS.get_cmdline_args():
            start_client()
        else:
            menu.visible = true

        host.pressed.connect(start_server)
        join.pressed.connect(start_client)

        #message_input.connect("text_submitted", _on_message_input_text_submitted)
        message_input.connect("focus_entered", _on_message_input_focus_entered)
        message_input.connect("focus_exited", _on_message_input_focus_exited)


    func toggle_pause_mode():
        var mode = get_tree().paused
        var fps = ProjectSettings.get_setting("physics/common/physics_ticks_per_second", 60)
        # set_physics_process(false)
        # set_process(false)
        get_tree().set_pause(!mode)
        if mode:
            Engine.set_physics_ticks_per_second(fps)
        else:
            Engine.set_physics_ticks_per_second(fps/3)


    func _unhandled_input(event):
        if not event is InputEventKey or not event.is_pressed():
            return
        if event.keycode == KEY_ESCAPE:
            clear_connections()
        elif event.keycode == KEY_ENTER and not message_input.has_focus():
            message_input.grab_focus()
        elif event.keycode == KEY_P:
            toggle_pause_mode()

    func reset_signals(is_server = true):
        clear_signal(multiplayer_peer.peer_disconnected)
        clear_signal(multiplayer_peer.peer_connected)
        clear_signal(multiplayer.server_disconnected)
        clear_signal(multiplayer.connected_to_server)
        clear_signal(multiplayer.connection_failed)
        if is_server:
            # Signals for server
            multiplayer_peer.peer_disconnected.connect(peer_disconnected)
            multiplayer_peer.peer_connected.connect(new_peer_connected)
        else:
            # Signals for clietns
            multiplayer.server_disconnected.connect(func(): destroy_peer(get_multiplayer_authority()))
            multiplayer.connected_to_server.connect(func(): print_debug("Connected to server: %s:%d" % [HOST, PORT]))
            multiplayer.connection_failed.connect(connection_failed)

    func clear_signal(sgl: Signal):
        for conn in sgl.get_connections():
            print_debug("disconnect observer: ", conn["signal"])
            conn["signal"].disconnect(conn.callable)


    func start_server():
        reset_signals(true)
        message_input.text = "Starting a new server ..."
        var err = multiplayer_peer.create_server(PORT)
        if OK != err:
            print_debug("Can't create an ENet server on %s:%s" % [HOST, PORT])
            return
            
        multiplayer.multiplayer_peer = multiplayer_peer
        menu.visible = false
        network_side.text = "Server"
        message_input.text = ""
        print_debug("Start ENet Server on %s:%d." % [HOST, PORT])
        
        # create server side player
        create_player()


    func start_client():
        reset_signals(false)
        message_input.text = "Starting a new client ..."
        var err = multiplayer_peer.create_client(HOST, PORT)
        if OK != err:
            print_debug("Can't create an ENet client on %s:%s" % [HOST, PORT])
            return
            
        multiplayer.multiplayer_peer = multiplayer_peer
        menu.visible = false
        network_side.text = "Client"
        print_debug("Start ENet Client on %s:%d." % [HOST, PORT])
        await get_tree().create_timer(0.5).timeout
        message_input.text = ""


    func connection_failed():
        message_input.text = "Connection failed: %s:%d" % [HOST, PORT]
        await get_tree().create_timer(3).timeout
        menu.visible = true


    func new_peer_connected(peer_id):
        print_debug("new peer connected: %d." % [peer_id])
        message_input.text = "new peer connected: %d." % [peer_id]
        await get_tree().create_timer(0.5).timeout
        message_input.text = ""
        # create player on all clients side.
        rpc("new_peer_broadcast", peer_id)
        rpc_id(peer_id, "old_peer_replication", connected_peer_ids)
        # create player on server side for client.
        create_player(peer_id)


    func create_player(peer_id = 1):
        connected_peer_ids.append(peer_id)
        var player = preload("res://player.tscn").instantiate()
        player.set_multiplayer_authority(peer_id)
        add_child(player)
        rpc("refresh_peer_node_inf")
        if peer_id == multiplayer.get_unique_id():
            local_player = player

        # exit power saving mode when peers connection comming
        set_physics_process(true)
        set_process(true)


    func peer_disconnected(peer_id):
        print_debug("peer disconnected: %d." % [peer_id])
        # Disconnect peer specific from host.
        # multiplayer_peer.disconnect_peer(peer_id)
        
        # Wait ENet for less seconds to keep clean
        # Destroy player node on other clients peers
        call_deferred("rpc", "destroy_peer_broadcast", peer_id)
        #rpc("destroy_peer_broadcast", peer_id)


    func clear_connections():
        multiplayer_peer.close()
        multiplayer.multiplayer_peer = null
        #get_tree().set_multiplayer_poll_enabled(false)
        #get_tree().multiplayer_poll = false
        for id in connected_peer_ids:
            get_node(str(id)).queue_free()
        connected_peer_ids.clear()
        menu.visible = true
        # power saving when there no connection
        set_physics_process(false)
        set_process(false)

    func destroy_peer(peer_id):
        if peer_id == 1:
            print_debug("Server closed!")
            clear_connections()
            return
        get_node(str(peer_id)).queue_free()
        connected_peer_ids.remove_at(connected_peer_ids.find(peer_id))
        refresh_peer_node_inf()


    @rpc 
    #@rpc("authority", "call_remote", "reliable", 1)
    func new_peer_broadcast(new_peer_id):
        create_player(new_peer_id)

    @rpc("authority", "call_local", "reliable", 1)
    func destroy_peer_broadcast(peer_id):
        destroy_peer(peer_id)


    @rpc("any_peer", "call_local")
    func refresh_peer_node_inf():
        peer_node_inf.text = "#%d / %d" % [multiplayer.get_unique_id(), len(connected_peer_ids)]

    @rpc("any_peer")
    func old_peer_replication(peer_ids):
        for peer_id in peer_ids:
            create_player(peer_id)


    func _on_message_input_focus_entered():
        local_player.enable_input(false)

    func _on_message_input_focus_exited():
        local_player.enable_input(true)

    func _on_message_input_text_submitted(new_text):
        local_player.rpc("display_message", new_text)
        message_input.text = ""
        message_input.release_focus()
        message_input.accept_event();
```

ç©å®¶åœºæ™¯ä½¿ç”¨çš„è„šæœ¬å‚è€ƒï¼š

```py
    extends MeshInstance3D

    var speed = 10
    var can_process_input = true

    @onready var message = $Message
    @onready var myname = $Name

    func _ready():
        name = str(get_multiplayer_authority())
        myname.text = str(name)

    func _physics_process(delta):
        if can_process_input and multiplayer.has_multiplayer_peer() and is_multiplayer_authority():
            var axis_x = int(Input.is_key_pressed(KEY_A)) - int(Input.is_key_pressed(KEY_D))
            var axis_z = int(Input.is_key_pressed(KEY_W)) - int(Input.is_key_pressed(KEY_S))
            var direction:Vector3 = Vector3(-axis_x, 0, -axis_z)
            
            if direction.length():
                # update my position by myself.
                global_position += direction.normalized() * delta * speed
                # refresh my position of all clients by RPC API.
                rpc("remote_set_position", global_position)

    func _unhandled_input(event):
        if not event is InputEventMouseButton:
            return
        match [event.button_index, event.double_click, event.pressed]:
            [MOUSE_BUTTON_LEFT, true, true]:
                set_my_message("I'm myself!")

    func enable_input(enable):
        can_process_input = enable


    func set_my_message(msg):
        # This api works just for me
        #if not name != str(get_multiplayer_authority()):
        if not is_multiplayer_authority():
            return
        message.text = msg


    @rpc("unreliable")
    func remote_set_position(pos):
        print_debug("authority call remote: #%d - %s - " % [get_multiplayer_authority(), pos])
        global_position = pos

    @rpc
    #@rpc("authority", "call_remote", "reliable", 1)
    func display_message(msg):
        message.text = str(msg)

    @rpc
    #@rpc("authority", "call_remote", "reliable", 1)
    func shake_me():
        message.text = "Shake me!"

    @rpc("any_peer", "call_local", "reliable", 1)
    func shake_all():
        message.text = "Shake all!"

    @rpc("any_peer", "call_local", "reliable", 1)
    func clicked_by_player():
        var sender = multiplayer.get_remote_sender_id()
        message.text = str(sender) + " hit me!"
        if get_multiplayer_authority() == sender:
            message.text = "hit myself!"


    func _on_area_input_event(_camera, event, _position, _normal, _shape_idx):
        if not event is InputEventMouseButton:
            return
        match event.button_index:
            MOUSE_BUTTON_LEFT:
                rpc("clicked_by_player")
            MOUSE_BUTTON_RIGHT:
                if is_multiplayer_authority():
                    rpc("shake_me")
            MOUSE_BUTTON_MIDDLE:
                rpc("shake_all")
```

## ğŸŸ¡ GDScript 
- [GDScript Basics](https://docs.godotengine.org/en/3.5/tutorials/scripting/gdscript/gdscript_basics.html)
- [GDScript Advanced](https://docs.godotengine.org/en/3.5/tutorials/scripting/gdscript/gdscript_advanced.html)
- [GDScript exports](https://docs.godotengine.org/en/3.5/tutorials/scripting/gdscript/gdscript_exports.html)
- [Singletons (AutoLoad)](https://docs.godotengine.org/en/3.5/tutorials/scripting/singletons_autoload.html)
- [When you should use an Autoload](https://docs.godotengine.org/en/3.5/tutorials/best_practices/autoloads_versus_internal_nodes.html)
- [GDScript grammar](https://docs.godotengine.org/en/stable/development/file_formats/gdscript_grammar.html)
- [Import process](https://docs.godotengine.org/en/stable/tutorials/assets_pipeline/import_process.html)
- [GDScript 2.0 reference](https://docs.godotengine.org/en/latest/tutorials/scripting/gdscript/gdscript_basics.html)
- [Godot 4 GDScript Features - GDScript 2.0](https://gdscript.com/articles/godot-4-gdscript/)
- [Data preferences](https://docs.godotengine.org/en/3.5/tutorials/best_practices/data_preferences.html)
- [Optimizing GDScript Code](https://www.gdquest.com/tutorial/godot/gdscript/optimization-code/)
- https://gdscript.com/tutorials/classes/

Godot 4 GDScript 2.0 Features:

- first-class functions
- lambdas
- new property syntax
- `await` keyword
- `super` keyword
- typed arrays
- built-in annotations
- automatically generate documentation

Godot è¯ç”Ÿäº 2007 å¹´ï¼ŒGDScript ä¹‹çˆ¶ Juan Linietsky ä¸ºäº†ç®€åŒ–è§£é‡Šå®ç°çš„å¤æ‚åº¦ï¼Œè®¸å¤šè¯­æ³•ä¸å…¶å®ƒ
æµè¡Œè¯­è¨€ä¸å¤ªä¸€æ ·ã€‚ä»–ä¸å¦ä¸€åå¼€å‘è€… Ariel Manzur å…±åŒåˆä½œå¼€å‘äº† Godotï¼Œç”±äºå½“æ—¶é˜¿æ ¹å»·çš„æ”¿æ²»ä¸ç»æµ
ä¸€ç›´ä¸å¤ªç¨³å®šï¼Œå½±å“ Godot çš„å¼€å‘è¿›åº¦ï¼Œåœ¨ 2014 å¹´æ‰å‘å¸ƒäº† 1.0 ç‰ˆæœ¬ï¼Œä½†å½“æ—¶çš„ 2D å¼•æ“æœ‰å¾ˆå¤šé™åˆ¶ï¼Œ
æ— æ³•ä½¿ç”¨ 3Dï¼Œç›´åˆ° 2016 å¹´æ¨å‡ºçš„ 2.0 ç‰ˆæœ¬æ‰æ”¹è¿›äº†å¯ç”¨æ€§æ–¹é¢çš„é—®é¢˜ã€‚

GDScript æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹è„šæœ¬ï¼Œå®ƒä¸“é—¨ä¸º Godot æ¸¸æˆç¼–ç¨‹åšäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚å‘é‡å®šä¹‰ã€åŠç›¸å…³è¿ç®—æ–¹é¢çš„æ”¯æŒï¼Œ
è¿˜ match æ¨¡å¼åŒ¹é…åŠŸèƒ½ï¼Œæ–¹ä¾¿åšåˆ†æ”¯é€‰æ‹©ï¼Œæœ‰ 6 ç§ pattern typesï¼Œæ»¡è¶³å¤§å¤šæ•°åº”ç”¨åœºæ™¯ã€‚åŒ¹é…æ•°ç»„æ—¶ï¼Œ
æ•°ç»„å…ƒç´ é¡ºåºä¹Ÿéœ€è¦å¯¹åº”ã€‚è€ŒåŒ¹é…å­—å…¸åˆ™ä¸éœ€è¦é¡ºåºï¼Œå¹¶ä¸”ä¸æŒ‡å®šå€¼æ—¶ï¼Œåªéœ€è¦ keys åŒ¹é…ï¼š


```py
# 1. Constant pattern - Matches constant primitives, like numbers and strings.
     match x:
         1:
             print("We are number one!")
         2:
             print("Two are better than one!")
         "test":
                print("Oh snap! It's a string!")
# 2. Variable pattern - Matches the contents of a variable/enum.
        match typeof(x):
            TYPE_REAL:
                print("float")
            TYPE_STRING:
                print("text")
            TYPE_ARRAY:
                print("array")
# 3. Wildcard pattern - This pattern matches everything. 
        match x:
            1:
                print("It's one!")
            2:
                print("It's one times two!")
            _:
                print("It's not 1 or 2. I don't care to be honest.")
# 4. Binding pattern - A binding pattern introduces a new variable. 
        match x:
            1:
                print("It's one!")
            2:
                print("It's one times two!")
            var new_var:
                print("It's not 1 or 2, it's ", new_var)
# 5. Array pattern - Matches an array.
        match x:
            []:
                print("Empty array")
            [1, 3, "test", null]:
                print("Very specific array")
            [var start, _, "test"]:
                print("First element is ", start, ", and the last is \"test\"")
            [42, ..]:
                print("Open ended array")
# 6. Dictionary pattern - Works in the same way as the array pattern.
        match x:
            {}:
                print("Empty dict")
            {"name": "Dennis"}:
                print("The name is Dennis")
            {"name": "Dennis", "age": var age}:
                print("Dennis is ", age, " years old.")
            {"name", "age"}:
                print("Has a name and an age, but it's not Dennis :(")
            {"key": "godotisawesome", ..}:
                print("I only checked for one entry and ignored the rest")
# 7. Multiple patterns - Matches 
        match x:
            1, 2, 3:
                print("It's 1 - 3")
            "Sword", "Splash potion", "Fist":
                print("Yep, you've taken damage")
```

è„šæœ¬èµ„æºåœ¨å¼•æ“å†…éƒ¨éƒ½ä½¿ç”¨ `GDScript` ç±»å‹è¡¨ç¤ºï¼Œä½¿ç”¨``load`` æˆ–è€… ``preload``æ–¹æ³•åŠ è½½è„šæœ¬å³
å¯ä»¥è·å–åˆ°è„šæœ¬èµ„æºå¯¹è±¡ã€‚æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ gd è„šæœ¬æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªåŒ¿åç±»ï¼Œå¯ä»¥ï¼š

- ä½¿ç”¨ **extends** å…³é”®å­—æŒ‡å®šç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œä½¿ç”¨ `super` è°ƒç”¨çˆ¶ç±»æ„é€ å™¨æˆ–æ–¹æ³•ï¼›
- ä½¿ç”¨ **class_name** å…³é”®å­—æ³¨å†Œä¸ºä¸€ä¸ªå…¨å±€ç±»ï¼Œè¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ªå›¾æ ‡ï¼Œæ³¨å†Œåç±»ä¼šæ·»åŠ åˆ°èŠ‚ç‚¹åˆ—è¡¨ï¼›
- æ„é€ å‡½æ•°æ˜¯ ``_init``ï¼Œå®ä¾‹åŒ–ä¸€èˆ¬ä½¿ç”¨ `ClassName.new()` æ–¹æ³•è°ƒç”¨æ„é€ å™¨ï¼›

é€šè¿‡æ³¨å†Œç±»å‹å’Œé™æ€å‡½æ•°ï¼Œå·¥å…·å‡½æ•°å¯ä»¥å…¨å±€ç©ºé—´ä¸­ç»„ç»‡ï¼Œæ–¹ä¾¿è°ƒç”¨ï¼Œä¸å¿…ä½¿ç”¨ Singletons (AutoLoad)ï¼š

```py
class_name Utils

static func dbg(msg):
    print_debug(msg)
```

Singletons è¿˜æœ‰ä¸€å®šç”¨é€”ï¼Œå› ä¸º static åªèƒ½å®šä¹‰é™æ€å‡½æ•°ï¼Œä¸èƒ½å®šä¹‰é™æ€æˆå‘˜å±æ€§ã€‚æ¯ä¸ªå•æ€å¯¹è±¡éƒ½ä¼šåœ¨
/root/MySingleton è¿™ä¸ªè·¯å¾„ä¸­äº§ç”Ÿä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‡è®¾å•æ€ç±»åè®¾ç½®ä¸º MySingletonã€‚


Godot æ²¡æœ‰æä¾›ç›´æ¥åˆå§‹åŒ–å¤§æ•°ç»„çš„æ–¹æ³•ï¼Œä½¿ç”¨ range() å’Œ resize() å‡½æ•°é—´æ¥è·å–å¤§æ•°ç»„éœ€è¦çš„å†…å­˜ï¼Œ
æˆ–è€…é€šè¿‡ C++ åº•å±‚è¿›è¡Œå†…å­˜åŠ¨æ€åˆ†é…ã€‚

å…³äºæ•°ç»„çš„æ³¨æ„äº‹é¡¹ï¼š

ä½¿ç”¨ append_array() é™„åŠ æ–°æ•°æ®åˆ°æ•°ç»„ä¸­ï¼Œé¿å…å› ä½¿ç”¨ += æ“ä½œäº§ç”Ÿæ–°æ•°ç»„ï¼Œå¹¶ä¸”è¿›è¡Œæ•°æ®æ‹·è´ã€‚å¦‚æœï¼Œ
ç¡®å®šéœ€è¦æ–°çš„æ•°æ®å‰¯æœ¬ï¼Œä½¿ç”¨ duplicate() æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®š deep copy æˆ–è€… shallow copyã€‚

- Note: Concatenating with the += operator will create a new array, which has a cost.
- Note: Arrays are always passed by reference.
- Note: Erasing elements while iterating over arrays is not supported and will result in unpredictable behavior.

æ³¨æ„æ–‡æ¡£è¯´ï¼š const å£°æ˜æ•°ç»„åªä¼šé˜»æ­¢å¸¸é‡å…ƒç´ åˆåŒ–åå†èµ‹ä¸åŒå€¼ï¼Œæ•°ç»„æœ¬èº«ä»å¯ä¿®æ”¹ï¼Œé€šè¿‡åœ¨å•ä¸ªç´¢å¼•æˆ– 
pushing/removing å…ƒç´ æ¥æ”¹å˜æ•°ç»„æœ¬èº«ã€‚

å¸¸é‡ä¸èƒ½ä¿®æ”¹æ˜¯æ˜¾ç„¶çš„ï¼Œä½†æ˜¯ const ä¿®é¥°çš„æ•°ç»„æ€ä¹ˆå¯ä»¥æ”¹å˜å‘¢ï¼Ÿåº”è¯¥æ˜¯æ–‡æ¡£æé”™äº†ã€‚

```py
func _test_const():
    # Not allow reassign const value.
    const ca = [1,2,3]
    var ca2 = ca # ca2 reference to ca, it is const now. 

    # Parse Error: Cannot assign a new value to a constant.
    # ca = [4,5,6]

    # Parse Error: Cannot get index "3" from "[1, 2, 3]".
    # Parse Error: Cannot assign a new value to a constant.
    # ca[3] = 4

    # Invalid set index '3' (on base: 'Array') with value of type 'int'
    # ca2[3] = 5
    
    # ERROR: Array is in read-only state.
    # ca.resize(1000)
    # ca2.remove_at(0)
    # ca2.push_back(6)
    # ca2.insert(-1,7)

    ca2 = [4,5,6] # It's OK

    print_debug("const array: %s %s" % [ca, ca2])
    assert(ca[0] == 1, "Const 1D Array, passed by reference.")


func _test_copy():
    var a2d = [[1,2,3],[4,5,6]]
    var a2d2 = a2d.duplicate()     # shallow copy
    var a2d3 = a2d.duplicate(true) # deep copy
    a2d[1][0] = 6
    assert(a2d2[1][0] == 6, "Shallow copy, sub-array passed by reference.")
    assert(a2d3[1][0] == 4, "Deep copy, sub-array passed by value.")

func _test_array():
    var arr1d = [1,2,3]
    var arr1d2 = arr1d
    arr1d2[0] = arr1d[2]
    assert(arr1d[0] == 3, "1D Array, passed by reference.")

    var arr2d = [[1,2,3],[4,5,6],[7,8,9]]
    var arr2d2 = arr2d
    arr2d2[0] = arr2d[2]
    arr2d[2][0] = 9
    assert(arr2d[0] == [9,8,9], "2D Array, passed by reference.")
    print_debug("1D Array: %s \n2D Array: %s" % [arr1d, arr2d])
```

Godot 3.x æ²¡æœ‰ `super` ä¸èƒ½ä¸»åŠ¨è°ƒç”¨çˆ¶ç±»æ„é€ ï¼Œä½†å¯ä»¥é€šè¿‡ `func _init(args).(parent_args)` 
è¿™ç§æ–¹å¼æ¥å‘çˆ¶ç±»æ„é€ å™¨ä¼ é€’å‚æ•°ï¼Œè°ƒç”¨åŸºç±»æˆå‘˜æ–¹æ³•ä½¿ç”¨ `.base_method()` æ–¹å¼è°ƒç”¨ï¼ŒGodot 4.x æ”¹è¿›
åå°±ä¸å†éœ€è¦è¿™æ ·å¥‡æ€ªçš„è¯­æ³•äº†ã€‚å¹¶ä¸”ï¼Œæ—§ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿä¸èƒ½ç›´æ¥ç»§æ‰¿åŒæ–‡ä»¶ä¸‹çš„ç±»ï¼ŒGodot 4.x åˆ™å¯ä»¥ã€‚

æ­¤å¤–ï¼Œåœ¨æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨ `super()` è¿˜å¯ä»¥è°ƒç”¨çˆ¶ç±»ä¸­çš„åŒåæ–¹æ³•ï¼Œè€Œä¸ä»…ä»…æ˜¯è°ƒç”¨æ„é€ å™¨ã€‚

```py
    #!/usr/bin/env -S godot -s
    extends SceneTree
    class_name MyScene

    func _init():
        print_debug("bool to int false: %d, true: %d " % [int(false), int(true)])
        Derived.new().test()
        
        quit()

    class Base:

        #default extends to RefCounted

        func _init():
            print_debug("Base init ", self)

        func test():
            print_debug("Base test!")

    class Derived:

        extends Base

        func _init():
            super() # call Base._init()
            print_debug("Derived init ", self)

        func test():
            super() # call Base.test()
            print_debug("Derived test!")
```

æ¯ä¸ªç±»å¯ä»¥ä½¿ç”¨ä¸¤ç§åŸºæœ¬ç»§æ‰¿æ–¹å¼ï¼šé€šè¿‡å…¨å±€ç±»åæˆ–é€šè¿‡è„šæœ¬è·¯å¾„ï¼š

```py
    # Inherit/extend a globally available class.
    extends SomeClass

    # Inherit/extend a named class file.
    extends "somefile.gd"

    # Inherit/extend an inner class in another file.
    extends "somefile.gd".SomeInnerClass
    
    extends "../MyNode.gd"
    extends "res://src/MyNode.gd"
    extends "user://src/MyNode.gd"

    # extends Node
    # class_name Item, "res://interface/icons/item.png"
```

å¦‚æœç»§æ‰¿ä¸­ä½¿ç”¨è„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆè·¯å¾„å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„æˆ–è€…åè®®è·¯å¾„ï¼Œres:// å’Œ user:// éƒ½å¯ä»¥ã€‚æ³¨æ„ï¼Œ
ç›¸å¯¹è·¯å¾„è¿™ç§è¡¨è¾¾åªåœ¨ extends ä¸­ä½¿ç”¨ï¼ŒåŠ è½½èµ„æºæ—¶ä¸èƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¦‚ load() æˆ– preload()ã€‚
åœ¨ç¼–ç¨‹æ’ä»¶æ—¶ï¼Œç›¸å¯¹è·¯å¾„éå¸¸æœ‰ç”¨ï¼Œå¹¶ä¸”æ’ä»¶ä¸­æ³¨å†Œå¥½çš„ç±»å‹å¯ä»¥åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨ã€‚

æ³¨æ„ï¼Œå¦‚æœåœ¨ç”¨æˆ·ç›®å½•ä¸­ä¿å­˜è„šæœ¬ï¼Œè¿™äº›è„šæœ¬å³ä½¿ä½¿ç”¨ class_name æ³¨å†Œäº†åå­—ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨èŠ‚ç‚¹åˆ—è¡¨ä¸­ï¼Œ
ä¹Ÿä¸èƒ½ç›´æ¥åœ¨ extends ä¸­ä½¿ç”¨ç±»åä½œä¸ºæ‰©å±•çš„åŸºç±»ï¼ŒGodot ä¸ä¼šå»ä¸»åŠ¨è§£é‡Šå®ƒä»¬ï¼Œé™¤éä½¿ç”¨ load() è¿™ç±»
å‡½æ•°ä¸»åŠ¨åŠ è½½å®ƒä»¬ã€‚

å¦å¤–ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ç»§æ‰¿å¾—åˆ°çš„å­ç±»ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ class_name è¿›è¡Œæ³¨å†Œã€‚

ä½¿ç”¨ ``is`` å…³é”®å­—å¯ä»¥è¿›è¡Œç±»å‹åˆ¤æ–­ï¼Œç±»å‹å¯ä»¥æ˜¯é€šè¿‡ preload() æ–¹æ³•åŠ è½½çš„ GDScript å¯¹è±¡ï¼Œè¿™ç§
æ–¹å¼åŠ è½½çš„ç±»å‹ä¸º Constant namesï¼Œä½†æ˜¯ä¸èƒ½æ˜¯ load() æ–¹å¼åŠ è½½çš„ã€‚ä½¿ç”¨ print() å‡½æ•°æ‰“å°è‡ªå®šç±»å®ä¾‹ï¼Œ
ä¼šæ‰“å° Godot ç³»ç»Ÿå†…ç½®çš„çˆ¶ç±»ã€‚å¦‚æœï¼Œæ²¡ä½¿ç”¨æ˜¾å¼ç»§æ‰¿çˆ¶ç±»ï¼Œé‚£ä¹ˆé»˜è®¤çˆ¶ç±»ä¸º `Reference`ï¼ŒGodot 4.x
æ›´åä¸º `RefCounted`ã€‚

æ‰€æœ‰ç±»å‹éƒ½æœ‰ä¸€ä¸ªæšä¸¾å€¼å¯¹åº”ï¼ŒVariant.Type å®šä¹‰åœ¨ @GlobalScope å…¨å±€ç©ºé—´ï¼Œä½¿ç”¨ ``typeof`` å‡½æ•°
å¯ä»¥è·å–ç±»å‹çš„æšä¸¾å€¼ï¼Œä¾‹å¦‚ï¼Œtypeof("abc") æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„æšä¸¾å€¼ TYPE_STRINGã€‚

æ¯ä¸ª Variant å®ä¾‹è‡³å°‘å ç”¨å†…å­˜ä¸º 20 bytesï¼Œä½¿ç”¨ float ä½œä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œå¦‚æœä½¿ç”¨ double åˆ™
å ç”¨ 30 bytesã€‚å¦å¤–åƒ PoolVectorï¼Œaabbï¼Œmetrix è¿™äº›æ•°ç»„æˆ–ä¸“ç”¨ç±»å‹çš„é¢å¤–å†…å­˜å ç”¨å¦è®¡ã€‚

```py
    # Cache the enemy class.
    const Enemy = preload("enemy.gd")

    # Use 'is' to check inheritance.
    if entity is Enemy:
        entity.apply_damage()
```

GDSCript ç±»å‹ç³»ç»ŸåŒ…å«ä»¥ä¸‹å‡ ç§åˆ†ç±»ï¼š

- Built-in types (Array, Vector2, int, String, etc.).
- Engine classes (Node, Resource, Reference, etc.).
- Constant names (``const MyScript = preload("res://my_script.gd")``).
- Other classes in the same script, respecting scope (``InnerClass.NestedClass`` if you declared ``class NestedClass`` inside the ``class InnerClass`` in the same scope).
- Script classes declared with the ``class_name`` keyword.
- Autoloads registered as singletons.


Godot 4.x Beta 16 ä¸­åŸºç±»æ„é€ æ–¹æ³•ä¸ä¼šä¸»åŠ¨æ‰§è¡Œï¼Œé™¤éä½¿ç”¨ super() æ˜¾å¼è°ƒç”¨ï¼ŒGodot 3.5.1 åˆ™ä¼š
è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œä½†æ˜¯æ—§ç‰ˆæœ¬ä¸æ”¯æŒç»§æ‰¿åŒä¸€è„šæœ¬æ–‡ä»¶ä¸­çš„ç±»ï¼Œæ²¡æœ‰è§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ï¼š

```py
extends MyClass.InnerClass.NestedClass
# Default extends: RefCounted in Godot 4.x or Reference in Godot 3.x

class_name MyClass

# MyClass' constructor
func _init(seq):
    #super(seq+1)
    print("MyClass init: %s" % seq)

# Inner class
class InnerClass:
    extends MyClass.InnerClass.NestedClass
    # InnerClass' constructor
    func _init(seq):
        super(seq + 1)
        print("InnerClass init: %s" % seq)

    class NestedClass:
        extends Object
        func _init(seq):
            # Calls the method on the object during idle time. 
            self.call_deferred("_delay_4_idle", "call deferred not for RefCounted!")
            print("NestedClass init: %s" % seq)
        
        func _delay_4_idle(seq):
            print("NestedClass _delay_4_idle: %s" % seq)
```

ä¸æ´»åŠ¨åœºæ™¯æ ‘äº¤äº’éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºåœºæ™¯æ ‘ä½¿ç”¨äº†å¤šçº¿ç¨‹è¿›è¡Œè®¡ç®—å¤„ç†ã€‚ä¸ºäº†æ­£ç¡®å¤„ç†åœºæ™¯æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œ
ä½¿ç”¨å»¶åè°ƒç”¨ `Object.call_deferred()` ä¼šåœ¨åœºæ™¯è®¡ç®—å®Œæˆæ—¶æ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ï¼Œè¿™æ˜¯çº¿ç¨‹å®‰å…¨æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ
å¯¹èµ„æºå¼•ç”¨æ— æ•ˆï¼ŒåŸºç±» Object æˆ– Node ç±»å‹éƒ½å¯ä»¥ã€‚

ä½¿ç”¨ Expression å¯ä»¥è¿è¡Œæ—¶è§£æ GDScript è¡¨è¾¾å¼ï¼š

```py
onready var expression = Expression.new()

func _ready():
    $LineEdit.connect("text_entered", self, "_on_text_entered")

func _on_text_entered(command):
    var error = expression.parse(command, [])
    if error != OK:
        print(expression.get_error_text())
        return
    var result = expression.execute([], null, true)
    if not expression.has_execute_failed():
        $LineEdit.text = str(result)
```

ä½†æ˜¯ï¼ŒExpression ç±»å‹åªèƒ½è§£æè¡¨è¾¾å¼ï¼Œä¸èƒ½ç”¨æ¥å¤„ç†å‡½æ•°ã€ç±»ç­‰å¤æ‚è„šæœ¬ã€‚å¯ä»¥ä½¿ç”¨ `GDScript` ç±»å‹
æ¥è§£æå…¨åŠŸèƒ½çš„è„šæœ¬ï¼Œé€šè¿‡ `load()` ç­‰èµ„æºåŠ è½½æ–¹æ³•åŠ è½½è„šæœ¬æ–‡ä»¶ï¼Œè¿”å›çš„å°±æ˜¯è„šæœ¬å¯¹è±¡ï¼Œé€šè¿‡é™„åŠ åˆ°åœºæ™¯
æ ‘ä¸Šå®ä¾‹åŒ–æ‰§è¡Œã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨è®¾ç½® GDScript æºä»£ç èµ‹å€¼ç»™ source_code å±æ€§ï¼Œå¹¶è°ƒç”¨ reload() ä¹‹å
é™„åŠ åˆ°åœºæ™¯æ ‘ä¸Šæ‰§è¡Œã€‚

å¯ä»¥å€ŸåŠ© ClassDB è°ƒç”¨ C++ åº•å±‚å®ç°çš„è§£æå™¨å·¥å…·ç±»å‹å¯¹è„šæœ¬è¿›è¡Œå¤„ç†ï¼š

```py
const PARSE_WRAPPER_CLASS := "GDScriptParserWrap"

# Array[ScriptError]
var errors := []


func _init(new_script_text: String).(new_script_text) -> void:
    pass


func test() -> void:
    if ClassDB.class_exists(PARSE_WRAPPER_CLASS):
        var wrap: Reference = ClassDB.instance(PARSE_WRAPPER_CLASS)
        wrap.parse_script(_new_script_text)
        if wrap.has_error():
            var error_line: int = wrap.get_error_line() - 1
            var line_text := _new_script_text.split("\n")[error_line]
            var error_data := make_error_from_data(
                1,
                wrap.get_error(),
                "gdscript",
                -1,
                error_line,
                line_text.length() - line_text.strip_edges(true, false).length(),
                line_text.strip_edges(false).length()
            )
            errors = [error_data]
        else:
            errors = []
    else:
        push_error("Script Parser Wrapper class is missing!")
        var error := make_error_no_parser_wrapper_class()
        errors = [error]
        return
```


Godot å…¨å±€ç©ºé—´ @GDScript å’Œ @GlobalScope åŒ…å«æ‰€æœ‰è„šæœ¬ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å‡½æ•°ï¼Œç”¨æˆ·è¦å‘å…¨å±€ç©ºé—´
æ·»åŠ å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨å·¥ç¨‹è®¾ç½®è‡ªåŠ¨åŠ è½½ï¼ŒSingletons (AutoLoad)ï¼Œè‡ªåŠ¨åŠ è½½å¾—åˆ°ä½äºå…¨å±€ç©ºé—´çš„å•æ€å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œå°†ä»¥ä¸‹è„šæœ¬ä¿å­˜åˆ° Global.gdï¼Œå¹¶è®¾ç½®å·¥ç¨‹çš„ AutoLoad åŠ è½½å®ƒï¼Œå³å¯ä»¥å®ç°è‡ªåŠ¨å‰§ä¸­çª—å£ã€‚è¿è¡Œç¨‹åº
æ—¶ï¼Œå¼•æ“å°†åŠ è½½å¹¶é™„ç€ GlobalNS åˆ°åœºæ™¯æ ‘ä¸Šï¼Œåˆå§‹åŒ–æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼š

```py
extends Node

class_name GlobalNS

func _init():
    print("Global.gd _init")
    # Center window on screen
    var screen_size = OS.get_screen_size(OS.get_current_screen())
    var window_size = OS.get_window_size()
    var centered_pos = (screen_size - window_size) / 2
    OS.set_window_position(centered_pos)
```

ä»ç¼–è¯‘å™¨åŸç†çš„è§’åº¦çœ‹ï¼ŒGDScript grammar æ˜¯ä¸€ç§ EBNF èŒƒå¼ï¼Œæ‰€ä»¥èŒƒå¼å°±æ˜¯ä¸€ç§è¯­æ³•ä¹¦å†™æ ¼å¼ã€‚
GDScript è„šæœ¬è§£æå™¨æ ¹æ®è¿™ç§è¯­æ³•æ¥å¤„ç†è„šæœ¬ï¼ŒæŒ‰è§„åˆ™è§£æåå†æ‰§è¡Œè„šæœ¬ã€‚

çœ‹æ‡‚ GDScript EBNF grammar è§„èŒƒåä¹Ÿå°±ç›¸å½“äºæŒæ¡äº† Godot è„šæœ¬ç¼–ç¨‹ï¼Œæ¥çœ‹å¼€å¤´éƒ¨åˆ†ï¼š

    (* GDScript EBNF grammar.
       Uppercase words are terminals generated by the tokenizer.
       INDENT/DEDENT are not generated by the tokenizer yet, but they are added
       here for reading convenience.
       Naturally, this only cover syntax. Semantics can't be inferred from this
       description.
    *)

    program = [ inheritance NEWLINE ] [ className ] { topLevelDecl } ;

    inheritance = "extends" ( IDENTIFIER | STRING ) { "." IDENTIFIER } ;
    className = "class_name" IDENTIFIER [ "," STRING ] NEWLINE ;

    topLevelDecl
        = classVarDecl
        | constDecl
        | signalDecl
        | enumDecl
        | methodDecl
        | constructorDecl
        | innerClass
        | "tool"
        ;

è¿™ä¸ªéƒ¨åˆ†æ˜¯è¯´ï¼Œä¸€ä¸ªè„šæœ¬ç¨‹åº program åº”è¯¥åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†çš„å†…å®¹ï¼Œæ–¹æ‹¬å·è¡¨ç¤ºå¯é€‰é¡¹ï¼ŒèŠ±æ‹¬å·è¡¨ç¤ºå¿…é€‰é¡¹ï¼š

- [ inheritance NEWLINE ] å¯é€‰çš„ç»§æ‰¿å…³ç³»å®šä¹‰ï¼Œç‹¬å ä¸€è¡Œï¼Œä½¿ç”¨ **extends** å…³é”®å­—ï¼›
- [ className ] å¯é€‰çš„ç±»åå®šä¹‰ï¼Œä½¿ç”¨ **class_name** å…³é”®å­—ï¼Œåé¢å¯ä»¥æŒ‡å®šä¸€ä¸ªå›¾æ ‡ï¼›
- { topLevelDecl } å¿…é€‰çš„é¡¶çº§å£°æ˜ï¼ŒåŒ…å«ç±»æˆå‘˜ã€å¸¸é‡ã€ç”¨æˆ·ä¿¡å·ã€æšä¸¾ã€æ–¹æ³•ã€æ„é€ ã€å†…éƒ¨ç±»ã€ç¼–è¾‘å™¨å·¥å…·ç­‰ç­‰ï¼›



### ğŸŸ ğŸ”µ Threads & Coroutines
- https://docs.godotengine.org/en/stable/classes/class_@gdscript.html
- https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_basics.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/gdscript/gdscript_basics.html
- https://docs.godotengine.org/en/latest/tutorials/scripting/c_sharp/c_sharp_differences.html#await-keyword
- [Using multiple threads](https://docs.godotengine.org/en/stable/tutorials/performance/threads/using_multiple_threads.html)
- [Add 'await' operator to GDScript](https://github.com/godotengine/godot/pull/32034)

æ“ä½œç³»ç»Ÿä»¥è¿›ç¨‹ Process ä½œä¸ºèµ„æºåˆ†é…å’Œç®¡ç†çš„åŸºæœ¬å•ä½ï¼Œä»¥çº¿ç¨‹ Thread ä¸ºä»£ç æ‰§è¡Œçš„åŸºæœ¬å•ä½ã€‚è€Œåç¨‹
Coroutines æ˜¯çº¿ç¨‹å†…æ¨¡æ‹Ÿå¤šçº¿ç¨‹çš„å¹¶å‘å¤„ç†é—®é¢˜èƒ½åŠ›çš„ä¸€ç§å¹¶å‘æŠ€æœ¯ã€‚

Godot 3 å…¨å±€å‡½æ•° `yield()` æœ‰ä¸¤å¤§ç”¨é€”ï¼Œå®ƒå’Œåç¨‹æ˜¯ä¸€ä½“çš„æ¦‚å¿µï¼Œå› ä¸ºéœ€è¦é€šè¿‡ yield æ”¯æŒåç¨‹ã€‚ç‰ˆæœ¬
å‡çº§åï¼Œyield å…¨å±€å‡½æ•°è¢«æ›¿æ¢ä¸º Godot 4 çš„ await å…³é”®å­—ã€‚

å‡çº§åˆ° Godot 4 åï¼Œ`yield()` å…¨å±€å‡½æ•°å·²ç»ç§»é™¤ï¼Œåªæ˜¯å¢åŠ äº†ä¸€ä¸ª yield å…³é”®å­—ä½œä¸ºç‰ˆæœ¬å˜åŒ–çš„è¿‡åº¦ã€‚
ä»£ç ä¸­ä½¿ç”¨åˆ° yield å…³é”®å­—æ—¶ï¼Œå°±ä¼šè¢«æç¤ºåº”è¯¥ä½¿ç”¨ await å…³é”®å­—æ›¿ä»£ã€‚

ä¸æ—©æœŸçš„ `yield()` ä¸åŒï¼Œä¸ºäº†ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œæ— æ³•é€šè¿‡ await è·å¾—å‡½æ•°çŠ¶æ€å¯¹è±¡ã€‚æœ‰äº†è¿™ç§ç±»å‹å®‰å…¨æ€§ï¼Œ
ä¸€ä¸ªå‡½æ•°å°±ä¸èƒ½è¯´å®ƒåœ¨è¿è¡Œæ—¶è¿”å›ä¸€ä¸ª intï¼Œè€Œå®é™…ä¸Šå®ƒåœ¨è¿è¡ŒæœŸé—´è¿”å›ä¸€ä¸ªå‡½æ•°çŠ¶æ€å¯¹è±¡ã€‚

```py
GDScriptFunctionState yield ( Object object=null, String signal="" )
```

æ–‡æ¡£ä¸­å±•ç¤ºäº†ä¸¤ç§ yield ç”¨æ³•ï¼šä¼ é€’æ•°æ®å’Œç­‰å¾…ä¿¡å·ï¼Œå…¶ä¸­æœ€åä¸€ç§ç­‰å¾…åç¨‹ completed å®Œæˆä¿¡å·æ˜¯æœ€æ™®éï¼Œ
å¦å¤–ï¼Œç­‰å¾…å®šæ—¶å™¨ timeout ä¿¡å·ä¹Ÿæ˜¯æœ€å¸¸è§çš„ç”¨æ³•ï¼š

- Coroutines with yield, to pass values between ``yield()`` and ``resume()``
- Coroutines & signals, yield(node, "signal")
- Coroutines & signals, yield(coroutine, "completed")

```py
func wait_confirmation():
    print("Prompting user")
    await $Button.button_up # Waits for the button_up signal from Button node.
    print("User confirmed")
    return true

func request_confirmation():
    await get_tree().process_frame
    var confirmed = await wait_confirmation()
    if confirmed:
        print("User confirmed")
    else:
        print("User cancelled")
```

å‡½æ•°ä¸­ä½¿ç”¨ yield æˆ– await å°±æ˜¯åœ¨å®šä¹‰ä¸€ä¸ªåç¨‹å‡½æ•°ï¼Œ"è°ƒç”¨åç¨‹å‡½æ•°"å…¶å®å¹¶ä¸æ˜¯åœ¨è°ƒç”¨å‡½æ•°ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œ
åç¨‹ï¼è®¤æ¸…è¿™ä¸ªæ¦‚å¿µå¾ˆé‡è¦ï¼Œåç¨‹æ‰§è¡Œåˆ° `yield()` è°ƒç”¨è¿™é‡Œï¼Œå°±æ”¾å¼ƒ CPU æ—¶é—´è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°å…¶å®ƒåç¨‹æ‰§è¡Œ
`resume()` æ¢å¤è¿™ä¸ªåç¨‹ç»§ç»­è¿è¡Œï¼š

```py
func my_func():
    var world = yield()
    print("Hello ", world)
    return "cheers!"

func _ready():
    var y = my_func() # return GDScriptFunctionState
    var cheers = y.resume("world")
    # 'y' resumed and is now an invalid state.
    print(cheers)

# Output:
# Hello world
# cheers!
```

å¼•å…¥ wait ä½œä¸ºå…³é”®å­—çš„åŠ¨æœºæ˜¯ç®€åŒ– yield() å…¨å±€å‡½æ•°çš„ä½¿ç”¨ï¼Œæ»¡è¶³ Godot ç¤¾åŒºçš„è¯‰æ±‚ï¼Œè¯­æ³•ä¸Šæœ‰äº›å·®åˆ«ã€‚
å‡è®¾ could_yield() æ˜¯ä¸€ä¸ªå¯ç­‰å¾…çš„å‡½æ•°ï¼Œyield å’Œ await ä¸¤ç§æ“ä½œç­‰ä»·å…³ç³»å¦‚ä¸‹ï¼š

```py
    var x = could_yield()
    if x is GDScriptFunctionState:
        x = yield(x, "completed")

    # This PR introduces an await operator to clear away this friction.
    var x = await could_yield()
```

ä½¿ç”¨ `await` æ˜¾ç„¶æ˜¯ç®€æ´çš„ï¼Œç›¸å¯¹ä½¿ç”¨å‡½æ•°çŠ¶æ€å¯¹è±¡çš„ yield æ–¹å¼å› ä¸ºæ½œå‡½æ•°å†…éƒ¨æ²¡æœ‰ä½¿ç”¨ yield çš„å¯èƒ½ï¼Œ
æ‰€ä»¥éœ€è¦è¿›è¡Œåˆ¤æ–­ã€‚è€Œä½¿ç”¨ await å°±ä¸ç”¨è€ƒè™‘è¿™ç§å¯èƒ½ï¼Œå› ä¸ºåœ¨ `could_yield()` ä¸æ˜¯åç¨‹çš„æƒ…å†µä¸‹ï¼Œå°±ç›¸å½“
äºæ²¡æœ‰ä½¿ç”¨ `await` è¿™ä¸ªå…³é”®å­—ï¼ŒåŒæ ·å¯ä»¥è·å¾—å‡½æ•°çš„è¿”å›å€¼ã€‚å¦ä¸€ä¸ªå·®åˆ«å°±æ˜¯ `await` æ–¹å¼ä¸­ï¼Œx åªè®¡ç®—ä¸€æ¬¡ï¼Œ
æ— æ³•åƒæ—§å¼é‚£æ ·å¯ä»¥ä½¿ç”¨ resume() æ–¹æ³•ä¼ é€’æ•°æ®ã€‚await å¯çœ‹ä½œæœ€é«˜ä¼˜å…ˆçº§çš„ä¸€å…ƒè¿ç®—ç¬¦ï¼Œå…¶ä»–è¡¨è¾¾å¼ä¸­å¯ç”¨ã€‚

This await operator would have a couple of benefits:

01. Saves a lot of typing for one of the most common use cases of GDScript coroutines
02. Accomplishes what is otherwise syntactically impossible without introducing a local variable
03. Doesn't affect GDScript's bytecode format
04. await is still a valid identifier for non-local variables, so APIs using this name will not break
05. Fulfills a common request from the community (#21039, #22947, #30328 )

Godot ç¤¾åŒºçš„æ™®éè¯‰æ±‚æ˜¯ï¼Œä½¿ç”¨ "completed" ä¿¡å·ä½œä¸º yield() çš„é»˜è®¤å‚æ•°ï¼Œå¼•å…¥ await å…³é”®å­—ï¼Œä»¥åŠ 
å¸Œæœ›æ·»åŠ  fluent syntaxã€‚åœ¨å¼•å…¥ await ä¹‹å‰ï¼Œç¤¾åŒºå¯¹ yield å¯èƒ½çš„å„ç§è¡¨è¾¾æ–¹å¼çš„è§‚ç‚¹å¦‚ä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨
åµŒå¥—ä½¿ç”¨ yield çš„æƒ…å†µä¸‹ï¼Œä»£ç ç›¸å½“è‡ƒè‚¿ï¼š

```py
# yield() calls are nested.
yield(yield(foo(), "completed").bar(), "completed")

# "fluent" yielding with signals that looks like subject.yield(signal).
foo().yield("completed").bar().yield("completed")

# to wait on the "completed" signal of a GDScriptFunctionState (a very common use case),
# the argument between the parenthesis can be omitted.
foo().yield().bar().yield()
```

æ–°ç‰ˆæœ¬æ”¹ç”¨ await å…³é”®å­—åï¼Œä½¿ç”¨æ–¹å¼ä¸Šæœ‰äº›å·®åˆ«ã€‚é¦–å…ˆï¼Œå®ƒå·²ç»ä¸æ˜¯å‡½æ•°äº†ï¼Œä¸éœ€è¦ä½¿ç”¨åœ†æ‹¬å·ã€‚å…¶æ¬¡ï¼Œè°ƒç”¨
åç¨‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨ await å‰ç½®åœ¨åç¨‹åç§°å‰é¢ã€‚æœ€åå°±æ˜¯ï¼Œä¸èƒ½ä½¿ç”¨åƒ yield() è¿™æ ·çš„ç©ºç­‰å¾…ã€‚å¦å¤–ï¼Œä¹Ÿæ²¡æœ‰
resume() è¿™æ ·æ–¹æ³•æ¥ä¼ é€’æ•°æ®ï¼Œéœ€è¦ç»“åˆä¿¡å·é‡æ–°è®¾è®¡ä»£ç ï¼Œåç¨‹æœ¬èº«åªæœ‰ä¸€ä¸ªè¿”å›å€¼å¯ä»¥é€šè¿‡ await è·å–ï¼š

```py
#!/usr/bin/env -S godot -s
# class_name MyScene
# extends SceneTree

# func _init():
#     assert(Engine.get_version_info().major == 4)
#     root.title = "MyScene 4.x" # root is Window in Godot 4
#     root.set("theme_override_colors/title_color", Color.YELLOW)
#     co_test()
#     # quit()


func co_func():
    for i in range(1, 5):
        await create_timer(.1).timeout # wait for a timeout signal.
        await process_frame            # wait for next idle_frame.
        print("Turn %d" % i)


func co_test():
    var co = await co_func()
    assert(typeof(co) == TYPE_NIL) # nothing return from co_func()
    print_debug("co_test done with %s" % [co])
```

æ‰§è¡Œåç¨‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°çŠ¶æ€å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªçŠ¶æ€å¯¹è±¡æ¥æ”¹å˜åç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå‚æ•°å¯ä»¥é€šè¿‡ yield() å’Œ
resume() è¿›è¡Œä¼ é€’ã€‚

å¦‚æœåç¨‹ä¸­è¿˜æœ‰æ›´å¤šå¤šçš„ yield() è°ƒç”¨ï¼Œé‚£ä¹ˆ resume() æ¢å¤åç¨‹ååˆç»§ç»­è·å¾—æ›´å¤šçš„ FunctionStateï¼Œ
ç›´åˆ°è·å–åˆ°åç¨‹ return è¿”å›çš„å€¼ã€‚è¿”å›çš„å‡½æ•°çŠ¶æ€ä»£è¡¨ suspended stateã€‚

å¦‚æœç»™ yield() ä¼ å…¥å‚æ•°ï¼Œé‚£ä¹ˆè¿™æ—¶å°±æ˜¯åœ¨ä½¿ç”¨å¦ä¸€ä¸ªåŠŸèƒ½ï¼šç­‰å¾…ä¿¡å·ï¼Œç›´åˆ°ä¿¡å·è§¦å‘æ‰ç»§ç»­æ‰§è¡Œï¼Œç›¸å½“äº
ä¸€ä¸ªåŒ¿ååç¨‹ï¼Œç­‰å¾…ä¸­çš„ä¿¡å·è´Ÿè´£æ¢å¤åç¨‹çš„æ‰§è¡Œã€‚

```py
# Resume execution the next frame.
yield(get_tree(), "idle_frame")

# Resume execution when animation is done playing.
yield(get_node("AnimationPlayer"), "animation_finished")

# Wait 5 seconds, then resume execution.
yield(get_tree().create_timer(5.0), "timeout")

if armor <= 0:
    create_explosion()
    yield(get_tree().create_timer(.5), "timeout")
    queue_free()
```

åç¨‹æœ¬èº«è½¬æ¢åˆ° invalid çŠ¶æ€æ—¶ä½¿ç”¨çš„æ˜¯ `completed` ä¿¡å·ï¼Œå³åç¨‹å·²ç»è¿è¡Œå®Œæˆï¼Œå˜æˆæ— æ•ˆçŠ¶æ€ã€‚
åœ¨ä¸çŸ¥é“è¯¥ä¸è¯¥ç”¨ yield() æˆ–è€…è¯¥ç”¨å¤šå°‘æ¬¡æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªä¿¡å·ï¼Œç­‰å¾…åç¨‹ç»“æŸã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºèŒƒ
ä»£ç ï¼Œå°±ä¼šç­‰å¾…æ‰€æœ‰æŒ‰é’®éƒ½è§¦å‘ `pressed` ä¿¡å·ï¼Œå³éƒ½è¢«æŒ‰ä¸‹åï¼Œ`button_func()` åç¨‹å°±æ‰§è¡Œå®Œæ¯•ï¼Œ
å¹¶ä¸”æ¢å¤ `my_func()` åç¨‹çš„è¿è¡Œï¼š

```py
func my_func():
    yield(button_func(), "completed")
    print("All buttons were pressed, hurray!")


func button_func():
    yield($Button0, "pressed")
    yield($Button1, "pressed")
```

å¯ä»¥é€šè¿‡å¾ªç¯å¤„ç†æ‰¹é‡çš„ GDScriptFunctionStateï¼š

```py
func co_func():
    for i in range(1, 5):
        print("Turn %d" % i)
        yield();


func _ready():
    var co = co_func();
    while co is GDScriptFunctionState && co.is_valid():
        co = co.resume();
```

å¦‚æœä½¿ç”¨ C#ï¼Œå› ä¸ºå®ƒæœ¬èº«æœ‰ await æœºåˆ¶ï¼Œä½¿ç”¨ GodotObject.ToSignal å¯ä»¥å°† Godot ä¿¡å·è½¬æ¢ä¸º
C# ä¸­çš„å¯ç­‰å¾…å¯¹è±¡ï¼š

```C#
    await ToSignal(timer, "timeout");
    GD.Print("After timeout");
```



Godot è‡ªå¸¦çš„ GDScript è„šæœ¬å’Œ Python è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹æ”¯æŒä¸Šè¦å¥½å¾ˆå¤šã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä½¿ç”¨
Thread ç±»åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œç„¶åï¼Œæ‰§è¡Œ **start()** å°±ä¼šåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ç§æ‰§è¡Œ GDScript å‡½æ•°ï¼Œè°ƒç”¨
çº¿ç¨‹å¯¹è±¡çš„ **wait_to_finish()** è¿›å…¥é˜»å¡ä»¥ç­‰å¾…çº¿ç¨‹å®Œæˆå·¥ä½œã€‚

```py
var thread

# The thread will start here.
func _ready():
    thread = Thread.new()
    # Third argument is optional userdata, it can be any variable.
    thread.start(self, "_thread_function", "Wafflecopter")


# Run here and exit.
# The argument is the userdata passed from start().
# If no argument was passed, this one still needs to
# be here and it will be null.
func _thread_function(userdata):
    # Print the userdata ("Wafflecopter")
    print("I'm a thread! Userdata is: ", userdata)

# Thread must be disposed (or "joined"), for portability.
func _exit_tree():
    thread.wait_to_finish()
```

å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­æ•°æ®ç«æ€é—®é¢˜ Data race æ˜¯æ™®éçš„ï¼Œå³ä¸åŒçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´è¯»å†™åŒä¸€ä»½æ•°æ®å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸
å®Œæ•´ï¼Œå‡ºç°é€»è¾‘é”™è¯¯ã€‚è€Œä¸ºäº†ä¿è¯å…³é”®æ•°æ®çš„é€»è¾‘ä¸€è‡´æ€§ï¼Œé€šå¸¸éœ€è¦å¼•å…¥å„ç§åŒæ­¥æŠ€æœ¯ï¼ŒåŒ…æ‹¬å„ç§åŒæ­¥é”ï¼Œè¿™ä¹Ÿ
å°±å¼•å…¥é¢å¤–çš„å¤šçº¿ç¨‹ç¼–ç¨‹é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹çš„æ­»é”é—®é¢˜ï¼Œä¸€ä¸ªçº¿ç¨‹å¯èƒ½å…ˆè·å–åˆ°èµ„æºï¼Œå¹¶é”å®šå®ƒï¼Œä½†åç»­å¯èƒ½æŸäº›
å¼‚å¸¸å¯¼è‡´çº¿ç¨‹å¡æ­»ï¼Œä»è€Œåˆå¯¼è‡´äº†èµ„æºè¢«é”æ­»å¾—ä¸åˆ°é‡Šæ”¾ã€‚

Godot æä¾›äº†ä¸¤ç§çº¿ç¨‹åŒæ­¥å·¥å…·ï¼š

- **Mutex** äº’æ–¥é”ï¼Œé€šè¿‡ lock() å’Œ unlock() æ–¹æ³•é”å®šã€è§£é”èµ„æºï¼Œèµ„æºè¯»å†™æ“ä½œåœ¨ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´ï¼›
- **Semaphore** ä¿¡å·é‡ï¼Œé€šè¿‡ wait() å’Œ post() æ–¹æ³•ä½¿ç”¨çº¿ç¨‹æŒ‚èµ·æˆ–æ¢å¤æ‰§è¡Œï¼›

ä½¿ç”¨ä¿¡å·é‡å¯ä»¥æŒ‰éœ€è¦è¿è¡Œçº¿ç¨‹ï¼Œæ¢å¥è¯è¯´ï¼Œå‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™å·¥ä½œï¼Œå½“å®ƒä»€ä¹ˆéƒ½ä¸åšæ—¶è®©å®ƒæš‚åœã€‚ä¿¡å·é‡ **wait()**
å‡½æ•°ç”¨æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç›´åˆ°ä¸€äº›æ•°æ®åˆ°è¾¾ã€‚ç›¸åï¼Œä¸»çº¿ç¨‹ä½¿ç”¨ä¿¡å·é‡ **post()** è¡¨ç¤ºæ•°æ®å·²å‡†å¤‡å¥½å¤„ç†ã€‚

ä¿¡å·é‡èµ·å§‹è®¡æ•°ä¸º 0ï¼Œè¡¨ç¤ºèµ„æºæ²¡æœ‰æ‰§è¡Œæƒï¼Œwait() å‡½æ•°åçš„ä»£ç å°±ä¼šè¢«é˜»å¡ï¼Œé˜»æ­¢å…¶å®ƒçº¿ç¨‹æ‰§è¡Œç›´åˆ°æœ‰æ•°æ®ã€‚

```py
    var counter = 0
    var mutex
    var semaphore
    var thread
    var exit_thread = false


    # The thread will start here.
    func _ready():
        mutex = Mutex.new()
        semaphore = Semaphore.new()
        exit_thread = false

        thread = Thread.new()
        thread.start(self, "_thread_function")


    func _thread_function(userdata):
        while true:
            semaphore.wait() # Wait until posted.

            mutex.lock()
            var should_exit = exit_thread # Protect with Mutex.
            mutex.unlock()

            if should_exit:
                break

            mutex.lock()
            counter += 1 # Increment counter, protect with Mutex.
            mutex.unlock()


    func increment_counter():
        semaphore.post() # Make the thread process.


    func get_counter():
        mutex.lock()
        # Copy counter, protect with Mutex.
        var counter_value = counter
        mutex.unlock()
        return counter_value


    # Thread must be disposed (or "joined"), for portability.
    func _exit_tree():
        # Set exit condition to true.
        mutex.lock()
        exit_thread = true # Protect with Mutex.
        mutex.unlock()

        # Unblock by posting.
        semaphore.post()

        # Wait until it exits.
        thread.wait_to_finish()

        # Print the counter.
        print("Counter is: ", counter)
```


### ğŸŸ ğŸ”µ GodotObject is Base
- https://docs.godotengine.org/en/stable/development/cpp/object_class.html
- https://docs.godotengine.org/en/stable/development/cpp/variant_class.html
- https://docs.godotengine.org/en/stable/development/cpp/inheritance_class_tree.html
- https://docs.godotengine.org/en/latest/tutorials/best_practices/data_preferences.html
- https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/godot_architecture_diagram.html
- https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/common_engine_methods_and_macros.html
- https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/core_types.html
- https://docs.godotengine.org/en/latest/contributing/development/core_and_modules/object_class.html
- https://docs.godotengine.org/en/latest/tutorials/best_practices/godot_notifications.html
- https://docs.godotengine.org/en/latest/tutorials/best_practices/node_alternatives.html
- https://docs.godotengine.org/en/latest/classes/class_object.html
- https://docs.godotengine.org/en/latest/classes/class_signal.html
- godot-docs\classes\class_object.rst
- godot\modules\gdscript\gdscript.cpp
- godot\3.5.1-stable\core\object.h
- godot\3.5.1-stable\core\class_db.h
- godot\3.5.1-stable\core\variant.h
- godot\master\core\object\object.h
- godot\master\core\object\class_db.h
- godot\master\core\variant\variant.h
- godot-docs\classes\class_signal.rst

<!-- ![Inheritance class tree](https://docs.godotengine.org/en/stable/_images/Object.png) -->
![Godot's architecture diagram](https://docs.godotengine.org/en/latest/_images/architecture_diagram.jpg)

Godot 4.x C# åŸºç¡€ç±»æ›´åä¸º `Godot.GodotObject`ï¼Œæ—§ç‰ˆæœ¬ `Godot.Object` ä¸ºæ‰€æœ‰ç±»å‹çš„åŸºç±»ã€‚
åŸºç±»æ˜¯ GDScript ä¸ C++ ä¹‹é—´çš„æ¡¥æ¢ï¼Œå½“ç„¶è¿˜æœ‰ ClassDB è¿™ä¸ªç±»å‹æ³¨å†Œä¸­å¿ƒï¼ŒObject åŸºç¡€ç±»å®ç°çš„
é‡è¦æœºåˆ¶å¦‚ä¸‹ï¼š

- Object.new()/init/free ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼›
- properties å±æ€§è¯»å†™ã€å¯¼å‡ºæœºåˆ¶ï¼›
- notify é€šçŸ¥æœºåˆ¶ï¼›
- signal ä¿¡å·æœºåˆ¶ï¼›
- script è„šæœ¬é™„åŠ æ‰©å±•æœºåˆ¶ï¼›
- reflection åå°„è°ƒç”¨æœºåˆ¶ï¼›
- deferred å»¶åè°ƒç”¨æœºåˆ¶ï¼›
- Localization using gettext å›½é™…åŒ–/æœ¬åœ°åŒ–æœºåˆ¶ï¼›
- meta å…ƒæ•°æ®ï¼›

åœ¨ä¸åŒè¯­è¨€ä¸­ä½¿ç”¨ä¸åŒçš„æ–¹æ³•å®ä¾‹åŒ–ï¼š

- GDScript: Object.new()
- C#: new Object
- VisualScript: Construct Object

æ³¨æ„ï¼šå› ä¸ºé€»è¾‘é—®é¢˜ï¼ŒObject æœ¬èº«ä¸èƒ½é€šè¿‡ Object.new() å®ä¾‹åŒ–ï¼Œè¿™ä¸ª bug åªå‡ºç°åœ¨ Object è¿™é‡Œã€‚
å¯ä»¥ä½¿ç”¨  ClassDB.instance("Object") æ¥å®ä¾‹åŒ–åŸºç¡€ç±»ã€‚åªæœ‰ Godot å¼•æ“å†…éƒ¨å®šä¹‰çš„ç±»å‹æ‰éœ€è¦ä½¿ç”¨
new() æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ï¼Œåƒ Vector è¿™ç±»åŸºç¡€æ•°æ®ç»“æ„ä¸éœ€è¦ã€‚

```C++,ignore
GDScriptNativeClass::GDScriptNativeClass(const StringName &p_name) {
    name = p_name;
}

void GDScriptNativeClass::_bind_methods() {
    ClassDB::bind_method(D_METHOD("new"), &GDScriptNativeClass::_new);
}

Variant GDScriptNativeClass::_new() {
    Object *o = instance();
    ERR_FAIL_COND_V_MSG(!o, Variant(), "Class type: '" + String(name) + "' is not instantiable.");

    Reference *ref = Object::cast_to<Reference>(o);
    if (ref) {
        return REF(ref);
    } else {
        return o;
    }
}

Object *GDScriptNativeClass::instance() {
    return ClassDB::instance(name);
}
```

ClassDB ç±»å‹æ³¨å†Œä¸­å¿ƒç›¸å…³ APIï¼Œåœ¨ ClassInfo å®šä¹‰äº† creation_func æ¥å¼•ç”¨æ„é€ å™¨ï¼š

```C++,ignore
static HashMap<StringName, ClassInfo> classes;
static HashMap<StringName, StringName> resource_base_extensions;
static HashMap<StringName, StringName> compat_classes;

Object *ClassDB::instance(const StringName &p_class) {
    ClassInfo *ti;
    {
        OBJTYPE_RLOCK;
        ti = classes.getptr(p_class);
        if (!ti || ti->disabled || !ti->creation_func) {
            if (compat_classes.has(p_class)) {
                ti = classes.getptr(compat_classes[p_class]);
            }
        }
        ERR_FAIL_COND_V_MSG(!ti, nullptr, "Cannot get class '" + String(p_class) + "'.");
        ERR_FAIL_COND_V_MSG(ti->disabled, nullptr, "Class '" + String(p_class) + "' is disabled.");
        ERR_FAIL_COND_V_MSG(!ti->creation_func, nullptr, "Class '" + String(p_class) + "' or its base class cannot be instantiated.");
    }
#ifdef TOOLS_ENABLED
    if (ti->api == API_EDITOR && !Engine::get_singleton()->is_editor_hint()) {
        ERR_PRINT("Class '" + String(p_class) + "' can only be instantiated by editor.");
        return nullptr;
    }
#endif
    return ti->creation_func();
}
bool ClassDB::can_instance(const StringName &p_class) {
    OBJTYPE_RLOCK;

    ClassInfo *ti = classes.getptr(p_class);
    ERR_FAIL_COND_V_MSG(!ti, false, "Cannot get class '" + String(p_class) + "'.");
#ifdef TOOLS_ENABLED
    if (ti->api == API_EDITOR && !Engine::get_singleton()->is_editor_hint()) {
        return false;
    }
#endif
    return (!ti->disabled && ti->creation_func != nullptr);
}
```

å¯èƒ½æ˜¯å‡ºäº Godot 4 å¼€å‘è€…çš„ä¸ªäººå–œå¥½ï¼Œå®ä¾‹åŒ–çš„ç›¸å…³æ–¹æ³•åç§°æ›´æ”¹ä¸º instantiateï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯åŠ¨è¯ï¼š

```C++,ignore
Variant instantiate(class: StringName) const
bool can_instantiate(class: StringName) const
```

ä»¥ä¸‹ç¤ºèŒƒåŠ¨æ€åŠ è½½å¹¶æ‰§è¡Œè„šæœ¬ï¼š

```py
#!/usr/bin/env -S godot -s
extends SceneTree
class_name MyScene

var script_text = """
extends Node2D
func _init():
    print_debug("script_text")
"""

func _init():
    script_test()
    assert(Engine.get_version_info().major == 4)
    root.title = "MyScene 4.x" # root is Window in Godot 4
    root.set("theme_override_colors/title_color", Color.YELLOW)
    # quit()

func script_test():
    var script = GDScript.new()
    # script = preload("path/to/script.gd")
    script.source_code = script_text
    var is_valid = script.reload()
    if is_valid != OK:
        print_debug("Script error: %d" % is_valid)
    # ClassDB.can_instance("Node2D") in Godot 3.x
    elif ClassDB.can_instantiate("Node2D"):
        var object = ClassDB.instantiate("Node2D")
        object.set_script(script)
        root.add_child(object)
        # Parse Error: Function "new()" not found in base Object.
        # var object = Object.new()
```

Object æœ¬èº«æ²¡æœ‰å†…å­˜ç®¡ç†ï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ free æˆ–è°ƒç”¨ C++ æ–¹æ³•æ¸…ç†å®ä¾‹æ‰€å ç”¨çš„å†…å­˜ã€‚å­ç±» `Reference`ï¼Œ
å³æ–°ç‰ˆæœ¬ä¸­çš„ `RefCounted` ç±»å‹ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œå½“å¼•ç”¨è®¡æ•°å€¼ä¸º 0 å³å›æ”¶èŠ‚ç‚¹æˆ–å…¶å®ƒåŸºç¡€
ç±»æ‰€å ç”¨çš„å†…å­˜ã€‚


Godot å®šä¹‰äº†ä¸€ä¸ª Variant å˜ä½“ç±»å‹ï¼Œå¯ä»¥ç§°ä¹‹ä¸ºæ•°æ®ç±»å‹ä¹‹æ¯ã€‚å®ƒç”¨äºè¡¨è¾¾æ‰€æœ‰åŸºç¡€çš„æ•°æ®ç±»å‹ï¼Œéµå¾ª C99
ç±»å‹è§„èŒƒæ ‡å‡†ï¼ŒGodot æ–‡æ¡£ç§°ä¹‹ä¸º Core typesï¼ŒåŒ…æ‹¬ï¼š

- ``uint8_t``,``uint32_t``,``int64_t``ç­‰ç­‰å¸¸è§„æ•°å€¼ç±»å‹ï¼›
- Vector  List  Set  Map ç­‰ç­‰å®¹å™¨ç±»å‹ï¼›
- String
- StringName
- Math types çº¿æ€§ä»£æ•°ä½¿ç”¨çš„å„ç§å‘é‡ç±»å‹
- NodePath èŠ‚ç‚¹è·¯å¾„
- RID èµ„æºæ ‡è¯†ç¬¦

æ¯ä¸ª Variant å®ä¾‹è‡³å°‘å ç”¨å†…å­˜ä¸º 20 bytesï¼Œä½¿ç”¨ real_t ä½œä¸ºæµ®ç‚¹æ•°ç±»å‹ï¼Œå¦‚æœä½¿ç”¨ double åˆ™
å ç”¨ 30 bytesã€‚å¦å¤–åƒ PoolVectorï¼Œaabbï¼Œmetrix è¿™äº›æ•°ç»„æˆ–ä¸“ç”¨ç±»å‹çš„é¢å¤–å†…å­˜å ç”¨å¦è®¡ã€‚

Variant å®šä¹‰äº†ç›¸å½“å¤šçš„ä¸å„ç§æ•°æ®ç±»å‹ç›¸å…³çš„æ–¹æ³•ï¼Œä½†æ•°æ®æˆå‘˜ä¸å¤šï¼š

```C++,ignore
    // Variant takes 20 bytes when real_t is float, and 36 if double
    // it only allocates extra memory for aabb/matrix.

    Type type;

    struct ObjData {
        ObjectID id;
        Object *obj = nullptr;
    };

    union {
           bool  _bool;
        int64_t  _int;
         double  _real;
    Transform2D *_transform2d;
         ::AABB *_aabb;
          Basis *_basis;
      Transform *_transform;
           void *_ptr; //generic pointer
         uint8_t _mem[sizeof(ObjData) > (sizeof(real_t) * 4) ? sizeof(ObjData) : (sizeof(real_t) * 4)];
    } _data GCC_ALIGNED_8;
```

Variant çš„ä½œç”¨ä¹Ÿéå¸¸å¤§ï¼š

- Store almost any datatype
- Perform operations between many variants (GDScript uses Variant as its atomic/native datatype).
- Be hashed, so it can be compared quickly to other variants
- Be used to convert safely between datatypes
- Be used to abstract calling methods and their arguments (Godot exports all its functions through variants)
- Be used to defer calls or move data between threads.
- Be serialized as binary and stored to disk, or transferred via network.
- Be serialized to text and use it for printing values and editable settings.
- Work as an exported property, so the editor can edit it universally.
- Be used for dictionaries, arrays, parsers, etc.

Variant å®ä¾‹è‡³å°‘å ç”¨å†…å­˜ä¸º 20 bytesï¼Œä»¥ 10000 æ–¹å½¢äºŒç»´æ•°ç»„ä¸ºä¾‹ï¼Œä½¿ç”¨é»˜è®¤çš„å˜ä½“ç±»å‹å¤§å°å°±å ç”¨
2GB = 10000 * 10000 * 20 å†…å­˜ï¼Œè¿™æ˜¯ç›¸å½“å ç”¨å†…å­˜ï¼

åˆ†æ®µå¼çš„å†…å­˜ç®¡ç†å¯¹äºå¤§å¤šæ•°å¸¸è§å°å†…å­˜åˆ†é…æ¥è¯´ï¼Œä¼šç¼“æ…¢åœ°åˆ›å»ºçš„æ¼æ´ï¼Œä»è€Œæµªè´¹å†…å­˜ã€‚å…³äºå †å’Œåˆ†æ®µçš„æ–‡çŒ®
æœ‰å¾ˆå¤šã€‚ç°ä»£æ“ä½œç³»ç»Ÿä½¿ç”¨åˆ†é¡µå†…å­˜ï¼Œè¿™æœ‰åŠ©äºç¼“è§£åˆ†æ®µé—®é¢˜ï¼Œä½†æ— æ³•è§£å†³ã€‚

ç„¶è€Œï¼Œåœ¨è®¸å¤šç ”ç©¶å’Œæµ‹è¯•ä¸­è¡¨æ˜ï¼Œå¦‚æœç»™å®šè¶³å¤Ÿçš„å†…å­˜ï¼Œå¦‚æœæœ€å¤§åˆ†é…å¤§å°ä½äºç»™å®šçš„é˜ˆå€¼ï¼Œä¸æœ€å¤§å †å¤§å°å’Œ
æœªä½¿ç”¨å†…å­˜çš„æ¯”ä¾‹æˆæ¯”ä¾‹ï¼Œåˆ†æ®µå°†ä¸ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºå®ƒå°†ä¿æŒä¸å˜ã€‚æ¢å¥è¯è¯´ï¼Œä¿æŒ 10-20%
çš„å†…å­˜ç©ºé—²ï¼Œå¹¶æ‰§è¡Œæ‰€æœ‰å°çš„åˆ†é…ï¼Œå°±æ²¡é—®é¢˜ã€‚

Godot ç¡®ä¿æ‰€æœ‰å¯ä»¥åŠ¨æ€åˆ†é…çš„å¯¹è±¡éƒ½å¾ˆå°ï¼Œå‡ ä¸ª kbã€‚ä½†å¦‚æœåˆ†é…å¤ªå¤§ï¼Œå¦‚å›¾åƒæˆ–ç½‘æ ¼å‡ ä½•ä½“æˆ–å¤§å‹é˜µåˆ—ï¼Œ
Godot å¯ä»¥é€‰æ‹©ä½¿ç”¨åŠ¨æ€å†…å­˜æ± ã€‚è¯¥å†…å­˜éœ€è¦è¢«é”å®šæ‰èƒ½è®¿é—®ï¼Œåˆ†é…çš„å†…å­˜ç”¨å®Œæ—¶ï¼Œå†æ ¹æ®éœ€è¦é‡æ–°æ’åˆ—å’Œå‹ç¼©ã€‚
æ ¹æ®æ¸¸æˆçš„éœ€è¦ï¼Œç¨‹åºå‘˜å¯ä»¥é…ç½®åŠ¨æ€å†…å­˜æ± å¤§å°ã€‚


Godot é€šçŸ¥å›è°ƒå®ç°äº†å¼•æ“ä¸­æœ€åŸºæœ¬èŠ‚ç‚¹å¤„ç†ã€æ¸²æŸ“æµç¨‹äº‹ä»¶ï¼Œä»¥åŠä¸ç¨‹åºçª—å£çš„äº¤äº’ï¼š

- `_ready()` : NOTIFICATION_READY
- `_enter_tree()` : NOTIFICATION_ENTER_TREE
- `_exit_tree()` : NOTIFICATION_EXIT_TREE
- `_process(delta)` : NOTIFICATION_PROCESS (`_idle` in Godot 3.5)
- `_physics_process(delta)` : NOTIFICATION_PHYSICS_PROCESS (`_iteration` in Godot 3.5)
- `_draw()` : NOTIFICATION_DRAW

å¯¹è±¡å±æ€§è¯»å†™å’Œå¯¼å‡ºæ˜¯éå¸¸æœ‰ç”¨çš„æœºåˆ¶ï¼Œå®ƒå’Œ Godot ç¼–è¾‘å™¨ç´§å¯†ç»“åˆï¼Œå¯ä»¥é€šè¿‡ç¼–è¾‘å±æ€§ç•Œé¢ä¿®æ”¹å±æ€§å€¼ï¼š

- Serializing and deserializing the object.
- Creating a list of editable values for the Object derived class.

åœ¨ C++ åº•å±‚ï¼Œå±æ€§å¯¼å‡ºé€šè¿‡ `PropertyInfo` ç»“ä½“ä½“å®ç°ï¼š

```C++,ignore
// PropertyInfo(type, name, hint, hint_string, usage_flags)
// For example:
PropertyInfo(Variant::INT, "amount", PROPERTY_HINT_RANGE, "0,49,1", PROPERTY_USAGE_EDITOR)
```

å¦å¤–ï¼Œè¿˜æœ‰æ›´åº•å±‚çš„å±æ€§ç»‘å®šæ–¹æ³•ï¼Œå®ƒä»¬åœ¨ GDScript ä¸­ä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€è¡¨ç¤ºï¼Œå®ƒä»¬ä¸æ˜¯è™šå‡½æ•°ï¼Œå­ç±»ç»§æ‰¿
è¦†ç›–åï¼Œåœ¨ä¸Šå±‚å­ä¾ç„¶æœ‰æ•ˆï¼Œå¯ä»¥è¢«å¤šçº§è°ƒç”¨ï¼ŒDO NOT make them virtualï¼š

```C++,ignore
protected:
     void _get_property_list(List<PropertyInfo> *r_props) const;      // return list of properties
     bool _get(const StringName &p_property, Variant &r_value) const; // return true if property was found
     bool _set(const StringName &p_property, const Variant &p_value); // return true if property was found

```

Godot Object çš„ API åˆ†ç±»å‚è€ƒï¼Œåœ¨æºä»£ç çš„ `Object::_bind_methods()` ä¸­æ³¨å†Œï¼š

```py,ignore
Variant _get(property: String) virtual
  Array _get_property_list() virtual
   bool _set(property: String, value: Variant) virtual
Variant  get(property: String) const
  Array  get_property_list() const
   void  set(property: String, value: Variant)
Variant  get_indexed ( NodePath property ) const
   void  set_indexed ( NodePath property, Variant value )


   void _init() virtual
   void  free ( )
    int  get_instance_id ( ) const
   bool  is_class ( String class ) const
   bool  is_queued_for_deletion ( ) const


   void _notification(what: int) virtual
   void  notification ( int what, bool reversed=false )
   void  property_list_changed_notify ( )


   void  add_user_signal ( String signal, Array arguments=[ ] )
  Error  connect ( String signal, Object target, String method, Array binds=[ ], int flags=0 )
   void  disconnect ( String signal, Object target, String method )
   void  emit_signal ( String signal, ... ) vararg
  Array  get_incoming_connections ( ) const
  Array  get_signal_connection_list ( String signal ) const
   Arra  get_signal_list ( ) const
   bool  has_signal ( String signal ) const
   bool  has_user_signal ( String signal ) const
   bool  is_connected ( String signal, Object target, String method ) const
   bool  is_blocking_signals ( ) const
   void  set_block_signals ( bool enable )


Reference  get_script ( ) const
     void  set_script ( Reference script )


Variant  call ( String method, ... ) vararg
   void  call_deferred ( String method, ... ) vararg
Variant  callv ( String method, Array arg_array )
  Array  get_method_list ( ) const
  Array  get_property_list ( ) const
   bool  has_method ( String method ) const
   void  set_deferred ( String property, Variant value )


Variant  get_meta ( String name, Variant default=null ) const
PoolStringArray get_meta_list ( ) const
   bool  has_meta ( String name ) const
   void  remove_meta ( String name )
   void  set_meta ( String name, Variant value )



 String _to_string() virtual
   bool  can_translate_messages() const
   void  set_message_translation ( bool enable )
 String  to_string ( )
 String  tr ( String message ) const
```

Godot 4 çš„å˜åŒ–ï¼Œä¸€ä¸ªé€šçŸ¥æ–¹æ³•æ›´åï¼Œå¦å¤–æ–°å¢ 5 ä¸ª APIï¼Œè¿˜æœ‰æ¶ˆæ¯æœºåˆ¶ API çš„ä½¿ç”¨æ–¹å¼å˜æ›´ï¼Œè¿”å›æ•°ç»„çš„
API åŸºæœ¬è€…æ”¹å˜ä¸ºè¿”å› Dictionary[]ï¼Œç­‰ç­‰ï¼š

```py
# void  property_list_changed_notify ( )
  void  notify_property_list_changed()

String  tr_n(message: StringName, plural_message: StringName, n: int, context: StringName = "") const

   bool _property_can_revert(property: StringName) virtual
Variant _property_get_revert(property: StringName) virtual
   bool  property_can_revert(property: StringName) const
Variant  property_get_revert(property: StringName) const
```

Godot 4 å¼•å…¥ä¿¡å·ç±»å‹ï¼Œä»¥ Signal ç±»å‹é‡æ–°ç»„ç»‡ä¿¡å·ç›¸å…³çš„ APIï¼ŒObjec åŸæœ‰çš„ä¿¡å· API ä¿ç•™ã€‚å¦å¤–
æ³¨æ„ä»£ç ä¸­ `signl` æ˜¯å…³é”®å­—ï¼Œ`Signal` æ˜¯ç±»å‹ï¼š

```py
# Constructors
    Signal Signal ( )
    Signal Signal ( Signal from )
    Signal Signal ( Object object, StringName signal )

# Methods
       int connect ( Callable callable, int flags=0 )
      void disconnect ( Callable callable )
      void emit ( ... ) vararg const
     Array get_connections ( ) const
StringName get_name ( ) const
    Object get_object ( ) const
       int get_object_id ( ) const
      bool is_connected ( Callable callable ) const
      bool is_null ( ) const
```

Godot 3.5 ä¸­ï¼ŒMultiplayerAPI è¿˜ç»‘å®šäº†é»˜è®¤çš„ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå¹¶ä¸”è·å–ä¿¡å·ç»‘å®šåˆ—è¡¨è¿”å›çš„å­—å…¸åŒ…å«çš„
å­—æ®µæ¯” Godot 4.x ä¸­çš„æ›´å¤šï¼š

```py
    object.get_signal_connection_list("signal"):
    return array of dictionary:
    { 
        binds:[], flags:0, 
        method:_server_disconnected, 
        signal:server_disconnected, 
        source:[MultiplayerAPI:1249], 
        target:[SceneTree:1242]
    }

    signal.get_connections() 
    return array of dict: {signal, callable}
```


### ğŸŸ ğŸ”µ enum is a Dictionary
- [GraphViz](http://www.graphviz.org/Download.php)
- [CodeViz](http://www.csn.ul.ie/~mel/projects/codeviz/)
- [GDScript progress report: Writing a tokenizer](https://godotengine.org/article/gdscript-progress-report-writing-tokenizer/)

CodeViz æ˜¯ Understanding The Linux Virtual Memory Manager ä¸€ä¹¦çš„ä½œè€… Mel Gorman ç¼–å†™
çš„ä¸€æ¬¾åˆ†æ C/C++ æºä»£ç ä¸­å‡½æ•°è°ƒç”¨å…³ç³»çš„å¼€æºå·¥å…·ï¼Œç±»ä¼¼è½¯ä»¶æœ‰ egyptã€ncc ç­‰ã€‚åœ¨ç¼–è¯‘æºæ–‡ä»¶æ—¶ï¼Œå®ƒä¼šå¯¼å‡º
å…¶ä¸­å‡½æ•°çš„ call graphï¼Œç„¶åç”¨ Perl è„šæœ¬æ”¶é›†å¹¶æ•´ç†è°ƒç”¨å…³ç³»ï¼Œè½¬äº¤ç»™ Graphviz ç»˜åˆ¶å›¾å½¢ã€‚

CodeViz ç°åœ¨å·²ç»åŸºæœ¬æ”¯æŒ C++ è¯­è¨€ï¼Œæœ€æ–°çš„ 1.0.9 ç‰ˆèƒ½åœ¨ Windows + Cygwin ä¸‹é¡ºåˆ©åœ°ç¼–è¯‘ä½¿ç”¨ã€‚


Godot ä¸­çš„æšä¸¾ç±»å‹ enum å’Œå­—å…¸å¯¹è±¡åŒæºï¼Œå¯ä»¥ä½¿ç”¨ keys() æ–¹æ³•è·å–æšä¸¾é‡çš„åç§°æ¥å®ç°åˆ°å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚
å‚è€ƒ global_constants.cpp æºä»£ç æ–‡ä»¶ï¼Œå…¶ä¸­æ³¨å†Œäº†å…¨å±€ç±»å‹å¸¸é‡ã€‚GDScript è§£é‡Šå™¨ä¹Ÿæ²¡æœ‰ä¸“é—¨è®¾ç½®ä¸€ä¸ª
Token ç”¨äºè¡¨ç¤ºæšä¸¾ç±»å‹ï¼Œè€Œæ˜¯å’Œå­—å…¸ç±»å‹ä¸€æ ·ï¼Œç›´æ¥é€šè¿‡æ£€æµ‹ä»£ç ä¸­çš„èŠ±æ‹¬å·æ¥è¯†åˆ«æšä¸¾ç±»å‹ã€‚

Godot 3.5 ä¸­çš„ GDScript è§£æå™¨å®šä¹‰äº†ä¸€ä¸ª parse_class æ–¹æ³•ï¼Œå®ƒåŒ…æ½äº†è„šæœ¬çš„è§£æå·¥ä½œï¼Œæ•´ä¸ªæ–¹æ³•
éå¸¸è‡ƒè‚¿ã€‚Godot 4.x åï¼Œé‡æ–°ç¼–å†™äº†è§£æå™¨ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿè¢«æ‹†è§£æˆå„ä¸ªåˆ†å·¥æ–¹æ³•ã€‚

GDScriptTokenizer å®šä¹‰äº†è„šæœ¬ä¸­çš„ `Token` ç±»å‹ï¼Œåå­—ä¸­çš„ç§‘å®¤ç¬¦å·å«ä¹‰å¦‚ä¸‹ï¼š

- TK å‰ç¼€ç®€å†™ä¸º Tokenï¼›
- OP è¡¨ç¤º Operation code æ“ä½œç ï¼›
- CF è¡¨ç¤º Control flow æµç¨‹æ§åˆ¶ï¼›
- PR è¡¨ç¤º Keywordsï¼Œå¯èƒ½æ˜¯ç¼©å†™ Proposeï¼Œä½†ç»ä¸ GitHub ä¸­ PR(pull request)ï¼›

Godot 3.5 Token ç±»å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­ TK_PR_SLAVE ç”± TK_PR_PUPPET å–ä»£ï¼ŒTK_CURSOR ç”¨è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ï¼Œ
å¯ä»¥çœ‹åˆ° ++ æˆ– -- è¿™æ ·çš„è¿ç®—ç¬¦å·è¿˜æœªæä¾›å®ç°ï¼Œå…±æœ‰ 99 ä¸ª Tokenï¼š

|  Control Flow  |      Operation Code      |        PR        |     miscellaneous      |
|----------------|--------------------------|------------------|------------------------|
| TK_CF_IF       | TK_OP_IN                 | TK_PR_FUNCTION   | TK_BRACKET_CLOSE       |
| TK_CF_ELIF     | TK_OP_EQUAL              | TK_PR_CLASS      | TK_BRACKET_OPEN        |
| TK_CF_ELSE     | TK_OP_NOT_EQUAL          | TK_PR_CLASS_NAME | TK_BUILT_IN_FUNC       |
| TK_CF_FOR      | TK_OP_LESS               | TK_PR_EXTENDS    | TK_BUILT_IN_TYPE       |
| TK_CF_WHILE    | TK_OP_LESS_EQUAL         | TK_PR_IS         | TK_COLON               |
| TK_CF_BREAK    | TK_OP_GREATER            | TK_PR_ONREADY    | TK_COMMA               |
| TK_CF_CONTINUE | TK_OP_GREATER_EQUAL      | TK_PR_TOOL       | TK_CONSTANT            |
| TK_CF_PASS     | TK_OP_AND                | TK_PR_STATIC     | TK_CONST_INF           |
| TK_CF_RETURN   | TK_OP_OR                 | TK_PR_EXPORT     | TK_CONST_NAN           |
| TK_CF_MATCH    | TK_OP_NOT                | TK_PR_SETGET     | TK_CONST_PI            |
|                | TK_OP_ADD                | TK_PR_CONST      | TK_CONST_TAU           |
|                | TK_OP_SUB                | TK_PR_VAR        | TK_CURLY_BRACKET_CLOSE |
|                | TK_OP_MUL                | TK_PR_AS         | TK_CURLY_BRACKET_OPEN  |
|                | TK_OP_DIV                | TK_PR_VOID       | TK_CURSOR (completion) |
|                | TK_OP_MOD                | TK_PR_ENUM       | TK_DOLLAR              |
|                | TK_OP_SHIFT_LEFT         | TK_PR_PRELOAD    | TK_EMPTY               |
|                | TK_OP_SHIFT_RIGHT        | TK_PR_ASSERT     | TK_EOF                 |
|                | TK_OP_ASSIGN             | TK_PR_YIELD      | TK_ERROR               |
|                | TK_OP_ASSIGN_ADD         | TK_PR_SIGNAL     | TK_FORWARD_ARROW       |
|                | TK_OP_ASSIGN_SUB         | TK_PR_BREAKPOINT | TK_IDENTIFIER          |
|                | TK_OP_ASSIGN_MUL         | TK_PR_REMOTE     | TK_MAX                 |
|                | TK_OP_ASSIGN_DIV         | TK_PR_SYNC       | TK_NEWLINE             |
|                | TK_OP_ASSIGN_MOD         | TK_PR_MASTER     | TK_PARENTHESIS_CLOSE   |
|                | TK_OP_ASSIGN_SHIFT_LEFT  | TK_PR_SLAVE      | TK_PARENTHESIS_OPEN    |
|                | TK_OP_ASSIGN_SHIFT_RIGHT | TK_PR_PUPPET     | TK_PERIOD              |
|                | TK_OP_ASSIGN_BIT_AND     | TK_PR_REMOTESYNC | TK_QUESTION_MARK       |
|                | TK_OP_ASSIGN_BIT_OR      | TK_PR_MASTERSYNC | TK_SELF                |
|                | TK_OP_ASSIGN_BIT_XOR     | TK_PR_PUPPETSYNC | TK_SEMICOLON           |
|                | TK_OP_BIT_AND            |                  | TK_WILDCARD            |
|                | TK_OP_BIT_OR             |                  |                        |
|                | TK_OP_BIT_XOR            |                  |                        |
|                | TK_OP_BIT_INVERT         |                  |                        |
|                | //TK_OP_PLUS_PLUS        |                  |                        |
|                | //TK_OP_MINUS_MINUS      |                  |                        |

Godot 4.x å¼•å…¥çš„å¤šä¸ªå…³é”®å­—ï¼Œæˆ–å…³é”®å­—åŠŸèƒ½çš„æå‡ï¼š

- in ä½œä¸ºå…³é”®å­—å®šä¹‰ï¼Œå¯¹åº”æ—§ç‰ˆæœ¬çš„ TK_OP_INï¼Œç”¨äºå†³æ–­å…ƒç´ æ˜¯å¦åœ¨ string, list, range, å­—å…¸æˆ–è€…èŠ‚ç‚¹ä¸­ï¼Œä¹Ÿç”¨äº for å¾ªç¯ï¼›
- super ç”¨äºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°æˆ–æˆå‘˜ï¼Œä¸ç”¨åƒæ—§ç‰ˆæœ¬ä¸­é‚£æ ·ä½¿ç”¨ . è¿ç®—ç¬¦å·æ¥è°ƒç”¨çˆ¶ç±»ï¼›
- await æ›¿ä»£æ—§ç‰ˆæœ¬çš„ TK_PR_YIELDï¼Œè™½ç„¶ yield è¿™ä¸ªå…³é”®å­—è¿˜åœ¨ï¼Œä½†ä½¿ç”¨å®ƒåªä¼šå¾—åˆ°é”™è¯¯æç¤ºï¼›
- toolã€iconã€onreadyã€export ç­‰ç­‰å˜æ›´ä¸ºæ ‡æ³¨ï¼Œç”± GDScriptParser æä¾›å®ç°ï¼Œä¸åŒä½œä¸ºå…³é”®å­—ä½¿ç”¨ï¼›
- @warning_ignore å’Œ @rpc æ˜¯æ–°å¢çš„ä¸¤ä¸ªåŠŸèƒ½æ ‡æ³¨ï¼›

æ­¤å¤–ï¼Œè¿˜æœ‰å¼•å…¥äº†ä»¥ä¸‹æœ‰ç¬¦å·å®šä¹‰ä½†æœªæä¾›å®ç°çš„å…³é”®å­—ï¼š

- namespace è™½ç„¶åœ¨ä»£ç ä¸­å·²ç»æœ‰ä¸ªå…³é”®å­—ï¼Œæ˜¯æ˜¯è¿˜æ²¡æœ‰å…·ä½“å®ç°å‘½åç©ºé—´çš„åŠŸèƒ½ï¼›
- trait æ˜¯æ··åˆç¼–ç¨‹æ¨¡å¼æ¦‚å¿µï¼Œæ˜¯ä»£ç å¤ç”¨æ–¹æ³•ï¼›

è§£æå™¨æ–¹æ³• get_rule() å¯ä»¥æŸ¥è¯¢ Token ç±»å‹ä¸å…·ä½“å®ç°çš„è§„åˆ™ã€‚


```cpp ,ignore
    // godot-4.0-beta6\modules\gdscript\gdscript_parser.cpp
    static HashMap<StringName, Variant::Type> builtin_types;
    Variant::Type GDScriptParser::get_builtin_type(const StringName &p_type) {
        if (builtin_types.is_empty()) {
            // ...
            builtin_types["Dictionary"] = Variant::DICTIONARY;


    GDScriptParser::PatternNode *GDScriptParser::parse_match_pattern(PatternNode *p_root_pattern) {
        // ...
            case GDScriptTokenizer::Token::BRACE_OPEN: {
                // Dictionary.


    //  godot-3.5.1-stable\core\global_constants.cpp
    BIND_GLOBAL_ENUM_CONSTANT_CUSTOM("TYPE_DICTIONARY", Variant::DICTIONARY); // 20


    // godot-3.5.1-stable\modules\gdscript\gdscript_parser.cpp
    void GDScriptParser::_parse_class(ClassNode *p_class) {
        // ...
        while (true) {
            GDScriptTokenizer::Token token = tokenizer->get_token();
            // ...
            switch (token) {

            case GDScriptTokenizer::TK_CURSOR:  { /*...*/ } break;
            case GDScriptTokenizer::TK_EOF:     { /*...*/ } break;
            case GDScriptTokenizer::TK_ERROR:   { /*...*/ } break;
            case GDScriptTokenizer::TK_NEWLINE:     { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_EXTENDS:  { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_CLASS_NAME:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_TOOL:     { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_CLASS:    { /*...*/ } break;
            case GDScriptTokenizer::TK_CF_PASS:     { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_STATIC:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_FUNCTION: { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_SIGNAL:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_EXPORT: { 
                    // ...
                    if (tokenizer->get_token() == GDScriptTokenizer::TK_BUILT_IN_TYPE) {
                        Variant::Type type = tokenizer->get_token_type();
                        // ...
                            switch (type) {
                                case Variant::INT:  { /*...*/ } break;
                                case Variant::REAL:     { /*...*/ } break;
                                case Variant::STRING:   { /*...*/ } break;
                                case Variant::COLOR:    { /*...*/ } break;
                                default: {
                                    current_export = PropertyInfo();
                                    _set_error("Type \"" + Variant::get_type_name(type) + "\" can't take hints.");
                                    return;
                                } break;

                        Variant constant = static_cast<ConstantNode *>(subexpr)->value;
                    } else {
                        // ...
                        if (constant.get_type() == Variant::OBJECT) {
                            // ...
                        } else if (constant.get_type() == Variant::DICTIONARY) {
                            // Enumeration
                            // ...
            } break;
            case GDScriptTokenizer::TK_PR_ONREADY:  { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_REMOTE:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_MASTER:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_SLAVE:    { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_PUPPET:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_REMOTESYNC:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_SYNC:     { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_MASTERSYNC:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_PUPPETSYNC:   { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_VAR:      { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_CONST:    { /*...*/ } break;
            case GDScriptTokenizer::TK_PR_ENUM:     { /*...*/ } break;
            case GDScriptTokenizer::TK_CONSTANT:    { /*...*/ } break;
            case GDScriptTokenizer::TK_CF_PASS:     { /*...*/ } break;
```




### ğŸŸ ğŸ”µ MySprite ç²¾çµç±»æ´¾ç”Ÿæ¼”ç¤º

å·¥å…·è„šæœ¬æ˜¯ä¼šåœ¨ Godot IDE ä¸­è¿è¡Œçš„è„šæœ¬ï¼Œåœ¨å¼€å¤´ä½¿ç”¨ **tool** å…³é”®å­—ï¼Œé€šè¿‡ Engine.editor_hint å…¨å±€
çŠ¶æ€åˆ¤æ–­å½“å‰è¿è¡Œç¯å¢ƒæ˜¯å¦æ˜¯ç¼–è¾‘å™¨ç¯å¢ƒã€‚å¦å¤–ï¼Œç»§æ‰¿ **EditorScript** çš„è„šæœ¬å¯ä»¥ç›´æ¥åœ¨è„šæœ¬ç¼–å™¨ä¸­è¿è¡Œã€‚
è€Œè¦ä¸ºç¼–è¾‘å™¨æä¾›æ›´å¤šåŠŸèƒ½ï¼Œå¯ä»¥ç¼–å†™ç¼–è¾‘å™¨æ’ä»¶ï¼Œç»§æ‰¿ **EditorPlugin** ç±»å‹ã€‚Asset Library æä¾›äº†
ç°æœ‰çš„æ’ä»¶ï¼Œåœ¨ Godot IDE ä¸­å¯ä»¥ç›´æ¥æœç´¢ã€å®‰è£…å„ç§æ’ä»¶ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½æ’ä»¶ï¼Œå®‰è£…åˆ°é¡¹ç›®çš„ addons ç›®å½•ä¸‹ã€‚

```py
tool
extends EditorScript

func _run():
    print("Hello from the Godot Editor!")
```

GDScript è„šæœ¬ä½œä¸ºå¿«é€Ÿè¿­ä»£å¼€å‘çš„è¯­è¨€ï¼Œå®ƒæœ€å¤§çš„ä¼˜ç‚¹å°±æ˜¯ä½¿ç”¨ä¸Šçš„ä¾¿åˆ©ï¼Œæ— ç¼–è¯‘æ—¶é—´å¼€é”€ï¼ŒåŒæ—¶ä¸ Godot
ç¼–è¾‘å™¨ç•Œé¢ç´§å¯†ç»“åˆï¼Œé€šè¿‡ **export** å…³é”®å­—å¯¼å‡ºè„šæœ¬ç¬¦å·ï¼Œå¯ä»¥åœ¨å±æ€§æ£€æŸ¥å™¨ Inspector äº§ç”Ÿç›¸åº”çš„
GUI æ§ä»¶å¯¹å¯¼è‡´å˜é‡è¿›è¡Œèµ‹å€¼ç­‰æ“ä½œã€‚åœ¨è„šæœ¬ä¸­ä¿®æ”¹å·²å¯¼å‡ºçš„ç¬¦å·ï¼Œå¯ä»¥ä¸»åŠ¨è°ƒç”¨ Object æä¾›çš„é€šçŸ¥å‘å¸ƒæ–¹æ³•ï¼Œ
ä»¥ä½¿ç”¨ Inspector æ£€æµ‹åˆ°å¯¼å‡ºç¬¦å·å†…å®¹æœ‰å˜åŠ¨å¹¶ç›¸åº”æ›´æ–°ï¼Œä½¿ç”¨å±æ€§é¢æ¿å†…å®¹åŠæ—¶åæ˜ å‡ºå˜åŒ–ï¼š

```py
void notify_property_list_changed()
```

è¦ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œé™¤äº†ç›´æ¥åœ¨ **extends** å…³é”®å­—åé¢ç¼–å†™ç±»åå¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ res:// åè®®æŒ‡å®šè„šæœ¬èµ„æºæ–‡ä»¶ã€‚
ç»™ä¸€ä¸ªè„šæœ¬è®¾ç½® **class_name** åï¼Œè¿™ä¸ªç±»å‹å°±å…·æœ‰åç§°ï¼Œä¸æ˜¯åŒ¿åç±»ã€‚å¦‚æœç»§æ‰¿ Node æˆ–å…¶å­ç±»å‹ï¼Œå°±
å¯ä»¥ç›´æ¥å½“ä½œåœºæ™¯æ ‘çš„èŠ‚ç‚¹ä½¿ç”¨ï¼Œåœ¨ç»™åœºæ™¯æ·»åŠ èŠ‚ç‚¹æ—¶ï¼ŒèŠ‚ç‚¹åˆ—è¡¨ä¸­ä¹Ÿä¼šæ˜¾ç¤ºè¿™ä¸ªå¯¹è±¡ã€‚


```py
tool

extends Sprite
class_name MySprite, "res://icon.png"

# Declare member variables here. Examples:
# var a = 2
# var b = "text"


# Called when the node enters the scene tree for the first time.
func _ready():
    pass # Replace with function body.

# http://kehomsforge.com/tutorials/single/process-physics-process-godot
# Called every frame. 'delta' is the elapsed time since the previous frame.
# In Godot we sort of get this decoupling by having the 
# _physics_process() (fixed time step) and the _process() (as fast as possible) functions.
func _process(delta):
    if Engine.editor_hint:
        rotation_degrees += 90 * delta
    else:
        rotation_degrees -= 18 * delta

func _physics_process(delta):
    print(self.name)
    pass

# http://kehomsforge.com/tutorials/single/gdConditionalProperty
# Object._get_property_list() _get() _set()
```

æ¯ä¸ªè„šæœ¬çš„æœ¬èº«æ˜¯ **GDScript** ç±»å‹ï¼Œæ˜¯ä¸€ç§èµ„æºç±»å‹ï¼Œéœ€è¦ä¸èŠ‚ç‚¹ç»“åˆä½¿ç”¨ï¼Œå³é™„åŠ åˆ°åœºæ™¯æ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œ
ä½¿èŠ‚ç‚¹å¯ä»¥é€šè¿‡è„šæœ¬è¿›è¡Œæ“æ§ï¼š

    Class: Script
    Inherits: Resource < Reference < Object
    Inherited by: GDScript , NativeScript , PluginScript , VisualScript

ä»¥ä¸‹è„šæœ¬æ¼”ç¤ºå¦‚ä½•é€šè¿‡å…¨å±€å‡½æ•° load åŠ è½½ç±»å‹ï¼Œç„¶ååœ¨å®ä¾‹åŒ–ååŠ è½½åˆ°åœºæ™¯æ ‘ä¸­ï¼š

```py
#extends "res://L3 GDScript/MySprite.gd"
extends MySprite

class_name MyObject, 'res://icon.png'

func _ready():
    # Anonymous types: local script as GDScript class
    var MyClass = load("res://L3 GDScript/MySprite.gd")
    var instance = MyClass.new()
    assert(instance.get_script() == MyClass)
    
    # attach scene tree
    instance.position += Vector2(100, 100)
    instance.texture = load("icon.png")
    get_node("..").call_deferred("add_child", instance)
```

ç»§æ‰¿å£°æ˜ä½¿ç”¨ res:// èµ„æºåè®®æŒ‡å®šçˆ¶ç±»æ—¶ï¼Œå¯èƒ½ä¼šåœ¨ç¼–è¾‘å™¨ä¸­æ£€æµ‹åˆ°å¾ªç¯åŠ è½½é—®é¢˜ï¼Œä½†ä¸å½±å“ä½¿ç”¨ï¼š

    Parse Error: Script isn't fully loaded (cyclic preload?): res://L2 GDScript/MySprite.gd

åˆ›å»ºçš„èŠ‚ç‚¹ä¸å†éœ€è¦æ—¶ï¼Œéœ€è¦è°ƒç”¨ queue_free() æˆ– free() é‡Šæ”¾èŠ‚ç‚¹æ‰€å ç”¨å†…å­˜ï¼Œå¦åˆ™ä¼šæˆä¸ºå­¤å„¿èŠ‚ç‚¹å ç”¨å†…å®¹ã€‚

å…¨å±€å‡½æ•°ä¸èµ„æºåŠ è½½ç›¸å…³çš„æœ‰ä¸¤ä¸ªï¼Œè¦é¿å…å¤šæ¬¡åŠ è½½èµ„æºï¼Œå¯ä»¥å°†èµ„æºå¼•ç”¨ä¿å­˜åœ¨å˜é‡ä¸­æˆ–è€…ä½¿ç”¨ preload() æ–¹æ³•ï¼š

```py
Resource load(path: String)

Resource preload(path: String)
```

æ³¨æ„ï¼Œpreload ä¸æ˜¯å‡½æ•°ï¼Œæ˜¯å…³é”®å­—ï¼Œåœ¨è§£æå™¨æä¾›çš„æ–¹æ³•ï¼Œload() æ˜¯å…¨å±€å‡½æ•°ï¼Œå®ƒä»¬çš„åŠŸèƒ½ä¸å¤ªä¸€æ ·ã€‚

GDScript å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸»è¦æœ‰ä¸¤ä¸ªï¼Œä¸€èˆ¬ä½¿ç”¨ new() æ–¹æ³•è¿›è¡Œå®ä¾‹åŒ–ï¼Œå¹¶æ‰§è¡Œç±»å‹ä¸­çš„ `_init()` æ–¹æ³•ï¼Œ
å‚æ•°å¯ä»¥åœ¨æ­¤ä¼ é€’ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ **free()** é”€æ¯å®ä¾‹å›æ”¶å†…å­˜ã€‚åœ¨åœºæ™¯ä¸­è®¾ç½®å¥½çš„æ‰€æœ‰å±æ€§æ•°æ®ï¼Œæ„é€ è¿‡ç¨‹
ä¸­ä¼šè‡ªåŠ¨åŠ è½½ï¼Œåœ¨åˆå§‹åŒ–æ–¹æ³• **_init()** æ‰§è¡Œå‰å°±è®¾ç½®å¥½ã€‚


```py
# MyObject.new("argument pass to _init()")

func _init(arg):
    print("MyObject _init(\"%s\")" % arg)
```


### ğŸŸ ğŸ”µ Godot 3.x to 4.x ç‰ˆæœ¬å·®å¼‚
- godot-docs\development\file_formats\gdscript_grammar.rst
- godot-docs\tutorials\scripting\gdscript\gdscript_exports.rst
- godot-docs\tutorials\scripting\gdscript\gdscript_basics.rst
- godot-docs\tutorials\scripting\gdscript\gdscript_advanced.rst
- godot-docs/tutorials/editor/upgrading_to_godot_4.rst
- [GDScript documentation comments](https://docs.godotengine.org/en/latest/tutorials/scripting/gdscript/gdscript_documentation_comments.html)
- [Add a Godot 3 to Godot 4 upgrade guide #6393](https://github.com/godotengine/godot-docs/pull/6393/files)
- [Upgrading to Godot 4](https://docs.godotengine.org/en/latest/tutorials/migrating/upgrading_to_godot_4.html)
- [GDScript progress report: Feature-complete for 4.0](https://godotengine.org/article/gdscript-progress-report-feature-complete-40/)
- [åŒå› ç´ è®¤è¯ï¼ˆ2FAï¼‰æ•™ç¨‹ - TOTP](https://ruanyifeng.com/blog/2017/11/2fa-tutorial.html)


ä½ç‰ˆæœ¬ä¸­çš„é¡¹ç›®å‡çº§ä¸ºé«˜ç‰ˆæœ¬é¡¹ç›®æ—¶ï¼ŒGodot 4 ä¼šæŒ‰å·²ç»çš„åç§°æ›¿æ¢è§„åˆ™ä¿®æ”¹ä»£ç åŠæ³¨è§£ï¼Œä½†ä¸ä¸€å®šä¹‰èƒ½æ­£ç¡®
å¤„ç†ç¨‹åºé€»è¾‘ã€‚è„šæœ¬æ–‡ä»¶å¯èƒ½å¼•ç”¨ä¸¢å¤±ï¼Œéœ€è¦é‡è¿åœ¨å·¥ç¨‹ä¸­å¯¼å…¥ã€‚å¹¶ä¸”å¯èƒ½å¯¼è‡´åœºæ™¯æ— æ³•è¿è¡Œï¼Œç”šè‡³å¯èƒ½å‡ºç°é—ªé€€ï¼Œ
è¿åˆå§‹åŒ–å‡½æ•°éƒ½ä¸ä¼šæ‰§è¡Œï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦è€ƒè™‘é‡æ–°æ„é€ åœºæ™¯èŠ‚ç‚¹ç»“æ„ã€‚

æ–°ç‰ˆæœ¬å¼•å…¥äº†ä¸¤ç§æ–°çš„å­—é¢é‡è¡¨è¾¾ï¼ŒStringName å’Œ % ^ èŠ‚ç‚¹è·¯å¾„è¡¨è¾¾

+--------------------------+----------------------------------------+
| **Literal**              | **Type**                               |
+--------------------------+----------------------------------------+
| ``45``                   | Base 10 integer                        |
| ``0x8f51``               | Base 16 (hexadecimal) integer          |
| ``0b101010``             | Base 2 (binary) integer                |
| ``3.14``, ``58.1e-10``   | Floating-point number (real)           |
| ``"Hello"``, ``"Hi"``    | Strings                                |
| ``"""Hello"""``          | Multiline string                       |
| ``&"name"``              | :ref:`StringName <class_StringName>`   |
| ``^"Node/Label"``        | :ref:`NodePath <class_NodePath>`       |
| ``$NodePath``            | Shorthand for ``get_node("NodePath")`` |
+--------------------------+----------------------------------------+


æ–°ç‰ˆæœ¬æ”¯æŒ Typed Arraysï¼š

```py
    var my_array: Array[int] = [1, 2, 3]
    var inferred_array := [1, 2, 3] # This is Array[int].
```

æ”¯æŒ Lambda å‡½æ•°ï¼Œå¢åŠ äº† `Callable` ç±»å‹ï¼š

```py
func _ready():
    var my_lambda = func(x):
        print(x)
    my_lambda.call("hello") # Callable.call()
    my_lambda.bind("hello").call() # Callable.bind(args).call()
```

ä¿¡å·å¯ä»¥ç›´æ¥ç»‘å®šä¸€ä¸ªæ–¹æ³•ï¼Œæ¯”æ—§å¼çš„è°ƒç”¨ connect() ç»‘å®šä¿¡å·æ›´ç›´è§‚ï¼š

```py
func _init():
    self.tree_entered.connect(func(): print("tree entered"))
```


å†…å­˜ç®¡ç†ä¸Šï¼Œä¸€èˆ¬ä½¿ç”¨ free() æˆ– queue_free() æ¥é‡Šæ”¾èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¼Œå¦å¤–ï¼Œä½¿ç”¨å¼±å¼•ç”¨ weakref()
å¯ä»¥é¿å…å¾ªç¯å¼•ç”¨è€Œå¯¼è‡´çš„å†…å­˜æ³„éœ²é—®é¢˜ã€‚

```py
    extends Node

    var my_node_ref

    func _ready():
        my_node_ref = weakref(get_node("MyNode"))

    func _this_is_called_later():
        var my_node = my_node_ref.get_ref()
        if my_node:
            my_node.do_something()
```

Godot 4.x å¼•å…¥çš„å¤šä¸ªå…³é”®å­—ï¼Œæˆ–å…³é”®å­—åŠŸèƒ½çš„æå‡ï¼š

- in ä½œä¸ºå…³é”®å­—å®šä¹‰ï¼Œå¯¹åº”æ—§ç‰ˆæœ¬çš„ TK_OP_INï¼Œç”¨äºå†³æ–­å…ƒç´ æ˜¯å¦åœ¨ string, list, range, å­—å…¸æˆ–è€…èŠ‚ç‚¹ä¸­ï¼Œä¹Ÿç”¨äº for å¾ªç¯ï¼›
- super ç”¨äºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°æˆ–æˆå‘˜ï¼Œä¸ç”¨åƒæ—§ç‰ˆæœ¬ä¸­é‚£æ ·ä½¿ç”¨ . è¿ç®—ç¬¦å·æ¥è°ƒç”¨çˆ¶ç±»ï¼›
- await æ›¿ä»£æ—§ç‰ˆæœ¬çš„ TK_PR_YIELDï¼Œè™½ç„¶ yield è¿™ä¸ªå…³é”®å­—è¿˜åœ¨ï¼Œä½†ä½¿ç”¨å®ƒåªä¼šå¾—åˆ°é”™è¯¯æç¤ºï¼›
- toolã€iconã€onreadyã€export ç­‰ç­‰å˜æ›´ä¸ºæ ‡æ³¨ï¼Œç”± GDScriptParser æä¾›å®ç°ï¼Œä¸åŒä½œä¸ºå…³é”®å­—ä½¿ç”¨ï¼›
- @warning_ignore å’Œ @rpc æ˜¯æ–°å¢çš„ä¸¤ä¸ªåŠŸèƒ½æ ‡æ³¨ï¼›

ç±»å½¢ç»§æ‰¿ä¸Šï¼Œå¼•å…¥äº† `super` å…³é”®å­—ç”¨äºè®¿é—®çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œæˆ–è€…æˆå‘˜æ–¹æ³•ï¼Œåœ¨æ—§ç‰ˆæœ¬è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼š

    func _init(args).(parent_args): ...

æ–°å¢çš„ @warning_ignore å’Œ @rpc ä¸¤ä¸ªåŠŸèƒ½æ ‡æ³¨ç”±äºæ–‡æ¡£æ›´æ–°å¯èƒ½ä¸åŠæ—¶ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒæºä»£ç ï¼›

| RPCMode | 
| "any_peer"  | "call_local"  | "reliable"           |
| "authority" | "call_remote" | "unreliable"         |
|             |               | "unreliable_ordered" |


æ–°ç‰ˆæœ¬ä¸­ @rpc å‚æ•°è¯´æ˜ï¼š

    @rpc(mode: String = "", sync: String = "", transfer_mode: String = "", transfer_channel: int = 0, ...) vararg

- `mode` - MultiplayerAPI.RPCMode ("any_peer", "authority").
- `sync` - calls the function locally too when RPCing ("call_local", "call_remote").
- `transfer_mode` - MultiplayerPeer.TranferMode (one of reliable, unreliable, unreliable_ordered).
- `transfer_channel` - Transfer channel (not used by the MultiplayerAPI for now, need implementation).


```cpp
# godot\master\modules\gdscript\gdscript_parser.cpp:3884
bool GDScriptParser::rpc_annotation(const AnnotationNode *p_annotation, Node *p_node) {
    ERR_FAIL_COND_V_MSG(p_node->type != Node::FUNCTION, false, vformat(R"("%s" annotation can only be applied to functions.)", p_annotation->name));

    FunctionNode *function = static_cast<FunctionNode *>(p_node);
    if (function->rpc_config.get_type() != Variant::NIL) {
        push_error(R"(RPC annotations can only be used once per function.)", p_annotation);
        return false;
    }

    Dictionary rpc_config;
    rpc_config["rpc_mode"] = MultiplayerAPI::RPC_MODE_AUTHORITY;
    if (!p_annotation->resolved_arguments.is_empty()) {
        int last = p_annotation->resolved_arguments.size() - 1;
        if (p_annotation->resolved_arguments[last].get_type() == Variant::INT) {
            rpc_config["channel"] = p_annotation->resolved_arguments[last].operator int();
            last -= 1;
        }
        if (last > 3) {
            push_error(R"(Invalid RPC arguments. At most 4 arguments are allowed, where only the last argument can be an integer to specify the channel.')", p_annotation);
            return false;
        }
        for (int i = last; i >= 0; i--) {
            String mode = p_annotation->resolved_arguments[i].operator String();
            if (mode == "any_peer") {
                rpc_config["rpc_mode"] = MultiplayerAPI::RPC_MODE_ANY_PEER;
            } else if (mode == "authority") {
                rpc_config["rpc_mode"] = MultiplayerAPI::RPC_MODE_AUTHORITY;
            } else if (mode == "call_local") {
                rpc_config["call_local"] = true;
            } else if (mode == "call_remote") {
                rpc_config["call_local"] = false;
            } else if (mode == "reliable") {
                rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_RELIABLE;
            } else if (mode == "unreliable") {
                rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_UNRELIABLE;
            } else if (mode == "unreliable_ordered") {
                rpc_config["transfer_mode"] = MultiplayerPeer::TRANSFER_MODE_UNRELIABLE_ORDERED;
            } else {
                push_error(R"(Invalid RPC argument. Must be one of: 'call_local'/'call_remote' (local calls), 'any_peer'/'authority' (permission), 'reliable'/'unreliable'/'unreliable_ordered' (transfer mode).)", p_annotation);
            }
        }
    }
    function->rpc_config = rpc_config;
    return true;
}

# godot\master\modules\gdscript\gdscript_parser.cpp:3863
bool GDScriptParser::warning_annotations(const AnnotationNode *p_annotation, Node *p_node) {
#ifdef DEBUG_ENABLED
    bool has_error = false;
    for (const Variant &warning_name : p_annotation->resolved_arguments) {
        GDScriptWarning::Code warning = GDScriptWarning::get_code_from_name(String(warning_name).to_upper());
        if (warning == GDScriptWarning::WARNING_MAX) {
            push_error(vformat(R"(Invalid warning name: "%s".)", warning_name), p_annotation);
            has_error = true;
        } else {
            p_node->ignored_warnings.push_back(warning);
        }
    }

    return !has_error;

#else // ! DEBUG_ENABLED
    // Only available in debug builds.
    return true;
#endif // DEBUG_ENABLED
}

# godot\master\modules\gdscript\gdscript_warning.cpp
String GDScriptWarning::get_name_from_code(Code p_code) {
    ERR_FAIL_COND_V(p_code < 0 || p_code >= WARNING_MAX, String());

    static const char *names[] = {
        "UNASSIGNED_VARIABLE",
        "UNASSIGNED_VARIABLE_OP_ASSIGN",
        "UNUSED_VARIABLE",
        "UNUSED_LOCAL_CONSTANT",
        "SHADOWED_VARIABLE",
        "SHADOWED_VARIABLE_BASE_CLASS",
        "UNUSED_PRIVATE_CLASS_VARIABLE",
        "UNUSED_PARAMETER",
        "UNREACHABLE_CODE",
        "UNREACHABLE_PATTERN",
        "STANDALONE_EXPRESSION",
        "NARROWING_CONVERSION",
        "INCOMPATIBLE_TERNARY",
        "UNUSED_SIGNAL",
        "RETURN_VALUE_DISCARDED",
        "PROPERTY_USED_AS_FUNCTION",
        "CONSTANT_USED_AS_FUNCTION",
        "FUNCTION_USED_AS_PROPERTY",
        "INTEGER_DIVISION",
        "UNSAFE_PROPERTY_ACCESS",
        "UNSAFE_METHOD_ACCESS",
        "UNSAFE_CAST",
        "UNSAFE_CALL_ARGUMENT",
        "UNSAFE_VOID_RETURN",
        "DEPRECATED_KEYWORD",
        "STANDALONE_TERNARY",
        "ASSERT_ALWAYS_TRUE",
        "ASSERT_ALWAYS_FALSE",
        "REDUNDANT_AWAIT",
        "EMPTY_FILE",
        "SHADOWED_GLOBAL_IDENTIFIER",
        "INT_AS_ENUM_WITHOUT_CAST",
        "INT_AS_ENUM_WITHOUT_MATCH",
        "STATIC_CALLED_ON_INSTANCE",
        "CONFUSABLE_IDENTIFIER",
        "RENAMED_IN_GODOT_4_HINT"
    };

    static_assert((sizeof(names) / sizeof(*names)) == WARNING_MAX, "Amount of warning types don't match the amount of warning names.");

    return names[(int)p_code];
}

GDScriptWarning::Code GDScriptWarning::get_code_from_name(const String &p_name) {
    for (int i = 0; i < WARNING_MAX; i++) {
        if (get_name_from_code((Code)i) == p_name) {
            return (Code)i;
        }
    }

    return WARNING_MAX;
}
```

å˜é‡å¯¼å‡º @export è¯­æ³•å˜åŒ–ï¼Œæ—§ç‰ˆä½¿ç”¨åœ†æ‹¬å·æŒ‡ç¤ºå¯¼å‡ºç±»å‹åŠå‚æ•°ï¼Œæ–°ç‰ˆå¯¼å‡ºç±»å‹è‡ªåŠ¨è¯†åˆ«ï¼Œæˆ–è€…å…³é”®å­—åç¼€è¡¨æ˜ã€‚

æ–°ç‰ˆæœ¬çš„ GDScript è¯­æ³•ä¸Šæœ‰äº›å˜åŠ¨ï¼Œå¦‚ onreadyã€export è¿™ç±»å…³é”®å­—ä½¿ç”¨ @onreadyã€@export è¿™æ ·çš„
æ ‡æ³¨æ–¹å¼ï¼Œå¹¶å¢åŠ äº†ä¸€äº›æ–°æ ‡æ³¨ã€‚åœ¨å°† Godot 3.x å·¥ç¨‹è¿ç§»åˆ° Godot 4.x æ—¶ï¼Œå¯èƒ½å› ä¸ºè¿™äº›è¯­æ³•å…¼å®¹é—®é¢˜ï¼Œ
å¯¼è‡´æ–°ç‰ˆæœ¬ä¸­ä¸èƒ½æ­£ç¡®æ‰“å¼€è„šæœ¬ï¼Œå¹¶æ˜¾ç¤ºè„šæœ¬å†…å®¹ã€‚

|        Annotation        |                           Description                           |
|--------------------------|-----------------------------------------------------------------|
| @tool                    | Enable the Tool mode.                                           |
| @onready                 | Defer initialization of variable until the node is in the tree. |
| @icon(path)              | Set the class icon to show in editor, used with class_name.     |
| @rpc                     | RPC modifiers. See high-level multiplayer docs.                 |
|--------------------------|-----------------------------------------------------------------|
| @export                  | Export hints for the editor. See GDScript exports.              |
| @export_enum             |                                                                 |
| @export_file             |                                                                 |
| @export_dir              |                                                                 |
| @export_global_file      |                                                                 |
| @export_global_dir       |                                                                 |
| @export_multiline        |                                                                 |
| @export_placeholder      |                                                                 |
| @export_range            |                                                                 |
| @export_exp_easing       |                                                                 |
| @export_color_no_alpha   |                                                                 |
| @export_node_path        |                                                                 |
| @export_flags            |                                                                 |
| @export_flags_2d_render  |                                                                 |
| @export_flags_2d_physics |                                                                 |
| @export_flags_3d_render  |                                                                 |
| @export_flags_3d_physics |                                                                 |


```py
    # (optional) class definition:
    class_name MyClass
 
    # Inheritance:
    extends BaseClass
 
    # (optional) icon to show in the editor dialogs:
    @icon("res://path/to/optional/icon.svg")
```

å±æ€§ï¼ˆPropertiesï¼‰çš„å®šä¹‰è¯­æ³•ç³–å˜æ›´ï¼Œæ—§ç‰ˆæœ¬å±æ€§ä½¿ç”¨ setget æŒ‡å®šå±æ€§è¯»å†™å™¨ï¼Œæ–°ç‰ˆæœ¬å€Ÿé‰´äº†æ›´ç®€æ´çš„
C# è¯­æ³•æ ¼å¼ï¼Œç›´æ¥åœ¨å±æ€§å®šä¹‰åä½¿ç”¨ ``set`` å’Œ ``get`` å®šä¹‰è®¿é—®å™¨ã€‚æ³¨æ„ï¼Œæ—§ç‰ˆ setter æˆ– getter 
ä¸­ç›´æ¥è®¿é—®å±æ€§è€Œä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œåœ¨æ–°ç‰ˆæœ¬ getterã€setter è°ƒç”¨å…¶å®ƒå‡½æ•°æ—¶è¯»å†™äº†å±æ€§å€¼æ—¶ï¼Œåˆ™ä¼š
å¯¼è‡´å¾ªç¯è®¿é—®é—®é¢˜ã€‚

éœ€è¦è®¾ç½®é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨é»˜è®¤å€¼åé¢æ·»åŠ å†’å·å†å®šä¹‰å±æ€§è®¿é—®å™¨ã€‚

```py
    signal changed(new_value)
    var warns_when_changed = "some value":
        get:
            return warns_when_changed
        set(value):
            changed.emit(value)
            warns_when_changed = value

    var my_prop:
        get = get_my_prop, set = set_my_prop
```

Unlike ``setget`` in previous Godot versions, the properties setter and getter 
are **always** called, even when accessed inside the same class (with or without 
prefixing with ``self.``). This makes the behavior consistent. If you need direct 
access to the value, use another variable for direct access and make the property
code use that name.

æ–°å¢åŠ  Lambda functionsï¼Œå®šä¹‰åŒ¿åå‡½æ•°æ›´æ–¹ä¾¿ï¼Œä¸å¿…å®ä¾‹åŒ– Callable ç±»å°±åªå¯ä»¥é€šè¿‡å‡½æ•°åˆ›å»ºä¸€ä¸ª
å¯è°ƒç”¨å¯¹è±¡ã€‚ä¸ºäº†è°ƒè¯•ç›®çš„ï¼Œå¯ä»¥ç»™åŒ¿åå‡½æ•°æŒ‡å®šä¸€ä¸ªåç§°ã€‚åŒ¿åå‡½æ•°ä¼šæ•æ‰å½“å‰å±€éƒ¨ç¯å¢ƒï¼Œå˜é‡ä¼šæŒ‰å€¼ä¼ é€’ï¼Œæ‰€ä»¥
å±€éƒ¨å˜é‡çš„åç»­å˜åŠ¨ä¸ä¼šåæ˜ åˆ°åŒ¿åå‡½æ•°å†…ï¼š

```py
    var lambda = func(x): print(x)
    lambda.call(42) # Prints "42"

    # Lambda functions can be named for debugging purposes::

    var lambda = func my_lambda(x):
        print(x)

    # Lambda functions capture the local environment. Local variables are passed by value, 
    # so they won't be updated in the lambda if changed in the local function::

    var x = 42
    var my_lambda = func(): print(x)
    my_lambda.call() # Prints "42"
    x = "Hello"
    my_lambda.call() # Prints "42"
```

ä¿¡å·é“¾æ¥å¤„ç†æ–¹æ³•çš„å˜åŒ–ï¼ŒCallable å¯ä»¥ç›´æ¥è·å–ç±»å‹æ–¹æ³•æˆå‘˜è€Œæ¥ï¼Œä¹Ÿå¯ä»¥å’Œ lambda è¡¨è¾¾é…åˆä½¿ç”¨ã€‚å¯¹äº
è¦ç»‘å®šå‚æ•°çš„éœ€æ±‚ï¼Œå°±ç›´æ¥ä½¿ç”¨ Callable å¯¹è±¡çš„ bind() æ–¹æ³•æ¥ç»‘å®šã€‚

å¦å¤–ï¼Œå•æ¬¡è§¦å‘å¸¸é‡åå­—å˜æ›´ä¸º CONNECT_ONE_SHOTï¼Œæ—§ç‰ˆä¸º CONNECT_ONESHOTã€‚

```py
Error connect(signal: StringName, callable: Callable, flags: int = 0)
void disconnect(signal: StringName, callable: Callable)
bool is_connected(signal: StringName, callable: Callable) const
# node.connect(some_method.bind("arg", 100))
```

æ–°ç‰ˆæœ¬å¼•å…¥ `await` å…³é”®å­—å–ä»£ yield ç”¨äºåç¨‹çš„å¼‚æ­¥ç¼–ç¨‹ï¼ŒAwaiting for signalsã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç 
ç‰‡æ–­æ¼”ç¤ºç­‰å¾…æŒ‰é’®çš„æŒ‰ä¸‹å¹¶é‡Šæ”¾æ—¶æ‰ç»§ç»­è¿è¡Œå‡½æ•°ã€‚ä½¿ç”¨äº† await è¯­å¥çš„å‡½æ•°å°±ä¸æ˜¯ä¸€èˆ¬çš„å‡½æ•°ï¼Œè€Œæ˜¯åç¨‹ï¼Œè°ƒç”¨
åç¨‹æ—¶åŒæ ·éœ€è¦ä½¿ç”¨ await å…³é”®å­—ã€‚

```py
await self.process_frame
yield(get_tree(), "idle_frame") # ä¸‹ä¸€å¸§æ¢å¤æ‰§è¡Œ

GDScriptFunctionStateyield(object: Object = null, signal: String = "")


    func wait_confirmation():
        print("Prompting user")
        await $Button.button_up # Waits for the button_up signal from Button node.
        print("User confirmed")
        return true

    func request_confirmation():
        print("Will ask the user")
        var confirmed = await wait_confirmation()
        if confirmed:
            print("User confirmed")
        else:
            print("User cancelled")

    func wrong():
        var confirmed = wait_confirmation() # Will give an error.
```

ä½œä¸ºä¸€ä¸ªä¸ç›´æ¥æ·»åŠ åˆ°åœºæ™¯æ ‘çš„èŠ‚ç‚¹ç±»å‹ï¼ŒCanvasItem åœ¨æ—§ç‰ˆæœ¬ä¸­å¯ä»¥åœ¨èŠ‚ç‚¹è„šæœ¬ä¸­ç»§æ‰¿ï¼Œä½†åœ¨ Godot 4.x
ä¸­å¯èƒ½å¼•èµ· Could not find base class "CanvasItem"ã€‚

å…¨å±€ç©ºé—´ä¸­ OS çš„å˜åŠ¨ï¼Œå°†çª—å£ç›¸å…³çš„ API è°ƒæ•´åˆ° DisplayServer ç±»å‹ä¸­ï¼Œä»¥åŠ Clipboard APIï¼š

```py
    # Godot 4
    var id = DisplayServer.window_get_current_screen()
    var wsize = DisplayServer.window_get_size()
    var ssize = DisplayServer.screen_get_size(id)
    var center = (ssize - wsize) / 2
    DisplayServer.window_set_position(center)
    
    # Center window on screen in GDScript 1.0
    var screen_size = OS.get_screen_size(OS.get_current_screen())
    var window_size = OS.get_window_size()
    var centered_pos = (screen_size - window_size) / 2
    OS.set_window_position(centered_pos)
```

å…¶å®ƒèŠ‚ç‚¹å¯¹è±¡åç§°åŠ API è°ƒæ•´ï¼š

+-----------------------------------------+-------------------------------------------+
| Old name (Godot 3.x)                    | New name (Godot 4)                        |
+=========================================+===========================================+
| AnimatedSprite                          | AnimatedSprite2D                          |
| ARVRCamera                              | XRCamera3D                                |
| ARVRController                          | XRController3D                            |
| ARVRAnchor                              | XRAnchor3D                                |
| ARVRInterface                           | XRInterface                               |
| ARVROrigin                              | XROrigin3D                                |
| ARVRPositionalTracker                   | XRPositionalTracker                       |
| ARVRServer                              | XRServer                                  |
| CubeMesh                                | BoxMesh                                   |
| EditorSpatialGizmo                      | EditorNode3DGizmo                         |
| EditorSpatialGizmoPlugin                | EditorNode3DGizmoPlugin                   |
| GIProbe                                 | VoxelGI                                   |
| GIProbeData                             | VoxelGIData                               |
| GradientTexture                         | GradientTexture1D                         |
| KinematicBody                           | CharacterBody3D                           |
| KinematicBody2D                         | CharacterBody2D                           |
| Light2D                                 | PointLight2D                              |
| LineShape2D                             | WorldBoundaryShape2D                      |
| Listener                                | AudioListener3D                           |
| NavigationMeshInstance                  | NavigationRegion3D                        |
| NavigationPolygonInstance               | NavigationRegion2D                        |
| Navigation2DServer                      | NavigationServer2D                        |
| PanoramaSky                             | Sky                                       |
| Particles                               | GPUParticles3D                            |
| Particles2D                             | GPUParticles2D                            |
| ParticlesMaterial                       | ParticleProcessMaterial                   |
| Physics2DDirectBodyState                | PhysicsDirectBodyState2D                  |
| Physics2DDirectSpaceState               | PhysicsDirectSpaceState2D                 |
| Physics2DServer                         | PhysicsServer2D                           |
| Physics2DShapeQueryParameters           | PhysicsShapeQueryParameters2D             |
| Physics2DTestMotionResult               | PhysicsTestMotionResult2D                 |
| PlaneShape                              | WorldBoundaryShape3D                      |
| Position2D                              | Marker2D                                  |
| Position3D                              | Marker3D                                  |
| ProceduralSky                           | Sky                                       |
| RayShape                                | SeparationRayShape3D                      |
| RayShape2D                              | SeparationRayShape2D                      |
| ShortCut                                | Shortcut                                  |
| Spatial                                 | Node3D                                    |
| Camera                                  | Camera3D                                    |
| SpatialGizmo                            | Node3DGizmo                               |
| SpatialMaterial                         | StandardMaterial3D                        |
| Sprite                                  | Sprite2D                                  |
| StreamTexture                           | CompressedTexture2D                       |
| TextureProgress                         | TextureProgressBar                        |
| VideoPlayer                             | VideoStreamPlayer                         |
| ViewportContainer                       | SubViewportContainer                      |
| Viewport                                | SubViewport                               |
| VisibilityEnabler                       | VisibleOnScreenEnabler3D                  |
| VisibilityNotifier                      | VisibleOnScreenNotifier3D                 |
| VisibilityNotifier2D                    | VisibleOnScreenNotifier2D                 |
| VisibilityNotifier3D                    | VisibleOnScreenNotifier3D                 |
| VisualServer                            | RenderingServer                           |
| VisualShaderNodeScalarConstant          | VisualShaderNodeFloatConstant             |
| VisualShaderNodeScalarFunc              | VisualShaderNodeFloatFunc                 |
| VisualShaderNodeScalarOp                | VisualShaderNodeFloatOp                   |
| VisualShaderNodeScalarClamp             | VisualShaderNodeClamp                     |
| VisualShaderNodeVectorClamp             | VisualShaderNodeClamp                     |
| VisualShaderNodeScalarInterp            | VisualShaderNodeMix                       |
| VisualShaderNodeVectorInterp            | VisualShaderNodeMix                       |
| VisualShaderNodeVectorScalarMix         | VisualShaderNodeMix                       |
| VisualShaderNodeScalarSmoothStep        | VisualShaderNodeSmoothStep                |
| VisualShaderNodeVectorSmoothStep        | VisualShaderNodeSmoothStep                |
| VisualShaderNodeVectorScalarSmoothStep  | VisualShaderNodeSmoothStep                |
| VisualShaderNodeVectorScalarStep        | VisualShaderNodeStep                      |
| VisualShaderNodeScalarSwitch            | VisualShaderNodeSwitch                    |
| VisualShaderNodeScalarTransformMult     | VisualShaderNodeTransformOp               |
| VisualShaderNodeScalarDerivativeFunc    | VisualShaderNodeDerivativeFunc            |
| VisualShaderNodeVectorDerivativeFunc    | VisualShaderNodeDerivativeFunc            |
| VisualShaderNodeBooleanUniform          | VisualShaderNodeBooleanParameter          |
| VisualShaderNodeColorUniform            | VisualShaderNodeColorParameter            |
| VisualShaderNodeScalarUniform           | VisualShaderNodeFloatParameter            |
| VisualShaderNodeCubeMapUniform          | VisualShaderNodeCubeMapParameter          |
| VisualShaderNodeTextureUniform          | VisualShaderNodeTexture2DParameter        |
| VisualShaderNodeTextureUniformTriplanar | VisualShaderNodeTextureParameterTriplanar |
| VisualShaderNodeTransformUniform        | VisualShaderNodeTransformParameter        |
| VisualShaderNodeVec3Uniform             | VisualShaderNodeVec3Parameter             |
| VisualShaderNodeUniform                 | VisualShaderNodeParameter                 |
| VisualShaderNodeUniformRef              | VisualShaderNodeParameterRef              |
| File                                    | FileAccess                                |
| Directory                               | DirAccess                                 |
| SceneTreeTween                          | Tween                                     |
+-----------------------------------------+-------------------------------------------+

**Removed or replaced nodes/resources**

+---------------------+-----------------------+----------------------------------------------------------------------------+
| Removed node        | Closest approximation | Comment                                                                    |
+=====================+=======================+============================================================================+
| AnimationTreePlayer | AnimationTree         | AnimationTreePlayer was deprecated since Godot 3.1.                        |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| BakedLightmap       | LightmapGI            | See :ref:`doc_baked_lightmaps`.                                            |
+---------------------+-----------------------+                                                                            |
| BakedLightmapData   | LightmapGIData        |                                                                            |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| BitmapFont          | FontFile              | See :ref:`doc_gui_using_fonts`.                                            |
+---------------------+-----------------------+                                                                            |
| DynamicFont         | FontFile              |                                                                            |
+---------------------+-----------------------+                                                                            |
| DynamicFontData     | FontFile              |                                                                            |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| Navigation2D        | Node2D                | Replaced by :ref:`other 2D Navigation nodes <doc_navigation_overview_2d>`. |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| Navigation3D        | Node3D                | Replaced by :ref:`other 3D Navigation nodes <doc_navigation_overview_3d>`. |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| OpenSimplexNoise    | FastNoiseLite         | Has different parameters and more noise types such as cellular. No         |
|                     |                       | support for 4D noise as it's absent from the FastNoiseLite library.        |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| ToolButton          | Button                | ToolButton was Button with the **Flat** property enabled by default.       |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| YSort               | Node2D                | Node2D has a new **Y Sort** property in 4.0.                               |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| ProximityGroup      | Node3D                | :ref:`class_VisibleOnScreenNotifier3D` can act as a replacement.           |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| Portal              | Node3D                | Portal and room occlusion culling was replaced by raster                   |
|                     |                       | :ref:`occlusion culling <doc_occlusion_culling>`                           |
|                     |                       | (OccluderInstance3D node), which requires a different setup process.       |
+---------------------+-----------------------+                                                                            |
| Room                | Node3D                |                                                                            |
+---------------------+-----------------------+                                                                            |
| RoomManager         | Node3D                |                                                                            |
+---------------------+-----------------------+                                                                            |
| RoomGroup           | Node3D                |                                                                            |
+---------------------+-----------------------+----------------------------------------------------------------------------+
| Occluder            | Node3D                | Geometry occlusion culling was replaced by raster                          |
|                     |                       | :ref:`occlusion culling <doc_occlusion_culling>`                           |
|                     |                       | (OccluderInstance3D node), which requires a different setup process.       |
+---------------------+-----------------------+                                                                            |
| OccluderShapeSphere | Resource              |                                                                            |
+---------------------+-----------------------+----------------------------------------------------------------------------+

|-----------------|-------------------------------------|------------------------------------------|
|      Object     |              Godot 3.x              |                Godot 4.x                 |
|-----------------|-------------------------------------|------------------------------------------|
| @GDScript       | deg2rad()                           | @GlobalScope.deg_to_rad()                |
|-----------------|-------------------------------------|------------------------------------------|
| CanvasItem      | update()                            | queue_redraw()                           |
| ClassDB         | instance()                          | instantiate()                            |
| PackedScene     | instance()                          | instantiate()                            |
| Object          | property_list_changed_notify()      | notify_property_list_changed()           |
| Control         | rect_min_size                       | custom_minimum_size                      |
|                 | rect_size                           | size                                     |
| Label           | ALIGN_CENTER                        | HORIZONTAL_ALIGNMENT_CENTER              |
| Color           | darkorange                          | DARK_ORANGE                              |
| Engine          | editor_hint                         | is_editor_hint()                         |
| Sprite          | Sprite.rotation_degrees             | Sprite2D.rotation                        |
|-----------------|-------------------------------------|------------------------------------------|
| Node            | find_node()                         | find_child                               |
|-----------------|-------------------------------------|------------------------------------------|
| Spatial         | global_translation                  | Node3D.global_position                   |
|-----------------|-------------------------------------|------------------------------------------|
| TileMap         | cell_size                           | tile_set.tile_size                       |
|                 | local_to_map/map_to_local           | world_to_map/map_to_world                |
|-----------------|-------------------------------------|------------------------------------------|
| Theme Overrides | custom_colors/font_color            | theme_override_colors/font_color         |
|                 | custom_colors/font_color_shadow     | theme_override_colors/font_shadow_color  |
|                 | custom_colors/font_outline_modulate | theme_override_colors/font_outline_color |
|                 | custom_constants/shadow_offset_y    | theme_override_constants/shadow_offset_x |
|-----------------|-------------------------------------|------------------------------------------|
| Anchor & Margin | anchor_left & margin_left           | anchors_preset                           |
| Rect Position   | rect_position                       | position                                 |
| Node            | name: String                        | name: StringName                         |
| SceneTree       | idle_frame                          | process_frame                            |
| EditorInterface | get_editor_viewport()               | get_base_control()                       |
| OS              | get_scancode_string                 | get_keycode_string()                     |
|-----------------|-------------------------------------|------------------------------------------|
| InputEventKey   | scancode                            | keycode                                  |
|                 | physical_scancode                   | physical_keycode                         |
|                 |                                     |                                          |


### ğŸŸ ğŸ”µ Godot Editor Layout ç¼–è¾‘å™¨å¸ƒå±€
- [Documentation Writing guidelines](https://docs.godotengine.org/en/latest/contributing/documentation/docs_writing_guidelines.html)

æ ¹æ®å®˜æ–¹æ–‡æ¡£ Writing guidelines æ‰€å±•ç¤ºçš„ Godot ç”¨æˆ·ç•Œé¢ç»“æ„ï¼š

![Overview of the interface](https://docs.godotengine.org/en/latest/_images/editor-vocabulary-overview.png)

Godot ç”¨æˆ·ç•Œé¢åŒ…å«ä»¥ä¸‹å‡ ä¸ªå¸ƒå±€ç»“æ„ï¼š

- Main Menu ä¸»èœå•æ ï¼›
- ä¸»å·¥ä½œè§†å›¾åŒºåˆ‡æ¢å·¥å…·æ ï¼ŒåŒ…æ‹¬ 2D, 3D, Script, AssetLib æŒ‰é’®ï¼Œå¯¹åº” `CONTAINER_TOOLBAR`ï¼›
- Workspace ä¸»å·¥ä½œè§†å›¾åŒºï¼ŒåŒ…å« Main Viewport å’Œ Toolbarï¼›
- Scene Tree Dock å·¥ç¨‹ä¸­çš„åœºæ™¯æ ‘é¢æ¿ï¼›
- FileSystem Dock æ–‡ä»¶èµ„æºç›®å½•é¢æ¿ï¼›
- Inspector Dock å±æ€§æ¢æµ‹å™¨é¢æ¿ï¼›
- Bottom Panel åº•éƒ¨é¢æ¿åŒºï¼›
- Toolbar å³ä¸Šè§’å·¥å…·æŒ‰é’®åŒºï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„åœºæ™¯è¿è¡Œæµ‹è¯•æŒ‰é’®ç­‰ç­‰ï¼›

ä¸»å·¥ä½œè§†å›¾åŒºä¸­çš„è§†å£ç”¨äºå®¹çº³å„ç§ä¸“ç”¨ç¼–è¾‘å™¨ï¼Œé»˜è®¤æœ‰ 2D, 3D, Script, AssetLibï¼Œå…¶ä¸­ 2D/3D ç¼–è¾‘å™¨
åˆåˆ’åˆ†ä¸ºï¼šèœå•åŒºã€SIDE_LEFTã€SIDE_RIGHT å’Œ BOTTOM åŒºåŸŸã€‚

ä½¿ç”¨ EditorPlugin çš„ä¿¡å·å¯ä»¥ç›‘æµ‹åˆ°ä¸»å·¥ä½œåŒºè§†å›¾ç±»å‹çš„åˆ‡æ¢ï¼š

- *main_screen_changed(screen_name: String)* è§†å›¾åç§°ä¸º 2D, 3D, Script, AssetLibï¼Œä¹Ÿå¯ä»¥ç”±ç”¨æˆ·æ’ä»¶å®šä¹‰ã€‚
- *project_settings_changed()* ä¿®æ”¹å·¥ç¨‹é…ç½®ï¼Œå³é…ç½®æ”¹å˜å³è§¦å‘æ­¤ä¿¡å·ã€‚
- *resource_saved(resource: Resource)* ä¿å­˜æ–‡ä»¶èµ„æºæ—¶è§¦å‘ã€‚
- *scene_changed(scene_root: Node)* ä¸»å·¥ä½œè§†å›¾ä¸­åˆ‡æ¢åœºæ™¯æ—¶è§¦å‘ï¼Œå¦‚æœå…³é—­äº†æ‰€æœ‰åœºæ™¯æˆ–åªæœ‰æ–°åœºæ™¯ï¼Œå‚æ•°å€¼ä¸º nullã€‚
- *scene_closed(filepath: String)* å…³é—­åœºæ™¯æ—¶è§¦å‘ï¼Œæ–‡ä»¶è·¯å¾„ä¸ºå·²å…³é—­çš„åœºæ™¯ã€‚

åœé åè®¾ç½®äº† 8 ä¸ªæ§½ä½ç”¨äºåœæ”¾å„ç§é¢æ¿ï¼Œå·¦å³ä¸¤ä¾§å„ 4 ä¸ªæ§½ä½ï¼Œé€šè¿‡é¢æ¿å³ä¸Šè§’çš„ä¸‰ç‚¹å›¾æ ‡æŒ‰é’®å¼¹å‡ºèœå•ï¼Œ
å¯ä»¥è°ƒæ•´é¢æ¿çš„åœé ä½ã€‚è¿™äº›æ§½ä½ä½¿ç”¨ `DockSlot` æšä¸¾ç±»å‹å®šä¹‰ã€‚

Godot ç¼–è¾‘å™¨ä¸­çš„å„ç§é¢æ¿å°±æ˜¯ä¸€ä¸ªä¸ªå®¹å™¨ï¼Œ`CustomControlContainer` æšä¸¾æ ‡è®°è¿™äº›å®¹å™¨ï¼Œå¯¹å„ä¸ªå®¹å™¨
è¿›è¡Œä¿®æ”¹æ—¶éœ€è¦é€šè¿‡å®ƒæ¥æŒ‡å®šè¦æ“ä½œçš„å®¹å™¨ã€‚

é€šè¿‡ EditorPlugin æ¥å¼•ç”¨ä»¥ä¸‹è¿™äº›æšä¸¾å€¼ï¼š

|     CustomControlContainer Enum     | Value |                             Note                            |
|-------------------------------------|-------|-------------------------------------------------------------|
| CONTAINER_TOOLBAR                   |     0 | Main editor toolbar, next to play buttons.                  |
| CONTAINER_SPATIAL_EDITOR_MENU       |     1 | The toolbar that appears when 3D editor is active.          |
| CONTAINER_SPATIAL_EDITOR_SIDE_LEFT  |     2 | Left sidebar of the 3D editor.                              |
| CONTAINER_SPATIAL_EDITOR_SIDE_RIGHT |     3 | Right sidebar of the 3D editor.                             |
| CONTAINER_SPATIAL_EDITOR_BOTTOM     |     4 | Bottom panel of the 3D editor.                              |
| CONTAINER_CANVAS_EDITOR_MENU        |     5 | The toolbar that appears when 2D editor is active.          |
| CONTAINER_CANVAS_EDITOR_SIDE_LEFT   |     6 | Left sidebar of the 2D editor.                              |
| CONTAINER_CANVAS_EDITOR_SIDE_RIGHT  |     7 | Right sidebar of the 2D editor.                             |
| CONTAINER_CANVAS_EDITOR_BOTTOM      |     8 | Bottom panel of the 2D editor.                              |
| CONTAINER_INSPECTOR_BOTTOM          |     9 | Bottom section of the inspector.                            |
| CONTAINER_PROJECT_SETTING_TAB_LEFT  |    10 | Tab of Project Settings dialog, to the left of other tabs.  |
| CONTAINER_PROJECT_SETTING_TAB_RIGHT |    11 | Tab of Project Settings dialog, to the right of other tabs. |

|   DockSlot Enum    | Value |                                                Note                                                |
|--------------------|-------|----------------------------------------------------------------------------------------------------|
| DOCK_SLOT_LEFT_UL  |     0 | Dock slot, left side, upper-left (empty in default layout).                                        |
| DOCK_SLOT_LEFT_BL  |     1 | Dock slot, left side, bottom-left (empty in default layout).                                       |
| DOCK_SLOT_LEFT_UR  |     2 | Dock slot, left side, upper-right (in default layout includes Scene and Import docks).             |
| DOCK_SLOT_LEFT_BR  |     3 | Dock slot, left side, bottom-right (in default layout includes FileSystem dock).                   |
| DOCK_SLOT_RIGHT_UL |     4 | Dock slot, right side, upper-left (empty in default layout).                                       |
| DOCK_SLOT_RIGHT_BL |     5 | Dock slot, right side, bottom-left (empty in default layout).                                      |
| DOCK_SLOT_RIGHT_UR |     6 | Dock slot, right side, upper-right (in default layout includes Inspector, Node and History docks). |
| DOCK_SLOT_RIGHT_BR |     7 | Dock slot, right side, bottom-right (empty in default layout).                                     |


é€šè¿‡æ’ä»¶å¯¹è±¡ `EditorPlugin` æä¾›çš„æ–¹æ³•ï¼Œget_editor_interface()ï¼Œå¯ä»¥è·å–åˆ° `EditorInterface`ï¼Œ
è¿™ä¸ªç¼–è¾‘å™¨æ¥å£å¯¹è±¡ä»£è¡¨æ•´ä¸ª Godot ç¼–è¾‘å™¨ã€‚

ç¼–è¾‘å™¨æ¥å£æä¾›äº†å¤šä¸ªæ–¹æ³•ï¼Œç”¨äºè·å– Godot IDE ç•Œé¢çš„å„ä¸ªåŠŸèƒ½åŒºï¼Œä½¿ç”¨ **get_editor_viewport()**
è·å–åˆ°çš„æ˜¯å½“å‰ç•Œé¢çš„ Main Viewportï¼Œå®ƒåŒ…å« 2D/3Dï¼ŒScript, AssetLib ç­‰ç¼–è¾‘å™¨è§†å›¾ã€‚è¿™ä¸ªé¡¶å±‚è§†å£
ä¸‹åŒ…å«ä¸€ä¸ª **EditorNode**ï¼Œå¯ä»¥é€šè¿‡æºä»£ç è§‚å¯Ÿå…¶èŠ‚ç‚¹ç»„ç»‡å±‚æ¬¡ã€‚Main Screen æ’ä»¶å°±æ˜¯å°†è‡ªå·±çš„åœºæ™¯é€šè¿‡
add_child(MainPanel) æ·»åŠ åˆ° Main Viewport ä¸‹å®ç°ä¸»å±å¹•çš„å®šåˆ¶ã€‚

æ–°æ—§ç‰ˆæœ¬ Main Screen èŠ‚ç‚¹è·å–æ–¹æ³•ï¼š
```py
 Control get_editor_viewport() # Godot 3.x
VBoxContainer get_editor_main_screen() # Godot 4.x
```

é€šè¿‡æ¥å£çš„â€œæ·»åŠ â€æ–¹æ³•å¯ä»¥äº†è§£åˆ°ï¼ŒGodot ç¼–è¾‘å™¨çš„å„ä¸ªåŒºåŸŸéƒ½å¯ä»¥è¿›è¡Œå®šåˆ¶ï¼š

```py
void add_autoload_singleton(name: String, path: String)
Button add_control_to_bottom_panel(control: Control, title: String)
void add_control_to_container(container: CustomControlContainer, control: Control)
void add_control_to_dock(slot: DockSlot, control: Control)
void add_custom_type(type: String, base: String, script: Script, icon: Texture2D)
void add_debugger_plugin(script: EditorDebuggerPlugin)
void add_export_plugin(plugin: EditorExportPlugin)
void add_import_plugin(importer: EditorImportPlugin, first_priority: bool = false)
void add_inspector_plugin(plugin: EditorInspectorPlugin)
void add_node_3d_gizmo_plugin(plugin: EditorNode3DGizmoPlugin)
void add_resource_conversion_plugin(plugin: EditorResourceConversionPlugin)
void add_scene_format_importer_plugin(scene_format_importer: EditorSceneFormatImporter, first_priority: bool = false)
void add_scene_post_import_plugin(scene_import_plugin: EditorScenePostImportPlugin, first_priority: bool = false)
void add_tool_menu_item(name: String, callable: Callable)
void add_tool_submenu_item(name: String, submenu: PopupMenu)
void add_translation_parser_plugin(parser: EditorTranslationParserPlugin)
void add_undo_redo_inspector_hook_callback(callable: Callable)
```

éƒ¨åˆ† API è¯´æ˜ï¼š

- *add_autoload_singleton()* å¯¹åº” Project â†’ Project Settings... â†’ Autoload çš„å…¨å±€åŠ è½½åŠŸèƒ½ï¼›
- *add_control_to_bottom_panel()* ç»™åº•éƒ¨é¢æ¿åŒºåŸŸæ·»åŠ èŠ‚ç‚¹ï¼Œè‡ªå®šä¹‰é¢æ¿ï¼Œtitle ä¼šä½œä¸ºåˆ‡æ¢æŒ‰é’®çš„æ ‡é¢˜ï¼›
- *add_control_to_container()* ç»™æŒ‡å®šå®¹å™¨æ·»åŠ èŠ‚ç‚¹ï¼Œè‡ªå®šä¹‰é¢æ¿ï¼›
- *add_control_to_dock()* ç»™æŒ‡å®š DockSlot æ’æ§½æ·»åŠ èŠ‚ç‚¹ï¼Œè‡ªå®šä¹‰é¢æ¿ï¼›
- *add_custom_type()* å‘ Godot æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ï¼›
- *add_tool_menu_iteme()* å‘ Project > Tools èœå•æ·»åŠ èœå•é¡¹ï¼›
- *add_tool_submenu_iteme()* å‘ Project > Tools èœå•æ·»åŠ å­èœå•ï¼›

æ‰€æœ‰è‡ªå®šä¹‰é¢æ¿æœ‰å¯¹åº”çš„æ–¹æ³•æ·»åŠ åˆ°æŒ‡å®šåŒºåŸŸï¼Œä¹Ÿæœ‰å¯¹åº”çš„ remove æ–¹æ³•æ¥è§£é™¤ï¼Œéœ€è¦åœ¨é€‚å½“çš„æ—¶é—´ï¼Œå¦‚æ’ä»¶
ç¦ç”¨æ—¶ï¼Œç§»é™¤è¿™äº›è‡ªå®šä¹‰é¢æ¿ã€‚

è™½ç„¶ï¼Œå¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„ get_parent() æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦é™„åŠ åˆ°ç•Œé¢ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡ remove_child() æ–¹æ³•
ç›´æ¥ç§»é™¤èŠ‚ç‚¹ï¼Œå¿…éœ€è°ƒç”¨ä¸“ç”¨æ–¹æ³•ã€‚åŠ è½½åœºæ™¯æ—¶éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨ `preload` å…³é”®å­—é‡å¤åŠ è½½åŒä¸€èµ„æºå¯èƒ½å¯¼è‡´å¾ªç¯åŠ è½½ï¼Œ
å‡ºé”™å¯¼è‡´åœºæ™¯ä¸­çš„è„šæœ¬æ— æ³•è¢«æ‰§è¡Œã€‚

é»˜è®¤æ·»åŠ æ–°é¢æ¿çš„ä½ç½®åœ¨åï¼Œå¯¹äº CONTAINER_TOOLBAR æ¥è¯´ï¼Œæ–°åŠ å…¥çš„æŒ‰é’®å°±åœ¨å³ä¾§ï¼Œå¯ä»¥é€šè¿‡çˆ¶çº§èŠ‚ç‚¹
çš„ move_child() æ–¹æ³•æ¥è°ƒæ•´æ–°å¢æŒ‰é’®çš„ä½ç½®ï¼š

```py
    add_control_to_container(CONTAINER_TOOLBAR, container)
    # We are 100% sure that there are 2 items to the left.
    container.get_parent().move_child(container, container.get_index() - 2)
```

EditorInterface è¿˜å¯ä»¥è·å–å…¶å®ƒä¸€äº›å¯¹è±¡æˆ–åœºæ™¯ä¿¡æ¯ï¼Œè¿™äº›å¯¹è±¡é€šå¸¸ä¸åº”è¯¥ç›´æ¥å®ä¾‹åŒ–ï¼š

```py
EditorSettings get_editor_settings()
FileSystemDock get_file_system_dock()
EditorInspector get_inspector() const
EditorFileSystem get_resource_filesystem()
EditorResourcePreview get_resource_previewer()
ScriptEditor get_script_editor()
```


### ğŸŸ ğŸ”µ GDScript Plugins æ’ä»¶æ‰©å±•
- [Editor plugins](https://docs.godotengine.org/en/stable/tutorials/plugins/editor/index.html)
- [Conditionally Export Properties in Godot](http://kehomsforge.com/tutorials/single/gdConditionalProperty)
- [Plugin Demos](https://github.com/godotengine/godot-demo-projects/tree/master/plugins)
- [2.5D Demo Project with GDScript](https://godotengine.github.io/godot-demo-projects/misc/2.5d/)
- [Ridiculous Coding](https://github.com/jotson/ridiculous_coding)
- [Shell Fur 0.3.0 by Arnklit](https://godotengine.org/asset-library/asset/752)
- [Material Maker by R0dZill4](https://godotengine.org/showcase/material-maker/)
- [Irfanview Plugins](https://www.irfanview.com/plugins.htm#UpdatedPlugins)
- [How and why to use EXR in Blender](https://artisticrender.com/how-and-why-to-use-exr-in-blender/)
- [Standard Material 3D and ORM Material 3D](https://docs.godotengine.org/en/latest/tutorials/3d/standard_material_3d.html)
- [Learn GDScript from ZERO online](https://gdquest.github.io/learn-gdscript/)
- [Learn GDScript from ZERO](https://github.com/GDQuest/learn-gdscript)
- [Editor Highlighter](https://github.com/GDQuest/godot-plugin-highlighter)
- [Godot 2D Visual Novel](https://github.com/GDQuest/godot-2d-visual-novel)
- [GDQuest Godot Demos](https://github.com/GDQuest/godot-demos)
- [GDQuest Godot Shaders](https://github.com/GDQuest/godot-shaders)
- [GDQuest Godot Plugin Tour](https://github.com/GDQuest/godot-plugin-tour)
- [Godot Steering AI motion](https://github.com/GDQuest/godot-steering-ai-framework-submodule)
- [GDQuest Godot Design Patterns](https://github.com/GDQuest/godot-design-patterns)
- [Godello kanban board](https://github.com/alfredbaudisch/Godello)
- [UI Design Tool](https://godotengine.org/asset-library/asset/717)
- https://godotengine.org/article/we-should-all-use-gltf-20-export-3d-assets-game-engines/
- [the Godot glTF 2.0 scene exporter](https://godotengine.org/article/introducing-the-godot-gltf-2-0-scene-exporter/)
- [Better Collada Blender add-on](https://github.com/godotengine/collada-exporter)

Ridiculous Coding æ’ä»¶ä¸º Godot ç¼–è¾‘å™¨æä¾›ç¼–å†™ä»£ç æ—¶çš„æ‰“å­—ç‰¹æ•ˆï¼Œè¿™ä¸ªæ’ä»¶å€¼å¾—å­¦ä¹ ï¼Œä»–å·²ç»å°† Godot
æœ¬èº«å°±æ˜¯æ¸¸æˆè¿™ä¸ªæ¦‚å¿µç©é€äº†ï¼Œæ’ä»¶å°±æ˜¯åŸºäºæ¸¸æˆæ„æ¶æœ¬èº«å®šä¹‰çš„ä¸€ç§èŠ‚ç‚¹ï¼ŒåŒæ—¶ Godot ç¼–è¾‘å™¨ä¹Ÿæ˜¯ç”±åŒä¸€å¥—èŠ‚ç‚¹
æŒ‰æŒ‡å®šçš„å¸ƒå±€ç¼–æ’å¾—åˆ°çš„ã€‚


å·¥å…·è„šæœ¬å’Œæ’ä»¶æ˜¯æ‰©å±• Godot IDE èƒ½åŠ›çš„ä¸¤ç§ä¸ŠåŸºæœ¬æ–¹æ³•ã€‚

ç¼–å†™ç¼–è¾‘å™¨æ’ä»¶ï¼Œç»§æ‰¿ **EditorPlugin** ç±»å‹ï¼Œå¯ä»¥ä¸ºç¼–è¾‘å™¨æä¾›æ›´å¤šåŠŸèƒ½ã€‚Asset Library æä¾›äº†
ç°æœ‰çš„æ’ä»¶ï¼Œåœ¨ Godot IDE ä¸­å¯ä»¥ç›´æ¥æœç´¢ã€å®‰è£…å„ç§æ’ä»¶ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨ä¸‹è½½æ’ä»¶ï¼Œå®‰è£…åˆ°é¡¹ç›®çš„ addons ç›®å½•ä¸‹ã€‚

Godot Plugins æœ‰å¤šç§ç±»å‹ï¼š

- Editor plugins **EditorPlugin** æ‰€æœ‰ç¼–è¾‘å™¨æ’ä»¶çš„åŸºç±»ï¼›
- Main screen plugins ä¸»å±æ’ä»¶ï¼›
- Import plugins **EditorImportPlugin** èµ„æºå¯¼å…¥æ’ä»¶ï¼›
- Spatial gizmo plugins **EditorSpatialGizmo** ç©ºé—´èŠ‚ç‚¹è¾…åŠ©çº¿æ¡†æ’ä»¶ï¼›
- Inspector plugins **EditorInspectorPlugin** å±æ€§æ¢æµ‹å™¨æ’ä»¶ï¼›
- Visual Shader plugins **VisualShaderNodeCustom** å¯è§†åŒ–ç€è‰²å™¨èŠ‚ç‚¹æ’ä»¶ï¼›

ä¸»å±æ’ä»¶é€šè¿‡ç¼–è¾‘å™¨æ’ä»¶çš„ **has_main_screen()**ã€**get_editor_interface ( )** ç­‰æ–¹æ³•å®ç°ï¼Œ
é…åˆ **EditorInterface** æ¥å£ç±»å‹å¯¹ç¼–è¾‘å™¨ä¸»ç•Œé¢è¿›è¡Œæ‰©å±•ï¼Œåƒé¡¶éƒ¨çš„ 2Dã€3Dã€Scriptã€AssetLib 
ä¸€æ ·ï¼Œä»æ•´ä½“ä¸Šæ”¹å˜ç¼–è¾‘å™¨ç•Œé¢ã€‚å› ä¸º Godot IDE ç•Œé¢å°±æ˜¯ä½¿ç”¨å¼•æ“è‡ªèº«å®ç°çš„ï¼Œç¨‹åºé€»è¾‘ç±»ä¼¼å¼€å‘ä¸€ä¸ªæ¸¸æˆã€‚

å¦å¤–ï¼Œå¯è§†åŒ–ç€è‰²å™¨æ’ä»¶ä¸»è¦æ˜¯é€šè¿‡ GDScript è„šæœ¬ä¸º VisualShader æ·»åŠ èŠ‚ç‚¹ã€‚

å°†è„šæœ¬ä½œä¸º Godot IDE å·¥å…·ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹å°±å¯ä»¥è¿è¡Œè„šæœ¬è¿›è¡Œè‡ªåŠ¨åŒ–å·¥ä½œçš„å¤„ç†ï¼Œé…åˆç¬¦å·å¯¼å‡ºï¼Œä¸å±æ€§
æ¢æµ‹å™¨ç´§å¯†ç»“åˆã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å®ç°ä¸€ä¸ª MyTitle æ ‡ç­¾æ§ä»¶ï¼Œåœ¨åœºæ™¯æ ‘ä¸­æ·»åŠ æ§ä»¶æ—¶ï¼Œå°±ä¼šè¿è¡Œè„šæœ¬å®Œæˆæ§ä»¶çš„
åŸºæœ¬è®¾ç½®ï¼Œè‡ªåŠ¨åŒ¹é…å½“å‰å·¥ç¨‹çš„è§†å£å®½åº¦ã€‚é€šè¿‡å¯¼å‡ºç”¨äºä¿å­˜èµ„æºçš„å˜é‡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å±æ€§æ¢æµ‹å™¨ä¸­ç»™æ§ä»¶è®¾ç½®
ä¸€ä¸ªçº¹ç†å›¾ç‰‡ï¼Œæ§ä»¶å°†ä¼šè‡ªåŠ¨å°†å…¶æ·»åŠ åˆ°èŠ‚ç‚¹æ ‘ä¸­ã€‚

åœ¨å·¥å…·è„šæœ¬ä¸­ï¼Œå¦‚æœä¿®æ”¹äº†å¯¼å‡ºçš„å˜é‡ï¼Œä¸ºäº†ä½¿ç”¨å±æ€§æ¢æµ‹å™¨ä¸­èƒ½åŠæ—¶åæ˜ å‡ºå˜åŒ–ï¼Œå°±éœ€è¦ä½¿ç”¨ **Object** 
æä¾›çš„ property_list_changed_notify() æ–¹æ³•å‘å¸ƒé€šçŸ¥ã€‚ä»¥ä¸‹è„šæœ¬ä¸­ï¼Œåœ¨ AutoRefresh ä¸ºæ¿€æ´»æ—¶ï¼Œ
è„šæœ¬è®¾ç½® ResourceInfo å˜é‡çš„å˜åŒ–å°±å¯ä»¥åŠæ—¶åæ˜ åœ¨å±æ€§æ¢æµ‹å™¨ä¸Šï¼š

```py
tool

class_name MyTitle, "res://icon.png" extends Label

export var resource: Resource setget set_resource
export var ResourceInfo:String

# Auto Refresh inspector property list
export var AutoRefresh:bool = true

func set_resource(res: Resource):
    resource = res
    ResourceInfo = res.resource_path if res else ""
    
    if res is Texture:
        var tr = ClassDB.instance("TextureRect") # TextureRect.new()
        tr.texture = res
        for child in get_children():
            remove_child(child)
        add_child(tr)
    
    if AutoRefresh:
        .property_list_changed_notify()
    
func _ready():
    if Engine.editor_hint and not text:
        text = "MyTitle"
        rect_min_size = Vector2(ProjectSettings.get("display/window/size/width"), 64)
    # else:
    #   rect_min_size = Vector2(get_tree().root.size.x, 64)

func _init():
    set("align", ALIGN_CENTER)
    set("valign", ALIGN_CENTER)
    set("custom_colors/font_size", Color.whitesmoke)
    set("custom_colors/font_color", Color.whitesmoke)
    set("custom_colors/font_color_shadow", Color.darkorange)
    set("custom_constants/shadow_offset_x", 2)
    set("custom_constants/shadow_offset_y", 2)
    set("custom_constants/shadow_offset_y", 2)
    
    theme = load("res://L7 UI/theme.tres")
    theme_type_variation = "MyLabel"
```

éœ€è¦æ³¨æ„ï¼ŒNode æ•°æ®å¯ä»¥ç”±å¤šç§è®¾ç½®æ–¹å¼ï¼Œåœ¨åœºæ™¯ä¸­åˆ›å»ºèŠ‚ç‚¹åï¼Œç”¨æˆ·å¯ä»¥åœ¨å±æ€§æ¢æµ‹å™¨ä¸­è®¾ç½®èŠ‚ç‚¹æ•°æ®ï¼Œæˆ–è€…
ä¹Ÿå¯ä»¥é€šè¿‡å·¥å…·è„šæœ¬çš„å½¢å¼è®¾ç½®æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šä¿å­˜åœ¨åœºæ™¯æ–‡ä»¶ TSCN ä¸­ï¼Œè¿™æ˜¯ Godot åœºæ™¯çš„å­—ç¬¦ä¸²ä¿å­˜æ ¼å¼ã€‚
åˆ—å¦‚ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ª MyTitle èŠ‚ç‚¹åœ¨åœºæ™¯æ–‡ä»¶ä¸­ä¿å­˜çš„æ ¼å¼ï¼š

    [node name="MyTitle" parent="." index="0"]
    text = "IO & Serialization"

MyTitle æ ‡ç­¾åœ¨æ–°åˆ›å»ºæ—¶ï¼Œtext ä¸ºç©ºï¼Œè¿™æ—¶å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤æ ‡é¢˜å†…å®¹ã€‚ä½†æ˜¯ï¼Œåœ¨åç»­é‡æ–°æ‰“å¼€åœºæ™¯æ—¶ï¼Œ
å·¥å…·è„šæœ¬ä¼šå†æ¬¡è¿è¡Œï¼Œæ­¤æ—¶å¦‚ä¸ä¸åˆ¤æ–­æ•°æ®æ˜¯å¦è¢«æ”¹å˜ï¼Œåˆ™å¯èƒ½ä¼šå°†ç”¨æˆ·åœ¨å±æ€§æ¢æµ‹å™¨ä¸­è®¾ç½®çš„æ•°æ®è¦†ç›–ã€‚
å·²ç»åœ¨åœºæ™¯ä¸­è®¾ç½®å¥½çš„æ•°æ®ä¼šåœ¨ç±»å‹æ„é€ è¿‡ç¨‹ä¸­åŠ è½½ï¼Œåœ¨åˆå§‹åŒ–æ–¹æ³• **_init()** ä¸­å°±å¯ä»¥è®¿é—®ã€‚

é€šè¿‡è„šæœ¬æ·»åŠ çš„èŠ‚ç‚¹å¹¶ä¸ä¼šå‡ºç°åœ¨åœºæ™¯æ ‘é¢æ¿ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´è„šæœ¬æ·»åŠ çš„ç”Ÿæˆçš„èŠ‚ç‚¹å†…å®¹ä¸ä¼šè¢«è®°å½•åˆ°åœºæ™¯æ–‡ä»¶ä¸­ï¼Œ
èŠ‚ç‚¹ç±»æœ‰ä¸€ä¸ª owner å±æ€§ï¼Œç»™èŠ‚ç‚¹çš„è®¾ç½®çš„æ‰€æœ‰è€…å¯ä»¥æ˜¯ä»»æ„çº§çš„çˆ¶èŠ‚ç‚¹ï¼Œåªè¦æ˜¯æœ‰æ•ˆçš„çˆ¶èŠ‚ç‚¹ã€å¢çˆ¶èŠ‚ç‚¹ç­‰ç­‰ï¼Œ
è¿™æ ·ï¼Œåœºæ™¯ä¿å­˜ä¸º PackedSceneï¼Œå³ TSCN æ–‡ä»¶æ—¶å°±ä¼šè®°å½•ä¸‹å·²æŒ‡å®š owner çš„èŠ‚ç‚¹æ•°æ®ï¼ŒåŒ…æ‹¬ owner ç‚¹ã€‚
é€šå¸¸åœ¨æ’ä»¶ä¸­è°ƒç”¨ add_child() æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œé™„å¸¦è®¾ç½® owner ä»¥è®°å½•å¤æ‚çš„åœºæ™¯æ ‘ç»“æ„ã€‚

ä¸è®¾ç½®æ‰€æœ‰è€…çš„æƒ…å†µä¸‹è°ƒç”¨ add_child()ï¼Œåˆ™æ–°æ·»åŠ çš„èŠ‚ç‚¹å°†åœ¨åœºæ™¯æ ‘ä¸­ä¸å¯è§ï¼Œåªåœ¨ 2D/3D è§†å›¾ä¸­å¯è§ã€‚
åœºæ™¯æ ¹èŠ‚ç‚¹ owner ä¸º nullã€‚

åœ¨ç¼–å†™æ’ä»¶æ—¶æ³¨æ„ï¼ŒGodot å¯ä»¥åˆ‡æ¢ä¸åŒçš„åœºæ™¯æ–‡ä»¶ï¼Œæ‰€ä»¥åªæœ‰èŠ‚ç‚¹å·²ç»é™„åŠ åˆ°åœºæ™¯æ ‘ä¸­ï¼Œå³æ¿€æ´»çš„èŠ‚ç‚¹æ‰èƒ½
é€šè¿‡ get_tree() è·å–åˆ° ScreenTree å¼•ç”¨ã€‚ç¼–è¾‘å™¨åˆ‡æ¢åˆ°å…¶å®ƒåœºæ™¯åï¼Œå¦‚æœèŠ‚ç‚¹æ³¨å†Œçš„äº‹ä»¶è¿˜åœ¨å·¥ä½œï¼Œ
å°±ä¸èƒ½å†ä½¿ç”¨ get_tree() æ¥è·å–åœºæ™¯æ ‘çš„å¼•ç”¨ï¼ŒEditorPlugin åˆ™æ€»æ˜¯å¯ä»¥é€šè¿‡ **get_tree()** è·å–åˆ°ã€‚
è¦æ¸…æ¥šï¼Œåœºæ™¯æ ‘åœ¨æ•´ä¸ªå·¥ç¨‹ä¸­åªæœ‰ä¸€ä¸ªï¼Œæœ€é¡¶å±‚å§‹ç»ˆæ˜¯ root å±æ€§å¼•ç”¨çš„ Viewportã€‚åœºæ™¯å´ä¸æ–­åœ°åˆ‡æ¢ï¼Œåœºæ™¯
æ ¹èŠ‚ç‚¹ä¹Ÿä¸æ–­å˜æ›´ï¼Œæ’ä»¶çš„ **get_edited_scene_root()** æ–¹æ³•è·å–å½“å‰å¤„äºç¼–è¾‘ä¸­çš„åœºæ™¯æ ¹èŠ‚ç‚¹ã€‚

æ³¨æ„ï¼ŒEditorPlugin åªæœ‰åœ¨ç¼–è¾‘å™¨æ¨¡å¼ä¸‹æ‰è¢«å®ä¾‹åŒ–ï¼Œåœ¨æ¸¸æˆè¿è¡Œæ¨¡å¼æ‰§è¡Œå®ä¾‹åŒ–æ—¶è¿”å›ç©ºå¼•ç”¨ã€‚å¦å¤–ï¼Œé€šè¿‡
get_selection() è¿”å›çš„èŠ‚ç‚¹é€‰æ‹©å¯¹è±¡ä¸èƒ½æŒä¹…å¼•ç”¨ï¼Œåœ¨åˆ‡æ¢ç¼–è¾‘åœºæ™¯æ—¶ä¼šå¤±æ•ˆã€‚


```py
tool
extend Node2D

var editor = EditorPlugin.new().get_editor_interface()

func _ready():
    pass

func _enter_tree():
    var selection = editor.get_selection()
    selection.connect("selection_changed", self, "attach_to_scenetree")
    get_tree().connect("node_added", self, "_on_node_added", [], CONNECT_ONESHOT)


func _exit_tree():
    var selection = editor.get_selection()
    selection.disconnect("selection_changed", self, "attach_to_scenetree")


func _on_node_added(node:Node):
    if node is Label:
        print("_on_node_added %s (%s)" % [node, node.text])


func attach_to_scenetree():
    var selection = editor.get_selection()
    var nodes = selection.get_selected_nodes()
    var sceneroot = editor.get_edited_scene_root()
    var root = editor.get_tree().root  # Top most level viewport $"/root"

    if not nodes.size():
        return
    print("node owner is ", nodes[0].owner)
    
    var label = ClassDB.instance("Label") # Label.new()
    label.text = "LabelText"
    nodes[0].add_child(label)
    label.owner = nodes[0].owner if nodes[0].owner else nodes[0]

    # yield(editor.get_tree(), "idle_frame")
    # call_deferred("add_child", label)
```



Godot IDE å·¥ç¨‹é…ç½®çš„æ’ä»¶é¢æ¿æä¾›äº†åˆ›å»ºæ’ä»¶çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨ Addons ç›®å½•ä¸‹åˆ›å»ºæ’ä»¶ï¼Œåˆ›å»ºä¸€ä¸ª
å­ç›®å½•ä¿å­˜æ’ä»¶æ–‡ä»¶ï¼Œé¦–å…ˆæ˜¯æ’ä»¶é…ç½®æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```sh
[plugin]

Plugin Name: MyPlugin
Subfolder: my_plugin
Description: A plugin to extend the Godot Engine.
Author: Your Name Here
Version: 1.0.0
Language: GDScript
Script Name: plugin.gd
Activate now: No
```

ç„¶åï¼Œå°±æ˜¯æ’ä»¶çš„ä¸»è¦è„šæœ¬ç¼–å†™ï¼Œéœ€è¦æ ¹æ®ä¸åŒç±»å‹çš„æ’ä»¶å»ç»§æ‰¿å¯¹åº”çš„æ’ä»¶åŸºç±»ã€‚å·¥ç¨‹æ’ä»¶é…ç½®ä¸­ï¼Œå¯ä»¥å¯¹æ’ä»¶
è¿›è¡Œæ¿€æ´»ã€ç¦ç”¨æ“ä½œï¼Œè€Œæ’ä»¶çš„å¯¹åº”å“åº”æ–¹æ³•æ˜¯è¿›å…¥ã€è„±ç¦»åœºæ™¯æ ‘äº‹ä»¶ï¼Œæ²¡æœ‰ä¸“ç”¨äº‹ä»¶ã€‚

ä¸€ä¸ªæœ€ç®€å•çš„æ’ä»¶å¯ä»¥åªåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒå‘å¼•æ“æ³¨å†Œè‡ªå®šä¹‰èŠ‚ç‚¹ï¼š

```py
tool
extends EditorPlugin

func _enter_tree():
    # When this plugin node enters tree, add the custom type
    add_custom_type("Heart", "Node2D", preload("res://addons/custom_node/heart.gd"), preload("res://addons/custom_node/heart_icon.png"))


func _exit_tree():
    # When the plugin node exits the tree, remove the custom type
    remove_custom_type("Heart")
```

è‡ªå®šä¹‰èŠ‚ç‚¹ Heart åŠŸèƒ½å¦‚ä¸‹ï¼Œåªæ˜¯è¿›è¡Œå›¾æ¡ˆç»˜åˆ¶ï¼š

```py
tool
extends Node2D

var heart = preload("res://addons/custom_node/heart.png")

func _draw():
    draw_texture(heart, -heart.get_size() / 2)


func _get_item_rect():
    # override
    return Rect2(-heart.get_size() / 2, heart.get_size())
```

å…¶å®ƒä¸€äº›ä¸“ç”¨æ’ä»¶åŸºäºè¿™ç§åŸºæœ¬ç»“æ„å®ç°ï¼Œå¦‚èµ„æºå¯¼å…¥æ’ä»¶ EditorImportPluginï¼Œé€šè¿‡ä¸“ç”¨æ–¹æ³•æ³¨å†Œæ’ä»¶ï¼š

```py
tool
extends EditorPlugin

var import_plugin

func _enter_tree():
    import_plugin = preload("import_plugin.gd").new()
    add_import_plugin(import_plugin)


func _exit_tree():
    remove_import_plugin(import_plugin)
    import_plugin = null
```

ä»¥ä¸‹ç¤ºèŒƒ Main Screen æ’ä»¶çš„å®ç°ï¼Œåœ¨ has_main_screen() æ–¹æ³•è¿”å› true è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªä¸»å±æ’ä»¶ã€‚

å½“ç”¨æˆ·åœ¨åœºæ™¯æ ‘ä¸­é€‰æ‹©ä¸åŒçš„èŠ‚ç‚¹æ—¶ï¼Œå¼•æ“ä¼šè°ƒç”¨ handles() æ–¹æ³•åˆ¤æ–­æ’ä»¶æ˜¯å¦è¦å¤„ç†è¿™ç§èŠ‚ç‚¹ï¼Œå¦‚æœéœ€è¦
å¤„ç†ï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨ make_visible() å‡†å¤‡åˆ‡æ¢åˆ°æ’ä»¶çš„ä¸»ç•Œé¢ï¼Œå¹¶è°ƒç”¨ edit() æ‰§è¡Œç¼–è¾‘ã€‚é™¤éç”¨æˆ·ç•Œé¢
å½“å‰å¤„äºè„šæœ¬ç¼–è¾‘ç•Œé¢ï¼Œå³ä½¿æ’ä»¶è¡¨ç¤ºéœ€è¦å¤„ç†å½“å‰èŠ‚ç‚¹ï¼Œè¿™æ—¶ä¹Ÿä¸ä¼šè§¦å‘åç»­çš„ç¼–è¾‘è¡Œä¸ºï¼š 

```py
bool handles(object: Object) virtual

void make_visible(visible: bool) virtual

void edit(object: Object) virtual
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ª Main Screen æ’ä»¶çš„å®ç°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åˆ›å»ºæ’ä»¶çš„é¢æ¿æ‰€ä½¿ç”¨çš„åœºæ™¯æ–‡ä»¶ï¼Œæ³¨æ„ä½¿ç”¨ tool å…³é”®å­—
ä»¥ä½¿è„šæœ¬åœ¨ç¼–è¾‘å™¨ä¸­å¯ä»¥è¢«æ‰§è¡Œã€‚ä½¿ç”¨ add_autoload_singleton() ç­‰æ–¹æ³•å¯ä»¥åŠ è½½å…¨å±€çš„ Singleton å¯¹è±¡ï¼Œ
ä½†æ˜¯è¿™ç§æ–¹æ³•åŠ è½½çš„å¯¹è±¡ï¼Œåœ¨æ’ä»¶ç¦ç”¨åå†æ¿€æ´»æ—¶ä¼šå‡ºç°ä¸ç¨³å®šé—®é¢˜ã€‚æ³¨æ„ï¼ŒæŒ‚è½½åœ¨ MainScrren åœºæ™¯ä¸­çš„è„šæœ¬
ä¸€å®šè¦æ·»åŠ  tool å…³é”®å­—æ ‡è®°å·¥å…·è„šæœ¬ï¼Œå¦åˆ™ä¸ä¼šè¢«æ‰§è¡Œï¼Œåªèƒ½é€šè¿‡æ’ä»¶è„šæœ¬æ¥å¤„ç† MainScreen åœºæ™¯ã€‚

æ·»åŠ  MainScreen æ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨ make_visible() æ–¹æ³•ä¸­è°ƒæ•´å…¶å¯è§å±æ€§ï¼Œä½†åˆæ¬¡æ·»åŠ èŠ‚ç‚¹åˆ°åœºæ™¯ä¸­æ—¶ï¼Œ
éœ€è¦é»˜è®¤åœ°éšè—å®ƒï¼Œå¦åˆ™æ¿€æ´»æ’ä»¶æ—¶ï¼Œä¼šå’Œå…¶å®ƒ MainScreen å…±ç”¨ Main Viewportã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ AssetLib
è§†å›¾çš„ Plugins æŒ‰é”®æ‰“å¼€æ’ä»¶æ—¶ï¼Œå°±ä¼šçœ‹åˆ°ä¸¤ä¸ª MainScreen åŒå±ã€‚

ä»¥ä¸‹æ˜¯ Godot 4.x ä¸­å®ç°çš„ä¸€ä¸ª MainScreen æ’ä»¶ï¼š

```py
@tool
extends EditorPlugin

const Main = preload("res://addons/MyMainScreen/Main.tscn")
var mainscreen = Main.instantiate()
var label = mainscreen.get_node("Label")
var container = get_editor_interface().get_editor_main_screen()


func _enter_tree():
    _make_visible(false)
    container.add_child(mainscreen)

func _ready():
    #main_screen_changed.connect(handle_main_screen_changed)
    pass

func _exit_tree():
    container.remove_child(mainscreen)
    mainscreen.queue_free()

func _has_main_screen():
    return true

func _make_visible(visible):
    mainscreen.visible = visible
    label.text = "mainscreen size: %s" % [mainscreen.size]

# Implement this function if your plugin edits a specific type of object (Resource or Node). 
# If you return true, then you will get the functions _edit() and _make_visible() called 
# when the editor requests them. If you have declared the methods _forward_canvas_gui_input() and 
# _forward_3d_gui_input() these will be called too.
func _handles(object):
    print_debug("handles MainScreen only: ", object)
    return object is MainScreen


# This function is used for plugins that edit specific object types (nodes or resources). 
# It requests the editor to edit the given object.
# object can be null if the plugin was editing an object, but there is no longer 
# any selected object handled by this plugin. It can be used to cleanup editing state.
func _edit(object):
    mainscreen.get_node("Label").text = "editing: %s" % [object]

# Custom plugin name displayed in the Godot editor.
# For main screen plugins, this appears at the top of the screen, 
# to the right of the "2D", "3D", "Script", and "AssetLib" buttons.
func _get_plugin_name():
    return "MS"

func _get_plugin_icon():
    # You can use a custom icon:
    return preload("res://addons/MyMainScreen/bullet_32.svg")
    # Or use a built-in icon:
    return get_editor_interface().get_base_control().get_theme_icon("Node", "EditorIcons")
```

æ’ä»¶æä¾›äº†å¤šä¸ªæ–¹æ³•ï¼Œç”¨äºå¾€ Godot IDE ä¸»ç•Œé¢æ·»åŠ ä»»æ„çš„æ§ä»¶èŠ‚ç‚¹ï¼Œå¦‚å³ä¸Šè§’çš„ Toolbar åŒºåŸŸï¼ŒæŒ‡å®šä¸“ç”¨
å®¹å™¨ï¼Œåº•éƒ¨çš„ Bottom Panel åŒºåŸŸï¼Œåˆæˆ–è€…æ˜¯åœé å DockSlotã€‚å¹¶ä¸”éœ€è¦åœ¨æ’ä»¶ç¦æ­¢æ—¶ï¼Œè°ƒç”¨ç›¸åº”çš„æ–¹æ³•è§£é™¤ã€‚
è™½ç„¶ï¼Œå¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„ get_parent() æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦é™„åŠ åˆ°ç•Œé¢ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡ remove_child() æ–¹æ³•
ç›´æ¥ç§»é™¤èŠ‚ç‚¹ï¼Œå¿…éœ€è°ƒç”¨ä¸“ç”¨æ–¹æ³•ã€‚åŠ è½½åœºæ™¯æ—¶éœ€è¦æ³¨æ„ï¼Œä½¿ç”¨ preload å…³é”®å­—é‡å¤åŠ è½½åŒä¸€èµ„æºå¯èƒ½å¯¼è‡´å¾ªç¯åŠ è½½ï¼Œ
å‡ºé”™å¯¼è‡´åœºæ™¯ä¸­çš„è„šæœ¬æ— æ³•è¢«æ‰§è¡Œï¼š

```py
tool
extends Button

# When reactived plugin cause error:
# Autoload singleton 'MyPluginAutoload' has been removed.
#onready var ap:EditorPlugin = MyPluginAutoload
onready var plugin:EditorPlugin = EditorPlugin.new()
onready var panel:Node = load("res://addons/main_screen/main_panel.tscn").instance()

enum Location { NoneSet = 0, DockSlot= 1, Toolbar = 2, BottomBar = 3 }
var location

func _exit_tree():
    if panel:
        detach()
        panel.queue_free()
        print("panel ", panel)

func detach():
    if not panel.get_parent():
        return
    
    #panel.get_parent().remove_child(panel)
    match location:
        Location.DockSlot:
            plugin.remove_control_from_docks(panel)
        Location.BottomBar:
            plugin.remove_control_from_bottom_panel(panel)
        Location.Toolbar:
            plugin.remove_control_from_container(EditorPlugin.CONTAINER_TOOLBAR, panel)

func _on_Button_pressed():
    detach()
    location = Location.BottomBar
    plugin.add_control_to_bottom_panel(panel, "MyPlugin")


func _on_Button2_pressed():
    detach()
    location = Location.DockSlot
    plugin.add_control_to_dock(EditorPlugin.DOCK_SLOT_LEFT_BL, panel)


func _on_Button3_pressed():
    detach()
    location = Location.Toolbar
    plugin.add_control_to_container(EditorPlugin.CONTAINER_TOOLBAR, panel)
```


### ğŸŸ ğŸ”µ GDScript grammar è¯­æ³•è§„èŒƒæ–‡æ¡£
- [GDScript grammar](https://docs.godotengine.org/en/stable/development/file_formats/gdscript_grammar.html)
- [GDScript exports](https://docs.godotengine.org/en/3.5/tutorials/scripting/gdscript/gdscript_exports.html)
- [GDScript format strings](https://docs.godotengine.org/en/stable/tutorials/scripting/gdscript/gdscript_format_string.html)
- [GDScript 2.0](https://docs.godotengine.org/en/latest/tutorials/scripting/gdscript/gdscript_basics.html)
- [GDScript 2.0 exports](https://docs.godotengine.org/en/latest/tutorials/scripting/gdscript/gdscript_exports.html)

GDScript grammar

This is the formal grammar of GDScript written in EBNF, for reference purposes.

Note

This grammar is descriptive only, derived from the reference documentation and 
current implementation. The GDScript parser is not generated from a grammar definition. 
Inconsistencies here likely mean an error in this grammar, not a bug in GDScript.

```rs
(* GDScript EBNF grammar.
   Uppercase words are terminals generated by the tokenizer.
   INDENT/DEDENT are not generated by the tokenizer yet, but they are added
   here for reading convenience.
   Naturally, this only cover syntax. Semantics can't be inferred from this
   description.
*)

program = [ inheritance NEWLINE ] [ className ] { topLevelDecl } ;

inheritance = "extends" ( IDENTIFIER | STRING ) { "." IDENTIFIER } ;
className = "class_name" IDENTIFIER [ "," STRING ] NEWLINE ;

topLevelDecl
    = classVarDecl
    | constDecl
    | signalDecl
    | enumDecl
    | methodDecl
    | constructorDecl
    | innerClass
    | "tool"
    ;

classVarDecl = [ "onready" ] [ export ] "var" IDENTIFIER [ ":" typeHint ]
    [ "=" expression ] [ setget ] NEWLINE ;
setget = "setget" [ IDENTIFIER ] [ "," IDENTIFIER] ;
export = "export" [ "(" [ BUILTINTYPE | IDENTIFIER { "," literal } ] ")" ] ;
typeHint = BUILTINTYPE | IDENTIFIER ;

constDecl = "const" IDENTIFIER [ ":" typeHint ] "=" expression NEWLINE ;

signalDecl = "signal" IDENTIFIER [ signalParList ] NEWLINE ;
signalParList = "(" [ IDENTIFIER { "," IDENTIFIER } ] ")" ;

enumDecl = "enum" [ IDENTIFIER ] "{" [ IDENTIFIER [ "=" INTEGER ]
    { "," IDENTIFIER [ "=" INTEGER ] } [ "," ] ] "}" NEWLINE ;

methodDecl = [ rpc ] [ "static" ] "func" IDENTIFIER "(" [ parList ] ")"
    [ "->" typeHint] ":" stmtOrSuite ;
parList = parameter { "," parameter } ;
parameter = [ "var" ] IDENTIFIER [ ":" typeHint ] [ "=" expression ] ;
rpc = "remote" | "master" | "puppet"
    | "remotesync" | "mastersync"  | "puppetsync";

constructorDecl = "func" IDENTIFIER "(" [ parList ] ")"
    [ "." "(" [ argList ] ")" ] ":" stmtOrSuite ;
argList = expression { "," expression } ;

innerClass = "class" IDENTIFIER [ inheritance ] ":" NEWLINE
    INDENT [ inheritance NEWLINE ] topLevelDecl { topLevelDecl } DEDENT ;

stmtOrSuite = stmt | NEWLINE INDENT suite DEDENT ;
suite = stmt { stmt };

stmt
    = varDeclStmt
    | ifStmt
    | forStmt
    | whileStmt
    | matchStmt
    | flowStmt
    | assignmentStmt
    | exprStmt
    | assertStmt
    | yieldStmt
    | preloadStmt
    | "breakpoint" stmtEnd
    | "pass" stmtEnd
    ;
stmtEnd = NEWLINE | ";" ;

ifStmt = "if" expression ":" stmtOrSuite { "elif" expression ":" stmtOrSuite }
    [ "else" ":" stmtOrSuite ] ;
whileStmt = "while" expression ":" stmtOrSuite;
forStmt = "for" IDENTIFIER "in" expression ":" stmtOrSuite ;

matchStmt = "match" expression ":" NEWLINE INDENT matchBlock DEDENT;
matchBlock = patternList ":" stmtOrSuite { patternList ":" stmtOrSuite };
patternList = pattern { "," pattern } ;
(* Note: you can't have a binding in a pattern list, but to not complicate the
grammar more it won't be restricted syntactically *)
pattern = literal | BUILTINTYPE | CONSTANT | "_" | bindingPattern
    | arrayPattern | dictPattern ;
bindingPattern = "var" IDENTIFIER ;
arrayPattern = "[" [ pattern { "," pattern } [ ".." ] ] "]" ;
dictPattern = "{" [ keyValuePattern ] { "," keyValuePattern } [ ".." ] "}" ;
keyValuePattern = STRING [ ":" pattern ] ;

flowStmt
    = "continue" stmtEnd
    | "break" stmtEnd
    | "return" [ expression ] stmtEnd
    ;

assignmentStmt = subscription "=" expression stmtEnd;
varDeclStmt = "var" IDENTIFIER [ "=" expression ] stmtEnd;

assertStmt = "assert" "(" expression [ "," STRING ] ")" stmtEnd ;
yieldStmt = "yield" "(" [ expression "," expression ] ")" ;
preloadStmt = "preload" "(" CONSTANT ")" ;

(* This expression grammar encodes precedence. Items later in the list have
higher precedence than the ones before. *)
exprStmt = expression stmtEnd ;
expression = cast [ "[" expression "]" ] ;
cast = ternaryExpr [ "as" typeHint ];
ternaryExpr = logicOr [ "if" logicOr "else" logicOr ] ;
logicOr = logicAnd { ( "or" | "||" ) logicAnd } ;
logicAnd = logicNot { ( "and" | "&&" ) logicNot };
logicNot = ( "!" | "not" ) logicNot | in;
in = comparison { "in" comparison };
comparison = bitOr { ( "<" | ">" | "<=" | ">=" | "==" | "!=" ) bitOr } ;
bitOr = bitXor { "|" bitXor } ;
bitXor = bitAnd { "^" bitAnd } ;
bitAnd = bitShift { "&" bitShift } ;
bitShift = minus { ( "<<" | ">>" ) minus } ;
minus = plus { "-" plus } ;
plus = factor { "+" factor } ;
factor = sign { ( "*" | "/" | "%" ) sign } ;
sign = ( "-" | "+" ) sign | bitNot ;
bitNot = "~" bitNot | is ;
is = call [ "is" ( IDENTIFIER | BUILTINTYPE ) ] ;
call = attribute [ "(" [ argList ] ")" ];
attribute = subscription { "." IDENTIFIER } ;
subscription = primary [ "[" expression "]" ] ;
primary = "true" | "false" | "null" | "self" | literal | arrayDecl
    | dictDecl | "(" expression ")" ;

literal = STRING | NUMBER | IDENTIFIER | BUILTINTYPE
    | "PI" | "TAU" | "NAN" | "INF" ;
arrayDecl = "[" [ expression { "," expression } "," ] "]" ;
dictDecl = "{" [ keyValue { "," keyValue } "," ] "}" ;
keyValue
    = expression ":" expression
    | IDENTIFIER "=" expression
    ;
```

æ–°ç‰ˆæœ¬è§„èŒƒå˜åŒ–ä¸»è¦æœ‰ä¸¤å¤„ï¼š

```py
    assignmentStmt = subscription ( "=" | "+=" | "-=" | "*=" | "/="
    | "%=" | "&=" | "|=" | "^=" ) expression stmtEnd;

    call
        = (attribute [ "(" [ argList ] ")" ])
        | "." IDENTIFIER "(" [ argList ] ")"
        | "$" ( STRING | IDENTIFIER { '/' IDENTIFIER } );
```

### ğŸŸ ğŸ”µ GDScript 1.0 exports
- [GDScript 1.0 exports](https://github.com/godotengine/godot-docs/blob/3.6/tutorials/scripting/gdscript/gdscript_exports.rst)
- [GDScript 2.0 exports](https://github.com/godotengine/godot-docs/blob/master/tutorials/scripting/gdscript/gdscript_exports.rst)



Introduction to exports
    ----------------------------------------------------------------------------

In Godot, class members can be exported. This means their value gets saved along
with the resource (such as the :ref:`scene <class_PackedScene>`) they're
attached to. They will also be available for editing in the property editor.
Exporting is done by using the ``export`` keyword::

    extends Button

    export var number = 5 # Value will be saved and visible in the property editor.

An exported variable must be initialized to a constant expression or have an
export hint in the form of an argument to the ``export`` keyword (see the
*Examples* section below).

One of the fundamental benefits of exporting member variables is to have
them visible and editable in the editor. This way, artists and game designers
can modify values that later influence how the program runs. For this, a
special export syntax is provided.

.. note::

    Exporting properties can also be done in other languages such as C#.
    The syntax varies depending on the language.

..
   See  ref `doc_c_sharp_exports` for information on C# exports.

Examples
    ----------------------------------------------------------------------------

::

```py
    # If the exported value assigns a constant or constant expression,
    # the type will be inferred and used in the editor.

    export var number = 5

    # Export can take a basic data type as an argument, which will be
    # used in the editor.

    export(int) var number

    # Export can also take a resource type to use as a hint.

    export(Texture) var character_face
    export(PackedScene) var scene_file
    # There are many resource types that can be used this way, try e.g.
    # the following to list them:
    export(Resource) var resource

    # Integers and strings hint enumerated values.

    # Editor will enumerate as 0, 1 and 2.
    export(int, "Warrior", "Magician", "Thief") var character_class
    # Editor will enumerate with string names.
    export(String, "Rebecca", "Mary", "Leah") var character_name

    # Named enum values

    # Editor will enumerate as THING_1, THING_2, ANOTHER_THING.
    enum NamedEnum {THING_1, THING_2, ANOTHER_THING = -1}
    export(NamedEnum) var x

    # Strings as paths

    # String is a path to a file.
    export(String, FILE) var f
    # String is a path to a directory.
    export(String, DIR) var f
    # String is a path to a file, custom filter provided as hint.
    export(String, FILE, "*.txt") var f

    # Using paths in the global filesystem is also possible,
    # but only in scripts in "tool" mode.

    # String is a path to a PNG file in the global filesystem.
    export(String, FILE, GLOBAL, "*.png") var tool_image
    # String is a path to a directory in the global filesystem.
    export(String, DIR, GLOBAL) var tool_dir

    # The MULTILINE setting tells the editor to show a large input
    # field for editing over multiple lines.
    export(String, MULTILINE) var text

    # Limiting editor input ranges

    # Allow integer values from 0 to 20.
    export(int, 20) var i
    # Allow integer values from -10 to 20.
    export(int, -10, 20) var j
    # Allow floats from -10 to 20 and snap the value to multiples of 0.2.
    export(float, -10, 20, 0.2) var k
    # Allow values 'y = exp(x)' where 'y' varies between 100 and 1000
    # while snapping to steps of 20. The editor will present a
    # slider for easily editing the value.
    export(float, EXP, 100, 1000, 20) var l

    # Floats with easing hint

    # Display a visual representation of the 'ease()' function
    # when editing.
    export(float, EASE) var transition_speed

    # Colors

    # Color given as red-green-blue value (alpha will always be 1).
    export(Color, RGB) var col
    # Color given as red-green-blue-alpha value.
    export(Color, RGBA) var col

    # Nodes

    # Another node in the scene can be exported as a NodePath.
    export(NodePath) var node_path
    # Do take note that the node itself isn't being exported -
    # there is one more step to call the true node:
    onready var node = get_node(node_path)

    # Resources

    export(Resource) var resource
    # In the Inspector, you can then drag and drop a resource file
    # from the FileSystem dock into the variable slot.

    # Opening the inspector dropdown may result in an
    # extremely long list of possible classes to create, however.
    # Therefore, if you specify an extension of Resource such as:
    export(AnimationNode) var resource
    # The drop-down menu will be limited to AnimationNode and all
    # its inherited classes.
```
It must be noted that even if the script is not being run while in the
editor, the exported properties are still editable. This can be used
in conjunction with a :ref:`script in "tool" mode <doc_gdscript_tool_mode>`.

Exporting bit flags
    ----------------------------------------------------------------------------

Integers used as bit flags can store multiple ``true``/``false`` (boolean)
values in one property. By using the export hint ``int, FLAGS, ...``, they
can be set from the editor::

    # Set any of the given flags from the editor.
    export(int, FLAGS, "Fire", "Water", "Earth", "Wind") var spell_elements = 0

You must provide a string description for each flag. In this example, ``Fire``
has value 1, ``Water`` has value 2, ``Earth`` has value 4 and ``Wind``
corresponds to value 8. Usually, constants should be defined accordingly (e.g.
``const ELEMENT_WIND = 8`` and so on).

Export hints are also provided for the physics and render layers defined in the project settings::

    export(int, LAYERS_2D_PHYSICS) var layers_2d_physics
    export(int, LAYERS_2D_RENDER) var layers_2d_render
    export(int, LAYERS_3D_PHYSICS) var layers_3d_physics
    export(int, LAYERS_3D_RENDER) var layers_3d_render

Using bit flags requires some understanding of bitwise operations.
If in doubt, use boolean variables instead.

Exporting arrays
    ----------------------------------------------------------------------------

Exported arrays can have initializers, but they must be constant expressions.

If the exported array specifies a type which inherits from Resource, the array
values can be set in the inspector by dragging and dropping multiple files
from the FileSystem dock at once.

::

```py
    # Default value must be a constant expression.

    export var a = [1, 2, 3]

    # Exported arrays can specify type (using the same hints as before).

    export(Array, int) var ints = [1, 2, 3]
    export(Array, int, "Red", "Green", "Blue") var enums = [2, 1, 0]
    export(Array, Array, float) var two_dimensional = [[1.0, 2.0], [3.0, 4.0]]

    # You can omit the default value, but then it would be null if not assigned.

    export(Array) var b
    export(Array, PackedScene) var scenes

    # Arrays with specified types which inherit from resource can be set by
    # drag-and-dropping multiple files from the FileSystem dock.

    export(Array, Texture) var textures
    export(Array, PackedScene) var scenes

    # Typed arrays also work, only initialized empty:

    export var vector3s = PoolVector3Array()
    export var strings = PoolStringArray()

    # Default value can include run-time values, but can't
    # be exported.

    var c = [a, 2, 3]
```

Setting exported variables from a tool script
    ----------------------------------------------------------------------------

When changing an exported variable's value from a script in
:ref:`doc_gdscript_tool_mode`, the value in the inspector won't be updated
automatically. To update it, call
:ref:`property_list_changed_notify() <class_Object_method_property_list_changed_notify>`
after setting the exported variable's value.

Advanced exports
    ----------------------------------------------------------------------------

Not every type of export can be provided on the level of the language itself to
avoid unnecessary design complexity. The following describes some more or less
common exporting features which can be implemented with a low-level API.

Before reading further, you should get familiar with the way properties are
handled and how they can be customized with
:ref:`_set() <class_Object_method__get_property_list>`,
:ref:`_get() <class_Object_method__get_property_list>`, and
:ref:`_get_property_list() <class_Object_method__get_property_list>` methods as
described in :ref:`doc_accessing_data_or_logic_from_object`.

.. seealso:: For binding properties using the above methods in C++, see
             :ref:`doc_binding_properties_using_set_get_property_list`.

.. warning:: The script must operate in the ``tool`` mode so the above methods
             can work from within the editor.

Properties
    ----------------------------------------------------------------------------

To understand how to better use the sections below, you should understand
how to make properties with advanced exports.

::

```py
    func _get_property_list():
        var properties = [] 
        # Same as "export(int) var my_property"
        properties.append({
            name = "my_property",
            type = TYPE_INT
        })
        return properties
```

* The ``_get_property_list()`` function gets called by the inspector. You
  can override it for more advanced exports. You must return an ``Array``
  with the contents of the properties for the function to work.

* ``name`` is the name of the property

* ``type`` is the type of the property from ``Variant.Type``.

.. note:: The ``float`` type is called a real (``TYPE_REAL``) in the ``Variant.Type`` enum.

Attaching variables to properties
    ----------------------------------------------------------------------------

To attach variables to properties (allowing the value of the property to be used
in scripts), you need to create a variable with the exact same name as the
property or else you may need to override the 
:ref:`_set() <class_Object_method__get_property_list>` and 
:ref:`_get() <class_Object_method__get_property_list>` methods. Attaching
a variable to to a property also gives you the ability to give it a default state.
::


```py
    # This variable is determined by the function below.
    # This variable acts just like a regular gdscript export.
    var my_property = 5

    func _get_property_list():
        var properties = [] 
        # Same as "export(int) var my_property"
        properties.append({
            name = "my_property",
            type = TYPE_INT
        })
        return properties
```

Adding default values for properties
    ----------------------------------------------------------------------------

To define default values for advanced exports, you need to override the ``property_can_revert()`` and ``property_get_revert()`` methods.

* The ``property_can_revert()`` method takes the name of a property and must return ``true`` if the property can be reverted. This will enable the Revert button next to the property in the inspector.

* The ``property_get_revert()`` method takes the name of a property and must return the default value for that property.

::

```py
    func _get_property_list():
        var properties = []
        properties.append({
            name = "my_property",
            type = TYPE_INT
        })
        return properties

    func property_can_revert(property):
        if property == "my_property":
            return true
        return false

    func property_get_revert(property):
        if property == "my_property":
            return 5
```

Adding script categories
    ----------------------------------------------------------------------------

For better visual distinguishing of properties, a special script category can be
embedded into the inspector to act as a separator. ``Script Variables`` is one
example of a built-in category.
::

```py
    func _get_property_list():
        var properties = []
        properties.append({
            name = "Debug",
            type = TYPE_NIL,
            usage = PROPERTY_USAGE_CATEGORY | PROPERTY_USAGE_SCRIPT_VARIABLE
        })
        
        # Example of adding a property to the script category
        properties.append({
            name = "Logging_Enabled",
            type = TYPE_BOOL
        })
        return properties
```

* ``name`` is the name of a category to be added to the inspector;

* Every following property added after the category definition will be a part
  of the category. 

* ``PROPERTY_USAGE_CATEGORY`` indicates that the property should be treated as a
  script category specifically, so the type ``TYPE_NIL`` can be ignored as it
  won't be actually used for the scripting logic, yet it must be defined anyway.

Grouping properties
    ----------------------------------------------------------------------------

A list of properties with similar names can be grouped.
::

```py
    func _get_property_list():
        var properties = []
        properties.append({
            name = "Rotate",
            type = TYPE_NIL,
            hint_string = "rotate_",
            usage = PROPERTY_USAGE_GROUP | PROPERTY_USAGE_SCRIPT_VARIABLE
        })

        # Example of adding to the group
        properties.append({
            name = "rotate_speed",
            type = TYPE_REAL
        })

        # This property won't get added to the group 
        # due to not having the "rotate_" prefix.
        properties.append({
            name = "trail_color",
            type = TYPE_COLOR
        })
        return properties
```

* ``name`` is the name of a group which is going to be displayed as collapsible
  list of properties;

* Every following property added after the group property with the prefix
  (which determined by ``hint_string``) will be shortened. For instance, 
  ``rotate_speed`` is going to be shortened to ``speed`` in this case.
  However, ``movement_speed`` won't be a part of the group and will not
  be shortened.

* ``PROPERTY_USAGE_GROUP`` indicates that the property should be treated as a
  script group specifically, so the type ``TYPE_NIL`` can be ignored as it
  won't be actually used for the scripting logic, yet it must be defined anyway.


### ğŸŸ ğŸ”µ GDScript 2.0 exports
- [GDScript 1.0 exports](https://github.com/godotengine/godot-docs/blob/3.6/tutorials/scripting/gdscript/gdscript_exports.rst)
- [GDScript 2.0 exports](https://github.com/godotengine/godot-docs/blob/master/tutorials/scripting/gdscript/gdscript_exports.rst)

In Godot, class members can be exported. This means their value gets saved along
with the resource (such as the :ref:`scene <class_PackedScene>`) they're
attached to. They will also be available for editing in the property editor.
Exporting is done by using the ``@export`` annotation::

    extends Button

    @export var number = 5

In that example the value `5` will be saved and visible in the property editor.

An exported variable must be initialized to a constant expression or have a type specifier
in the variable. Some of the export annotations have a specific type and don't need the variable to be typed (see the
*Examples* section below).

One of the fundamental benefits of exporting member variables is to have
them visible and editable in the editor. This way, artists and game designers
can modify values that later influence how the program runs. For this, a
special export syntax is provided.

Exporting can only be done with built-in types or objects derived from the :ref:`Resource class <class_Resource>`.

.. note::

    Exporting properties can also be done in other languages such as C#.
    The syntax varies depending on the language. See :ref:`doc_c_sharp_exports`
    for information on C# exports.

Basic use
    ----------------------------------------------------------------------------

If the exported value assigns a constant or constant expression,
the type will be inferred and used in the editor.

::

    @export var number = 5

If there's no default value, you can add a type to the variable.

::

    @export var number: int

Export works with resource types.

::

    @export var character_face: Texture
    @export var scene_file: PackedScene

There are many resource types that can be used this way, try e.g.
the following to list them:

::

    @export var resource: Resource

Integers and strings hint enumerated values.

::

    # Editor will enumerate as 0, 1 and 2.
    @export_enum("Warrior", "Magician", "Thief") var character_class

If type is String, editor will enumerate with string names.

::

    @export_enum("Rebecca", "Mary", "Leah") var character_name: String

Named enum values
    ----------------------------------------------------------------------------

Editor will enumerate as THING_1, THING_2, ANOTHER_THING.

::

    enum NamedEnum {THING_1, THING_2, ANOTHER_THING = -1}
    @export var x: NamedEnum

Strings as paths
    ----------------------------------------------------------------------------

String as a path to a file.

::

    @export_file var f

String as a path to a directory.

::

    @export_dir var f

String as a path to a file, custom filter provided as hint.

::

    @export_file("*.txt") var f

Using paths in the global filesystem is also possible,
but only in scripts in tool mode.

String as a path to a PNG file in the global filesystem.

::

    @export_global_file("*.png") var tool_image

String as a path to a directory in the global filesystem.

::

    @export_global_dir var tool_dir

The multiline annotation tells the editor to show a large input
field for editing over multiple lines.

::

    @export_multiline var text

Limiting editor input ranges
    ----------------------------------------------------------------------------

Allow integer values from 0 to 20.

::

    @export_range(0, 20) var i

Allow integer values from -10 to 20.

::

    @export_range(-10, 20) var j

Allow floats from -10 to 20 and snap the value to multiples of 0.2.

::

    @export_range(-10, 20, 0.2) var k: float

The limits can be only for the slider if you add the hints "or_greater" and/or "or_lesser".

::

    @export_range(0, 100, 1, "or_greater", "or_lesser")

.. TODO: Document other hint strings usable with export_range.

Floats with easing hint
    ----------------------------------------------------------------------------

Display a visual representation of the 'ease()' function
when editing.

::

    @export_exp_easing var transition_speed

Colors
    ----------------------------------------------------------------------------

Regular color given as red-green-blue-alpha value.

::

    @export var col: Color

Color given as red-green-blue value (alpha will always be 1).

::

    @export_color_no_alpha var col: Color

Nodes
    ----------------------------------------------------------------------------

Nodes can't be directly exported. Instead you need to export
a node path, then use that node path with `get_node()`

::

    @export var node_path: NodePath
    var node = get_node(node_path)

If you want to limit the types of nodes, you can use the @export_node_path annotation.

::

    @export_node_path(Button, TouchScreenButton) var some_button

Resources
    ----------------------------------------------------------------------------

::

    @export var resource: Resource

In the Inspector, you can then drag and drop a resource file
from the FileSystem dock into the variable slot.

Opening the inspector dropdown may result in an
extremely long list of possible classes to create, however.
Therefore, if you specify an extension of Resource such as:

::

    @export var resource: AnimationNode

The drop-down menu will be limited to AnimationNode and all
its inherited classes.

It must be noted that even if the script is not being run while in the
editor, the exported properties are still editable. This can be used
in conjunction with a :ref:`script in "tool" mode <doc_gdscript_tool_mode>`.

Exporting bit flags
    ----------------------------------------------------------------------------

Integers used as bit flags can store multiple ``true``/``false`` (boolean)
values in one property. By using the ``@export_flags`` annotation, they
can be set from the editor::

    # Set any of the given flags from the editor.
    @export_flags("Fire", "Water", "Earth", "Wind") var spell_elements = 0

You must provide a string description for each flag. In this example, ``Fire``
has value 1, ``Water`` has value 2, ``Earth`` has value 4 and ``Wind``
corresponds to value 8. Usually, constants should be defined accordingly (e.g.
``const ELEMENT_WIND = 8`` and so on).

Export annotations are also provided for the physics, render, and navigation 
layers defined in the project settings::

    @export_flags_2d_physics var layers_2d_physics
    @export_flags_2d_render var layers_2d_render
    @export_flags_2d_navigation var layers_2d_navigation
    @export_flags_3d_physics var layers_3d_physics
    @export_flags_3d_render var layers_3d_render
    @export_flags_3d_navigation var layers_3d_navigation

Using bit flags requires some understanding of bitwise operations.
If in doubt, use boolean variables instead.

Exporting arrays
    ----------------------------------------------------------------------------

Exported arrays can have initializers, but they must be constant expressions.

If the exported array specifies a type which inherits from Resource, the array
values can be set in the inspector by dragging and dropping multiple files
from the FileSystem dock at once.

The default value **must** be a constant expression.

::

    @export var a = [1, 2, 3]

Exported arrays can specify type (using the same hints as before).

::

    @export var ints: Array[int] = [1, 2, 3]

    # Nested typed arrays such as `Array[Array[float]]` are not supported yet.
    @export var two_dimensional: Array[Array] = [[1.0, 2.0], [3.0, 4.0]]

You can omit the default value, but it would then be ``null`` if not assigned.

::

    @export var b: Array
    @export var scenes: Array[PackedScene]

Arrays with specified types which inherit from resource can be set by
drag-and-dropping multiple files from the FileSystem dock.

::

    @export var textures: Array[Texture] = []
    @export var scenes: Array[PackedScene] = []

Packed type arrays also work, but only initialized empty:

::

    @export var vector3s = PackedVector3Array()
    @export var strings = PackedStringArray()

Setting exported variables from a tool script
    ----------------------------------------------------------------------------

When changing an exported variable's value from a script in
:ref:`doc_gdscript_tool_mode`, the value in the inspector won't be updated
automatically. To update it, call
:ref:`notify_property_list_changed() <class_Object_method_notify_property_list_changed>`
after setting the exported variable's value.

Advanced exports
    ----------------------------------------------------------------------------

Not every type of export can be provided on the level of the language itself to
avoid unnecessary design complexity. The following describes some more or less
common exporting features which can be implemented with a low-level API.

Before reading further, you should get familiar with the way properties are
handled and how they can be customized with
:ref:`_set() <class_Object_method__get_property_list>`,
:ref:`_get() <class_Object_method__get_property_list>`, and
:ref:`_get_property_list() <class_Object_method__get_property_list>` methods as
described in :ref:`doc_accessing_data_or_logic_from_object`.

.. seealso:: For binding properties using the above methods in C++, see
             :ref:`doc_binding_properties_using_set_get_property_list`.

.. warning:: The script must operate in the ``tool`` mode so the above methods
             can work from within the editor.


## ğŸŸ¡ GPU Gems 1/2/3 ç³»åˆ—ä¹¦ç±ç›®å½•
- [GPU Gems 1](https://developer.nvidia.com/gpugems/gpugems/contributors)
- [GPU Gems 1 Code](https://http.download.nvidia.com/developer/GPU_Gems/CD_Image/GPU_Gems_code.zip)
- [GPU Gems 1 CD Content](https://http.download.nvidia.com/developer/GPU_Gems/CD_Image/Index.html)
- [GPU Gems 2](https://developer.nvidia.com/gpugems/gpugems2/contributors)
- [GPU Gems 2 Code](https://http.download.nvidia.com/developer/GPU_Gems_2/CD/GPU_Gems_2_code.zip)
- [GPU Gems 2 CD Content](https://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html)
- [GPU Gems 3](https://developer.nvidia.com/gpugems/gpugems3/contributors)
- [GPU Gems 3 Code](https://http.download.nvidia.com/developer/GPU_Gems_3/CD/GPU_Gems_3_code.zip)
- [GPU Gems 3 CD Content](https://http.download.nvidia.com/developer/GPU_Gems_3/CD/)

GPU Gems 1 contents

- [Contributors](https://developer.nvidia.com/gpugems/gpugems/contributors)
- [Copyright](https://developer.nvidia.com/gpugems/gpugems/copyright)
- [Foreword](https://developer.nvidia.com/gpugems/gpugems/foreword)
- [Part I: Natural Effects](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects)
    - [Chapter 1. Effective Water Simulation from Physical Models](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-1-effective-water-simulation-physical-models)
    - [Chapter 2. Rendering Water Caustics](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-2-rendering-water-caustics)
    - [Chapter 3. Skin in the "Dawn" Demo](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-3-skin-dawn-demo)
    - [Chapter 4. Animation in the "Dawn" Demo](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-4-animation-dawn-demo)
    - [Chapter 5. Implementing Improved Perlin Noise](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-5-implementing-improved-perlin-noise)
    - [Chapter 6. Fire in the "Vulcan" Demo](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-6-fire-vulcan-demo)
    - [Chapter 7. Rendering Countless Blades of Waving Grass](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-7-rendering-countless-blades-waving-grass)
    - [Chapter 8. Simulating Diffraction](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-8-simulating-diffraction)
- [Part II: Lighting and Shadows](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows)
    - [Chapter 9. Efficient Shadow Volume Rendering](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-9-efficient-shadow-volume-rendering)
    - [Chapter 10. Cinematic Lighting](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-10-cinematic-lighting)
    - [Chapter 11. Shadow Map Antialiasing](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-11-shadow-map-antialiasing)
    - [Chapter 12. Omnidirectional Shadow Mapping](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-12-omnidirectional-shadow-mapping)
    - [Chapter 13. Generating Soft Shadows Using Occlusion Interval Maps](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-13-generating-soft-shadows-using-occlusion)
    - [Chapter 14. Perspective Shadow Maps: Care and Feeding](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-14-perspective-shadow-maps-care-and-feeding)
    - [Chapter 15. Managing Visibility for Per-Pixel Lighting](https://developer.nvidia.com/gpugems/gpugems/part-ii-lighting-and-shadows/chapter-15-managing-visibility-pixel-lighting)
- [Part III: Materials](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials)
    - [Chapter 16. Real-Time Approximations to Subsurface Scattering](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-16-real-time-approximations-subsurface-scattering)
    - [Chapter 17. Ambient Occlusion](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-17-ambient-occlusion)
    - [Chapter 18. Spatial BRDFs](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-18-spatial-brdfs)
    - [Chapter 19. Image-Based Lighting](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-19-image-based-lighting)
    - [Chapter 20. Texture Bombing](https://developer.nvidia.com/gpugems/gpugems/part-iii-materials/chapter-20-texture-bombing)
- [Part IV: Image Processing](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing)
    - [Chapter 21. Real-Time Glow](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-21-real-time-glow)
    - [Chapter 22. Color Controls](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-22-color-controls)
    - [Chapter 23. Depth of Field: A Survey of Techniques](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-23-depth-field-survey-techniques)
    - [Chapter 24. High-Quality Filtering](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-24-high-quality-filtering)
    - [Chapter 25. Fast Filter-Width Estimates with Texture Maps](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-25-fast-filter-width-estimates-texture-maps)
    - [Chapter 26. The OpenEXR Image File Format](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-26-openexr-image-file-format)
    - [Chapter 27. A Framework for Image Processing](https://developer.nvidia.com/gpugems/gpugems/part-iv-image-processing/chapter-27-framework-image-processing)
- [Part V: Performance and Practicalities](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities)
    - [Chapter 28. Graphics Pipeline Performance](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-28-graphics-pipeline-performance)
    - [Chapter 29. Efficient Occlusion Culling](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-29-efficient-occlusion-culling)
    - [Chapter 30. The Design of FX Composer](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-30-design-fx-composer)
    - [Chapter 31. Using FX Composer](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-31-using-fx-composer)
    - [Chapter 32. An Introduction to Shader Interfaces](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-32-introduction-shader-interfaces)
    - [Chapter 33. Converting Production RenderMan Shaders to Real-Time](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-33-converting-production-renderman)
    - [Chapter 34. Integrating Hardware Shading into Cinema 4D](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-34-integrating-hardware-shading-cinema)
    - [Chapter 35. Leveraging High-Quality Software Rendering Effects in Real-Time Applications](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-35-leveraging-high-quality-software)
    - [Chapter 36. Integrating Shaders into Applications](https://developer.nvidia.com/gpugems/gpugems/part-v-performance-and-practicalities/chapter-36-integrating-shaders-applications)
- [Part VI: Beyond Triangles](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles)
  - [Appendix](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/appendix)
  - [Chapter 37. A Toolkit for Computation on GPUs](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-37-toolkit-computation-gpus)
  - [Chapter 38. Fast Fluid Dynamics Simulation on the GPU](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-38-fast-fluid-dynamics-simulation-gpu)
  - [Chapter 39. Volume Rendering Techniques](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-39-volume-rendering-techniques)
  - [Chapter 40. Applying Real-Time Shading to 3D Ultrasound Visualization](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-40-applying-real-time-shading-3d-ultrasound)
  - [Chapter 41. Real-Time Stereograms](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-41-real-time-stereograms)
  - [Chapter 42. Deformers](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-42-deformers)
- [Preface](https://developer.nvidia.com/gpugems/gpugems/preface)


GPU Gems 2 contents


- [Copyright](https://developer.nvidia.com/gpugems/gpugems2/copyright)
- [Inside Back Cover](https://developer.nvidia.com/gpugems/gpugems2/inside-back-cover)
- [Inside Front Cover](https://developer.nvidia.com/gpugems/gpugems2/inside-front-cover)
- [Part I: Geometric Complexity](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity)
    - [Chapter 1. Toward Photorealism in Virtual Botany](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-1-toward-photorealism-virtual-botany)
    - [Chapter 2. Terrain Rendering Using GPU-Based Geometry Clipmaps](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-2-terrain-rendering-using-gpu-based-geometry)
    - [Chapter 3. Inside Geometry Instancing](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-3-inside-geometry-instancing)
    - [Chapter 4. Segment Buffering](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-4-segment-buffering)
    - [Chapter 5. Optimizing Resource Management with Multistreaming](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-5-optimizing-resource-management-multistreaming)
    - [Chapter 6. Hardware Occlusion Queries Made Useful](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-6-hardware-occlusion-queries-made-useful)
    - [Chapter 7. Adaptive Tessellation of Subdivision Surfaces with Displacement Mapping](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-7-adaptive-tessellation-subdivision-surfaces)
    - [Chapter 8. Per-Pixel Displacement Mapping with Distance Functions](https://developer.nvidia.com/gpugems/gpugems2/part-i-geometric-complexity/chapter-8-pixel-displacement-mapping-distance-functions)
- [Part II: Shading, Lighting, and Shadows](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows)
    - [Chapter 9. Deferred Shading in S.T.A.L.K.E.R.](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-9-deferred-shading-stalker)
    - [Chapter 10. Real-Time Computation of Dynamic Irradiance Environment Maps](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-10-real-time-computation-dynamic)
    - [Chapter 11. Approximate Bidirectional Texture Functions](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-11-approximate-bidirectional-texture)
    - [Chapter 12. Tile-Based Texture Mapping](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-12-tile-based-texture-mapping)
    - [Chapter 13. Implementing the mental images Phenomena Renderer on the GPU](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-13-implementing-mental-images)
    - [Chapter 14. Dynamic Ambient Occlusion and Indirect Lighting](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-14-dynamic-ambient-occlusion-and)
    - [Chapter 15. Blueprint Rendering and "Sketchy Drawings"](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-15-blueprint-rendering-and-sketchy)
    - [Chapter 16. Accurate Atmospheric Scattering](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-16-accurate-atmospheric-scattering)
    - [Chapter 17. Efficient Soft-Edged Shadows Using Pixel Shader Branching](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-17-efficient-soft-edged-shadows-using)
    - [Chapter 18. Using Vertex Texture Displacement for Realistic Water Rendering](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-18-using-vertex-texture-displacement)
    - [Chapter 19. Generic Refraction Simulation](https://developer.nvidia.com/gpugems/gpugems2/part-ii-shading-lighting-and-shadows/chapter-19-generic-refraction-simulation)
- [Part III: High-Quality Rendering](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering)
    - [Chapter 20. Fast Third-Order Texture Filtering](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-20-fast-third-order-texture-filtering)
    - [Chapter 21. High-Quality Antialiased Rasterization](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-21-high-quality-antialiased-rasterization)
    - [Chapter 22. Fast Prefiltered Lines](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-22-fast-prefiltered-lines)
    - [Chapter 23. Hair Animation and Rendering in the Nalu Demo](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-23-hair-animation-and-rendering-nalu-demo)
    - [Chapter 24. Using Lookup Tables to Accelerate Color Transformations](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-24-using-lookup-tables-accelerate-color)
    - [Chapter 25. GPU Image Processing in Apple's Motion](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-25-gpu-image-processing-apples-motion)
    - [Chapter 26. Implementing Improved Perlin Noise](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-26-implementing-improved-perlin-noise)
    - [Chapter 27. Advanced High-Quality Filtering](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-27-advanced-high-quality-filtering)
    - [Chapter 28. Mipmap-Level Measurement](https://developer.nvidia.com/gpugems/gpugems2/part-iii-high-quality-rendering/chapter-28-mipmap-level-measurement)
- [Part IV: General-Purpose Computation on GPUS: A Primer](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer)
    - [Chapter 29. Streaming Architectures and Technology Trends](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-29-streaming-architectures)
    - [Chapter 30. The GeForce 6 Series GPU Architecture](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-30-geforce-6-series-gpu)
    - [Chapter 31. Mapping Computational Concepts to GPUs](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-31-mapping-computational)
    - [Chapter 32. Taking the Plunge into GPU Computing](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-32-taking-plunge-gpu)
    - [Chapter 33. Implementing Efficient Parallel Data Structures on GPUs](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-33-implementing-efficient)
    - [Chapter 34. GPU Flow-Control Idioms](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-34-gpu-flow-control-idioms)
    - [Chapter 35. GPU Program Optimization](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-35-gpu-program-optimization)
    - [Chapter 36. Stream Reduction Operations for GPGPU Applications](https://developer.nvidia.com/gpugems/gpugems2/part-iv-general-purpose-computation-gpus-primer/chapter-36-stream-reduction)
- [Part V: Image-Oriented Computing](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing)
    - [Chapter 37. Octree Textures on the GPU](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-37-octree-textures-gpu)
    - [Chapter 38. High-Quality Global Illumination Rendering Using Rasterization](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-38-high-quality-global-illumination)
    - [Chapter 39. Global Illumination Using Progressive Refinement Radiosity](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-39-global-illumination-using-progressive)
    - [Chapter 40. Computer Vision on the GPU](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-40-computer-vision-gpu)
    - [Chapter 41. Deferred Filtering: Rendering from Difficult Data Formats](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-41-deferred-filtering-rendering-difficult)
    - [Chapter 42. Conservative Rasterization](https://developer.nvidia.com/gpugems/gpugems2/part-v-image-oriented-computing/chapter-42-conservative-rasterization)
- [Part VI: Simulation and Numerical Algorithms](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms)
    - [Chapter 43. GPU Computing for Protein Structure Prediction](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-43-gpu-computing-protein)
    - [Chapter 44. A GPU Framework for Solving Systems of Linear Equations](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-44-gpu-framework-solving)
    - [Chapter 45. Options Pricing on the GPU](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-45-options-pricing-gpu)
    - [Chapter 46. Improved GPU Sorting](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-46-improved-gpu-sorting)
    - [Chapter 47. Flow Simulation with Complex Boundaries](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-47-flow-simulation-complex)
    - [Chapter 48. Medical Image Reconstruction with the FFT](https://developer.nvidia.com/gpugems/gpugems2/part-vi-simulation-and-numerical-algorithms/chapter-48-medical-image-reconstruction)



GPU Gems 3 contents

- [Contributors](https://developer.nvidia.com/gpugems/gpugems3/contributors)
- [Foreword](https://developer.nvidia.com/gpugems/gpugems3/foreword)
- [Part I: Geometry](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry)
    - [Chapter 1. Generating Complex Procedural Terrains Using the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-1-generating-complex-procedural-terrains-using-gpu)
    - [Chapter 2. Animated Crowd Rendering](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-2-animated-crowd-rendering)
    - [Chapter 3. DirectX 10 Blend Shapes: Breaking the Limits](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-3-directx-10-blend-shapes-breaking-limits)
    - [Chapter 4. Next-Generation SpeedTree Rendering](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-4-next-generation-speedtree-rendering)
    - [Chapter 5. Generic Adaptive Mesh Refinement](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-5-generic-adaptive-mesh-refinement)
    - [Chapter 6. GPU-Generated Procedural Wind Animations for Trees](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-6-gpu-generated-procedural-wind-animations-trees)
    - [Chapter 7. Point-Based Visualization of Metaballs on a GPU](https://developer.nvidia.com/gpugems/gpugems3/part-i-geometry/chapter-7-point-based-visualization-metaballs-gpu)
- [Part II: Light and Shadows](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows)
    - [Chapter 8. Summed-Area Variance Shadow Maps](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-8-summed-area-variance-shadow-maps)
    - [Chapter 9. Interactive Cinematic Relighting with Global Illumination](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-9-interactive-cinematic-relighting-global)
    - [Chapter 10. Parallel-Split Shadow Maps on Programmable GPUs](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-10-parallel-split-shadow-maps-programmable-gpus)
    - [Chapter 11. Efficient and Robust Shadow Volumes Using Hierarchical Occlusion Culling and Geometry Shaders](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-11-efficient-and-robust-shadow-volumes-using)
    - [Chapter 12. High-Quality Ambient Occlusion](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-12-high-quality-ambient-occlusion)
    - [Chapter 13. Volumetric Light Scattering as a Post-Process](https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-13-volumetric-light-scattering-post-process)
- [Part III: Rendering](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering)
    - [Chapter 14. Advanced Techniques for Realistic Real-Time Skin Rendering](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-14-advanced-techniques-realistic-real-time-skin)
    - [Chapter 15. Playable Universal Capture](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-15-playable-universal-capture)
    - [Chapter 16. Vegetation Procedural Animation and Shading in Crysis](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-16-vegetation-procedural-animation-and-shading-crysis)
    - [Chapter 17. Robust Multiple Specular Reflections and Refractions](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-17-robust-multiple-specular-reflections-and-refractions)
    - [Chapter 18. Relaxed Cone Stepping for Relief Mapping](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-18-relaxed-cone-stepping-relief-mapping)
    - [Chapter 19. Deferred Shading in Tabula Rasa](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-19-deferred-shading-tabula-rasa)
    - [Chapter 20. GPU-Based Importance Sampling](https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-20-gpu-based-importance-sampling)
- [Part IV: Image Effects](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects)
    - [Chapter 21. True Impostors](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-21-true-impostors)
    - [Chapter 22. Baking Normal Maps on the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-22-baking-normal-maps-gpu)
    - [Chapter 23. High-Speed, Off-Screen Particles](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-23-high-speed-screen-particles)
    - [Chapter 24. The Importance of Being Linear](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-24-importance-being-linear)
    - [Chapter 25. Rendering Vector Art on the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-25-rendering-vector-art-gpu)
    - [Chapter 26. Object Detection by Color: Using the GPU for Real-Time Video Image Processing](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-26-object-detection-color-using-gpu-real-time-video)
    - [Chapter 27. Motion Blur as a Post-Processing Effect](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-27-motion-blur-post-processing-effect)
    - [Chapter 28. Practical Post-Process Depth of Field](https://developer.nvidia.com/gpugems/gpugems3/part-iv-image-effects/chapter-28-practical-post-process-depth-field)
- [Part V: Physics Simulation](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation)
    - [Chapter 29. Real-Time Rigid Body Simulation on GPUs](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-29-real-time-rigid-body-simulation-gpus)
    - [Chapter 30. Real-Time Simulation and Rendering of 3D Fluids](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-30-real-time-simulation-and-rendering-3d-fluids)
    - [Chapter 31. Fast N-Body Simulation with CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-31-fast-n-body-simulation-cuda)
    - [Chapter 32. Broad-Phase Collision Detection with CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-32-broad-phase-collision-detection-cuda)
    - [Chapter 33. LCP Algorithms for Collision Detection Using CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-33-lcp-algorithms-collision-detection-using-cuda)
    - [Chapter 34. Signed Distance Fields Using Single-Pass GPU Scan Conversion of Tetrahedra](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-34-signed-distance-fields-using-single-pass-gpu)
    - [Chapter 35. Fast Virus Signature Matching on the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-v-physics-simulation/chapter-35-fast-virus-signature-matching-gpu)
- [Part VI: GPU Computing](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing)
    - [Chapter 36. AES Encryption and Decryption on the GPU](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-36-aes-encryption-and-decryption-gpu)
    - [Chapter 37. Efficient Random Number Generation and Application Using CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-37-efficient-random-number-generation-and-application)
    - [Chapter 38. Imaging Earth's Subsurface Using CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-38-imaging-earths-subsurface-using-cuda)
    - [Chapter 39. Parallel Prefix Sum (Scan) with CUDA](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-39-parallel-prefix-sum-scan-cuda)
    - [Chapter 40. Incremental Computation of the Gaussian](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-40-incremental-computation-gaussian)
    - [Chapter 41. Using the Geometry Shader for Compact and Variable-Length GPU Feedback](https://developer.nvidia.com/gpugems/gpugems3/part-vi-gpu-computing/chapter-41-using-geometry-shader-compact-and-variable-length)
- [Preface](https://developer.nvidia.com/gpugems/gpugems3/preface)
